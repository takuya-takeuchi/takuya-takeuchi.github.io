<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>.NETで難読化を試してみる 第1回 · A certain engineer "COMPLEX"</title><meta name="description" content="技術屋さんなので、プログラマーなのでそれらしいネタで情報提供しましょう、ってことで始めた「.NETで○○○を試してみる」シリーズ第2弾。 第1弾はソフトウェア工学なんてお題目を掲げたものの、終始ソフトウェアの機能紹介と用語解説に甘んじてたようにも見える。 いや、ソースコードも書いていたし、一応C#*"><meta name="keywords" content="极限博客,极限Blog,博客,极限"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>心之所愿，无事不成。<br> Nothing is impossible to a willing heart.</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/mrcore"><i class="fa fa-github"></i></a></li><li><a href="mailto:x@jixian.io"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY="><i class="fa fa-qq"></i></a></li><li><a target="_blank" rel="noopener" href="https://zhihu.com/people/"><i class="fa fa-mortar-board"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2017 - 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li><li><a href="/guestbook">メッセージ</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>.NETで難読化を試してみる 第1回</a></h3></div><div class="post-content"><p>技術屋さんなので、プログラマーなのでそれらしいネタで情報提供しましょう、ってことで始めた<strong>「.NETで○○○を試してみる」シリーズ</strong>第2弾。 <a target="_blank" rel="noopener" href="https://taktak.jp/2012/04/23/%E3%82%B3%E3%83%BC%E3%83%89-%E3%83%A1%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-%E7%AC%AC1%E5%9B%9E/">第1弾</a>はソフトウェア工学なんてお題目を掲げたものの、終始ソフトウェアの機能紹介と用語解説に甘んじてたようにも見える。 いや、ソースコードも書いていたし、一応<strong>C#**、</strong>.NET Framework<strong>っていう範疇ではありましたが。 今回は</strong>難読化**に挑戦します。</p>
<a id="more"></a>
<h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>まずは、難読化が何か、というところから。 そもそも、.NET 用に作成されたプログラムは、CやC++で作成されたプログラムに比べてリバース エンジニアリングが極めて容易です。 なぜなら、ソースコードがコンパイルされて作成された実行ファイルやアセンブリは、その時点ではネイティブコードに変換されていないためです。 C#やVisual Basic .NETで記述されたソースコードは、コンパイルが実行されると、<strong>MSIL (Microsoft Intermediate Language)</strong> に変換されます。 このMSILはマシン語であるネイティブコードよりも高度(ここで言う高度とは機能的な意味ではなく、人間に理解しやすいかどうか)であり、マシン語固有の知識が不要であるため解析が容易です。 CやC++で記述され、コンパイルによって生成されたプログラムに比べてリバース エンジニアリングが極めて容易、と言う理由はここにあります。 そこで、ソースコードからMSILに変換する段階で、処理結果に影響を与えないようにロジックの理解度を低下させます。 たとえば、変数名、メソッド名、クラス名等人間の理解力を補佐する情報を空白や記号に置換したりする等の手法が挙げられます。 これが難読化です。あくまで、<strong>読みにくくする</strong>、というのが目標ですので、人間には解読不可能だ!!!、リバースエンジニアリング不可能にする!!、とかそういうのはお門違いです。 <strong>Microsoft</strong>は<a target="_blank" rel="noopener" href="http://msdn.microsoft.com/ja-jp/library/ms227271%28v=vs.90%29.aspx">難読化が必要な理由</a>というページで下記のように述べています。</p>
<blockquote>
<p>NET 用に作成されたプログラムは、リバース エンジニアリングが簡単です。これは .NET のデザインに不備があるからではありません。最新の中間コンパイル言語が採用されているからです。.NET は表出的なファイル構文を使用して実行可能コード、すなわち MSIL (Microsoft Intermediate Language) を配信します。このような中間ファイルは、バイナリのマシン語コードよりも高度なもので、直接表示でき、最終的に理解可能な識別子やアルゴリズムを積み重ねたものです。判読性を高め、柔軟性と拡張性を持たせながら、同時に重要な部分を難読化することは、もちろん容易なことではありません。 .NET 逆コンパイラは誰でも無償で入手でき、これを使用してコードを簡単にリバース エンジニアリングできます。誰でもすぐに、ライセンス供与されたコード、コピー保護メカニズム、所有権を有するビジネス ロジックなどを、(合法的であるかどうかは別として) かなり判別しやすい状態にすることができます。どのような目的であれ、ソフトウェアの詳細を隅々まで調べることができるため、セキュリティ上の欠陥を探して利用したり、ユニークなアイデアを盗んだり、プログラムをクラックすることなども可能です。 これが必ずしもリスク、または重大な問題になるわけではありません。知的財産について懸念のある組織は、.NET プラットフォームを考える際、リバース エンジニアリングを防ぐためのソリューションが存在することを知っておく必要があります。難読化は、アセンブリ内のシンボルの名前をシームレスに変更する技法であり、その他にも逆コンパイラを妨害する対策を備えています。難読化を正しく適用すると、アプリケーションはそのままにして、さまざまな規模の逆コンパイルに対する保護を高めることができます。</p>
</blockquote>
<p>Microsoft自身はこのように警鐘を鳴らしてはいますが、Microsoftは難読化という<strong>ソリューションを提供してはいません。</strong> 個人的には、MSILに対して一番理解がある(当たり前ですが)Microsoftが難読化の機能をVisualStudioなりに備えておくのが一番だと思いますが、そうなっていないなら仕方ありません。 そういうわけですので、難読化を行うための手段は3通りです。</p>
<ol>
<li>コーディング中に変数名、クラス名、メソッド名を記号や空白に置き換える。</li>
<li>特許が含まれるようなロジックはアンマネージドなアセンブリに退避させ <strong>P/Invoke呼び出し</strong> で利用する。</li>
<li>難読化ツールを利用する。</li>
</ol>
<p><strong>1.</strong> まぁ、どう考えてもないでしょう。コーディングやコードレビューの効率が著しく低下しますが、そこに膨大な工数を費やせる予算潤沢なプロジェクトならありでしょう。まぁ保守する人間が絶叫すること間違いないでしょうが.. <strong>2.</strong> これは現実路線でしょう。というか特許云々は置いておいて、処理速度の関係からこうするソフトウェアもありますので、お馴染みの手法と言えばそうだと言えますが、既存の特許ロジックが.NETで作られている場合に、C++やCにポーティングする工数を考えるとこれは次善策でしょう。 <strong>3.</strong> 今回の本命です。というかここに来るまでが長い。変数名等の難読化やリテラル文字列の暗号化など様々な機能を提供してくれます。が、ツールのコストは無料のものから数十万円と開きがあります。予算や顧客からの要求に応じて検討しましょう。</p>
<h1 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h1><p>現在、難読化機能を提供しているツールは調べた限り以下になります。 *<em>無償**</em>   <a target="_blank" rel="noopener" href="http://uwa.potetihouse.com/soft/nandoku.html">NanDoKu</a> -&gt; 日本製</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx">Eazfuscator.NET</a></li>
<li><a target="_blank" rel="noopener" href="http://ntcore.com/phoenix.php">Phoenix Protector</a></li>
<li><a target="_blank" rel="noopener" href="http://code.google.com/p/obfuscar/">obfuscar</a></li>
<li><a target="_blank" rel="noopener" href="http://sharpobfuscator.codeplex.com/">SharpObfuscator</a>*<em>有償**</em>   <a target="_blank" rel="noopener" href="http://leapspec.com/exob/">Express Obfuscator</a> -&gt; 日本製</li>
<li><a target="_blank" rel="noopener" href="http://babelfor.net/">Babel.NET</a> -&gt; I/Fが秀逸</li>
<li><a target="_blank" rel="noopener" href="http://codefort.org/">CodeFort</a> -&gt; I/Fが秀逸</li>
<li><a target="_blank" rel="noopener" href="http://www.preemptive.com/">Dotfuscator</a> -&gt; 無償版ありの業界標準？</li>
<li><a target="_blank" rel="noopener" href="http://www.red-gate.com/products/dotnet-development/smartassembly/">SmartAssembly</a> -&gt; .NET Reflectorの開発元</li>
<li><a target="_blank" rel="noopener" href="http://www.9rays.net/Category/55-spicesnet-obfuscator.aspx">Spices .Net Obfuscator</a></li>
<li><a target="_blank" rel="noopener" href="http://www.deepseaobfuscator.com/">DeepSea Obfuscator</a></li>
<li><a target="_blank" rel="noopener" href="http://www.secureteam.net/Obfuscator.aspx">CliSecure .NET obfuscator</a></li>
<li><a target="_blank" rel="noopener" href="http://www.eziriz.com/dotnet_reactor.htm">.NET Reactor</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm">Crypto Obfuscator For .Net</a></li>
<li><a target="_blank" rel="noopener" href="http://www.remotesoft.com/salamander/protector.html">Salamander .NET protector</a></li>
<li><a target="_blank" rel="noopener" href="http://www.rustemsoft.com/obfuscator_net.asp">Skater .NET Obfuscator</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cantelmosoftware.com/eng/obfuscator.html">Goliath .NET Obfuscator</a></li>
<li><a target="_blank" rel="noopener" href="http://www.wiseowl.com/products/Products.aspx">Demeanor for.NET</a></li>
<li><a target="_blank" rel="noopener" href="http://www.lesser-software.com/en/content/products/LSW%20DotNet-Tools/LSW_DotNet_IL-Obfuscator.htm">LSW IL-Obfuscator</a>この中から、Webサイトの印象や評判やI/Fなどから選ぶと</li>
</ul>
<ol>
<li><a target="_blank" rel="noopener" href="http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx">Eazfuscator.NET</a></li>
<li><a target="_blank" rel="noopener" href="http://leapspec.com/exob/">Express Obfuscator</a></li>
<li><a target="_blank" rel="noopener" href="http://uwa.potetihouse.com/soft/nandoku.html">NanDoKu</a></li>
<li><a target="_blank" rel="noopener" href="http://babelfor.net/">Babel.NET</a></li>
<li><a target="_blank" rel="noopener" href="http://codefort.org/">CodeFort</a></li>
<li><a target="_blank" rel="noopener" href="http://www.9rays.net/Category/55-spicesnet-obfuscator.aspx">Spices .Net Obfuscator</a></li>
<li><a target="_blank" rel="noopener" href="http://www.red-gate.com/products/dotnet-development/smartassembly/">SmartAssembly</a></li>
<li><a target="_blank" rel="noopener" href="http://www.preemptive.com/">Dotfuscator</a></li>
</ol>
<p>というのが個人的な順位付けになります。予算があるなら、Dotfuscatorとか選ぶんでしょうけど…</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>というわけで、次回は<strong>個人的ランキング1位</strong>に輝いた <strong>Eazfuscator.NET</strong> を使って難読化を行っていきたいと思います。 Web上でも利用しているというか使い方を説明している方が、<a target="_blank" rel="noopener" href="http://uroboros-xna.blogspot.jp/2011/10/xna.html">UROBOROS XNA様</a>くらいしかいなかったので、私が人柱有意義な情報提供を行える人物になろうと思います。 あ、他のソフトについては未定です。<strong>SmartAssembly</strong>の使用レポをしろ!等という意見は受け付けません(お財布の暖かさ的な理由で)</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2012-05-17</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/Microsoft/NET-Framework/" title=".NET Framework">.NET Framework </a><a class="tag" href="/categories/net-framework/" title="net-framework">net-framework </a><a class="tag" href="/categories/Microsoft/NET-Framework/C/" title="C#">C# </a><a class="tag" href="/categories/ソフトウェア紹介/" title="ソフトウェア紹介">ソフトウェア紹介 </a><a class="tag" href="/categories/net-framework/NETで○○○を試してみる/" title=".NETで○○○を試してみる">.NETで○○○を試してみる </a><a class="tag" href="/categories/netで○○○を試してみる/" title="netで○○○を試してみる">netで○○○を試してみる </a><a class="tag" href="/categories/net-framework/NETで○○○を試してみる/難読化/" title="難読化">難読化 </a><a class="tag" href="/categories/netで○○○を試してみる/NETで難読化を試してみる/" title=".NETで難読化を試してみる">.NETで難読化を試してみる </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2012/05/17/113/,A certain engineer &quot;COMPLEX&quot;,.NETで難読化を試してみる 第1回,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2012/05/20/119/" title=".NETで難読化を試してみる 第2回">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2012/05/13/206/" title="ReSharper 6.0 C# Edition Personal License 購入したよ(^q^)">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script></body></html>