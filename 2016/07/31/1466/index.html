<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>ディープラーニング Caffe for Windows その4 DIGITS · A certain engineer "COMPLEX"</title><meta name="description" content="前回はcuDNN 5.0を導入してみました。

What is DIGITS?DIGITSはNVIDIAが提供している、Caffeを利用した深層学習モデルの訓練のためのWebアプリです。 DIGITSは the Deep Learning GPU Training System の略とのこと。 Gi"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/blogcard.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li><li><a href="/guestbook">メッセージ</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>ディープラーニング Caffe for Windows その4 DIGITS</a></h3></div><div class="post-content"><p><a target="_blank" rel="noopener" href="http://wp.me/p7138e-ny">前回</a>はcuDNN 5.0を導入してみました。</p>
<a id="more"></a>
<h1 id="What-is-DIGITS"><a href="#What-is-DIGITS" class="headerlink" title="What is DIGITS?"></a>What is DIGITS?</h1><p><strong>DIGITS</strong>はNVIDIAが提供している、Caffeを利用した深層学習モデルの訓練のためのWebアプリです。 DIGITSは <strong>the Deep Learning GPU Training System</strong> の略とのこと。 Githubで開発が進められています。 </p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/NVIDIA/DIGITS" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/1728152?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">NVIDIA/DIGITS</div><div class="hbc-url">https://github.com/NVIDIA/DIGITS</div><div class="hbc-description">Deep Learning GPU Training System. Contribute to NVIDIA/DIGITS development by creating an account on GitHub.</div></div></div></div></a></div></div>

<p>これまで、CaffeがLinux環境での動作が前提でしたが、MicrosoftがCaffeのWindows版を提供し始めたことで風向きが変わりました。 前から、リッチなGUIで深層学習をしてみたくても、Windows環境は遅れていたため、涙をのんでいたのですが、そんな日々は終わりました。 <img src="../../../../public/2016/07/img_579b5b28588a2.png"></p>
<p>そんなDIGITSをWindowsに導入してみます。 ちなみに、DIGITS公式でもWindows版のCaffeに言及していますが、あっちがサポートしているのは、</p>
<h1 id="本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。"><a href="#本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。" class="headerlink" title="本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。"></a>本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。</h1><p>なので、今回は相当イレギュラーです。 といっても、イレギュラーなのは、少しだけですが。</p>
<h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><p>基本は、公式の<a target="_blank" rel="noopener" href="https://github.com/NVIDIA/DIGITS/blob/master/docs/BuildDigitsWindows.md">Windows向けdocs</a>に従います。 必要なものは下記の5つ。</p>
<p>Python2</p>
<p>CUDA 7.5</p>
<p>CuDNN 5.1</p>
<p>Caffe</p>
<p>Graphviz</p>
<p>Caffe for Windowsを導入しているなら、Miniconda2、CUDA、CuDNNが入っているので大丈夫でしょう。 バージョンが違うなら追加でインストールするだけです。 ちなみに、前回はCuDNNの5.0をインストールしましたが、DIGITSは5.1を要求します。 5.1は2016年7月末現在、RC (リリース候補版)です。 しかし、Microsoft版のCaffeを使ってると、別に5.0でもDIGITSは動きます。 (起動までは問題ないです。)</p>
<h1 id="Python2"><a href="#Python2" class="headerlink" title="Python2"></a>Python2</h1><p>Pythonそのものはもう入っていますが、いくつかの依存モジュールが必要です。 ですが、ここで注意するのは、ファイルからのモジュールの入手が必要になることです。 docsでは、下記のモジュールを<a target="_blank" rel="noopener" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Unofficial Windows Binaries for Python Extension Packages</a>からインストールするよう指示されます。 pythonが複数存在する場合、インストールしたい対象のpython.exeをフルパスで指定しましょう。 上述のurlからローカルにダウンロードしてインストールしてください。Python2.7なのでCP27の入っているパッケージが対象です。 管理者権限でインストールしましょう。念のため。 [code lang=”batch”] python -m pip install cython python -m pip install numpy-1.11.1+mkl-cp27-cp27m-win_amd64.whl python -m pip install scipy-0.18.0-cp27-cp27m-win_amd64.whl python -m pip install matplotlib-1.5.2-cp27-cp27m-win_amd64.whl python -m pip install scikit_image-0.12.3-cp27-cp27m-win_amd64.whl python -m pip install h5py-2.6.0-cp27-cp27m-win_amd64.whl [/code]</p>
<h1 id="CUDA-7-5"><a href="#CUDA-7-5" class="headerlink" title="CUDA 7.5"></a>CUDA 7.5</h1><p>もうインストール済みなので省略。</p>
<h1 id="CuDNN-5-1"><a href="#CuDNN-5-1" class="headerlink" title="CuDNN 5.1"></a>CuDNN 5.1</h1><p>例のごとくダウンロードします。 <strong>CommonSettings.props</strong>のPythonのサポートを有効にした後、<a target="_blank" rel="noopener" href="http://wp.me/p7138e-ny">前回</a>を参考に、5.1をダウンロードし、その展開先をCommonSettings.propsに設定します。</p>
<h1 id="Caffe"><a href="#Caffe" class="headerlink" title="Caffe"></a>Caffe</h1><p>ビルド自体はこれまでの記事を参考にすれば問題ないはずです。 今回は、ビルド前に、<strong>caffe\windows\caffe\caffe.vcxproj</strong>をテキストエディタで開き、58行目付近の [code lang=”xhtml”] <PostBuildEvent> <Command>“$(ScriptsDir)\FixGFlagsNaming.cmd” “$(OutDir)” $(Configuration)</Command> </PostBuildEvent> [/code] を下記のように変更します。 [code lang=”xhtml”] <PostBuildEvent> <Command>“$(ScriptsDir)\FixGFlagsNaming.cmd” “$(OutDir)” $(Configuration)</Command> </PostBuildEvent> <ClCompile> <PreprocessorDefinitions>NDEBUG;%(PreprocessorDefinitions);CAFFE_VERSION=1.0.0-rc3</PreprocessorDefinitions> </ClCompile> [/code] これで下準備は終わりです。</p>
<h3 id="これが最重要です。"><a href="#これが最重要です。" class="headerlink" title="これが最重要です。"></a>これが最重要です。</h3><p>そして、Caffeのビルドを成功させます。 ビルド完了後、<strong>\Build\x64\Release\pycaffe\caffe</strong> を <strong>\lib\site-packages</strong> にコピーします。 シンボリックリンクでもかまいません。 最後に、**&lt;caffe_root&gt;\Build\x64\Release<strong>を</strong>環境変数PATH**に追加します。 (追加しなくても、問題ないですが….)</p>
<h1 id="Graphviz"><a href="#Graphviz" class="headerlink" title="Graphviz"></a>Graphviz</h1><p><strong>Graphviz</strong>はグラフを描画するモジュールです。 下記公式サイトより、Windows版のパッケージを入手します </p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.graphviz.org/Download.php" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.graphviz.org"></img><div class="hbc-site-name">www.graphviz.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Redirecting…</div><div class="hbc-url">http://www.graphviz.org/Download.php</div></div></div></div></a></div></div>

<p>zipとmsi形式がありますが、お好きな方で。 zipで展開する場合は、<strong>環境変数PATH</strong>に <strong>&lt;Graphvizのインストール先&gt;\bin</strong> を追加します。 例えば、c:\graphviz-2.38に展開したなら、<strong>c:\graphviz-2.38\bin</strong> となるようにします。 msi版は知りません。</p>
<h1 id="DIGITS"><a href="#DIGITS" class="headerlink" title="DIGITS"></a>DIGITS</h1><p>ようやく本体です。 まず、公式githubよりクローンを実行し、フォルダに含まれる<strong>requirements.txt</strong>を編集します。 [code] Pillow&gt;=2.3.0,&lt;=3.1.2 numpy&gt;=1.8.1,&lt;=1.11.0 scipy&gt;=0.13.3,&lt;=0.17.0 protobuf&gt;=2.5.0,&lt;=2.6.1 six&gt;=1.5.2,&lt;=1.10.0 requests&gt;=2.2.1,&lt;=2.9.1 gevent&gt;=1.0,&lt;=1.0.2 Flask==0.10.1 Flask-WTF==0.11,&lt;=0.12 wtforms&gt;=2.0,&lt;=2.1 Flask-SocketIO==0.6.0 gunicorn==17.5 setuptools&gt;=3.3,&lt;=20.7.0 lmdb==0.87 h5py&gt;=2.2.1,&lt;=2.6.0 pydot==1.0.28 [/code] を [code] protobuf&gt;=2.5.0,&lt;=2.6.1 six&gt;=1.5.2,&lt;=1.10.0 requests&gt;=2.2.1,&lt;=2.9.1 gevent&gt;=1.0,&lt;=1.0.2 Flask==0.10.1 Flask-WTF==0.11,&lt;=0.12 wtforms&gt;=2.0,&lt;=2.1 Flask-SocketIO==0.6.0 gunicorn==17.5 setuptools&gt;=3.3,&lt;=20.7.0 lmdb==0.87 h5py&gt;=2.2.1,&lt;=2.6.0 pydot==1.0.28 [/code] に変更します。つまり先頭3行を除去します。 これは、後述のPILが動かなくなるなど、弊害があるようです。 次に、このファイルを利用して、下記のコマンドから依存モジュールのインストールを実行します。 当然管理者権限。gevent-1.1.2-cp27-cp27m-win_amd64.whlは前述のページから入手しておきます。 gevent-1.1.2-cp27-cp27m-win_amd64.whlは、<strong>この時に実行してください。</strong> [code lang=”batch”] python -m pip install -r requirements.txt python -m pip install gevent-1.1.2-cp27-cp27m-win_amd64.whl python -m pip install pyreadline [/code]</p>
<h1 id="DIGITSを実行"><a href="#DIGITSを実行" class="headerlink" title="DIGITSを実行"></a>DIGITSを実行</h1><p>DIGITSフォルダで下記のコマンドを実行します。 ここでもpython.exeはフルパスで指定することをおすすめします。 [code lang=”batch”] python digits-devserver [/code] もし、Caffeのビルド後、*<em>&lt;caffe_root&gt;\Build\x64\Release<strong>を</strong>環境変数PATH**に追加していないなら、下記のコマンドになります。 [code lang=”batch”] set PATH=%PATH%;&lt;caffe_root&gt;\Build\x64\Release python digits-devserver [/code] 実行後、下記のエラーが出る場合があります。 [code lang=”batch”] Traceback (most recent call last): File “digits-devserver”, line 31, in <module> from digits import config File “d:\Works\Lib\NVIDIA\DIGITS\digits\config\__init__.py”, line 7, in <module> from .current_config import config_value File “d:\Works\Lib\NVIDIA\DIGITS\digits\config\current_config.py”, line 4, in <module> from .caffe_option import CaffeOption File “d:\Works\Lib\NVIDIA\DIGITS\digits\config\caffe_option.py”, line 14, in <module> from digits.utils import parse_version File “d:\Works\Lib\NVIDIA\DIGITS\digits\utils\__init__.py”, line 158, in <module> from . import constants, image, time_filters, errors, forms, routing, auth File “d:\Works\Lib\NVIDIA\DIGITS\digits\utils\image.py”, line 15, in <module> import PIL.Image ImportError: No module named PIL.Image [/code] この場合は、PILが存在しないと言われているので、追加でインストールします。また先述のサイトから、モジュールをダウンロードしてきて下記のコマンドでインストールします。 [code lang=”batch”] python -m pip install Pillow-3.3.0-cp27-cp27m-win_amd64.whl [/code] 再度実行すればエラーが出ないはずです。 また、下記のメッセージが出る時があります。 [code lang=”batch”] Traceback (most recent call last): Default value for caffe_root “” invalid: Your Caffe does not have version info. Please upgrade it. ==================================== Caffe ===================================== Where is caffe installed?<br>Suggested values: (P\</em>) [PATH/PYTHONPATH] &gt;&gt; [/code] これは、Caffe.exeにバージョン情報が含まれていないため発生します。 ですので、caffeのビルド時に、プロジェクトファイルの編集を正しくできたかを確認してください。 ファイルのプロパティからはバージョン情報は確認できません。 成功すると [code lang=”batch”] Default value for torch_root “” invalid: torch binary not found in PATH Couldn’t import dot_parser, loading of dot files will not be possible. 2016-07-30 01:20:08 [INFO ] Loaded 0 jobs.<br>| \_ _/ __|_ _|_ _/ __| | |) | | (_ || | | | \__ \ |___/___\___|___| |_| |___/ 4.1-dev<br>* Running on <a target="_blank" rel="noopener" href="http://0.0.0.0:5000/">http://0.0.0.0:5000/</a> [/code] と表示されます。 <strong><a target="_blank" rel="noopener" href="http://localhost:5000/">http://localhost:5000</a></strong>でアクセスしてみると、動いていることが確認できます。 <img src="../../../../public/2016/07/img_579b8386b167f.png"></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>非公式ではありますが、Microsoft製CaffeでDIGITSを動かすことができました。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-07-31</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/e3-83-87-e3-82-a3-e3-83-bc-e3-83-97-e3-83-a9-e3-83-bc-e3-83-8b-e3-83-b3-e3-82-b0/" title="%e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0">%e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </a><a class="tag" href="/categories/Microsoft/Windows/" title="Windows">Windows </a><a class="tag" href="/categories/オープンソース/" title="オープンソース">オープンソース </a><a class="tag" href="/categories/e3-83-87-e3-82-a3-e3-83-bc-e3-83-97-e3-83-a9-e3-83-bc-e3-83-8b-e3-83-b3-e3-82-b0/Caffe/" title="Caffe">Caffe </a><a class="tag" href="/categories/ディープラーニング/" title="ディープラーニング">ディープラーニング </a><a class="tag" href="/categories/e3-83-87-e3-82-a3-e3-83-bc-e3-83-97-e3-83-a9-e3-83-bc-e3-83-8b-e3-83-b3-e3-82-b0/Caffe/DIGITS/" title="DIGITS">DIGITS </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2016/07/31/1466/,A certain engineer &quot;COMPLEX&quot;,ディープラーニング Caffe for Windows その4 DIGITS,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2016/08/01/1487/" title="開発メモ その7 CMakeでOpenCVを指定する方法">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2016/07/30/1460/" title="ディープラーニング Caffe for Windows その3 cuDNN 5.0対応">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script></body></html>