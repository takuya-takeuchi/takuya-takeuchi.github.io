<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>UWP メモ その2 HubSectionが思い通りに行かないので可変Gridで対応 · A certain engineer "COMPLEX"</title><meta name="description" content="UWP、面倒です。

ProblemHub というのがあります。 よくModernスタイルを紹介するときにグループ毎にタイルを並べて画面全体をスクロールできるやつ。そのグループがHubSection。 で、そのHunSectionですが、StackPanelを中に入れてOrientationをHor"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/hexo-tag-blog-card.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="search"><div class="text"><input placeholder="検索ワードを入力してください" id="search-text" onkeypress="javascript:search(event)"></div><div class="btn"><a><i class="fa fa-search"></i></a></div></div><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>UWP メモ その2 HubSectionが思い通りに行かないので可変Gridで対応</a></h3></div><div class="post-content"><p>UWP、面倒です。</p>
<a id="more"></a>
<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Hub</strong> というのがあります。 よくModernスタイルを紹介するときにグループ毎にタイルを並べて画面全体をスクロールできるやつ。そのグループが<strong>HubSection</strong>。 で、そのHunSectionですが、<strong>StackPanel</strong>を中に入れて<strong>Orientation</strong>を<strong>Horizontal</strong>にしても、中の子要素が横に並んでくれません。 HubSection自体の<strong>Width</strong>を未指定だろうが、明示的に指定しようが縦になってしまいます。 理由はよくわかりませんでした。 とにかく、仕様として</p>
<ol>
<li>グループ単位で可変数の子要素を横に並べる</li>
<li>グループ内ではスクロールバーは出さない</li>
</ol>
<p>を満たす必要がありました。</p>
<h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>解決策として、<strong>Grid</strong>を可変の子要素に対応させました。 といってもGridを継承するのではなく、UserControl上いGridを載せて、それを依存関係プロパティから操作する感じですが。</p>
<h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>ソースは下記です。 <a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/Demo/tree/master/UWP1">https://github.com/takuya-takeuchi/Demo/tree/master/UWP1</a> まず、可変対応のGrid。 [code lang=”csharp”] using System.Collections; using System.Collections.Generic; using Windows.UI.Xaml; using Windows.UI.Xaml.Controls;<br>// The User Control item template is documented at <a target="_blank" rel="noopener" href="http://go.microsoft.com/fwlink/?LinkId=234236">http://go.microsoft.com/fwlink/?LinkId=234236</a><br>namespace UWP2 { public sealed partial class VariableGrid : UserControl {<br>#region イベント #endregion<br>#region フィールド #endregion<br>#region コンストラクタ public VariableGrid() { this.InitializeComponent(); }<br>#endregion<br>#region プロパティ<br>public static readonly DependencyProperty GridLengthProperty = DependencyProperty.Register( “GridLength”, typeof(double), typeof(VariableGrid), new PropertyMetadata(default(double), GridLengthChanged));<br>public double GridLength { get { return (double)GetValue(GridLengthProperty); } set { SetValue(GridLengthProperty, value); } } private static void GridLengthChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>public static readonly DependencyProperty ItemsSourceProperty = DependencyProperty.Register( “ItemsSource”, typeof(object), typeof(VariableGrid), new PropertyMetadata(default(object), ItemsSourceChanged));<br>public object ItemsSource { get { return (object)GetValue(ItemsSourceProperty); } set { SetValue(ItemsSourceProperty, value); } }<br>private static void ItemsSourceChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>public static readonly DependencyProperty ItemTemplateProperty = DependencyProperty.Register( “ItemTemplate”, typeof(DataTemplate), typeof(VariableGrid), new PropertyMetadata(default(DataTemplate), ItemTemplateChanged));<br>public DataTemplate ItemTemplate { get { return (DataTemplate)GetValue(ItemTemplateProperty); } set { SetValue(ItemTemplateProperty, value); } }<br>private static void ItemTemplateChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>public static readonly DependencyProperty OrientationProperty = DependencyProperty.Register( “Orientation”, typeof(Orientation), typeof(VariableGrid), new PropertyMetadata(default(Orientation), OrientationChanged));<br>public Orientation Orientation { get { return (Orientation)GetValue(OrientationProperty); } set { SetValue(OrientationProperty, value); } }<br>private static void OrientationChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>#endregion<br>#region メソッド<br>#region プライベート<br>private void Update() { var grid = this._Grid;<br>grid.Children.Clear(); grid.RowDefinitions.Clear(); grid.ColumnDefinitions.Clear();<br>var items = this.ItemsSource as IEnumerable; if (items == null) return;<br>var itemTemplate = this.ItemTemplate; if (itemTemplate == null) return;<br>var rowColumn = 0; var gridLength = this.GridLength;<br>var children = new List<FrameworkElement>(); var orientation = this.Orientation; switch (orientation) { case Orientation.Vertical: foreach (var dataContext in items) { var child = itemTemplate.LoadContent() as FrameworkElement; if (child == null) continue;<br>child.DataContext = dataContext;<br>grid.RowDefinitions.Add(new RowDefinition { Height = new GridLength(gridLength) }); Grid.SetRow(child, rowColumn++);<br>children.Add(child); } break; case Orientation.Horizontal: foreach (var dataContext in items) { var child = itemTemplate.LoadContent() as FrameworkElement; if (child == null) continue;<br>child.DataContext = dataContext;<br>grid.ColumnDefinitions.Add(new ColumnDefinition { Width = new GridLength(gridLength) }); Grid.SetColumn(child, rowColumn++);<br>children.Add(child); } break; }<br>children.ForEach(grid.Children.Add); }<br>#endregion<br>#endregion } } [/code] <strong>GridLength</strong>で一つのセルの幅または高さを指定 <strong>Orientation</strong>でGridが並ぶ方向を指定 <strong>ItemsSource</strong>で並べたいオブジェクトのコレクションを指定 <strong>ItemTemplate</strong>で並べたオブジェクトの見た目のテンプレートを指定 というだけです。 使い方は下記。 [code lang=”xaml”] <Hub> <HubSection Header="1st"> <DataTemplate> &lt;local:VariableGrid GridLength=”400” ItemTemplate=”{StaticResource ItemTemplate}” ItemsSource=”{Binding Images}” Orientation=”Horizontal” /&gt; </DataTemplate> </HubSection> <HubSection Header="2nd"> <DataTemplate> &lt;local:VariableGrid GridLength=”400” ItemTemplate=”{StaticResource ItemTemplate}” ItemsSource=”{Binding Images}” Orientation=”Horizontal” /&gt; </DataTemplate> </HubSection> </Hub> [/code] これを使うとこんな感じになります。<br><a href="../../../../public/2016/04/3aae3db9c67f2d9cbe0292d83ce248f9.png"><img src="../../../../public/2016/04/3aae3db9c67f2d9cbe0292d83ce248f9-1024x626.png"></a></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まだどういうクラスがあって、適切な使い方が見えてこないので、こんなことしてますが、本当は正しいやり方があるような気がします。 面倒だなぁ</p>
<h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/Demo/tree/master/UWP1">https://github.com/takuya-takeuchi/Demo/tree/master/UWP1</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-04-02</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/Microsoft/NET-Framework/" title=".NET Framework">.NET Framework </a><a class="tag" href="/categories/Microsoft/NET-Framework/C/" title="C#">C# </a><a class="tag" href="/categories/Microsoft/NET-Framework/C/Universal-Windows-Platform/" title="Universal Windows Platform">Universal Windows Platform </a><a class="tag" href="/categories/Microsoft/NET-Framework/C/Universal-Windows-Platform/WinRT/" title="WinRT">WinRT </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2016/04/02/919/,A certain engineer &quot;COMPLEX&quot;,UWP メモ その2 HubSectionが思い通りに行かないので可変Gridで対応,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2016/04/02/931/" title=".NETで顔認識を試してみる Microsoft Cognitive Services Face編 第0回">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2016/03/26/806/" title="UWP メモ その1 EventTriggerBehaviorの制約">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/search.js"></script></body></html>