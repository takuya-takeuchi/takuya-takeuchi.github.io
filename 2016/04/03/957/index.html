<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>.NETで顔認識を試してみる Microsoft Cognitive Services Face編 第1回 · A certain engineer "COMPLEX"</title><meta name="description" content="前回は環境構築をしました。

SamleCognitive Servicesを使うにあたりサンプルがGithubで提供されています。 Codeplex？何ですか？それ？ FaceはAndroid、Python、Windows、iOSの4環境が用意されています。 WindowsはWPFです。 UWPを"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/hexo-tag-blog-card.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="search"><div class="text"><input placeholder="検索ワードを入力してください" id="search-text" onkeypress="javascript:search(event)"></div><div class="btn"><a><i class="fa fa-search"></i></a></div></div><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>.NETで顔認識を試してみる Microsoft Cognitive Services Face編 第1回</a></h3></div><div class="post-content"><p><a target="_blank" rel="noopener" href="http://wp.me/p7138e-f1">前回</a>は環境構築をしました。</p>
<a id="more"></a>
<h1 id="Samle"><a href="#Samle" class="headerlink" title="Samle"></a>Samle</h1><p>Cognitive Servicesを使うにあたりサンプルが<a target="_blank" rel="noopener" href="https://github.com/Microsoft/ProjectOxford-ClientSDK">Github</a>で提供されています。 <a target="_blank" rel="noopener" href="https://www.codeplex.com/">Codeplex</a>？何ですか？それ？ <a target="_blank" rel="noopener" href="https://github.com/Microsoft/ProjectOxford-ClientSDK/tree/master/Face">Face</a>はAndroid、Python、Windows、iOSの4環境が用意されています。 WindowsはWPFです。 <strong>UWP</strong>をプッシュしていたのにWPFとは…. iOSは<strong>Xcode</strong>でした。Xamarinではないのかよ…. <a target="_blank" rel="noopener" href="https://github.com/Microsoft/ProjectOxford-ClientSDK/tree/master/Face/Windows/ClientLibrary">ClientLibrary</a>があるので覗いてみると、どうやら既存のNugetで配布されている<a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Microsoft.ProjectOxford.Face/">Microsoft Project Oxford Face API</a>を参照している模様。 単純にRESTで要求しているだけのよう。 また、<a target="_blank" rel="noopener" href="https://github.com/Microsoft/ProjectOxford-ClientSDK/blob/master/Face/Windows/SampleScreenshots/SampleRunning.png">サンプル画像</a>を見ると、<strong>Detection</strong>、<strong>Find Similar</strong>、<strong>Grouping</strong>、<strong>Identification</strong>、<strong>Verification</strong>のサンプルがあるようです。 Identification、Verificationということは特徴抽出したデータが存在して、それをファイルにできる？ と思ったらそうではなく、Verificationは、登録した顔データをGuidで管理して、2つの顔が同一人物かどうかの判定し、Identificationはグループ群に指定したGuidの顔を探すだけのようです。 うーん、残念。</p>
<h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>WPFのサンプルをビルドして起動します。 <a href="../../../../public/2016/04/1-2.png"><img src="../../../../public/2016/04/1-2-1024x614.png" alt="スクリーンショット"></a></p>
<p>起動すると、<strong>Subscription Key</strong>の入力を求められますが、これは前回取得した<a target="_blank" rel="noopener" href="https://www.microsoft.com/cognitive-services/en-US/subscriptions">Microsoft Cognitive Services</a>のFaceにおける<strong>Key1</strong>または<strong>Key2</strong>になります。Showでキーをコピーして、TextBoxに貼り付けします。 <a href="../../../../public/2016/04/2-1.png"><img src="../../../../public/2016/04/2-1-1024x540.png" alt="スクリーンショット"></a></p>
<p>そしてSave Keyボタンを押下します。 ハードディスクにキーが保存されたことが通知されます。 保存先は<strong>System.IO.IsolatedStorage.IsolatedStorageFile</strong>を使っており分離ストレージ内でした。 <a href="../../../../public/2016/04/3-1.png"><img src="../../../../public/2016/04/3-1-300x180.png" alt="スクリーンショット"></a></p>
<p>その後、Face Detectionを選択しページを切り替えます。 Choose Imageとあるので、画像を選択します。 今回はLive情報マガジン ライブフリーク様より、<a target="_blank" rel="noopener" href="http://ticketcamp.net/live-blog/spitz-movie/">スピッツの画像</a>をお借りしました。 私は小学生からのスピッツの大ファンなので。ええ。 <a href="../../../../public/2016/04/4-1.png"><img src="../../../../public/2016/04/4-1-1024x614.png" alt="スクリーンショット"></a></p>
<p>きちんと、マサムネ、テツヤ、タムタムを認識し、テツヤがサングラスをつけていることも認識しています。 あと、検出した画像の表情も認識しています。以前話題になった。Emotion APIですね。 崎ちゃんは画像が小さすぎたのか検出できませんでした。 なお、年齢推測は全部だめです。2016年4月現在全員48歳なので、18-20ずれています。日本人は若く見えるからダメなのかな？ まぁ、この画像がいつ撮影されたのかがわかりませんが。 別の写真だと… <a href="../../../../public/2016/04/5-1.png"><img src="../../../../public/2016/04/5-1-1024x614.png" alt="スクリーンショット"></a></p>
<p>マサムネ33歳、テツヤ33歳、タムタム31歳、崎ちゃん40歳。 この画像は公式ファンクラブの壁紙なので割と最近のはず。でも最大17歳の差….</p>
<h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>ソースを見ましたが使い方は凄い簡単でした。 [code lang=”csharp”] using (var fileStream = File.OpenRead(SelectedFile)) { try { MainWindow mainWindow = Window.GetWindow(this) as MainWindow; string subscriptionKey = mainWindow._scenariosControl.SubscriptionKey;<br>var faceServiceClient = new FaceServiceClient(subscriptionKey); Contract.Face[] faces = await faceServiceClient.DetectAsync(fileStream, false, true, new FaceAttributeType[] { FaceAttributeType.Gender, FaceAttributeType.Age, FaceAttributeType.Smile, FaceAttributeType.Glasses }); [/code] 画像ファイルの<strong>FileStream</strong>を渡してあげるだけのお手軽さです。 なんということでしょう。</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>素晴らしいAPIがこんなにも簡単に使えるとは本当に素晴らしいです。Microsoft!!</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-04-03</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/Microsoft/NET-Framework/" title=".NET Framework">.NET Framework </a><a class="tag" href="/categories/net-framework/" title="net-framework">net-framework </a><a class="tag" href="/categories/net-framework/NETで○○○を試してみる/" title=".NETで○○○を試してみる">.NETで○○○を試してみる </a><a class="tag" href="/categories/サービス紹介/" title="サービス紹介">サービス紹介 </a><a class="tag" href="/categories/netで○○○を試してみる/" title="netで○○○を試してみる">netで○○○を試してみる </a><a class="tag" href="/categories/画像処理/" title="画像処理">画像処理 </a><a class="tag" href="/categories/Microsoft/NET-Framework/Azure/" title="Azure">Azure </a><a class="tag" href="/categories/Microsoft/NET-Framework/Azure/Cognitive-Services/" title="Cognitive Services">Cognitive Services </a><a class="tag" href="/categories/netで○○○を試してみる/NETで顔認識を試してみる/" title=".NETで顔認識を試してみる">.NETで顔認識を試してみる </a><a class="tag" href="/categories/画像処理/顔認識/" title="顔認識">顔認識 </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2016/04/03/957/,A certain engineer &quot;COMPLEX&quot;,.NETで顔認識を試してみる Microsoft Cognitive Services Face編 第1回,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2016/04/07/980/" title="UWPメモ その3 ネイティブオブジェクトをデバッグする">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2016/04/03/974/" title="WPF メモ その1 起動時にアプリがクラッシュする">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/search.js"></script></body></html>