<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><link rel="icon" href="/images/favicon.ico" type="image/x-icon"><title>Xamarinメモ その17 TabbedPageとNavigationPageの組み合わせ · A certain engineer "COMPLEX"</title><meta name="description" content="前回はAndroidのUnzipped Failedを解決しました。

Problem以前、TabbedPageについて記事を書きましたが、もう一つ重要なNavigationPageを組み合わせて見ます。ただ、NavigationPageとTabbedPageを組み合わす際、NavigationPa"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/blogcard.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="search"><div class="text"><input placeholder="検索ワードを入力してください" id="search-text" onkeypress="javascript:search(event)"></div><div class="btn"><a><i class="fa fa-search"></i></a></div></div><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Xamarinメモ その17 TabbedPageとNavigationPageの組み合わせ</a></h3></div><div class="post-content"><p><a target="_blank" rel="noopener" href="https://taktak.jp/2016/05/05/1229">前回</a>はAndroidのUnzipped Failedを解決しました。</p>
<a id="more"></a>
<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>以前、TabbedPageについて記事を書きましたが、もう一つ重要なNavigationPageを組み合わせて見ます。<br>ただ、NavigationPageとTabbedPageを組み合わす際、NavigationPageの子要素として、TabbedPageを加えるのはよくないとのこと。<br>三日月 ふゆの氏の記事。</p>


<p>元ネタ。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://msdn.microsoft.com/ja-jp/magazine/dn904669.aspx" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=msdn.microsoft.com"></img><div class="hbc-site-name">msdn.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">クロスプラットフォーム - Xamarin.Forms によるモバイル プラットフォーム間での UI コードの共有</div><div class="hbc-url">https://msdn.microsoft.com/ja-jp/magazine/dn904669.aspx</div></div></div></div></a></div></div>

<p>これを踏まえ、TabbedPageの下に、NavigationPage、NavigationPageの下に2つのContentPageというシンプルな実装を試しました。<br>ContentPageの最初でNextボタンがあり、それを押下すると、次のページにNavigationされる、というものです。<br>また、それぞれのPageにViewModelが紐付きます。つまり、4つのViewと4つのViewModelです。<br>そこまで大それたものではないはずです。</p>
<p>その実現のために、Webの各所を見ていきました。<br>下記は主に参考にさせていただいた記事です。</p>
<p>かずき氏の記事。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://blog.okazuki.jp/entry/2016/04/24/094141" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=blog.okazuki.jp"></img><div class="hbc-site-name">かずきのBlog@hatena</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/o/okazuki/20160423/20160423193303.png"></img></div><div class="hbc-text"><div class="hbc-title">Xamarin.Forms + Prism.Formsで画面遷移DeepDive - かずきのBlog@hatena</div><div class="hbc-url">http://blog.okazuki.jp/entry/2016/04/24/094141</div><div class="hbc-description">Prism.Formsは、地味にネストした画面遷移みたいなのをサポートしています。 画面遷移のINavigationService#Navigateメソッドに渡すURLに&quot;/HogePage/FugaPage/BarPage?id=10&quot;みたいに/で区切ってページ指定が出来ます。…</div></div></div></div></a></div></div> Prismの開発者の一人Brian Lagunas氏の記事。

<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://brianlagunas.com/prism-for-xamarin-forms-6-2-0-preview/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=brianlagunas.com"></img><div class="hbc-site-name">Brian Lagunas</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://brianlagunas.com/wp-content/uploads/2015/12/Prism-Logo-Graphic.jpg"></img></div><div class="hbc-text"><div class="hbc-title">Prism for Xamarin.Forms 6.2.0 Preview - Brian Lagunas</div><div class="hbc-url">http://brianlagunas.com/prism-for-xamarin-forms-6-2-0-preview/</div><div class="hbc-description">Learn what&#39;s new in Prism for Xamarin.Forms 6.2.0 Preview. Check out the all new navigation service features such as URI support and deep li…</div></div></div></div></a></div></div>

<p>で、いろいろ試行錯誤しましたが、実現できませんでした。<br>ページが遷移しない、クラッシュする、タブが出ないetcです。</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>逃げ口上ではないですが、注意事項です。</p>
<ul>
<li>Prism.Forms 6.1.0-pre4</li>
<li>Prism.Unity.Forms 6.2.0-pre4</li>
<li>Xamarin.Forms 2.2.0.31</li>
</ul>
<p>の環境の話です。<br>特に、Prism.Forms、Prism.Unity.Formsはプリリリース版なので、正式版では私が遭遇した問題は治っている可能性があります。</p>
<p>多分私の手法は間違っているだろうし、MVVMの観点からもよくないような気がします。<br>正しいやり方があると思いますが、動く方法が見つかったので、私は良しとしました。<br>動かないプロダクトよりも動くプロダクトのが何百倍も価値があります。</p>
<h3 id="UnityApplicationは使わない"><a href="#UnityApplicationは使わない" class="headerlink" title="UnityApplicationは使わない"></a>UnityApplicationは使わない</h3><p>まず、<strong>Prism.Unity.UnityApplication</strong>を継承して、Appを実装しますが、この方法は使いません。<br>なぜかというと、<strong>OnInitialized</strong>をオーバーライドし、NavigationSerice.Navigateメソッドで一番最初に表示するページを指示するのですが、TabbedPageを指示するとクラッシュします。ContentPageである、NavigationPageの子要素ならOKですが、そうすると、TabbedPageとNavigationPageが見えなくなります。</p>
<p>ですので、Obsoleteではありますが、<strong>Prism.Unity.UnityBootstrapper</strong>を継承したクラスを作成し、そのクラスのRunメソッドにAppクラスのインスタンスを渡す方法をとります。<br>これならば、<strong>CreateMainPage</strong>をオーバーライドする際に、TabbedPageを指定することができます。</p>
<h3 id="NavigationServiceは使わない"><a href="#NavigationServiceは使わない" class="headerlink" title="NavigationServiceは使わない"></a>NavigationServiceは使わない</h3><p>NavigationServiceのインスタンスには、明示的に指定しない限り、<strong>Prism.Unity.Navigation.UnityPageNavigationService</strong>が使われますが、無視します。<br>このクラスを使えば、本来はNavigationする際の、履歴を管理して、Backしたりできるはずなのですが、私にはどうやってもそれができませんでした。<br>ソースを見ると、UnityPageNavigationServiceのコンストラクタに、UnityContainerを渡しているのですが、途中でページの履歴の基準がMainPageになってしまっており、これによりNavigationがうまくいかなくなっているように見えます。ページは遷移するのですが、左上に本来は表示されるであろう直前のページへの遷移ボタンが表示されません。</p>
<p>以上を踏まえ今回のソースです。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin/08_Xamarin.Forms.Portable8" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://opengraph.githubassets.com/622966838567b83e52f757cfb4518bff0e3330704278024105c3aecab4639280/takuya-takeuchi/Demo"></img></div><div class="hbc-text"><div class="hbc-title">Demo/Xamarin/08_Xamarin.Forms.Portable8 at master · takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin/08_Xamarin.Forms.Portable8</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - Demo/Xamarin/08_Xamarin.Forms.Portable8 at master · takuya-takeuchi/Demo</div></div></div></div></a></div></div>

<h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h3 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h3><p>まず、ViewModelはすべて引数をとりません。またViewModelとViewの紐付けは<strong>ViewModelLocator.AutowireViewModel</strong>で実現しています。<br>TabbedPageとNavigationViewに対応するViewModelは空なので無視します。</p>
<p><strong>FirstPageViewModel.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Commands;</span><br><span class="line"><span class="keyword">using</span> Prism.Common;</span><br><span class="line"><span class="keyword">using</span> Prism.Mvvm;</span><br><span class="line"><span class="keyword">using</span> Xamarin.Forms.Portable8.Views;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Xamarin.Forms.Portable8.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">FirstPageViewModel</span> : <span class="title">BindableBase</span>, <span class="title">IPageAware</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Page Page</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> DelegateCommand _NextCommand;</span><br><span class="line">        <span class="keyword">public</span> DelegateCommand NextCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>._NextCommand == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">this</span>._NextCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">this</span>.Page.Navigation.PushAsync(<span class="keyword">new</span> NextPage());</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._NextCommand;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>NextPageViewModel.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Commands;</span><br><span class="line"><span class="keyword">using</span> Prism.Common;</span><br><span class="line"><span class="keyword">using</span> Prism.Mvvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Xamarin.Forms.Portable8.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">NextPageViewModel</span> : <span class="title">BindableBase</span>, <span class="title">IPageAware</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> Page Page</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> DelegateCommand _BackCommand;</span><br><span class="line">        <span class="keyword">public</span> DelegateCommand BackCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>._BackCommand == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">this</span>._BackCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">this</span>.Page.Navigation.PopAsync();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._BackCommand;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ポイントは<strong>Prism.Common.IPageAware</strong>の実装です。単純にPageプロパティを持つだけですが。<br>これによって、PageのNavigationプロパティにViewModelからアクセスできるようになり、PopAsyncとPushAsyncを呼び出せるようになります。<br>これでページの遷移が可能になります。</p>
<h3 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h3><p>正直、BindingContextを見て、挙動を変える方法はあまり好きではないですし、コードビハインドをいじるのも嫌なんですが…</p>
<p><strong>FirstPage.xaml.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Xamarin.Forms.Portable8.Views</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">FirstPage</span> : <span class="title">ContentPage</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FirstPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// BindingContext is updated before InitializeComponent</span></span><br><span class="line">            <span class="keyword">this</span>.BindingContextChanged += (sender, args) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> pageAware = <span class="keyword">this</span>.BindingContext <span class="keyword">as</span> IPageAware;</span><br><span class="line">                <span class="keyword">if</span> (pageAware != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    pageAware.Page = <span class="keyword">this</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NextPage.xaml.csも同じような感じです。<br>BindingContextChangeをサブスクライブして、BindingContextがIPageAwareを実装していたら、Pageプロパティに自分自身を設定します。<br>コメントにもありますが、なぜかInitializeComponentより前で、BindingContextが設定されていたので、苦肉の策でInitializeComponentの前でサブスクライブしてます。</p>
<p>Xamlですが、Main、つまりアプリ全体を表現する要のXamlだけ記載しておきます。他は単純なので…</p>
<p><strong>MainPage.xaml</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;TabbedPage x:Class&#x3D;&quot;Xamarin.Forms.Portable8.Views.MainPage&quot;</span><br><span class="line">            xmlns&#x3D;&quot;http:&#x2F;&#x2F;xamarin.com&#x2F;schemas&#x2F;2014&#x2F;forms&quot;</span><br><span class="line">            xmlns:x&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;winfx&#x2F;2009&#x2F;xaml&quot;</span><br><span class="line">            xmlns:mvvm&#x3D;&quot;clr-namespace:Prism.Mvvm;assembly&#x3D;Prism.Forms&quot;</span><br><span class="line">            xmlns:views&#x3D;&quot;clr-namespace:Xamarin.Forms.Portable8.Views;assembly&#x3D;Xamarin.Forms.Portable8&quot;</span><br><span class="line">            mvvm:ViewModelLocator.AutowireViewModel&#x3D;&quot;True&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TabbedPage.Padding&gt;</span><br><span class="line">        &lt;OnPlatform x:TypeArguments&#x3D;&quot;Thickness&quot;</span><br><span class="line">                    Android&#x3D;&quot;0&quot;</span><br><span class="line">                    WinPhone&#x3D;&quot;0&quot;</span><br><span class="line">                    iOS&#x3D;&quot;0, 20, 0, 0&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;TabbedPage.Padding&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TabbedPage.Children&gt;</span><br><span class="line">        &lt;views:NavigationPage Title&#x3D;&quot;Tab1&quot;&gt;</span><br><span class="line">            &lt;x:Arguments&gt;</span><br><span class="line">                &lt;views:FirstPage &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;x:Arguments&gt;</span><br><span class="line">        &lt;&#x2F;views:NavigationPage&gt;</span><br><span class="line">        &lt;views:NavigationPage Title&#x3D;&quot;Tab2&quot;&gt;</span><br><span class="line">            &lt;x:Arguments&gt;</span><br><span class="line">                &lt;views:FirstPage &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;x:Arguments&gt;</span><br><span class="line">        &lt;&#x2F;views:NavigationPage&gt;</span><br><span class="line">        &lt;views:NavigationPage Title&#x3D;&quot;Tab3&quot;&gt;</span><br><span class="line">            &lt;x:Arguments&gt;</span><br><span class="line">                &lt;views:FirstPage &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;x:Arguments&gt;</span><br><span class="line">        &lt;&#x2F;views:NavigationPage&gt;</span><br><span class="line">    &lt;&#x2F;TabbedPage.Children&gt;</span><br><span class="line">&lt;&#x2F;TabbedPage&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Startup"><a href="#Startup" class="headerlink" title="Startup"></a>Startup</h3><p>最後に、スタートアップ周りのコードです。<br>冒頭のObsolete等はここです。</p>
<p><strong>App.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Xamarin.Forms.Portable8</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> bootstrapper = <span class="keyword">new</span> Bootstrapper();</span><br><span class="line">            bootstrapper.Run(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnStart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// Handle when your app starts</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnSleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// Handle when your app sleeps</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnResume</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// Handle when your app resumes</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Bootstrapper.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Practices.Unity;</span><br><span class="line"><span class="keyword">using</span> Prism.Unity;</span><br><span class="line"><span class="keyword">using</span> Xamarin.Forms.Portable8.ViewModels;</span><br><span class="line"><span class="keyword">using</span> Xamarin.Forms.Portable8.Views;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Xamarin.Forms.Portable8</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">Bootstrapper</span> : <span class="title">UnityBootstrapper</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Obsolete</span>]</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> Xamarin.Forms.<span class="function">Page <span class="title">CreateMainPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.Container.Resolve();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// ViewModels</span></span><br><span class="line">            <span class="keyword">this</span>.Container.RegisterType();</span><br><span class="line">            <span class="keyword">this</span>.Container.RegisterType();</span><br><span class="line">            <span class="keyword">this</span>.Container.RegisterType();</span><br><span class="line">            <span class="keyword">this</span>.Container.RegisterType();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Views</span></span><br><span class="line">            <span class="comment">// Maybe, the following codes are meaningless because NavigationSerivce is not used.</span></span><br><span class="line">            <span class="comment">//this.Container.RegisterType();</span></span><br><span class="line">            <span class="comment">//this.Container.RegisterType();</span></span><br><span class="line">            <span class="comment">//this.Container.RegisterType();</span></span><br><span class="line">            <span class="comment">//this.Container.RegisterType();</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//this.Container.RegisterTypeForNavigation();</span></span><br><span class="line">            <span class="comment">//this.Container.RegisterTypeForNavigation();</span></span><br><span class="line">            <span class="comment">//this.Container.RegisterTypeForNavigation();</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// I guess it is meaningless.</span></span><br><span class="line">            <span class="comment">//this.NavigationService.Navigate(&quot;/NavigationPage/MainPage&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>コメントアウトした箇所は実行に影響がないので削除しました。</p>
<h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>動かしてみました。</p>
<h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p><a href="../../../../public/2016/05/i1-3.png"><img src="../../../../public/2016/05/i1-3-197x300.png" alt="Tab1のFirst page"></a><br>Tab1のFirst page</p>
<p><a href="../../../../public/2016/05/i2-2.png"><img src="../../../../public/2016/05/i2-2-197x300.png"></a><br>Tab1のNext page</p>
<p><a href="../../../../public/2016/05/i3-1.png"><img src="../../../../public/2016/05/i3-1-197x300.png"></a><br>Tab2のFirst page</p>
<h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p><a href="../../../../public/2016/05/3127e02ff1511185286456bc80f806f4.png"><img src="../../../../public/2016/05/3127e02ff1511185286456bc80f806f4-168x300.png" alt="Tab1のFirst page"></a><br>Tab1のFirst page</p>
<p><a href="../../../../public/2016/05/35a40365117b2d31c2681e1878827c73.png"><img src="../../../../public/2016/05/35a40365117b2d31c2681e1878827c73-168x300.png" alt="Tab1のNext page"></a><br>Tab1のNext page</p>
<p><a href="../../../../public/2016/05/2e052e332b7c66d373ed4a52f1bee2b7.png"><img src="../../../../public/2016/05/2e052e332b7c66d373ed4a52f1bee2b7-168x300.png" alt="Tab2のFirst page"></a><br>Tab2のFirst page</p>
<h4 id="UWP"><a href="#UWP" class="headerlink" title="UWP"></a>UWP</h4><p><a href="../../../../public/2016/05/w1-2.png"><img src="../../../../public/2016/05/w1-2-157x300.png"></a><br>Tab1のFirst page</p>
<p><a href="../../../../public/2016/05/w2-2.png"><img src="../../../../public/2016/05/w2-2-157x300.png" alt="Tab1のNext page"></a><br>Tab1のNext page</p>
<p><a href="../../../../public/2016/05/w3-1.png"><img src="../../../../public/2016/05/w3-1-157x300.png" alt="Tab2のFirst page"></a><br>Tab2のFirst page</p>
<p>きちんとタブごとに遷移している状態を覚えています。</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>かなり苦労しましたが、やりきった感じでいっぱいです。<br>間違っているようなやり方ですが、動けばいい、という方はいると思うので、だれかの役に立つでしょう。</p>
<h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin/08_Xamarin.Forms.Portable8">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin/08_Xamarin.Forms.Portable8</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-05-05</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/Xamarin/" title="Xamarin">Xamarin </a><a class="tag" href="/categories/NET-Framework/" title=".NET Framework">.NET Framework </a><a class="tag" href="/categories/NET-Framework/C/" title="C#">C# </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2016/05/05/1303/,A certain engineer &quot;COMPLEX&quot;,Xamarinメモ その17 TabbedPageとNavigationPageの組み合わせ,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2016/05/06/1338/" title="Xamarinメモ その18 Xamarin.Forms.ThemesをPrism.Unity.Formsと併用する場合の注意">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2016/05/05/1229/" title="Xamarinメモ その16 Unzipping failed">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/search.js"></script></body></html>