<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>開発メモ その168 Windowsコンテナを使ってみる · A certain engineer "COMPLEX"</title><meta name="description" content="Introduction開発中のOSSでWindows Server Coreへの対応についてのissueがあったので、調査がてら導入してみる。 Windows Server 2016を使います。 評価版で検証を行います。
How to下記の方が教えてくれました。 
QiitaWindows Ser"><meta name="keywords" content="极限博客,极限Blog,博客,极限"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>心之所愿，无事不成。<br> Nothing is impossible to a willing heart.</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/mrcore"><i class="fa fa-github"></i></a></li><li><a href="mailto:x@jixian.io"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY="><i class="fa fa-qq"></i></a></li><li><a target="_blank" rel="noopener" href="https://zhihu.com/people/"><i class="fa fa-mortar-board"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2017 - 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li><li><a href="/guestbook">メッセージ</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>開発メモ その168 Windowsコンテナを使ってみる</a></h3></div><div class="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>開発中のOSSでWindows Server Coreへの対応についてのissueがあったので、調査がてら導入してみる。 Windows Server 2016を使います。 評価版で検証を行います。</p>
<h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>下記の方が教えてくれました。 </p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qiita.com/anikundesu/items/f6e1561b8d99c6ee6156" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DWindows%2520Server%25202016%25E3%2581%25A7Windows%2520Server%25E3%2582%25B3%25E3%2583%25B3%25E3%2583%2586%25E3%2583%258A%25E3%2583%25BC%25E3%2582%2592%25E4%25BD%25BF%25E3%2581%2584%25E5%25A7%258B%25E3%2582%2581%25E3%2582%258B%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3D7bb5059e525dd7d2e855b10a2696669a&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540anikundesu%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3D1d1d55e60d5c29cd18ba11cb0df17b5d&blend-align=center%2Cmiddle&blend-mode=normal&s=47109e8d8d67c91da78576b75a76253b"></img></div><div class="hbc-text"><div class="hbc-title">Windows Server 2016でWindows Serverコンテナーを使い始める - Qiita</div><div class="hbc-url">https://qiita.com/anikundesu/items/f6e1561b8d99c6ee6156</div><div class="hbc-description">この記事は、「クラウド時代のシステム管理」の記事を転記したものです。
Windows Server 2016からDocker APIに対応した「Windows Serverコンテナー」と、より強固なプロセス分離機能を備えた「Hyper...</div></div></div></div></a></div></div>

<h2 id="Windowsの最新化"><a href="#Windowsの最新化" class="headerlink" title="Windowsの最新化"></a>Windowsの最新化</h2><p>全てのセキュリティパッチを含む更新を行います。</p>
<h2 id="コンテナの有効化"><a href="#コンテナの有効化" class="headerlink" title="コンテナの有効化"></a>コンテナの有効化</h2><p><strong>役割と機能の追加</strong>から<strong>コンテナ</strong>を有効化します。</p>
<h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p>管理者権限で<strong>PowerShell</strong>を起動。 場合によっては下記のように*Nuget**の更新が必要になりますが、その場合はYesと答え、もう一度コマンドを実行します。 [code lang=”ps”] &gt; Install-Module -Name DockerMsftProvider -Repository PSGallery –Force<br>NuGet provider is required to continue PowerShellGet requires NuGet provider version ‘2.8.5.201’ or newer to interact with NuGet-based repositories. The NuGet provider must be available in ‘C:\Program Files\PackageManagement\ProviderAssemblies’ or ‘C:\Users\Administrator\AppData\Local\PackageManagement\ProviderAssemblies’. You can also install the NuGet provider by running ‘Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force’. Do you want PowerShellGet to install and import the NuGet provider now? [Y] Yes [N] No [S] Suspend [?] Help (default is “Y”): Y &gt; Install-Module -Name DockerMsftProvider -Repository PSGallery –Force [/code] パッケージソースからのインストールを信頼するかどうかの確認。 Yesと答えます。 少し時間がかかりますが、待っているとインストールが完了します。 完了後、再起動します。 再起動後、dockerをインストールします。 [code lang=”ps”] PS C:\Users\Administrator&gt; Install-Package -Name docker -ProviderName DockerMsftProvider<br>The package(s) come(s) from a package source that is not marked as trusted. Are you sure you want to install software from ‘DockerDefault’? [Y] Yes [A] Yes to All [N] No [L] No to All [S] Suspend [?] Help (default is “N”): Y<br>Name Version Source Summary —- ——- —— ——- Docker 18.09.3 DockerDefault Contains Docker EE for use with Windows Server. [/code]</p>
<h2 id="確認"><a href="#確認" class="headerlink" title="確認"></a>確認</h2><p>[code lang=”ps”] &gt; docker version Client: Version: 18.09.3 API version: 1.39 Go version: go1.10.8 Git commit: 142dfcedca Built: 02/28/2019 06:33:17 OS/Arch: windows/amd64 Experimental: false<br>Server: Engine: Version: 18.09.3 API version: 1.39 (minimum version 1.24) Go version: go1.10.8 Git commit: 142dfcedca Built: 02/28/2019 06:31:15 OS/Arch: windows/amd64 Experimental: false [/code]</p>
<h2 id="実行"><a href="#実行" class="headerlink" title="実行"></a>実行</h2><h4 id="コードの用意"><a href="#コードの用意" class="headerlink" title="コードの用意"></a>コードの用意</h4><p>動かしたいサンプルは</p>
<ul>
<li>Windows Server Core 2016</li>
<li>dotnet core のコンソール</li>
</ul>
<p>となります。 コードは下記になります。 [code lang=”cs”] using System;<br>namespace Sample { class Program { static void Main(string[] args) { Console.WriteLine(System.Environment.OSVersion.Platform); } } } [/code] コンテナ内でソースを用意するのは面倒なので、あらかじめ用意しておいて、ビルド時にコピーするようにします。</p>
<h4 id="サンプル実行"><a href="#サンプル実行" class="headerlink" title="サンプル実行"></a>サンプル実行</h4><p>下記の<strong>Dockerfile</strong>を作成します。 [code lang=”docker”] FROM mcr.microsoft.com/windows/servercore:10.0.14393.2665<br>SHELL [“powershell”, “-Command”, “$ErrorActionPreference = ‘Stop’; $ProgressPreference = ‘SilentlyContinue’;”]<br># Install .NET Core SDK ENV DOTNET_SDK_VERSION 2.2.104<br>RUN Invoke-WebRequest -OutFile dotnet.zip <a target="_blank" rel="noopener" href="https://dotnetcli.blob.core.windows.net/dotnet/Sdk/$Env:DOTNET/_SDK/_VERSION/dotnet-sdk-$Env:DOTNET/_SDK/_VERSION-win-x64.zip">https://dotnetcli.blob.core.windows.net/dotnet/Sdk/$Env:DOTNET\_SDK\_VERSION/dotnet-sdk-$Env:DOTNET\_SDK\_VERSION-win-x64.zip</a>; \ $dotnet_sha512 = ‘2e73f64a7fdf0f9e03a58a1824375dab91cae658c1863d5130047064643a5c035db25251c443e9e0eded73ffe7b33ae6e1be4e16083da6122dfc1a7d6e2f1564’; \ if ((Get-FileHash dotnet.zip -Algorithm sha512).Hash -ne $dotnet_sha512) { \ Write-Host ‘CHECKSUM VERIFICATION FAILED!’; \ exit 1; \ }; \ \ Expand-Archive dotnet.zip -DestinationPath $Env:ProgramFiles\dotnet; \ Remove-Item -Force dotnet.zip<br>SHELL [“cmd”, “/S”, “/C”]<br>RUN [“C:/Program Files/dotnet/dotnet.exe”, “new”, “console”, “-n”, “Sample”] COPY [“Program.cs”, “c:/Sample”] WORKDIR Sample [/code] そして実行。 <strong>dotnet</strong>の初回起動時の復元処理に時間がかかります。 終わらなかったら、一度Ctrl+CでbuildをキャンセルするとOKです。 [code lang=”cmd”] $ docker build -t test . $ docker run -t test cmd &gt; “C:\Program Files\dotnet\dotnet.exe” run -c Release Win32NT [/code] 詳細なバージョン情報も表示してみます。 [code lang=”cmd”] powershell [System.Environment]::OSVersion<br>Platform ServicePack Version VersionString ——– ———– ——- ————- Win32NT 10.0.14393.0 Microsoft Windows NT 10.0.14393.0 [/code]</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-03-11</span><i class="fa fa-tag"></i><a class="tag" href="/categories/仮想化/" title="仮想化">仮想化 </a><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/仮想化/Docker/" title="Docker">Docker </a><a class="tag" href="/categories/Microsoft/Windows/" title="Windows">Windows </a><a class="tag" href="/categories/Microsoft/Windows/Windows-Server/" title="Windows Server">Windows Server </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2019/03/11/3982/,A certain engineer &quot;COMPLEX&quot;,開発メモ その168 Windowsコンテナを使ってみる,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/04/01/4007/" title="開発メモ その169 M2DetをUbuntu18.04で使ってみる(デモ編)">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/03/03/3967/" title="開発メモ その167 Raspberry Pi 3をWindows 10でエミュレートする">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script></body></html>