<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><link rel="icon" href="/images/favicon.ico" type="image/x-icon"><title>開発メモ その451 Snipe-IT を SSL 化する · A certain engineer "COMPLEX"</title><meta name="description" content="Introduction前回 の続き。
最近は自宅ネットワーク内であっても、SSL 化を実施し、セキュリティの強化及びノウハウの習得に努めている。つまり備忘録。
How to do?前提となる環境は

Ubuntu: 24.04 LTS
Snipe-IT: v8.2.1

1. 設定ファイルのバック"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/blogcard.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="search"><div class="text"><input placeholder="検索ワードを入力してください" id="search-text" onkeypress="javascript:search(event)"></div><div class="btn"><a><i class="fa fa-search"></i></a></div></div><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/apps">Apps</a></li><li><a href="/about">自己紹介</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>開発メモ その451 Snipe-IT を SSL 化する</a></h3></div><div class="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a target="_blank" rel="noopener" href="https://taktak.jp/2025/08/03/4555">前回</a> の続き。</p>
<p>最近は自宅ネットワーク内であっても、SSL 化を実施し、セキュリティの強化及びノウハウの習得に努めている。<br>つまり備忘録。</p>
<h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>前提となる環境は</p>
<ul>
<li>Ubuntu: 24.04 LTS</li>
<li>Snipe-IT: v8.2.1</li>
</ul>
<h3 id="1-設定ファイルのバックアップ"><a href="#1-設定ファイルのバックアップ" class="headerlink" title="1. 設定ファイルのバックアップ"></a>1. 設定ファイルのバックアップ</h3><p>Apache2 で動いていると思うので、設定ファイルをバックアップ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp /etc/apache2/sites-available/snipeit.conf /etc/apache2/sites-available/snipeit.conf.bak</span><br></pre></td></tr></table></figure>

<h3 id="2-証明書の用意"><a href="#2-証明書の用意" class="headerlink" title="2. 証明書の用意"></a>2. 証明書の用意</h3><p>まず、証明書と鍵を格納するディレクトリ (とログの出力先) を用意。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir  /etc/certs/</span><br><span class="line">sudo mkdir  /etc/private/</span><br><span class="line">sudo mkdir /var/<span class="built_in">log</span>/snipeit/</span><br></pre></td></tr></table></figure>

<p>続いて、</p>
<ul>
<li>証明書 (*.crt) を <code>/etc/certs/</code> にコピー</li>
<li>鍵 (*.key) を <code>/etc/certs/</code> にコピー</li>
</ul>
<p>します。<br>それぞれのファイル名は、わかりやすく SSL 化のために用意したドメイン名にしておきます。</p>
<p>ここでは <code>snipeit.taktak.com</code> とします。</p>
<h3 id="3-設定ファイルの編集"><a href="#3-設定ファイルの編集" class="headerlink" title="3. 設定ファイルの編集"></a>3. 設定ファイルの編集</h3><p>下記は初期状態の設定ファイル <code>/etc/apache2/sites-available/snipeit.conf</code>。<br>Snipe-IT の環境構築によっては異なる可能性がある点に注意。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">  <span class="section">&lt;Directory /var/www/html/snipeit/public&gt;</span></span><br><span class="line">      <span class="attribute"><span class="nomarkup">Allow</span></span> From <span class="literal">All</span></span><br><span class="line">      <span class="attribute">AllowOverride</span> <span class="literal">All</span></span><br><span class="line">      <span class="attribute"><span class="nomarkup">Options</span></span> -Indexes</span><br><span class="line">  <span class="section">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /var/www/html/snipeit/public</span><br><span class="line">  <span class="attribute"><span class="nomarkup">ServerName</span></span> snipeit.taktak.com</span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></table></figure>

<p>上記を下記のように変更。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">  <span class="attribute"><span class="nomarkup">ServerName</span></span> snipeit.taktak.com</span><br><span class="line">  <span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTPS&#125;</span> <span class="literal">off</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">RewriteRule</span></span> ^(.*)$ https://<span class="variable">%&#123;HTTP_HOST&#125;</span><span class="variable">%&#123;REQUEST_URI&#125;</span><span class="meta"> [R=301,L]</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:443</span>&gt;</span></span><br><span class="line">  <span class="attribute"><span class="nomarkup">ServerName</span></span> snipeit.taktak.com</span><br><span class="line">  <span class="attribute">CustomLog</span> /var/log/snipeit/snipeit_access.log combined</span><br><span class="line">  <span class="attribute">ErrorLog</span> /var/log/snipeit/snipeit_error.log</span><br><span class="line"></span><br><span class="line">  <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /var/www/html/snipeit/public</span><br><span class="line">  <span class="section">&lt;Directory /var/www/html/snipeit/public&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> -MultiViews</span><br><span class="line">    <span class="attribute">AllowOverride</span> <span class="literal">All</span></span><br><span class="line">    <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">  <span class="section">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">SSLEngine</span> <span class="literal">on</span></span><br><span class="line">    <span class="attribute">Protocols</span> h<span class="number">2</span> http/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line">    <span class="attribute">SSLCertificateFile</span> /etc/certs/snipeit.taktak.com.crt</span><br><span class="line">    <span class="attribute">SSLCertificateKeyFile</span> /etc/private/snipeit.taktak.com.key</span><br><span class="line">    <span class="comment"># SSLCACertificateFile /etc/certs/snipeit.taktak.com.CA.crt</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> always set Strict-Transport-Security <span class="string">&quot;max-age=63072000&quot;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> set X-Content-Type-Options <span class="string">&quot;nosniff&quot;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> always append X-Frame-Options <span class="string">&quot;SAMEORIGIN&quot;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> set X-XSS-Protection <span class="string">&quot;1; mode=block&quot;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">SSLProtocol</span>             <span class="literal">all</span> -SSLv<span class="number">3</span> -TLSv<span class="number">1</span> -TLSv<span class="number">1</span>.<span class="number">1</span> -TLSv<span class="number">1</span>.<span class="number">2</span></span><br><span class="line"><span class="attribute">SSLCipherSuite</span>          ECDHE-ECDSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span>:ECDHE-RSA-AES<span class="number">128</span>-GCM-SHA<span class="number">256</span>:ECDHE-ECDSA-AES<span class="number">256</span>-GCM-SHA<span class="number">384</span>:EC<span class="number">6</span>-GCM-SHA<span class="number">384</span></span><br><span class="line"><span class="attribute">SSLHonorCipherOrder</span>     <span class="literal">off</span></span><br><span class="line"><span class="attribute">SSLSessionTickets</span>       <span class="literal">off</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">SSLUseStapling</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">SSLStaplingCache</span> <span class="string">&quot;shmcb:logs/ssl_stapling(32768)&quot;</span></span><br></pre></td></tr></table></figure>

<p>そして、<code>/var/www/html/snipeit/.env</code> を変更。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># --------------------------------------------</span><br><span class="line"># REQUIRED: BASIC APP SETTINGS</span><br><span class="line"># --------------------------------------------</span><br><span class="line"><span class="deletion">- APP_URL=http://esxi-vm07</span></span><br><span class="line"><span class="addition">+ APP_URL=http://snipeit.taktak.com</span></span><br></pre></td></tr></table></figure>

<p><code>APP_URL</code> は <code>https</code> である必要はなく <code>http://&lt;FQDN&gt;</code> であれば OK。</p>
<h3 id="4-モジュールの追加と再起動"><a href="#4-モジュールの追加と再起動" class="headerlink" title="4. モジュールの追加と再起動"></a>4. モジュールの追加と再起動</h3><p>SSL に必要なモジュールの追加、設定ファイルの構文チェックなどを実施し、Apache を再起動。</p>
<pre><code class="bash">sudo a2ensite snipeit.conf
sudo a2enmod ssl
sudo a2enmod headers
sudo apache2ctl configtest
sudo systemctl restart apache2</code></pre>
<p>以上で無事に SSL 化されました。</p>
<p><a href="../../../../public/2025/08/03/4556/image.png"><img src="../../../../public/2025/08/03/4556/image.png" alt="Snipe-IT"></a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2025-08-03</span><i class="fa fa-tag"></i><a class="tag" href="/categories/IT資産管理/" title="IT資産管理">IT資産管理 </a><a class="tag" href="/categories/IT資産管理/Snipe-IT/" title="Snipe-IT">Snipe-IT </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2025/08/03/4556/,A certain engineer &quot;COMPLEX&quot;,開発メモ その451 Snipe-IT を SSL 化する,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2025/08/03/4555/" title="開発メモ その450 Snipe-IT v5.4.4 on Ubuntu 20.04 を v8.2.1 on Ubuntu 24.04 にマイグレーションする">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/search.js"></script></body></html>