<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><link rel="icon" href="/images/favicon.ico" type="image/x-icon"><title>開発メモ その247 Windows App SDK ことはじめ 1 空のアプリ実行 · A certain engineer "COMPLEX"</title><meta name="description" content="IntroductionWindows App SDKを使い始めたい。UWPはお察しの通り、もうMicrosoftの投資対象になるテクノロジーではないので。
できれば、WPFをベースにして、そこにモダンなテクノロジーを混ぜていきたい。それができるのがどうか、手を動かしてみる。
Get Started"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/blogcard.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="search"><div class="text"><input placeholder="検索ワードを入力してください" id="search-text" onkeypress="javascript:search(event)"></div><div class="btn"><a><i class="fa fa-search"></i></a></div></div><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>開発メモ その247 Windows App SDK ことはじめ 1 空のアプリ実行</a></h3></div><div class="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Windows App SDKを使い始めたい。<br>UWPはお察しの通り、もうMicrosoftの投資対象になるテクノロジーではないので。</p>
<p>できれば、WPFをベースにして、そこにモダンなテクノロジーを混ぜていきたい。<br>それができるのがどうか、手を動かしてみる。</p>
<h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><h2 id="Windows-App-SDK-を使えるようにする"><a href="#Windows-App-SDK-を使えるようにする" class="headerlink" title="Windows App SDK を使えるようにする"></a>Windows App SDK を使えるようにする</h2><p>2022/01/31時点で、Windows App SDKは1.0がStable。<br>この辺りは <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/apps/windows-app-sdk/stable-channel">Stable channel release notes for the Windows App SDK</a> を参照。<br>日本語訳は分かりにくいのでお勧めしない。</p>
<p>Visual Studio で開発を始めるにあたり、<strong>Visual Studio extension</strong> をインストールする必要がある。<br>上のページからダウンロード。<br>C#とC++の拡張機能があるのでお好みで。</p>
<p>下記はC#の拡張機能。</p>
<p><a href="../../../../public/2022/01/31/4406/01.png"><img src="../../../../public/2022/01/31/4406/01.png" alt="extension" title="extension"></a></p>
<p><a href="../../../../public/2022/01/31/4406/02.png"><img src="../../../../public/2022/01/31/4406/02.png" alt="extension" title="extension"></a></p>
<p><a href="../../../../public/2022/01/31/4406/03.png"><img src="../../../../public/2022/01/31/4406/03.png" alt="extension" title="extension"></a></p>
<p>Visual Studioに関係するプロセスが起動していると終了してほしい旨が出るので、終了させる。</p>
<p><a href="../../../../public/2022/01/31/4406/04.png"><img src="../../../../public/2022/01/31/4406/04.png" alt="extension" title="extension"></a></p>
<p><a href="../../../../public/2022/01/31/4406/05.png"><img src="../../../../public/2022/01/31/4406/05.png" alt="extension" title="extension"></a></p>
<h2 id="exe-で配布したい"><a href="#exe-で配布したい" class="headerlink" title="exe で配布したい"></a>exe で配布したい</h2><p>誰もかれもがMicrosoft Store経由でアプリを配布したいわけじゃない。<br>このあたりの開発者の事情をくみ取れなかったからUWPは受けいれられなかった。</p>
<p>で、従来の方法 (非パッケージ アプリ呼称) で配布するには、インストール先にSDKをインストールする必要がある模様。<br>これも上の <strong>The .exe installer, and MSIX packages</strong> というリンクから入手できる。</p>
<p>とりあえず、これは後回し。<br>アプリを作って、exe形式になっていることを確認できないと意味がないので。</p>
<h2 id="プロジェクト作成"><a href="#プロジェクト作成" class="headerlink" title="プロジェクト作成"></a>プロジェクト作成</h2><p>拡張機能インストール後、Visual Studioの新規作成ダイアログに <strong>WinUI 3</strong> のテンプレートが追加されている。</p>
<p><a href="../../../../public/2022/01/31/4406/06.png"><img src="../../../../public/2022/01/31/4406/06.png" alt="extension" title="extension"></a></p>
<ol>
<li>クラスライブラリ (デスクトップの WinUI 3)</li>
<li>空のアプリ、パッケージ化 (デスクトップの WinUI 3)</li>
<li>空白のアプリ、Windows アプリケーション パッケージ プロジェクトでパッケージ化 (デスクトップの WinUI 3)</li>
</ol>
<p>…下2つを見て意味が分かる人います?</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/apps/winui/winui3/create-your-first-winui3-app?pivots=winui3-packaged-csharp">Create a WinUI 3 app</a> を見て、なんとなく理解するが、前者はMSIXでパッケージ化するための設定が一つにまとまっていて、後者はその設定が別のプロジェクトになっているという意味。</p>
<p><a href="../../../../public/2022/01/31/4406/07.png"><img src="../../../../public/2022/01/31/4406/07.png" alt="extension" title="extension"></a></p>
<p>左が <strong>2.**、右が **3.</strong></p>
<h2 id="とりあえず動かしてみる"><a href="#とりあえず動かしてみる" class="headerlink" title="とりあえず動かしてみる"></a>とりあえず動かしてみる</h2><h3 id="空のアプリ、パッケージ化"><a href="#空のアプリ、パッケージ化" class="headerlink" title="空のアプリ、パッケージ化"></a>空のアプリ、パッケージ化</h3><p><a href="../../../../public/2022/01/31/4406/08.png"><img src="../../../../public/2022/01/31/4406/08.png" alt="extension" title="extension"></a></p>
<p>期待通りの結果。</p>
<p><a href="../../../../public/2022/01/31/4406/09.png"><img src="../../../../public/2022/01/31/4406/09.png" alt="extension" title="extension"></a></p>
<p>勝手に配置されるのもUWPと一緒。</p>
<h3 id="空白のアプリ、Windows-アプリケーション-パッケージ-プロジェクトでパッケージ化"><a href="#空白のアプリ、Windows-アプリケーション-パッケージ-プロジェクトでパッケージ化" class="headerlink" title="空白のアプリ、Windows アプリケーション パッケージ プロジェクトでパッケージ化"></a>空白のアプリ、Windows アプリケーション パッケージ プロジェクトでパッケージ化</h3><p><a href="../../../../public/2022/01/31/4406/10.png"><img src="../../../../public/2022/01/31/4406/10.png" alt="extension" title="extension"></a></p>
<p>スタートアップ プロジェクトを <strong>Package ではないほう</strong> にしてデバッグ実行したらクラッシュ。</p>
<p><a href="../../../../public/2022/01/31/4406/08.png"><img src="../../../../public/2022/01/31/4406/08.png" alt="extension" title="extension"></a></p>
<p>Packageのほうを起動したら、期待通りの結果。</p>
<p><a href="../../../../public/2022/01/31/4406/11.png"><img src="../../../../public/2022/01/31/4406/11.png" alt="extension" title="extension"></a></p>
<p>勝手に配置された。</p>
<h2 id="exe-ができてる"><a href="#exe-ができてる" class="headerlink" title="exe ができてる"></a>exe ができてる</h2><p>後者の <strong>空白のアプリ、Windows アプリケーション パッケージ プロジェクトでパッケージ化</strong> の Package ではないプロジェクト側のbinを見ると、exeができていた。</p>
<p><a href="../../../../public/2022/01/31/4406/12.png"><img src="../../../../public/2022/01/31/4406/12.png" alt="extension" title="extension"></a></p>
<p>上のMicrosoftの説明通り、Packageプロジェクトを介することでパッケージされるということで、Packageではないほう、つまりプログラム側はデスクトップアプリなのだろう。</p>
<p>では、なぜクラッシュしたのか？という答えが、先に書いた <strong>The .exe installer, and MSIX packages</strong> なのだろうと思ってインストールしたが変わらず。</p>
<p>やっぱり後回し。</p>
<h2 id="コードの実体は？"><a href="#コードの実体は？" class="headerlink" title="コードの実体は？"></a>コードの実体は？</h2><p>UWPに近い構成で</p>
<ul>
<li>app.manifest</li>
<li>App.xaml</li>
<li>App.xaml.cs</li>
<li>MainWindow.xaml</li>
<li>MainWindow.xaml.cs</li>
</ul>
<p>となっている。</p>
<h3 id="App-xaml-cs"><a href="#App-xaml-cs" class="headerlink" title="App.xaml.cs"></a>App.xaml.cs</h3><p>素直な感じがする。<br>依存関係の注入はここからやればいいかな?</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Provides application-specific behavior to supplement the default Application class.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Initializes the singleton application object.  This is the first line of authored code</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> executed, and as such is the logical equivalent of main() or WinMain().</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Invoked when the application is launched normally by the end user.  Other entry points</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> will be used such as when the application is launched to open a specific file.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;args&quot;&gt;</span>Details about the launch request and process.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnLaunched</span>(<span class="params">Microsoft.UI.Xaml.LaunchActivatedEventArgs args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_window = <span class="keyword">new</span> MainWindow();</span><br><span class="line">            m_window.Activate();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Window m_window;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MainWindow-xaml"><a href="#MainWindow-xaml" class="headerlink" title="MainWindow.xaml"></a>MainWindow.xaml</h3><p>特に言うことは無い。<br>Window周りでどれだけ細かい制御ができるかが肝。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window</span><br><span class="line">    x:Class&#x3D;&quot;App2.MainWindow&quot;</span><br><span class="line">    xmlns&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;winfx&#x2F;2006&#x2F;xaml&#x2F;presentation&quot;</span><br><span class="line">    xmlns:x&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;winfx&#x2F;2006&#x2F;xaml&quot;</span><br><span class="line">    xmlns:local&#x3D;&quot;using:App2&quot;</span><br><span class="line">    xmlns:d&#x3D;&quot;http:&#x2F;&#x2F;schemas.microsoft.com&#x2F;expression&#x2F;blend&#x2F;2008&quot;</span><br><span class="line">    xmlns:mc&#x3D;&quot;http:&#x2F;&#x2F;schemas.openxmlformats.org&#x2F;markup-compatibility&#x2F;2006&quot;</span><br><span class="line">    mc:Ignorable&#x3D;&quot;d&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;StackPanel Orientation&#x3D;&quot;Horizontal&quot; HorizontalAlignment&#x3D;&quot;Center&quot; VerticalAlignment&#x3D;&quot;Center&quot;&gt;</span><br><span class="line">        &lt;Button x:Name&#x3D;&quot;myButton&quot; Click&#x3D;&quot;myButton_Click&quot;&gt;Click Me&lt;&#x2F;Button&gt;</span><br><span class="line">    &lt;&#x2F;StackPanel&gt;</span><br><span class="line">&lt;&#x2F;Window&gt;</span><br></pre></td></tr></table></figure>


<h3 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h3><p>まずは軽く動かしてみた。<br>いろいろ気になる点はあるけど、少しずつ調べていく。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-01-31</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/Microsoft/Windows-App-SDK/" title="Windows App SDK">Windows App SDK </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2022/01/31/4406/,A certain engineer &quot;COMPLEX&quot;,開発メモ その247 Windows App SDK ことはじめ 1 空のアプリ実行,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2022/01/31/4407/" title="開発メモ その248 Windows App SDK ことはじめ 2 EXE実行">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2021/11/27/4405/" title="開発メモ その246 Windows 11 をクリーンインストール後起動できない その2">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/search.js"></script></body></html>