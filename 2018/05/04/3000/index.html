<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>.NETで機械学習を試してみる LibLinear.Net編 第1回 · A certain engineer "COMPLEX"</title><meta name="description" content="Introduction以前、LIBSVMという台湾生まれのSVMライブラリのC#ラッパーを作成しました。 今回、同じ台湾生まれのLIVLINEARのC#ラッパーLibLinear.Netを作成しました。 
GitHubtakuya-takeuchi/LibLinearDotNethttps://g"><meta name="keywords" content="极限博客,极限Blog,博客,极限"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>心之所愿，无事不成。<br> Nothing is impossible to a willing heart.</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/mrcore"><i class="fa fa-github"></i></a></li><li><a href="mailto:x@jixian.io"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY="><i class="fa fa-qq"></i></a></li><li><a target="_blank" rel="noopener" href="https://zhihu.com/people/"><i class="fa fa-mortar-board"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2017 - 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li><li><a href="/guestbook">メッセージ</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>.NETで機械学習を試してみる LibLinear.Net編 第1回</a></h3></div><div class="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>以前、<strong>LIBSVM</strong>という台湾生まれのSVMライブラリのC#ラッパーを作成しました。 今回、同じ台湾生まれの<strong>LIVLINEAR</strong>のC#ラッパー<strong>LibLinear.Net</strong>を作成しました。 </p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/LibLinearDotNet" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/LibLinearDotNet</div><div class="hbc-url">https://github.com/takuya-takeuchi/LibLinearDotNet</div><div class="hbc-description">.NET wrapper for LIBLINEAR written in C#. Contribute to takuya-takeuchi/LibLinearDotNet development by creating an account on GitHub.</div></div></div></div></a></div></div>

<p>LIVLINEARのライブラリも.NETラッパーは少ない感じです。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/aardvark-platform/aardvark.semantictextonforests">libsvm.clr</a><ul>
<li>C++/CLIでLIBLINEARを再ビルドして.NETから呼べるようにしています。</li>
</ul>
</li>
</ul>
<p>めぼしいのはこれ位でした。 LibSvm.Netと同じく、</p>
<ul>
<li>XMLコメントほぼ全て英語と日本語で実装していますので、IntelliSenseがバリバリ</li>
<li>100%C#の.NETStandard準拠</li>
<li>Linuxで動く</li>
</ul>
<p>そして、前回と同じサンプルをLibLinear.Netで実装したものを持ってきました。 </p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/LibLinearDotNet</div><div class="hbc-url">https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits</div><div class="hbc-description">.NET wrapper for LIBLINEAR written in C#. Contribute to takuya-takeuchi/LibLinearDotNet development by creating an account on GitHub.</div></div></div></div></a></div></div>

<h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>LibSvm.Netを使うには下記の作業が必要です。</p>
<p>1. NugetからLibLinear.Netのインストール</p>
<p>2. LIBLINEARのソースをダウンロード</p>
<p>3. LIBLINEARのソースをビルド</p>
<p>ちょっと面倒ですが、どれも手順はしっかりしています。 LIBLINEARのビルド手順はLibLinear.Netの<a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/LibLinearDotNet/wiki/Tutorial-for-Windows">Wikiでも説明しています</a>ので参考にしてください。</p>
<h1 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h1><p>[code lang=”csharp”] using System; using System.Diagnostics; using System.Linq; using LibLinearDotNet; using Microsoft.Extensions.CommandLineUtils;<br>namespace Pendigits {<br>internal class Program {<br>private static void Main(string[] args) { var app = new CommandLineApplication(false); app.Name = nameof(Pendigits); app.Description = “The exsample program for pendigits”; app.HelpOption(“-h|–help”);<br>var quietArgument = app.Argument(“quiet”, “Suppress output of LIBLINEAR”); var outputOption = app.Option(“-o|–output”, “output path for trained model”, CommandOptionType.SingleValue); var solverOption = app.Option(“-s|–solver”, “solver”, CommandOptionType.SingleValue); var biasOption = app.Option(“-b|–bias”, “bias”, CommandOptionType.SingleValue);<br>app.OnExecute(() =&gt; { if (quietArgument.Value != null) LibLinear.SetPrintFunction(null);<br>var biasStr = “-1”; if (biasOption.HasValue()) biasStr = biasOption.Value();<br>if (!double.TryParse(biasStr, out var bias)) { app.ShowHelp(); return -1; }<br>var solverStr = “1”; if (solverOption.HasValue()) solverStr = solverOption.Value();<br>if (!int.TryParse(solverStr, out var solver)) { app.ShowHelp(); return -1; }<br>if (Enum.GetValues(typeof(SolverType)).Cast<int>().All(s =&gt; s != solver)) { app.ShowHelp(); return -1; }<br>var sol = (SolverType)solver;<br>double eps = 0; switch (sol) { case SolverType.L2RegularizedLogisticRegression: case SolverType.L2RegularizedL2LossSupportVectorClassification: eps = 0.01; break; case SolverType.L2RegularizedL2LossSupportVectorRegression: eps = 0.001; break; case SolverType.L2RegularizedL2LossSupportVectorClassificationDual: case SolverType.L2RegularizedL1LossSupportVectorClassificationDual: case SolverType.MulticlassSupportVectorMachineCrammerSinger: case SolverType.L2RegularizedLogisticRegressionDual: eps = 0.1; break; case SolverType.L1RegularizedL2LossSupportVectorClassification: case SolverType.L1RegularizedLogisticRegression: eps = 0.01; break; case SolverType.L2RegularizedL2LossSupportVectorRegressionDual: case SolverType.L2RegularizedL1LossSupportVectorRegressionDual: eps = 0.1; break; }<br>var output = outputOption.Value();<br>// Load training data and test data set using (var train = Problem.FromFile(“pendigits”, bias)) using (var test = Problem.FromFile(“pendigits.t”, bias)) { // Configure parameter var param = new Parameter { SolverType = sol, C = 1d, Epsilon = eps, P = 0.1, WeightLabel = new int[0], Weight = new double[0] };<br>var message = LibLinear.CheckParameter(train, param); if (!string.IsNullOrWhiteSpace(message)) { Console.WriteLine($”Error: {message} for train problem”); return -1; }<br>// Train training data var sw = new Stopwatch(); sw.Start(); using (var model = LibLinear.Train(train, param)) { sw.Stop();<br>if (!string.IsNullOrWhiteSpace(output)) Model.Save(output, model);<br>var correct = 0; var total = 0; var x = test.X; var y = test.Y;<br>double error = 0; double sump = 0; double sumt = 0; double sumpp = 0; double sumtt = 0; double sumpt = 0;<br>for (var i = 0; i &lt; test.Length; i++) { // Get vector from test data var array = x[i];<br>// Get classification result (returns label) var target = y[i]; var predict = LibLinear.Predict(model, array); if (Math.Abs(predict - target) &lt; double.Epsilon) correct++;<br>error += (predict - target) * (predict - target); sump += predict; sumt += target; sumpp += predict * predict; sumtt += target * target; sumpt += predict * target;<br>total++; }<br>if (model.IsRegressionModel) { var mse = error / total; var scc = (total * sumpt - sump * sumt) * (total * sumpt - sump * sumt) / ((total * sumpp - sump * sump) * (total * sumtt - sumt * sumt)); Console.WriteLine($”Mean squared error: {mse:f5}%, Squared correlation coefficient: {scc:f6}, Elapsed: {sw.ElapsedMilliseconds}ms”); } else { var accuracy = correct / (double)total * 100; Console.WriteLine($”Accuracy: {accuracy:f4}% ({correct}/{total}), Elapsed: {sw.ElapsedMilliseconds}ms”); } } }<br>return 0; });<br>app.Execute(args); }<br>}<br>}[/code] このサンプルは、訓練データとテストデータの分類または回帰を実行します。 実行のために、</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits">https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits</a></li>
<li><a target="_blank" rel="noopener" href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits.t">https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits.t</a></li>
</ul>
<p>をダウンロードします。 これは手書き数字のデータセットです。MNISTと似ているのかな? 引数として、</p>
<ul>
<li>ソルバー (オプション)<ul>
<li>例: -s=4</li>
</ul>
</li>
<li>バイアス (オプション)<ul>
<li>例: -b=3</li>
</ul>
</li>
<li>学習済みファイルの出力先 (オプション)<ul>
<li>例: -o=trained.model</li>
</ul>
</li>
</ul>
<p>を指定できます。 分類と回帰によって実行結果が異なります。</p>
<h2 id="分類"><a href="#分類" class="headerlink" title="分類"></a>分類</h2><p>[code lang=”batch”] D:\Works\OpenSource\LibSvmDotNet\example\Pendigits&gt; dotnet run -c Release optimization finished, #iter = 1000<br>WARNING: reaching max number of iterations Using -s 2 may be faster (also see FAQ)<br>Objective value = -10.592368 nSV = 1404 * . . . WARNING: reaching max number of iterations Using -s 2 may be faster (also see FAQ)<br>Objective value = -3.640437 nSV = 592 Accuracy: 79.7027% (2788/3498), Elapsed: 1737ms [/code]</p>
<h2 id="回帰"><a href="#回帰" class="headerlink" title="回帰"></a>回帰</h2><p>[code lang=”batch”] D:\Works\OpenSource\LibSvmDotNet\example\Pendigits&gt; dotnet run -c Release “-s=11” iter 1 act 1.445e+05 pre 1.623e+05 delta 1.690e+01 f 2.026e+05 |g| 1.405e+07 CG 1 cg reaches trust region boundary iter 2 act 1.430e+04 pre 1.418e+04 delta 6.758e+01 f 5.808e+04 |g| 1.746e+06 CG 2 iter 3 act 5.313e+03 pre 5.281e+03 delta 6.758e+01 f 4.378e+04 |g| 2.849e+05 CG 9 iter 4 act 6.203e+01 pre 6.202e+01 delta 6.758e+01 f 3.847e+04 |g| 2.140e+04 CG 11 Mean squared error: 6.60231%, Squared correlation coefficient: 0.215259, Elapsed: 13ms [/code]</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>またも、正直車輪の再発明な気がしないでもないですが… LibLinearのメリットは、大規模データに対してLibSvmよりも高速に実行できるところがウリのようです。 このあたりの高速性も紹介していきたいです。</p>
<h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits">https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-05-04</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/Microsoft/NET/" title=".NET">.NET </a><a class="tag" href="/categories/net-framework/" title="net-framework">net-framework </a><a class="tag" href="/categories/Microsoft/NET/NET-Framework/" title=".NET Framework">.NET Framework </a><a class="tag" href="/categories/net-framework/NETで○○○を試してみる/" title=".NETで○○○を試してみる">.NETで○○○を試してみる </a><a class="tag" href="/categories/netで○○○を試してみる/" title="netで○○○を試してみる">netで○○○を試してみる </a><a class="tag" href="/categories/net/" title="net">net </a><a class="tag" href="/categories/net/NET-Core/" title=".NET Core">.NET Core </a><a class="tag" href="/categories/機械学習/" title="機械学習">機械学習 </a><a class="tag" href="/categories/netで○○○を試してみる/NETで機械学習を試してみる-LibLinear-Net編/" title=".NETで機械学習を試してみる LibLinear.Net編">.NETで機械学習を試してみる LibLinear.Net編 </a><a class="tag" href="/categories/機械学習/LibLinear-Net/" title="LibLinear.Net">LibLinear.Net </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2018/05/04/3000/,A certain engineer &quot;COMPLEX&quot;,.NETで機械学習を試してみる LibLinear.Net編 第1回,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/05/05/3007/" title="開発メモ その119 YOLOv3をnvidia docker on Ubuntu 18.04で動かす">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/05/03/2995/" title="開発メモ その118 Dockerのビルド時間 (主にapt-getやyum) を短縮する">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script></body></html>