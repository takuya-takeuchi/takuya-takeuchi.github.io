<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><link rel="icon" href="/images/favicon.ico" type="image/x-icon"><title>.NETで自動テストを試してみる 第1回 · A certain engineer "COMPLEX"</title><meta name="description" content="Introduction会社の海外現地法人にて、自動テストでコスト削減、みたいなことが話にあがり、こっちでもやらないとダメだよね、って話になりました。その際に話題にあがったのがAppium。Seleniumと名前が少し似ているので、関係があると思ったら、まぁその通りで。Seleniumは使ったことは"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/blogcard.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="search"><div class="text"><input placeholder="検索ワードを入力してください" id="search-text" onkeypress="javascript:search(event)"></div><div class="btn"><a><i class="fa fa-search"></i></a></div></div><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>.NETで自動テストを試してみる 第1回</a></h3></div><div class="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>会社の海外現地法人にて、自動テストでコスト削減、みたいなことが話にあがり、こっちでもやらないとダメだよね、って話になりました。<br>その際に話題にあがったのが<strong>Appium</strong>。<br><strong>Selenium</strong>と名前が少し似ているので、関係があると思ったら、まぁその通りで。<br>Seleniumは使ったことはなくて、Webアプリ用でしょ?デスクトップアプリに関係ない?と思ったら今は違っていて、Selenium(に互換のあるAPIを持つアプリ)がWebサーバーとして動作し、テスト対象アプリとテストを指示するクライアントを仲介することで、iOS、Android、VB(レガシーだよ!!)とか何でもござれのご様子。<br><strong>RPA(Robotics Process Automation)</strong> の一種やないと思い始めまして、ちょっと興味が。</p>
<p>で、Selenium互換のAPIを持つのがAppium。そのAppiumを経由することでWindowsアプリを操作することもできます。</p>
<p>ちなみに、この話は、<strong>Windows 10が対象で、7や8では試せません。</strong></p>
<p>ソースは下記になります </p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/TestFramework/Appium/01_Win32" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://opengraph.githubassets.com/622966838567b83e52f757cfb4518bff0e3330704278024105c3aecab4639280/takuya-takeuchi/Demo"></img></div><div class="hbc-text"><div class="hbc-title">Demo/TestFramework/Appium/01_Win32 at master · takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/TestFramework/Appium/01_Win32</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - Demo/TestFramework/Appium/01_Win32 at master · takuya-takeuchi/Demo</div></div></div></div></a></div></div>

<h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>Appiumを使うには下記の作業が必要。</p>
<ol>
<li>Windows Application Driverのインストール</li>
<li>テストの記述・実行</li>
</ol>
<h2 id="Windows-Application-Driverのインストール"><a href="#Windows-Application-Driverのインストール" class="headerlink" title="Windows Application Driverのインストール"></a>Windows Application Driverのインストール</h2><p>Windowsアプリを対象にするには、<strong>Windows Application Driver (WinAppDriver)</strong> が必要。<br>テスト対象Windowsアプリとテスト(を指示するアプリ)クライアントを仲介し、Windowsアプリの仕様や挙動を伝えるI/Fってことです。</p>
<p>まずは、こいつをインストールします。<br>下記からインストーラをダウンロードし、実行します。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/Microsoft/WinAppDriver/releases" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://opengraph.githubassets.com/8421d4744da27980985391441fb72cf8d29d42375735f89e5804c41a5081fc3a/microsoft/WinAppDriver"></img></div><div class="hbc-text"><div class="hbc-title">Releases · microsoft/WinAppDriver</div><div class="hbc-url">https://github.com/Microsoft/WinAppDriver/releases</div><div class="hbc-description">Windows Application Driver. Contribute to microsoft/WinAppDriver development by creating an account on GitHub.</div></div></div></div></a></div></div>

<p>インストールは大したことないので割愛。<br>どうでもいいですが、Windows7でもインストールは出来ますが、最終的にテスト実行時に </p>
<p><a href="../../../../public/2018/04/4c4a0878b1408f4534fcf9019e0f0e6a.png"><img src="../../../../public/2018/04/4c4a0878b1408f4534fcf9019e0f0e6a.png"></a></p>
<p>となりますので無駄骨です。</p>
<h2 id="テストの記述・実行"><a href="#テストの記述・実行" class="headerlink" title="テストの記述・実行"></a>テストの記述・実行</h2><p>もうテストが書けます!! <strong>Nuget</strong>でライブラリが配布されていますので、テストを記述したアプリを作成します。<br>基本は、</p>
<ul>
<li>Windows Application Driverの起動</li>
<li>テストの記述・実行</li>
</ul>
<p>です。<br>サンプルがネットに転がっているので少し改造させてもらいます。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.ka-net.org/blog/?p=6879" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.ka-net.org"></img><div class="hbc-site-name">初心者備忘録 | Office アドイン(旧Office用アプリ)・リボンのカスタマイズ情報が満載</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Windows Application Driverを試してみました。 | 初心者備忘録</div><div class="hbc-url">https://www.ka-net.org/blog/?p=6879</div><div class="hbc-description">Build 2016のセッション「UI Test Automation for Browsers and Ap</div></div></div></div></a></div></div>

<p>上の記事は電卓(ただしUWP製の)を操作します。<br>が、こっちは、ネイティブのGuidgen.exeを操作してみます。<br>最初に</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PM&gt; install-package Appium.WebDriver</span><br></pre></td></tr></table></figure>

<p>で、nugetの参照を追加します。<br>次はソースです。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> OpenQA.Selenium.Remote;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">TestGuidgen</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">//Windows Application Driver実行</span></span><br><span class="line">            <span class="keyword">var</span> serverPath = System.IO.Path.Combine(</span><br><span class="line">                Environment.GetFolderPath(Environment.SpecialFolder.ProgramFilesX86),</span><br><span class="line">                <span class="string">@&quot;Windows Application Driver&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WinAppDriver.exe&quot;</span></span><br><span class="line">            );</span><br><span class="line">            System.Diagnostics.Process.Start(serverPath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Guidgen操作</span></span><br><span class="line">            <span class="keyword">var</span> appCapabilities = <span class="keyword">new</span> DesiredCapabilities();</span><br><span class="line">            appCapabilities.SetCapability(<span class="string">&quot;app&quot;</span>, <span class="string">@&quot;C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\Tools\guidgen.exe&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> driver = <span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> Uri(<span class="string">@&quot;http://127.0.0.1:4723&quot;</span>), appCapabilities);</span><br><span class="line">            driver.Manage().Timeouts().ImplicitlyWait(TimeSpan.FromSeconds(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 最大 5 秒まで待機してボタン押下を繰り返す</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                driver.FindElementByName(<span class="string">&quot;新規 GUID(N)&quot;</span>).Click();</span><br><span class="line">                driver.Manage().Timeouts().ImplicitlyWait(TimeSpan.FromSeconds(<span class="number">5</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">            driver.FindElementByName(<span class="string">&quot;終了(X)&quot;</span>).Click();</span><br><span class="line"></span><br><span class="line">            Console.Write(<span class="string">&quot;Press any key to continue . . . &quot;</span>);</span><br><span class="line">            Console.ReadKey(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特に迷うポイントはありませんが、ボタンを探す際、ニーモニックがあると戸惑うくらいでしょう。<br>各コントロールの名前は、<strong>inspect.exe</strong>を使って調べることができます。</p>
<p><a href="../../../../public/2018/04/7785a5f7a54238bad49205954537c163.png"><img src="../../../../public/2018/04/7785a5f7a54238bad49205954537c163.png"></a></p>
<p>プログラムを実行すると、コンソールでWinAppDriver.exeが立ち上がり、Guidgen.exeが自動で操作されています。</p>
<p><a href="../../../../public/2018/04/f141f66a167ac8ec698aed5c1856143c.png"><img src="../../../../public/2018/04/f141f66a167ac8ec698aed5c1856143c-1024x649.png"></a></p>
<p>注意して欲しいのは、マウスカーソルが奪われますので、作業するのは止めた方が良いです。</p>
<h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/Demo/tree/master/TestFramework/Appium/01_Win32">https://github.com/takuya-takeuchi/Demo/tree/master/TestFramework/Appium/01_Win32</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-04-10</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/net-framework/" title="net-framework">net-framework </a><a class="tag" href="/categories/netで○○○を試してみる/" title="netで○○○を試してみる">netで○○○を試してみる </a><a class="tag" href="/categories/net-framework/NETで○○○を試してみる/" title=".NETで○○○を試してみる">.NETで○○○を試してみる </a><a class="tag" href="/categories/netで○○○を試してみる/NETで自動テストを試してみる/" title=".NETで自動テストを試してみる">.NETで自動テストを試してみる </a><a class="tag" href="/categories/自動テスト/" title="自動テスト">自動テスト </a><a class="tag" href="/categories/NET-Framework/" title=".NET Framework">.NET Framework </a><a class="tag" href="/categories/NET-Framework/Windows-Application-Driver/" title="Windows Application Driver">Windows Application Driver </a><a class="tag" href="/categories/Appium/" title="Appium">Appium </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2018/04/10/2852/,A certain engineer &quot;COMPLEX&quot;,.NETで自動テストを試してみる 第1回,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/04/13/2863/" title="開発メモ その105 Hyper-VでDebian with Raspberry Pi Desktop を使う">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/04/05/2835/" title="開発メモ その104 260文字を超えるパスを有効にする 追試験">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/search.js"></script></body></html>