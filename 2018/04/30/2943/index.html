<!DOCTYPE html><html lang="ja-JP"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Core"><title>.NETで機械学習を試してみる LibSvm.Net編 第1回 · A certain engineer "COMPLEX"</title><meta name="description" content="Introduction直前の記事であろうことか説明とサンプルで使っているライブラリを間違えるというドジを踏みました。謹んでお詫びします。で、**Support Vector Machine (SVM)**のライブラリをたくさん調べたのですが、以前話したようにそこまで多くありません。なので、自分で作"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/blogcard.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.1.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">A certain engineer &quot;COMPLEX&quot;</a></h3><div class="description"><p>とある技術者の劣等感</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/takuya_takeuchi"><i class="fa fa-twitter-square"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.facebook.com/takuya.takeuchi.sns"><i class="fa fa-facebook-square"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Core</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="search"><div class="text"><input placeholder="検索ワードを入力してください" id="search-text" onkeypress="javascript:search(event)"></div><div class="btn"><a><i class="fa fa-search"></i></a></div></div><div class="nav"><li><a href="/">ホーム</a></li><li><a href="/archives">アーカイブ</a></li><li><a href="/tags">タグ</a></li><li><a href="/about">自己紹介</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>.NETで機械学習を試してみる LibSvm.Net編 第1回</a></h3></div><div class="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>直前の記事であろうことか説明とサンプルで使っているライブラリを間違えるというドジを踏みました。<br>謹んでお詫びします。<br>で、**Support Vector Machine (SVM)**のライブラリをたくさん調べたのですが、以前話したようにそこまで多くありません。<br>なので、自分で作ってみました。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.nuget.org/packages/LibSvmDotNet" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.nuget.org"></img><div class="hbc-site-name">www.nuget.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://api.nuget.org/v3-flatcontainer/libsvmdotnet/1.0.2/icon"></img></div><div class="hbc-text"><div class="hbc-title">LibSvmDotNet 1.0.2</div><div class="hbc-url">https://www.nuget.org/packages/LibSvmDotNet</div><div class="hbc-description">.NET wrapper for LIBSVM written in C#. Please download libsvm.dll from https://github.com/cjlin1/libsvm</div></div></div></div></a></div></div>

<p>本当は、<strong>LibSvm.Net</strong> て名前で登録したかったんですが、既に存在するために泣く泣くこうなりました。<br>まぁ、githubのリポジトリのurlもこうだから、悪くないと言えば悪くないのですが… ところで、世の中に存在する.NETのSVMライブラリのほとんどが <strong>LIBSVM</strong> のラッパーであるのと同じく、自分で作ったのもラッパーです。<br>もう少し違いを説明します。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://accord-framework.net/">Accord.NET</a><ul>
<li>有名どころです。SVM以外の機械学習も可能です。SVMは独自の実装の模様。ただ、LIBSVMのモデルファイルを読めたりします。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ksopyla/KMLib">KMLib</a><ul>
<li>GPUを使える模様。が、最終更新が5年前。CUDA 3.0…</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ccerhan/LibSVMsharp">LibSVMsharp</a><ul>
<li>最新のLIBSVMに対応。libsvm.dllを直接読み込みます。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/nicolaspanel/libsvm.net">libsvm.net</a><ul>
<li>最終更新が3年前。また、Javaのラッパー <em>IKVM</em> を経由しているため速度面で不利。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/aardvark-platform/aardvark.semantictextonforests">libsvm.clr</a><ul>
<li>C++/CLIでLIBSVMを再ビルドして.NETから呼べるようにしています。</li>
</ul>
</li>
</ul>
<p>この中で立ち位置が近いのは、</p>
<ul>
<li>LibSVMsharp</li>
<li>libsvm.net</li>
<li>libsvm.clr</li>
</ul>
<p>です。<br>LibSvm.Netとの違いを説明すると、</p>
<ul>
<li>LibSVMsharp<ul>
<li>LibSVMsharpは、Predict関数を呼ぶ度にモデルファイルをアンマネージド領域にコピーしています。なので、何度も予測処理をかけたりする場合は、LibSvm.Netは効率よく動作します。</li>
<li>一応、何度も呼び出さないようにする方法もありますが、ポインタを受け渡しするという開発者泣かせの方式。</li>
</ul>
</li>
<li>libsvm.net<ul>
<li>Javaなんか経由しません。LibSvm.Netは100%C#でP/Invokeで直接LIBSVMを呼び出します。</li>
</ul>
</li>
<li>libsvm.clr<ul>
<li>C++/CLIなので、LinuxやMacで使えません。LibSvm.Netは100%C#の.NETStandard準拠です。他の依存ライブラリもありません。Linuxで動くことも確認しています。</li>
</ul>
</li>
</ul>
<p>何より、XMLコメントほぼ全て英語と日本語で実装していますので、IntelliSenseがバリバリ効きます!! 使い勝手は他とどっこいどっこいですが、前回と同じサンプルをLibSvm.Netで実装したものを持ってきました。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/LibSvmDotNet</div><div class="hbc-url">https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10</div><div class="hbc-description">.NET wrapper for LIBSVM written in C#. Contribute to takuya-takeuchi/LibSvmDotNet development by creating an account on GitHub.</div></div></div></div></a></div></div>

<h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>LibSvm.Netを使うには下記の作業が必要です。</p>
<p>1. NugetからLibSvm.Netのインストール</p>
<p>2. LIBSVMのソースをダウンロード</p>
<p>3. LIBSVMのソースをビルド</p>
<p>ちょっと面倒ですが、どれも手順はしっかりしています。<br>LIBSVMのビルド手順はLibSvm.Netの<a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/LibSvmDotNet/wiki/Tutorial-for-Windows">Wikiでも説明しています</a>ので参考にしてください。</p>
<h1 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h1><p>前回と同じですが、LibSvm.Netで再実装したソースです。<br>というか、LibSvm.Netのリポジトリにあるサンプルです。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System; <span class="keyword">using</span> System.Collections.Generic; <span class="keyword">using</span> System.IO; <span class="keyword">using</span> System.Text; <span class="keyword">using</span> LibSvmDotNet;  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Classification10</span> &#123;  </span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span> &#123;  </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span> &#123; <span class="comment">// Create random data var r = new Random(); const int trainCount = 500; const int testCount = 100;  </span></span><br><span class="line"><span class="keyword">var</span> temp = Path.GetTempPath(); <span class="keyword">var</span> trainDic = <span class="keyword">new</span> StringBuilder(); <span class="keyword">var</span> testDic = <span class="keyword">new</span> StringBuilder(); <span class="keyword">var</span> testDicAns = <span class="keyword">new</span> List&lt;<span class="keyword">int</span>&gt;();  </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> l = <span class="number">0</span>; l &lt; <span class="number">10</span>; l++) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; trainCount; i++) &#123; <span class="comment">// Create decimal value 0 or greater but less than 10 var v = r.NextDouble() + l; trainDic.AppendLine($&quot;&#123;l&#125; 1:&#123;v&#125;&quot;); &#125; for (var i = 0; i &lt; testCount; i++) &#123; // Create decimal value 0 or greater but less than 10 var v = r.NextDouble() + l; testDic.AppendLine($&quot;&#123;l&#125; 1:&#123;v&#125;&quot;); testDicAns.Add(l); &#125; &#125;  </span></span><br><span class="line"><span class="keyword">var</span> tempTrainPath = Path.Combine(temp, <span class="string">&quot;train&quot;</span>); <span class="keyword">var</span> tempTestPath = Path.Combine(temp, <span class="string">&quot;test&quot;</span>);  </span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> fs = <span class="keyword">new</span> FileStream(tempTrainPath, FileMode.Create, FileAccess.Write, FileShare.Write)) <span class="keyword">using</span> (<span class="keyword">var</span> sw = <span class="keyword">new</span> StreamWriter(fs, Encoding.ASCII)) sw.Write(trainDic.ToString());  </span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> fs = <span class="keyword">new</span> FileStream(tempTestPath, FileMode.Create, FileAccess.Write, FileShare.Write)) <span class="keyword">using</span> (<span class="keyword">var</span> sw = <span class="keyword">new</span> StreamWriter(fs, Encoding.ASCII)) sw.Write(testDic.ToString());  </span><br><span class="line"><span class="comment">// Load training data and test data set using (var train = Problem.FromFile(tempTrainPath)) using (var test = Problem.FromFile(tempTestPath)) &#123; // Configure parameter var param = new Parameter &#123; SvmType = SvmType.CSVC, KernelType = KernelType.RBF, Gamma = 0.05d, C = 5d, CacheSize = 100, Degree = 3, Coef0 = 0, Nu = 0.5, Epsilon = 1e-3, P = 0.1, Shrinking = true, Probability = false, WeightLabel = new int\[0\], Weight = new double\[0\] &#125;;  </span></span><br><span class="line"><span class="keyword">var</span> message = LibSvm.CheckParameter(train, param); <span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(message)) &#123; Console.WriteLine(<span class="string">$&quot;Error: <span class="subst">&#123;message&#125;</span> for train problem&quot;</span>); <span class="keyword">return</span>; &#125;  </span><br><span class="line">message = LibSvm.CheckParameter(test, param); <span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrWhiteSpace(message)) &#123; Console.WriteLine(<span class="string">$&quot;Error: <span class="subst">&#123;message&#125;</span> for test problem&quot;</span>); <span class="keyword">return</span>; &#125;  </span><br><span class="line"><span class="comment">// Train training data using (var model = LibSvm.Train(train, param)) &#123; var correct = 0; var total = 0; var x = test.X; for (var i = 0; i &lt; test.Length; i++) &#123; // Get vector from test data var array = x\[i\];  </span></span><br><span class="line"><span class="comment">// Get classification result (returns label) var ret1 = (int)LibSvm.Predict(model, array); if (ret1 == testDicAns\[i\]) correct++;  </span></span><br><span class="line">total++; &#125;  </span><br><span class="line">Console.WriteLine(<span class="string">$&quot;Accuracy: <span class="subst">&#123;correct / (<span class="keyword">double</span>)total \* <span class="number">100</span>&#125;</span>%&quot;</span>); &#125; &#125; &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前回と違い、ModelとProblemがIDisposableな事くらいですかね、違いは。<br>ちなみに、libsvm.net、libsvm.clrはProblem、Model、Parameter、Nodeの全てが構造体です。<br>対して、LibSvm.NetはNodeだけが構造体です。古い記事ですが、.NETにおける構造体とクラスの使い分けの基準となるサイズの分水嶺は16バイトです。</p>
<div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://mag.autumn.org/Content.modf?id=20061014194823" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=mag.autumn.org"></img><div class="hbc-site-name">mag.autumn.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">時代錯誤に今更こんなことを検証するのかよ!　C#で何バイトなら構造体にして許容できるか?
             【▲→川俣晶の縁側→ソフトウェア→技術雑記】
          </div><div class="hbc-url">http://mag.autumn.org/Content.modf?id=20061014194823</div></div></div></div></a></div></div>

<p>Nodeは16バイトで境界値の真上ですが、Modelは184バイト、Paramterは104バイトです。<br>Modelファイルは予測処理を行う場合、頻繁に受け渡しする値です。libsvm.clrとか大丈夫? 実行すると下記のような出力を行います。ここも同じですね。<br>強いて言うなら、.NET Coreのコンソールになっているくらいです。</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\\<span class="title">Works</span>\\<span class="title">OpenSource</span>\\<span class="title">LibSvmDotNet</span>\\<span class="title">example</span>\\<span class="title">Classification10</span>&gt; <span class="title">dotnet</span> <span class="title">run</span> -<span class="title">c</span> <span class="title">Release</span> \* <span class="title">optimization</span> <span class="title">finished</span>, #<span class="title">iter</span> = 84 <span class="title">nu</span> = 0.166000 <span class="title">obj</span> = -636.290437, <span class="title">rho</span> = 0.028434 <span class="title">nSV</span> = 166, <span class="title">nBSV</span> = 166 \* . . . <span class="title">optimization</span> <span class="title">finished</span>, #<span class="title">iter</span> = 79 <span class="title">nu</span> = 0.156000 <span class="title">obj</span> = -581.389855, <span class="title">rho</span> = -0.017062 <span class="title">nSV</span> = 156, <span class="title">nBSV</span> = 156 <span class="title">Total</span> <span class="title">nSV</span> = 1406 <span class="title">Accuracy</span>: 99.5% </span></span><br></pre></td></tr></table></figure>

<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>正直車輪の再発明な気がしないでもないですが、コメントを書くに当たりSVMの資料を漁るに漁ったので単語の意味とか朧気だったのが、ある程度わかるようになっています。<br>日本語に直すの大変ですよ、本当に。</p>
<h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a target="_blank" rel="noopener" href="https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10">https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-04-30</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Microsoft/" title="Microsoft">Microsoft </a><a class="tag" href="/categories/Microsoft/NET/" title=".NET">.NET </a><a class="tag" href="/categories/net-framework/" title="net-framework">net-framework </a><a class="tag" href="/categories/Microsoft/NET/NET-Framework/" title=".NET Framework">.NET Framework </a><a class="tag" href="/categories/net-framework/NETで○○○を試してみる/" title=".NETで○○○を試してみる">.NETで○○○を試してみる </a><a class="tag" href="/categories/netで○○○を試してみる/" title="netで○○○を試してみる">netで○○○を試してみる </a><a class="tag" href="/categories/net/" title="net">net </a><a class="tag" href="/categories/net/NET-Core/" title=".NET Core">.NET Core </a><a class="tag" href="/categories/機械学習/" title="機械学習">機械学習 </a><a class="tag" href="/categories/netで○○○を試してみる/NETで機械学習を試してみる-LibSvm-Net編/" title=".NETで機械学習を試してみる LibSvm.Net編">.NETで機械学習を試してみる LibSvm.Net編 </a><a class="tag" href="/categories/機械学習/LibSvm-Net/" title="LibSvm.Net">LibSvm.Net </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://takuya-takeuchi.github.io/2018/04/30/2943/,A certain engineer &quot;COMPLEX&quot;,.NETで機械学習を試してみる LibSvm.Net編 第1回,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/04/30/2952/" title="開発メモ その111 MacOSXでX11が見つからない">前へ</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/04/22/2928/" title=".NETで機械学習を試してみる libsvm.clr編 第1回">次へ</a></li></ul></div></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/search.js"></script></body></html>