<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>開発メモ その211 boostを使った最小のCMakeプロジェクト その3</title>
      <link href="/2020/06/13/4373/"/>
      <url>/2020/06/13/4373/</url>
      
        <content type="html"><![CDATA[<p>きちんとCMakeのfind_packageを使いましょう</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>かなり前に、<a href="https://wp.me/p9QCo1-Ix">開発メモ その94 boostを使った最小のCMakeプロジェクト その2</a>を記事にしたのですが</p><ul><li>リンクするライブラリを個別に全部手書き</li><li>find_packageを使っていない</li></ul><p>というあまり宜しくない作りをしていました。 </p><p>といっても、個人的には、自分が何を使っているのか､明示的にどこのディレクトリにあるライブラリをリンクしているかを意識できるように、パスを外部から指摘できる方式は好んで使います。 CMakeはライブラリが見つからないさい、どこを探しに行ったのかという情報が見えづらかったり、親切な作りになっていないのが不満です。<br>無論、クロスプラットフォームで作ったりする際は絶大なパワーを発揮するのですが… </p><p>Boost程度、自分でビルドして、find_packageでサクッと使ってみようと思いました。<br>が、1点だけ嵌りました。<br>Windows、OSXはすんなりだったのに、Linuxだけはダメでした。</p><h1 id="What’s-wrong"><a href="#What’s-wrong" class="headerlink" title="What’s wrong?"></a>What’s wrong?</h1><p>結論から言えば、CMakeにおけるConfigモード、つまり、 <strong>&lt;パッケージ名&gt;Config.cmake</strong>の場所を環境変数で指定する方法で問題が起きました。<br>問題は環境変数名。<br>大文字と小文字を明確に区別したため、find_packageに失敗しました。<br>Windows、OSXでは大文字小文字を区別しなかったのですが…</p><p>WindowsとOSXでは <script src="https://gist.github.com/takuya-takeuchi/53139807488c21394ac6f2bae1465c24.js"></script></p><p>Linuxではこう。 <script src="https://gist.github.com/takuya-takeuchi/9a1462f44d67115f4a04a9f2613f9da3.js"></script></p><p><strong>-G</strong>オプションが違いますが、環境変数とCMakeの引数<strong>BOOST_DIR</strong>の<strong>BOOST</strong>が<strong>Boost</strong>かどうかがミソです。 別に分ける必要はないですが、環境引数に合わせて大文字にしていたのが運の尽きでした。</p><p>ビルド後に生成されるCMakeの設定ファイルは、<strong>win64\cmake\Boost-1.73.0\BoostConfig.cmake</strong> のような感じですが、CMakeにおけるConfigモードではパッケージ名は <strong>&lt;パッケージ名&gt;Config.cmake</strong> です。<br>つまり<strong>Boost</strong>になります。<br>そして、環境変数による指定も、<strong>Boost_DIR</strong>となります。</p><p>それだけですが…はまりました。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> boost </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その210 CentOS7 on Gen2 Hyper-V VM のディスクをリサイズする</title>
      <link href="/2020/06/10/4368/"/>
      <url>/2020/06/10/4368/</url>
      
        <content type="html"><![CDATA[<p>検索してもなかなか出てこない+ビクビクしながら実施するのは嫌なので</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>掲題通りなんですが、Ubuntuだとここまで面倒ではなくて、手順は広まっている。 けど、CentOS7のファイルシステムに<strong>XFS</strong>が採用された事で色々変わったのでしょう。</p><ul><li>インストール後、rootまたはhomeが小さくて困った、サイズを変更したい</li><li>拡大は良いが縮小するために一度パーティションの削除が必要で困った</li></ul><p>こういう事例があります。 はい、私です。業務ではまりました。 忘れないように、見返せるようにメモをとります。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>まず直前の状態。 <script src="https://gist.github.com/takuya-takeuchi/fe08cd6042c6bf4fdd874db4bef81c06.js"></script></p><p>ここからリサイズを実施。 まずシャットダウン。</p><h2 id="1-Hyper-Vからディスク拡張"><a href="#1-Hyper-Vからディスク拡張" class="headerlink" title="1. Hyper-Vからディスク拡張"></a>1. Hyper-Vからディスク拡張</h2><p>これは簡単です。 GUIからどうぞ。 今回は20GBから30GBに拡張しました。</p><h2 id="2-ディスクの状態を確認"><a href="#2-ディスクの状態を確認" class="headerlink" title="2. ディスクの状態を確認"></a>2. ディスクの状態を確認</h2><script src="https://gist.github.com/takuya-takeuchi/af3d64ff75bff147378591c6215a3a9c.js"></script><p>はい、何も変わっていません。</p><h2 id="3-partedでディスクを修正"><a href="#3-partedでディスクを修正" class="headerlink" title="3. partedでディスクを修正"></a>3. partedでディスクを修正</h2><p>このままだとフリーな領域が見えませんので、<strong>parted</strong>で修正します。 <script src="https://gist.github.com/takuya-takeuchi/7da40c38daea8244af0ebc3b87fcfcaf.js"></script></p><p>対話形式で処理を進めます。 パーティションを修正するので、<strong>p</strong>を押下すると、<strong>バックアップGPTテーブルがディスクの終端にありません。</strong> という警告が出ます。 無論、ディスクを拡張したからです。 修正するかと聞かれますのでs、<strong>Fix</strong>と入力します。 さらに <strong>/dev/sda に利用可能なスペースのすべてが使用されているわけではないようです。</strong> という警告が出ます。 修正するかと聞かれますのでs、<strong>Fix</strong>と入力します。 <script src="https://gist.github.com/takuya-takeuchi/763c44111bb5b1406e5082fc288bce15.js"></script></p><p>修正が実施され、ディスクの情報が出力されます。 ここで <strong>Disk /dev/sda: 32.2GB</strong> の部分の数値を記録します。 後から使用します。 この数値がHyper-Vで拡張したディスクサイズになっています。</p><h2 id="4-resizepartで実際にリサイズ"><a href="#4-resizepartで実際にリサイズ" class="headerlink" title="4. resizepartで実際にリサイズ"></a>4. resizepartで実際にリサイズ</h2><p>同じくpartedのコマンドの一つ<strong>resizepart</strong>でパーティションのサイズを変更します。 修正対象は、3つめのパーティションになります。 そして、パーティションの終端を指定します。つまり、先ほどのディスクサイズを指定します。 <script src="https://gist.github.com/takuya-takeuchi/215f693547ce49fb95597c3b0a1a13b1.js"></script></p><p>リサイズ後、<strong>p</strong>コマンドで確認します。 <script src="https://gist.github.com/takuya-takeuchi/a7385023523728ba329e890f24472b85.js"></script></p><p>しっかりと、サイズが増えていることがわかります。 <strong>q</strong>を押下してpartedを終了しします。</p><h2 id="5-pvresizeで物理ボリュームをリサイズ"><a href="#5-pvresizeで物理ボリュームをリサイズ" class="headerlink" title="5. pvresizeで物理ボリュームをリサイズ"></a>5. pvresizeで物理ボリュームをリサイズ</h2><p>続いて、物理ボリュームのリサイズ。 修正前はこうなります。 <script src="https://gist.github.com/takuya-takeuchi/332ded30e4e3010dd0fc10464345ffaf.js"></script></p><p>修正対象の物理ボリュームを指定して、<strong>pvresize</strong>を実行するだけで、最大まで物理ボリュームを拡張します。 <script src="https://gist.github.com/takuya-takeuchi/cf2353c7b5f9857c82ece05ec0d63981.js"></script></p><p>空き領域が増えたことがわかります。</p><h2 id="6-lvextendで論理ボリュームをリサイズ"><a href="#6-lvextendで論理ボリュームをリサイズ" class="headerlink" title="6. lvextendで論理ボリュームをリサイズ"></a>6. lvextendで論理ボリュームをリサイズ</h2><p>これで最後です。 先ほど拡張した物理ボリューム内のデバイスマッパーが割り当てたデバイスを拡張します。 つまり、**/dev/sda3** 配下のデバイスになります。 この関係は<strong>lsblk</strong>で確認できます。 <script src="https://gist.github.com/takuya-takeuchi/c0c26bb62c1e73da676644344c98aa39.js"></script></p><p>ここでは、</p><ul><li><strong>centos-root</strong></li><li><strong>centos-swap</strong></li></ul><p>を拡張できます。 片方に空き領域を全部足してもイイですし、均等に配分しても構いません。 ここでは、10:0でrootに配分します、というかswapにはlvextendで拡張できません。 <strong>fsadm: Filesystem “swap” on device “/dev/mapper/centos-swap” is not supported by this tool.</strong> って言われて怒られますので。 <script src="https://gist.github.com/takuya-takeuchi/d25877f77130528c0672337dd3327477.js"></script></p><p>指定は、現在の空き領域の何%を指定したデバイスに追加するか､という意味になります。 今回は全部を配分するので100%を指定しました。</p><h2 id="7-確認"><a href="#7-確認" class="headerlink" title="7. 確認"></a>7. 確認</h2><p>こうなりました。 無事に10GB増えていることがわかります。 <script src="https://gist.github.com/takuya-takeuchi/8478bc2e68a217ab2b2b16fb923d74c1.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> CentOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その209  Build1660001055 でエラーが発生しました</title>
      <link href="/2020/05/30/4359/"/>
      <url>/2020/05/30/4359/</url>
      
        <content type="html"><![CDATA[<p>Xamarinで実機にデプロイできなくなりました</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>2020/06/02 更新 <strong>Visual Studio 2019 16.6.1</strong> で本問題は修正されました。 </p><p><a href="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373-3.png"><img src="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373-3.png"></a></p><p>デプロイできるプロジェクトとそうでないプロジェクトがあるので原因は不明。</p><blockquote><p>重大度レベル コード 説明 プロジェクト ファイル 行 抑制状態 エラー MessagingRemoteException: トピック xvs/Build/16.6.0.1055/execute-task/Xamarin.OpenCV.iOS/edf9d5b002fCopy の応答を実行中にクライアント Build1660001055 でエラーが発生しました TypeInitializationException: The type initializer for ‘Microsoft.Build.Tasks.Copy’ threw an exception. PlatformNotSupportedException: Operation is not supported on this platform. Xamarin.OpenCV.iOS</p></blockquote><p>ただ、Visual Studio 2019 16.6.0のバグであり、これはMicrosoftも認めていて、16.7.0 Preview1で修正済み。 でも16.6.0のPreviewの段階で報告されているのに正式リリースでも治っていないのはどういうことなのさ。 </p><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve?"></a>How to resolve?</h1><p>回避策は</p><ul><li>16.5.5にダウングレード</li><li>16.7.0 Preview1にアップグレード</li><li>Visual Studio for Macからデプロイ</li></ul><p>の3択。 が、Communityはかなり炎上している。 そりゃ、アップグレードしたらバイナリを作成できないんだから…ね。 実機検証だけはMacからするようにして対処しました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Xamarin </category>
          
          <category> Visual Studio </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その208 MT1001: Could not find an application at the specified directory</title>
      <link href="/2020/05/30/4355/"/>
      <url>/2020/05/30/4355/</url>
      
        <content type="html"><![CDATA[<p>Xamarinで実機デバッグが出来なくなった場合のエラー</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>以前は動いていたソースも変えていないiOSアプリを実機でバッグなり焦った際のメモ。 こんなエラーがでます。<br><a href="../../../../public/2020/05/44d29d2792be3bad9a9ed98c7bbb20d6-1.png"><img src="../../../../public/2020/05/44d29d2792be3bad9a9ed98c7bbb20d6-1.png"></a></p><ul><li>MT1001: Could not find an application at the specified directory:</li><li>MT1006: Could not install the application</li></ul><p><strong>Could not install the application</strong>っていうから、書き込み先に権限が無いのか？とか思っていてMac側を調べても特におかしいことは無し。 ただ、書き込み先のバイナリが古いのが気になりました。 古いのは書き込めなかったからだと思いますが。</p><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve?"></a>How to resolve?</h1><p>解決策がQiitaにありました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qiita.com/gnk263/items/e43796e96249f03fb70b" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DXamarin%25E3%2581%25A7%25E4%25BD%259C%25E6%2588%2590%25E3%2581%2597%25E3%2581%259FiOS%25E3%2582%25A2%25E3%2583%2597%25E3%2583%25AA%25E3%2581%258C%25E5%25AE%259F%25E6%25A9%259F%25E3%2583%2587%25E3%2583%2590%25E3%2583%2583%25E3%2582%25B0%25E8%25B5%25B7%25E5%258B%2595%25E3%2581%25A7%25E3%2581%258D%25E3%2581%25AA%25E3%2581%258F%25E3%2581%25AA%25E3%2581%25A3%25E3%2581%259F%25E5%25A0%25B4%25E5%2590%2588%25E3%2581%25AE%25E5%25AF%25BE%25E5%2587%25A6%25E6%2596%25B9%25E6%25B3%2595%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3D379c038c83b73ae72d4fe3612569b269&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540gnk263%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3D7cb627717321e8c528dd0f58df92b75e&blend-align=center%2Cmiddle&blend-mode=normal&s=bb4628a5ddd348cfcd846d7d68ab924d"></img></div><div class="hbc-text"><div class="hbc-title">Xamarinで作成したiOSアプリが実機デバッグ起動できなくなった場合の対処方法 - Qiita</div><div class="hbc-url">https://qiita.com/gnk263/items/e43796e96249f03fb70b</div><div class="hbc-description">はじめにXamarin.Formsを使用してiOSアプリを作成していましたが、いつの間にか、ビルドしたアプリを起動できなくなりました。対処方法を残しておきます。環境PC等Windows 10Visual ...</div></div></div></div></a></div></div><p>要する実機アイコンから一度アプリを削除しろということです。 当然、データも消えますし、一度プロファイルでインストールしたアプリの承認も行う必要があります。 面倒ですが､とりあえず解決。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Xamarin </category>
          
          <category> Visual Studio </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その207 OpenCVのiOS 静的ライブラリからUniversal Static Libraryを作成する</title>
      <link href="/2020/05/30/4353/"/>
      <url>/2020/05/30/4353/</url>
      
        <content type="html"><![CDATA[<p>自分でビルドしたiOSバイナリからUniversal Static Libraryを作成します。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Universal Static Libraryというのは複数のアーキテクチャのバイナリが一つに結合されたバイナリです。 つまり、arm7、arm7s、arm64などを一つのバイナリとして扱うことが可能です。 これによって、アーキテクチャに応じてバイナリのリンクを変更しなくて済むというメリットがあります。 しかし、当然バイナリサイズが膨れ上がるので、サポートするつもりのないアーキテクチャのバイナリは除外するか、そもそも個々のバイナリを小さくする工夫が必要です。 <strong>OpenCV</strong>は後者のサイズを小さくする工夫が可能です。 ビルドオプションで必要なコンポーネントだけを指定することができます。 工夫の方法は割愛して、単純に作成した<strong>libopencv_merged.a</strong>を、Universal Static Libraryとして結合してみます。 掲題の通りなんですが、情報が少ないんですよ。</p><h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>OpenCVのiOSビルドを行うと、下記のアーキテクチャのバイナリが生成されます。</p><ul><li>armv7</li><li>armv7s</li><li>arm64</li><li>i386</li><li>x86_64</li></ul><p>最後の2つはsimulator用ですが。 また、出力先の <strong>/lib/Release</strong>には<strong>libopencv_merged.a</strong>が存在します。 <strong>libopencv_world.a</strong>とは違い、他の静的ライブラリ(libpng.aとか)を結合しているように見えます。 これを結合してみます。 <script src="https://gist.github.com/takuya-takeuchi/ff97a095159532525822c2b40cbae7d1.js"></script></p><p>一つのlibopencv_merged.aが生成され、fileコマンドで確認すると全部のアーキテクチャが一つになっていることがわかります。</p>]]></content>
      
      
      <categories>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その206 &quot;VCRemoteClean&quot; タスクは、必要なパラメーター &quot;RemoteRootDirectory&quot; に対して値を指定されていませんでした。</title>
      <link href="/2020/05/30/4335/"/>
      <url>/2020/05/30/4335/</url>
      
        <content type="html"><![CDATA[<p>意味が分からないエラー</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>掲題の通りなんですが、情報が少ないんですよ。 問題は、iOSのクロスプラットフォームC＋＋ライブラリをVisual Studioからビルドする際のエラー。<br><a href="../../../../public/2020/05/44d29d2792be3bad9a9ed98c7bbb20d6.png"><img src="../../../../public/2020/05/44d29d2792be3bad9a9ed98c7bbb20d6.png"></a></p><p>Xamarinの場合はMacホストと接続できていないよ、って教えてくれるのですが、そんな便利機能、流石C++。あるわけない。 それで何とか見つけたのが公式。 公式が役立つのはかなり久しぶりな気がします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://docs.microsoft.com/en-us/cpp/cross-platform/install-and-configure-tools-to-build-using-ios?view=vs-2019&redirectedfrom=MSDN#ConfigureVS" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.microsoft.com"></img><div class="hbc-site-name">docs.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Install and configure tools to build using iOS</div><div class="hbc-url">https://docs.microsoft.com/en-us/cpp/cross-platform/install-and-configure-tools-to-build-using-ios?view=vs-2019&redirectedfrom=MSDN#ConfigureVS</div></div></div></div></a></div></div><h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>要するにビルド環境、つまりMacにつながらないよって、エラーなのですが… プロジェクトの設定ではなく、Visual Studio全体のオプションに答えがあります。 上のオプションで設定できるのですが、まずはMac側で設定が必要です。</p><h2 id="1-vcremoteのインストール"><a href="#1-vcremoteのインストール" class="headerlink" title="1. vcremoteのインストール"></a>1. vcremoteのインストール</h2><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://docs.microsoft.com/en-us/cpp/cross-platform/install-and-configure-tools-to-build-using-ios?view=vs-2019&redirectedfrom=MSDN#Install" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.microsoft.com"></img><div class="hbc-site-name">docs.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Install and configure tools to build using iOS</div><div class="hbc-url">https://docs.microsoft.com/en-us/cpp/cross-platform/install-and-configure-tools-to-build-using-ios?view=vs-2019&redirectedfrom=MSDN#Install</div></div></div></div></a></div></div><p>ここに書いてあるのが、なんと<strong>Node.js</strong>が必要。しかもバージョンが指定されている徹底ぶり。 ここは素直に従うべきです。ただでさえ意味不明なエラーが多いiOSのクロスプラットフォームライブラリ作成。 余計なことはしないほうが無難です。</p><blockquote><p>Node.js version 12.14.1 and npm version 6.13.4 Install version 12.14.1 of Node.js on your Mac. If you install the Node.js package, it should come with npm version 6.13.4. Other versions of Node.js and npm may not support some modules used in the remote agent vcremote, which can cause vcremote installation to fail. We recommend you install Node.js by using a package manager such as Node Version Manager. Avoid using the command sudo to install Node.js, as some modules can fail to install when using sudo.</p></blockquote><p>なので</p><ul><li>Node.jsは<strong>12.14.1</strong></li><li>npmは<strong>6.13.4</strong></li><li><strong>nvm</strong>推奨</li><li>sudoは使うな ** Homebrew**は注意</li></ul><p>を守って環境を作ります。</p><h3 id="1-1-nvm"><a href="#1-1-nvm" class="headerlink" title="1-1. nvm"></a>1-1. nvm</h3><p>公式のバージョンを調べます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/nvm-sh/nvm/releases" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/49963700?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">Releases · nvm-sh/nvm</div><div class="hbc-url">https://github.com/nvm-sh/nvm/releases</div><div class="hbc-description">Node Version Manager - POSIX-compliant bash script to manage multiple active node.js versions - nvm-sh/nvm</div></div></div></div></a></div></div><p>最新は2020/05/30時点で<strong>v0.35.3</strong>になります。 これを利用してMacにビルドに使うユーザでログインし、下記でインストールします。 <script src="https://gist.github.com/takuya-takeuchi/880709966c7c4ecbbc47e1957cfca6f3.js"></script></p><p>インストールが完了すると**.bash_profile**に追加されます。 環境変数を反映させインストール出来ているかをチェックします。 <script src="https://gist.github.com/takuya-takeuchi/adabb6efc91568dd882267dd056162cf.js"></script></p><h3 id="1-2-Node-js"><a href="#1-2-Node-js" class="headerlink" title="1-2. Node.js"></a>1-2. Node.js</h3><p><strong>nvm</strong>が入ったので、サクサクインストールします。 <script src="https://gist.github.com/takuya-takeuchi/f971a4d9288318dec66d7844f292859b.js"></script></p><p>これで、npmも指定されたバージョンがインストールされます。</p><h3 id="1-3-remote-agent"><a href="#1-3-remote-agent" class="headerlink" title="1-3. remote agent"></a>1-3. remote agent</h3><p>目的のブツです。 <script src="https://gist.github.com/takuya-takeuchi/170dcc3b07b57e16bfa4f8c06a7bfff2.js"></script></p><h2 id="2-vcremote設定"><a href="#2-vcremote設定" class="headerlink" title="2. vcremote設定"></a>2. vcremote設定</h2><p>vcremoteを起動します。初回起動時に色々インストールされます。 Xcode 11.5がインストールされるので少し時間がかかります。 <script src="https://gist.github.com/takuya-takeuchi/5b213bcba2a9446d2024919c35b3781b.js"></script></p><p>最後に出力された、</p><ul><li>Port</li><li>Secure</li><li>Pin</li></ul><p>をVisaul Studioに10分以内に入力します。 <strong>ツール(T) - オプション(O)</strong> から<strong>クロス プラットフォーム - C++ - iOS - ペアリング</strong>を選択し、下記に上述の値を設定します。 リモートルートはログインユーザのvcremoteのパスを指定します。<br><a href="../../../../public/2020/05/847517bd5c442db351fff81e3067d31a-1.png"><img src="../../../../public/2020/05/847517bd5c442db351fff81e3067d31a-1.png"></a></p><p>入力後、ペアリングを押下すると正常に接続されたことを示すメッセージが出力されます。<br><a href="../../../../public/2020/05/3c1ed548fe5ec54df3675251ff33ad70-1.png"><img src="../../../../public/2020/05/3c1ed548fe5ec54df3675251ff33ad70-1.png"></a></p><h2 id="3-ビルド"><a href="#3-ビルド" class="headerlink" title="3. ビルド"></a>3. ビルド</h2><p>この状態でiOSのC++プロジェクトをビルドすることが出来るようになりますが、ここで問題が。 ビルドに失敗してログに下記のメッセージが出力されている場合があります。 <script src="https://gist.github.com/takuya-takeuchi/e41c666c0f758718480a98be9a692fb0.js"></script></p><p>この場合はMacのGUIにログインし、Xcodeを起動させ、設定画面の<strong>Locations</strong>を開きます。<br><a href="../../../../public/2020/05/0d40a5e4a645fc6b96e767d64ac0878e.png"><img src="../../../../public/2020/05/0d40a5e4a645fc6b96e767d64ac0878e.png"></a></p><p><strong>Command Line Tools</strong>が空になっているので最新のXcodeを選択しXcodeを終了します。 この状態で念のため、vcremoteを終了し再度起動します。 初回起動以降はペアリングが済んでいれば､何も表示されずすぐに起動されます。 起動後、Visual Studioからビルドすると無事に成功するはずです。</p><h2 id="4-出力先はどこ？"><a href="#4-出力先はどこ？" class="headerlink" title="4. 出力先はどこ？"></a>4. 出力先はどこ？</h2><p>出力されるはずのバイナリはWindows側ではなくMac側に出力されます。 具体的な場所はビルドログを見るとわかります。 または出力先に*.recipeファイルがありますので、それをテキストファイルで開きます。 <script src="https://gist.github.com/takuya-takeuchi/38f76c1814fd97ca88f3c4b2469ab05b.js"></script> <strong>BuiltOutputs</strong>に記載されています。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その205 LinuxでCPU脆弱性対策を無効にしてみる</title>
      <link href="/2020/05/23/4326/"/>
      <url>/2020/05/23/4326/</url>
      
        <content type="html"><![CDATA[<p>タイトル通り</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>流石に仕事で全部無謀にすることがあるのか、と思いますがネットワークから完全に隔離されているマシンとかならありではと思わなくも無い。</p><h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>親切な方の記事は下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://hackmd.io/@GKcnNngaSBe9qCYV54wL8g/HykmqcS-N" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=hackmd.io"></img><div class="hbc-site-name">HackMD</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://i.imgur.com/fqm72bC.png"></img></div><div class="hbc-text"><div class="hbc-title">LinuxでSpectreの遅くなる脆弱性対策を無効化する - HackMD</div><div class="hbc-url">https://hackmd.io/@GKcnNngaSBe9qCYV54wL8g/HykmqcS-N</div><div class="hbc-description">###### tags: `Linux`  LinuxでSpectreの遅くなる脆弱性対策を無効化する ===  Linuxは、**カーネルパラメータ**に脆弱性対策を無効化するオプションを渡すといい</div></div></div></div></a></div></div><p>各パラメータの意味は自分で調べました。</p><ul><li><strong>nopti</strong><ul><li>Page Table Isolation を無効</li></ul></li><li><strong>noibpb</strong><ul><li>Indirect Branch Prediction Barriers を無効</li></ul></li><li><strong>noibrs</strong><ul><li>Indirect Branch Restricted Speculation を無効</li></ul></li><li><strong>nospectre_v2</strong><ul><li>Spectre バリアント 2 (Indirect Branch Speculation) 脆弱性に対する緩和策をすべて無効</li></ul></li><li><strong>nospec_store_bypass_disable</strong><ul><li>投機的ストアバイパス脆弱性に関する軽減策をすべて無効</li></ul></li></ul><p>面倒なので全部無効にします (白目) 手順は下記。 <strong>/etc/default/grub</strong> の <strong>GRUB_CMDLINE_LINUX</strong> にこれらの引数を追加してします。 なおこの設定は永続的になります。 下記は全部の脆弱性に対する<strong>全て</strong>の緩和対策(つまり脆弱性を受ける可能性の低減)を無効にします。 <script src="https://gist.github.com/takuya-takeuchi/27bb6df7e8e742d02da7d0e260fc45ee.js"></script></p><p>個別に無効にするなら下記のように、上述のパラメータを半角で区切ります。 <script src="https://gist.github.com/takuya-takeuchi/cad60b040dc23d8cea1a239d77571615.js"></script> 編集後、<code>sudo update-grub</code>して再起動が必要です。 脆弱性対策が無効にされたかどうかは下記ののよう、スクリプトをダウンロードして実行するとわかります。 <script src="https://gist.github.com/takuya-takeuchi/fa74d0dd73296b3ff70bf972219ac436.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その204 SECCOMPが有効かどうかを確認する</title>
      <link href="/2020/05/23/4321/"/>
      <url>/2020/05/23/4321/</url>
      
        <content type="html"><![CDATA[<p>LinuxでSECCOMP(SECure COMPuting mode)が有効かどうかを確認する方法</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>何故コレを確認したいかというと、twitterで<strong>CPU律速なRuby/Pythonコードはデフォルト設定のdocker上で遅くなる</strong>という興味深い記事が流れてきたためです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://mametter.hatenablog.com/entry/2020/05/23/032650" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=mametter.hatenablog.com"></img><div class="hbc-site-name">まめめも</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/17680117126965966783/26006613572305513/1590232057"></img></div><div class="hbc-text"><div class="hbc-title">CPU律速なRuby/Pythonコードはデフォルト設定のdocker上で遅くなる - まめめも</div><div class="hbc-url">https://mametter.hatenablog.com/entry/2020/05/23/032650</div><div class="hbc-description">English version 要約 dockerはデフォルトでセキュリティ機構（Spectre脆弱性の対策）を有効にします。この影響で、RubyやPythonのようなインタプリタは速度が劣化します。特にCPU律速なプログラムで顕著に遅くなります（実行時間が倍くらいになることがあ…</div></div></div></div></a></div></div><p>なので、この記事は、自分の環境でもこの現象が起きるのかを確認するためのメモになります。</p><h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>これだけ。 <script src="https://gist.github.com/takuya-takeuchi/2da8b98ed0ea8ea1cbcf25573b0e40aa.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その203 ORACLEで「ソケットから読み込むデータはこれ以上ありません」(勘違い)</title>
      <link href="/2020/05/13/4309/"/>
      <url>/2020/05/13/4309/</url>
      
        <content type="html"><![CDATA[<p>ORACLEで作ったデフォルトデータベースにつながらない、と勘違いした問題。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>SQLPLUSはつながるのに、<strong>SQL Developer</strong>や<strong>JetBrains DataGrip</strong>から上述のエラーが出てしまった。<br><a href="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373.png"><img src="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373.png"></a></p><p>※上の設定はSIDを間違っています。正しくは<strong>ORCL</strong> これが原因でした。<strong>ORCL</strong>にすれば問題なかったです。後述の共有サーバーモードに変更する必要もないです。</p><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve?"></a>How to resolve?</h1><p>間違っていますが…途中までの経過を。 調べた結果、<strong>Database Configuration Assistant</strong>を起動し、問題のデータベースの設定を変更するとよいらしい。 <strong>共有サーバーモード</strong>にするらしい。 </p><p><a href="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373-2.png"><img src="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373-2.png"></a><br> 完了を押下して続行するも、再構成途中で下記のエラーで落ちる。 </p><p><a href="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373-1.png"><img src="../../../../public/2020/05/66c19942ab4ba346fdb64ccc04cde373-1.png"></a><br> なんかemora.keyがないとかどうとかなので、EMリポジトリを作れと。 指示に従い、 <script src="https://gist.github.com/takuya-takeuchi/1a85b6949f7ee37232b88832c92eb430.js"></script></p><p>とするもエラー。 指示に従いログを見ると… <script src="https://gist.github.com/takuya-takeuchi/ffdbbd114ea9e14a8e46e142d349d22e.js"></script></p><p>問題のオブジェクトを消しては、再作成を繰り返し、いい加減埒が明かないと思い、調べた。 結果、 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://w.atwiki.jp/honu/pages/19.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=w.atwiki.jp"></img><div class="hbc-site-name">honu @ ウィキ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://img.atwiki.jp/_img/og_image.png"></img></div><div class="hbc-text"><div class="hbc-title">GridControl環境構成再び・・・ - honu @ ウィキ</div><div class="hbc-url">https://w.atwiki.jp/honu/pages/19.html</div><div class="hbc-description">グリッドコントロール環境構成で参考にしたサイトは以下 http://www.oracle.com/technetwork/articles/revitt-oem-096363.html#l 躓いたとこ...</div></div></div></div></a></div></div> <p>上記記事のコマンドを足し合わせた下記のコマンドをSQLPLUSで実行。 <script src="https://gist.github.com/takuya-takeuchi/fb7d3cc4e5fb76f3ab36b9ffb0f92a43.js"></script></p><p>そして再実行した結果。うまくいきました。 <script src="https://gist.github.com/takuya-takeuchi/d24b7c0fc76e3feefc025c87a7d08fdc.js"></script></p><p><strong>Database Configuration Assistant</strong>での設定変更も無事に成功しました。 もっとも、最初に書いたように何の意味もありませんでしたが。</p>]]></content>
      
      
      <categories>
          
          <category> rdms </category>
          
          <category> Oracle </category>
          
          <category> データベース </category>
          
          <category> RDMS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その202 libsodiumでファイル暗号化 (XChaCha20-Poly1305)</title>
      <link href="/2020/04/28/4301/"/>
      <url>/2020/04/28/4301/</url>
      
        <content type="html"><![CDATA[<p>libsodiumでファイル暗号化を試してみました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>何故ファイル暗号化に<strong>libsodium</strong>が必要なのかというと</p><ul><li>C++で使いたい</li><li>OpenSSLはビルドが面倒</li><li>ライセンスが緩い</li></ul><p>という3点です。 そんなlibsodiumはこちら </p><p>**Networking and Cryptography library (NaCL)**の構成コンポーネントのフォークです。</p><ul><li>クロスプラットフォーム</li><li>ISCライセンス<ul><li>2条項BSDライセンスと同等</li></ul></li><li>開発が活発</li><li>PHP 7.2から暗号化のコアとして採用</li></ul><p>という特徴があります。 そんあlibsodiumを使って暗号化処理を試してみました。</p><h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>ソースは下記です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/libsodium1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/libsodium1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>公式提供のサンプルコードをベースにしているのですが、</p><ul><li>C++化<ul><li>iostreamを使っているためfopenとか除去</li></ul></li><li>引数チェックなど追加</li><li>libsodiumをCMakeから利用</li><li>libsodiumは静的リンク</li></ul><p>と改良してあります。 暗号方式は、<strong>ChaCha20-Poly1305</strong>になります。 詳細はググっていただければと思いますが</p><ul><li>Googleが推奨<ul><li>TLS 1.3で提案されている</li></ul></li><li>RFC7539として標準化済み</li><li>ローパフォーマンスなマシンで高速に動作<ul><li>ハードウェアで高速化できるAESとは違いCPUのSIMDを効率的に使えるため、モバイルでも高速</li><li>参考 <a href="https://developers-jp.googleblog.com/2019/03/adiantum.html">Adiantum : 低廉な端末でも効率的に使える暗号化技術</a></li></ul></li></ul><p>とモダンな感じがするアルゴリズムです。 そして、libsodiumにはChaCha20-Poly1305の実装として下記が提供されています。</p><ul><li>ChaCha20-Poly1305 (オリジナル実装)</li><li>IETF ChaCha20-Poly1305</li><li>XChaCha20-Poly1305 (今回使ったのはこれ)</li></ul><p>実装の際は、Nonceの長さやメッセージの最大長が違ったりするといった感じに見えます。 (今回使った)XChaCha20-Poly1305での暗号/復号化に必要なのはKEYのみ。 どうも、Nonceは暗号化ファイルのヘッダーに埋め込まれる感じに見えます。 ただ、ヘッダー自体がKEYを使って生成されているので、Nonceが生で入っているような感じでは無いです (未確認) <script src="https://gist.github.com/takuya-takeuchi/bac743b2f3dfd875836c0b9f5ca8bc60.js"></script></p><script src="https://gist.github.com/takuya-takeuchi/44e628f7baeaa36c290f1af73ba798f5.js"></script><p>ヘッダーにnonceフィールドがあるのできっとそうなのでしょう。 また、暗号化は</p><ol><li>ヘッダー挿入</li><li>チャンクサイズ(4096)毎に暗号化</li></ol><p>するだけです。 復号化も</p><ol><li>ヘッダー解析</li><li>チャンクサイズ(4096)毎に復号化</li></ol><p>というシンプルさなのも実装が容易で好ましいです。</p>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
          <category> 暗号化 </category>
          
          <category> libsodium </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その201 PowerShellで変数の実行プログラムを簡単に起動する</title>
      <link href="/2020/04/28/4298/"/>
      <url>/2020/04/28/4298/</url>
      
        <content type="html"><![CDATA[<p>変数内に記された実行プログラムを実行するには</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Invoke-Expression</strong>でもいいですが、もっと手軽に。</p><h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>PowerShellの演算子には**呼び出し演算子 (実行演算子)**というのがあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_operators?view=powershell-7#call-operator-" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.microsoft.com"></img><div class="hbc-site-name">docs.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/media/logos/logo-powershell-social.png"></img></div><div class="hbc-text"><div class="hbc-title">about_Operators - PowerShell</div><div class="hbc-url">https://docs.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_operators?view=powershell-7#call-operator-</div><div class="hbc-description">PowerShell でサポートされている演算子について説明します。</div></div></div></div></a></div></div><p>こんな感じ。 <script src="https://gist.github.com/takuya-takeuchi/8a04df219c4aa44f7288dd601d1140dc.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> PowerShell </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その200 VisualStudioにおけるvar型のヒント表記を無効にする</title>
      <link href="/2020/04/26/4291/"/>
      <url>/2020/04/26/4291/</url>
      
        <content type="html"><![CDATA[<p>var型に対して明示的な型名がヒント表示されるのが邪魔</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>説明するよりも見たほうが早い。<br><a href="../../../../public/2020/04/66c19942ab4ba346fdb64ccc04cde373-2.png"><img src="../../../../public/2020/04/66c19942ab4ba346fdb64ccc04cde373-2.png"></a><br> 列がずれるし、型が変わるとヒントも変化するから、キャレットが突然ずれてわかりにくいことがある。</p><h1 id="How-to-fix"><a href="#How-to-fix" class="headerlink" title="How to fix?"></a>How to fix?</h1><p>これは、_Visual Studio_の機能ではなく、_Resharper_の機能でした。 なので、ヒント表記が出ている行を選択して左側のアクションボタンをクリックすると、このヒント表記を無効にできるオプション <strong>Hide type name hints for implicitly typed variables</strong>を選択することで隠すことが可能になる。<br><a href="../../../../public/2020/04/66c19942ab4ba346fdb64ccc04cde373-3.png"><img src="../../../../public/2020/04/66c19942ab4ba346fdb64ccc04cde373-3.png"></a><br> きれいになりました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio </category>
          
          <category> JetBrains </category>
          
          <category> jetbrains </category>
          
          <category> ReSharper </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その199 Spring Bootでorg.springframework.webが見つからない</title>
      <link href="/2020/04/03/4278/"/>
      <url>/2020/04/03/4278/</url>
      
        <content type="html"><![CDATA[<p>Spring Bootでorg.springframework.webが見つからない。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Sprint Bootのデモプロジェクトを </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://start.spring.io/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=start.spring.io"></img><div class="hbc-site-name">start.spring.io</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">undefined</div><div class="hbc-url">https://start.spring.io/</div></div></div></div></a></div></div><p>で作成した。<br><a href="../../../../public/2020/04/screencapture-start-spring-io-2020-04-03-19_49_50.png"><img src="../../../../public/2020/04/screencapture-start-spring-io-2020-04-03-19_49_50-1024x504.png"></a></p><p>こんな感じ。 このサンプルを<strong>IntellJ IDEA</strong>で開いて、適当なRestContollerを作成したところが掲題のエラー。<br><a href="../../../../public/2020/04/66c19942ab4ba346fdb64ccc04cde373-1.png"><img src="../../../../public/2020/04/66c19942ab4ba346fdb64ccc04cde373-1.png"></a></p><h1 id="How-to-fix"><a href="#How-to-fix" class="headerlink" title="How to fix?"></a>How to fix?</h1><p><strong>build.gradle</strong>を下記のように変更。 <script src="https://gist.github.com/takuya-takeuchi/aad11e72e4bcac6fa9cb66d4d58ca387.js"></script></p><p>これでビルドが通ります。 <strong>spring initializr</strong>で<strong>Spring Web</strong>を追加する方法でも可能です。</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> Gradle </category>
          
          <category> Sprint Boot </category>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その198 Could not initialize class org.codehaus.groovy.reflection.ReflectionCache</title>
      <link href="/2020/04/02/4275/"/>
      <url>/2020/04/02/4275/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Could not initialize class org.codehaus.groovy.reflection.ReflectionCache というエラーが表示される。</p><a id="more"></a><p>会社を辞めて転職するため、C/C++、C#、Python以外の習得言語が欲しくなり、昔資格として取得したJavaの勉強を始めた。 とっかかりとして、簡単なWebAPを作ってみることにしたのだが、<strong>IntelliJ IDEA</strong> を使って <strong>Spring BOOT + Gradle</strong> のプロジェクトを用意した。 が、よくわからなかったので </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://start.spring.io/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=start.spring.io"></img><div class="hbc-site-name">start.spring.io</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">undefined</div><div class="hbc-url">https://start.spring.io/</div></div></div></div></a></div></div><p>を使ってプロジェクトファイルを作って活用することにしてみた。 そして遭遇したのが表題。</p><h1 id="What-does-it-mean"><a href="#What-does-it-mean" class="headerlink" title="What does it mean?"></a>What does it mean?</h1><p>結論から言えば、<strong>JDK 14</strong>のせい。 </p><p>既に報告されている。 解決策として、利用するGradleのバージョンを6.3にすることで対応できるというのが、この記事の2日前(2020/03/31)に報告されていた。 修正は、<strong>gradle\wrapper\gradle-wrapper.properties</strong> を下記のように修正してビルドし直す。 <script src="https://gist.github.com/takuya-takeuchi/c6eae2d9bb4cc4c4e13c6f80cbeca51b.js"></script> これで直った!!</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> JetBrains </category>
          
          <category> Gradle </category>
          
          <category> jetbrains </category>
          
          <category> Sprint Boot </category>
          
          <category> IntelliJ IDEA </category>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その197 Visual Studio Codeのエクスプローラーを改善する  その2</title>
      <link href="/2020/03/14/4249/"/>
      <url>/2020/03/14/4249/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Visual Studio Codeのエクスプローラーの挙動を自分好みにする その2。</p><a id="more"></a><p>タブでファイルの表示を切り替えるとエクスプローラーペインでの選択状態も同期して変更される機能があります。 あれが非常に煩わしい。 なので無効化する。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>下記の設定のチェックを外します。<br><a href="../../../../public/2020/03/66c19942ab4ba346fdb64ccc04cde373.png"><img src="../../../../public/2020/03/66c19942ab4ba346fdb64ccc04cde373.png"></a><br> 無効化されました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その196 Ubuntu 18.04のSSDを新しいSSDにクローンする</title>
      <link href="/2020/03/08/4264/"/>
      <url>/2020/03/08/4264/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>dockerイメージがディスク容量を逼迫していたため新しいSSDを購入しクローンしました。</p><ul><li>移行元 (/dev/sdd)<ul><li>256GB (Ubuntu 18.04.3)</li></ul></li><li>移行先 (/dev/sdc)<ul><li>512GB</li></ul></li></ul><p>懸念点は、ディスクサイズが違っても大丈夫か、未割り当て領域を拡張できるか、の2点ですが結論から言うと問題ありませんでした。</p><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve?"></a>How to resolve?</h1><p>下記のページを参考にさせていただきました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://toranosuke.hatenablog.com/entry/2018-0913_disk-clone-linux" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=toranosuke.hatenablog.com"></img><div class="hbc-site-name">虎之助の徒然記</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/t/toranosuke_blog/20180922/20180922103535.jpg"></img></div><div class="hbc-text"><div class="hbc-title">クローンディスクの作り方 (1) Linuxの場合 - 虎之助の徒然記</div><div class="hbc-url">http://toranosuke.hatenablog.com/entry/2018-0913_disk-clone-linux</div><div class="hbc-description">【概要】 Linuxを用いたクローンディスクの作り方について説明します。ディスククローンには、dd、gdisk、gpartedの3つのコマンドを用います。それぞれの使い方や注意事項についてまとめます。 1. はじめに 2. クローンディスクの作成 3. 事前準備 3.1 必要なツ…</div></div></div></div></a></div></div><h2 id="LiveCD起動"><a href="#LiveCD起動" class="headerlink" title="LiveCD起動"></a>LiveCD起動</h2><p>実行中のシステムをクローンできませんので、LiveCDとか別のOSを起動し、移行元、移行先のディスクを接続します。</p><h2 id="クローン実行"><a href="#クローン実行" class="headerlink" title="クローン実行"></a>クローン実行</h2><p>下記でクローンします。入力と出力を間違えないように。lsblkコマンドなどできちんと確認。 また進捗状況は出力されません。 <script src="https://gist.github.com/takuya-takeuchi/6339786833c06b480da4fd7d5013397e.js"></script></p><h2 id="GPTテーブル修正"><a href="#GPTテーブル修正" class="headerlink" title="GPTテーブル修正"></a>GPTテーブル修正</h2><script src="https://gist.github.com/takuya-takeuchi/a9aeda362bebe95becf514fc43e28428.js"></script><h2 id="ディスク拡張"><a href="#ディスク拡張" class="headerlink" title="ディスク拡張"></a>ディスク拡張</h2><p>GPartedを起動し、末尾の未割り当て領域を既存のパーティションの拡張先に割り当てます。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その195 Ubuntu 18.04でXRDPを使うとアイコンとDockが消える</title>
      <link href="/2020/03/04/4258/"/>
      <url>/2020/03/04/4258/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>自宅では再現しなかったのですが、会社の開発機で現象が発生したため対処法をメモ。 自宅のUbuntu18は <strong>Ubuntu 18.04.3 LTS</strong> だったがそれが起因しているだろうか。</p><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve?"></a>How to resolve?</h1><p>下記のページで対処法が載っていました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://c-nergy.be/blog/?p=12155" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=c-nergy.be"></img><div class="hbc-site-name">c-nergy.be</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">xRDP – How to Fix Theme issues in Ubuntu 18.04 remote session – Griffon&#39;s IT Library</div><div class="hbc-url">https://c-nergy.be/blog/?p=12155</div></div></div></div></a></div></div><p><strong>GNOME Tweak tool</strong>をインストールし適切な設定を行うことでアイコンとDockを復活させることが可能である。 <script src="https://gist.github.com/takuya-takeuchi/978b7e350ada191ea2bc0d3069c9091b.js"></script></p><p><a href="../../../../public/2020/03/01.png"><img src="../../../../public/2020/03/01-1024x579.png"></a><br> Tweakで起動</p><p><a href="../../../../public/2020/03/02.png"><img src="../../../../public/2020/03/02.png"></a> Desktopからアイコンを表示できる <a href="../../../../public/2020/03/03.png"><img src="../../../../public/2020/03/03.png"></a><br> AppearanceでThemeやアイコンを変更可能</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その194 gRPC v1.26.0 C++をビルドしHello World</title>
      <link href="/2020/02/08/4248/"/>
      <url>/2020/02/08/4248/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>gRPCのv1.26.0をC++でビルドしてHello Worldを動かします。</p><a id="more"></a><p>今更な記事ですが、C#、Java、Pythonと違いC++のgRPCは動かすまでもが面倒です。 しかも公式のサンプルですら。 こういうエラーに苦しめられます。</p><ul><li><a href="https://github.com/grpc/grpc/issues/16741">https://github.com/grpc/grpc/issues/16741</a></li><li><a href="https://github.com/grpc/grpc/issues/17576">https://github.com/grpc/grpc/issues/17576</a></li><li><a href="https://github.com/grpc/grpc/issues/19873">https://github.com/grpc/grpc/issues/19873</a></li></ul><p>でネットをさまよっていると解決策を提示してくれている方の記事が。 正確には上の問題を解決する意図の記事ではないのですが。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://medium.com/@melpon/grpc-c-%E3%81%AE%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B-4f5f40fb10ec" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=medium.com"></img><div class="hbc-site-name">Medium</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">gRPC C++ の環境を構築する</div><div class="hbc-url">https://medium.com/@melpon/grpc-c-%E3%81%AE%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B-4f5f40fb10ec</div><div class="hbc-description">アプリケーションから gRPC C++ を利用できる環境を作るのは、CMake の add_subdirectory を使えばある程度簡単にできます。</div></div></div></div></a></div></div><p>上の説明を整えて、シェルスクリプトにまとめました。 この方の記事ではHello Worldを実行しているわけではないですが。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>ソースは下記にまとめてあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/gRPC2" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/gRPC2</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>Ubuntu 18.04のdockerコンテナでビルドします。 <script src="https://gist.github.com/takuya-takeuchi/392604c9580c4d8964a37f92880b7a3a.js"></script></p><p>そしてコンテナのビルドと起動のシェル。 <script src="https://gist.github.com/takuya-takeuchi/70b71265c85ac926f03babf08822acf2.js"></script></p><h2 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h2><p>gRPCのビルドです。 上のコンテナ内で実行します。 <script src="https://gist.github.com/takuya-takeuchi/168cb79b3dfebc3723750fa4becedd45.js"></script></p><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p>これも上のコンテナ内で実行します。 <script src="https://gist.github.com/takuya-takeuchi/d432165953927a262287ab69af07aaff.js"></script></p><p>上のスクリプト群を順番に実行すると、最終的にサーバーのLISTENとクライアントからの呼び出しが実行されます。 <script src="https://gist.github.com/takuya-takeuchi/d7b82612e7c0d5beedf8d838cf8d7cf7.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> C/C++ </category>
          
          <category> linux </category>
          
          <category> remote-procedure-call </category>
          
          <category> Ubuntu </category>
          
          <category> Google </category>
          
          <category> gRPC </category>
          
          <category> Remote Procedure Call </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その193 Visual Studio Codeのエクスプローラーを改善する</title>
      <link href="/2020/01/25/4239/"/>
      <url>/2020/01/25/4239/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Visual Studio Codeのエクスプローラーの挙動を自分好みにする。</p><a id="more"></a><p>1.41から<strong>コンパクトフォルダ</strong>なる深い階層のディレクトリ表示をまとめて表示する機能がデフォルトで有効になりました。 </p><p><a href="../../../../public/2020/01/1.png"><img src="../../../../public/2020/01/1.png"></a></p><p>最初は我慢していましたが、コピーや移動でミスが多発してきたので戻すことにしました。 あとはディレクトリのインデントが狭いのも何気に見づらいのも改善。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><h2 id="コンパクトフォルダの無効化"><a href="#コンパクトフォルダの無効化" class="headerlink" title="コンパクトフォルダの無効化"></a>コンパクトフォルダの無効化</h2><p>下記の設定のチェックを外します。 </p><p><a href="../../../../public/2020/01/3.png"><img src="../../../../public/2020/01/3.png"></a></p><p>無事に戻りました。</p><p> <a href="../../../../public/2020/01/2.png"><img src="../../../../public/2020/01/2.png"></a></p><h2 id="インデント幅の調整"><a href="#インデント幅の調整" class="headerlink" title="インデント幅の調整"></a>インデント幅の調整</h2><p>下記の設定で調整可能。デフォルトは8ピクセルでした。 </p><p><a href="../../../../public/2020/01/4.png"><img src="../../../../public/2020/01/4.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その192 Linuxの共有オブジェクト(so)ファイルの名前を変更する</title>
      <link href="/2020/01/19/4233/"/>
      <url>/2020/01/19/4233/</url>
      
        <content type="html"><![CDATA[<p>soファイルの名前を変えても別プログラムからリンクがうまくいかなかった問題での対応。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>NVIDIA Caffeを改造したライブラリを作っているのですが、都合上オリジナルのNVIDIA Caffe (libcaffe.so) と共存させる必要があり、その改造Caffe (以下libcaffemod.so) をシステムにインストールします。 オリジナルのNVIDIA Caffeの出力は下記。 <script src="https://gist.github.com/takuya-takeuchi/70c95c1d61c529486b488f9c568bae47.js"></script> 単純にファイル名を変えて、システム (/usr/lib/x86_64-linux-gnu/)にインストールしたところでうまく動きません。 というのも、単純に名前を変えてリンクしようとしてもうまくいきません。 例えば、下記の簡単なプログラム。 <script src="https://gist.github.com/takuya-takeuchi/84b5e3de5c3d23ea29c40e0139d3f5ed.js"></script></p><p>これに、libcaffe.so.0.17.3をlibcaffemod.soに名前を変えてコピーしリンクさせてみます。 <strong>CMakeLists.txt</strong>は下記。 <script src="https://gist.github.com/takuya-takeuchi/86cba3e45c2da3d0361595a2c8e8c48e.js"></script></p><p>実行してみます。単純にCaffeのバージョンを出力するだけです。 ではリンクしているsoファイルは何になるか? <script src="https://gist.github.com/takuya-takeuchi/e69328c96f62c9e6fd901103877bc085.js"></script></p><p>名前変更前にリンクしています。 動いているのはリンク先の同じディレクトリにオリジナルのlibcaffeが存在するからです。 libcaffe.soを全部削除するとプログラムが動かなくなります。 どうするべきか。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>共有オブジェクトファイルは内部に共有オブジェクトの名前を保持しています。 これが原因で、リンク先がファイル名変更前になっていたのです。 下記は名前だけ変更したlibcaffemod.soの内部に保持した名前を確認しています。 <script src="https://gist.github.com/takuya-takeuchi/ceaada13ff7f112de0a775aea4613b23.js"></script></p><p>正攻法はNVIDIA CaffeのMakefileやCMakeLists.txtを書き換えて、正しい名前で出力するようにするべきです。 が、単純に変更してもうまくビルドできませんでした。 なので別の方法を。</p><h2 id="PatchELF"><a href="#PatchELF" class="headerlink" title="PatchELF"></a>PatchELF</h2><p><strong>PatchELF</strong>というLinuxの <strong>ELF (Executable and Linkable Format)ファイル</strong> を操作するツールを使います。 </p><p>バイナリで配布はされていないのでソースからビルドします。 最新版を使ってください。少し古い版の0.8はうまく動きませんでした。 <script src="https://gist.github.com/takuya-takeuchi/fa796dc541bceff59a6f9548b786130e.js"></script></p><p>make installはしてもしなくても。 同じディレクトリのsrc配下にバイナリが生成されるので。 これを使って先のlibcaffemod.soを変更します。 <strong>--set-soname</strong>コマンドを使います。最初の引数が新しい名前、最後が対象ファイルのパスです。 <script src="https://gist.github.com/takuya-takeuchi/fca72b85600c0674bac4694f2742a7c4.js"></script></p><p>見事に変更されました。 一度サンプルプログラムのbuildを削除してからビルドし直して、lddでリンク先を確認してみます。 <script src="https://gist.github.com/takuya-takeuchi/46aa3687439a1cf4fafe761a004cb632.js"></script></p><p>きちんと変わっていますね。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その191 Visual Studio CodeのRomote Containerに拡張機能がインストールできない場合</title>
      <link href="/2020/01/09/4226/"/>
      <url>/2020/01/09/4226/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Visual Studio Codeでコンテナ内に拡張機能をインストールできない場合の対応。</p><a id="more"></a><p>こんな感じのエラーが、コンテナ内ででます。 proxyや証明書はインストールしたコンテナのはずなのですが。 根本原因を追究したかったのですが、時間がなかったので暫定対応を行いました。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p><strong>Remote - Containers</strong>拡張でデバッグ用のコンテナを起動する際、code-serverが読み込まれるのですが、その際に拡張機能の入手に失敗してるようです。 そのため、</p><ul><li>コンテナ起動時に拡張機能をインストール</li><li>コンテナビルド時に拡張機能をインストール</li></ul><p>という手法がとれます。 今回は後者を。 <strong>Remote - Containers</strong>拡張で作成されるデバッグコンテナのDockerfileに <script src="https://gist.github.com/takuya-takeuchi/0bc62f765a374c2cc31806d002b8756b.js"></script> のような記述を追加します。 これにより、拡張機能があらかじめ追加された状態になります。 また拡張機能をあらかじめ入れておくことで、コンテナをビルドし直した際に、再度拡張機能をインストールし直す必要もなくなります。 本来はコンテナ起動後、手動で拡張機能をインストールしコンテナのリロードで有効化するのですが、それをスキップできます。 こんな感じ。<br><a href="../../../../public/2020/01/6.png"><img src="../../../../public/2020/01/6.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その190 .NET CoreでP/Invokeでの動的リンクに失敗したためLD_DEBUGで原因を調べてみる</title>
      <link href="/2020/01/03/4223/"/>
      <url>/2020/01/03/4223/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Windows上でOpenCVのstaticライブラリを作成し、自作のdllにリンクさせる方法。</p><a id="more"></a><p>.NETでP/Invokeするとよくあるエラーの一つが、Nativeのdllが見つからないというのがあります。 例えば下記のような。 <script src="https://gist.github.com/takuya-takeuchi/f71cab63107096c94711412d651c713d.js"></script> たいていは、そのdllがないのではなく、そのdllが依存しているライブラリが存在しないというパターンが多い。 Windowsの場合は<strong>DepenecyWalker</strong>とかで割と簡単に原因がわかる。 OSXなら、<strong>otool -L</strong>、Linuxの場合は、<strong>ldd</strong>を使えばわかる。 しかし、今回、Ubuntuで発生した上記エラーに対し、lddを適用したところ <script src="https://gist.github.com/takuya-takeuchi/2a586668e71d77495788d9066ff0fef0.js"></script> エラーが見当たらなかった。 という問題の解決方法。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>タイトル通り<strong>LD_DEBUG</strong>を使います。 ググっても、使い方がわかりづらかったのですが、要するに <script src="https://gist.github.com/takuya-takeuchi/74fb869c4545bedfee6bf616d0ee6bd7.js"></script> のように、問題が発生するコマンドと合わせて実行するということです。 標準エラー出力に出力されるのでリダイレクトでファイルに書き出します。 かなり巨大なので注意。 <script src="https://gist.github.com/takuya-takeuchi/df829543c2edca762f812f89ecf79829.js"></script> 問題のdll名をgrepしていくと怪しそうなところが。 要するに、シンボル <strong>omp_get_max_threads</strong> を <strong>lookup in</strong> していったけどついに見つかりませんでした、ということでした。 今回はdllがなかったのではなくシンボルが見つからなかったというパターン。 自分で呼び出しているものならともかく依存しているライブラリだと実行時のエラーメッセージには出ませんね。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> C/C++ </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その189 OpenCVを自作dllに静的リンクさせる</title>
      <link href="/2019/12/31/4219/"/>
      <url>/2019/12/31/4219/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Windows上でOpenCVのstaticライブラリを作成し、自作のdllにリンクさせる方法。</p><a id="more"></a><p>普通にリンクさせると、</p><blockquote><p>opencv_world341.lib(alloc.cpp.obj) : error LNK2038: ‘RuntimeLibrary’ の不一致が検出されました。値 ‘MT_StaticRelease’ が MD_DynamicRele ase の値 ‘opencv.obj’ と一致しません。</p></blockquote><p>と表示されてしまう。 一工夫必要。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>CMakeに渡す引数に下記を追加。特に、<strong>BUILD_WITH_STATIC_CRT</strong>が重要。</p><ul><li>BUILD_SHARED_LIBS=OFF</li><li>BUILD_WITH_STATIC_CRT=OFF</li></ul><p>OpenCVのビルドとサンプルdllをビルドできるサンプルは下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/OpenCVStatic" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/OpenCVStatic</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>下記のように簡単に使用可能。 <script src="https://gist.github.com/takuya-takeuchi/17f71c2169dcf8d3c65f2d7c911bd350.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
          <category> その他 </category>
          
          <category> CMake </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その188 privateなdocker registryにログインすると x509 エラー</title>
      <link href="/2019/11/30/4211/"/>
      <url>/2019/11/30/4211/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>自宅のSynology上に構築したdocker registryに<strong>Let’s Encrypt</strong>でHTTPS化後、Webブラウザからアクセスはできるが、docker loginによる認証が下記のように通らない場合の対応。 <script src="https://gist.github.com/takuya-takeuchi/8d616d1770260292a3652c5365cc1d35.js"></script></p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>docker registryで使用している証明書 (*.crt) をdocker loginを使うマシンにコピーします。 <strong>REGISTRY_HTTP_TLS_CERTIFICATE</strong>で指定しているはず。 コピーした*crtを<strong>registry.crt</strong>とします。 こんな感じでdockerデーモン管理下の証明書置き場に展開します。 展開する際、ファイル名は<strong>ca.crt</strong>にします。 <script src="https://gist.github.com/takuya-takeuchi/3056bc9f552faff6274ab8e484821161.js"></script> もう一度ログインしてみます。 <script src="https://gist.github.com/takuya-takeuchi/e1ebd4b4df9d9af409dddcc1e66ae75b.js"></script> うまくいきました。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その187 Ubuntuで次回起動時のOSを一時的に変更する</title>
      <link href="/2019/11/10/4205/"/>
      <url>/2019/11/10/4205/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>作業メモ</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><h3 id="再起動してUEFIスクリーンを表示"><a href="#再起動してUEFIスクリーンを表示" class="headerlink" title="再起動してUEFIスクリーンを表示"></a>再起動してUEFIスクリーンを表示</h3><script src="https://gist.github.com/takuya-takeuchi/b6ab29a1c2f17e42c3f3e51dcb490fb5.js"></script><h3 id="次回起動OSを一時的に指定"><a href="#次回起動OSを一時的に指定" class="headerlink" title="次回起動OSを一時的に指定"></a>次回起動OSを一時的に指定</h3><script src="https://gist.github.com/takuya-takeuchi/0a311ce3410ac29b7d6df8b04dd6f37e.js"></script>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その187 Ubuntu 18.04.3でXRDPを使う</title>
      <link href="/2019/11/10/4203/"/>
      <url>/2019/11/10/4203/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>割とネットで転がっている話題ですが。 肝は<strong>18.04.3</strong>であること。</p><h1 id="What-is-a-problem"><a href="#What-is-a-problem" class="headerlink" title="What is a problem?"></a>What is a problem?</h1><p>どうも、<strong>18.04.2</strong>で<strong>xorgxrdp</strong>というパッケージが<strong>xrdp</strong>のインストールで入らなくなった模様。 なので、私がお世話になっていた下記のページの方法では少し手順が不足するようになりました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.hiroom2.com/2018/04/28/ubuntu-1804-xrdp-gnome-ja/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.hiroom2.com"></img><div class="hbc-site-name">Narrow Escape</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://image.jimcdn.com/app/cms/image/transf/dimension=4000x3000:format=png/path/sdcc8e67e188f864a/image/i02a2694d25d939a7/version/1525686928/image.png"></img></div><div class="hbc-text"><div class="hbc-title">Ubuntu 18.04: GNOMEデスクトップ環境にXRDPで接続する</div><div class="hbc-url">https://www.hiroom2.com/2018/04/28/ubuntu-1804-xrdp-gnome-ja/</div><div class="hbc-description">XRDPをインストールして、GNOMEデスクトップ環境にXRDPで接続する手順を記載します。</div></div></div></div></a></div></div><p>なので、最後に追加インストールを加えた下記のシェルで対応可能なはず。 <script src="https://gist.github.com/takuya-takeuchi/daa219001c3674aab7e5d18832d7ec88.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その186 git lfs でpushする際のコマンド</title>
      <link href="/2019/11/10/4199/"/>
      <url>/2019/11/10/4199/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>作業メモ。 Windowsからpushしようとすると色々エラーが発生し、いつも面倒だな、と思うので。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>下記で対応。 <script src="https://gist.github.com/takuya-takeuchi/6216b32c22d08e29127a60ed40262999.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで機械学習を試してみる ML.NET編 第2回</title>
      <link href="/2019/10/15/4191/"/>
      <url>/2019/10/15/4191/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/2019/10/14/4174">前回</a>の続き。</p><a id="more"></a><h1 id="デモ-の続き"><a href="#デモ-の続き" class="headerlink" title="デモ (の続き)"></a>デモ (の続き)</h1><p><a href="https://taktak.jp/2019/10/14/4174">前回</a>はプロジェクトにONNXファイルを追加し、コードが自動生成されることを確認しました。 あと、前回記述を忘れましたが、アプリは <strong>.NET Core 3.0</strong> です。</p><h2 id="パッケージ追加"><a href="#パッケージ追加" class="headerlink" title="パッケージ追加"></a>パッケージ追加</h2><p>生成されたコードは様々なパッケージに依存しています。<br><a href="../../../../public/2019/10/32eff7f7fc3f627041293d786a8ff203.png"><img src="../../../../public/2019/10/32eff7f7fc3f627041293d786a8ff203.png"></a></p><p>これを解決するために、nugetで下記のパッケージを追加します。</p><ul><li>Microsoft.Windows.SDK.Contracts<ul><li>10.0.17763.1000</li></ul></li></ul><p>これでビルドが通ります。</p><h2 id="画像の読み込み処理の下準備"><a href="#画像の読み込み処理の下準備" class="headerlink" title="画像の読み込み処理の下準備"></a>画像の読み込み処理の下準備</h2><p>前回生成した自動生成の <strong>Input クラス</strong> を下記のように修正。 <script src="https://gist.github.com/takuya-takeuchi/12387a96a0ab4f76f3d5ef2ee24dfe7d.js"></script></p><h2 id="Parserの作成"><a href="#Parserの作成" class="headerlink" title="Parserの作成"></a>Parserの作成</h2><p>先に、YOLOの出力をBoundingBoxに変換するパーサーを作ります。 幸いにして偉大なる先人が既に作成していらしたので、クラス名などを手直ししてプロジェクトに追加します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/elbruno/Blog/tree/master/20180806%20UwpMLNet%20TinyYoloV2%201.2/Yolo9000" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/3533489?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">elbruno/Blog</div><div class="hbc-url">https://github.com/elbruno/Blog/tree/master/20180806%20UwpMLNet%20TinyYoloV2%201.2/Yolo9000</div><div class="hbc-description">Source code to support some of my Blog entries. Contribute to elbruno/Blog development by creating an account on GitHub.</div></div></div></div></a></div></div><p>上から下記の2つを移植します。</p><ul><li>YoloBoundingBox.cs</li><li>YoloWinMLParser.cs</li></ul><h2 id="推論処理"><a href="#推論処理" class="headerlink" title="推論処理"></a>推論処理</h2><p>モデルファイル、画像ファイルを読みこんで推論します。 コンソールなので引数にモデルファイルと画像ファイルのパスを渡します。 また、画像に対して結果を描画したいので、下記のパッケージを追加します。</p><ul><li>System.Drawing.Common</li></ul><p>そして出来上がったのが下記。 <script src="https://gist.github.com/takuya-takeuchi/b5e1cb0848210944cf00f74d97e0f5ff.js"></script></p><p>結果の閾値は少し恣意的に選定しましたが、結果の画像は下記です。 なお、入力画像は、<a href="https://github.com/pjreddie/darknet/blob/master/data/dog.jpg">本家YOLOのリポジトリにあるサンプル画像</a>です。<br><a href="../../../../public/2019/10/result.jpg"><img src="../../../../public/2019/10/result.jpg"></a></p><p>自転車が領域に対して矩形が大きすぎますが、他は概ね正しいです。 実際のYOLO v3は正しく認識できていた記憶があるので、Tiny故の精度の低さでしょうか?</p><h1 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h1><p>C#だけでYOLOを使うことができました。 モデルファイルの推論処理周りはだいぶ楽ですが、画像の読み書きは完全にUWPの世界で正直面倒….</p><h1 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h1><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/ML.NET1/YoloTest" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/ML.NET1/YoloTest</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net-framework </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETで機械学習を試してみる ML.NET編 </category>
          
          <category> ディープラーニング </category>
          
          <category> ML.NET </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで機械学習を試してみる ML.NET編 第1回</title>
      <link href="/2019/10/14/4174/"/>
      <url>/2019/10/14/4174/</url>
      
        <content type="html"><![CDATA[<p>もう旬なネタでも無いですが。</p><a id="more"></a><h1 id="What’s-is-ML-NET"><a href="#What’s-is-ML-NET" class="headerlink" title="What’s is ML.NET?"></a>What’s is ML.NET?</h1><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://docs.microsoft.com/ja-jp/dotnet/machine-learning/how-does-mldotnet-work" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.microsoft.com"></img><div class="hbc-site-name">docs.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">ML.NET の概要とそのしくみ - ML.NET</div><div class="hbc-url">https://docs.microsoft.com/ja-jp/dotnet/machine-learning/how-does-mldotnet-work</div><div class="hbc-description">ML.NET を使用すると、オンラインまたはオフラインのどちらのシナリオでも、.NET アプリケーションに機械学習を追加できます。 この機能により、データを使った自動予測をアプリケーションで利用できるようになります。ML.NET を使うためにネットワークに接続する必要はありません…</div></div></div></div></a></div></div><p>要するに</p><ul><li>.NETアプリケーションに機械学習の機能を追加</li><li>オンライン、オフラインどっちも大丈夫だけどオフライン対応すればネットワークは気にしなくてもいい</li><li>32bitアプリも大丈夫<ul><li>ただし、Tensorflow、LightGBM、ONNXに関連する機能は使えない</li></ul></li></ul><p>って感じ。 現状、ディープラーニングの機能をエコシステム、特にデスクトップアプリに組み込むには、</p><ul><li>モデルファイルの読み込み、推論のI/F</li><li>GPUのサポート<ul><li>無くても良いが性能がボトルネックになる</li></ul></li></ul><p>が必須。 ディープラーニングの学習はPython一強で、ビジネスにデプロイしようとするとこれが足を引っ張る。 無論、Pythonで推論を提供するサーバーライクなアプリを書けば良いが、ネットワーク越しにすると、通信速度が足を引っ張る。システムにインストールするとPythonが必要になり、客先のシステムの制限に引っかかる可能性がある。 これらを打開するためにも、現在、AIを実世界にデプロイする方法がいろいろ模索されており、ML.NETもその一つ。</p><h1 id="デモ-の準備"><a href="#デモ-の準備" class="headerlink" title="デモ (の準備)"></a>デモ (の準備)</h1><p>今回は、YOLO (You Only Look Once) v2のTinyモデルで物体認識のタスクをためす。 デモの開発・実行環境</p><ul><li>Windows 10 1809以降<ul><li>Windows ML APIの正式版のため</li><li>開発自体は1809以前でも良い (Windows SDKがあれば)</li></ul></li><li>Visual Studio 2017以降<ul><li>2019のが良い</li></ul></li><li>C#の.NET Coreコンソール</li></ul><h2 id="モデルファイル"><a href="#モデルファイル" class="headerlink" title="モデルファイル"></a>モデルファイル</h2><p>モデルファイルはネットに転がっているのですが… </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://gallery.azure.ai/Model/Tiny-YOLOv2" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=gallery.azure.ai"></img><div class="hbc-site-name">Azure AI Gallery</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://az712634.vo.msecnd.net/content/14b2744cf8d6418c87ffddc3f3127242/9502630827244d60a1214f250e3bbca7/025a4433063f41528a9fea4be7e57619/aacb964eee004036a24f7d802b32a763/image"></img></div><div class="hbc-text"><div class="hbc-title">Tiny YOLOv2</div><div class="hbc-url">https://gallery.azure.ai/Model/Tiny-YOLOv2</div><div class="hbc-description">This model is a real-time neural network for object detection that detects 20 different classes. It is made up of 9 convolutional layers and…</div></div></div></div></a></div></div><p>のは <strong>使えません</strong>。 古いのか、後述のツールでコードの自動生成が効きません。 なので、githubから入手します。 </p><p><a href="../../../../public/2019/10/8b2af5a5f3b0c51914faf7ce8e0473c6.png"><img src="../../../../public/2019/10/8b2af5a5f3b0c51914faf7ce8e0473c6-1024x500.png"></a></p><p><strong>tiny_yolov2.tar.gz</strong> というファイルがダウンロードできます。 <strong>1.0 は使えない</strong> のでそれ以外を。 ダウンロード後、展開して <strong>model.onnx</strong> だけ取り出して名前を変更しておきます。 ここでは <strong>Tiny_yolov2_1.3.onnx</strong> に変更しています。</p><h2 id="コード生成"><a href="#コード生成" class="headerlink" title="コード生成"></a>コード生成</h2><p>入手したモデルファイルからコードを生成します。 機械学習の面倒なところの一つに入出力データのI/Fを合わせる、というところがあります。 どんなアプリもそうなのですが、機械学習はこのあたりが厳密。 エラー無く動いても結果がおかしい、ということは多々あります (例えば、RGBチャネルの順番が違うとか) このあたりの手間をなくすために下記の方法が用意されています。</p><ul><li>Windows Machine Learning Code Generator<ul><li>Visual Studioの拡張機能</li></ul></li><li>mlgen<ul><li>Windows SDK付属のCLI</li></ul></li></ul><h3 id="Windows-Machine-Learning-Code-Generator"><a href="#Windows-Machine-Learning-Code-Generator" class="headerlink" title="Windows Machine Learning Code Generator"></a>Windows Machine Learning Code Generator</h3><p>インストールは簡単。<br><a href="../../../../public/2019/10/84c2bd2c9ea17da274f2ee054f35a83f.png"><img src="../../../../public/2019/10/84c2bd2c9ea17da274f2ee054f35a83f.png"></a></p><p>インストール後、全てのVisual Studioを終了。再起動ではなく、終了。でないとインストーラが起動しないので。 プロジェクトに先のONNXファイルをプロジェクトに読み込ませます。 そしてプロジェクトに先のONNXファイルを追加します。 すると、ONNXファイルに対応するコードが自動生成されます。<br><a href="../../../../public/2019/10/41794d932ba8e7e87dbf64be9631aa3f.png"><img src="../../../../public/2019/10/41794d932ba8e7e87dbf64be9631aa3f.png"></a></p><p>注意するのは、フォルダの中に追加すると、プロジェクトのルートにも同じファイルが重複して生成されてしまいます。 削除すれば問題ないですが。</p><h3 id="mlgen"><a href="#mlgen" class="headerlink" title="mlgen"></a>mlgen</h3><p><strong>mlgen.exe</strong> は <strong>C:\Program Files (x86)\Windows Kits\10\bin\10.0.17763.0\x64\mlgen.exe</strong> とかのSDK配下に存在します。 ヘルプを見てみます。 <script src="https://gist.github.com/takuya-takeuchi/07152550bc8da37d80ddadcdf2950858.js"></script> 指定するのは、</p><ul><li>入力元のONNXファイルのパス</li><li>出力するコードの言語</li><li>出力するコードの名前空間<ul><li>オプション。</li></ul></li><li>出力するコードのクラス名に付与する接頭辞<ul><li>オプション。</li></ul></li><li>出力先ディレクトリ<ul><li>オプション。なければ標準出力に出力。</li></ul></li></ul><p>です。 試しに、名前空間、接頭辞、出力先を指定せずに実行してみました。 <script src="https://gist.github.com/takuya-takeuchi/a0f2369470304930d2fbd138e77bdd77.js"></script></p><p>みたいにしてみます。 先に拡張機能で生成したものと同じものができます。 (名前空間は除く)</p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p><strong>Windows 10 SDK バージョン 1903 (10.0.18362.1)</strong> からは <strong>mlgen</strong> は同梱されませんので、拡張機能を使いましょう。 古いmlgenでも良いですが、最新のONNXファイルに対応されない可能性が高いのでやめましょう。 拡張機能のディレクトリ配下にmlgen.exeがあるのでそれを使うのもありかも (<strong>C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\Common7\IDE\Extensions\brkn2ieg.yfd\mlgen.exe</strong> とか。非公式でしょうが) また、実行時、<strong>Required attribute ‘consumed_inputs’ is missing</strong> というエラーが出たりしたら、古い (例えば、10.0.17763.0より古い) mlgen で変換できたりする可能性がありますが、使わない方が無難です。古いAPIを想定しているので。 例えば、最初に使えないと話した1.0のONNXファイル。 こんな感じで全然違うコードができます。 <script src="https://gist.github.com/takuya-takeuchi/1d1549aadbbdef77aa00302a6db32e7f.js"></script></p><h1 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h1><p>今回はここまで。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net-framework </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETで機械学習を試してみる ML.NET編 </category>
          
          <category> ディープラーニング </category>
          
          <category> ML.NET </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その185 Ubuntu 16.04でデフォルトのPythonをPython3にする</title>
      <link href="/2019/10/12/4170/"/>
      <url>/2019/10/12/4170/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>作業メモ。 基本の基本ですが。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>単純に、<strong>alias</strong> 駄目でした。 どういうときに駄目だったかというと <strong>Makefile</strong> でpython呼び出してもaliasだと反映前になっていたため。 対応は <script src="https://gist.github.com/takuya-takeuchi/a697ead7a22cf531735cd34e86b149ce.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Linux </category>
          
          <category> Python </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その184 JenkinsにOSXのSlaveノードを追加する</title>
      <link href="/2019/10/05/4164/"/>
      <url>/2019/10/05/4164/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>追加する作業のメモ。 MacMiniのTimemachine復元に失敗したため再インストールしたので。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><h2 id="OSX側"><a href="#OSX側" class="headerlink" title="OSX側"></a>OSX側</h2><p>まず、秘密鍵、公開鍵を作成し、<strong>authorized_keys</strong>を作成していきます。 <script src="https://gist.github.com/takuya-takeuchi/27ad837ad33498e0b517297ea421b894.js"></script> 続いて、Javaをインストール。 サクッとHomebrewでインストール。 <script src="https://gist.github.com/takuya-takeuchi/ff5a020023c01f382831251c2b1832a8.js"></script></p><h2 id="Jenkins側"><a href="#Jenkins側" class="headerlink" title="Jenkins側"></a>Jenkins側</h2><p>注意するのは、既存のエージェント設定は作り直したほうが良いです。 というのも、認証情報だけ更新しても動作しなかったためです。 ノードを追加します。 新規で作り直すので、<strong>Permanent Agent</strong>を指定。<br><a href="../../../../public/2019/10/001.png"><img src="../../../../public/2019/10/001-1024x214.png"></a></p><p><strong>リモートFSルート</strong>はJenkinsユーザのフォルダ配下を指定します。 認証情報は次の画像のような感じ。<br><a href="../../../../public/2019/10/002.png"><img src="../../../../public/2019/10/002-1024x613.png"></a></p><p>秘密鍵は<strong>BEGIN RSA PRIVATE KEY</strong>と<strong>END RSA PRIVATE KEY</strong>を含む形でペーストします。<br><a href="../../../../public/2019/10/003.png"><img src="../../../../public/2019/10/003-1024x537.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Apple </category>
          
          <category> CI </category>
          
          <category> ci </category>
          
          <category> Jenkins </category>
          
          <category> OSX </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その183 添字演算子をポインターオブジェクトから使う</title>
      <link href="/2019/09/28/4162/"/>
      <url>/2019/09/28/4162/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://taktak.jp/2019/09/28/4159">前回</a>同様。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><script src="https://gist.github.com/takuya-takeuchi/21e571815f6bef4538289540dfb5f3a9.js"></script> ありがとう、SO!!]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その182 関数呼び出し演算子をポインターオブジェクトから使う</title>
      <link href="/2019/09/28/4159/"/>
      <url>/2019/09/28/4159/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>もうタイトルそのまま。 すぐに忘れるし、調べてもキーワードが悪いのか、すぐにたどり着けないためメモ。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><script src="https://gist.github.com/takuya-takeuchi/7672909457cbc1ccb71a6d29573a1038.js"></script> ありがとう、SO!!]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その181 公式GitLabからExportしてImportする際にエラー</title>
      <link href="/2019/09/24/4129/"/>
      <url>/2019/09/24/4129/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>公式のGitLabのリポジトリをExportしてローカルのGitLabにImportする際、下記のエラーが発生しました。<br><a href="../../../../public/2019/09/error-1.png"><img src="../../../../public/2019/09/error-1-1024x128.png"></a></p><p><strong>Import version mismatch: Required 0.2.3 but was 0.2.4</strong></p><h1 id="What-does-it-mean"><a href="#What-does-it-mean" class="headerlink" title="What does it mean?"></a>What does it mean?</h1><p>要するに <strong>(Export先のGitLabは)0.2.3を要求しているけど、(Import仕様としているデータは)0.2.4だよ</strong> ってことです。</p><p>大抵、公式のGitLabは最新版なので、ローカルのGitLabが古く、Importシステムのバージョン不一致になってしまった模様。</p><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve?"></a>How to resolve?</h1><p>安全にやるなら、ローカルのGitLabをバージョンアップするのが筋でしょうが、そうはいかないからこの記事があるわけです。 対策を探したところ、公式のIssueに </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://gitlab.com/gitlab-org/gitlab-foss/issues/27217#note_23249225" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=gitlab.com"></img><div class="hbc-site-name">GitLab</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://assets.gitlab-static.net/uploads/-/system/project/avatar/13083/logo-extra-whitespace.png"></img></div><div class="hbc-text"><div class="hbc-title">After attempting to import old project: Import version mismatch - stuck at error, can&#39;t attempt any other import (#27217) · Issues · GitLab.org / GitLab FOSS</div><div class="hbc-url">https://gitlab.com/gitlab-org/gitlab-foss/issues/27217#note_23249225</div><div class="hbc-description"> Summary I exported a project from GitLab 8.13 (if I recall correctly) a while back, which is now deleted. I just...</div></div></div></div></a></div></div><blockquote><p>If the import is small or does not have many features there are more probabilities that it will succeed, and you could try the following at your own risk:</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir project_export</span><br><span class="line">tar xfv old_export_file.tar.gz -C project_export</span><br><span class="line"><span class="built_in">cd</span> project_export</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;0.1.6&#x27;</span> &gt; VERSION</span><br><span class="line">tar czf experimental_new_project_export.tar.gz *</span><br></pre></td></tr></table></figure><p>と紹介されていました。 バージョンの不一致をだますために、内部のバージョン表記を書き換えるようです。 上のシェルを少し使いやすくしました。 <script src="https://gist.github.com/takuya-takeuchi/a69bf72041bafe66ab3d6abfa573da04.js"></script></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sample.sh 2019-09-24_01-11-731_testman_tests_export.tar 0.2.3</span><br></pre></td></tr></table></figure><p>指定したエクスポートファイルのバージョンを第2引数で指定したバージョンで上書きします。</p><p>当然ながら問題が起きる可能性がありますが、まずはお試しあれ。 ソースだけなら普通にcloneアンドpushで良いですが、Issueがあるとそうもいかず。</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その180 Ubuntuに最新のgitをインストール</title>
      <link href="/2019/09/21/4126/"/>
      <url>/2019/09/21/4126/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>もう何番煎じかわからないですが。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>最初は公式 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://launchpad.net/~git-core/+archive/ubuntu/ppa" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=launchpad.net"></img><div class="hbc-site-name">Launchpad</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="/@@/launchpad.png"></img></div><div class="hbc-text"><div class="hbc-title">Git stable releases : “Ubuntu Git Maintainers” team</div><div class="hbc-url">https://launchpad.net/~git-core/+archive/ubuntu/ppa</div><div class="hbc-description">The most current stable version of Git for Ubuntu.For release candidates, go to https://launchpad.net/~git-core/+archive/candidate .</div></div></div></div></a></div></div><p>に従ったのですが、<strong>add-apt-repository</strong>がハングしてしまいうまくいかず。 そのため、手動でsource.listを編集する方法を。 <script src="https://gist.github.com/takuya-takeuchi/351ee08b112ce9e2fb57b27e5ac5f796.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その179 Lenovo Chromebook S330にUbuntu18.04をインストールしSSHで接続</title>
      <link href="/2019/08/13/4109/"/>
      <url>/2019/08/13/4109/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>こんなのを購入して遊んでいます。 ベースはLinuxなので遊びたいのですが、Chromebookへの接続はいろいろ制限されています。 例えば、Teamviewerはクライアント専用。これは面白くないです。 なので、仮想OSとして<strong>Ubuntu 18.04</strong>をインストールし遊んでみます。</p><h1 id="Install-Ubuntu"><a href="#Install-Ubuntu" class="headerlink" title="Install Ubuntu"></a>Install Ubuntu</h1><p>まずは仮想OSのインストール。</p><h2 id="デベロッパーモードで起動"><a href="#デベロッパーモードで起動" class="headerlink" title="デベロッパーモードで起動"></a>デベロッパーモードで起動</h2><p>ESCキーとF3 (再読込ボタン) を押しながら電源を入れ、<strong>Ctrl+D</strong> を押してデベロッパーモードで起動。 ローカルのデータが消えますので購入直後に実施しましょう。</p><h2 id="croutonをインストール"><a href="#croutonをインストール" class="headerlink" title="croutonをインストール"></a>croutonをインストール</h2><p><strong>crouton</strong>は、ChromeBookにLinux環境を構築するためのツール。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/dnschneid/crouton" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/522200?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">dnschneid/crouton</div><div class="hbc-url">https://github.com/dnschneid/crouton</div><div class="hbc-description">Chromium OS Universal Chroot Environment. Contribute to dnschneid/crouton development by creating an account on GitHub.</div></div></div></div></a></div></div><p>Chromeブラウザを起動しアドレスバーに <strong><a href="https://goo.gl/fd3zc">https://goo.gl/fd3zc</a></strong> と入力し保存します。 省略アドレスで、<strong><a href="https://raw.githubusercontent.com/dnschneid/crouton/master/installer/crouton">https://raw.githubusercontent.com/dnschneid/crouton/master/installer/crouton</a></strong>にリダイレクトされます。</p><h2 id="Ubuntu-18-04をインストール"><a href="#Ubuntu-18-04をインストール" class="headerlink" title="Ubuntu 18.04をインストール"></a>Ubuntu 18.04をインストール</h2><p><strong>Ctrl+Alt+T</strong>でターミナルタブを開きます。 シェルに切り替えるために</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> shell</span></span><br></pre></td></tr></table></figure><p>と入力します。 続いて、ダウンロードしたcroutonを使い、インストールを行います。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo sh ~/Downloads/crouton -r bionic -t gnome-desktop</span></span><br></pre></td></tr></table></figure><p>実行するとインストールが始まります。 しばらくすると、インストールしたUbuntuに追加するユーザ名とパスワードを聞かれます。</p><h2 id="Ubuntu-18-04を起動"><a href="#Ubuntu-18-04を起動" class="headerlink" title="Ubuntu 18.04を起動"></a>Ubuntu 18.04を起動</h2><p>ターミナルタブから</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo startgnome</span></span><br></pre></td></tr></table></figure><p>これでUbuntuに切り替わります。 Chrome OSに戻りたい場合は、<strong>Ctrl+Alt+Shift+F1</strong>で戻ります。 停止するなら、ターミナル上で<strong>Ctrl+C</strong>で停止できます。</p><h1 id="Install-sshd"><a href="#Install-sshd" class="headerlink" title="Install sshd"></a>Install sshd</h1><p>Ubuntuにsshdをインストールします。 まずターミナルを起動します。 <strong>Activity</strong>から<strong>terminal</strong>と入力します</p><h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p>ターミナルから</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt upgrade</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install -y ssh iptables net-tools</span></span><br></pre></td></tr></table></figure><p>として必要なパッケージをインストールしておきます。 <strong>net-tools</strong>はなくてもよいですが、通信状況とかを把握したいなら必須です。</p><h2 id="ファイアウォールの変更"><a href="#ファイアウォールの変更" class="headerlink" title="ファイアウォールの変更"></a>ファイアウォールの変更</h2><p>ターミナルから <strong>/etc/rc.local</strong> を作成し、変更をします。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /etc/rc.local</span></span><br></pre></td></tr></table></figure><p>下記の内容を追加します。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sbin/iptables -P INPUT ACCEPT</span><br></pre></td></tr></table></figure><p>この内容はすべてのインバウンド通信を許可するなので不安なら </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sbin/iptables -I INPUT -p tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure><p>とします。</p><h2 id="sshd自動起動設定"><a href="#sshd自動起動設定" class="headerlink" title="sshd自動起動設定"></a>sshd自動起動設定</h2><p>続いて、**/etc/rc.local** に下記の内容を追加します。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p -m0755 /var/run/sshd</span><br><span class="line">/usr/sbin/sshd</span><br></pre></td></tr></table></figure><p>そして、保存を行い、</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo chmod 755 /etc/rc.local</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -la /etc/rc.local</span></span><br><span class="line">-rwxr-xr-x. 1 root root 115 Aug 13 04:10 /etc/rc.local</span><br></pre></td></tr></table></figure><p>実行権限を付与します。</p><h2 id="鍵の生成"><a href="#鍵の生成" class="headerlink" title="鍵の生成"></a>鍵の生成</h2><p>SSHの接続に必要なホストの秘密鍵、公開鍵を生成します。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ssh-keygen -A</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -la /etc/ssh</span></span><br><span class="line">total 596</span><br><span class="line">drwxr-xr-x.   2 root root   4096 Aug 13 04:18 .</span><br><span class="line">drwxr-xr-x. 120 root root   4096 Aug 13 04:16 ..</span><br><span class="line">-rw-r--r--.   1 root root 553122 Mar  4 21:17 moduli</span><br><span class="line">-rw-r--r--.   1 root root   1580 Mar  4 21:17 ssh_config</span><br><span class="line">-rw-r--r--.   1 root root   3264 Mar  4 21:17 sshd_config</span><br><span class="line">-rw-------.   1 root root    668 Aug 13 04:18 ssh_host_dsa_key</span><br><span class="line">-rw-r--r--.   1 root root    604 Aug 13 04:18 ssh_host_dsa_key.pub</span><br><span class="line">-rw-------.   1 root root    227 Aug 13 04:16 ssh_host_ecdsa_key</span><br><span class="line">-rw-r--r--.   1 root root    176 Aug 13 04:16 ssh_host_ecdsa_key.pub</span><br><span class="line">-rw-------.   1 root root    411 Aug 13 04:16 ssh_host_ed25519_key</span><br><span class="line">-rw-r--r--.   1 root root     96 Aug 13 04:16 ssh_host_ed25519_key.pub</span><br><span class="line">-rw-------.   1 root root   1679 Aug 13 04:16 ssh_host_rsa_key</span><br><span class="line">-rw-r--r--.   1 root root    396 Aug 13 04:16 ssh_host_rsa_key.pub</span><br><span class="line">-rw-r--r--.   1 root root    338 Aug 13 04:16 ssh_import_id</span><br></pre></td></tr></table></figure><p>実行権限を付与します。</p><h2 id="sshd起動"><a href="#sshd起動" class="headerlink" title="sshd起動"></a>sshd起動</h2><p>一度手動で起動してみます。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo /sbin/iptables -P INPUT ACCEPT</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mkdir -p -m0755 /var/run/sshd</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo /usr/sbin/sshd</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ss -lnt</span></span><br><span class="line">State         Recv-Q          Send-Q                    Local Address:Port                    Peer Address:Port</span><br><span class="line">LISTEN        0               5                             127.0.0.1:30001                        0.0.0.0:*</span><br><span class="line">LISTEN        0               128                             0.0.0.0:22                           0.0.0.0:*</span><br><span class="line">LISTEN        0               128                                [::]:22      </span><br></pre></td></tr></table></figure><p>起動が確認できれば、ChromeOSに戻ってUbuntuを停止、再度起動した後でも自動でsshdが起動します。 そして、外部からsshで接続してみます。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh hogehoge@192.168.11.XX</span></span><br><span class="line">hogehoge@192.168.11.XX&#x27;s password:</span><br><span class="line">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 3.18.0-19346-g9ff80f5e4c97 aarch64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Your Hardware Enablement Stack (HWE) is supported until April 2023.</span><br><span class="line">Last login: Tue Aug 13 04:48:22 2019 from 192.168.11.YY</span><br><span class="line">(bionic)hogehoge@localhost:~$</span><br></pre></td></tr></table></figure><p>きちんと、<strong>aarch64</strong>のUbuntuにつながっていることがわかります。</p>]]></content>
      
      
      <categories>
          
          <category> google </category>
          
          <category> Google </category>
          
          <category> Chrome OS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その178 Git LFSで巨大なファイルをpushすると i/o timeout</title>
      <link href="/2019/07/28/4104/"/>
      <url>/2019/07/28/4104/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>こんな感じのエラーがでました。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LFS: Put https://hogehoge:12345/test/sample.git/gitlab-lfs/objects/e14f763270cf193d0b5f74b169f44157a4b0c6efa708f4dd0ff78ee691763bcb/1999639040: read tcp [240b:251:2640:1600:a92c:da86:91c8:8cc5]:45540-&gt;[240b:251:2640:1600:211:32ff:fe6d:4a4b]:61792: i/o timeout</span><br><span class="line">error: failed to push some refs to &#x27;https://hogehoge:12345/test/sample.git&#x27;</span><br></pre></td></tr></table></figure><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve?"></a>How to resolve?</h1><p>タイムアウト値の延長またはタイムアウトを無効にします。 ユーザー全体なら<strong>--global</strong>をつけます。</p><h2 id="無効"><a href="#無効" class="headerlink" title="無効"></a>無効</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> git config lfs.activitytimeout 0</span></span><br></pre></td></tr></table></figure><h2 id="X-秒に延長"><a href="#X-秒に延長" class="headerlink" title="X 秒に延長"></a>X 秒に延長</h2><p>数字の単位は秒。下記は30秒。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> git config lfs.activitytimeout 30</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その177 Visual Studio Code Remote SSHでつながらない</title>
      <link href="/2019/07/06/4096/"/>
      <url>/2019/07/06/4096/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>メモ。</p><h1 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h1><h2 id="ssh-config-の場所が悪い"><a href="#ssh-config-の場所が悪い" class="headerlink" title="ssh.config の場所が悪い"></a>ssh.config の場所が悪い</h2><p>接続に失敗した際、出力コンソールに下記のようなログが出ていました。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">remote-ssh@0.44.0</span><br><span class="line">win32 x64</span><br><span class="line">SSH Resolver called for &quot;ssh-remote+7b22686f73744e616d65223a223139322e3136382e31312e31315b5562756e74755f31382e30342e325f4c54535d222c2275736572223a22742d74616b6575636869227d&quot;, attempt 1</span><br><span class="line">SSH Resolver called for host: t-takeuchi@192.168.11.11[Ubuntu_18.04.2_LTS]</span><br><span class="line">Setting up SSH remote &quot;192.168.11.11[Ubuntu_18.04.2_LTS]&quot;</span><br><span class="line">Using commit id &quot;0f3794b38477eea13fb47fbe15a42798e6129338&quot; and quality &quot;stable&quot; for server</span><br><span class="line">Testing ssh with ssh -V</span><br><span class="line">ssh exited with code: 0</span><br><span class="line">Got stderr from ssh: OpenSSH_for_Windows_7.7p1, LibreSSL 2.6.5</span><br><span class="line">Using SSH config file &quot;C:\Users\TAKUYA\Dropbox\Settings\Visual Studio Code\Remote Development\ssh.config&quot;</span><br><span class="line">Install and start server if needed</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Can<span class="string">&#x27;t open user config file C:\\XXXX\\Visual: No suc</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> h file or directory</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> プロセスが、存在しないパイプに書き込もうとしました。</span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line">&quot;install&quot; terminal command done</span><br><span class="line">Received install output: プロセスが、存在しないパイプに書き込もうとしました。</span><br><span class="line">Failed to parse remote port from server output: プロセスが、存在しないパイプに書き込もうとしました。</span><br></pre></td></tr></table></figure><p>ログを書き込もうとしたら、書き込みに失敗したもよう。 原因が<strong>ssh.config</strong>をおいたパスに空白が含まれている、ということ。 それくらい対処してくださいよ、Microsoftさん。</p><h2 id="Windowsの環境変数なんてしらない"><a href="#Windowsの環境変数なんてしらない" class="headerlink" title="Windowsの環境変数なんてしらない"></a>Windowsの環境変数なんてしらない</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">remote-ssh@0.44.0</span><br><span class="line">win32 x64</span><br><span class="line">SSH Resolver called for &quot;ssh-remote+192.168.11.11&quot;, attempt 1</span><br><span class="line">SSH Resolver called for host: 192.168.11.11</span><br><span class="line">Setting up SSH remote &quot;192.168.11.11&quot;</span><br><span class="line">Using commit id &quot;0f3794b38477eea13fb47fbe15a42798e6129338&quot; and quality &quot;stable&quot; for server</span><br><span class="line">Testing ssh with ssh -V</span><br><span class="line">ssh exited with code: 0</span><br><span class="line">Got stderr from ssh: OpenSSH_for_Windows_7.7p1, LibreSSL 2.6.5</span><br><span class="line">Using SSH config file &quot;C:\XXXX\ssh.config&quot;</span><br><span class="line">Install and start server if needed</span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> percent_expand: unknown key %U</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> プロセスが、存在しないパイプに書き込もうとしました。</span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line">&quot;install&quot; terminal command done</span><br><span class="line">Received install output: プロセスが、存在しないパイプに書き込もうとしました。</span><br><span class="line">Failed to parse remote port from server output: プロセスが、存在しないパイプに書き込もうとしました。</span><br></pre></td></tr></table></figure><p><strong>ssh.confg</strong>で秘密鍵のファイルパスに**環境変数%USERPROFILE%**を使おうとしたためです。 環境変数は使わないほうがよいでしょう。</p><h2 id="OSXにつながらない"><a href="#OSXにつながらない" class="headerlink" title="OSXにつながらない"></a>OSXにつながらない</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">remote-ssh@0.44.0</span><br><span class="line">win32 x64</span><br><span class="line">SSH Resolver called for &quot;ssh-remote+7b22686f73744e616d65223a224d61634d696e69283139322e3136382e31312e3829227d&quot;, attempt 1</span><br><span class="line">SSH Resolver called for host: MacMini(192.168.11.8)</span><br><span class="line">Setting up SSH remote &quot;MacMini(192.168.11.8)&quot;</span><br><span class="line">Using commit id &quot;0f3794b38477eea13fb47fbe15a42798e6129338&quot; and quality &quot;stable&quot; for server</span><br><span class="line">Testing ssh with ssh -V</span><br><span class="line">ssh exited with code: 0</span><br><span class="line">Got stderr from ssh: OpenSSH_for_Windows_7.7p1, LibreSSL 2.6.5</span><br><span class="line">Using SSH config file &quot;C:\XXXX\ssh.config&quot;</span><br><span class="line">Install and start server if needed</span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Password:</span></span><br><span class="line">&quot;install&quot; wrote data to terminal: &quot;**********&quot;</span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> sed: 1: <span class="string">&quot;s/^linux //gi&quot;</span>: bad flag <span class="keyword">in</span> substitute <span class="built_in">command</span>: <span class="string">&#x27;i&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Unsupported architecture:</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> a223db13-3bae-4f5f-ab69-b2f577125593<span class="comment">##27##</span></span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line">&quot;install&quot; terminal command done</span><br><span class="line">Received install output: a223db13-3bae-4f5f-ab69-b2f577125593##27##</span><br><span class="line">Unsupported architecture</span><br><span class="line">The remote server architecture is not supported</span><br><span class="line">------</span><br></pre></td></tr></table></figure><p>OSXは<strong>FrerBSD</strong>の派生です。 <strong>sed</strong>コマンドはFreeBSDとLinuxではコマンドが異なります。 公式を確認してもOSXが使えない、という表記が見つかりませんでしたが、おそらくダメでしょう。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その176 Docker Jenkins in Synology NAS</title>
      <link href="/2019/06/14/4074/"/>
      <url>/2019/06/14/4074/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Jenkins</strong>をSynology NASに構築したのでメモ。 Slaveノードは別マシンに構築します。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><h2 id="用意するもの"><a href="#用意するもの" class="headerlink" title="用意するもの"></a>用意するもの</h2><p>jenkinsのディレクトリを用意します。 これらはdockerコンテナにマウントされます。 今回は下記をマウントします。</p><ul><li>/docker/jenkins/jenkins_home</li><li>/docker/jenkins/share/jenkins</li><li>/docker/jenkins/share/jenkins/ref</li></ul><p>そして権限を変更します。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo chown -R 1000 /volume1/docker/jenkins</span></span><br></pre></td></tr></table></figure><h4 id="Jenkinsのダウンロード"><a href="#Jenkinsのダウンロード" class="headerlink" title="Jenkinsのダウンロード"></a>Jenkinsのダウンロード</h4><p>dockerの場合、コンテナ内のデータは破棄されてしまうため、Jenkins本体をマウントする形にすることでアップデートできるようにします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://jenkins.io/download/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=jenkins.io"></img><div class="hbc-site-name">Jenkins download and deployment</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://www.jenkins.io/images/logo-title-opengraph.png"></img></div><div class="hbc-text"><div class="hbc-title">Jenkins download and deployment</div><div class="hbc-url">https://jenkins.io/download/</div><div class="hbc-description">Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software</div></div></div></div></a></div></div><p><strong>Generic Java package (.war)**をダウンロードし、</strong>Jenkins.war<strong>を</strong>/docker/jenkins/share/jenkins**にコピーします。</p><h4 id="キーストアの作成"><a href="#キーストアの作成" class="headerlink" title="キーストアの作成"></a>キーストアの作成</h4><p>HTTPSで接続するために作成します。既に<strong>Let’s Encrypt</strong>で証明書は発行済みであるものとします。 HTTPで良い場合は、必要ありません。 Javaをインストールする必要があるので<strong>パッケージ センター</strong>からインストールします。 <strong>パッケージ センター</strong><br><a href="../../../../public/2019/06/01-1.png"><img src="../../../../public/2019/06/01-1-1024x560.png"></a></p><p><strong>インストール後のパス</strong><br><a href="../../../../public/2019/06/02-1.png"><img src="../../../../public/2019/06/02-1.png"></a></p><p>続いて、下記のシェルをsudoで実行します。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">KEYROOT=/usr/syno/etc/certificate/system/default</span><br><span class="line">KEY_PEM=$&#123;KEYROOT&#125;/privkey.pem</span><br><span class="line">CERT_PEM=$&#123;KEYROOT&#125;/cert.pem</span><br><span class="line">JAVA_HOME=/var/packages/Java7/target/j2sdk-image/jre/bin</span><br><span class="line">KEYSTORE=/volume1/docker/jenkins/jenkins_home/keystore</span><br><span class="line"></span><br><span class="line">openssl rsa -des3 -in $KEY_PEM -out key.encrypted.pem</span><br><span class="line">openssl pkcs12 -inkey key.encrypted.pem -in $CERT_PEM -export -out keys.encrypted.pkcs12</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;JAVA_HOME&#125;/keytool -importkeystore -srckeystore keys.encrypted.pkcs12 -srcstoretype pkcs12 -destkeystore <span class="variable">$KEYSTORE</span></span></span><br></pre></td></tr></table></figure><p>下記のように実行します。 パスワードの空文字は許容されません。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ./generate_jenkins_keystore.sh</span></span><br><span class="line">writing RSA key</span><br><span class="line">Enter PEM pass phrase:</span><br><span class="line">Verifying - Enter PEM pass phrase:</span><br><span class="line">Enter pass phrase for key.encrypted.pem:</span><br><span class="line">Enter Export Password:</span><br><span class="line">Verifying - Enter Export Password:</span><br><span class="line">Importing keystore keys.encrypted.pkcs12 to /volume1/docker/jenkins/keystore_...</span><br><span class="line">Enter destination keystore password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">Enter source keystore password:</span><br><span class="line">Entry for alias 1 successfully imported.</span><br><span class="line">Import command completed:  1 entries successfully imported, 0 entries failed or cancelled</span><br><span class="line"></span><br><span class="line">Warning:</span><br><span class="line">The JKS keystore uses a proprietary format. It is recommended to migrate to PKCS12 which is an industry standard format using &quot;keytool -importkeystore -srckeystore /volume1/docker/jenkins/keystore_ -destkeystore /volume1/docker/jenkins/keystore_ -deststoretype pkcs12&quot;.</span><br></pre></td></tr></table></figure><h4 id="コンテナの作成"><a href="#コンテナの作成" class="headerlink" title="コンテナの作成"></a>コンテナの作成</h4><p>キーストア作成の時に入力したパスワードを指定してコンテナの起動を実行します。 ホスト側のポートは適宜変更します。 HTTPで良い場合は、<strong>--http</strong>から始まる引数を削除します。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo docker run -v /volume1/docker/jenkins/jenkins_home:/var/jenkins_home \</span></span><br><span class="line">                  -v /volume1/docker/jenkins/share/jenkins:/usr/share/jenkins \</span><br><span class="line">                  -p 38080:8443 \</span><br><span class="line">                  -p 50003:50000 \</span><br><span class="line">                  --name jenkins \</span><br><span class="line">                  jenkins/jenkins:alpine \</span><br><span class="line">                  --httpPort=-1 \</span><br><span class="line">                  --httpsPort=8443 \</span><br><span class="line">                  --httpsKeyStore=/var/jenkins_home/keystore \</span><br><span class="line">                  --httpsKeyStorePassword=</span><br></pre></td></tr></table></figure><p>コンソールが流れてしばらくすると<strong>admin</strong>の初期パスワードが表示されますのでメモしておきます。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br><span class="line"></span><br><span class="line">Jenkins initial setup is required. An admin user has been created and a password generated.</span><br><span class="line">Please use the following password to proceed to installation:</span><br><span class="line"></span><br><span class="line">b0c58624703945a3ba1517b556b0f1bc</span><br><span class="line"></span><br><span class="line">This may also be found at: /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line"></span><br><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br><span class="line">*************************************************************</span><br></pre></td></tr></table></figure><h4 id="初期設定"><a href="#初期設定" class="headerlink" title="初期設定"></a>初期設定</h4><p>ブラウザからアクセスします。 <strong>Jenkinsのアンロック。メモした初期パスワードを入力</strong></p><p><strong>Jenkinsのアンロック</strong><br><a href="../../../../public/2019/06/03-1.png"><img src="../../../../public/2019/06/03-1-1024x840.png"></a></p><p><strong>プラグインのインストール。Install suggested plugins を選択</strong><br><a href="../../../../public/2019/06/04-1.png"><img src="../../../../public/2019/06/04-1-1024x840.png"></a></p><p><strong>インストール中</strong><br><a href="../../../../public/2019/06/05-1.png"><img src="../../../../public/2019/06/05-1-1024x840.png"></a></p><p><strong>ユーザ登録。入力後、Save and Finish</strong><br><a href="../../../../public/2019/06/06-1.png"><img src="../../../../public/2019/06/06-1-1024x840.png"></a></p><p><strong>準備完了</strong><br><a href="../../../../public/2019/06/07.png"><img src="../../../../public/2019/06/07-1024x840.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> CI </category>
          
          <category> NAS </category>
          
          <category> Synology </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その175 Docker Registry in Synology NAS</title>
      <link href="/2019/06/09/4060/"/>
      <url>/2019/06/09/4060/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Dockerイメージを保存するプライベートなDocker RegistryをSynology NASに構築したのでメモ。 Docker Registryもdockerコンテナとして動作します。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><h2 id="用意するもの"><a href="#用意するもの" class="headerlink" title="用意するもの"></a>用意するもの</h2><p>設定ファイル、イメージを格納するディレクトリを用意します。 これらはdockerコンテナにマウントされます。 今回は下記をマウントします。</p><ul><li>/docker/registry/config/config.yml</li><li>/docker/registry/config/htpasswd</li><li>/docker/registry/images</li><li>/docker/registry/certs</li></ul><h4 id="docker-registry-config-config-yml"><a href="#docker-registry-config-config-yml" class="headerlink" title="/docker/registry/config/config.yml"></a>/docker/registry/config/config.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">0.1</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">  <span class="attr">fields:</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">registry</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">delete:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>     <span class="comment"># open delete api</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">blobdescriptor:</span> <span class="string">inmemory</span></span><br><span class="line">  <span class="attr">filesystem:</span></span><br><span class="line">    <span class="attr">rootdirectory:</span> <span class="string">/var/lib/registry</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">  <span class="attr">addr:</span> <span class="string">:5000</span></span><br><span class="line">  <span class="attr">headers:</span></span><br><span class="line">    <span class="attr">X-Content-Type-Options:</span> [<span class="string">nosniff</span>]</span><br><span class="line"><span class="attr">health:</span></span><br><span class="line">  <span class="attr">storagedriver:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">threshold:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">auth:</span></span><br><span class="line">  <span class="attr">htpasswd:</span></span><br><span class="line">    <span class="attr">realm:</span> <span class="string">basic-realm</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/auth/htpasswd</span>    <span class="comment"># use apache basic-auth</span></span><br></pre></td></tr></table></figure><h4 id="docker-registry-config-htpasswd"><a href="#docker-registry-config-htpasswd" class="headerlink" title="/docker/registry/config/htpasswd"></a>/docker/registry/config/htpasswd</h4><p>registryへのログインパスワードを格納するファイルです。 下記のようにdockerコンテナに作らせます。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run --rm -ti xmartlabs/htpasswd   &gt; htpasswd</span></span><br></pre></td></tr></table></figure><h4 id="docker-registry-images"><a href="#docker-registry-images" class="headerlink" title="/docker/registry/images"></a>/docker/registry/images</h4><p>dockerイメージの保存先です。 ただのフォルダです。</p><h4 id="docker-registry-certs"><a href="#docker-registry-certs" class="headerlink" title="/docker/registry/certs"></a>/docker/registry/certs</h4><p>sslのための証明書、<em>.crt、</em>.keyを格納しておきます。 <strong>Let’s Encrypt</strong>が更新されたらここを更新します。 HTTPSでregistryにアクセスするのが基本です。ここを設定しなくても利用はできますが、dockerの設定で信頼できないregistryにアクセスできるよう設定を追加する必要があるので、ここはきちんと設定しておきます。</p><h2 id="コンテナ作成"><a href="#コンテナ作成" class="headerlink" title="コンテナ作成"></a>コンテナ作成</h2><p><strong>registryをpullします</strong><br><a href="../../../../public/2019/06/01.png"><img src="../../../../public/2019/06/01-1024x553.png"></a></p><p><strong>pullできました</strong><br><a href="../../../../public/2019/06/02.png"><img src="../../../../public/2019/06/02-1024x551.png"></a></p><p><strong>コンテナを作成します</strong><br><a href="../../../../public/2019/06/03.png"><img src="../../../../public/2019/06/03.png"></a></p><p><strong>詳細設定のボリューム</strong><br><a href="../../../../public/2019/06/04.png"><img src="../../../../public/2019/06/04.png"></a></p><p><strong>詳細設定のポート設定</strong><br><a href="../../../../public/2019/06/05.png"><img src="../../../../public/2019/06/05.png"></a></p><p><strong>詳細設定の環境</strong><br><a href="../../../../public/2019/06/06.png"><img src="../../../../public/2019/06/06.png"></a></p><p>以上で完成です。</p><h2 id="動作確認"><a href="#動作確認" class="headerlink" title="動作確認"></a>動作確認</h2><p>コンテナを起動後、dockerからログインできるかどうかを確認します。 ポート番号を確認し下記のように確認しておきます。 usernameとpasswordは最初に作ったhtpasswdファイルで作成した情報になります。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> docker login https://hogehoge:28009/</span></span><br><span class="line">Username: xxxxxx</span><br><span class="line">Password:</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure><p>もしssl設定をしていない場合は下記のようになりますので、クライアント側でdockerの設定を変更しておきます。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> docker login http://192.168.11.17:28009</span></span><br><span class="line">Username: xxxxxx</span><br><span class="line">Password:</span><br><span class="line">Error response from daemon: Get https://192.168.11.17:28009/v2/: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> NAS </category>
          
          <category> Synology </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その174 WindowsコンテナとLinuxコンテナを共存させる</title>
      <link href="/2019/06/09/4052/"/>
      <url>/2019/06/09/4052/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://wp.me/p9QCo1-13h">前回</a>はシステムで利用するコンテナをWindowsからLinuxコンテナ、その逆と切り替えてみました。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>まずWindowsコンテナに切り替えます。 そして<strong>Experimental</strong>を有効化します。<br><a href="../../../../public/2019/06/docker.png"><img src="../../../../public/2019/06/docker.png"></a></p><h2 id="Linux-イメージを動かしてみる"><a href="#Linux-イメージを動かしてみる" class="headerlink" title="Linux イメージを動かしてみる"></a>Linux イメージを動かしてみる</h2><p>alpineコンテナが動いています。 ホストのディレクトリもマウントできています。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker version</span><br><span class="line"><span class="function">Client: <span class="title">Docker</span> <span class="title">Engine</span> - <span class="title">Community</span></span></span><br><span class="line"><span class="function"> <span class="title">Version</span>:           18.09.2</span></span><br><span class="line"><span class="function"> <span class="title">API</span> <span class="title">version</span>:       1.39</span></span><br><span class="line"><span class="function"> <span class="title">Go</span> <span class="title">version</span>:        <span class="title">go1</span>.10.8</span></span><br><span class="line"><span class="function"> <span class="title">Git</span> <span class="title">commit</span>:        6247962</span></span><br><span class="line"><span class="function"> <span class="title">Built</span>:             <span class="title">Sun</span> <span class="title">Feb</span> 10 04:12:31 2019</span></span><br><span class="line"><span class="function"> <span class="title">OS</span>/<span class="title">Arch</span>:           <span class="title">windows</span>/<span class="title">amd64</span></span></span><br><span class="line"><span class="function"> <span class="title">Experimental</span>:      <span class="title">false</span></span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"><span class="title">Server</span>: <span class="title">Docker</span> <span class="title">Engine</span> - <span class="title">Community</span></span></span><br><span class="line"><span class="function"> <span class="title">Engine</span>:</span></span><br><span class="line"><span class="function">  <span class="title">Version</span>:          18.09.2</span></span><br><span class="line"><span class="function">  <span class="title">API</span> <span class="title">version</span>:      1.39 (<span class="title">minimum</span> <span class="title">version</span> 1.24)</span></span><br><span class="line"><span class="function">  <span class="title">Go</span> <span class="title">version</span>:       <span class="title">go1</span>.10.6</span></span><br><span class="line"><span class="function">  <span class="title">Git</span> <span class="title">commit</span>:       6247962</span></span><br><span class="line"><span class="function">  <span class="title">Built</span>:            <span class="title">Sun</span> <span class="title">Feb</span> 10 04:28:48 2019</span></span><br><span class="line"><span class="function">  <span class="title">OS</span>/<span class="title">Arch</span>:          <span class="title">windows</span>/<span class="title">amd64</span></span></span><br><span class="line"><span class="function">  <span class="title">Experimental</span>:     <span class="title">true</span></span></span><br><span class="line"><span class="function">&gt; <span class="title">docker</span> <span class="title">run</span> --<span class="title">rm</span> -<span class="title">v</span> <span class="title">c</span>:/<span class="title">Users</span>:/<span class="title">data</span> <span class="title">alpine</span> <span class="title">ls</span> /<span class="title">data</span></span></span><br><span class="line"><span class="function"><span class="title">All</span> <span class="title">Users</span></span></span><br><span class="line"><span class="function"><span class="title">Default</span></span></span><br><span class="line"><span class="function"><span class="title">Default</span> <span class="title">User</span></span></span><br><span class="line"><span class="function"><span class="title">DefaultAppPool</span></span></span><br><span class="line"><span class="function"><span class="title">Public</span></span></span><br><span class="line"><span class="function"><span class="title">TAKUYA</span></span></span><br><span class="line"><span class="function"><span class="title">desktop.ini</span></span></span><br></pre></td></tr></table></figure><h2 id="Windowsイメージ"><a href="#Windowsイメージ" class="headerlink" title="Windowsイメージ"></a>Windowsイメージ</h2><p><strong>Windows Server Core</strong>と<strong>alpine</strong>が表示されています。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker images</span><br><span class="line">REPOSITORY                               TAG                             IMAGE ID            CREATED             SIZE</span><br><span class="line">nvidia/cuda                              <span class="number">10</span>.<span class="number">0</span>-cudnn7-devel-ubuntu16.<span class="number">04</span>   c963dc0723b7        <span class="number">8</span> days ago          <span class="number">3</span>.<span class="number">17</span>GB</span><br><span class="line">nvidia/cuda                              <span class="number">9</span>.<span class="number">2</span>-cudnn7-devel-ubuntu16.<span class="number">04</span>    fa48202870f2        <span class="number">8</span> days ago          <span class="number">3</span>.<span class="number">09</span>GB</span><br><span class="line">mcr.microsoft.com/windows/servercore     <span class="number">1809</span>-amd64                      <span class="number">43</span>c05724e30b        <span class="number">2</span> weeks ago         <span class="number">4</span>.<span class="number">56</span>GB</span><br><span class="line">ubuntu                                   <span class="number">16</span>.<span class="number">04</span>                           <span class="number">2</span>a697363a870        <span class="number">3</span> weeks ago         <span class="number">134</span>MB</span><br><span class="line">alpine                                   latest                          <span class="number">055936</span>d39205        <span class="number">4</span> weeks ago         <span class="number">6</span>.<span class="number">28</span>MB</span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>Windowsコンテナに切り替えればイメージを共存されることができました。 ドライブの共有も問題なしです。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その173 WindowsコンテナとLinuxコンテナを切り替える</title>
      <link href="/2019/06/09/4047/"/>
      <url>/2019/06/09/4047/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Docker for Windows</strong>でコンテナを切り替えてみました。 環境はこんな感じです。<br><a href="../../../../public/2019/06/docker_about.png"><img src="../../../../public/2019/06/docker_about.png"></a></p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>特に難しいことはありません。 タスクトレイの**Switch to Windows containers…**をクリックするだけです。</p><h2 id="Linux-から-Windows-へ"><a href="#Linux-から-Windows-へ" class="headerlink" title="Linux から Windows へ"></a>Linux から Windows へ</h2><p>切り替えた直後です。 イメージが消えています。ちょっと驚きます。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker version</span><br><span class="line"><span class="function">Client: <span class="title">Docker</span> <span class="title">Engine</span> - <span class="title">Community</span></span></span><br><span class="line"><span class="function"> <span class="title">Version</span>:           18.09.2</span></span><br><span class="line"><span class="function"> <span class="title">API</span> <span class="title">version</span>:       1.39</span></span><br><span class="line"><span class="function"> <span class="title">Go</span> <span class="title">version</span>:        <span class="title">go1</span>.10.8</span></span><br><span class="line"><span class="function"> <span class="title">Git</span> <span class="title">commit</span>:        6247962</span></span><br><span class="line"><span class="function"> <span class="title">Built</span>:             <span class="title">Sun</span> <span class="title">Feb</span> 10 04:12:31 2019</span></span><br><span class="line"><span class="function"> <span class="title">OS</span>/<span class="title">Arch</span>:           <span class="title">windows</span>/<span class="title">amd64</span></span></span><br><span class="line"><span class="function"> <span class="title">Experimental</span>:      <span class="title">false</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Server</span>: <span class="title">Docker</span> <span class="title">Engine</span> - <span class="title">Community</span></span></span><br><span class="line"><span class="function"> <span class="title">Engine</span>:</span></span><br><span class="line"><span class="function">  <span class="title">Version</span>:          18.09.2</span></span><br><span class="line"><span class="function">  <span class="title">API</span> <span class="title">version</span>:      1.39 (<span class="title">minimum</span> <span class="title">version</span> 1.24)</span></span><br><span class="line"><span class="function">  <span class="title">Go</span> <span class="title">version</span>:       <span class="title">go1</span>.10.6</span></span><br><span class="line"><span class="function">  <span class="title">Git</span> <span class="title">commit</span>:       6247962</span></span><br><span class="line"><span class="function">  <span class="title">Built</span>:            <span class="title">Sun</span> <span class="title">Feb</span> 10 04:28:48 2019</span></span><br><span class="line"><span class="function">  <span class="title">OS</span>/<span class="title">Arch</span>:          <span class="title">windows</span>/<span class="title">amd64</span></span></span><br><span class="line"><span class="function">  <span class="title">Experimental</span>:     <span class="title">false</span></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Users</span>\<span class="title">TAKUYA</span>&gt;<span class="title">docker</span> <span class="title">images</span></span></span><br><span class="line"><span class="function"><span class="title">REPOSITORY</span>          <span class="title">TAG</span>                 <span class="title">IMAGE</span> <span class="title">ID</span>            <span class="title">CREATED</span>             <span class="title">SIZE</span></span></span><br></pre></td></tr></table></figure><h2 id="Windows-から-Linux-へ"><a href="#Windows-から-Linux-へ" class="headerlink" title="Windows から Linux へ"></a>Windows から Linux へ</h2><p>戻してみます。 イメージが戻っています。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker version</span><br><span class="line"><span class="function">Client: <span class="title">Docker</span> <span class="title">Engine</span> - <span class="title">Community</span></span></span><br><span class="line"><span class="function"> <span class="title">Version</span>:           18.09.2</span></span><br><span class="line"><span class="function"> <span class="title">API</span> <span class="title">version</span>:       1.39</span></span><br><span class="line"><span class="function"> <span class="title">Go</span> <span class="title">version</span>:        <span class="title">go1</span>.10.8</span></span><br><span class="line"><span class="function"> <span class="title">Git</span> <span class="title">commit</span>:        6247962</span></span><br><span class="line"><span class="function"> <span class="title">Built</span>:             <span class="title">Sun</span> <span class="title">Feb</span> 10 04:12:31 2019</span></span><br><span class="line"><span class="function"> <span class="title">OS</span>/<span class="title">Arch</span>:           <span class="title">windows</span>/<span class="title">amd64</span></span></span><br><span class="line"><span class="function"> <span class="title">Experimental</span>:      <span class="title">false</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Server</span>: <span class="title">Docker</span> <span class="title">Engine</span> - <span class="title">Community</span></span></span><br><span class="line"><span class="function"> <span class="title">Engine</span>:</span></span><br><span class="line"><span class="function">  <span class="title">Version</span>:          18.09.2</span></span><br><span class="line"><span class="function">  <span class="title">API</span> <span class="title">version</span>:      1.39 (<span class="title">minimum</span> <span class="title">version</span> 1.12)</span></span><br><span class="line"><span class="function">  <span class="title">Go</span> <span class="title">version</span>:       <span class="title">go1</span>.10.6</span></span><br><span class="line"><span class="function">  <span class="title">Git</span> <span class="title">commit</span>:       6247962</span></span><br><span class="line"><span class="function">  <span class="title">Built</span>:            <span class="title">Sun</span> <span class="title">Feb</span> 10 04:13:06 2019</span></span><br><span class="line"><span class="function">  <span class="title">OS</span>/<span class="title">Arch</span>:          <span class="title">linux</span>/<span class="title">amd64</span></span></span><br><span class="line"><span class="function">  <span class="title">Experimental</span>:     <span class="title">true</span></span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Users</span>\<span class="title">TAKUYA</span>&gt;<span class="title">docker</span> <span class="title">images</span></span></span><br><span class="line"><span class="function"><span class="title">REPOSITORY</span>                               <span class="title">TAG</span>                             <span class="title">IMAGE</span> <span class="title">ID</span>            <span class="title">CREATED</span>             <span class="title">SIZE</span></span></span><br><span class="line"><span class="function"><span class="title">mcr.microsoft.com</span>/<span class="title">dotnet</span>/<span class="title">core</span>/<span class="title">sdk</span>        2.1-<span class="title">bionic</span>                      28<span class="title">d5b1e8a03b</span>        2 <span class="title">weeks</span> <span class="title">ago</span>         1.7<span class="title">GB</span></span></span><br><span class="line"><span class="function"><span class="title">mcr.microsoft.com</span>/<span class="title">dotnet</span>/<span class="title">core</span>/<span class="title">runtime</span>    2.1-<span class="title">bionic</span>                      51<span class="title">c475cc6ed8</span>        2 <span class="title">weeks</span> <span class="title">ago</span>         194<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">ubuntu</span>                                   <span class="title">latest</span>                          7698<span class="title">f282e524</span>        3 <span class="title">weeks</span> <span class="title">ago</span>         69.9<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">nvidia</span>/<span class="title">cuda</span>                              10.0-<span class="title">cudnn7</span>-<span class="title">devel</span>-<span class="title">centos6</span>       1<span class="title">d245213a2c9</span>        2 <span class="title">months</span> <span class="title">ago</span>        2.88<span class="title">GB</span></span></span><br><span class="line"><span class="function"><span class="title">nvidia</span>/<span class="title">cuda</span>                              10.0-<span class="title">cudnn7</span>-<span class="title">devel</span>-<span class="title">ubuntu16</span>.04   <span class="title">e1d637677e0d</span>        2 <span class="title">months</span> <span class="title">ago</span>        3.08<span class="title">GB</span></span></span><br><span class="line"><span class="function"><span class="title">centos</span>                                   7                               9<span class="title">f38484d220f</span>        2 <span class="title">months</span> <span class="title">ago</span>        202<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">ubuntu</span>                                   16.04                           7<span class="title">e87e2b3bf7a</span>        4 <span class="title">months</span> <span class="title">ago</span>        117<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">ubuntu</span>                                   14.04                           5<span class="title">dbc3f318ea5</span>        4 <span class="title">months</span> <span class="title">ago</span>        188<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">ubuntu</span>                                   18.04                           20<span class="title">bb25d32758</span>        4 <span class="title">months</span> <span class="title">ago</span>        87.5<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">alpine</span>                                   <span class="title">edge</span>                            <span class="title">dacde26455ab</span>        5 <span class="title">months</span> <span class="title">ago</span>        5.28<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">alpine</span>                                   <span class="title">latest</span>                          3<span class="title">f53bb00af94</span>        5 <span class="title">months</span> <span class="title">ago</span>        4.41<span class="title">MB</span></span></span><br><span class="line"><span class="function"><span class="title">nvidia</span>/<span class="title">cuda</span>                              9.2-<span class="title">cudnn7</span>-<span class="title">devel</span>-<span class="title">ubuntu16</span>.04    7<span class="title">affc4c2ce61</span>        6 <span class="title">months</span> <span class="title">ago</span>        2.9<span class="title">GB</span></span></span><br><span class="line"><span class="function"><span class="title">nvidia</span>/<span class="title">cuda</span>                              9.2-<span class="title">cudnn7</span>-<span class="title">devel</span>-<span class="title">centos6</span>        <span class="title">b26377b9a39a</span>        7 <span class="title">months</span> <span class="title">ago</span>        2.82<span class="title">GB</span></span></span><br><span class="line"><span class="function"><span class="title">docker4w</span>/<span class="title">nsenter</span>-<span class="title">dockerd</span>                 <span class="title">latest</span>                          2<span class="title">f1c802f322f</span>        7 <span class="title">months</span> <span class="title">ago</span>        187<span class="title">kB</span></span></span><br><span class="line"><span class="function"><span class="title">centos</span>                                   6.10                            30<span class="title">e66b619e9f</span>        8 <span class="title">months</span> <span class="title">ago</span>        194<span class="title">MB</span></span></span><br></pre></td></tr></table></figure><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>イメージを共存することはできませんが、切り替えたからと言って前の環境に戻せなくなる、ということはありません。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その172 Synology GitLabでLFSを使ってみる</title>
      <link href="/2019/05/20/4042/"/>
      <url>/2019/05/20/4042/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>自宅のNASでGitLabをDockerで運用していますが、LFSを有効にするのに苦労したのでメモ。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><h2 id="URL変更"><a href="#URL変更" class="headerlink" title="URL変更"></a>URL変更</h2><p>Dockerの環境変数で<strong>GITLAB_HOST</strong>を変更します。 既定では<strong>localhost</strong>になっているので変更します。</p><h2 id="HTTPS有効"><a href="#HTTPS有効" class="headerlink" title="HTTPS有効"></a>HTTPS有効</h2><p>これは私の環境では有効だったのでスキップ。 ただ、Dockerの環境変数で<strong>GITLAB_PORT</strong>に対応するGitLabのポートが<strong>80</strong>のため、ここを<strong>443</strong>に変更します。</p><h2 id="プロジェクトでLFSを有効"><a href="#プロジェクトでLFSを有効" class="headerlink" title="プロジェクトでLFSを有効"></a>プロジェクトでLFSを有効</h2><p><strong>General Settings</strong>の<strong>Permissions</strong>から<strong>Git Large File Storage</strong>を有効にします。 これは各プロジェクトで有効にします。</p><h2 id="クローン-amp-プッシュ"><a href="#クローン-amp-プッシュ" class="headerlink" title="クローン&amp;プッシュ"></a>クローン&amp;プッシュ</h2><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git clone https://hogehoge.com/data/test.git</span><br><span class="line"><span class="built_in">cd</span> test</span><br><span class="line">git lfs install</span><br><span class="line">git lfs track *.jpg</span><br><span class="line">git add *.jpg</span><br><span class="line">git add .gitattributes</span><br><span class="line">git commit -m &quot;initial commit&quot;</span><br><span class="line">git config --add lfs.url &quot;https://hogehoge.com/data/test.git/info/lfs/&quot;</span><br><span class="line">git config lfs.contenttype false</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p><strong>git config lfs.contenttype false</strong>がミソです。 これは </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://gitlab.com/gitlab-org/gitlab-ce/issues/49934#what-is-the-current-bug-behaviour" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=gitlab.com"></img><div class="hbc-site-name">GitLab</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://assets.gitlab-static.net/uploads/-/system/project/avatar/13083/logo-extra-whitespace.png"></img></div><div class="hbc-text"><div class="hbc-title">GitLab CE Git LFS failing to push large repo due to unsupported Content-Type header(s) (#49934) · Issues · GitLab.org / GitLab FOSS</div><div class="hbc-url">https://gitlab.com/gitlab-org/gitlab-ce/issues/49934#what-is-the-current-bug-behaviour</div><div class="hbc-description"> Summary Cannot push to a large repository (around ~3800 files, totalling ~1.6GB) with Git LFS.  </div></div></div></div></a></div></div><p>に書いてありました。</p>]]></content>
      
      
      <categories>
          
          <category> NAS </category>
          
          <category> バージョン管理システム </category>
          
          <category> Synology </category>
          
          <category> git </category>
          
          <category> GitLab </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その171 ChainerのモデルデータをONNXに変換してみる</title>
      <link href="/2019/04/02/4024/"/>
      <url>/2019/04/02/4024/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Chainer</strong>はPythonで動きます。 学習はPythonで良くてもシステムに組み込む際にPythonは聊か都合が悪いです。 なので、学習結果であるモデルファイルをPython以外の言語で扱えるように、共通データフォーマットである**ONNX (Open Neural Network Exchange)**に変換してみます。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>シンプルなMNISTのサンプルで生成されるモデルファイルを変換してみます。 まずはChainerの環境を構築。Windows上の仮想環境を想定。</p><h2 id="環境構築"><a href="#環境構築" class="headerlink" title="環境構築"></a>環境構築</h2><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2018/11/17/3865" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">開発メモ その154 Chainer with CUDA for Windowsを使う – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2018/11/17/3865</div></div></div></div></a></div></div><p>を参考にし、下記のコマンドを実行します。 [code lang=”dos”] &gt; python -m pip install –upgrade pip &gt; python -m pip install cupy==5.3.0 &gt; python -m pip install cupy-cuda92==5.3.0 &gt; python -m pip install chainer==5.3.0 &gt; python -m pip install onnx-chainer [/code] インストール後はCUDAを認識しているかを確認します。 [code lang=”dos”] &gt; python -c “import chainer; chainer.print_runtime_info()” Platform: Windows-10-10.0.17763-SP0 Chainer: 5.3.0 NumPy: 1.16.2 CuPy: CuPy Version : 5.3.0 CUDA Root : C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2 CUDA Build Version : 9020 CUDA Driver Version : 10000 CUDA Runtime Version : 9020 cuDNN Build Version : 7402 cuDNN Version : 7402 NCCL Build Version : None NCCL Runtime Version : None iDeep: Not Available [/code]</p><h2 id="学習と変換"><a href="#学習と変換" class="headerlink" title="学習と変換"></a>学習と変換</h2><p>ソースをクローンし、<strong>train_mnist.py</strong>を修正します。 [code lang=”dos”] &gt; git clone <a href="https://github.com/chainer/chainer">https://github.com/chainer/chainer</a> &gt; cd chainer &gt; git checkout v5.3.0 &gt; cd examples\mnist [/code] 修正前はモデルファイルを出力しないためです。 修正は下記2箇所。</p><h4 id="箇所1"><a href="#箇所1" class="headerlink" title="箇所1"></a>箇所1</h4><p>[code lang=”diff”] #!/usr/bin/env python import argparse<br>import chainer import chainer.functions as F import chainer.links as L from chainer import training from chainer.training import extensions<br>+ import os + from chainer import serializers + import onnx_chainer + import cupy as xp [/code]</p><h4 id="箇所2"><a href="#箇所2" class="headerlink" title="箇所2"></a>箇所2</h4><p>[code lang=”diff”] if args.resume: # Resume from a snapshot chainer.serializers.load_npz(args.resume, trainer)<br># Run the training trainer.run()<br>+ model_file = os.path.join(args.out, ‘mnist.model’) + onnx_file = os.path.join(args.out, ‘mnist.onnx’) + serializers.save_npz(model_file, model) + chainer.config.train = False + # ダミーデータ + x = xp.zeros((1, 1, 28, 28), dtype=xp.float32) + onnx_chainer.export(model.predictor, x, filename=onnx_file)<br>if __name__ == ‘__main__‘: main() [/code] 下記を実行します。 [code lang=”dos”] &gt; python train_mnist.py –gpu 0 GPU: 0 # unit: 1000 # Minibatch-size: 100 # epoch: 20<br>Downloading from <a href="http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz">http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz</a>… Downloading from <a href="http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz">http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz</a>… Downloading from <a href="http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz">http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz</a>… Downloading from <a href="http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz">http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz</a>… D:\Works\Python\envs\Chainer_5.3.0\lib\site-packages\chainer\training\extensions\plot_report.py:25: UserWarning: matplotlib is not installed on your environment, so nothing will be plotted at this time. Please install matplotlib to plot figures.<br>$ pip install matplotlib<br>warnings.warn(‘matplotlib is not installed on your environment, ‘ epoch main/loss validation/main/loss main/accuracy validation/main/accuracy elapsed_time 1 0.189437 0.0972368 0.94235 0.9701 8.70826 2 0.0736203 0.0654 0.977182 0.9789 11.5016 3 0.0483072 0.0657967 0.984433 0.9786 13.9685 4 0.0344889 0.0775722 0.988614 0.9779 16.4064 5 0.0307565 0.073484 0.990132 0.9808 18.8182 6 0.0247791 0.0676734 0.991932 0.981 21.2477 7 0.0187978 0.0756141 0.993648 0.9822 23.7888 8 0.0151227 0.0729054 0.994965 0.9836 26.2349 9 0.0162507 0.09349 0.994649 0.9805 28.6772 10 0.0186082 0.07771 0.994565 0.983 31.1291 11 0.0121478 0.0878187 0.996282 0.9829 33.575 12 0.0139532 0.103692 0.995515 0.9803 36.1334 13 0.0128902 0.0869704 0.996015 0.9812 38.5139 14 0.00887171 0.0960986 0.997182 0.9807 40.966 15 0.00950978 0.0941747 0.997016 0.9835 43.492 16 0.0117687 0.112775 0.996632 0.9805 45.8972 17 0.012322 0.109815 0.996782 0.9803 48.2932 18 0.00880352 0.10031 0.997383 0.9818 50.731 19 0.00929279 0.118552 0.997365 0.979 53.3326 20 0.00607901 0.0849677 0.99825 0.9852 55.8271 [/code] 学習の結果、<strong>result\mnist.model</strong>と<strong>result\mnist.onnx</strong>が出力されています。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Chainer </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その170 M2DetをUbuntu18.04で使ってみる(学習編)</title>
      <link href="/2019/04/02/4014/"/>
      <url>/2019/04/02/4014/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://wp.me/p9QCo1-12D">前回</a>の続き。 今回は学習を行ってみます。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>公式によると下記のコマンドで学習できるとのこと。 [code lang=”sh”] python train.py -c=configs/m2det512_vgg.py –ngpu 4 -t True [/code] しかしこのコマンドは<strong>TensorBorad</strong>を使った学習になります。 つまりTensorFlowが必要になります。 必要ない場合は [code lang=”sh”] python train.py -c=configs/m2det512_vgg.py –ngpu 4 [/code] でOK。 <strong>--npgu</strong>引数は利用するGPUの数。4個をサンプルとして表記しておくあたり、どれだけリソースを使うのか、とビクビクします。</p><h2 id="モデルファイル"><a href="#モデルファイル" class="headerlink" title="モデルファイル"></a>モデルファイル</h2><p>まず、pretrainedモデルをダウンロードします。 これは前回ダウンロードしたものとは異なります。 公式リンクにも書いておらず、ファイル名から検索をかけた結果、下記のページにリンクが書いてありました。 </p><p>[code lang=”sh”] wget <a href="https://s3.amazonaws.com/amdegroot-models/vgg16/_reducedfc.pth">https://s3.amazonaws.com/amdegroot-models/vgg16\_reducedfc.pth</a> mkdir weights mv vgg16_reducedfc.pth weights [/code]</p><h2 id="データセット"><a href="#データセット" class="headerlink" title="データセット"></a>データセット</h2><p>データセットをダウンロードします。しかし、これも公式には書いていません。 上述の<strong>ssd.pytorch</strong>でスクリプトが用意されています。 [code lang=”sh”] git clone <a href="https://github.com/amdegroot/ssd.pytorch">https://github.com/amdegroot/ssd.pytorch</a> [/code] そして、このリポジトリにある下記のスクリプトからデータセットをダウンロードします。</p><ul><li>COCO<ul><li>./data/scripts/COCO2014.sh</li><li>~/data にダウンロードされる</li></ul></li><li>VOC2007<ul><li>./data/scripts/VOC2007.sh</li><li>~/data にダウンロードされる</li></ul></li><li>VOC2012<ul><li>./data/scripts/VOC2012.sh</li><li>~/data にダウンロードされる</li></ul></li></ul><p>必要に応じてシンボリックリンクで退避するなど工夫する [code lang=”sh”] ln -s /media/hdd/work/data ~/data [/code] ダウンロード完了後、</p><ul><li>COCO<ul><li><strong>~/data/coco/annotations/annotations</strong> の中身を ** ~/data/coco/annotations** に移動 その場所に展開</li><li><strong>~/data/coco/images/train2014</strong>、**~/data/coco/images/val2014**が存在することを確認</li><li>wget <a href="https://github.com/insikk/coco/_dataset/_trainval35k/blob/master/instances/_valminusminival2014.json.zip?raw=true">https://github.com/insikk/coco\_dataset\_trainval35k/blob/master/instances\_valminusminival2014.json.zip?raw=true</a> -O instances_valminusminival2014.json.zip</li><li>=/data/cocoで実行、展開、annotationsへ移動</li></ul></li></ul><p>し、<strong>data/coco.py</strong>を下記のように変更します。 [code lang=”diff”] def __init__(self, root, image_sets, preproc=None, target_transform=None, dataset_name=’COCO’): self.root = root self.data_path = os.path.join(os.path.expanduser(“~”),’data’) - self.cache_path = os.path.join(self.data_path, ‘coco_cache’) + self.cache_path = os.path.join(self.data_path, ‘coco’) self.image_set = image_sets [/code] そして前述の学習コマンドを実行します。 [code lang=”sh”] python train.py -c=configs/m2det512_vgg.py –ngpu 1 [/code] がいろいろエラーが。</p><h4 id="エラー1"><a href="#エラー1" class="headerlink" title="エラー1"></a>エラー1</h4><p><strong>data/coco.py</strong> を直していない時のエラー [code lang=”sh”] creating index… index created! Traceback (most recent call last): File “train.py”, line 58, in dataset = get_dataloader(cfg, args.dataset, ‘train_sets’) File “/media/hdd/work/local/M2Det/utils/core.py”, line 93, in get_dataloader getattr(cfg.dataset, dataset)[setname], _preproc) File “/media/hdd/work/local/M2Det/data/coco.py”, line 65, in __init__ self.annotations.extend(self._load_coco_annotations(coco_name, indexes,_COCO)) File “/media/hdd/work/local/M2Det/data/coco.py”, line 101, in _load_coco_annotations with open(cache_file, ‘wb’) as fid: FileNotFoundError: [Errno 2] No such file or directory: ‘/home/takuya/data/coco_cache/train2014_gt_roidb.pkl’ [/code]</p><h4 id="エラー2"><a href="#エラー2" class="headerlink" title="エラー2"></a>エラー2</h4><p>バッチサイズが大きすぎる。 <strong>configs/m2det512_vgg.py</strong> で <strong>per_batch_size</strong> を小さくする [code lang=”sh”] ===&gt; Training M2Det on COCO Traceback (most recent call last): File “train.py”, line 86, in out = net(images) File “/media/hdd/Ubuntu18.04/python/M2Det/lib/python3.6/site-packages/torch/nn/modules/module.py”, line 477, in __call__ result = self.forward(*input, **kwargs) File “/media/hdd/work/local/M2Det/m2det.py”, line 106, in forward x = self.base[k](x) File “/media/hdd/Ubuntu18.04/python/M2Det/lib/python3.6/site-packages/torch/nn/modules/module.py”, line 477, in __call__ result = self.forward(*input, **kwargs) File “/media/hdd/Ubuntu18.04/python/M2Det/lib/python3.6/site-packages/torch/nn/modules/conv.py”, line 301, in forward self.padding, self.dilation, self.groups) RuntimeError: CUDA error: out of memory [/code] これらを超えて学習が始まりましたが、まったく終わりません。 COCOのデータの画像数が多いのもありますが、<strong>1080</strong>だとバッチサイズ4が限界で、1epoch回すのに6hかかりました。 なので学習は断念しました。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> PyTorch </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その169 M2DetをUbuntu18.04で使ってみる(デモ編)</title>
      <link href="/2019/04/01/4007/"/>
      <url>/2019/04/01/4007/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>2019年最新のObject Detectionである<strong>M2Det</strong>を使ってみます。 目標は自作のデータセットを使うこと。 まずはサンプルを実行してみます。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>公式ページはこちら。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/qijiezhao/M2Det#Introduction" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/20857077?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">qijiezhao/M2Det</div><div class="hbc-url">https://github.com/qijiezhao/M2Det#Introduction</div><div class="hbc-description">M2Det: A Single-Shot Object Detector based on Multi-Level Feature Pyramid Network - qijiezhao/M2Det</div></div></div></div></a></div></div><p>なお</p><ul><li>推奨は<strong>Anaconda</strong>のようですが、ピュアなPythonで試します。</li><li>Python 3.6.7</li><li>CUDA 9.2</li></ul><p>という前提です。</p><h2 id="仮想環境構築"><a href="#仮想環境構築" class="headerlink" title="仮想環境構築"></a>仮想環境構築</h2><p>仮想環境を作成しアクティベートします。 [code lang=”sh”] sudo apt-get install python3-venv python3-tk python3-m venv M2Det source M2Det/bin/activate [/code]</p><h2 id="環境変数設定"><a href="#環境変数設定" class="headerlink" title="環境変数設定"></a>環境変数設定</h2><p>CUDAの環境変数を設定します。 設定済みならスキップ。 [code lang=”sh”] VERSION=9.2 export CUDA_HOME=/usr/local/cuda-${VERSION} export PATH=/usr/local/cuda-${VERSION}/bin:${PATH} export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${CUDA_HOME}/lib64 [/code] 設定後、下記のコマンドで確認を行います。 [code lang=”sh”] $ nvcc: NVIDIA (R) Cuda compiler driver Copyright (c) 2005-2018 NVIDIA Corporation Built on Tue_Jun_12_23:07:04_CDT_2018 Cuda compilation tools, release 9.2, V9.2.148 [/code]</p><h2 id="パッケージのインストール"><a href="#パッケージのインストール" class="headerlink" title="パッケージのインストール"></a>パッケージのインストール</h2><p><strong>M2Det</strong>は<strong>PyTorch</strong>の<strong>0.4.1</strong>をサポートと明言していますので従います。 古いバージョンは下記のページから入手します。 自分の環境のCUDAと合わせて適切なファイルをダウンロードします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://pytorch.org/get-started/previous-versions/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=pytorch.org"></img><div class="hbc-site-name">pytorch.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://pytorch.org/assets/images/pytorch-logo.png"></img></div><div class="hbc-text"><div class="hbc-title">PyTorch</div><div class="hbc-url">https://pytorch.org/get-started/previous-versions/</div><div class="hbc-description">An open source deep learning platform that provides a seamless path from research prototyping to production deployment.</div></div></div></div></a></div></div><p>今回は<strong>torch-0.4.1-cp36-cp36m-linux_x86_64.whl</strong>になります。 なお、途中の<strong>--cache-dir</strong>は、自環境でディスク容量不足のエラーが出たための対策です。 [code lang=”sh”] $ python -m pip install torch-0.4.1-cp36-cp36m-linux_x86_64.whl Processing ./torch-0.4.1-cp36-cp36m-linux_x86_64.whl Could not install packages due to an EnvironmentError: [Errno 28] デバイスに空き領域がありません [/code] [code lang=”sh”] wget <a href="https://download.pytorch.org/whl/cu92/torch-0.4.1-cp36-cp36m-linux/_x86/_64.whl">https://download.pytorch.org/whl/cu92/torch-0.4.1-cp36-cp36m-linux\_x86\_64.whl</a><br>python -m pip install pip –upgrade python -m pip install numpy python -m pip install –cache-dir=./cache –build ./cache torch-0.4.1-cp36-cp36m-linux_x86_64.whl python -m pip install torchvision python -m pip install opencv-python tqdm python -m pip install cython matplotlib addict termcolor python3-tk [/code] インストール後、下記のようにしてPyTorchがCUDAを認識しているかどうかを確認します。 [code lang=”dos”] $ python Python 3.6.7 (default, Oct 22 2018, 11:32:17) [GCC 8.2.0] on linux Type “help”, “copyright”, “credits” or “license” for more information. &gt;&gt;&gt; import torch &gt;&gt;&gt; print(torch.cuda.is_available()) True &gt;&gt;&gt; torch.cuda.get_device_name(0) ‘GeForce GTX 1080’ [/code]</p><h2 id="ソースの入手"><a href="#ソースの入手" class="headerlink" title="ソースの入手"></a>ソースの入手</h2><p>[code lang=”sh”] git clone <a href="https://github.com/qijiezhao/M2Det.git">https://github.com/qijiezhao/M2Det.git</a> [/code]</p><h2 id="pycocotoolsとnms"><a href="#pycocotoolsとnms" class="headerlink" title="pycocotoolsとnms"></a>pycocotoolsとnms</h2><p>ソースに付属のスクリプトを使って<strong>pycocotools</strong>と<strong>nms</strong>をインストールします。 [code lang=”sh”] cd M2Det chmod +x make.sh ./make.sh [/code]</p><h2 id="デモ"><a href="#デモ" class="headerlink" title="デモ"></a>デモ</h2><p>まず、pretrainedファイルをダウンロードします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://drive.google.com/file/d/1NM1UDdZnwHwiNDxhcP-nndaWj24m-90L/view?usp=sharing" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=drive.google.com"></img><div class="hbc-site-name">Google Docs</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">m2det512_vgg.pth</div><div class="hbc-url">https://drive.google.com/file/d/1NM1UDdZnwHwiNDxhcP-nndaWj24m-90L/view?usp=sharing</div></div></div></div></a></div></div><p>ダウンロードしたファイルはどこでもいいので移動します。 そして、下記のコマンドを実行します。 ダウンロードしたファイルの移動先をどこでもよいといったのは、<strong>-m</strong>引数にダウンロードしたファイルのパスを指定するからです。 [code lang=”sh”] python demo.py -c=configs/m2det512_vgg.py -m=m2det512_vgg.pth –show [/code] 実行時はGUI画面が必要です。SSHからだと、 [code lang=”sh”] pos:(15.4,175.9,34.7,213.7), ids:handbag, score:0.009 pos:(97.1,248.4,128.3,304.3), ids:handbag, score:0.002 : cannot connect to X server [/code] とエラーが出るためです。 ただし、<strong>--show</strong>を外しせば画面には表示されません。 出力結果が<strong>imgs</strong>ディレクトリに書き出されます。 GUI上で実行すると下記のように画像が一定間隔で切り割って結果が表示されます。 (クリックして拡大するとアニメーションします)<br><a href="../../../../public/2019/04/movie.gif"><img src="../../../../public/2019/04/movie-1024x635.gif"></a><br> ちなみに、実行時のGPUの使用メモリは約3600MBでした。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Linux </category>
          
          <category> Python </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> PyTorch </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その168 Windowsコンテナを使ってみる</title>
      <link href="/2019/03/11/3982/"/>
      <url>/2019/03/11/3982/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>開発中のOSSでWindows Server Coreへの対応についてのissueがあったので、調査がてら導入してみる。 Windows Server 2016を使います。 評価版で検証を行います。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>下記の方が教えてくれました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qiita.com/anikundesu/items/f6e1561b8d99c6ee6156" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DWindows%2520Server%25202016%25E3%2581%25A7Windows%2520Server%25E3%2582%25B3%25E3%2583%25B3%25E3%2583%2586%25E3%2583%258A%25E3%2583%25BC%25E3%2582%2592%25E4%25BD%25BF%25E3%2581%2584%25E5%25A7%258B%25E3%2582%2581%25E3%2582%258B%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3D7bb5059e525dd7d2e855b10a2696669a&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540anikundesu%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3D1d1d55e60d5c29cd18ba11cb0df17b5d&blend-align=center%2Cmiddle&blend-mode=normal&s=47109e8d8d67c91da78576b75a76253b"></img></div><div class="hbc-text"><div class="hbc-title">Windows Server 2016でWindows Serverコンテナーを使い始める - Qiita</div><div class="hbc-url">https://qiita.com/anikundesu/items/f6e1561b8d99c6ee6156</div><div class="hbc-description">この記事は、「クラウド時代のシステム管理」の記事を転記したものです。Windows Server 2016からDocker APIに対応した「Windows Serverコンテナー」と、より強固なプロセス分離機能を備えた「Hyper...</div></div></div></div></a></div></div><h2 id="Windowsの最新化"><a href="#Windowsの最新化" class="headerlink" title="Windowsの最新化"></a>Windowsの最新化</h2><p>全てのセキュリティパッチを含む更新を行います。</p><h2 id="コンテナの有効化"><a href="#コンテナの有効化" class="headerlink" title="コンテナの有効化"></a>コンテナの有効化</h2><p><strong>役割と機能の追加</strong>から<strong>コンテナ</strong>を有効化します。</p><h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p>管理者権限で<strong>PowerShell</strong>を起動。 場合によっては下記のように*Nuget**の更新が必要になりますが、その場合はYesと答え、もう一度コマンドを実行します。 [code lang=”ps”] &gt; Install-Module -Name DockerMsftProvider -Repository PSGallery –Force<br>NuGet provider is required to continue PowerShellGet requires NuGet provider version ‘2.8.5.201’ or newer to interact with NuGet-based repositories. The NuGet provider must be available in ‘C:\Program Files\PackageManagement\ProviderAssemblies’ or ‘C:\Users\Administrator\AppData\Local\PackageManagement\ProviderAssemblies’. You can also install the NuGet provider by running ‘Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force’. Do you want PowerShellGet to install and import the NuGet provider now? [Y] Yes [N] No [S] Suspend [?] Help (default is “Y”): Y &gt; Install-Module -Name DockerMsftProvider -Repository PSGallery –Force [/code] パッケージソースからのインストールを信頼するかどうかの確認。 Yesと答えます。 少し時間がかかりますが、待っているとインストールが完了します。 完了後、再起動します。 再起動後、dockerをインストールします。 [code lang=”ps”] PS C:\Users\Administrator&gt; Install-Package -Name docker -ProviderName DockerMsftProvider<br>The package(s) come(s) from a package source that is not marked as trusted. Are you sure you want to install software from ‘DockerDefault’? [Y] Yes [A] Yes to All [N] No [L] No to All [S] Suspend [?] Help (default is “N”): Y<br>Name Version Source Summary —- ——- —— ——- Docker 18.09.3 DockerDefault Contains Docker EE for use with Windows Server. [/code]</p><h2 id="確認"><a href="#確認" class="headerlink" title="確認"></a>確認</h2><p>[code lang=”ps”] &gt; docker version Client: Version: 18.09.3 API version: 1.39 Go version: go1.10.8 Git commit: 142dfcedca Built: 02/28/2019 06:33:17 OS/Arch: windows/amd64 Experimental: false<br>Server: Engine: Version: 18.09.3 API version: 1.39 (minimum version 1.24) Go version: go1.10.8 Git commit: 142dfcedca Built: 02/28/2019 06:31:15 OS/Arch: windows/amd64 Experimental: false [/code]</p><h2 id="実行"><a href="#実行" class="headerlink" title="実行"></a>実行</h2><h4 id="コードの用意"><a href="#コードの用意" class="headerlink" title="コードの用意"></a>コードの用意</h4><p>動かしたいサンプルは</p><ul><li>Windows Server Core 2016</li><li>dotnet core のコンソール</li></ul><p>となります。 コードは下記になります。 [code lang=”cs”] using System;<br>namespace Sample { class Program { static void Main(string[] args) { Console.WriteLine(System.Environment.OSVersion.Platform); } } } [/code] コンテナ内でソースを用意するのは面倒なので、あらかじめ用意しておいて、ビルド時にコピーするようにします。</p><h4 id="サンプル実行"><a href="#サンプル実行" class="headerlink" title="サンプル実行"></a>サンプル実行</h4><p>下記の<strong>Dockerfile</strong>を作成します。 [code lang=”docker”] FROM mcr.microsoft.com/windows/servercore:10.0.14393.2665<br>SHELL [“powershell”, “-Command”, “$ErrorActionPreference = ‘Stop’; $ProgressPreference = ‘SilentlyContinue’;”]<br># Install .NET Core SDK ENV DOTNET_SDK_VERSION 2.2.104<br>RUN Invoke-WebRequest -OutFile dotnet.zip <a href="https://dotnetcli.blob.core.windows.net/dotnet/Sdk/$Env:DOTNET/_SDK/_VERSION/dotnet-sdk-$Env:DOTNET/_SDK/_VERSION-win-x64.zip">https://dotnetcli.blob.core.windows.net/dotnet/Sdk/$Env:DOTNET\_SDK\_VERSION/dotnet-sdk-$Env:DOTNET\_SDK\_VERSION-win-x64.zip</a>; \ $dotnet_sha512 = ‘2e73f64a7fdf0f9e03a58a1824375dab91cae658c1863d5130047064643a5c035db25251c443e9e0eded73ffe7b33ae6e1be4e16083da6122dfc1a7d6e2f1564’; \ if ((Get-FileHash dotnet.zip -Algorithm sha512).Hash -ne $dotnet_sha512) { \ Write-Host ‘CHECKSUM VERIFICATION FAILED!’; \ exit 1; \ }; \ \ Expand-Archive dotnet.zip -DestinationPath $Env:ProgramFiles\dotnet; \ Remove-Item -Force dotnet.zip<br>SHELL [“cmd”, “/S”, “/C”]<br>RUN [“C:/Program Files/dotnet/dotnet.exe”, “new”, “console”, “-n”, “Sample”] COPY [“Program.cs”, “c:/Sample”] WORKDIR Sample [/code] そして実行。 <strong>dotnet</strong>の初回起動時の復元処理に時間がかかります。 終わらなかったら、一度Ctrl+CでbuildをキャンセルするとOKです。 [code lang=”cmd”] $ docker build -t test . $ docker run -t test cmd &gt; “C:\Program Files\dotnet\dotnet.exe” run -c Release Win32NT [/code] 詳細なバージョン情報も表示してみます。 [code lang=”cmd”] powershell [System.Environment]::OSVersion<br>Platform ServicePack Version VersionString ——– ———– ——- ————- Win32NT 10.0.14393.0 Microsoft Windows NT 10.0.14393.0 [/code]</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Microsoft </category>
          
          <category> Docker </category>
          
          <category> Windows </category>
          
          <category> Windows Server </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その167 Raspberry Pi 3をWindows 10でエミュレートする</title>
      <link href="/2019/03/03/3967/"/>
      <url>/2019/03/03/3967/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 RaspberryPIを仮想環境で使いたくなったのでメモ。 ただし、現時点ではARM64のエミュレートはできませんでした。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>下記の方が教えてくれました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://jyn.jp/raspbian-on-qemu/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=jyn.jp"></img><div class="hbc-site-name">純規の暇人趣味ブログ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://jyn.jp/wp-core/wp-content/uploads/2017/01/raspbian-on-qemu-001.png"></img></div><div class="hbc-text"><div class="hbc-title">RaspbianをQEMUで動かす | 純規の暇人趣味ブログ</div><div class="hbc-url">https://jyn.jp/raspbian-on-qemu/</div><div class="hbc-description">どうも、ビンの王冠をスプーンで開けようとして指を怪我したニンゲンです。(怠慢ヨクナイネ)ちなみにビンの王冠と芥川龍之介は同い年なんですよ、知らなくて良い雑学ですね、脳の容量の無駄遣いです(参考：Wikipediaの王冠と芥川龍之介ページ)どうでも良い雑学はさておき、今回はRasp…</div></div></div></div></a></div></div><h2 id="QEMUのインストール"><a href="#QEMUのインストール" class="headerlink" title="QEMUのインストール"></a>QEMUのインストール</h2><p>下記から最新版をダウンロードしてインストール。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qemu.weilnetz.de/w64/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qemu.weilnetz.de"></img><div class="hbc-site-name">qemu.weilnetz.de</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">QEMU for Windows – Installers (64 bit)</div><div class="hbc-url">https://qemu.weilnetz.de/w64/</div><div class="hbc-description">QEMU Binaries for Windows</div></div></div></div></a></div></div><h3 id="Raspbian-Jessieのダウンロード"><a href="#Raspbian-Jessieのダウンロード" class="headerlink" title="Raspbian Jessieのダウンロード"></a>Raspbian Jessieのダウンロード</h3><p>下記からダウンロード。 最新のStrechは動かなかったので断念。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://ftp.jaist.ac.jp/pub/raspberrypi/raspbian_lite/images/raspbian_lite-2017-01-10/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ftp.jaist.ac.jp"></img><div class="hbc-site-name">ftp.jaist.ac.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Index of /pub/raspberrypi/raspbian_lite/images/raspbian_lite-2017-01-10</div><div class="hbc-url">http://ftp.jaist.ac.jp/pub/raspberrypi/raspbian_lite/images/raspbian_lite-2017-01-10/</div></div></div></div></a></div></div><h3 id="QEMU用カーネルとDevice-Treeファイル"><a href="#QEMU用カーネルとDevice-Treeファイル" class="headerlink" title="QEMU用カーネルとDevice Treeファイル"></a>QEMU用カーネルとDevice Treeファイル</h3><p>下記から、</p><ul><li>versatile-pb.dtb</li><li>kernel-qemu-4.4.34-jessie</li></ul><p>をダウンロード。 <strong>kernel-qemu</strong>はバージョンが随時変わります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/dhruvvyas90/qemu-rpi-kernel" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/1730398?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">dhruvvyas90/qemu-rpi-kernel</div><div class="hbc-url">https://github.com/dhruvvyas90/qemu-rpi-kernel</div><div class="hbc-description">Qemu kernel for emulating Rpi on QEMU. Contribute to dhruvvyas90/qemu-rpi-kernel development by creating an account on GitHub.</div></div></div></div></a></div></div><h3 id="下準備"><a href="#下準備" class="headerlink" title="下準備"></a>下準備</h3><p>仮想マシンでも何でも良いのでダウンロードしたRaspbianのイメージを仮想マシンにコピー。</p><h4 id="セクターの確認"><a href="#セクターの確認" class="headerlink" title="セクターの確認"></a>セクターの確認</h4><p>[code lang=”sh”] $ fdisk -l 2017-01-11-raspbian-jessie-lite.img Disk 2017-01-11-raspbian-jessie-lite.img: 1.3 GiB, 1390411776 bytes, 2715648 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x244b8248<br>Device Boot Start End Sectors Size Id Type 2017-01-11-raspbian-jessie-lite.img1 8192 137215 129024 63M c W95 FAT32 (LBA) 2017-01-11-raspbian-jessie-lite.img2 137216 2715647 2578432 1.2G 83 Linux [/code]</p><h4 id="マウント"><a href="#マウント" class="headerlink" title="マウント"></a>マウント</h4><p>[code lang=”sh”] $ sudo mount -v -o offset=$((512*137216)) -t ext4 ./2017-01-11-raspbian-jessie-lite.img /mnt/ mount: /dev/loop0 mounted on /mnt. [/code]</p><h4 id="ファイルシステムテーブルの編集"><a href="#ファイルシステムテーブルの編集" class="headerlink" title="ファイルシステムテーブルの編集"></a>ファイルシステムテーブルの編集</h4><p>[code lang=”sh”] $ sudo vi /mnt/etc/fstab [/code] [code lang=”diff”] proc /proc proc defaults 0 0 -/dev/mmcblk0p1 /boot vfat defaults 0 2 - /dev/mmcblk0p2 / ext4 defaults,noatime 0 1 + #/dev/mmcblk0p1 /boot vfat defaults 0 2 + #/dev/mmcblk0p2 / ext4 defaults,noatime 0 1 [/code]</p><h4 id="ld-so-preloadの編集"><a href="#ld-so-preloadの編集" class="headerlink" title="ld.so.preloadの編集"></a>ld.so.preloadの編集</h4><p>[code lang=”sh”] $ sudo editor /mnt/etc/ld.so.preload [/code] [code lang=”diff”] - /usr/lib/arm-linux-gnueabihf/libarmmem.so + #/usr/lib/arm-linux-gnueabihf/libarmmem.so [/code]</p><h4 id="アンマウント"><a href="#アンマウント" class="headerlink" title="アンマウント"></a>アンマウント</h4><p>[code lang=”sh”] $ sudo umount /mnt [/code]</p><h3 id="起動"><a href="#起動" class="headerlink" title="起動"></a>起動</h3><p><strong>-hda</strong>でダウンロードしたRaspbianのイメージを指定します。これがHDDになります [code lang=”cmd”] set QEMU=”C:\Program Files\qemu\qemu-system-arm.exe” %QEMU% -kernel kernel-qemu-4.4.34-jessie ^ -cpu arm1176 ^ -m 256 ^ -M versatilepb ^ -serial stdio ^ -append “root=/dev/sda2 rootfstype=ext4 rw” ^ -hda 2017-01-11-raspbian-jessie-lite.img ^ -net nic ^ -net user,hostfwd=tcp::20022-:22 [/code]<br><a href="../../../../public/2019/03/2ea62eac32df3663a4e6e25e8b57148e.png"><img src="../../../../public/2019/03/2ea62eac32df3663a4e6e25e8b57148e.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> QEMU </category>
          
          <category> Raspbian </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その166 重すぎるリポジトリをgit fetchする</title>
      <link href="/2019/02/24/3960/"/>
      <url>/2019/02/24/3960/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 自宅のライブラリ保存用リポジトリが巨大化してpullできなくなりました。 その際の対策。 [code lang=”sh”] $ git fetch remote: Enumerating objects: 8824, done. remote: Counting objects: 100% (8821/8821), done. error: RPC failed; curl 56 Failure when receiving data from the peer fatal: the remote end hung up unexpectedly fatal: protocol error: bad pack header [/code]</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>下記の方が教えてくれました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://r-h.hatenablog.com/entry/2013/12/07/093423" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=r-h.hatenablog.com"></img><div class="hbc-site-name">webネタ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/12704346814673877293/12921228815714017690/1386376545"></img></div><div class="hbc-text"><div class="hbc-title">gitで重いリポジトリをcloneするとき - webネタ</div><div class="hbc-url">http://r-h.hatenablog.com/entry/2013/12/07/093423</div><div class="hbc-description">git clone http://example.com/fuga.git remote: Counting objects: 3203, done. remote: warning: suboptimal pack - out of memory remote: fatal: …</div></div></div></div></a></div></div><p>徐々にfetchしてpullすればよいと。 [code lang=”sh”] $ git fetch –depth 1 remote: Enumerating objects: 8374, done. remote: Counting objects: 100% (8374/8374), done. remote: Compressing objects: 100% (6008/6008), done. remote: Total 8356 (delta 2189), reused 8277 (delta 2170) Receiving objects: 100% (8356/8356), 1.31 GiB | 28.65 MiB/s, done. Resolving deltas: 100% (2189/2189), completed with 9 local objects. From <a href="https://hogehoge:3000/git/Lib">https://hogehoge:3000/git/Lib</a> + 67ccf8298…3fb81d65f master -&gt; origin/master (forced update) * [new branch] develop -&gt; origin/develop $ git fetch –depth 10 remote: Enumerating objects: 332, done. remote: Counting objects: 100% (331/331), done. remote: Compressing objects: 100% (154/154), done.R remote: Total 310 (delta 166), reused 262 (delta 149) Receiving objects: 100% (310/310), 66.85 MiB | 25.18 MiB/s, done. Resolving deltas: 100% (166/166), completed with 10 local objects. $ git fetch –depth 100 remote: Enumerating objects: 6031, done. remote: Counting objects: 100% (5332/5332), done. remote: Compressing objects: 100% (4312/4312), done. remote: Total 5107 (delta 1739), reused 2367 (delta 531) Receiving objects: 100% (5107/5107), 208.07 MiB | 14.61 MiB/s, done. Resolving deltas: 100% (1739/1739), completed with 120 local objects. $ git fetch $ git pull origin master [/code] cloneの場合も同様。 [code lang=”sh”] $ git clone –depth 1 <a href="http://example.com/fuga.git">http://example.com/fuga.git</a> [/code]</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その165 gitで全ブランチをpullする</title>
      <link href="/2019/01/15/3952/"/>
      <url>/2019/01/15/3952/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 <strong>Ubuntu</strong>、<strong>Git for Windows</strong>で使えました。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>下記の方が教えてくれました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://rock-and-hack.blogspot.com/2012/11/git-pull.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=rock-and-hack.blogspot.com"></img><div class="hbc-site-name">rock-and-hack.blogspot.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">git : 全てのブランチをpullするワンライナー</div><div class="hbc-url">http://rock-and-hack.blogspot.com/2012/11/git-pull.html</div><div class="hbc-description">すごく久々の投稿。   とりあえずコマンドを先に。   for branch in `git branch -r | grep -v HEAD | awk -F&#39;/&#39; &#39;{print $2}&#39;`; do git checkout $branch; git pull; done ※…</div></div></div></div></a></div></div><p>[code lang=”sh”] for branch in `git branch -r | grep -v HEAD | awk -F’/‘ ‘{print $2}’`; do git checkout $branch; git pull; done [/code] Googleで<strong>git 全ブランチ</strong>で検索してトップに出てくるページのスクリプトは使えませんでした。</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その164 Ubuntu 18.04にCUDA 9.2をインストール</title>
      <link href="/2019/01/03/3946/"/>
      <url>/2019/01/03/3946/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>CUDA</strong>のダウンロードページでCUDA 9.2にアクセスすると </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://developer.nvidia.com/cuda-92-download-archive" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=developer.nvidia.com"></img><div class="hbc-site-name">NVIDIA Developer</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">CUDA Toolkit 9.2 Download</div><div class="hbc-url">https://developer.nvidia.com/cuda-92-download-archive</div><div class="hbc-description">Select Target Platform Click on the green buttons that describe your target platform. Only supported platforms will be shown. Operating Syst…</div></div></div></div></a></div></div><p><a href="../../../../public/2019/01/1.png"><img src="../../../../public/2019/01/1.png"></a><br> <strong>Ubuntu 18.04</strong>に対応していないように見える。 そこはかとない不安を感じながら9.2をインストールしたのでメモ。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p><strong>17.10</strong>を選択し、**runfile [local]**を選択しダウンロードするだけです。 パッチもあるので忘れないこと。</p><h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p>[code lang=”sh”] sudo sh cuda_9.2.148_396.37_linux [/code] でインストールを開始する。 最初にEULAの承諾を求められるので末尾に移動する。 <strong>Ctrl+F</strong>で一気に末尾に。 [code lang=”sh”] Do you accept the previously read EULA? accept/decline/quit:accept [/code] EULAの承諾に対しては<strong>accept</strong>と押下してENTER。 以降は、質問に答えていく形で、<strong>y</strong>または<strong>n</strong>と<strong>Enter</strong>を駆使します。 途中でドライバーのインストールを聞かれますが、既に入っているなら無理してインストールする必要はないです。 [code lang=”sh”] You are attempting to install on an unsupported configuration. Do you wish to continue? (y)es/(n)o [ default is no ]: y<br>Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 396.37? (y)es/(n)o/(q)uit: n<br>Install the CUDA 9.2 Toolkit? (y)es/(n)o/(q)uit: y<br>Enter Toolkit Location [ default is /usr/local/cuda-9.2 ]:<br>Do you want to install a symbolic link at /usr/local/cuda? (y)es/(n)o/(q)uit: y<br>Install the CUDA 9.2 Samples? (y)es/(n)o/(q)uit: y<br>Enter CUDA Samples Location [ default is /home/takuya ]:<br>Installing the CUDA Toolkit in /usr/local/cuda-9.2 … Installing the CUDA Samples in /home/takuya … Copying samples to /home/takuya/NVIDIA_CUDA-9.2_Samples now… Finished copying samples.<br>=========== = Summary = ===========<br>Driver: Not Selected Toolkit: Installed in /usr/local/cuda-9.2 Samples: Installed in /home/takuya<br>Please make sure that - PATH includes /usr/local/cuda-9.2/bin - LD_LIBRARY_PATH includes /usr/local/cuda-9.2/lib64, or, add /usr/local/cuda-9.2/lib64 to /etc/ld.so.conf and run ldconfig as root<br>To uninstall the CUDA Toolkit, run the uninstall script in /usr/local/cuda-9.2/bin<br>Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-9.2/doc/pdf for detailed information on setting up CUDA.<br>***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 384.00 is required for CUDA 9.2 functionality to work. To install the driver using this installer, run the following command, replacing with the name of this run file: sudo .run -silent -driver<br>Logfile is /tmp/cuda_install_2992.log [/code]</p><h2 id="パッチのインストール"><a href="#パッチのインストール" class="headerlink" title="パッチのインストール"></a>パッチのインストール</h2><p>こちらもEULAの承諾が必要です。 [code lang=”sh”] sudo sh cuda_9.2.148.1_linux [/code] 承諾方法は同様。 聞かれるのはインストール先のみ。 [code lang=”sh”] Enter CUDA Toolkit installation directory [ default is /usr/local/cuda-9.2 ]:<br>Installation complete! Installation directory: /usr/local/cuda-9.2 [/code] 簡単ですね。 <strong>apt</strong>を使うインストールよりも、こちらのが簡単な気がしないでもないです。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> gpupu </category>
          
          <category> Ubuntu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その163 Ubuntu 18.04 with CUDA 9.2でcaffeをビルドする</title>
      <link href="/2019/01/03/3942/"/>
      <url>/2019/01/03/3942/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Ubuntu 18.04</strong>でパッケージマネージャーからインストールできる<strong>gcc</strong>のバージョンが7になっている。 [code lang=”sh”] $ gcc –version gcc (Ubuntu 7.3.0-27ubuntu1<del>18.04) 7.3.0 Copyright (C) 2017 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. [/code] <strong>CUDA 9</strong>が6以降のgccでのビルドをサポートしていないため、caffeをビルドしようとするとエラーが起きてします。 が、<strong>openpose</strong>でビルドするときはこのエラーが起きないんですよね… ちなみにこんなエラー。 [code] $ cmake –build . –config Release [ 1%] Running C++/Python protocol buffer compiler on /media/hdd/work/local/caffe/src/caffe/proto/caffe.proto Scanning dependencies of target caffeproto [ 1%] Building CXX object src/caffe/CMakeFiles/caffeproto.dir/__/__/include/caffe/proto/caffe.pb.cc.o [ 1%] Linking CXX static library ../../lib/libcaffeproto.a [ 1%] Built target caffeproto [ 1%] Building NVCC (Device) object src/caffe/CMakeFiles/cuda_compile_1.dir/util/cuda_compile_1_generated_math_functions.cu.o In file included from /usr/include/host_config.h:50:0, from /usr/include/cuda_runtime.h:78, from :0: /usr/include/crt/host_config.h:121:2: error: #error – unsupported GNU version! gcc versions later than 6 are not supported! #error – unsupported GNU version! gcc versions later than 6 are not supported! ^</del> CMake Error at cuda_compile_1_generated_math_functions.cu.o.Release.cmake:219 (message): Error generating /media/hdd/work/local/caffe/build/src/caffe/CMakeFiles/cuda_compile_1.dir/util/./cuda_compile_1_generated_math_functions.cu.o<br>src/caffe/CMakeFiles/caffe.dir/build.make:497: recipe for target ‘src/caffe/CMakeFiles/cuda_compile_1.dir/util/cuda_compile_1_generated_math_functions.cu.o’ failed make[2]: *** [src/caffe/CMakeFiles/cuda_compile_1.dir/util/cuda_compile_1_generated_math_functions.cu.o] Error 1 CMakeFiles/Makefile2:235: recipe for target ‘src/caffe/CMakeFiles/caffe.dir/all’ failed make[1]: *** [src/caffe/CMakeFiles/caffe.dir/all] Error 2 Makefile:129: recipe for target ‘all’ failed make: *** [all] Error 2 [/code] とにかくこの対処方法。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>対処として、古いgccをインストールしてそっちに切り替える方法もありますが、面倒なのでこれはパス。 なので、CUDA側のgccバージョンチェックを無効化する方法を採用します。 [code lang=”diff”] $ sudo vi /usr/include/crt/host_config.h [/code] で設定ファイルを開き、下記チェック個所をコメントアウトします。 [code lang=”diff”] #error – unsupported GNU version! gcc versions later than 6 are not supported! //#error – unsupported GNU version! gcc versions later than 6 are not supported! [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Caffe </category>
          
          <category> gpupu </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その162 Ubuntu 18.04でVINOをコマンドラインから有効化する</title>
      <link href="/2019/01/02/3938/"/>
      <url>/2019/01/02/3938/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 <strong>Ubuntu 16</strong>なら<strong>x11vnc</strong>一択なんですけど、<strong>Gnome</strong>に変わったため、18ではこれができない。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>18からはネットワークに対して<strong>Vino</strong>の設定をON/OFFする仕組みに変わった模様。 Vinoインストール後、ネットワークマネージャーで接続一覧を表示、取得し、<strong>dconf</strong>で設定を有効化します。 [code lang=”sh”] $ sudo apt install vino $ nmcli connection show NAME UUID TYPE DEVICE 有線接続 1 ba688a1f-889f-30a0-b947-ed395181dc52 ethernet enp5s0 $ dconf write /org/gnome/settings-daemon/plugins/sharing/vino-server/enabled-connections “[‘ba688a1f-889f-30a0-b947-ed395181dc52’]“ $ dconf read /org/gnome/settings-daemon/plugins/sharing/vino-server/enabled-connections [‘ba688a1f-889f-30a0-b947-ed395181dc52’] $ ss -lnt | grep 5900 LISTEN 0 5 0.0.0.0:5900 0.0.0.0:* LISTEN 0 5 [::]:5900 [::]:* [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> Ubuntu </category>
          
          <category> VNC </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その161 UbuntuでOpenPoseを動かす</title>
      <link href="/2018/12/19/3933/"/>
      <url>/2018/12/19/3933/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>かなりはまったのでメモ。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>ビルドするだけなら簡単なのだが、動かすとどうしても動かない。 例えば下記のようなエラーが出る。 [code lang=”sh”] $ ./pose_1_extract_from_image.bin Starting OpenPose demo… F1219 20:52:30.150040 24594 upgrade_proto.cpp:97] Check failed: ReadProtoFromBinaryFile(param_file, param) Failed to parse NetParameter file: models/pose/body_25/pose_iter_584000.caffemodel *** Check failure stack trace: *** @ 0x7f91236e55cd google::LogMessage::Fail() @ 0x7f91236e7433 google::LogMessage::SendToLog() @ 0x7f91236e515b google::LogMessage::Flush() @ 0x7f91236e7e1e google::LogMessageFatal::~LogMessageFatal() @ 0x7f91230ac311 caffe::ReadNetParamsFromBinaryFileOrDie() @ 0x7f912322351a caffe::Net&lt;&gt;::CopyTrainedLayersFromBinaryProto() @ 0x7f912501ae17 op::NetCaffe::initializationOnThread() @ 0x7f912503b48e op::addCaffeNetOnThread() @ 0x7f912503bf7a op::PoseExtractorCaffe::netInitializationOnThread() @ 0x7f9125040b80 op::PoseExtractorNet::initializationOnThread() @ 0x404320 tutorialDeveloperPose1() @ 0x403613 main @ 0x7f9123f52830 __libc_start_main @ 0x403649 _start @ (nil) (unknown) Aborted (core dumped) [/code] この現象はissueとして登録されている。 </p><p>ただし、一部のUbuntuで発生しているようで、作者の環境では再現できていない模様。 解決策は、</p><ul><li>OpenPoseに含まれているCaffeを使わずシステムに登録されているCaffeを使う</li><li>OpenPoseに含まれているCaffeのリビジョンを変更する</li></ul><p>となる。 後者の解決策は </p><p>で提示されていた。 まず [code lang=”sh”] $ vi openpose/CMakeLists.txt [/code] でファイルを開く。次に、caffeのソースを取得する箇所を修正する。 具体的な行数はリビジョンによって変わるため、下記の行番号は参考であるが、下記の記述はソース中に2つあるため、探せば必ず見つかる。 [code lang=”diff”] # Build Process set(CAFFE_CPU_ONLY OFF) if (${GPU_MODE} MATCHES “CUDA”) - execute_process(COMMAND git checkout master WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/3rdparty/caffe) + execute_process(COMMAND git checkout f019d0dfe86f49d1140961f8c7dec22130c83154 WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/3rdparty/caffe) elseif (${GPU_MODE} MATCHES “CPU_ONLY”) if (USE_MKL) #execute_process(COMMAND git checkout intel WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/3rdparty/caffe) @@ -682,7 +682,7 @@ if (UNIX OR APPLE) “${CMAKE_BINARY_DIR}/caffe/lib/libmkldnn.so” ) else (USE_MKL) - execute_process(COMMAND git checkout master WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/3rdparty/caffe) + execute_process(COMMAND git checkout f019d0dfe86f49d1140961f8c7dec22130c83154 WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/3rdparty/caffe) endif (USE_MKL) set(CAFFE_CPU_ONLY ON) set(USE_CUDNN OFF) [/code] この修正を完了後、 [code lang=”sh”] $ sudo apt install -y cmake libopencv-dev $ sudo apt install -y libgflags-dev libgoogle-glog-dev libprotobuf-dev protobuf-compiler libhdf5-serial-dev $ sudo apt install -y libatlas-base-dev $ sudo apt install -y –no-install-recommends libboost-all-dev $ mkdir build $ cd build $ cmake .. $ cmake –build . –config Release [/code] でビルドが可能になる。 また、利用するCUDAは9.2未満にすること。 これは、caffeが<strong>libcublas_device.a</strong>を参照しているが、<strong>CUDA 9.2</strong>で削除されてためである。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://devtalk.nvidia.com/default/topic/1043972/jetson-agx-xavier/where-can-i-find-libcublas_device-so-or-libcublas_device-a-/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=devtalk.nvidia.com"></img><div class="hbc-site-name">NVIDIA Developer Forums</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://aws1.discourse-cdn.com/nvidia/original/2X/8/8f17cc8f1a724d6ecea8a197a267ec8a05ef1490.png"></img></div><div class="hbc-text"><div class="hbc-title">Where can I find libcublas_device.so or libcublas_device.a?</div><div class="hbc-url">https://devtalk.nvidia.com/default/topic/1043972/jetson-agx-xavier/where-can-i-find-libcublas_device-so-or-libcublas_device-a-/</div><div class="hbc-description">I am trying to compile a library which is looking for libcublas_device.so and/or libcublas_device.a.  Does this library exist for the Jetson…</div></div></div></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> 画像処理 </category>
          
          <category> gpupu </category>
          
          <category> Ubuntu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
          <category> 姿勢推定 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その160 Ubuntu 18にCUDA 10とcuDNNをインストール</title>
      <link href="/2018/12/18/3923/"/>
      <url>/2018/12/18/3923/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Windowsみたいにインストーラがないのでメモ。ちなみにMacはインストーラがある。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p>[code lang=”sh”] &gt; wget <a href="https://developer.nvidia.com/compute/cuda/10.0/Prod/local/_installers/cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48/_1.0-1/_amd64">https://developer.nvidia.com/compute/cuda/10.0/Prod/local\_installers/cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48\_1.0-1\_amd64</a> &gt; sudo dpkg -i cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb (データベースを読み込んでいます … 現在 218372 個のファイルとディレクトリがインストールされています。) cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb を展開する準備をしています … cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48 (1.0-1) を展開しています…<br>cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48 (1.0-1) を設定しています …<br>The public CUDA GPG key does not appear to be installed. To install the key, run this command: sudo apt-key add /var/cuda-repo-10-0-local-10.0.130-410.48/7fa2af80.pub &gt; sudo apt-key add /var/cuda-repo-10-0-local-10.0.130-410.48/7fa2af80.pub OK &gt; sudo apt-get update &gt; sudo apt-get install cuda-10-0 [/code] 終わったら再起動が必須です。 続いてcuDNN。 [code lang=”sh”] sudo dpkg -i libcudnn7_7.4.1.5-1+cuda10.0_amd64.deb sudo dpkg -i libcudnn7-dev_7.4.1.5-1+cuda10.0_amd64.deb sudo dpkg -i libcudnn7-doc_7.4.1.5-1+cuda10.0_amd64.deb [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> gpupu </category>
          
          <category> Ubuntu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その159 ChainerCVでSSDのメモ</title>
      <link href="/2018/11/22/3912/"/>
      <url>/2018/11/22/3912/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。基本中の基本だけど数学苦手で理論も苦手な自分用のメモ。<br>基本、<strong>train.py</strong>についての解説。</p><h1 id="What-is-problem"><a href="#What-is-problem" class="headerlink" title="What is problem?"></a>What is problem?</h1><h2 id="配列の次元の意味"><a href="#配列の次元の意味" class="headerlink" title="配列の次元の意味"></a>配列の次元の意味</h2><p><strong>ChainerCV</strong>におけるサンプルのSSDの実装は、<strong>MultiboxTrainChain</strong>クラスが中心。<br>で、ネットワークに画像(正確にはバッチ数分)を入力した際の出力について。<br>下記画像における、<strong>mb_locs</strong>、<strong>mb_confs</strong>。</p><p><a href="../../../../public/2018/11/1-6.png"><img src="../../../../public/2018/11/1-6.png"></a></p><ul><li>mb_locs<ul><li>multibox locations、つまり位置の損失</li><li>次元は、バッチ数、8732、4(x,y,w,h)</li></ul></li><li>mb_confs<ul><li>multibox confidences、つまり確信度の損失</li><li>次元は、バッチ数、8732、カテゴリ数+1</li></ul></li></ul><p>となる。<br>カテゴリ数にプラス1しているのは、どのカテゴリにも合致しない、というカテゴリを用意するため。<br>SSDのサンプルはVOC2007のため、カテゴリ数は20なので、21になる。<br>8732はデフォルトボックス、つまり画像全体を分割する矩形の個数。</p><p>なので、mb_confsの場合、カテゴリ毎に8732の矩形それぞれに損失が格納されていることを意味する。<br>(正確には、画像毎に対して、カテゴリ8732個が割り当てられ、その1つ1つにカテゴリ21個の損失が格納されている。) 損失はラベルに合致した場合は正、合致しない場合は負になる。</p><h2 id="可視化"><a href="#可視化" class="headerlink" title="可視化"></a>可視化</h2><p>学習や推論に使用される変数を可視化するといろいろわかる。</p><h3 id="データセット"><a href="#データセット" class="headerlink" title="データセット"></a>データセット</h3><p>学習を始める前に、利用される教師データがどのようなものかを可視化する。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> chainercv.visualizations <span class="keyword">import</span> vis_bbox</span><br><span class="line"></span><br><span class="line">vocTrain = VOCBboxDataset(year=<span class="string">&#x27;2007&#x27;</span>, split=<span class="string">&#x27;trainval&#x27;</span>)</span><br><span class="line">img, bbox, label = vocTrain[<span class="number">0</span>]</span><br><span class="line">vis_bbox(img, bbox, label)</span><br></pre></td></tr></table></figure><p><a href="../../../../public/2018/11/3-4.png"><img src="../../../../public/2018/11/3-4.png"></a></p><h3 id="imgs"><a href="#imgs" class="headerlink" title="imgs"></a>imgs</h3><p><strong>MultiboxTrainChain</strong>の**<strong>call**</strong>に渡ってくる引数を確認することでいろいろな情報が確認できる。<br><strong>imgs</strong>は</p><ol><li><strong>cupy.core.core.ndarray</strong>なので、<strong>Numpy.ndarray</strong>に変換</li><li>チャネル数、高さ、幅の順の次元を<strong>Numpy.transpose</strong>で、高さ、幅、チャネル数に変換</li><li>uint8に変換</li><li><strong>RGB</strong>形式として画像に変換し、ファイル出力</li></ol><p>という手順で可視化ができる。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">Image.fromarray(np.uint8(np.transpose(chainer.cuda.to_cpu(imgs[<span class="number">0</span>]), (<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>))),<span class="string">&quot;RGB&quot;</span>).save(<span class="string">&quot;test.png&quot;</span>)</span><br></pre></td></tr></table></figure><p>この段階で来る画像は、学習用に水増しされている画像に変換されているので注意。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Chainer </category>
          
          <category> ディープラーニング </category>
          
          <category> 機械学習 </category>
          
          <category> ChainerCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その158 ChainerCVでSSDを動かす</title>
      <link href="/2018/11/20/3887/"/>
      <url>/2018/11/20/3887/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>ChainerCV</strong>で**SSD (Single Shot Multibox Detector)**を遊んでみます。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>CUDA、cuDNNのチェック、仮想環境作成、仮想環境のアクティベートまでの手順は下記です。 </p><h2 id="パッケージのインストール"><a href="#パッケージのインストール" class="headerlink" title="パッケージのインストール"></a>パッケージのインストール</h2><p><strong>cupy</strong>、<strong>cupy-cuda</strong>、<strong>chainer</strong>のバージョンは一致させます。 cupy-cudaの末尾の数値は、先ほど確認したCUDAのバージョンに合わせます。 また、Chainerは4.5.0を使うため、ChainerCVは0.10.0になります。 (0.11.0はChainer 5.0.0になるため) また、下記の順番を守ってインストールします。 [code lang=”dos”] &gt; python -m pip install –upgrade pip &gt; python -m pip install cupy==4.5.0 &gt; python -m pip install cupy-cuda92==4.5.0 &gt; python -m pip install chainer==4.5.0 &gt; python -m pip install chainercv==0.10.0 &gt; python -m pip install opencv-python [/code]</p><h2 id="最終確認"><a href="#最終確認" class="headerlink" title="最終確認"></a>最終確認</h2><p>Chainer、ChainerCVがインストールされたこと、ChainerがCUDA、cuDNNを認識していることを確認します。 [code lang=”dos”] &gt; python -c “import chainer; chainer.print_runtime_info()” Platform: Windows-10-10.0.17134-SP0 Chainer: 4.5.0 NumPy: 1.15.4 CuPy: CuPy Version : 4.5.0 CUDA Root : C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2 CUDA Build Version : 9020 CUDA Driver Version : 9020 CUDA Runtime Version : 9020 cuDNN Build Version : 7104 cuDNN Version : 7104 NCCL Build Version : None<br>&gt; python -m pip freeze chainer==4.5.0 chainercv==0.10.0 cupy==4.5.0 cupy-cuda92==4.5.0 fastrlock==0.4 filelock==3.0.10 numpy==1.15.4 opencv-python==3.4.3.18 Pillow==5.3.0 protobuf==3.6.1 six==1.11.0 [/code]</p><h2 id="デモ-学習"><a href="#デモ-学習" class="headerlink" title="デモ (学習)"></a>デモ (学習)</h2><p>ChainerCVのリポジトリにサンプルが含まれているのでブランチを指定してクローンします。 クローンしたらサンプルを実行します。 [code lang=”dos”] &gt; git clone -b v0.10.0 <a href="https://www.github.com/chainer/chainercv">https://www.github.com/chainer/chainercv</a> &gt; cd chainercv/examples/ssd &gt; python train.py –model ssd300 –batchsize 32 –gpu 0 [/code] データセットは<strong>VOC2007</strong>のようです。 <strong>GeForce GTX 1080</strong>を利用した場合、約30時間かかりました。また、バッチサイズを増やそうとしたらメモリが足りなくなりました。 下記は学習後の損失の推移グラフです。 上から、全体の損失、カテゴリの損失、位置の損失です。<br><a href="../../../../public/2018/11/chainercv_examles_ssd_demo_20181120221605.png"><img src="../../../../public/2018/11/chainercv_examles_ssd_demo_20181120221605.png"></a></p><h2 id="デモ-推論"><a href="#デモ-推論" class="headerlink" title="デモ (推論)"></a>デモ (推論)</h2><p>前項での学習した結果、モデルが<strong>result\model_iter_120000</strong>として保存されていますのでそれを活用します。 学習に使った<strong>VOC2007</strong>のカテゴリは下記のとおりです。</p><ul><li>Aeroplanes</li><li>Bicycles</li><li>Birds</li><li>Boats</li><li>Bottles</li><li>Buses</li><li>Cars</li><li>Cats</li><li>Chairs</li><li>Cows</li><li>Dining tables</li><li>Dogs</li><li>Horses</li><li>Motorbikes</li><li>People</li><li>Potted plants</li><li>Sheep</li><li>Sofas</li><li>Trains</li><li>TV/Monitors</li></ul><p>試しにWikipediaにある羊の画像(<a href="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Lleyn_sheep.jpg/800px-Lleyn_sheep.jpg">Lleyn sheep.jpg</a>)を認識させてみます。 なお、推論のデモには追加でモジュールが必要であるためインストールします。 [code lang=”dos”] &gt; pip install matplotlib [/code] 実行は下記のように行います。 [code lang=”dos”] &gt; python demo.py –gpu 0 –pretrained-model result\model_iter_120000 800px-Lleyn_sheep.jpg [/code]<br><a href="../../../../public/2018/11/1-5.png"><img src="../../../../public/2018/11/1-5.png"></a><br> 良い感じです。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Chainer </category>
          
          <category> ディープラーニング </category>
          
          <category> 機械学習 </category>
          
          <category> ChainerCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その157 Gitlab on Docker in Synology NASのLet&#39;s Encryptを更新する</title>
      <link href="/2018/11/19/3879/"/>
      <url>/2018/11/19/3879/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>一応シェルを作っているので、コマンド一発でできる状態ですが、メモとして残す。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>元々、自宅NAS上のGitLab on DockerへのSSL証明書の適用は下記のサイトを参考にして行っていました。 </p><p>なので、既にGitLabはhttpsを通じて公開されています。 そして本題。 下記が更新に使用するシェルスクリプトです。 <strong>update_gitlab_cert.sh</strong>として保存します。 [code lang=”sh”] cd /volume1/docker/gitlab/gitlab/certs # List up files in certs ls -la # Confirm expiration date sudo openssl x509 -noout -dates -in /usr/syno/etc/certificate/system/default/cert.pem # Copy latest cert files to current directory sudo cp /usr/syno/etc/certificate/system/default/cert.pem ./gitlab.crt sudo cp /usr/syno/etc/certificate/system/default/privkey.pem ./gitlab.key # Update openssl dhparam -out dhparam.pem 4096 [/code] 実行前にGitLabを停止します。 下記が実行結果です。非常に時間がかかります。 [code lang=”sh”] $ sudo ./update_gitlab_cert.sh total 12 drwxr-xr-x 1 root root 62 May 27 10:16 . drwxr-xr-x 1 1000 1000 106 May 26 23:54 .. -rwxr-xr-x 1 root root 769 Aug 26 02:06 dhparam.pem -rwxr-xr-x 1 root root 2171 Nov 19 00:23 gitlab.crt -rwxr-xr-x 1 root root 1675 Nov 19 00:23 gitlab.key notBefore=Oct 6 04:12:36 2018 GMT notAfter=Jan 4 04:12:36 2019 GMT Generating DH parameters, 4096 bit long safe prime, generator 2 This is going to take a long time [/code] 終わったらGitLabを再起動します。 ただ、最後の<strong>openssl</strong>コマンドは一度実行したら実行する必要はないかもしれません。</p>]]></content>
      
      
      <categories>
          
          <category> NAS </category>
          
          <category> Synology </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その156 Visual Studio CodeでPythonのデバッグ</title>
      <link href="/2018/11/18/3891/"/>
      <url>/2018/11/18/3891/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>以前、Visual Studio CodeでPython仮想環境を指定しました。 </p><p>その続きで、デバッグを行います。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>まずデバッグしたいPythonのソースを開きます。 次に、画面左のデバッグアイコンをクリックし、歯車アイコンの左にあるコンボボックスを展開します。 そして<strong>構成の追加</strong>をクリックします。<br><a href="../../../../public/2018/11/1-4.png"><img src="../../../../public/2018/11/1-4.png"></a></p><p>続いて、仮想環境を選択します。 すると、画面右下で<strong>pylint</strong>のインストールを促されますので、<strong>Install</strong>を選択します。 拡張機能とありますが、これは仮想環境にインストールされるパッケージになります。<br><a href="../../../../public/2018/11/2-3.png"><img src="../../../../public/2018/11/2-3.png"></a></p><p>準備ができましたので、ブレークポイントを設定し、デバッグ開始アイコンをクリックすることで任意の個所で停止できるようになります。<br><a href="../../../../public/2018/11/3-3.png"><img src="../../../../public/2018/11/3-3-1024x286.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その155 Visual Studio CodeでPython仮想環境を指定する</title>
      <link href="/2018/11/17/3872/"/>
      <url>/2018/11/17/3872/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="拡張機能のインストール"><a href="#拡張機能のインストール" class="headerlink" title="拡張機能のインストール"></a>拡張機能のインストール</h2><p><strong>Microsoft</strong>の<strong>Python</strong>をインストールします。 インストール後はVisual Studio Codeを再起動します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=ms-python.python" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ms-python.gallerycdn.vsassets.io/extensions/ms-python/python/2020.11.358366026/1605130691789/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">Python - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=ms-python.python</div><div class="hbc-description">Extension for Visual Studio Code - Linting, Debugging (multi-threaded, remote), Intellisense, Jupyter Notebooks, code formatting, refactorin…</div></div></div></div></a></div></div><h2 id="ユーザ設定の変更"><a href="#ユーザ設定の変更" class="headerlink" title="ユーザ設定の変更"></a>ユーザ設定の変更</h2><p>ここは人の好みによりますが、自分のように特定のディレクトリに仮想環境を集めている場合について説明。 まず、画面左下の歯車アイコンから<strong>設定</strong>を選択。<br><a href="../../../../public/2018/11/1-3.png"><img src="../../../../public/2018/11/1-3.png"></a></p><p>次に、<strong>Settings</strong>が表示されるので、検索バーに<strong>venvPath</strong>と入力し、仮想環境を集めているディレクトリを指定します。 この際、パス区切り文字列はバックスラッシュのままでかまいません。<br><a href="../../../../public/2018/11/2-2.png"><img src="../../../../public/2018/11/2-2-300x115.png"></a></p><p>設定後はVisual Studio Codeを再起動します。</p><h2 id="仮想環境を選択"><a href="#仮想環境を選択" class="headerlink" title="仮想環境を選択"></a>仮想環境を選択</h2><p>Visual Studio Codeが起動したら、<strong>Ctrl+Shift+P</strong>でコマンドパレットを表示させ、<strong>Python</strong>と入力し、その中から<strong>Python: インタープリターを選択</strong>を選択します。<br><a href="../../../../public/2018/11/3-2.png"><img src="../../../../public/2018/11/3-2-300x187.png"></a></p><p>少しすると、システムにインストールしてある、Pythonと仮想環境に加え、先ほど指定したフォルダの配下にある仮想環境が一覧に表示されます。<br><a href="../../../../public/2018/11/4-2.png"><img src="../../../../public/2018/11/4-2-300x127.png"></a></p><p>Visual Studio Codeを起動したばかりの時だと、仮想環境の一覧が表示されないことがあります。 その時は、コマンドパレットからもう一度選択すれば表示されます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その154 Chainer with CUDA for Windowsを使う</title>
      <link href="/2018/11/17/3865/"/>
      <url>/2018/11/17/3865/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>以前、CUDAを含むChainerのインストール手法を書きましたが、もう少しわかりやすく整理しました。 </p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="CUDA-PATHの確認"><a href="#CUDA-PATHの確認" class="headerlink" title="CUDA_PATHの確認"></a>CUDA_PATHの確認</h2><p>Chainerで利用するCUDAを確認します。 [code lang=”dos”] &gt; set CUDA_PATH CUDA_PATH=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2 CUDA_PATH_V9_0=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.0 CUDA_PATH_V9_1=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.1 CUDA_PATH_V9_2=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2 [/code]</p><h2 id="cuDNNの確認"><a href="#cuDNNの確認" class="headerlink" title="cuDNNの確認"></a>cuDNNの確認</h2><p>cuDNNが適切に展開されていることを確認します。 [code lang=”dos”] &gt; dir /B /D “%CUDA_PATH%\bin\cudnn64_7.dll” cudnn64_7.dll<br>&gt; dir /B “%CUDA_PATH%\include\cudnn.h” cudnn.h<br>&gt; dir /B “%CUDA_PATH%\include\cudnn.h” cudnn.h [/code]</p><h2 id="仮想環境の作成"><a href="#仮想環境の作成" class="headerlink" title="仮想環境の作成"></a>仮想環境の作成</h2><p>[code lang=”dos”] &gt; cd &lt;仮想環境の管理ディレクトリ&gt; &gt; python -m venv &lt;仮想環境名&gt; &gt; cd &lt;仮想環境名&gt; [/code]</p><h2 id="仮想環境のアクティベート"><a href="#仮想環境のアクティベート" class="headerlink" title="仮想環境のアクティベート"></a>仮想環境のアクティベート</h2><p>[code lang=”dos”] &gt; cd &lt;仮想環境名&gt; &gt; Scripts\activate.bat [/code]</p><h2 id="パッケージのインストール"><a href="#パッケージのインストール" class="headerlink" title="パッケージのインストール"></a>パッケージのインストール</h2><p><strong>cupy</strong>、<strong>cupy-cuda</strong>、<strong>chainer</strong>のバージョンは一致させます。 cupy-cudaの末尾の数値は、先ほど確認したCUDAのバージョンに合わせます。 また、下記の順番を守ってインストールします。 [code lang=”dos”] &gt; python -m pip install –upgrade pip &gt; python -m pip install cupy==4.5.0 &gt; python -m pip install cupy-cuda92==4.5.0 &gt; python -m pip install chainer==4.5.0 [/code]</p><h2 id="最終確認"><a href="#最終確認" class="headerlink" title="最終確認"></a>最終確認</h2><p>Chainerがインストールされたこと、ChainerがCUDA、cuDNNを認識していることを確認します。 [code lang=”dos”] &gt; python -c “import chainer; chainer.print_runtime_info()” Platform: Windows-10-10.0.17134-SP0 Chainer: 4.5.0 NumPy: 1.15.4 CuPy: CuPy Version : 4.5.0 CUDA Root : C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2 CUDA Build Version : 9020 CUDA Driver Version : 9020 CUDA Runtime Version : 9020 cuDNN Build Version : 7104 cuDNN Version : 7104 NCCL Build Version : None [/code]</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> gpupu </category>
          
          <category> Chainer </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その153 Visual Studio CodeのMarkdown機能を強化 その3</title>
      <link href="/2018/11/13/3860/"/>
      <url>/2018/11/13/3860/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回の続き。 </p><p>仕事で前回書いたことを適用して、まだ改善できるな、と思い調べてみました。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="フォント変更-コードハイライトのブロック含む"><a href="#フォント変更-コードハイライトのブロック含む" class="headerlink" title="フォント変更 (コードハイライトのブロック含む)"></a>フォント変更 (コードハイライトのブロック含む)</h2><p>箇条書き、コードハイライト、シーケンス図のActor(mermaid)に対応させます。 [code lang=”diff”] .markdown-preview.markdown-preview { // modify your style here // eg: background-color: blue;<br>- h1, h2, h3, h4, h5, h6, p { - font-family: ‘ヒラギノ丸ゴ ProN W4’, ‘游ゴシック体’, ‘Yu Gothic’, ‘YuGothic’, ‘ヒラギノ角ゴシック Pro’, ‘Hiragino Kaku Gothic Pro’, ‘ＭＳ　Ｐゴシック’, ‘MS PGothic’, sans-serif; - } + h1, + h2, + h3, + h4, + h5, + h6, + p, + pre, + li, + text.messageText, + tspan { + font-family: ‘ヒラギノ丸ゴ ProN W4’, ‘游ゴシック体’, ‘Yu Gothic’, ‘YuGothic’, ‘ヒラギノ角ゴシック Pro’, ‘Hiragino Kaku Gothic Pro’, ‘ＭＳ　Ｐゴシック’, ‘MS PGothic’, sans-serif; + } } [/code]</p><h2 id="コードハイライトのブロックを折り返す"><a href="#コードハイライトのブロックを折り返す" class="headerlink" title="コードハイライトのブロックを折り返す"></a>コードハイライトのブロックを折り返す</h2><p>CSSをカスタマイズします。 [code lang=”diff”] .markdown-preview.markdown-preview { // modify your style here // eg: background-color: blue; + pre { + overflow-x: auto; + white-space: pre-wrap; + word-wrap: break-word; + overflow-wrap: break-word; + } } [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その152 Visual Studio CodeのMarkdown機能を強化 その2</title>
      <link href="/2018/11/13/3836/"/>
      <url>/2018/11/13/3836/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回の続き。 </p><p>どうも<strong>Markdown Preview Enhanced</strong>でもヘッダー、フッターの調節ができる模様。 よく考えたら、<strong>markdown-pdf</strong>と同じ<strong>puppeteer</strong>を使っているのだから当然と言えば当然なのかな?</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="Puppeteerのインストール"><a href="#Puppeteerのインストール" class="headerlink" title="Puppeteerのインストール"></a>Puppeteerのインストール</h2><p>前回は省略したので。 <strong>Chocolately</strong>が入っているとインストールが簡単です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://chocolatey.org/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=chocolatey.org"></img><div class="hbc-site-name">Chocolatey</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://chocolatey.org/content/images/icon_slogan.png"></img></div><div class="hbc-text"><div class="hbc-title">Chocolatey - The package manager for Windows</div><div class="hbc-url">https://chocolatey.org/</div><div class="hbc-description">Chocolatey is software management automation for Windows that wraps installers, executables, zips, and scripts into compiled packages. Choco…</div></div></div></div></a></div></div><p>管理者でコンソールを起動します。 [code lang=”ps”] $ choco install nodejs /y Chocolatey v0.10.10 Installing the following packages: nodejs By installing you accept licenses for the packages. Progress: Downloading nodejs 10.13.0… 100%<br>nodejs.install v10.13.0 [Approved] nodejs.install package files install completed. Performing other installation steps. Installing 64 bit version Installing nodejs.install… nodejs.install has been installed. nodejs.install may be able to be automatically uninstalled. Environment Vars (like PATH) have changed. Close/reopen your shell to see the changes (or in powershell/cmd.exe just type `refreshenv`). The install of nodejs.install was successful. Software installed as ‘msi’, install location is likely default.<br>nodejs v10.13.0 [Approved] nodejs package files install completed. Performing other installation steps. The install of nodejs was successful. Software install location not explicitly set, could be in package or default install location if installer.<br>Chocolatey installed 2/2 packages. See the log for details (C:\ProgramData\chocolatey\logs\chocolatey.log). [/code] 続いて<strong>Node.js command prompt</strong>を起動します。 [code lang=”dos”] &gt; npm install -g puppeteer<br>&gt; puppeteer@1.10.0 install C:\Users\TAKUYA\AppData\Roaming\npm\node_modules\puppeteer &gt; node install.js<br>Downloading Chromium r599821 - 135.9 Mb [====================] 99% 0.0s Chromium downloaded to C:\Users\TAKUYA\AppData\Roaming\npm\node_modules\puppeteer\.local-chromium\win64-599821 + <a href="mailto:&#x70;&#117;&#112;&#x70;&#x65;&#116;&#x65;&#101;&#114;&#x40;&#x31;&#46;&#49;&#48;&#46;&#48;">&#x70;&#117;&#112;&#x70;&#x65;&#116;&#x65;&#101;&#114;&#x40;&#x31;&#46;&#49;&#48;&#46;&#48;</a> added 42 packages from 22 contributors in 17.873s [/code] <strong>-g</strong>オプション必須です。 起動中の<strong>Visual Studio Code</strong>は再起動します。でないとpuppeteerが反映されません。</p><h2 id="ヘッダー・フッターを付与する"><a href="#ヘッダー・フッターを付与する" class="headerlink" title="ヘッダー・フッターを付与する"></a>ヘッダー・フッターを付与する</h2><p>Markdownファイルの先頭に下記のような記述を追記。 [code lang=”markdown”] — puppeteer: displayHeaderFooter: true headerTemplate: “<span>This is header</span>“ footerTemplate: “<span>This is footer</span>“ — [/code] ただし、デフォルトだと出力文字がすごく小さい。 この領域は、タグが使える。なので下記のようにフォントを使って調整可能。 [code lang=”markdown”] — puppeteer: displayHeaderFooter: true headerTemplate: “&lt;div style=\“font-size: 9px; margin-left: 1cm;\“&gt; <span>This is header</span></div>“ footerTemplate: “<span>This is footer</span>“ — [/code] ヘッダー・フッターにはテンプレートが使える。</p><p>定義</p><p>意味</p><p>使用例</p><p>date</p><p>日付</p><p><span class='date'></span></p><p>title</p><p>ファイル名</p><p><span class='title'></span></p><p>url</p><p>フルパスファイル名</p><p><span class='url'></span></p><p>pageNumber</p><p>現在のページ番号</p><p><span class='pageNumber'></span></p><p>totalPages</p><p>ドキュメントの総ページ数</p><p><span class='totalPages'></span></p><h2 id="背景を印刷する"><a href="#背景を印刷する" class="headerlink" title="背景を印刷する"></a>背景を印刷する</h2><p>前回言及したコードハイライトのブロックの背景が白くなる問題の解決。 [code lang=”markdown”] — puppeteer: printBackground : true — [/code]</p><h2 id="日本語が文字化け"><a href="#日本語が文字化け" class="headerlink" title="日本語が文字化け"></a>日本語が文字化け</h2><p>フォントの問題と思われる。</p><p><a href="../../../../public/2018/11/1-2.png"><img src="../../../../public/2018/11/1-2-300x277.png"></a><br> プレビュー</p><p><a href="../../../../public/2018/11/2-1.png"><img src="../../../../public/2018/11/2-1-236x300.png"></a><br> PDF出力</p><p>中国語フォントっぽいなぁ… ただ、puppeteerのバージョンの問題という情報が。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://uyamazak.hatenablog.com/entry/2018/11/09/131009" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=uyamazak.hatenablog.com"></img><div class="hbc-site-name">GAミント至上主義</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/u/uyamazak/20181109/20181109130551.png"></img></div><div class="hbc-text"><div class="hbc-title">【解決】puppeteerを1.10にするとPDFの日本語が文字化けする問題 - GAミント至上主義</div><div class="hbc-url">https://uyamazak.hatenablog.com/entry/2018/11/09/131009</div><div class="hbc-description">2018/11/13 追記 結論 Chromium 72.0.3606.0(Developer Build)を使ったところ直ったので、次のバージョン（1.11）では直るはず。 そのため1.10をスキップするだけで問題は解決しそう。追記ここまで yagish履歴書のHTML→PDF…</div></div></div></div></a></div></div><p>1.10.0が問題とのことなので1.9.0に戻してみる。 [code lang=”dos”] &gt; npm install -g <a href="mailto:&#112;&#117;&#112;&#x70;&#x65;&#116;&#101;&#101;&#x72;&#64;&#49;&#x2e;&#x39;&#46;&#x30;">&#112;&#117;&#112;&#x70;&#x65;&#116;&#101;&#101;&#x72;&#64;&#49;&#x2e;&#x39;&#46;&#x30;</a> [/code] 直りました。<br><a href="../../../../public/2018/11/3-1.png"><img src="../../../../public/2018/11/3-1-236x300.png"></a></p><h2 id="フォント変更"><a href="#フォント変更" class="headerlink" title="フォント変更"></a>フォント変更</h2><p>前回との同じくCSSをカスタマイズします。 [code] .markdown-preview.markdown-preview { // modify your style here // eg: background-color: blue;<br>h1, h2, h3, h4, h5, h6, p { font-family: ‘ヒラギノ丸ゴ ProN W4’, ‘游ゴシック体’, ‘Yu Gothic’, ‘YuGothic’, ‘ヒラギノ角ゴシック Pro’, ‘Hiragino Kaku Gothic Pro’, ‘ＭＳ　Ｐゴシック’, ‘MS PGothic’, sans-serif; } } [/code]<br><a href="../../../../public/2018/11/4-1.png"><img src="../../../../public/2018/11/4-1-236x300.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その151 Visual Studio CodeのMarkdown機能を強化</title>
      <link href="/2018/11/12/3825/"/>
      <url>/2018/11/12/3825/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>仕事では<strong>Visual Studio Code</strong>を使ってMarkdownを書いています。拡張機能の<strong>markdown-pdf</strong>にはお世話になっております。 </p><p>最近、<strong>mermaid</strong>というガントチャートやフローチャートをテキストで記述できるライブラリが気になっており、これがVisual Studio Codeで使えると聞いて興奮しています。 しかし、markdown-pdfがこれに対応していません。 では、これに対応しているpdf変換というと、<strong>Markdown Preview Enhanced</strong>という<strong>Atom</strong>でも有名な拡張になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://shd101wyy.github.io/markdown-preview-enhanced/#/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=shd101wyy.github.io"></img><div class="hbc-site-name">shd101wyy.github.io</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Markdown Preview Enhanced</div><div class="hbc-url">https://shd101wyy.github.io/markdown-preview-enhanced/#/</div><div class="hbc-description">Description</div></div></div></div></a></div></div><p>しかし、これはこれで結構癖があります。 PDF出力に5種類の方法がありますが、これがまぁ微妙。</p><ul><li>Chrome (Puppetter)<ul><li>一番まとも。ただし、<strong>Nodejs</strong>のインストールが必要。結果はHTML化してChromeからPDF化したのと変わらない感じ。</li></ul></li><li>phantomjs<ul><li>開発が終了している。出力結果はそこそこ。</li></ul></li><li>prince<ul><li>商用利用不可。また結果は微妙。有償の価値はない。</li></ul></li><li>eBook<ul><li>ためしてない</li></ul></li><li>pandoc<ul><li>cssを指定しても微妙。mermaidの結果は解釈できていない。</li></ul></li></ul><p>あと、</p><ul><li><strong>Alt text</strong>の解釈がおかしい</li><li><strong>h1</strong>タグの直下に水平線が表示されない</li><li>コードハイライトの背景が白くなる<ul><li>これは印刷オプションで背景を印刷しない、にしていることが要因</li></ul></li><li>コードハイライトのブロックに境界線がない</li><li>表の形式が古くさい<ul><li>ただ、Githubも表の4隅の境界線がある。違いは1行おきに背景色が変化するところ。</li></ul></li></ul><p>が気になった問題。 良い点として、</p><ul><li>見出しのフォントが適度に太字</li><li>mermaidが使える</li><li>改行するのに末尾に空白が不要</li></ul><p>があります。 何はともあれ、気になった点を改善していきます。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="Alt-text-の解釈"><a href="#Alt-text-の解釈" class="headerlink" title="Alt text の解釈"></a>Alt text の解釈</h2><p>諦める。使わなければ良い。仕事で使ったことはないからOK。</p><h2 id="h1に水平線が表示されない"><a href="#h1に水平線が表示されない" class="headerlink" title="h1に水平線が表示されない"></a>h1に水平線が表示されない</h2><p>これはMarkdown Preview Enahancedのcssを修正することで対応。 <strong>Ctrl + Shift + P</strong>を押下し、<strong>Markdown Preview Enhanced: Customize Css</strong>を開きます。 そして下記のように修正を行います。 [code lang=”diff”] .markdown-preview.markdown-preview { // modify your style here // eg: background-color: blue;<br>+ h1 { + padding-bottom: 0.3em; + line-height: 1.2; + border-bottom-width: 1px; + border-bottom-style: solid; + } } [/code]</p><h2 id="コードハイライトの背景が白くなる"><a href="#コードハイライトの背景が白くなる" class="headerlink" title="コードハイライトの背景が白くなる"></a>コードハイライトの背景が白くなる</h2><p>前述の通り、印刷設定で背景が描画されないのが問題である。 対処として、PDFに出力するのではなく、htmlに出力し、ChromeでPDFに出力する際、背景を出力するようにすればOK</p><h2 id="コードハイライトのブロックに境界線がない"><a href="#コードハイライトのブロックに境界線がない" class="headerlink" title="コードハイライトのブロックに境界線がない"></a>コードハイライトのブロックに境界線がない</h2><p>これもMarkdown Preview Enahancedのcssを修正することで対応。 <strong>Ctrl + Shift + P</strong>を押下し、<strong>Markdown Preview Enhanced: Customize Css</strong>を開きます。 そして下記のように修正を行います。 [code lang=”diff”] .markdown-preview.markdown-preview { // modify your style here // eg: background-color: blue;<br>h1 { padding-bottom: 0.3em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; }<br>+ pre[class*=”language-“] { + border: 1px solid #ddd; + } } [/code]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>片方だけを使うというのは駄目かな。しばらくは両方使っていきます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その150 ローカルNugetServer on Docker</title>
      <link href="/2018/11/11/3818/"/>
      <url>/2018/11/11/3818/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>自分でローカルに<strong>Nuget</strong>のサーバーを運用していたのは前からだったんだけど、dockerをきちんと使い始める前の「なんとなく」で使っていたため今いちわかっていなかった。 そのため、今一度最初から復習してみる。 何故自分でローカルのNugetサーバーを作るか、というのは</p><ol><li>本家Nugetに公開する前の確認</li><li>本家Nugetには公開できない社内製ライブラリ用</li></ol><p>だと思います。私は前者です。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>dockerで簡単に動作するPHP製のNugetサーバーを使います。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/sunsided/docker-nuget" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/495335?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">sunsided/docker-nuget</div><div class="hbc-url">https://github.com/sunsided/docker-nuget</div><div class="hbc-description">A simple NuGet feed using docker. Contribute to sunsided/docker-nuget development by creating an account on GitHub.</div></div></div></div></a></div></div><h2 id="コンテナ作成"><a href="#コンテナ作成" class="headerlink" title="コンテナ作成"></a>コンテナ作成</h2><script src="https://gist.github.com/takuya-takeuchi/c57ab7b608834dad13afa78ee33c48a9.js"></script><h3 id="例"><a href="#例" class="headerlink" title="例"></a>例</h3><script src="https://gist.github.com/takuya-takeuchi/5836161c2b63aaf975608fd2925b9824.js"></script><h2 id="パッケージの追加"><a href="#パッケージの追加" class="headerlink" title="パッケージの追加"></a>パッケージの追加</h2><script src="https://gist.github.com/takuya-takeuchi/43909d7c58490d0ab806f52cb94617b6.js"></script> 下記は**NuGet Package Explorer**でローカルのNugetサーバーの一覧を表示してみた例。 追加されたパッケージが見えます。 <p><a href="../../../../public/2018/11/1-1.png"><img src="../../../../public/2018/11/1-1-1024x549.png"></a></p><h2 id="パッケージの削除"><a href="#パッケージの削除" class="headerlink" title="パッケージの削除"></a>パッケージの削除</h2><script src="https://gist.github.com/takuya-takeuchi/685003c93e6820e729d6892fa6f78114.js"></script>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> NuGet </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その149 Dockerで固定IP</title>
      <link href="/2018/11/11/3815/"/>
      <url>/2018/11/11/3815/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>そのものずばりな記事がこちら。すごく丁寧。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qiita.com/paihu/items/17aa47906dd2bf935a25" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DDocker%25E3%2581%25A7%25E5%259B%25BA%25E5%25AE%259AIP%25E3%2582%25A2%25E3%2583%2589%25E3%2583%25AC%25E3%2582%25B9%25E3%2582%2592%25E4%25BD%25BF%25E3%2581%2586%25E3%2580%2582%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3De8f5bbbb89c591e47c389c075db8ea29&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540paihu%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3D60a4c3d166e64aeb2fe611c890584789&blend-align=center%2Cmiddle&blend-mode=normal&s=156047a1ecb435ac5cfbf4398e8dc00e"></img></div><div class="hbc-text"><div class="hbc-title">Dockerで固定IPアドレスを使う。 - Qiita</div><div class="hbc-url">https://qiita.com/paihu/items/17aa47906dd2bf935a25</div><div class="hbc-description">Dockerで固定IPアドレスを使う。最近のDockerでは固定IPアドレスが普通に使えるようになっていたのでメモ。試した環境はCentOS7です。新しいバージョンのDockerをインストールする。現在、CentO...</div></div></div></div></a></div></div><h2 id="ネットワークを作成"><a href="#ネットワークを作成" class="headerlink" title="ネットワークを作成"></a>ネットワークを作成</h2><p>ここが大事。 既定のネットワークである<strong>Bridge</strong>では固定IPが使えない。 [code lang=”dos”] $ docker network create –subnet=&lt;ネットワークアドレス&gt;/&lt;サブネットマスク&gt; &lt;新しいネットワーク名&gt; [/code]</p><h4 id="例"><a href="#例" class="headerlink" title="例"></a>例</h4><p>[code lang=”dos”] $ docker network create –subnet=172.16.0.0/16 mynet [/code] 作成したネットワークは下記で確認。 [code lang=”dos”] $ docker network ls NETWORK ID NAME DRIVER SCOPE a4a7dc12da84 bridge bridge local b2e97ac5fc42 host host local ecaf2a1b55d3 mynet bridge local c6d5386a2054 none null local<br>$ docker network inspect mynet [ { “Name”: “mynet”, “Id”: “ecaf2a1b55d3be072f58c5629e0a0b5081af0769a43fb40824f032e5361f9355”, “Created”: “2018-11-10T13:28:59.340134Z”, “Scope”: “local”, “Driver”: “bridge”, “EnableIPv6”: false, “IPAM”: { “Driver”: “default”, “Options”: {}, “Config”: [ { “Subnet”: “172.16.0.0/16” } ] }, “Internal”: false, “Attachable”: false, “Ingress”: false, “ConfigFrom”: { “Network”: “” }, “ConfigOnly”: false, “Containers”: {}, “Options”: {}, “Labels”: {} } ] [/code]</p><h2 id="ネットワークに追加"><a href="#ネットワークに追加" class="headerlink" title="ネットワークに追加"></a>ネットワークに追加</h2><p>コンテナ実行時にネットワークを指定してIPも指定します。 当然、IPはネットワークで指定したネットワークアドレスの範囲内であること。 例えば下記のように指定します。 [code lang=”dos”] $ docker run –name mysql ^ -e MYSQL_ROOT_PASSWORD=password ^ -d ^ -v /d/virtualMachines/docker/volume/mysql:/var/lib/mysql ^ -p 3306:3306 ^ –net=mynet ^ –ip=172.16.0.2 ^ mysql:5.7 [/code] <strong>--net</strong>を省略すると、下記のように怒られます。 [code lang=”dos”] docker: Error response from daemon: user specified IP address is supported on user defined networks only. [/code]</p><h2 id="ネットワークの確認"><a href="#ネットワークの確認" class="headerlink" title="ネットワークの確認"></a>ネットワークの確認</h2><p>コンテナの中に入って確認してみます。 [code lang=”dos”] $ docker exec -it mysql /bin/bash # cat /etc/hosts 127.0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 172.16.0.2 4055c6c61419 [/code] dockerコンテナの既定のIPアドレスは<strong>172.17.0.0/16</strong>なので、きちんと変わっていますね。</p><h2 id="疎通確認"><a href="#疎通確認" class="headerlink" title="疎通確認"></a>疎通確認</h2><p>コンテナ起動時にポート転送設定(<em>-p オプション</em>)がしてあるなら、ホストOSからでもつながります。 逆に設定がしていないなら、同一のdockerネットワークを経由しないとつながらなくなります。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その148 Metabase on DockerをMySQLで動かす</title>
      <link href="/2018/11/10/3792/"/>
      <url>/2018/11/10/3792/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>会社で<strong>Chainer</strong>によるディープラーニングの案件がきました。 データ解析が必要なためデータの可視化が必要なのですが、諸事情で<strong>ChainerUI</strong>が使えません。 なので、出力結果をデータベースに格納して解析します。 そのために、<strong>BI (Business Intelligence)**ツールである</strong>Metabase**を導入することにしました。 また勉強もかねてDockerでも動かします。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>MySQLは別コンテナで稼働中であるとする。 作成方法は下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2018/11/09/3782" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">開発メモ その147 MySQLをDockerで動かす – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2018/11/09/3782</div></div></div></div></a></div></div><p>また、Metabaseそのもののデータベースはホストに永続化するものとする。</p><h2 id="Metabaseの作成"><a href="#Metabaseの作成" class="headerlink" title="Metabaseの作成"></a>Metabaseの作成</h2><p>[code lang=”dos”] $ docker pull metabase/metabase:latest $ docker run –name &lt;コンテナの名前&gt; ^ -d ^ -v /c/Users/{ユーザディレクトリ}/Documents/workspace:/tmp ^ -e “MB_DB_FILE=/tmp/metabase.db” ^ -p &lt;ホストのポート&gt;:3000 ^ metabase/metabase:latest [/code]</p><h2 id="データベースの作成"><a href="#データベースの作成" class="headerlink" title="データベースの作成"></a>データベースの作成</h2><p>MySQL側でデータベースを作成しておく。 [code lang=”sql”] CREATE DATABASE &lt;データベース名&gt;; GRANT ALL ON &lt;データベース名&gt;.* to &lt;ユーザ名&gt;@localhost; FLUSH PRIVILEGES; [/code]</p><h2 id="起動"><a href="#起動" class="headerlink" title="起動"></a>起動</h2><p>コンテナ作成時に指定したポートにブラウザでアクセスしましょう。<br><a href="../../../../public/2018/11/1.png"><img src="../../../../public/2018/11/1-1024x720.png"></a></p><h2 id="ユーザ作成"><a href="#ユーザ作成" class="headerlink" title="ユーザ作成"></a>ユーザ作成</h2><p>ユーザを作成します。 ちょっと日本語が怪しいです。気にしない。 余談ですが、パスワードは数字が必須ですが、アルファベットは必須ではないです。 どういうルールなのでしょうか。<br><a href="../../../../public/2018/11/2.png"><img src="../../../../public/2018/11/2-1016x1024.png"></a></p><h2 id="データベースマネージメントシステムの指定"><a href="#データベースマネージメントシステムの指定" class="headerlink" title="データベースマネージメントシステムの指定"></a>データベースマネージメントシステムの指定</h2><p>解析データを含むデータベースマネージメントシステムを指定します。 後から追加もできます。</p><p>フィールド</p><p>概要</p><p><strong>名前</strong></p><p>データベースマネージメントシステムを識別する名前。自由に決めることができます。</p><p><strong>Host</strong></p><p>データベースマネージメントシステムのIPアドレス。<br><strong>localhostはDockerコンテナのアドレスになるので注意。</strong></p><p><strong>Port</strong></p><p>データベースマネージメントシステムの待ち受けポート。Hostによって変わります。</p><p><strong>Database name</strong></p><p>データベースマネージメントシステム内に含まれる、解析対象のデータベースの名前。</p><p><strong>Database username</strong></p><p>データベースマネージメントシステムへの接続ユーザ名</p><p><strong>Database password</strong></p><p>ユーザのパスワード</p><p><strong>Additional JDBC connection string options</strong></p><p>JDBCに渡すオプション文字列。必須ではありません。</p><p><a href="../../../../public/2018/11/3.png"><img src="../../../../public/2018/11/3-655x1024.png"></a></p><h2 id="データ収集への同意"><a href="#データ収集への同意" class="headerlink" title="データ収集への同意"></a>データ収集への同意</h2><p>ちょっと日本語が怪しいです。気にしない。<br><a href="../../../../public/2018/11/4.png"><img src="../../../../public/2018/11/4-1024x837.png"></a></p><h2 id="ニュースレター購読確認"><a href="#ニュースレター購読確認" class="headerlink" title="ニュースレター購読確認"></a>ニュースレター購読確認</h2><p>必要ないなら、<strong>Metabaseを使い始める</strong>を押下するだけ。<br><a href="../../../../public/2018/11/5.png"><img src="../../../../public/2018/11/5-1024x951.png"></a></p><h2 id="I’m-Ready"><a href="#I’m-Ready" class="headerlink" title="I’m Ready!!"></a>I’m Ready!!</h2><p><a href="../../../../public/2018/11/6.png"><img src="../../../../public/2018/11/6-1024x730.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Business Intelligence </category>
          
          <category> business-intelligence </category>
          
          <category> Metabase </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その147 MySQLをDockerで動かす</title>
      <link href="/2018/11/09/3782/"/>
      <url>/2018/11/09/3782/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>起動するだけなら何でもないのだが、コンテナ内のデーモンに繋がらない。 これで時間を無駄にした。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="構文"><a href="#構文" class="headerlink" title="構文"></a>構文</h2><p>[code lang=”dos”] $ docker pull mysql $ docker run –name &lt;コンテナの名前&gt; ^ -e MYSQL_ROOT_PASSWORD=&lt;ROOTユーザーのパスワード&gt; ^ -d ^ -v /c/Users/{ユーザディレクトリ}/Documents/workspace:/var/lib/mysql ^ -p &lt;ホストのポート&gt;:&lt;コンテナのポート&gt; ^ mysql $ mysql –user=root –password=&lt;ROOTユーザーのパスワード&gt; -h localhost –port=&lt;ホストのポート&gt; [/code]</p><h2 id="例"><a href="#例" class="headerlink" title="例"></a>例</h2><p>[code lang=”dos”] $ docker pull mysql:5.7 $ docker run –name mysql ^ -e MYSQL_ROOT_PASSWORD=password ^ -d ^ -v /d/works/mysql:/var/lib/mysql ^ -p 53306:3306 ^ mysql:5.7 $ mysql –user=root –password=password -h localhost –port=53306 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \g. Your MySQL connection id is 19 Server version: 5.7.24 MySQL Community Server (GPL)<br>Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.<br>Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners.<br>Type ‘help;’ or ‘\h’ for help. Type ‘\c’ to clear the current input statement.<br>mysql&gt; [/code]</p><h1 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h1><p>躓いたのは<strong>mysql</strong>で接続する際の<strong>パスワード指定</strong>。 普通、対話形式でパスワードを聞かれるから指定しなくてもいいかな?と思う。 現にパスワードをコマンドラインで指定すると、 [code lang=”dos”] mysql: [Warning] Using a password on the command line interface can be insecure. [/code] というありがたい警告。 パスワードを聞かれるようにするには [code lang=”dos”] $ mysql –user=root –password -h localhost –port=53306 Enter password: [/code] というようにする。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> rdms </category>
          
          <category> MySQL </category>
          
          <category> データベース </category>
          
          <category> RDMS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その146 Windows10 1709以降でNASにアクセスできない</title>
      <link href="/2018/11/08/3778/"/>
      <url>/2018/11/08/3778/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 前提として、<strong>SMB 1.0</strong>が原因ではない。 アクセスするNASのルートがゲストで誰でも表示できて、その配下のディレクトリがユーザ毎にアクセス制限されているパターンです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>状況はこう。 NASのIPは<strong>AAA.BBB.CCC.DDD</strong>。</p><ul><li>\\AAA.BBB.CCC.DDD<ul><li>誰でも見える。配下のフォルダが見える</li></ul></li><li>\\AAA.BBB.CCC.DDD\HOGE<ul><li>アクセス制御あり</li></ul></li></ul><p>上の状況で、HOGEに対するアクセス制御として認証ダイアログが出て欲しいものだがそうは問屋が卸さない。 原因として、 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://support.microsoft.com/ja-jp/help/4046019/guest-access-in-smb2-disabled-by-default-in-windows-10-and-windows-ser" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=support.microsoft.com"></img><div class="hbc-site-name">support.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">SMB2 でのゲストアクセスが無効になっている - Windows Server</div><div class="hbc-url">https://support.microsoft.com/ja-jp/help/4046019/guest-access-in-smb2-disabled-by-default-in-windows-10-and-windows-ser</div><div class="hbc-description">Windows 10、Windows Server 2019 および2016では、SMB2 のゲストアクセスは既定で無効になっています。</div></div></div></div></a></div></div><p>匿名認証によるNASへのアクセスが無効になったためである。 つまり、HOGEにアクセスする前に、ルートでの匿名認証に引っかかってしまったのである。 このあたりの情報は散々出尽くしているので語らないが、<strong>SMB 1.0</strong>が無効化されたこととは何の関係もない。 だから、Windows10を1709以降にして、NASにアクセスできなくなったからといって、<strong>プログラムの追加と削除</strong>から<strong>Windowsの機能の有効化または無効化</strong>をたどり、<strong>SMB 1.0/CIFS ファイル共有のサポート</strong>を有効化しても意味がありません。 これを有効にして動かなかったからほかの対策と組み合わせて動いてしまい、あたかも<strong>SMB 1.0</strong>の有効化も必須だと思ってはいけません。 対策は、</p><ol><li>NASの設定を変更して匿名アクセスを無効にする</li><li>レジストリの<strong>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters\AllowInsecureGuestAuth</strong>を<strong>1</strong>に変更する。存在しない場合は作成。</li></ol><p>となる。 確かに1が正しいと思うけど、匿名認証でアクセスできる場所の配下が見られても困らない、あるいはその配下がアクセス権制御されているなら、そこまで困らないと思うんですがどうでしょう。 いや、見られることによりどんな情報があるのか、という情報を与えてしまうのは良くないとはわかっていますが。 あとは、知らないうちに制御を奪われて匿名認証の場所にアクセスされたら困る..とか?</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その16 電話を使ってみる</title>
      <link href="/2018/11/03/1249/"/>
      <url>/2018/11/03/1249/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-jP">前回</a>はAndroidで発生したUnizipped failedエラーを解決しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Xamarinにおいて、UIはXamarin.FormsをSharedまたはPCLプロジェクトに定義することで共通化を図っています。 しかしながら、デバイス固有の機能、例えば電話、カメラ、ファイル選択、指紋認証などは共通化されていません。 そのために、Xamarinでは<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.DependencyService/">Xamarin.Forms.DependencyService</a>クラスを利用して、共通コードからデバイス固有の機能にアクセスします。 <a href="https://developer.xamarin.com/guides/xamarin-forms/dependency-service/introduction/">Introduction to DependencyService</a>に詳しく書いてありますが、ポイントは各プロジェクト (iOS、Android、UWP、Windows Phone)で同じinterfaceを実装し、その実装をDependencyServiceクラス経由で取得し、呼び出しているだけです。要するに、<strong>Dependency Injection (依存性の注入)</strong> です。 <a href="../../../../public/2016/05/overview_diagram.png"><img src="../../../../public/2016/05/overview_diagram-1024x562.png" alt="概要"></a></p><p>概要図 (<a href="https://developer.xamarin.com/guides/xamarin-forms/dependency-service/introduction/%E3%82%88%E3%82%8A%E5%BC%95%E7%94%A8">https://developer.xamarin.com/guides/xamarin-forms/dependency-service/introduction/より引用</a>)</p><p>今回は電話を使ってみようと思います。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>オープンソースでデバイス固有の機能をライブラリとして提供しているパッケージがあります。 <a href="https://www.nuget.org/packages/XLabs.Forms/">XLabs - Forms</a>(<a href="https://github.com/XLabs/Xamarin-Forms-Labs">Github</a>) Xamarin.Forms用の、クロスプラットフォーム向けに個別対応されたコントロール群とヘルパーのライブラリとのこと。 ですが、UWPの対応が良くない、というか大量にコメントアウトしてあって、どうも一時対応を休止しているような感じです。 また、最新版のソースだと、iOSのビルドに問題があるため、Androidしか使えない状態なので、自分で実装します。</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><h4 id="Xamarin-Forms"><a href="#Xamarin-Forms" class="headerlink" title="Xamarin.Forms"></a>Xamarin.Forms</h4><p>Xamarin.Formsを2.1.0.6529に更新してください。2.2に更新しないでください。 また、2.0.0.6482のままでもダメです。 さもなくば、Androidで下記のようなエラーが大量に出ます。 <code>&#39;Resource.Dimension&#39; does not contain a definition for &#39;dialog_fixed_width_major&#39;</code> みたいなエラーです。 <a href="https://github.com/XLabs/Xamarin-Forms-Labs/issues/1125">XLabs.Forms fails compilation with Xamarin Forms 2.2 versions</a> という問題が提起されていますが、問題はXamarin.Fomrs側の問題とのこと。 もう少し動きがあるまでは更新はやめましょう。 2.1.0.6529ならエラーが起きない、という意見もありますし、私も、そのバージョンだと問題が発生しませんでした。</p><h4 id="Xlabs"><a href="#Xlabs" class="headerlink" title="Xlabs"></a>Xlabs</h4><p>少し不安ですが、プレリリースバージョン2.0.5783-pﾚ01を使用してください。 さもなくば、UWPをビルドできません。</p><h3 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h3><p>各種プロジェクトに修正を加えます。</p><h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p><strong>AppDelegate.cs</strong>の下記の記述を [code lang=”csharp”] [Register(“AppDelegate”)] public partial class AppDelegate : global::Xamarin.Forms.Platform.iOS.FormsApplicationDelegate 下記のように修正します (usingは適宜追加)。 [code lang=”csharp”] [Register(“AppDelegate”)] public partial class AppDelegate : XFormsApplicationDelegate [/code]</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p><strong>MainActivity.cs</strong>の下記の記述を [code lang=”csharp”] [Activity(Label = “Xamarin.Forms.Portable5”, Icon = “@drawable/icon”, MainLauncher = true, ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation)] public class MainActivity : global::Xamarin.Forms.Platform.Android.FormsApplicationActivity [/code] 下記のように修正します (usingは適宜追加)。 &lt; pre class=”lang:c# decode:true “ &gt; [Activity(Label = “Xamarin.Forms.Portable5”, Icon = “@drawable/icon”, MainLauncher = true, ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation)] public class MainActivity : global::Xamarin.Forms.Platform.Android.FormsApplicationActivity [/code]</p><h4 id="UWP"><a href="#UWP" class="headerlink" title="UWP"></a>UWP</h4><p>現在、githubでも問題になっており、<strong>XLabs.Forms.WinUniversal.dll</strong>と<strong>XLabs.Platform.WinUniversal.dll</strong>がNugetで参照できなくなっています。 ですので、githubからソースをクローンしてビルドして参照します。 その後、<strong>App.xaml.cs</strong>の下記の記述を [code lang=”csharp”] if (rootFrame == null) { // Create a Frame to act as the navigation context and navigate to the first page rootFrame = new Windows.UI.Xaml.Controls.Frame();<br>rootFrame.NavigationFailed += OnNavigationFailed;<br>Xamarin.Forms.Forms.Init(e);<br>if (e.PreviousExecutionState == ApplicationExecutionState.Terminated) { //TODO: Load state from previously suspended application }<br>// Place the frame in the current Window Window.Current.Content = rootFrame; } [/code] 下記のように修正します (usingは適宜追加)。 [code lang=”csharp”] if (rootFrame == null) { // Create a Frame to act as the navigation context and navigate to the first page rootFrame = new Windows.UI.Xaml.Controls.Frame();<br>rootFrame.NavigationFailed += OnNavigationFailed;<br>var app = new XLabs.Forms.XFormsAppWin(); app.Init(this);<br>Xamarin.Forms.Forms.Init(e);<br>if (e.PreviousExecutionState == ApplicationExecutionState.Terminated) { //TODO: Load state from previously suspended application }<br>// Place the frame in the current Window Window.Current.Content = rootFrame; } [/code]</p><h4 id="共通"><a href="#共通" class="headerlink" title="共通"></a>共通</h4><p>各プロジェクトのスタートアップコードに下記の記述を追加します。 基本は、前述の付近と同じです。 <strong>AppDelegate.cs (iOS)</strong> [code lang=”csharp”] public override bool FinishedLaunching(UIApplication app, NSDictionary options) { global::Xamarin.Forms.Forms.Init(); LoadApplication(new App());<br>var container = new SimpleContainer(); container.Register(t =&gt; AppleDevice.CurrentDevice); container.Register(t =&gt; new MediaPicker());<br>Resolver.SetResolver(container.GetResolver());<br>return base.FinishedLaunching(app, options); } [/code] <strong>MainActivity.cs (Android)</strong> [code lang=”csharp”] protected override void OnCreate(Bundle bundle) { base.OnCreate(bundle);<br>var container = new SimpleContainer(); container.Register(t =&gt; AndroidDevice.CurrentDevice); container.Register(t =&gt; new MediaPicker());<br>Resolver.SetResolver(container.GetResolver());<br>global::Xamarin.Forms.Forms.Init(this, bundle); LoadApplication(new App()); } [/code] <strong>Appxaml.cs (iOS)</strong> [code lang=”csharp”] public override bool FinishedLaunching(UIApplication app, NSDictionary options) { global::Xamarin.Forms.Forms.Init(); LoadApplication(new App());<br>var container = new SimpleContainer(); container.Register(t =&gt; AppleDevice.CurrentDevice); container.Register(t =&gt; new MediaPicker());<br>Resolver.SetResolver(container.GetResolver());<br>return base.FinishedLaunching(app, options); } [/code]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Windows7、Windows10と2つの環境で発生しています。私だけの環境だとは思えないのですが…</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その145 Linux on Hyper-Vの解像度を変更する</title>
      <link href="/2018/11/03/3229/"/>
      <url>/2018/11/03/3229/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。絶対忘れるやつだし、これ。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>Hyper-VにおけるゲストLinuxの既定の解像度サイズは<strong>1152x864</strong>の模様。</p><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><p>16.04.5で確認。 [code lang=”shell”] $ sudo vi /etc/default/grub [/code] [code lang=”diff”] - GRUB_CMDLINE_LINUX_DEFAULT=”quiet splash” + GRUB_CMDLINE_LINUX_DEFAULT=”quiet splash video=hyperv_fb:1600x1200” [/code] [code lang=”shell”] $ sudo update-grub $ sudo reboot [/code]</p><h2 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h2><p>7.5で確認。 [code lang=”shell”] $ grubby –update-kernel=ALL –args=”video=hyperv_fb:1600x1200” $ reboot [/code]</p><h2 id="Fedora"><a href="#Fedora" class="headerlink" title="Fedora"></a>Fedora</h2><p>28で確認。 [code lang=”shell”] $ grubby –update-kernel=ALL –args=”video=hyperv_fb:1600x1200” $ reboot [/code]</p><h2 id="Red-Hat-Enterprise-Linux"><a href="#Red-Hat-Enterprise-Linux" class="headerlink" title="Red Hat Enterprise Linux"></a>Red Hat Enterprise Linux</h2><p>7.6で確認。 [code lang=”shell”] $ grubby –update-kernel=ALL –args=”video=hyperv_fb:1600x1200” $ reboot [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Hyper-V </category>
          
          <category> CentOS </category>
          
          <category> Fedora </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その144 Chainer DCGANのサンプル</title>
      <link href="/2018/11/03/3621/"/>
      <url>/2018/11/03/3621/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Chainer</strong>の<strong>DCGAN</strong>サンプルを実行してみた。 何も指定しないと自動で<strong>CIFAR-10</strong>のデータセットをダウンロードして学習と評価を行ってくれます。便利。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>ついでに<strong>Chainer UI</strong>で可視化もしてみました。 gitソースからサンプルを実行する際は、インストールしたchainerとgitソースのブランチを合わせておきましょう。 </p><p>実行のコマンドは下記。規定では1000Epochで100iter/Epochになります。 ちなみにとてつもないサイズのファイルが大量に出力されるので空き容量には注意。 [code lang=”dos”] $ python -i train_dcgan.py -g 0 [/code] 可視化した結果。<br><a href="../../../../public/2018/11/screencapture-localhost-5000-projects-1-2018-11-03-00_40_36.png"><img src="../../../../public/2018/11/screencapture-localhost-5000-projects-1-2018-11-03-00_40_36-1024x763.png"></a></p><ul><li>明るい赤 (Generator/Loss)</li><li>暗い赤 (Discriminator/Loss)</li></ul><p>になります。 <strong>Generator/Loss</strong>が<strong>Discriminator/Loss</strong>より一貫して高いの良い、という認識でOK? </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://cedro3.com/ai/dcgan-vector-control/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=cedro3.com"></img><div class="hbc-site-name">cedro-blog</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://cedro3.com/wp-content/uploads/2018/05/キャプチャ-1.jpg"></img></div><div class="hbc-text"><div class="hbc-title">NNabla DCGAN 生成される顔画像を入力ベクトルでコントロールする（前編） | cedro-blog</div><div class="hbc-url">http://cedro3.com/ai/dcgan-vector-control/</div><div class="hbc-description">今回は、DCGANの推論実行時に、入力ベクトルを操作することによって、生成画像のカテゴリーをコントロールしてみます。「前編」は顔画像生成器の作成までやってみます。</div></div></div></div></a></div></div><p>下記は出力画像を連続したビデオにしてみたものです。 (Google Chromeだと再生されません。) [video width=”320” height=”320” mp4=”../../../../public/2018/11/dcgan.mp4”][/video]</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Chainer </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その143 Pythonの仮想環境を正しく使う</title>
      <link href="/2018/11/01/3613/"/>
      <url>/2018/11/01/3613/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>以前こんな記事を書きました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2018/07/21/3094" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">開発メモ その127 Anaconda navigatorの仮想環境のディレクトリを変更する – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2018/07/21/3094</div></div></div></div></a></div></div> <div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2018/10/20/3218" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">開発メモ その137 Chainer with CUDA on Anaconda3 for Windowsを使う – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2018/10/20/3218</div></div></div></div></a></div></div><p>が、仮想環境の使い方としてはよろしくないので、正しく使う方法を。 前提として、<strong><em>Python 3.3以上</em></strong>が対象です。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="仮想環境の作成"><a href="#仮想環境の作成" class="headerlink" title="仮想環境の作成"></a>仮想環境の作成</h2><p>まず、仮想環境を管理するディレクトリ(以下管理ディレクトリ)を用意します。どこでも良いです。 1カ所で管理するほうが綺麗です。 [code lang=”dos”] $ cd &lt;管理ディレクトリ&gt; $ python -m venv &lt;仮想環境名&gt; [/code] 正確には、 [code lang=”dos”] $ python -m venv &lt;仮想環境の作成先ディレクトのパス&gt; [/code] になります。</p><h2 id="仮想環境の実行"><a href="#仮想環境の実行" class="headerlink" title="仮想環境の実行"></a>仮想環境の実行</h2><h3 id="Windowsの場合"><a href="#Windowsの場合" class="headerlink" title="Windowsの場合"></a>Windowsの場合</h3><p>[code lang=”dos”] $ cd &lt;仮想環境の作成先ディレクトのパス&gt; $ Scripts\activate.bat [/code]</p><h3 id="Linuxの場合"><a href="#Linuxの場合" class="headerlink" title="Linuxの場合"></a>Linuxの場合</h3><p>[code lang=”shell”] $ cd &lt;仮想環境の作成先ディレクトのパス&gt; $ source bin/activate [/code]</p><h2 id="パッケージの確認"><a href="#パッケージの確認" class="headerlink" title="パッケージの確認"></a>パッケージの確認</h2><p>pipが最初から入っているはずです。 [code lang=”dos”] $ python -m pip freeze [/code] なにも表示されないです。きちんとパッケージがほかの環境と独立していることがわかります。</p><h2 id="仮想環境の削除"><a href="#仮想環境の削除" class="headerlink" title="仮想環境の削除"></a>仮想環境の削除</h2><p>仮想環境のフォルダを削除するだけです。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その142 Cockpitを使う for Ubuntu and Fedora</title>
      <link href="/2018/10/28/3606/"/>
      <url>/2018/10/28/3606/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。リソース管理をしたいときがある。 また、Dockerコンテナの管理、systemdのサービス管理も魅力的。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><h3 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h3><p>[code lang=”shell”] $ sudo apt install cockpit [/code]</p><h3 id="自動起動と開始"><a href="#自動起動と開始" class="headerlink" title="自動起動と開始"></a>自動起動と開始</h3><p>[code lang=”shell”] $ sudo systemctl enable cockpit $ sudo systemctl start cockpit [/code]</p><h3 id="アクセス"><a href="#アクセス" class="headerlink" title="アクセス"></a>アクセス</h3><p>ブラウザから <strong>https://&lt;端末のIP&gt;:9090</strong>でアクセス<br><a href="../../../../public/2018/10/01-2.png"><img src="../../../../public/2018/10/01-2-1024x560.png"></a></p><h2 id="Fedora"><a href="#Fedora" class="headerlink" title="Fedora"></a>Fedora</h2><p><strong>Server</strong>の場合はデフォルトでインストールされている模様。 ここでは<strong>Workstation</strong>の場合です。</p><h3 id="インストール-1"><a href="#インストール-1" class="headerlink" title="インストール"></a>インストール</h3><p>[code lang=”shell”] $ sudo yum install cockpit [/code]</p><h3 id="自動起動と開始-1"><a href="#自動起動と開始-1" class="headerlink" title="自動起動と開始"></a>自動起動と開始</h3><p>[code lang=”shell”] $ sudo systemctl enable cockpit.socket $ sudo systemctl start cockpit [/code]</p><h3 id="Firewallへの許可"><a href="#Firewallへの許可" class="headerlink" title="Firewallへの許可"></a>Firewallへの許可</h3><p>[code lang=”shell”] $ sudo firewall-cmd –add-service=cockpit [/code]</p><h3 id="アクセス-1"><a href="#アクセス-1" class="headerlink" title="アクセス"></a>アクセス</h3><p>ブラウザから <strong>https://&lt;端末のIP&gt;:9090</strong>でアクセス<br><a href="../../../../public/2018/10/02-2.png"><img src="../../../../public/2018/10/02-2-1024x606.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> その他 </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
          <category> Cockpit </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その141 x11vncを使う for Ubuntu and Fedora</title>
      <link href="/2018/10/28/3579/"/>
      <url>/2018/10/28/3579/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>会社の<strong>Ubuntu 16.04.5</strong>で<strong>x11vnc</strong>を使うようになりました。 <strong>vino</strong>と異なり、ログインしなくても、きちんとログイン画面が表示されて使うことができるのがすごく良いです。 設定も簡単です。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>手順は簡単です。</p><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><h3 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h3><p>[code lang=”shell”] $ sudo apt install x11vnc [/code]</p><h3 id="パスワード設定"><a href="#パスワード設定" class="headerlink" title="パスワード設定"></a>パスワード設定</h3><p>[code lang=”shell”] $ x11vnc -storepasswd Enter VNC password: Verify password: Write password to /home/XXXXXX/.vnc/passwd? [y]/n y Password written to: /home/XXXXXX/.vnc/passwd [/code]</p><h3 id="自動起動設定"><a href="#自動起動設定" class="headerlink" title="自動起動設定"></a>自動起動設定</h3><p>新規で**/etc/systemd/system/x11vnc.service<strong>を作成します。 [code lang=”shell”] $ sudo vi /etc/systemd/system/x11vnc.service [/code] 下記を保存します。 解像度を変えたい場合は、</strong>1024x768<strong>を任意の値に変えます。 また同時接続を無効化したいなら</strong>-shared**を削除します。 [code lang=”diff”] [Unit] Description=Start x11vnc at startup. After=multi-user.target<br>[Service] Type=simple ExecStart=/bin/sh -c ‘/usr/bin/x11vnc -auth guess -display :0 -geometry 1024x768 -rfbport 5900 -noxrecord -noxfixes -noxdamage -reopen -repeat -forever -shared’<br>[Install] WantedBy=multi-user.target [/code]</p><h3 id="システムへの登録と起動"><a href="#システムへの登録と起動" class="headerlink" title="システムへの登録と起動"></a>システムへの登録と起動</h3><p>[code lang=”shell”] $ sudo systemctl daemon-reload $ sudo systemctl enable x11vnc Created symlink from /etc/systemd/system/multi-user.target.wants/x11vnc.serviceto /etc/systemd/system/x11vnc.service. $ sudo systemctl start x11vnc [/code]</p><h2 id="Fedora"><a href="#Fedora" class="headerlink" title="Fedora"></a>Fedora</h2><h3 id="ディスプレイマネージャーの変更"><a href="#ディスプレイマネージャーの変更" class="headerlink" title="ディスプレイマネージャーの変更"></a>ディスプレイマネージャーの変更</h3><p>x11vncは<strong>lightdm</strong>でしか使えない模様。 lightdmのログイン画面はちょっとダサいですが我慢。 [code lang=”shell”] $ sudo yum install lightdm-gtk $ sudo systemctl disable gdm.service $ sudo systemctl enable lightdm $ reoot [/code]</p><h3 id="インストール-1"><a href="#インストール-1" class="headerlink" title="インストール"></a>インストール</h3><p>[code lang=”shell”] $ sudo yum install x11vnc [/code]</p><h3 id="パスワード設定-1"><a href="#パスワード設定-1" class="headerlink" title="パスワード設定"></a>パスワード設定</h3><p>[code lang=”shell”] $ x11vnc -storepasswd Enter VNC password: Verify password: Write password to /root/.vnc/passwd? [y]/n y Password written to: /root/.vnc/passwd [/code]</p><h3 id="自動起動設定-1"><a href="#自動起動設定-1" class="headerlink" title="自動起動設定"></a>自動起動設定</h3><p>新規で**/etc/systemd/system/x11vnc.service<strong>を作成します。 [code lang=”shell”] $ sudo vi /etc/systemd/system/x11vnc.service [/code] 下記を保存します。 解像度を変えたい場合は、</strong>1024x768<strong>を任意の値に変えます。 また同時接続を無効化したいなら</strong>-shared**を削除します。 [code lang=”diff”] [Unit] Description=Start x11vnc at startup. After=multi-user.target<br>[Service] Type=simple ExecStart=/bin/sh -c ‘/usr/bin/x11vnc -auth guess -display :0 -geometry 1024x768 -rfbport 5900 -noxrecord -noxfixes -noxdamage -reopen -repeat -forever -shared’<br>[Install] WantedBy=multi-user.target [/code]</p><h3 id="システムへの登録と起動-1"><a href="#システムへの登録と起動-1" class="headerlink" title="システムへの登録と起動"></a>システムへの登録と起動</h3><p>[code lang=”shell”] $ sudo systemctl daemon-reload $ sudo systemctl enable x11vnc Created symlink from /etc/systemd/system/multi-user.target.wants/x11vnc.serviceto /etc/systemd/system/x11vnc.service. $ sudo systemctl start x11vnc [/code]</p><h3 id="Firewallへの許可"><a href="#Firewallへの許可" class="headerlink" title="Firewallへの許可"></a>Firewallへの許可</h3><p>[code lang=”shell”] $ sudo firewall-cmd –add-service=vnc-server [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> VNC </category>
          
          <category> リモートデスクトップ </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その140 Fedora 28がHyper-Vにインストールできない</title>
      <link href="/2018/10/28/3563/"/>
      <url>/2018/10/28/3563/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>セキュアブートは無効にして、ブートメニューは表示されるが先に進めません。下記のメッセージが表示されて停止します。<br><a href="../../../../public/2018/10/02-1.png"><img src="../../../../public/2018/10/02-1-1024x859.png"></a><br> A start job is running for Hold until boot process finishes up</p><p>ちなみに<strong>Fedora 27</strong>は普通にインストールできます。 環境は<strong>Windows 10 1803</strong>のHyper-Vです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>カーネル引数を弄るとGUI画面が表示できることに気づきました。 まずメニュー画面を表示します。<br><a href="../../../../public/2018/10/01-1.png"><img src="../../../../public/2018/10/01-1-1024x870.png"></a></p><p><strong>e</strong>を押下してカーネル引数の編集画面に移動します。<br><a href="../../../../public/2018/10/03-1.png"><img src="../../../../public/2018/10/03-1-1024x870.png"></a></p><p><strong>rd.live.image</strong> の部分を削除します。 削除後、<strong>Ctrl+X</strong>で起動を再開します。<br><a href="../../../../public/2018/10/04-1.png"><img src="../../../../public/2018/10/04-1-1024x870.png"></a></p><p>ようこそ画面が表示されます。<br><a href="../../../../public/2018/10/05-1.png"><img src="../../../../public/2018/10/05-1-1024x851.png"></a></p><p>Privacy設定画面が表示されます。<br><a href="../../../../public/2018/10/06-1.png"><img src="../../../../public/2018/10/06-1-1024x859.png"></a></p><p>オンラインアカウントの設定画面が表示されます。<br><a href="../../../../public/2018/10/07.png"><img src="../../../../public/2018/10/07-1024x859.png"></a></p><p>アカウントの設定画面が表示されます。 ここで設定するアカウントは適当で良いです。 ハードディスクへのインストール時に再度決めることになるので。<br><a href="../../../../public/2018/10/08.png"><img src="../../../../public/2018/10/08-1024x859.png"></a></p><p>パスワードの設定画面が表示されます。 このパスワードもハードディスクへのインストール時に再度決めることになるので上書きされますが、この後rootになる必要があるため覚えておく必要があります。<br><a href="../../../../public/2018/10/09.png"><img src="../../../../public/2018/10/09-1024x859.png"></a></p><p>設定完了です。 <strong>Start Using Fedora</strong>でダイアログを閉じます。<br><a href="../../../../public/2018/10/10.png"><img src="../../../../public/2018/10/10-1024x859.png"></a></p><p>少しの間コンソール画面に戻ります。<br><a href="../../../../public/2018/10/11.png"><img src="../../../../public/2018/10/11-1024x859.png"></a></p><p>再開するとヘルプが表示されます。さっさと閉じます。<br><a href="../../../../public/2018/10/12.png"><img src="../../../../public/2018/10/12-1024x859.png"></a> デスクトップは表示されましたが、<strong>Welcome to Fedora</strong>のダイアログが出ないためインストールができません。 そこで、ターミナルを起動します。<strong>Activities</strong>から<strong>Terminal</strong>と入力すれば起動できます。 <a href="../../../../public/2018/10/13.png"><img src="../../../../public/2018/10/13-1024x859.png"></a></p><p>下記コマンドを入力します。 [code lang=”shell”] $ su $ /bin/bash /usr/sbin/liveinst [/code] しばらくするとインストール画面が起動します。 後は普通にインストールです。<br><a href="../../../../public/2018/10/14.png"><img src="../../../../public/2018/10/14-1024x859.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
          <category> Hyper-V </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その78 BlueZのhcitoolについて</title>
      <link href="/2018/10/28/2547/"/>
      <url>/2018/10/28/2547/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Texas Instruments</strong>の<strong>CC2650</strong>を購入してちょこちょこ遊んでいます。 結構、ネット上ではサンプルが転がっていますが、多くは<strong>Python</strong>からの操作でプログラミングにしては少し軽い感じです。 そんな中で、時々、C言語から<strong>libbluetooth</strong>を使ってデバイスの検出を試みようとしている記事が見つかります。 特に多いのが、 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://people.csail.mit.edu/albert/bluez-intro/c404.html#simplescan.c" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=people.csail.mit.edu"></img><div class="hbc-site-name">people.csail.mit.edu</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Bluetooth programming in C with BlueZ</div><div class="hbc-url">https://people.csail.mit.edu/albert/bluez-intro/c404.html#simplescan.c</div></div></div></div></a></div></div><p>に記載してある [code lang=”cpp”] #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;sys/socket.h&gt; #include &lt;bluetooth/bluetooth.h&gt; #include &lt;bluetooth/hci.h&gt; #include &lt;bluetooth/hci_lib.h&gt;<br>int main(int argc, char **argv) { inquiry_info *ii = NULL; int max_rsp, num_rsp; int dev_id, sock, len, flags; int i; char addr[19] = { 0 }; char name[248] = { 0 };<br>dev_id = hci_get_route(NULL); sock = hci_open_dev( dev_id ); if (dev_id &lt; 0 || sock &lt; 0) { perror(“opening socket”); exit(1); }<br>len = 8; max_rsp = 255; flags = IREQ_CACHE_FLUSH; ii = (inquiry_info*)malloc(max_rsp * sizeof(inquiry_info));<br>num_rsp = hci_inquiry(dev_id, len, max_rsp, NULL, &amp;ii, flags); if( num_rsp &lt; 0 ) perror(“hci_inquiry”);<br>for (i = 0; i &lt; num_rsp; i++) { ba2str(&amp;(ii+i)-&gt;bdaddr, addr); memset(name, 0, sizeof(name)); if (hci_read_remote_name(sock, &amp;(ii+i)-&gt;bdaddr, sizeof(name), name, 0) &lt; 0) strcpy(name, “[unknown]“); printf(“%s %s\n”, addr, name); }<br>free( ii ); close( sock ); return 0; } [/code] このソース。 ソース自体には全く問題がありません。 あるとしたら、ソース元とかが書いてないところが非常に多いのも問題ですが、別に問題があります。</p><h1 id="What’s-wrong"><a href="#What’s-wrong" class="headerlink" title="What’s wrong?"></a>What’s wrong?</h1><p>さっきのソースは、CC2650に対して、正確には、<strong>Bluetooth LE</strong>に対しては全く意味をなしません。 検出に使用されている、<strong>hci_inquiry</strong>は<strong>Bluetooth</strong>、つまり、<strong>4.0</strong>より前のバージョンに対してのみ有効です。 その上、少し癖があって、デバイスを<strong>ペアリングモード</strong>にしていないと、検出されません。 つまり、電源をオンにしている状態では、hci_inquiryは機器を見つけることが出来ません。 自分は、<strong>SONY</strong>のBluetoothヘッドフォン<strong>MDR-1RBT</strong>を持っています。MDR-1RBTは3.0を使用します。 CC2650を検出できる状態、つまり<strong>hditool lescan</strong>で検出するのを確認し、MDR-1RBTをペアリングモードにし、上のソースのプログラムを実行してみます。 [code lang=”sh”] $ ./simplescan 00:18:09:15:A7:03 MDR-1RBT [/code] CC2650が検出されません。 次に、hcitoolで検出してみましょう。 [code lang=”sh”] $ sudo hcitool lescan LE Scan … 54:6C:0E:79:09:83 (unknown) 54:6C:0E:79:09:83 CC2650 SensorTag [/code] 今度は、MDR-1RBTが検出されません。 では、hcitoolでBluetoothデバイスを検出するにはどうすれば良いでしょうか? 答えは簡単で、hcitoolに渡す引数を変更します。 ペアリングモードにしている状態で、 [code lang=”sh”] $ sudo hcitool inq [sudo] password for takuya: Inquiring … 00:18:09:15:A7:03 clock offset: 0x2d47 class: 0x240404 [/code] または、 [code lang=”sh”] $ sudo hcitool scan Scanning … 00:18:09:15:A7:03 MDR-1RBT [/code] で検出可能です。 <strong>scan</strong>はデバイスのアドレス、名称を、<strong>inq</strong>はデバイスのアドレス、クラス(どういう類の機器かを判別、詳細は<a href="https://www.bluetooth.com/specifications/assigned-numbers/baseband">Baseband</a>)、クロックオフセット(不明)を返します。 無論、このコマンドでは、CC2650は検出できません。</p><h1 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h1><p>hcitoolにはさらに便利な機能があります。Bluetoothに対してのみですが、電源がオンの状態に限り、ペアリングモードで無くてもデバイスの名称を知ることが出来ます。 [code lang=”sh”] $ hcitool name 00:18:09:15:A7:03 MDR-1RBT [/code] と [code lang=”sh”] $ hcitool info 00:18:09:15:A7:03 Requesting information … Can’t create connection: Operation not permitted $ sudo hcitool info 00:18:09:15:A7:03 Requesting information … BD Address: 00:18:09:15:A7:03 OUI Company: CRESYN (00-18-09) Device Name: MDR-1RBT LMP Version: 3.0 (0x5) LMP Subversion: 0x2133 Manufacturer: Cambridge Silicon Radio (10) Features page 0: 0xff 0xff 0x8f 0xfa 0x9b 0xbf 0x59 0x83 &lt;3-slot packets&gt; &lt;5-slot packets&gt; <encryption> <slot offset> <timing accuracy> <role switch> <hold mode> <sniff mode> <park state> <RSSI> <channel quality> <SCO link> <HV2 packets> <HV3 packets> <u-law log> <A-law log> <CVSD> <paging scheme> <power control> <transparent SCO> <broadcast encrypt> &lt;EDR ACL 2 Mbps&gt; <enhanced iscan> <interlaced iscan> <interlaced pscan> <inquiry with RSSI> <extended SCO> <EV4 packets> <EV5 packets> <AFH cap. slave> <AFH class. slave> &lt;3-slot EDR ACL&gt; &lt;5-slot EDR ACL&gt; <sniff subrating> <pause encryption> <AFH cap. master> <AFH class. master> &lt;EDR eSCO 2 Mbps&gt; &lt;3-slot EDR eSCO&gt; <extended inquiry> <simple pairing> <encapsulated PDU> <non-flush flag> <LSTO> <inquiry TX power> <extended features> Features page 1: 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 [/code] です。 <strong>name</strong>はアドレスを渡すことで名称を、<strong>info</strong>は詳細な情報を取得できます。 infoはrootで実行しないと拒否されます。 この機能はBluetooth BLEには使用できませんが、似た機能がBluetooth LE向けにあります。 [code lang=”sh”] $ hcitool leinfo 54:6C:0E:79:09:83 Requesting information … Could not create connection: Operation not permitted $ sudo hcitool leinfo 54:6C:0E:79:09:83 Requesting information … Handle: 3585 (0x0e01) LMP Version: 4.1 (0x7) LMP Subversion: 0x220 Manufacturer: Texas Instruments Inc. (13) Features: 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 [/code] 情報量が少ないようですが、<strong>leinfo</strong>で多くの情報を取得できます。</p><h1 id="Conslusion"><a href="#Conslusion" class="headerlink" title="Conslusion"></a>Conslusion</h1><p>よく考えてみると、Bluetoothは互換性が維持されている、という話ですが、関数的には使い分けないとダメなのですね。</p>]]></content>
      
      
      <categories>
          
          <category> 無線通信 </category>
          
          <category> Bluetooth </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その139 Hyper-Vの詳細な解析ログを取得する</title>
      <link href="/2018/10/28/3343/"/>
      <url>/2018/10/28/3343/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Fedora 28</strong>をHyper-Vにインストールしようとするもインストール画面が起動しない問題に遭遇。 解決はできていないが、有用なログを取得する手順を見つけたのでメモ。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>下記の<strong>Microsoft Technet</strong>の掲示板から。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://social.technet.microsoft.com/Forums/windows/en-US/5c4166d6-db27-4650-9f8f-5f3cc7e57d7f/client-hyperv-quotcannot-connect-to-virtual-machinequot?forum=w8itprovirt" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=social.technet.microsoft.com"></img><div class="hbc-site-name">social.technet.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">    Client Hyper-V &quot;Cannot Connect to Virtual Machine&quot;</div><div class="hbc-url">https://social.technet.microsoft.com/Forums/windows/en-US/5c4166d6-db27-4650-9f8f-5f3cc7e57d7f/client-hyperv-quotcannot-connect-to-virtual-machinequot?forum=w8itprovirt</div></div></div></div></a></div></div><p>手順は、</p><ol><li>実行中の仮想マシンを停止</li><li>Hyper-V Managerをすべて閉じる</li><li>VMMSサービス (Hyper-V Virtual Machine Management サービス)を停止 (net stop vmms)</li><li>VMMSとWorkerの解析ログを有効</li><li>Hyper-V ManagerとVMConnectのUIトレーシングを有効化</li><li>VMMSサービス (Hyper-V Virtual Machine Management サービス)を開始 (net start vmms)</li><li>Hyper-V Managerを開く</li><li>仮想マシンを起動</li><li>仮想マシンに接続</li><li>ログを収集</li><li>ログ収集を中止</li></ol><p>各手順における詳細なステップは次。</p><h3 id="VMMSとWorkerの解析ログを有効"><a href="#VMMSとWorkerの解析ログを有効" class="headerlink" title="VMMSとWorkerの解析ログを有効"></a>VMMSとWorkerの解析ログを有効</h3><p>イベントビューアを開いて、メニューの<strong>表示(V)**から</strong>分析及びデバッグ ログの表示(S)<strong>を有効にします。<br><a href="../../../../public/2018/10/1.png"><img src="../../../../public/2018/10/1.png"></a><br> 次に、</strong>アプリケーションとサービスログ<strong>、</strong>Microsoft<strong>、</strong>Windows<strong>、</strong>Hyper-V-VMMS<strong>と進みます。 すると、</strong>Analytic**が追加されています。</p><p><a href="../../../../public/2018/10/2.png"><img src="../../../../public/2018/10/2.png"></a><br> 有効化前</p><p><a href="../../../../public/2018/10/3.png"><img src="../../../../public/2018/10/3.png"></a><br> 有効化後</p><p>Analyticを右クリックし、<strong>ログの有効化</strong>をクリック。<br><a href="../../../../public/2018/10/4.png"><img src="../../../../public/2018/10/4.png"></a> 警告が出ますが気にせずOK。 <a href="../../../../public/2018/10/5.png"><img src="../../../../public/2018/10/5.png"></a><br> 同じことを<strong>Hyper-V-Worker</strong>にも行います。</p><h3 id="Hyper-V-ManagerとVMConnectのUIトレーシングを有効化"><a href="#Hyper-V-ManagerとVMConnectのUIトレーシングを有効化" class="headerlink" title="Hyper-V ManagerとVMConnectのUIトレーシングを有効化"></a>Hyper-V ManagerとVMConnectのUIトレーシングを有効化</h3><p><strong>%appdata%\Microsoft\Windows\Hyper-V\Client\1.0\</strong>を開きます。 <strong>VMClientTrace.config</strong>というファイルを作成し、下記の内容を保存します。 [code lang=”xml”] <?xml version="1.0" encoding="utf-8"?> <configuration> &lt;Microsoft.Virtualization.Client.TraceConfigurationOptions&gt; <setting name="TraceTagFormat" type="System.Int32"> <value>3</value> </setting> <setting name="BrowserTraceLevel" type="System.Int32"> <value>71</value> </setting> <setting name="VMConnectTraceLevel" type="System.Int32"> <value>71</value> </setting> &lt;/Microsoft.Virtualization.Client.TraceConfigurationOptions&gt; </configuration> [/code]</p><h3 id="ログを収集"><a href="#ログを収集" class="headerlink" title="ログを収集"></a>ログを収集</h3><p><strong>Hyper-V-VMMS</strong>と<strong>Hyper-V-VMMS</strong>の<strong>Analytic</strong>のログはそのままイベントビューアに表示されます。 UIトレーシングのログは、**%TEMP%**に収集されます。 下記のようなログが出力されます。</p><ul><li>VMConnect_Trace_20181028123045.log</li><li>VMBrowser_Trace_20181028120328.log</li></ul><h3 id="ログ収集を中止"><a href="#ログ収集を中止" class="headerlink" title="ログ収集を中止"></a>ログ収集を中止</h3><p>イベントビューアで、<strong>Hyper-V-VMMS</strong>と<strong>Hyper-V-VMMS</strong>の<strong>Analytic</strong>に対して、<strong>ログの無効化</strong>を行います。 UIトレーシングのログ収集の停止は、作成した<strong>VMClientTrace.config</strong>を削除することで停止できます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Hyper-V </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング CNTK その6 指紋紋様分類</title>
      <link href="/2018/10/24/1427/"/>
      <url>/2018/10/24/1427/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-el">前回</a>は評価を可視化してみました。</p><a id="more"></a><h1 id="CNTKが進化している"><a href="#CNTKが進化している" class="headerlink" title="CNTKが進化している"></a>CNTKが進化している</h1><p>MicrosoftがフォークさせたCaffeは完成度は高いのですが、2016年5月からメンテナンスが止まっています。</p><p>かたや、CNTKは現在進行形でソースが成長してます。</p><p>どちらもいい面悪い面があるのですが、CNTKの方がMicrosoftの本命でしょう。<br>なので、前回実施した指紋紋様分類をCNTKで実践してみます。<br>最近のCNTKの進化に追随しなければなりません。</p><h1 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h1><h2 id="設定ファイル"><a href="#設定ファイル" class="headerlink" title="設定ファイル"></a>設定ファイル</h2><p>CNTKファイルです。</p><p>をベースに構築します。<br>まず、作業ディレクトリを作ります。ここでは、<strong>ROOT</strong>フォルダとします。<br>ROOTフォルダの下に、一つフォルダを作り、その中に、<strong>AddTop5Layer.mel</strong>, <strong>AlexNet.cntk</strong>, <strong>AlexNet.ndl</strong>, <strong>Macros.ndl</strong> を任意のフォルダに展開します。<br>このフォルダを<strong>Config</strong>フォルダとします。</p><p>次に、AlexNet.cntkを開き、下記の箇所を変更します。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- ConfigDir = &quot;$RootDir$&quot; </span></span><br><span class="line"><span class="addition">+ ConfigDir = &quot;$RootDir$/Config&quot; </span></span><br></pre></td></tr></table></figure><p>2カ所ある </p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- minibatchSize=128</span></span><br><span class="line"><span class="addition">+ minibatchSize=32 </span></span><br></pre></td></tr></table></figure><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- cropType=&quot;Random&quot; </span></span><br><span class="line"><span class="addition">+ cropType=&quot;Center&quot; </span></span><br></pre></td></tr></table></figure><p>2カ所ある </p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- width=224</span></span><br><span class="line"><span class="deletion">- height=224</span></span><br><span class="line"><span class="deletion">- channels=3</span></span><br><span class="line"><span class="addition">+ width=224</span></span><br><span class="line"><span class="addition">+ height=224</span></span><br><span class="line"><span class="addition">+ channels=3 </span></span><br></pre></td></tr></table></figure><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- cropRatio=0.875</span></span><br><span class="line"><span class="addition">+ cropRatio=0.875 </span></span><br></pre></td></tr></table></figure><p>2カ所ある </p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- meanFile=&quot;$ConfigDir$/ImageNet1K\_mean.xml&quot;</span></span><br><span class="line"><span class="addition">+ meanFile=&quot;$ConfigDir$/ImageNet1K\_mean.xml&quot; </span></span><br></pre></td></tr></table></figure><p>2カ所ある </p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- labels=[</span></span><br><span class="line"><span class="deletion">-  labelDim=1000</span></span><br><span class="line"><span class="deletion">- ] </span></span><br><span class="line"><span class="addition">+ labels=[</span></span><br><span class="line"><span class="addition">+  labelDim=1000</span></span><br><span class="line"><span class="addition">+ ] </span></span><br></pre></td></tr></table></figure><p>に変更します。</p><h2 id="画像ファイルリスト"><a href="#画像ファイルリスト" class="headerlink" title="画像ファイルリスト"></a>画像ファイルリスト</h2><p>Caffeの画像ファイルリストの記述方法は</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;カレントディレクトリからの相対パス&gt;&lt;半角スペース&gt;&lt;0オリジンのラベル番号&gt; </span><br></pre></td></tr></table></figure><p>でした。<br>一方、CNTKで、2016年5月に対応した、ファイルリストをサポートするImageReaderの入力形式は</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;画像のフルパス&gt;&lt;タブ&gt;&lt;0オリジンのラベル番号&gt; </span><br></pre></td></tr></table></figure><p>になります。<br>前回のファイルリストを少し加工して流用できるはずです。<br>また、これらのファイルリストを <strong>val_map.txt</strong> , <strong>train_map.txt</strong> という名前に変更し、Configフォルダにコピーします。</p><p>個人的にはフルパスの方が好感が持てます。<br>画像そのものは、システム中に一つだけであって、作業ディレクトリからのパスで変化するようでは、使い勝手が悪すぎるので…</p><p>ImageReaderについての使い方は </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/Microsoft/CNTK/wiki/Image-reader" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/6154722?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">microsoft/CNTK</div><div class="hbc-url">https://github.com/Microsoft/CNTK/wiki/Image-reader</div><div class="hbc-description">Microsoft Cognitive Toolkit (CNTK), an open source deep-learning toolkit - microsoft/CNTK</div></div></div></div></a></div></div><p>を参考にしてください。<br>クロップ機能などが独特ですが…</p><p>指紋といえば、ごく一部の人間を覗いて全ての人間が手にもっている隆線によって形成される紋様です。<br>指紋を持っていない人間もごく一部に存在しますが…</p><p><strong>iPhone</strong>の<strong>TouchID</strong>で急激に認知度が向上した気がします。<br>特に日本では、指紋の採取というのは、人権団体とかの声とかプライバシー云々でいまいち悪のレッテルを貼られている感が否めません。</p><p>さて、指紋は古くから使われており、個人を識別する徴として、日本では拇印としてよく知られています。<br>個人を識別するだけなら、指紋以外に、虹彩、静脈、顔が有名です。<br>他にも掌紋、足紋もあります。</p><h3 id="生体認証"><a href="#生体認証" class="headerlink" title="生体認証"></a>生体認証</h3><p>この手の生物に備わる生体の特徴に基づいた認証を<strong>生体認証 (Biometrics)</strong> と呼びます。<br>指掌紋技術では、たくさんの企業が競争していますが、<strong>3M Cogent (アメリカ)**、</strong>Morpho (フランス)<strong>、</strong>NEC (日本)** が三強です。<br>ここでいう三強とは、司法機関、入国管理など、大規模システムでの納入実績が大きい企業を指します。<br>(例えば、ロサンゼルス国際空港では、Morphoの指紋採取機器が入国管理ゲートにありますし、成田空港にはNECの指紋採取機器があります。)<br>iPhoneの場合、<strong>Apple</strong>は<strong>AuthenTec社</strong>を買収して、TouchIDを開発したようですが、これは指紋を読み取る機器の買収がメインだったと思われます。<br>指紋の採取の場合、光学センサーで読み取るのが主流ですが、AuthenTec社の場合は周波数で読み取るセンサーだったようで、それがiPhoneでの採用に繋がったのでしょう。</p><p>ですので、三強にAppleがない、というのは別に悪意があるわけではなく、この三強は、大規模システム、たとえば、数千万の指紋データから瞬時に個人を特定するなどの総合的な技術を持っています。TouchIDの場合、iPhoneに含まれる指紋データは一人のデータでかつ最大10本の指データです。大して大規模システムでは、入力指紋、つまり識別したい指紋1に対して候補となる指紋データは数千万にも上ることもあります。<br>事実、アメリカ国立標準技術研究所 (National Institute of Standards and Technology, NIST) の指掌紋技術コンテストでは、計測する内容にもよりますが、上位はこの三強が常です。</p><p><a href="http://jpn.nec.com/press/201408/20140821_02.html">NEC、米国国立標準技術研究所(NIST)の指紋認証技術のベンチマークテストにおいて第1位の評価を獲得</a> <a href="http://www.morpho.com/en/media/20141119_morpho-places-first-nist-2014-minex-fingerprint-benchmark">Morpho places first in NIST 2014 MINEX fingerprint benchmark</a></p><p>さらに、犯罪現場に残った指紋、いわゆる遺留指紋とデータベースに載っている人間から直接採取した指紋 (押捺指紋) との照合、また他の犯罪現場で採取した別の遺留指紋との照合など、指紋照合と言ってもいろんなパターンがあるわけです。<br>特に遺留指紋は現場に指全体がきれいに残っているなんてあまりなくて、別の指紋と重なっている、一部しか残っていないとかよくある話です。<br>これらの問題を解決する技術をトータルで持っているのが上位三強です。</p><p>とはいっても、ニッチな技術で攻めるのは間違っていなくて、AuthenTec社はそれが幸いしてAppleに評価してもらえたわけです。</p><h3 id="特徴データ"><a href="#特徴データ" class="headerlink" title="特徴データ"></a>特徴データ</h3><p>さて、指紋、掌紋、足紋でも、他でもそうですが、採取した生体情報から、その生体情報を特徴付ける情報のみを抽出してデータ化します。<br>これを特徴データと呼んでいますが、指紋の場合、そのなかに特徴点 (Minutia) と呼ばれるものがあります。<br>特徴点が12個一致すれば、照合上、同一指紋とみなすことができます。<br>また、指紋においては、隆線 (芯線:Skeleton)も大事なデータですが、指紋の紋様自体も重要です。</p><h3 id="紋様"><a href="#紋様" class="headerlink" title="紋様"></a>紋様</h3><p>紋様には様々な種類がありますが、人種によって、紋様毎の発現率が異なります。下記はその一例です。実際はもっと種類があります。<br>[table id=23 /]<br><a href="../../../../public/2016/04/Patterns.png"><img src="../../../../public/2016/04/Patterns-1024x229.png"></a></p><p>紋様の一例</p><p>前置きが長くなりましたが、これらの紋様をディープラーニングで分類してみましょう。</p><h1 id="準備1"><a href="#準備1" class="headerlink" title="準備1"></a>準備1</h1><p>今回、DeepLearningのために、<strong>GeForce GTX 750 Ti</strong>を入手しました。<br>というわけで、Caffeのビルド設定を変更します。<br>Pythonは有効にし、<strong>CpuOnlyBuild</strong>をfalse、<strong>UseCuDNN</strong>をtrueにします。<br>特に重要なのが、<strong>CudaArchitecture</strong>です。<br>GTX 750 TiのCompute Capabilityは5.0なので、<strong>compute_50,sm_50</strong>を設定します。<br>以上で、ソリューションをリビルドします。</p><h1 id="準備2"><a href="#準備2" class="headerlink" title="準備2"></a>準備2</h1><p>次にデータですが、NISTが指紋データを教師情報と一緒に公開しています。<br>こんなの日本じゃありえません。素晴らしい。<br>下記からダウンロードできます。ただし、接続の調子が悪いのかタイムアウトすることが多々あります。<br><a href="http://www.nist.gov/srd/nistsd4.cfm">Special Database 4 - NIST 8-bit Gray Scale Images of Fingerprint Image Groups.</a> <a href="http://www.nist.gov/srd/nistsd9.cfm">Special Database 9 - NIST 8-bit Gray Scale Images of Mated Fingerprint Card Pairs.</a> <a href="http://www.nist.gov/srd/nistsd14.cfm">NIST Mated Fingerprint Card Pairs 2. Has 2,700 ten-print card pairs of rolled fingerprints (no plain impressions).</a> 今回は、Special Database4を使います。4,9,14は無料ですが、他は有料だったりします。</p><p>入手したファイルを解凍すると、下記のような構成になっています。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_0 NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_1 NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_2 NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_3 NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_4 NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_5 NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_6 NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_7 </span><br></pre></td></tr></table></figure><p>各フォルダ内にpngとtxtファイルが500個ずつ含まれています。<br>学習にはfigs_0からfigs_6の3500枚の画像を使います。テストにはfigs_7を使います。<br>さて、データを見ていると指紋画像のサイズが512x512であることに気がつくと思います。<br>指紋認証の世界では512x512の500ppi (pixel per inch) が常識です。1000ppiもあります。<br>txtには、性別、紋様種別が含まれています。<br>このデータ群の紋様種別は、Whorls、Arch、Loops、Tented Arch、Right Loopの5種です。<br>これらを使って、画像のデータベース作成、学習、テスト、分類を実行します。<br>これら一連の流れを自動化したバッチを用意しました。</p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>これらを、png_txtフォルダ直下に展開し、下記の2点を修正します。</p><h2 id="0-SetEnv-bat"><a href="#0-SetEnv-bat" class="headerlink" title="0.SetEnv.bat"></a>0.SetEnv.bat</h2><p><strong>CAFFE_ROOT</strong>、<strong>MINICONDA</strong>、<strong>ROOTFOLDER</strong>を環境に応じて変更します。</p><h2 id="io-py"><a href="#io-py" class="headerlink" title="io.py"></a>io.py</h2><p>今回の実験では、入力画像を8bitにして扱うことでメモリ消費量を削減しているのですが、PythonのCaffeモジュールが8bit画像として、画像を入力できないため、ネットワークと入力データの整合性がとれません。<br>そのため、<strong>7.Classify.bat</strong>を使うときだけ、**&lt;Miniconda2_root&gt;\Lib\site-packages\caffe\io.py**を修正します。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- def load_image(filename, color=True):</span></span><br><span class="line"><span class="addition">+ def load_image(filename, color=True):</span></span><br></pre></td></tr></table></figure><p>と直します。<br>これで準備完了です。</p><h1 id="実験"><a href="#実験" class="headerlink" title="実験"></a>実験</h1><p>バッチを1から順に実行します。GPUを使えるなら、 </p><p>1.CreateListFile.ps1<br>2.CreateDatabase.bat<br>3.MeanDatabase.bat<br>4.Train_GPU.bat<br>7.Classify.bat</p><p>とコマンドプロンプトまたはPowerShellで順番に実行します。<br>ただし、<strong>7.Classify.bat</strong>は引数に画像ファイルを指定します。<br>例えば、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7</span>.Classify.bat &quot;D:\\Works\\NISTSpecialDatabase4GrayScaleImagesofFIGS\\sd04\\png\_txt\\figs\_7\\f1752\_04.png&quot; </span><br></pre></td></tr></table></figure><p>のような感じです。<br><strong>4.Train_GPU.bat</strong>を実行することで、学習とテストを同時に実行します。<br>その結果、精度を表すAccuracyが10%弱が、最終的に約80%まで向上していることがわかります。3500回の学習で10分くらいでした。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I0623 <span class="number">00</span>:<span class="number">35</span>:<span class="number">05</span>.<span class="number">288350</span>  <span class="number">6908</span> solver.cpp:<span class="number">337</span>] Iteration <span class="number">0</span>, Testing <span class="built_in">net</span> (#<span class="number">0</span>)</span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">35</span>:<span class="number">07</span>.<span class="number">777075</span>  <span class="number">6908</span> blocking_queue.cpp:<span class="number">50</span>] Data layer prefetch queue empty</span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">35</span>:<span class="number">09</span>.<span class="number">379405</span>  <span class="number">6908</span> solver.cpp:<span class="number">404</span>]     Test <span class="built_in">net</span> output #<span class="number">0</span>: accuracy = <span class="number">0</span>.<span class="number">148</span></span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">35</span>:<span class="number">09</span>.<span class="number">382393</span>  <span class="number">6908</span> solver.cpp:<span class="number">404</span>]     Test <span class="built_in">net</span> output #<span class="number">1</span>: loss = <span class="number">1</span>.<span class="number">61361</span> (* <span class="number">1</span> = <span class="number">1</span>.<span class="number">61361</span> loss)</span><br></pre></td></tr></table></figure><p>が </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">I0623 <span class="number">00</span>:<span class="number">49</span>:<span class="number">38</span>.<span class="number">984040</span>  <span class="number">6908</span> solver.cpp:<span class="number">317</span>] Iteration <span class="number">3500</span>, loss = <span class="number">0</span>.<span class="number">304031</span></span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">49</span>:<span class="number">38</span>.<span class="number">986039</span>  <span class="number">6908</span> solver.cpp:<span class="number">337</span>] Iteration <span class="number">3500</span>, Testing <span class="built_in">net</span> (#<span class="number">0</span>)</span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">49</span>:<span class="number">42</span>.<span class="number">858041</span>  <span class="number">6908</span> solver.cpp:<span class="number">404</span>]     Test <span class="built_in">net</span> output #<span class="number">0</span>: accuracy = <span class="number">0</span>.<span class="number">788</span></span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">49</span>:<span class="number">42</span>.<span class="number">860039</span>  <span class="number">6908</span> solver.cpp:<span class="number">404</span>]     Test <span class="built_in">net</span> output #<span class="number">1</span>: loss = <span class="number">0</span>.<span class="number">465629</span> (* <span class="number">1</span> = <span class="number">0</span>.<span class="number">465629</span> loss)</span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">49</span>:<span class="number">42</span>.<span class="number">864039</span>  <span class="number">6908</span> solver.cpp:<span class="number">322</span>] Optimization Done.</span><br><span class="line">I0623 <span class="number">00</span>:<span class="number">49</span>:<span class="number">42</span>.<span class="number">869042</span>  <span class="number">6908</span> caffe.cpp:<span class="number">223</span>] Optimization Done.</span><br></pre></td></tr></table></figure><p>になります。<br>しかし、これでは、本当に正しく学習できるいるのかいまいちわからないため、<strong>7.Classify.bat</strong>に学習に使った画像以外 (今回はfigs_7) から一枚を選んで、引数として渡して実行します。<br>結果として、f1751_08.pngの場合、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Loading file: D:\Works\NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_7\f1751_08.png</span><br><span class="line">Classifying <span class="number">1</span> inputs.</span><br><span class="line">Done <span class="keyword">in</span> <span class="number">0</span>.<span class="number">22</span> s.</span><br><span class="line">Saving results into output.npy</span><br><span class="line">#<span class="number">1</span> | <span class="number">3</span> T | <span class="number">84</span>.<span class="number">0</span>%</span><br><span class="line">#<span class="number">2</span> | <span class="number">2</span> R | <span class="number">11</span>.<span class="number">8</span>%</span><br><span class="line">#<span class="number">3</span> | <span class="number">0</span> A |  <span class="number">2</span>.<span class="number">1</span>%</span><br></pre></td></tr></table></figure><p>T (Tented Arch) が一番高い確率を出力してます。画像に対応するテキストファイル Gender: M Class: T History: f1751_08.pct TA a2618.pct と見比べると、一致していることがわかります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>DeepLearningのネタは結構転がっていますが、指紋を使った実験はweb上では無いと思います。<br>既に論文でDeepLearningでの紋様分類は存在しましたが、外国の論文でした。<br>日本語としての記事としてはなかなかレアではないでしょうか？</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1">https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1</a></p>]]></content>
      
      
      <categories>
          
          <category> 未分類 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その138 ChainerでDCGANのサンプル実行中に遭遇したエラー</title>
      <link href="/2018/10/22/3221/"/>
      <url>/2018/10/22/3221/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>chainer</strong>に付属している <strong>DCGAN(Deep Convolution Generative Adversarial Networks)</strong> のサンプルを動かした際のエラーについての対応メモ。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h3 id="backend-がない"><a href="#backend-がない" class="headerlink" title="backend がない"></a>backend がない</h3><p>下記のエラーが出る。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; python -i train_dcgan.py</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> last):</span><br><span class="line">  File &quot;train_dcgan.py&quot;, line <span class="number">9</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from <span class="built_in">net</span> import Discriminator</span><br><span class="line">  File &quot;D:\Works\Python\Envs\chainer\chainer\examples\dcgan\<span class="built_in">net</span>.py&quot;, line <span class="number">5</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from chainer import backend</span><br><span class="line"><span class="function">ImportError: <span class="title">cannot</span> <span class="title">import</span> <span class="title">name</span> &#x27;<span class="title">backend</span>&#x27;</span></span><br></pre></td></tr></table></figure><p>理由としては、現時点(2018/10/21)でのgithubのリポジトリがChainerの<strong>v5.0</strong>へ移行し始めている。<br>その過程でI/Fに下記の変更がはいった模様。</p><p>要するに、 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> chainer <span class="keyword">import</span> backends </span><br></pre></td></tr></table></figure><p>が </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> chainer <span class="keyword">import</span> backend </span><br></pre></td></tr></table></figure><p>こうなったと。<br>で、<strong>pip</strong>からインストールしたchainerは </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; python -m pip freeze chainer</span><br><span class="line">certifi==<span class="number">2018</span>.<span class="number">10</span>.<span class="number">15</span></span><br><span class="line">chainer==<span class="number">4</span>.<span class="number">5</span>.<span class="number">0</span></span><br><span class="line">colorama==<span class="number">0</span>.<span class="number">3</span>.<span class="number">9</span></span><br><span class="line">cupy==<span class="number">4</span>.<span class="number">5</span>.<span class="number">0</span></span><br><span class="line">fastrlock==<span class="number">0</span>.<span class="number">4</span></span><br><span class="line">filelock==<span class="number">3</span>.<span class="number">0</span>.<span class="number">9</span></span><br><span class="line">isort==<span class="number">4</span>.<span class="number">3</span>.<span class="number">4</span></span><br><span class="line">lazy-object-proxy==<span class="number">1</span>.<span class="number">3</span>.<span class="number">1</span></span><br><span class="line">mccabe==<span class="number">0</span>.<span class="number">6</span>.<span class="number">1</span></span><br><span class="line">numpy==<span class="number">1</span>.<span class="number">15</span>.<span class="number">2</span></span><br><span class="line">protobuf==<span class="number">3</span>.<span class="number">6</span>.<span class="number">1</span></span><br><span class="line">six==<span class="number">1</span>.<span class="number">11</span>.<span class="number">0</span></span><br><span class="line">typed-ast==<span class="number">1</span>.<span class="number">1</span>.<span class="number">0</span></span><br><span class="line">wincertstore==<span class="number">0</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure><p>となっており、ずれている、というわけです。<br>なので、githubのブランチを<strong>v4</strong>に変更して実行するのが正解。</p><h3 id="PIL-がない"><a href="#PIL-がない" class="headerlink" title="PIL がない"></a>PIL がない</h3><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; python -i train_dcgan.py</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> last):</span><br><span class="line">  File &quot;train_dcgan.py&quot;, line <span class="number">14</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from visualize import out_generated_image</span><br><span class="line">  File &quot;D:\Works\Python\Envs\chainer\chainer\examples\dcgan\visualize.py&quot;, line <span class="number">6</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from PIL import Image</span><br><span class="line"><span class="function">ModuleNotFoundError: <span class="title">No</span> <span class="title">module</span> <span class="title">named</span> &#x27;<span class="title">PIL</span></span></span><br></pre></td></tr></table></figure><p>なので、<strong>Pillow</strong>をインストール。<br>いつも、<strong>PIL</strong>をインストールしようとするけど、そういう名前のパッケージはないのね。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; python -m pip install Pillow</span><br><span class="line">Collecting Pillow</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/bd/<span class="number">39</span>/c76eaf781343162bdb1cf4854cb3bd5947a87ee44363e5acd6c48d69c4a1/Pillow-<span class="number">5</span>.<span class="number">3</span>.<span class="number">0</span>-cp36-cp36m-win_amd64.whl (<span class="number">1</span>.<span class="number">6</span>MB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">1</span>.<span class="number">6</span>MB <span class="number">975</span>kB/s</span><br><span class="line">Installing collected packages: Pillow</span><br><span class="line">Successfully installed Pillow-<span class="number">5</span>.<span class="number">3</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="CUDAが使えない"><a href="#CUDAが使えない" class="headerlink" title="CUDAが使えない"></a>CUDAが使えない</h3><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; python -i train_dcgan.py -g <span class="number">0</span></span><br><span class="line"><span class="function">GPU: 0</span></span><br><span class="line"><span class="function"># <span class="title">Minibatch</span>-<span class="title">size</span>: 50</span></span><br><span class="line"><span class="function"># <span class="title">n_hidden</span>: 100</span></span><br><span class="line"><span class="function"># <span class="title">epoch</span>: 1000</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">D</span>:\<span class="title">Works</span>\<span class="title">Python</span>\<span class="title">Envs</span>\<span class="title">chainer</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span>\<span class="title">chainer</span>\<span class="title">backends</span>\<span class="title">cuda.py</span>:95: <span class="title">UserWarning</span>: <span class="title">cuDNN</span> <span class="title">is</span> <span class="title">not</span> <span class="title">enabled</span>.</span></span><br><span class="line"><span class="function"><span class="title">Please</span> <span class="title">reinstall</span> <span class="title">CuPy</span> <span class="title">after</span> <span class="title">you</span> <span class="title">install</span> <span class="title">cudnn</span></span></span><br><span class="line"><span class="function">(<span class="title">see</span> <span class="title">https</span>://<span class="title">docs</span>-<span class="title">cupy.chainer.org</span>/<span class="title">en</span>/<span class="title">stable</span>/<span class="title">install.html</span>#<span class="title">install</span>-<span class="title">cupy</span>-<span class="title">with</span>-<span class="title">cudnn</span>-<span class="title">and</span>-<span class="title">nccl</span>).</span></span><br><span class="line"><span class="function">  &#x27;<span class="title">cuDNN</span> <span class="title">is</span> <span class="title">not</span> <span class="title">enabled</span>.\<span class="title">n</span>&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>cuDNN</strong>をインストールして、<strong>CuPy</strong>を再インストールしろ、ってエラーです。<br>自分の環境にインストールされているcuDNNを調べて適切なCuPyをインストールします。<br>普通の<strong>CuPy</strong>は削除しなくてもOKでした。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; python -m pip install cupy-cuda92</span><br><span class="line">Collecting cupy-cuda92</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">1</span>a/<span class="number">23</span>/<span class="number">0</span>a8f34c97486ff7e18c5db9bcd76f62605adcf9b63f6fc247229e5df24b4/cupy_cuda92-<span class="number">4</span>.<span class="number">5</span>.<span class="number">0</span>-cp36-cp36m-win_amd64.whl (<span class="number">231</span>.<span class="number">7</span>MB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">231</span>.<span class="number">7</span>MB <span class="number">92</span>kB/s</span><br><span class="line">Requirement already satisfied: numpy&gt;=<span class="number">1</span>.<span class="number">9</span>.<span class="number">0</span> <span class="keyword">in</span> d:\works\python\envs\chainer\lib\site-packages (from cupy-cuda92) (<span class="number">1</span>.<span class="number">15</span>.<span class="number">2</span>)</span><br><span class="line">Requirement already satisfied: six&gt;=<span class="number">1</span>.<span class="number">9</span>.<span class="number">0</span> <span class="keyword">in</span> c:\users\takuya\appdata\roaming\python\python36\site-packages (from cupy-cuda92) (<span class="number">1</span>.<span class="number">11</span>.<span class="number">0</span>)</span><br><span class="line">Requirement already satisfied: fastrlock&gt;=<span class="number">0</span>.<span class="number">3</span> <span class="keyword">in</span> d:\works\python\envs\chainer\lib\site-packages (from cupy-cuda92) (<span class="number">0</span>.<span class="number">4</span>)</span><br><span class="line">Installing collected packages: cupy-cuda92</span><br><span class="line">Successfully installed cupy-cuda92-<span class="number">4</span>.<span class="number">5</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p>cuDNNは<strong>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\vX.X</strong>に適切に展開されている必要があります。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Chainer </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その137 Chainer with CUDA on Anaconda3 for Windowsを使う</title>
      <link href="/2018/10/20/3218/"/>
      <url>/2018/10/20/3218/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>会社で<strong>Chainer</strong>を使う案件が来ました。まずは環境構築から実施。 2018/11/01 更新 仮想環境はcondaを使わない方が良いです。condaの仮想環境ではpipでインストールしたパッケージを全ての環境で共有してしまうからです。 正しい仮想環境の作成は<a href="https://taktak.jp/2018/11/01/3613">開発メモ その143 Pythonの仮想環境を正しく使う</a>を参考にして下さい。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p><strong>Anaconda</strong> はインストール済みであるとします。 また、condaの仮想環境は作成済みとします。 下記のような感じで作成し、仮想環境に入ります。 [code lang=”cmd”] conda create -n chainer python=3.6 conda activate chainer [/code] 仮想環境に入ったら下記のようにして<strong>CuPy</strong>と<strong>Chainer</strong>をインストールします。 最後に、GPUとの接続を確認しています。 [code lang=”cmd”] (D:\Works\Python\Envs\chainer) C:\Users\TAKUYA&gt;pip install cupy Collecting cupy Downloading <a href="https://files.pythonhosted.org/packages/ab/fc/7aee3fe0c2aa7e57de873f35f275b8afb434c091f9b555582418b18a238c/cupy-4.5.0.tar.gz">https://files.pythonhosted.org/packages/ab/fc/7aee3fe0c2aa7e57de873f35f275b8afb434c091f9b555582418b18a238c/cupy-4.5.0.tar.gz</a> (2.1MB) 100% |████████████████████████████████| 2.1MB 2.2MB/s Requirement already satisfied: numpy&gt;=1.9.0 in d:\works\python\envs\chainer\lib\site-packages (from cupy) (1.15.2) Requirement already satisfied: six&gt;=1.9.0 in c:\users\takuya\appdata\roaming\python\python36\site-packages (from cupy) (1.11.0) Collecting fastrlock&gt;=0.3 (from cupy) Downloading <a href="https://files.pythonhosted.org/packages/8f/ff/6777b85fdbc6efd572a2b713e044c29f5f01ca8b1c74f8d94b427bac60c3/fastrlock-0.4.tar.gz">https://files.pythonhosted.org/packages/8f/ff/6777b85fdbc6efd572a2b713e044c29f5f01ca8b1c74f8d94b427bac60c3/fastrlock-0.4.tar.gz</a> (47kB) 100% |████████████████████████████████| 51kB 2.2MB/s Building wheels for collected packages: cupy, fastrlock Running setup.py bdist_wheel for cupy … done Stored in directory: C:\Users\TAKUYA\AppData\Local\pip\Cache\wheels\28\7e\d8\c2c115fd4d5377490c8679258673630e53df1de49a6aa522ad Running setup.py bdist_wheel for fastrlock … done Stored in directory: C:\Users\TAKUYA\AppData\Local\pip\Cache\wheels\73\2b\fe\8bdf21b8ebdc58dfafa3a0935767d2ae9c8f68e49d04c5a190 Successfully built cupy fastrlock Installing collected packages: fastrlock, cupy Successfully installed cupy-4.5.0 fastrlock-0.4<br>(D:\Works\Python\Envs\chainer) C:\Users\TAKUYA&gt;pip install chainer Collecting chainer Downloading <a href="https://files.pythonhosted.org/packages/fc/ae/5b08a1717187ef98127b5d68ec700009b9c8a918b40319813e3e89f2254f/chainer-4.5.0.tar.gz">https://files.pythonhosted.org/packages/fc/ae/5b08a1717187ef98127b5d68ec700009b9c8a918b40319813e3e89f2254f/chainer-4.5.0.tar.gz</a> (402kB) 100% |████████████████████████████████| 409kB 8.5MB/s Collecting filelock (from chainer) Downloading <a href="https://files.pythonhosted.org/packages/b4/fe/5ca16d167849b980925d3bd706cda266c7435dcf21675c546374da207654/filelock-3.0.9-py3-none-any.whl">https://files.pythonhosted.org/packages/b4/fe/5ca16d167849b980925d3bd706cda266c7435dcf21675c546374da207654/filelock-3.0.9-py3-none-any.whl</a> Requirement already satisfied: numpy&gt;=1.9.0 in d:\works\python\envs\chainer\lib\site-packages (from chainer) (1.15.2) Collecting protobuf&gt;=3.0.0 (from chainer) Downloading <a href="https://files.pythonhosted.org/packages/e8/df/d606d07cff0fc8d22abcc54006c0247002d11a7f2d218eb008d48e76851d/protobuf-3.6.1-cp36-cp36m-win/_amd64.whl">https://files.pythonhosted.org/packages/e8/df/d606d07cff0fc8d22abcc54006c0247002d11a7f2d218eb008d48e76851d/protobuf-3.6.1-cp36-cp36m-win\_amd64.whl</a> (1.1MB) 100% |████████████████████████████████| 1.1MB 1.9MB/s Requirement already satisfied: six&gt;=1.9.0 in c:\users\takuya\appdata\roaming\python\python36\site-packages (from chainer) (1.11.0) Requirement already satisfied: cupy&lt;5.0.0,&gt;=4.4.0 in d:\works\python\envs\chainer\lib\site-packages (from chainer) (4.5.0) Requirement already satisfied: setuptools in d:\works\python\envs\chainer\lib\site-packages (from protobuf&gt;=3.0.0-&gt;chainer) (40.4.3) Requirement already satisfied: fastrlock&gt;=0.3 in d:\works\python\envs\chainer\lib\site-packages (from cupy&lt;5.0.0,&gt;=4.4.0-&gt;chainer) (0.4) Building wheels for collected packages: chainer Running setup.py bdist_wheel for chainer … done Stored in directory: C:\Users\TAKUYA\AppData\Local\pip\Cache\wheels\4f\a5\e6\b0cbcc4cc1daeaab566096480d5b9aed9106de601daf1006f8 Successfully built chainer Installing collected packages: filelock, protobuf, chainer Successfully installed chainer-4.5.0 filelock-3.0.9 protobuf-3.6.1<br>(D:\Works\Python\Envs\chainer) C:\Users\TAKUYA&gt;python -c “import chainer; print(chainer.cuda.available)” True [/code]</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> gpupu </category>
          
          <category> Chainer </category>
          
          <category> python-2 </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> Anaconda </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その136 Windows 10 Ver1803で起動しなくなったCentOS on Hyper-Vを復旧する</title>
      <link href="/2018/10/13/3201/"/>
      <url>/2018/10/13/3201/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Windows 10 April 2018 Update (Ver.1803)</strong> のマシンにおいて、Hyper-V上のLinux仮想マシンが起動しない現象が発生した。 こんな感じになります。<br><a href="../../../../public/2018/10/01.png"><img src="../../../../public/2018/10/01-1024x859.png"></a><br> 具体的に起動しないマシンは、</p><ol><li>1803で新規に作成したマシン (世代1で作成)</li><li>1803より前の環境で作成し、1803にVHDをコピーして再作成したマシン (世代1で作成)</li></ol><p>という条件である。 要するに世代1で作成するのが不味かったのだが、既存の資産が動いているレガシーなLinuxだとそうも言っていられない。 これが会社のマシンで起こり、自宅の環境でも再現してしまったので、解決策を模索した。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>Google先生に聞いても、この現象に遭遇している人がいなかった。 なので、自分で探すこと1週間。解決のきっかけに気づいたのは、イベントビューアを見ていたときである。<br><a href="../../../../public/2018/10/00.png"><img src="../../../../public/2018/10/00-1024x763.png"></a> <strong>Microsoft-Windows-Hyper-V-Worker-Admin</strong> に奇妙なログが記載されていた。 <code>仮想マシン %1 でデバイス %3 を読み込むことができません。相互にサポートされているプロトコル バージョンがありません。サーバー バージョンは %4 で、クライアント バージョンは %5 です (仮想マシン ID %2) 。</code> どうも、問題のマシンを立ち上げた時に記録されている模様。 これを見て思ったのは、グラフィック系統のデバイスが正しく読み込まれていないから、起動時におかしな画面に陥るのでは?と推測。 だから、起動時にグラフィック表示をなくせば起動できるのでは?と予想。 試したところ、ビンゴでした。 下記のOSは <strong>CentOS 6.10</strong> ですが、手順はどのOSでも似たようなものかと。</p><h3 id="1-起動"><a href="#1-起動" class="headerlink" title="1. 起動"></a>1. 起動</h3><p>下記の画面でキーを押下して、メニューに入ります。<br><a href="../../../../public/2018/10/02.png"><img src="../../../../public/2018/10/02.png"></a></p><h3 id="2-GRUB"><a href="#2-GRUB" class="headerlink" title="2. GRUB"></a>2. GRUB</h3><p>下記のメニューが表示されたら <strong>a</strong> を押下して、カーネルの引数を編集する画面に入ります。<br><a href="../../../../public/2018/10/04.png"><img src="../../../../public/2018/10/04.png"></a></p><h3 id="3-カーネル引数の編集"><a href="#3-カーネル引数の編集" class="headerlink" title="3. カーネル引数の編集"></a>3. カーネル引数の編集</h3><p>OSの状態によって評される文字列が異なります。 例えば、下記はOSをインストールした直後になります。<br><a href="../../../../public/2018/10/05.png"><img src="../../../../public/2018/10/05.png"></a> 下記はOSをインストールして、初期ユーザの設定が終わった以降になります。 <a href="../../../../public/2018/10/05-2.png"><img src="../../../../public/2018/10/05-2.png"></a> どちらでも共通に存在する <strong>rhgb quiet</strong> を削除し、Enterキーを押下し、ブートを再開します。 <a href="../../../../public/2018/10/06.png"><img src="../../../../public/2018/10/06.png"></a></p><h3 id="4-無事に起動"><a href="#4-無事に起動" class="headerlink" title="4. 無事に起動"></a>4. 無事に起動</h3><p>一瞬、画面が乱れた問題になった画面が表示されますが、少し待つとブートが継続されます。<br><a href="../../../../public/2018/10/99.png"><img src="../../../../public/2018/10/99-1024x844.png"></a></p><h3 id="5-永続化"><a href="#5-永続化" class="headerlink" title="5. 永続化"></a>5. 永続化</h3><p>ここまでの方法はその場限りで再起動すれば戻ってしまいます。 なので、GRUBの設定ファイルを編集することで設定を永続化します。 無事にログインしたら、シェルから設定ファイルを編集します。 [code lang=”shell”] $ sudo vi /etc/grub.conf [/code] 編集ファイルを開くと下記のような状態です。 [code] # grub.conf generated by anaconda # # Note that you do not have to rerun grub after making changes to this file # NOTICE: You have a /boot partition. This means that # all kernel and initrd paths are relative to /boot/, eg. # root (hd0,0) # kernel /vmlinuz-version ro root=/dev/mapper/VolGroup-lv_root # initrd /initrd-[generic-]version.img #boot=/dev/sda default=0 timeout=5 splashimage=(hd0,0)/grub/splash.xpm.gz hiddenmenu title CentOS 6 (2.6.32-754.el6.x86_64) root (hd0,0) kernel /vmlinuz-2.6.32-754.el6.x86_64 ro root=/dev/mapper/VolGroup-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap SYSFONT=latarcyrheb-sun16 rd_LVM_LV=VolGroup/lv_root KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet initrd /initramfs-2.6.32-754.el6.x86_64.img [/code] これを下記のように編集します。 わかりにくいですが、先述のように、<strong>rhgb quiet</strong>を削除するだけです。 [code] # grub.conf generated by anaconda # # Note that you do not have to rerun grub after making changes to this file # NOTICE: You have a /boot partition. This means that # all kernel and initrd paths are relative to /boot/, eg. # root (hd0,0) # kernel /vmlinuz-version ro root=/dev/mapper/VolGroup-lv_root # initrd /initrd-[generic-]version.img #boot=/dev/sda default=0 timeout=5 splashimage=(hd0,0)/grub/splash.xpm.gz hiddenmenu title CentOS 6 (2.6.32-754.el6.x86_64) root (hd0,0) kernel /vmlinuz-2.6.32-754.el6.x86_64 ro root=/dev/mapper/VolGroup-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap SYSFONT=latarcyrheb-sun16 rd_LVM_LV=VolGroup/lv_root KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM initrd /initramfs-2.6.32-754.el6.x86_64.img [/code] これで設定が永続化されます。 ただし、これらを行っても、たまに起動に失敗することがあります。 その時はリセットボタンで再度ブートをやり直します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> Hyper-V </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その135 OpenCVに組み込んだlibjpeg-turbo 1.5.3と2.0.0を比較</title>
      <link href="/2018/09/09/3172/"/>
      <url>/2018/09/09/3172/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回の続き。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2018/09/09/3159" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">開発メモ その134 OpenCVにlibjpeg-turboをリンクして性能比較 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2018/09/09/3159</div></div></div></div></a></div></div><p><strong>libjpeg-turbo</strong>に2.0.0が登場しているため、1.5.3との性能を比較します。</p><h1 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h1><p>条件は前回とほとんど変わりません。 違うのはリンクするlibjpeg-turboが2.0.0になっただけです。</p><ol><li>Intel Cire i7-8700 (3.20GHz)</li><li>32.0GB</li><li>Visual Studio 2017 Update 7 (15.7)</li><li>OpenCV 3.2.0 (動的リンク、world形式でビルド。IPP、CUDAは除外)</li><li>libjpeg-turbo 2.0.0</li><li>libjpeg-turbo.libをリンク</li></ol><h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>実験も前回と同様、3種の画像、エンコードとデコードを計測します。 計測対象は下記。</p><ol><li>libjpeg-turbo 2.0.0 自家製ビルドOpenCV</li><li>libjpeg-turbo 1.5.3 自家製ビルドOpenCV</li></ol><p>また、実験ソースも前回と変わりません。 生成された<strong>opencv_world320.dll</strong>を差し替えるだけです。</p><h1 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h1><p>実験結果は下記になります。 速度はいずれも平均速度です。</p><h3 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h3><table><thead><tr><th></th><th>640x360</th><th>1280x720</th><th>2560x1440</th></tr></thead><tbody><tr><td>2.0.0</td><td>1.05651 ms</td><td>4.67864 ms</td><td>25.9939 ms</td></tr><tr><td>1.5.3</td><td>1.16508 ms</td><td>5.11916 ms</td><td>28.0259 ms</td></tr><tr><td>Improvement</td><td>+10%</td><td>+9%</td><td>+7%</td></tr></tbody></table><h3 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h3><table><thead><tr><th></th><th>640x360</th><th>1280x720</th><th>2560x1440</th></tr></thead><tbody><tr><td>2.0.0</td><td>1.15707 ms</td><td>4.3723 ms</td><td>17.9123 ms</td></tr><tr><td>1.5.3</td><td>1.37863 ms</td><td>5.03018 ms</td><td>20.6569 ms</td></tr><tr><td>Improvement</td><td>+19%</td><td>+15%</td><td>+15%</td></tr></tbody></table><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>劇的な改善はありませんが、着実に性能が向上しています。</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> OpenCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>libjpeg-turbo-encode-2.0.0</title>
      <link href="/2018/09/09/3174/"/>
      <url>/2018/09/09/3174/</url>
      
        <content type="html"><![CDATA[<p>[[“”,”640x360”,”1280x720”,”2560x1440”],[“2.0.0”,”1.15707 ms”,”4.3723 ms”,”17.9123 ms”],[“1.5.3”,”1.37863 ms”,”5.03018 ms”,”20.6569 ms”],[“Improvement”,”+19%”,”+15%”,”+15%”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>libjpeg-turbo-decode-2.0.0</title>
      <link href="/2018/09/09/3173/"/>
      <url>/2018/09/09/3173/</url>
      
        <content type="html"><![CDATA[<p>[[“”,”640x360”,”1280x720”,”2560x1440”],[“2.0.0”,”1.05651 ms”,”4.67864 ms”,”25.9939 ms”],[“1.5.3”,”1.16508 ms”,”5.11916 ms”,”28.0259 ms”],[“Improvement”,”+10%”,”+9%”,”+7%”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その134 OpenCVにlibjpeg-turboをリンクして性能比較</title>
      <link href="/2018/09/09/3159/"/>
      <url>/2018/09/09/3159/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>掲題そのまま。 結構、このネタはそこら辺に転がっているんだけど、</p><ol><li>計測していない</li><li>エンコードだけ計測</li></ol><p>みたいなネタでげんなりしたので自分で実施してみました。 実験ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/libjpeg-turbo-decode" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/libjpeg-turbo-decode</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h1><p>条件は下記になります。</p><ol><li>Intel Cire i7-8700 (3.20GHz)</li><li>32.0GB</li><li>Visual Studio 2017 Update 7 (15.7)</li><li>OpenCV 3.2.0 (動的リンク、world形式でビルド。IPP、CUDAは除外)</li><li>libjpeg-turbo 1.5.3</li><li>libjpeg-turbo.libをリンク</li></ol><p>になります。 また、<strong>libjpeg.lib</strong>と<strong>libjpeg-turbo.lib</strong>のどちらをリンクするかで意見が割れていますが、ここでは<strong>libjpeg-turbo.lib</strong>をリンクしました。 OpenCVのビルドのためのCMakeのコマンドは下記のようになります。</p><h3 id="libjpeg-turbo-有効"><a href="#libjpeg-turbo-有効" class="headerlink" title="libjpeg-turbo 有効"></a>libjpeg-turbo 有効</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cmake -G &quot;Visual Studio <span class="number">15</span> <span class="number">2017</span> Win64&quot; ^</span><br><span class="line">        -D CMAKE_BUILD_TYPE=Release ^</span><br><span class="line">        -D BUILD_SHARED_LIBS=ON ^</span><br><span class="line">        -D BUILD_opencv_world=ON ^</span><br><span class="line">        -D WITH_CUDA=OFF ^</span><br><span class="line">        -D WITH_IPP=OFF ^</span><br><span class="line">        -D WITH_JPEG=ON ^</span><br><span class="line">        -D BUILD_JPEG=OFF ^</span><br><span class="line">        -D JPEG_INCLUDE_DIR=&quot;&lt;libjpeg-turboのディレクトリ&gt;&quot; ^</span><br><span class="line">        -D JPEG_LIBRARY=&quot;&lt;libjpeg-turbo.libのフルパス&quot; ^</span><br><span class="line">        ..</span><br></pre></td></tr></table></figure><h3 id="libjpeg-turbo-無効"><a href="#libjpeg-turbo-無効" class="headerlink" title="libjpeg-turbo 無効"></a>libjpeg-turbo 無効</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cmake -G &quot;Visual Studio <span class="number">15</span> <span class="number">2017</span> Win64&quot; ^</span><br><span class="line">        -D CMAKE_BUILD_TYPE=Release ^</span><br><span class="line">        -D BUILD_SHARED_LIBS=ON ^</span><br><span class="line">        -D BUILD_opencv_world=ON ^</span><br><span class="line">        -D WITH_CUDA=OFF ^</span><br><span class="line">        -D WITH_IPP=OFF ^</span><br><span class="line">        ..</span><br></pre></td></tr></table></figure><h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>実験は、</p><ol><li>libjpeg-turbo有効の自家製ビルドOpenCV</li><li>libjpeg-turbo無効の自家製ビルドOpenCV</li><li>公式のOpenCVバイナリ</li></ol><p>に対して比較します。 また、画像は、</p><ol><li>640x360</li><li>1280x720</li><li>2560x1440</li></ol><p>の3種類を用意し、それぞれのデータのデコードとエンコードを1000回繰り返します。 実験ソースは下記です。 ベースとして、下記のページを参考にさせていただきました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://unanancyowen.com/opencv-with-libjpeg-turbo/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=unanancyowen.com"></img><div class="hbc-site-name">Summary?Blog</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://unanancyowen.com/wp-content/uploads/opencv_logo.png"></img></div><div class="hbc-text"><div class="hbc-title">Speed-Up JPEG Encode/Decode Processing for OpenCV using libjpeg-turbo |</div><div class="hbc-url">http://unanancyowen.com/opencv-with-libjpeg-turbo/</div></div></div></div></a></div></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// libjpeg-turbo-decode.cpp : アプリケーションのエントリ ポイントを定義します。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TEST_COUNT 1000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Build Information</span></span><br><span class="line">    <span class="comment">//std::cout &lt;&lt; cv::getBuildInformation() &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::ifstream <span class="title">f</span><span class="params">(argv[<span class="number">1</span>], <span class="built_in">std</span>::ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!f.is_open())</span><br><span class="line">        <span class="keyword">return</span>  <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    f.seekg(<span class="number">0</span>, <span class="built_in">std</span>::ios::end);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> length = f.tellg();</span><br><span class="line">    f.seekg(<span class="number">0</span>, <span class="built_in">std</span>::ios::beg);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> buffer = <span class="keyword">new</span> <span class="keyword">char</span>[length];</span><br><span class="line">    f.read(buffer, length);</span><br><span class="line">    f.close();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> data = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;(buffer, buffer + length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Test</span></span><br><span class="line">    int64 start = <span class="number">0</span>;</span><br><span class="line">    int64 end = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">double</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">double</span> avg = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    start = cv::getTickCount();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; TEST_COUNT; i++)</span><br><span class="line">        <span class="keyword">auto</span> ret = cv::imdecode(data, cv::IMREAD_UNCHANGED);</span><br><span class="line">    end = cv::getTickCount();</span><br><span class="line"></span><br><span class="line">    total = (end - start) * <span class="number">1000</span> / cv::getTickFrequency();</span><br><span class="line">    avg = total / TEST_COUNT;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;[Decode]&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\tTotal = &quot;</span> &lt;&lt; total &lt;&lt; <span class="string">&quot;[ms], Avg = &quot;</span> &lt;&lt; avg &lt;&lt; <span class="string">&quot;[ms]&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> img = cv::imdecode(data, cv::IMREAD_UNCHANGED);</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;uchar&gt; <span class="title">buf</span><span class="params">( img.rows * img.cols )</span></span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; params = &#123; cv::IMWRITE_JPEG_QUALITY, <span class="number">95</span> &#125;;</span><br><span class="line"></span><br><span class="line">    start = cv::getTickCount();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; TEST_COUNT; i++)</span><br><span class="line">        cv::imencode(<span class="string">&quot;.jpg&quot;</span>, img, buf, params);</span><br><span class="line">    end = cv::getTickCount();</span><br><span class="line"></span><br><span class="line">    total = (end - start) * <span class="number">1000</span> / cv::getTickFrequency();</span><br><span class="line">    avg = total / TEST_COUNT;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;[Encode]&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\tTotal = &quot;</span> &lt;&lt; total &lt;&lt; <span class="string">&quot;[ms], Avg = &quot;</span> &lt;&lt; avg &lt;&lt; <span class="string">&quot;[ms]&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h1><p>実験結果は下記になります。 速度はいずれも平均速度です。</p><h3 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h3><table><thead><tr><th></th><th>640x360</th><th>1280x720</th><th>2560x1440</th></tr></thead><tbody><tr><td>Enable libjpeg-turbo</td><td>1.16508 ms</td><td>5.11916 ms</td><td>28.0259 ms</td></tr><tr><td>Disable libjpeg-turbo</td><td>2.15667 ms</td><td>9.02238 ms</td><td>40.7576 ms</td></tr><tr><td>original binary</td><td>2.44517 ms</td><td>10.1288 ms</td><td>46.2685 ms</td></tr></tbody></table><h3 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h3><table><thead><tr><th></th><th>640x360</th><th>1280x720</th><th>2560x1440</th></tr></thead><tbody><tr><td>Enable libjpeg-turbo</td><td>1.37863 ms</td><td>5.03018 ms</td><td>20.6569 ms</td></tr><tr><td>Disable libjpeg-turbo</td><td>5.18752 ms</td><td>19.4827 ms</td><td>83.4678 ms</td></tr><tr><td>original binary</td><td>5.69063 ms</td><td>21.4501 ms</td><td>91.6039 ms</td></tr></tbody></table><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>エンコード性能は著しい改善を見せており、3.5-4.0倍の速度をたたき出しています。 デコードも、1.6-2.2倍の速度と良い感じです。 高々数十msの違いかもしれませんが、OpenCVのVideoCapture等でWebカメラをキャプチャした際、MotionJPEG形式ならデコード処理がそのままfpsに跳ね返ってきます。 1280X720で従来20ms要していたということは、30fpsのカメラでも事実上、1フレームに33ms+20msの53ms、つまり20fps程度しか性能が出なかったことになります。 これが5msになれば、33ms+5msの38msなら26fpsと改善できます。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/libjpeg-turbo-decode">https://github.com/takuya-takeuchi/Demo/tree/master/libjpeg-turbo-decode</a></p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> OpenCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>libjpeg-turbo-encode</title>
      <link href="/2018/09/09/3165/"/>
      <url>/2018/09/09/3165/</url>
      
        <content type="html"><![CDATA[<p>[[“”,”640x360”,”1280x720”,”2560x1440”],[“Enable libjpeg-turbo”,”1.37863 ms”,”5.03018 ms”,”20.6569 ms”],[“Disable libjpeg-turbo”,”5.18752 ms”,”19.4827 ms”,”83.4678 ms”],[“original binary”,”5.69063 ms”,”21.4501 ms”,”91.6039 ms”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>libjpeg-turbo-decode</title>
      <link href="/2018/09/09/3163/"/>
      <url>/2018/09/09/3163/</url>
      
        <content type="html"><![CDATA[<p>[[“”,”640x360”,”1280x720”,”2560x1440”],[“Enable libjpeg-turbo”,”1.16508 ms”,”5.11916 ms”,”28.0259 ms”],[“Disable libjpeg-turbo”,”2.15667 ms”,”9.02238 ms”,”40.7576 ms”],[“original binary”,”2.44517 ms”,”10.1288 ms”,”46.2685 ms”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その133 Ubuntu 16.04.4でdconf Editorが見つかない</title>
      <link href="/2018/09/08/3149/"/>
      <url>/2018/09/08/3149/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>何故か<strong>donf Editor</strong>が<strong>Ubuntu Software</strong>から検索しても見つからない件。<br><a href="../../../../public/2018/09/notfound.png"><img src="../../../../public/2018/09/notfound.png"></a></p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>普通に<strong>apt-get</strong>でインストールするだけでした。何時からこうなったの? [code lang=”shell”] $ sudo apt-get install dconf-editor [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その132 Visual Studio 2017 15.7 に CUDA 9.2 をインストールする</title>
      <link href="/2018/09/01/3141/"/>
      <url>/2018/09/01/3141/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>CUDA Toolkit</strong>には、Visual Studioと統合される<strong>Visual Studio Integration</strong>が含まれています。 しかしながら、このツール、Visual Studioのバージョンをチェックしているのか、2018/09/01現在、最新のCUDA Toolkit、<strong>cuda_9.2.148_win10.exe</strong>でもインストールに失敗します。 というのも公式にも対応しているのは、<strong>Visual Studio 2017 15.6</strong>となっており対応していないことがうかがえます。 既に、15.8の登場が控えている状況でこれは非常にまずいです。 ということでその対応。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>公式のフォーラムでもこの問題は話題になっています。 Nvidiaの対応に不満の声が。 そんな中、下記のスレッドの**installing CUDA 9.2 with VS2017 integration worked for me this way:**と言う投稿で対応策が提示されました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://devtalk.nvidia.com/default/topic/1035535/cuda-setup-and-installation/cuda-9-2-does-not-work-with-visual-studio-2017-15-7-1/2" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=devtalk.nvidia.com"></img><div class="hbc-site-name">NVIDIA Developer Forums</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://aws1.discourse-cdn.com/nvidia/original/2X/8/8f17cc8f1a724d6ecea8a197a267ec8a05ef1490.png"></img></div><div class="hbc-text"><div class="hbc-title">Cuda 9.2 does NOT work with Visual Studio 2017 15.7.1</div><div class="hbc-url">https://devtalk.nvidia.com/default/topic/1035535/cuda-setup-and-installation/cuda-9-2-does-not-work-with-visual-studio-2017-15-7-1/2</div><div class="hbc-description">When trying to compile CUDA samples the following error occurs:  c:\program files\nvidia gpu computing toolkit\cuda\v9.2\include\crt/host_co…</div></div></div></div></a></div></div><p>要点は、</p><ol><li>cuda_9.2.88_win10.exeをWinRARとかで展開</li><li>CUDAVisualStudioIntegration\CUDAVisualStudioIntegration.nviを書き換える</li><li>setup.exeを実行</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2\include\crt\host_config.hを書き換える</li></ol><p>です。 私の試した手順だと、</p><ol><li>cuda_9.2.88_win10.exeを実行し、インストーラを起動して最初の画面で待機</li><li>CUDAVisualStudioIntegration.nviを書き換える</li><li>インストール続行</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2\include\crt\host_config.hを書き換える</li></ol><p>でOKでした。 少し具体的に書くと、</p><h2 id="CUDAVisualStudioIntegration-nvi-を書き換える"><a href="#CUDAVisualStudioIntegration-nvi-を書き換える" class="headerlink" title="CUDAVisualStudioIntegration.nvi を書き換える"></a>CUDAVisualStudioIntegration.nvi を書き換える</h2><p>インストーラを起動してから書き換える場合は、**”%TEMP%\CUDA\CUDAVisualStudioIntegration\CUDAVisualStudioIntegration.nvi**が書き換える対象です。 そして、テキストエディタでCUDAVisualStudioIntegration.nviを開き、下記の箇所を削除します。 [code lang=”xml”] <custom phase="handleExistingNsight" action="HandleExistingNsight"/> <custom phase="detectDisableCallHome" action="DetectDisableCallHome"/> <msi platform="x86" phase="NsightMSINoTraffic" name="$" condition="NsightMSIActionActiveAndNoTraffic" installText="Installing Nsight Visual Studio Edition"> <arg name="CUDAINSTALLER" value="true"/> <arg name="DISABLE\_NV\_CH" value="1"/> </msi> <msi platform="x86" phase="NsightMSITraffic" name="$" condition="NsightMSIActionActiveAndTraffic" installText="Installing Nsight Visual Studio Edition"> <arg name="CUDAINSTALLER" value="true"/> <arg name="DISABLE\_NV\_CH" value="0"/> </msi> <confirm phase="Confirm-install" when="install" condition="NsightMSIActionActive"> <fileExists target="$\\NVIDIA Corporation\\Nsight\\Nsight\_$\_InstallSummary.xml"/> </confirm> <standard phase="copytemp" condition="NsightMSIActionActive"> <copyFile source="NVIDIA\_Nsight\_Visual\_Studio\_Edition\_Win64\_5.6.0.18099.msi" target="$\\NVIDIA Corporation\\Nsight\\NVIDIA\_Nsight\_Visual\_Studio\_Edition\_Win64\_5.6.0.18099.msi" /><br></standard> <standard phase="createStartMenuStortcuts" condition="NsightMSIActionActive"> <createShortcutGroup location="startMenu" linkGroup="$"/> <createShortcutLink location="startMenu" targetPath="$\\NVIDIA Corporation\\Nsight\\NVIDIA\_Nsight\_Visual\_Studio\_Edition\_Win64\_5.6.0.18099.msi" linkGroup="$" linkName="Nsight Redistributable"/> </standard> <custom phase="ParseWarningPage" action="ReadWarningPage" condition="NsightMSIActionActive"/><br><msi platform="x86" phase="NVTXMSI" name="$" installText="Installing NVTX"/> [/code]</p><h2 id="host-config-h-を書き換える"><a href="#host-config-h-を書き換える" class="headerlink" title="host_config.h を書き換える"></a>host_config.h を書き換える</h2><p>インストール完了後、<strong>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.2\include\crt\host_config.h</strong>を書き換えます。 これを書き換えないと、CUDAを使ってコンパイルする際にエラーが出てコンパイルが停止します。 130行目付近の [code lang=”cpp”] #if _MSC_VER &lt; 1600 || _MSC_VER &gt; 1913<br>#error – unsupported Microsoft Visual Studio version! Only the versions 2012, 2013, 2015 and 2017 are supported!<br>#elif _MSC_VER == 1600 /* _MSC_VERION == 1600 */ [/code] を、下記のようにします。 [code lang=”cpp”] /*#if _MSC_VER &lt; 1600 || _MSC_VER &gt; 1913*/ #if _MSC_VER &lt; 1600<br>#error – unsupported Microsoft Visual Studio version! Only the versions 2012, 2013, 2015 and 2017 are supported!<br>#elif _MSC_VER == 1600 /* _MSC_VERION == 1600 */ [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio </category>
          
          <category> gpupu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その131 CSliderCtrlの背景色が変更されない</title>
      <link href="/2018/08/30/3137/"/>
      <url>/2018/08/30/3137/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>MFC</strong>なんかレガシーもいいところですが、仕事である以上使わざるを得ません。 そんな中、<strong>CSliderCtrl</strong>の背景色を<strong>CDialog::OnCtlColor</strong>経由で変更したところ、背景色が変わらない問題が発生。 <strong>CWnd::UpdateWindow</strong>や<strong>CWnd::InvalidateRect</strong>を駆使しても効果が無い。 なぜ?とネットを彷徨った際の備忘録(今後使う可能性は低いが) ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/MFC1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/MFC1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p><strong>CSliderCtrl</strong>は下記の、少し奇妙な関数を持っています。</p><ul><li><strong>CSliderCtrl::ClearSel</strong></li><li><strong>CSliderCtrl::ClearTics</strong></li><li><strong>CSliderCtrl::SetRange</strong></li><li><strong>CSliderCtrl::SetRangeMax</strong></li><li><strong>CSliderCtrl::SetRangeMin</strong></li></ul><p>これらの関数は最後の引数に <strong>BOOL bRedraw = FALSE</strong> をとります。 これらの関数にTRUEを渡すことで背景の更新が可能になります。 <strong>Spy</strong>で確認したのですが、これらの関数は内部で <strong>WM_PAINT</strong>を使っているようです。 そのため <strong>CWnd::UpdateWindow</strong> を使って同じ状況を作り出したにもかかわらず、<strong>CWnd::UpdateWindow</strong> は効果が無い。 この現象に言及した唯一の記事が下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://stackoverflow.com/questions/12800581/update-mfcs-csliderctrl" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=stackoverflow.com"></img><div class="hbc-site-name">Stack Overflow</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded"></img></div><div class="hbc-text"><div class="hbc-title">Update MFC&#39;s CSliderCtrl</div><div class="hbc-url">https://stackoverflow.com/questions/12800581/update-mfcs-csliderctrl</div><div class="hbc-description">I am working on a C++ MFC project and bumping in the following. I have a CSliderCtrl on my form which I call MFC_scKINECTANGLE. To make it t…</div></div></div></div></a></div></div><p>上記の関数以外にも、<strong>CWnd::EnableWindow</strong>でも更新が可能だと言っています。 しかし、この関数を使う場合は、一度現在のEnable/Disableと反対の値を設定する必要があるため、著しくちらつく欠点があります。 ですので、最初に紹介した関数を使うことで、ちらつきを押さえて背景色を更新できます。 つまり、現在の設定と同じ値を使って更新するのです。 [code lang=”cpp”] void CSliderSampleDlg::OnBnClickedButtonRedraw() { const auto max = this-&gt;m_slider.GetRangeMax(); const auto min = this-&gt;m_slider.GetRangeMin();<br>// Set same value to redraw this-&gt;m_slider.SetRange(min, max, TRUE); } [/code] 後は、SliderをGUIで操作して値を変更することでも背景が更新されますが、コードから変更しないと意味が無いので却下。 サンプルは下記のような感じです。<br><a href="../../../../public/2018/08/Sample.gif"><img src="../../../../public/2018/08/Sample.gif"></a></p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/MFC1">https://github.com/takuya-takeuchi/Demo/tree/master/MFC1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Microsoft Foundation Class </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その130 Windows IoT Core にリモートデバッグ</title>
      <link href="/2018/08/16/3126/"/>
      <url>/2018/08/16/3126/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録です。 たいしたことないのですが、_Windows IoT Core_上にデプロイしたアプリをリモートデバッグしようと思い、 <strong>Windows Device Portal</strong> から <strong>Visual Studio Remote Debugger</strong> を立ち上げようとしたら<br><a href="../../../../public/2018/08/pi1.png"><img src="../../../../public/2018/08/pi1-1024x495.png"></a><br> というエラーが。 確かに、デスクトップのWindowsの場合はVisual Studio Remote Debuggerをインストールする必要がありますが、Windows IoT core用のものなぞどこにも見つからず。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>偶然気づいたのですが、 「Visual Studioから直接デプロイandデバッグできるんじゃね?」 と思ったらこれが正解。 プロジェクトのデバッグ設定から<br><a href="../../../../public/2018/08/pi2.png"><img src="../../../../public/2018/08/pi2-1024x624.png"></a> 接続先のアドレスと認証モードを <strong>ユニバーサル (暗号化されていないプロトコル)</strong> に指定してデバッグを開始。 時間はかかりますが、これでデバッグが開始されます。 で、ここでさらに、 「今のでリモートデバッガーも展開されたんじゃね?」 と推測し、再度Windows Device Portalに移動しVisual Studio Remote Debuggerを起動すると <a href="../../../../public/2018/08/pi3.png"><img src="../../../../public/2018/08/pi3-1024x495.png"></a><br> 無事に起動。 これはわかりにくい</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> IoT </category>
          
          <category> net </category>
          
          <category> Windows IoT </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その129 Raspberry Pi3に.NET Coreをインストール</title>
      <link href="/2018/08/06/3122/"/>
      <url>/2018/08/06/3122/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録です。 <strong>Debian with Raspberry Pi Desktop</strong>にインストールには、リポジトリにはARMのバイナリが用意されていないため<strong>apt-get</strong>が使えません。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to"></a>How to</h1><p><strong>.NET Core 2.1.0 SDK</strong>ですが、下記から<strong>Linux ARM</strong>の<strong>SDK Binaries</strong>をダウンロードします。 ARMなので32bitをダウンロードします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/dotnet/core/blob/master/release-notes/download-archives/2.1.0-download.md" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/9141961?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">dotnet/core</div><div class="hbc-url">https://github.com/dotnet/core/blob/master/release-notes/download-archives/2.1.0-download.md</div><div class="hbc-description">Home repository for .NET Core. Contribute to dotnet/core development by creating an account on GitHub.</div></div></div></div></a></div></div><p>下記のコマンドでダウンロードインストールを行います。 [code lang=”shell”] $ wget <a href="https://download.microsoft.com/download/8/8/5/88544F33-836A-49A5-8B67-451C24709A8F/dotnet-sdk-2.1.300-linux-arm.tar.gz">https://download.microsoft.com/download/8/8/5/88544F33-836A-49A5-8B67-451C24709A8F/dotnet-sdk-2.1.300-linux-arm.tar.gz</a> $ mkdir -p $HOME/dotnet $ tar zxf dotnet-sdk-2.1.300-linux-arm.tar.gz -C $HOME/dotnet $ export PATH=$PATH:$HOME/dotnet [/code] インストール後、下記によってインストールができたことを確認できます。 [code lang=”shell”] $ dotnet –version 2.1.300 [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> IoT </category>
          
          <category> net </category>
          
          <category> iot </category>
          
          <category> .NET Core </category>
          
          <category> Raspbian </category>
          
          <category> Raspberry Pi </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その128 子プロセスに対してWM_CLOSEを送る</title>
      <link href="/2018/07/22/3109/"/>
      <url>/2018/07/22/3109/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 C++/C#の連携で、C++アプリから起動したC#アプリを、C++アプリから正常終了させる方法。 基本は、</p><ol><li>CreateProcessの戻りのプロセスIDを保持</li><li>終了させる際、プロセスIDからウィンドウハンドルを取得</li><li>PostMessageでWM_CLOSEを送る</li></ol><p>です。 ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/KillProcessSafetyByHWND" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/KillProcessSafetyByHWND</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><p>[code lang=”cpp”] #include “stdafx.h”<br>HWND GetWindowHandle(const DWORD target_id) { auto hWnd = GetTopWindow(nullptr); do { if (GetWindowLong(hWnd, GWLP_HWNDPARENT) != 0 || !IsWindowVisible(hWnd)) continue;<br>DWORD process_id; GetWindowThreadProcessId(hWnd, &amp;process_id); if (target_id == process_id) return hWnd; } while ((hWnd = GetNextWindow(hWnd, GW_HWNDNEXT)) != nullptr);<br>return nullptr; }<br>int main() { // Launch application STARTUPINFO si; PROCESS_INFORMATION pi; ::ZeroMemory(&amp;si, sizeof(STARTUPINFO)); si.cb = sizeof(STARTUPINFO); si.dwFlags = STARTF_USESHOWWINDOW; si.wShowWindow = SW_SHOWNORMAL; ::CreateProcessW(L”Wpf.exe”, nullptr, nullptr, nullptr, FALSE, 0, nullptr, nullptr, &amp;si, &amp;pi);<br>_tprintf(_T(“Terminate application: %d\n”), pi.dwProcessId);<br>// Wait until application completely starts to create window handle Sleep(1000); auto handle = GetWindowHandle(pi.dwProcessId); ::PostMessage(handle, WM_CLOSE, 0, 0);<br>// Terminate forcibly if application does not quit in 5sec. if (::WaitForSingleObject(pi.hProcess, 5000) == WAIT_TIMEOUT) { _tprintf(_T(“Terminate forcibly”)); TerminateProcess(pi.hProcess, 0); }<br>::CloseHandle(pi.hThread); ::CloseHandle(pi.hProcess);<br>return 0; } [/code] <strong>GetWindowHandle</strong>で、プロセスIDからウィンドウハンドルを探し出しているのが肝です。 そして、このサンプルではプロセス起動後、<strong>Sleep</strong>で少し待機しています。 そうしないと、ウィンドウハンドルが取れないので… コメントにも書いたように、おそらくウィンドウハンドルが生成され切っていないのかと。</p><h2 id="C-1"><a href="#C-1" class="headerlink" title="C#"></a>C#</h2><p>WPFのサンプルです。 コードビハインドですが、気にしません。 [code lang=”csharp”] using System; using System.Windows; using System.Windows.Interop; namespace Wpf { /// <summary> /// MainWindow.xaml の相互作用ロジック /// </summary> public partial class MainWindow : Window {<br>public MainWindow() { InitializeComponent(); this.Loaded += this.WindowLoaded; }<br>private void WindowLoaded(object sender, RoutedEventArgs e) { var source = HwndSource.FromHwnd(new WindowInteropHelper(this).Handle); source?.AddHook(WndProc); }<br>private static IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled) { const int WM_CLOSE = 0x0010; if (msg == WM_CLOSE) { MessageBox.Show(“Get WM_CLOSE”);<br>//handled = true; }<br>return IntPtr.Zero; }<br>} } [/code]</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/KillProcessSafetyByHWND">https://github.com/takuya-takeuchi/Demo/tree/master/KillProcessSafetyByHWND</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> C/C++ </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その127 Anaconda navigatorの仮想環境のディレクトリを変更する</title>
      <link href="/2018/07/21/3094/"/>
      <url>/2018/07/21/3094/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 デフォルトだと**%LocalAppData%<strong>に作成しにいくので辛い。 また最近のAnaconda navigatorは</strong>初回**に保存先を聞いてくるようですが、それをスキップするとGUIから変更する手段がないのも辛い。 2018/11/01 更新 仮想環境はcondaを使わない方が良いです。condaの仮想環境ではpipでインストールしたパッケージを全ての環境で共有してしまうからです。 正しい仮想環境の作成は<a href="https://taktak.jp/2018/11/01/3613">開発メモ その143 Pythonの仮想環境を正しく使う</a>を参考にして下さい。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>解決策はこちら。 </p><p>やはり<strong>Stackoverflow</strong>はしゅごい(小並感) 手順は、</p><h4 id="1-condarc-を開く"><a href="#1-condarc-を開く" class="headerlink" title="1. .condarc を開く"></a>1. <strong>.condarc</strong> を開く</h4><p>私の環境では**%userprofile%**にありました。</p><h4 id="2-下記の記述を追記"><a href="#2-下記の記述を追記" class="headerlink" title="2. 下記の記述を追記"></a>2. 下記の記述を追記</h4><p>[code] envs_dirs: - /Users/nolan/newpath [/code] ディレクトリ部分は好きなように変えましょう。 ここでは<strong>D:\Works\Python\Envs</strong>に変更します。パスの区切りはバックスラッシュでOK。 つまり [code] envs_dirs: - D:\Works\Python\Envs [/code] です。</p><h4 id="3-既存の環境を移動"><a href="#3-既存の環境を移動" class="headerlink" title="3. 既存の環境を移動"></a>3. 既存の環境を移動</h4><p>次に既に作成されたいる仮想環境を移動します。 規定では、*<em>%LocalAppData%\conda\conda\envs**に作成されている模様。 コマンドで、 [code lang=”shell”] $ conda info -e # conda environments: # base \</em> C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64 face_regognition C:\Users\XXXXXXX\AppData\Local\conda\conda\envs\face_regognition [/code] という確認も可能。 (どうでもいいけどスペル間違えてる….) 場所がわかったら、そこの配下を<strong>D:\Works\Python\Envs</strong>に<strong>コピー</strong>します。 移動すると壊れた場合に戻せないので。</p><h4 id="4-古い環境を削除"><a href="#4-古い環境を削除" class="headerlink" title="4. 古い環境を削除"></a>4. 古い環境を削除</h4><p>この状態で、先ほどのコマンドを打っても [code lang=”shell”] $ conda info -e # conda environments: # base * C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64 face_regognition C:\Users\XXXXXXX\AppData\Local\conda\conda\envs\face_regognition [/code] コピーを認識していませんが… Anaconda Navigatorは認識しています。<br><a href="../../../../public/2018/07/36e7d7a2646cb1158d26cc0e2f2d8b49.png"><img src="../../../../public/2018/07/36e7d7a2646cb1158d26cc0e2f2d8b49-1024x615.png"></a></p><p>おそらく名前が重複している場合は、先に見つかった方を優先しているのでしょう。 ですので、ここから古い方を削除します。<br><a href="../../../../public/2018/07/f906fd6e36e4fcba4aecc5186231e0cf.png"><img src="../../../../public/2018/07/f906fd6e36e4fcba4aecc5186231e0cf.png"></a></p><p>削除後、 [code lang=”shell”] $ conda info -e # conda environments: # base * C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64 face_regognition D:\Works\Python\Envs\face_regognition [/code] きちんとコピーを認識してくれました。 無事に完了です。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> python-2 </category>
          
          <category> Anaconda </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その126 Anaconda navigatorのアップデートが始まらない</title>
      <link href="/2018/07/21/3091/"/>
      <url>/2018/07/21/3091/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 Visual Studio 2017に付属していた<strong>Anaconda navigator</strong>がアップデートするか？と聞いてきたので、はいと答えるも待てど暮らせどアップデートが始まらない状況に陥ったのでメモ。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>解決策はこちら。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://teratail.com/questions/105414" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=teratail.com"></img><div class="hbc-site-name">teratail[テラテイル]</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://teratail.com/img/imgFacebookShare.png"></img></div><div class="hbc-text"><div class="hbc-title">Anaconda NavigatorとAnaconda promptが機能しなくなった｜teratail</div><div class="hbc-url">https://teratail.com/questions/105414</div><div class="hbc-description">作業中にAnaconda NavigatorとAnaconda promptが起動したらエラーを吐いて起動しなくなりました。  環境はwindows10 HomeAnaconda3-5.0.1です。  エラーの内容はAnaconda Navigator  Na</div></div></div></div></a></div></div><p>上の問題と今回の問題は直接関係していませんが、解決方法は同一。 <strong>管理者権限</strong>をつけて<strong>Anaconda Prompt</strong>を起動します。 次に下記のコマンドを実行。 [code lang=”shell”] $ conda update anaconda-navigator Fetching package metadata …………. Solving package specifications: .<br>Package plan for installation in environment C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64:<br>The following packages will be UPDATED:<br>anaconda: 5.0.0-py36hea9b2fc_0 –&gt; custom-py36h363777c_0 anaconda-client: 1.6.5-py36hd36550c_0 –&gt; 1.6.14-py36_0 anaconda-navigator: 1.6.8-py36h4b7dd57_0 –&gt; 1.8.7-py36_0 conda: 4.3.27-py36hcbae3bd_0 –&gt; 4.5.8-py36_0 pycosat: 0.6.2-py36hf17546d_1 –&gt; 0.6.3-py36h413d8a4_0 qtpy: 1.3.1-py36hb8717c5_0 –&gt; 1.4.2-py36_0 vc: 14-h2379b0c_1 –&gt; 14.1-h0510ff6_3 vs2015_runtime: 14.0.25123-hd4c4e62_1 –&gt; 15.5.2-3<br>Proceed ([y]/n)? y<br>anaconda-custo 100% |###############################| Time: 0:00:00 1.81 MB/s qtpy-1.4.2-py3 100% |###############################| Time: 0:00:00 2.22 MB/s anaconda-clien 100% |###############################| Time: 0:00:00 5.25 MB/s conda-4.5.8-py 100% |###############################| Time: 0:00:00 2.55 MB/s anaconda-navig 100% |###############################| Time: 0:00:02 1.93 MB/s DEBUG menuinst_win32:__init__(185): Menu: name: ‘Anaconda${PY_VER} ${PLATFORM}’, prefix: ‘C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64’, env_name: ‘None’, mode: ‘None’, used_mode: ‘system’ DEBUG menuinst_win32:__init__(185): Menu: name: ‘Anaconda${PY_VER} ${PLATFORM}’, prefix: ‘C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64’, env_name: ‘None’, mode: ‘None’, used_mode: ‘system’ [/code] こんな感じで更新が終わります。 ついでにアップデータも更新します。 [code lang=”shell”] $ conda update navigator-updater Solving environment: done<br>## Package Plan ##<br>environment location: C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64<br>added / updated specs: - navigator-updater<br>The following packages will be downloaded:<br>package | build —————————|—————– openssl-1.0.2o | h8ea7d77_0 5.4 MB navigator-updater-0.2.1 | py36_0 1.3 MB ca-certificates-2018.03.07 | 0 155 KB ———————————————————— Total: 6.8 MB<br>The following packages will be UPDATED:<br>ca-certificates: 2017.08.26-h94faf87_0 –&gt; 2018.03.07-0 certifi: 2017.7.27.1-py36h043bc9e_0 –&gt; 2018.4.16-py36_0 navigator-updater: 0.1.0-py36h8a7b86b_0 –&gt; 0.2.1-py36_0 openssl: 1.0.2l-vc14hcac20b0_2 –&gt; 1.0.2o-h8ea7d77_0<br>Proceed ([y]/n)? y<br>Downloading and Extracting Packages openssl-1.0.2o | 5.4 MB | ############################################################################## | 100% navigator-updater-0. | 1.3 MB | ############################################################################## | 100% ca-certificates-2018 | 155 KB | ############################################################################## | 100% Preparing transaction: done Verifying transaction: done Executing transaction: done [/code] 無事に完了です。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> python-2 </category>
          
          <category> Anaconda </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その125 Android NDKをWindowsで使ってみる</title>
      <link href="/2018/05/20/3079/"/>
      <url>/2018/05/20/3079/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Xamarin</strong>を再び勉強しはじめています。 Nativeのライブラリを使いたいので、試行錯誤中です。</p><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started!!"></a>Get Started!!</h1><p>Androidで動作するNativeライブラリを作成するには、<strong>Android NDK (Native Development Kit)**が必要です。 最初自分は</strong>g++**でできると思い込んで、それをAndroidのEmulatorに配置していたのですが、それは間違っていました(白目) なので、NDKの使い方から。</p><h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p>公式の<a href="https://developer.android.com/ndk/downloads/">Download</a>から入手します。 Windows、Mac、Linux用が提供されています。今回はWindows版を。 ダウンロードしたら、適当な場所に展開し、パスを通しておきます。 が、パスに空白が入ると<strong>動かない</strong>ので注意。 パスを通したら [code lang=”ps”] C:\WINDOWS\system32&gt;ndk-build Android NDK: Could not find application project directory ! Android NDK: Please define the NDK_PROJECT_PATH variable to point to it. C:\Android\NDK\build\\..\build\core\build-local.mk:151: *** Android NDK: Aborting . Stop. [/code] のように表示されれあば準備完了です。</p><h2 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h2><p>コンパイル環境ができましたので、ビルドを行います。 ビルドについては、 </p><p>が非常に参考になりました。 ソースは下記です。 <strong>calc.cpp</strong> [code lang=”cpp”] #include “calc.h” [/code] <strong>calc.h</strong> [code lang=”cpp”] #ifndef _CPP_CALC_H_ #define _CPP_CALC_H_<br>#include “export.h”<br>DLLEXPORT int calc_add(int a, int b) { return a + b; }<br>#endif [/code] <strong>export.h</strong> [code lang=”cpp”] #ifdef _WINDOWS #define DLLEXPORT extern “C” __declspec(dllexport) #else #define DLLEXPORT extern “C” #endif [/code] 次にビルドする際は、<strong>CMakeLists.txt</strong>のようなビルドの手順を示した</p><ul><li>Android.mk</li><li>Application.mk</li></ul><p>ファイルを用意します。 <strong>Application.mk</strong> [code] APP_PROJECT_PATH := $(NDK_PROJECT_PATH) APP_BUILD_SCRIPT := $(APP_PROJECT_PATH)/src/Android.mk [/code] <strong>Android.mk</strong> [code] LOCAL_PATH := $(call my-dir)<br>include $(CLEAR_VARS)<br>LOCAL_MODULE := PInvokeApp.Native LOCAL_SRC_FILES := calc.cpp<br>include $(BUILD_SHARED_LIBRARY) [/code] これらを下記のような構成で展開します。 [code lang=”cmd”] │ Application.mk │ └─src Android.mk calc.cpp calc.h export.h [/code] ここで、<strong>Application.mk</strong>にカレントディレクトリを移動して、下記のコマンドを実行することで、ライブラリが生成されます。 [code lang=”cmd”] $ ndk-build NDK_PROJECT_PATH=%cd% NDK_APPLICATION_MK=Application.mk Android NDK: APP_PLATFORM not set. Defaulting to minimum supported version android-14. [arm64-v8a] Compile++ : PInvokeApp.Native &lt;= calc.cpp [arm64-v8a] SharedLibrary : libPInvokeApp.Native.so [arm64-v8a] Install : libPInvokeApp.Native.so =&gt; libs/arm64-v8a/libPInvokeApp.Native.so [armeabi-v7a] Compile++ thumb: PInvokeApp.Native &lt;= calc.cpp [armeabi-v7a] SharedLibrary : libPInvokeApp.Native.so [armeabi-v7a] Install : libPInvokeApp.Native.so =&gt; libs/armeabi-v7a/libPInvokeApp.Native.so [x86] Compile++ : PInvokeApp.Native &lt;= calc.cpp [x86] SharedLibrary : libPInvokeApp.Native.so [x86] Install : libPInvokeApp.Native.so =&gt; libs/x86/libPInvokeApp.Native.so [x86_64] Compile++ : PInvokeApp.Native &lt;= calc.cpp [x86_64] SharedLibrary : libPInvokeApp.Native.so [x86_64] Install : libPInvokeApp.Native.so =&gt; libs/x86_64/libPInvokeApp.Native.so [/code] libsフォルダにアーキテクチャ毎にライブラリが生成されます。</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> android </category>
          
          <category> NDK </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その124 64bitのRHELで32bitでソースをビルドする</title>
      <link href="/2018/05/20/3074/"/>
      <url>/2018/05/20/3074/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 簡単にできると思ったんですが、手こずったので…. 何をやっても [code lang=”sh”] /usr/bin/ld: crti.o が見つかりません: No such file or directory /usr/bin/ld: 互換性のないを /usr/lib/gcc/x86_64-redhat-linux/7/libstdc++.so スキップしました (-lstdc++ を探索している時)/usr/bin/ld: -lstdc++ が見つかりません /usr/bin/ld: -lm が見つかりません /usr/bin/ld: -lc が見つかりません /usr/bin/ld: crtn.o が見つかりません: No such file or directory collect2: エラー: ld はステータス 1 で終了しました [/code] こんな感じで、お手上げでした。</p><h1 id="How"><a href="#How" class="headerlink" title="How?"></a>How?</h1><p>下の記事に答えが書いてありました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://a4dosanddos.hatenablog.com/entry/2015/09/19/131052" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=a4dosanddos.hatenablog.com"></img><div class="hbc-site-name">プログラム日記</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/12704830469096426815/6653458415121891862/1442635852"></img></div><div class="hbc-text"><div class="hbc-title">「C」64bit のGCC で 32bit アプリケーションを作成する環境構築 ( CentOS 6.4 ) - プログラム日記</div><div class="hbc-url">http://a4dosanddos.hatenablog.com/entry/2015/09/19/131052</div><div class="hbc-description">64bit のGCC で 32bit アプリケーションを作成する環境構築のメモです。まぁ、やることとしては、以下のページに記載の通りに glibc-devel.i686 glibc-devel libstdc++-devel.i686 パッケージを yum でインストールするだけ…</div></div></div></div></a></div></div><p>[code lang=”sh”] $ yum -y install glibc-devel.i686 glibc-devel libstdc++-devel.i686 [/code] で良かったです。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その123 macOS 10.13 High Sierra にアップデートしたらxcrun: error: invalid active developer pathエラー</title>
      <link href="/2018/05/19/3061/"/>
      <url>/2018/05/19/3061/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>掲題の通り。ただの備忘録です。 何でアップデートしただけで既存のコマンドが動かないんですかねぇ(白目)<br><a href="../../../../public/2018/05/mac.png"><img src="../../../../public/2018/05/mac.png"></a></p><h1 id="How-to-resolve"><a href="#How-to-resolve" class="headerlink" title="How to resolve"></a>How to resolve</h1><p><strong>StackExchange</strong>に回答がありました。 </p><p>[code lang=”sh”] $ xcode-select –install [/code] 下記のダイアログが表示されるので<strong>インストール</strong>を選択。<br><a href="../../../../public/2018/05/mac-1.png"><img src="../../../../public/2018/05/mac-1.png"></a></p><p><strong>同意する</strong>を選択。<br><a href="../../../../public/2018/05/mac-2.png"><img src="../../../../public/2018/05/mac-2.png"></a></p><p>ダウンロードが始まります。<br><a href="../../../../public/2018/05/mac-3.png"><img src="../../../../public/2018/05/mac-3.png"></a></p><p>インストールが完了。<br><a href="../../../../public/2018/05/mac-4.png"><img src="../../../../public/2018/05/mac-4.png"></a></p><p>これで既存のコマンドが動くようになります。<br><a href="../../../../public/2018/05/mac-5.png"><img src="../../../../public/2018/05/mac-5.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Apple </category>
          
          <category> Mac </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その122 TensorFlowをCUDA 9.1 + CuDNN 7 on Windowsでビルドする</title>
      <link href="/2018/05/13/3028/"/>
      <url>/2018/05/13/3028/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>公式バイナリでもよいのですが、自分でビルドしたのでメモです。 <strong>CMake</strong>でビルドします。 なお、<strong>Visual Studio 2015</strong>が必要です。2017では<strong>ビルドできませんでした。</strong> あと、ビルドにすごい時間がかかります。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>まず必要なものをダウンロードして、インストールまたは展開します。</p><h2 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h2><p>PATHを通しておきます。</p><h2 id="CUDA-9-1"><a href="#CUDA-9-1" class="headerlink" title="CUDA 9.1"></a>CUDA 9.1</h2><p><a href="https://developer.nvidia.com/cuda-toolkit">CUDA Toolkit</a>から環境に適応したインストーラをダウンロードします。</p><h2 id="CuDNN-7"><a href="#CuDNN-7" class="headerlink" title="CuDNN 7"></a>CuDNN 7</h2><p><a href="https://developer.nvidia.com/cudnn">NVIDIA cuDNN</a>から環境に適応したバイナリをダウンロードします。 なおダウンロードには登録が必要です。 また、<strong>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.1</strong>に展開する必要はありません。 自由にディレクトリに展開しておくことができます。</p><h2 id="Python-3-6"><a href="#Python-3-6" class="headerlink" title="Python 3.6"></a>Python 3.6</h2><p>自分の環境では、<strong>Visual Studio 2017</strong>でインストールした<strong>Anaconda</strong>が入っていますので、これでPythonに対応します。</p><h2 id="SWIGWIN"><a href="#SWIGWIN" class="headerlink" title="SWIGWIN"></a>SWIGWIN</h2><p><a href="http://www.swig.org/">公式ページ</a>のDownloadから入手します。 SWIGとSWIGWINがあるので間違いないように。</p><h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><p>これもPATHが通っている必要があります。 <a href="https://gitforwindows.org/">Git for Windows</a>をインストールしておくのが無難です。</p><h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>まず、<strong><em>tensorflow\contrib\cmake\CMakeLists.txt</em></strong> を開きます。 40行目を [code lang=”diff”] - set(tensorflow_CUDA_VERSION “9.0” CACHE STRING “CUDA version to build against”) + set(tensorflow_CUDA_VERSION “9.1” CACHE STRING “CUDA version to build against”) [/code] このように変更します。 これで準備は完了です。 あとは、<strong><em>tensorflow\contrib\cmake</em></strong>に移動してCMakeをたたくだけです。 少しコマンドが長いですが… [code lang=”cmd”] # \ は / に変更しておく $ set SWIG_EXE=”D:/Works/Lib/SWIG/Windows/3.0.12/swig.exe” $ set PYTHON_EXECUTABLE_64=”C:/Program Files (x86)/Microsoft Visual Studio/Shared/Python36_64/python.exe” $ set PYTHON_LIBRARIES_64=”C:/Program Files (x86)/Microsoft Visual Studio/Shared/Python36_64/libs/python36.lib” $ set NUMPY_INCLUDE_DIR=”C:/Program Files (x86)/Microsoft Visual Studio/Shared/Anaconda3_64/Lib/site-packages/numpy/core/include” $ set CUDNN_HOME=”D:/Works/Lib/NVIDIA/cuDNN/9.1/7.0/Win10”<br>$ cd tensorflow\contrib\cmake $ mkdir build $ cd build $ cmake -G “Visual Studio 14 2015 Win64” ^ -D tensorflow_CUDA_VERSION=9.1 ^ -D tensorflow_WIN_CPU_SIMD_OPTIONS=/arch:AVX2 ^ -D SWIG_EXECUTABLE=%SWIG_EXE% ^ -D PYTHON_EXECUTABLE=”%PYTHON_EXECUTABLE_64%” ^ -D PYTHON_LIBRARIES=”%PYTHON_LIBRARIES_64%” ^ -D NUMPY_INCLUDE_DIR=”%NUMPY_INCLUDE_DIR%” ^ -D tensorflow_ENABLE_GPU=ON ^ -D tensorflow_BUILD_SHARED_LIB=ON ^ -D CUDNN_HOME=”%CUDNN_HOME%” ^ .. [/code] ここでビルド前に生成されるプロジェクトファイルに手を加えます。 具体的には、ビルド中に生成されるlibファイルをリンクしているプロジェクトがあるのですが、そのリンクパスが間違っているため、ビルドが途中で停止します。 下記に情報がありました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qiita.com/soyiharu/items/098056897d6206da48b7" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3D%25E3%2580%2590windows%25E3%2580%2591AVX2%25E3%2582%2592%25E6%259C%2589%25E5%258A%25B9%25E3%2581%25AB%25E3%2581%2597%25E3%2581%25A6Tensorflow%25E3%2582%2592%25E3%2583%2593%25E3%2583%25AB%25E3%2583%2589%25E3%2581%2599%25E3%2582%258B%2528GPU%25E3%2581%25AA%25E3%2581%2597%2529%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3Db7b6639ee6bf9b10aca3951241b539de&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540soyiharu%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3Df8f5be9cc72877a69ca3a24d9458ac96&blend-align=center%2Cmiddle&blend-mode=normal&s=2598d6f9fca7c72345ca1f562908d09c"></img></div><div class="hbc-text"><div class="hbc-title">【windows】AVX2を有効にしてTensorflowをビルドする(GPUなし) - Qiita</div><div class="hbc-url">https://qiita.com/soyiharu/items/098056897d6206da48b7</div><div class="hbc-description">概要タイトルの通りです。widnows環境でcmakeの方でtensorflowをビルドします。その時にいろいろと小技が必要だったので、その内容を備忘録的に書いておきます。注意点公式バイナリでもSSEやAVX...</div></div></div></div></a></div></div><p>修正対象は下記のプロジェクトファイル。</p><ul><li>_beam_search_ops.vcxproj</li><li>_gru_ops.vcxproj</li><li>_lstm_ops.vcxproj</li><li>_nearest_neighbor_ops.vcxproj</li><li>_periodic_resample_op.vcxproj</li></ul><p>修正内容は、 [code lang=”diff”] - <AdditionalDependencies>\pywrap_tensorflow_internal.lib + <AdditionalDependencies>Release\pywrap_tensorflow_internal.lib [/code] になります。 修正後は下記のコマンドでビルドを開始します。 [code lang=”cmd”] $ cmake –build . –config Release [/code] これでビルドが通ります。 が、前にも書いたように、すごく時間がかかります。 <strong>i7 8700K</strong>、<strong>32GB</strong>の環境でも、2時間から3時間もビルドに時間がかかりました… 上記の設定でビルドすると、<strong>Release</strong>フォルダに、</p><ul><li>tensorflow.dll</li><li>tensorflow.lib</li><li>tensorflow_static.lib</li></ul><p>を含む大量のバイナリが生成されます。</p><h2 id="Why-using-Visual-Studio-2015"><a href="#Why-using-Visual-Studio-2015" class="headerlink" title="Why using Visual Studio 2015?"></a>Why using Visual Studio 2015?</h2><p>2017を使うと下記のエラーが出てビルドがうまくいきませんでした。 [code lang=”cmd”] Found CUDA: C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v9.1 (found suitable exact version “9.1”) CMake Error at CMakeLists.txt:322 (message): Selected compiler (or version) is not supported for CUDA [/code] 調べたところ、下記の記事を見つけました。 </p><p>この中で、 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://devtalk.nvidia.com/default/topic/1027299/cuda-setup-and-installation/cuda-9-failed-to-support-the-latest-visual-studio-2017-version-15-5/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=devtalk.nvidia.com"></img><div class="hbc-site-name">NVIDIA Developer Forums</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://aws1.discourse-cdn.com/nvidia/original/2X/8/8f17cc8f1a724d6ecea8a197a267ec8a05ef1490.png"></img></div><div class="hbc-text"><div class="hbc-title">CUDA 9 failed to support the latest Visual Studio 2017 version 15.5</div><div class="hbc-url">https://devtalk.nvidia.com/default/topic/1027299/cuda-setup-and-installation/cuda-9-failed-to-support-the-latest-visual-studio-2017-version-15-5/</div><div class="hbc-description">Once I upgraded by Visual Studio 2017 to version 15.5 (https://www.visualstudio.com/en-us/news/releasenotes/vs2017-relnotes) CUDA stops work…</div></div></div></div></a></div></div><p>というVisual Studio 2017 15.5でCUDAが停止する、というNvidiaのコミュニティへのリンクがあります。 詳細は続報待ちですが、2015に変えたら動いたのでそういうものだと捉えておきます。</p><h2 id="Why-specify-Numpy-dir"><a href="#Why-specify-Numpy-dir" class="headerlink" title="Why specify Numpy dir?"></a>Why specify Numpy dir?</h2><p>下記のエラーが出てビルドがうまくいきませんでした。 [code lang=”cmd”] Cannot get NumPy include directory: Is NumPy installed? [/code] <strong>CMakeList.txt</strong>を解析していくと、<strong>NUMPY_INCLUDE_DIR</strong>変数を参照していたので、CMakeの引数で指定することで明示的に指定したわけです。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> gpupu </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
          <category> TensorFlow </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その121 OSSの資産管理WebアプリSnipe-ITをDockerで使う</title>
      <link href="/2018/05/13/3039/"/>
      <url>/2018/05/13/3039/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>IT会社にいると、大なり小なり資産の管理作業が発生します。 自分のグループだけでもかなりの資産がありますが、それをExcelで管理していて辛い状況です。 そんな中、資産管理のWebアプリでよさげなアプリが、OSSかつDockerで提供していたの導入してみました。 ちなみに、Windows 10での<strong>Docker for Windows</strong>環境です。</p><h1 id="Get-started"><a href="#Get-started" class="headerlink" title="Get started!!"></a>Get started!!</h1><p>インストール手順は下記に書いてありますが、ちょっと分かりにくいです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://snipe-it.readme.io/docs/docker" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=snipe-it.readme.io"></img><div class="hbc-site-name">Snipe-IT Documentation</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Docker</div><div class="hbc-url">https://snipe-it.readme.io/docs/docker</div><div class="hbc-description">Docker is a very popular software containerization platform. While it&#39;s not difficult to use, it can be a little confusing for folks who are…</div></div></div></div></a></div></div><h2 id="1-設定ファイルの用意"><a href="#1-設定ファイルの用意" class="headerlink" title="1. 設定ファイルの用意"></a>1. 設定ファイルの用意</h2><p>下記のようなテキストファイルを用意します。 [code] # Mysql Parameters MYSQL_ROOT_PASSWORD=password MYSQL_DATABASE=snipeit MYSQL_USER=snipeit MYSQL_PASSWORD=password<br># Email Parameters # - the hostname/IP address of your mailserver MAIL_PORT_587_TCP_ADDR=smtp.whatever.com #the port for the mailserver (probably 587, could be another) MAIL_PORT_587_TCP_PORT=587 # the default from address, and from name for emails MAIL_ENV_FROM_ADDR=youremail@yourdomain.com MAIL_ENV_FROM_NAME=John Doe # - pick ‘tls’ for SMTP-over-SSL, ‘tcp’ for unencrypted MAIL_ENV_ENCRYPTION=tcp # SMTP username and password MAIL_ENV_USERNAME=your_email_username MAIL_ENV_PASSWORD=your_email_password<br># Snipe-IT Settings APP_ENV=production APP_DEBUG=false APP_KEY=★後から設定★ APP_URL=<a href="http://127.0.0.1/">http://127.0.0.1:80</a> APP_TIMEZONE=’Asia/Tokyo’ APP_LOCALE=ja [/code] このファイルのパスを、ここでは<strong>D:\VirtualMachines\Docker\volume\snipe-it\env.txt</strong>として保存します。任意の場所でよいです。</p><h2 id="2-データベースコンテナの用意"><a href="#2-データベースコンテナの用意" class="headerlink" title="2. データベースコンテナの用意"></a>2. データベースコンテナの用意</h2><p>次に、データの保存先であるデータベースのコンテナを用意します。 データベースのファイルはホスト側に保存しますので、ディレクトリをあらかじめ用意しておきます。 ここでは、<strong>D:\VirtualMachines\Docker\volume\snipe-it\mysql</strong>がデータベースファイルの格納先とします。 下記がデータベース用のコンテナです。 [code lang=”cmd”] $ docker run –privileged –name snipe-mysql –env-file=D:/VirtualMachines/Docker/volume/snipe-it/env.txt -v D:/VirtualMachines/Docker/volume/snipe-it/mysql/:/var/lib/mysql -d -P mysql:5.6 [/code]</p><h2 id="3-APP-KEYの取得"><a href="#3-APP-KEYの取得" class="headerlink" title="3. APP_KEYの取得"></a>3. APP_KEYの取得</h2><p>先のテキストファイルに<strong>★後から設定★</strong>と書かれていた値を取得します。 [code lang=”cmd”] $ docker run –rm snipe/snipe-it:latest Please re-run this container with an environment variable $APP_KEY An example APP_KEY you could use is: base64:kzzSXbSsFtAtbvhGYrp9M3H0WeJGHrw3385xy5PAXP4= [/code] この<strong>base64:xxxxxxxxxxxxxxxxxxxxxxxxxxxxx</strong>という部分を先のテキストファイルに貼り付けます。 つまり下記のようになります。 [code] APP_KEY=base64:kzzSXbSsFtAtbvhGYrp9M3H0WeJGHrw3385xy5PAXP4= [/code]</p><h2 id="4-Snipe-ITの起動"><a href="#4-Snipe-ITの起動" class="headerlink" title="4.Snipe-ITの起動"></a>4.Snipe-ITの起動</h2><p>最後にSnipe-ITそのもののコンテナを作成します。 ここでも設定などをホスト側に作成するので、ディレクトリをあらかじめ用意しておきます。 ここでは、<strong>D:\VirtualMachines\Docker\volume\snipe-it</strong>とします。 下記がコンテナ作成のコマンドです。 ホスト側のポート番号9001は自由に変えてもらって結構です。 [code lang=”cmd”] $ docker run -d -p 9001:80 –privileged –name=”snipe-it” –link snipe-mysql:mysql –env-file=D:/VirtualMachines/Docker/volume/snipe-it/env.txt -v D:/VirtualMachines/Docker/volume/snipe-it/:/var/lib/snipeit snipe/snipe-it:latest [/code] これでWebからアクセスできますが、このままだと動きません。 情報が見当たらなかったのですが、必要なフォルダとファイルが作られていないため、データベースを作る際にエラーになってしまうので、下記のコマンドで回避します。 [code lang=”cmd”] $ docker exec -it snipe-it /bin/bash $ mkdir /var/lib/snipeit/keys $ echo -n &gt; /var/lib/snipeit/keys/oauth-private.key $ echo -n &gt; /var/lib/snipeit/keys/oauth-public.key [/code]</p><h2 id="5-セットアップ"><a href="#5-セットアップ" class="headerlink" title="5.セットアップ"></a>5.セットアップ</h2><p><a href="../../../../public/2018/05/1.png"><img src="../../../../public/2018/05/1.png"></a> <strong>Next: Create Database Tables</strong> をクリック <a href="../../../../public/2018/05/2.png"><img src="../../../../public/2018/05/2.png"></a> <strong>Next: Create User</strong> をクリック <a href="../../../../public/2018/05/3.png"><img src="../../../../public/2018/05/3-901x1024.png"></a> 必要な情報を入力して、<strong>Next: Save User</strong> をクリック <a href="../../../../public/2018/05/4.png"><img src="../../../../public/2018/05/4.png"></a><br> セットアップ終了!!</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> IT資産管理 </category>
          
          <category> it%e8%b3%87%e7%94%a3%e7%ae%a1%e7%90%86 </category>
          
          <category> Snipe-IT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その120 TensorFlowをnvidia docker on Ubuntu 18.04にインストールする</title>
      <link href="/2018/05/06/3006/"/>
      <url>/2018/05/06/3006/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>darknet</strong>に引き続き<strong>TensorFlow</strong>もインストールしてみます。 いつも思うのですが、フレームワークを知っているのと、インストールして試しに使ってみるだけでも大分違うと思います。 インストールした後に+αで何かできたらもっとよいですが。</p><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>公式ページにすべて手順が書いてあります。 Pythonにインストールするよ、ってことで特に難しいことはないと思います。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.tensorflow.org/install/install_linux" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.tensorflow.org"></img><div class="hbc-site-name">TensorFlow</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://www.tensorflow.org/images/tf_logo_social.png"></img></div><div class="hbc-text"><div class="hbc-title">Install TensorFlow 2</div><div class="hbc-url">https://www.tensorflow.org/install/install_linux</div><div class="hbc-description">Learn how to install TensorFlow on your system. Download a pip package, run in a Docker container, or build from source. Enable the GPU on s…</div></div></div></div></a></div></div><p>ただ、Pythonを使うといっても、インストール先は</p><ul><li>Virtualenv</li><li>“native” pip</li><li>Docker</li><li>Anaconda</li></ul><p>と複数用意されています。 今回は<strong>Docker</strong>を使います。</p><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>気をつけることもないですが、<strong>DockerHub</strong>の<a href="https://hub.docker.com/r/tensorflow/tensorflow/tags/">TensorFlowイメージ</a>はタグを含めてたくさんあります。 タグは主に</p><ul><li>(version)-devel-gpu-py3<ul><li>ビルドに必要なソースコートや依存バイナリ付きのPython3用GPU対応版</li></ul></li><li>(version)-devel-gpu<ul><li>ビルドに必要なソースコートや依存バイナリ付きのPython2用GPU対応版</li></ul></li><li>(version)-devel-py3<ul><li>ビルドに必要なソースコートや依存バイナリ付きのPython3用CPU対応版</li></ul></li><li>(version)-devel<ul><li>ビルドに必要なソースコートや依存バイナリ付きのPython2用CPU対応版</li></ul></li><li>(version)-gpu-py3<ul><li>Python3用GPU対応版</li></ul></li><li>(version)-gpu<ul><li>Python2用GPU対応版</li></ul></li><li>(version)-py3<ul><li>Python3用CPU対応版</li></ul></li><li>(version)<ul><li>Python2用CPU対応版</li></ul></li></ul><p>の8種類があります。 <strong>(version)</strong> は、<strong>latest</strong>、<strong>nightly</strong>、バージョン番号があります。 個人的には、latestを選ぶと、このバージョンいくつだっけ?っことになってわからなくなるのであまり好きではありません。 2018/05/05時点の最新のTensorFlowは1.8です。 なので、1.8を使います。 下記コマンドで、イメージをpullし、コンテナに入ります。 [code lang=”sh”] $ sudo nvidia-docker run –rm -it tensorflow/tensorflow:1.8.0-gpu-py3 /bin/bash [/code] コンテナに入った後です。 [code lang=”sh”] $ python -m pip freeze | grep tensor $ tensorboard==1.8.0 $ tensorflow-gpu==1.8.0 [/code] TensorFlowのGPU版と<strong>TensorBoard</strong>がインストールされているのがわかります。 <strong>TensorBoard</strong>は深層学習の状況などを可視化できるWebコンソールです。 これを確認するには、コンテナのポートを開く必要があります。 ですので、下記のようにコンテナを再実行し、TensorBoardを起動します。ホスト側のポート番号は自由ですが、コンテナ側は6006にします。 [code lang=”sh”] $ sudo nvidia-docker run –rm -p 6006:6006 -it tensorflow/tensorflow:1.8.0-gpu-py3 /bin/bash [/code]</p><h2 id="Test-MNIST"><a href="#Test-MNIST" class="headerlink" title="Test MNIST"></a>Test MNIST</h2><p>おなじみのMNISTのサンプルがgithubにありますのでありがたく使わせてもらいます。 </p><p>このサンプルは、mnistの学習結果をTensorBoardで確認できるように出力してくれます。 使い方は下記です。 [code lang=”sh”] # wget はインストールされていないのでインストール $ apt-get update $ apt-get install wget $ wget <a href="https://raw.githubusercontent.com/tensorflow/tensorflow/master/tensorflow/examples/tutorials/mnist/mnist/_with/_summaries.py">https://raw.githubusercontent.com/tensorflow/tensorflow/master/tensorflow/examples/tutorials/mnist/mnist\_with\_summaries.py</a> $ mkdir /var/log/tensorflow $ python mnist_with_summaries.py –log_dir=/var/log/tensorflow [/code] 実行後、別のコンソールから学習中のコンテナに接続し、下記コマンドを実行します。 [code lang=”sh”] $ sudo docker ps | grep tensor # コンテナIDを確認 073300c20aec tensorflow/tensorflow:1.8.0-gpu-py3 “/bin/bash” 20 minutes ago Up 20 minutes 0.0.0.0:6006-&gt;6006/tcp, 8888/tcp reverent_spence # sudo docker attach だと既に動いている学習中のセッションにつながるため exec で繋ぐ $ sudo docker exec -it 073300c20aec /bin/bash<br># コンテナの中 # 前段で実行した python に渡した引数と同じ場所を指定 $ tensorboard –logdir /var/log/tensorflow [/code] TensorBoardが起動するので、ブラウザからホストOSのポートにアクセスします。 <strong>学習初期</strong><br><a href="../../../../public/2018/05/screencapture-192-168-11-21-6006-2018-05-05-23_22_36.png"><img src="../../../../public/2018/05/screencapture-192-168-11-21-6006-2018-05-05-23_22_36-1024x564.png"></a> <strong>学習終了</strong> <a href="../../../../public/2018/05/screencapture-192-168-11-21-6006-2018-05-05-23_10_47.png"><img src="../../../../public/2018/05/screencapture-192-168-11-21-6006-2018-05-05-23_10_47-1024x564.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> gpupu </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
          <category> TensorFlow </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その119 YOLOv3をnvidia docker on Ubuntu 18.04で動かす</title>
      <link href="/2018/05/05/3007/"/>
      <url>/2018/05/05/3007/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>nvidia docker</strong>を使えるようになったので、Ubuntuでも<strong>YOLOv3</strong>を試してみます。</p><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>今回は、自分で<strong>DockerHub</strong>にイメージをpushしてみました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://hub.docker.com/[object Object]olo-darknet/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=hub.docker.com"></img><div class="hbc-site-name">hub.docker.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Docker Hub</div><div class="hbc-url">https://hub.docker.com/[object Object]olo-darknet/</div></div></div></div></a></div></div><p><strong>dockerfile</strong>もgithubに登録してあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/blob/master/Dockerfiles/yolo-darknet/9.1-cudnn7-devel-ubuntu16.04/Dockerfile" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/blob/master/Dockerfiles/yolo-darknet/9.1-cudnn7-devel-ubuntu16.04/Dockerfile</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>dockerfileの中身はシンプルに</p><ol><li>apt-getで必要なバイナリ収集</li><li>OpenCVをビルドしてインストール</li><li>darknetのビルド</li></ol><p>を行っています。 下記のコマンドで、イメージをpullし、コンテナに入れます。 実行後は、コンテナは破棄されます。 [code lang=”sh”] $ sudo nvidia-docker run –rm -i -t takuyatakeuchi/yolo-darknet:9.1-cudnn7-devel-ubuntu16.04 /bin/bash [/code] コンテナに入ったら、weightファイルを拾ってきて、実行します。 [code lang=”sh”] $ cd /tmp/darknet $ wget wget <a href="https://pjreddie.com/media/files/yolov3.weights">https://pjreddie.com/media/files/yolov3.weights</a> $ /darknet detect cfg/yolov3.cfg yolov3.weights data/dog.jpg layer filters size input output 0 conv 32 3 x 3 / 1 416 x 416 x 3 -&gt; 416 x 416 x 32 0.299 BFLOPs 1 conv 64 3 x 3 / 2 416 x 416 x 32 -&gt; 208 x 208 x 64 1.595 BFLOPs 2 conv 32 1 x 1 / 1 208 x 208 x 64 -&gt; 208 x 208 x 32 0.177 BFLOPs 3 conv 64 3 x 3 / 1 208 x 208 x 32 -&gt; 208 x 208 x 64 1.595 BFLOPs 4 res 1 208 x 208 x 64 -&gt; 208 x 208 x 64 5 conv 128 3 x 3 / 2 208 x 208 x 64 -&gt; 104 x 104 x 128 1.595 BFLOPs 6 conv 64 1 x 1 / 1 104 x 104 x 128 -&gt; 104 x 104 x 64 0.177 BFLOPs 7 conv 128 3 x 3 / 1 104 x 104 x 64 -&gt; 104 x 104 x 128 1.595 BFLOPs 8 res 5 104 x 104 x 128 -&gt; 104 x 104 x 128 9 conv 64 1 x 1 / 1 104 x 104 x 128 -&gt; 104 x 104 x 64 0.177 BFLOPs 10 conv 128 3 x 3 / 1 104 x 104 x 64 -&gt; 104 x 104 x 128 1.595 BFLOPs 11 res 8 104 x 104 x 128 -&gt; 104 x 104 x 128 12 conv 256 3 x 3 / 2 104 x 104 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 13 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 14 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 15 res 12 52 x 52 x 256 -&gt; 52 x 52 x 256 16 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 17 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 18 res 15 52 x 52 x 256 -&gt; 52 x 52 x 256 19 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 20 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 21 res 18 52 x 52 x 256 -&gt; 52 x 52 x 256 22 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 23 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 24 res 21 52 x 52 x 256 -&gt; 52 x 52 x 256 25 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 26 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 27 res 24 52 x 52 x 256 -&gt; 52 x 52 x 256 28 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 29 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 30 res 27 52 x 52 x 256 -&gt; 52 x 52 x 256 31 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 32 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 33 res 30 52 x 52 x 256 -&gt; 52 x 52 x 256 34 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 35 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 36 res 33 52 x 52 x 256 -&gt; 52 x 52 x 256 37 conv 512 3 x 3 / 2 52 x 52 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 38 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 39 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 40 res 37 26 x 26 x 512 -&gt; 26 x 26 x 512 41 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 42 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 43 res 40 26 x 26 x 512 -&gt; 26 x 26 x 512 44 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 45 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 46 res 43 26 x 26 x 512 -&gt; 26 x 26 x 512 47 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 48 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 49 res 46 26 x 26 x 512 -&gt; 26 x 26 x 512 50 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 51 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 52 res 49 26 x 26 x 512 -&gt; 26 x 26 x 512 53 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 54 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 55 res 52 26 x 26 x 512 -&gt; 26 x 26 x 512 56 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 57 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 58 res 55 26 x 26 x 512 -&gt; 26 x 26 x 512 59 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 60 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 61 res 58 26 x 26 x 512 -&gt; 26 x 26 x 512 62 conv 1024 3 x 3 / 2 26 x 26 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 63 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 0.177 BFLOPs 64 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 65 res 62 13 x 13 x1024 -&gt; 13 x 13 x1024 66 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 0.177 BFLOPs 67 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 68 res 65 13 x 13 x1024 -&gt; 13 x 13 x1024 69 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 0.177 BFLOPs 70 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 71 res 68 13 x 13 x1024 -&gt; 13 x 13 x1024 72 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 0.177 BFLOPs 73 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 74 res 71 13 x 13 x1024 -&gt; 13 x 13 x1024 75 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 0.177 BFLOPs 76 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 77 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 0.177 BFLOPs 78 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 79 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 0.177 BFLOPs 80 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 1.595 BFLOPs 81 conv 255 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 255 0.088 BFLOPs 82 detection 83 route 79 84 conv 256 1 x 1 / 1 13 x 13 x 512 -&gt; 13 x 13 x 256 0.044 BFLOPs 85 upsample 2x 13 x 13 x 256 -&gt; 26 x 26 x 256 86 route 85 61 87 conv 256 1 x 1 / 1 26 x 26 x 768 -&gt; 26 x 26 x 256 0.266 BFLOPs 88 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 89 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 90 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 91 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 0.177 BFLOPs 92 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 1.595 BFLOPs 93 conv 255 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 255 0.177 BFLOPs 94 detection 95 route 91 96 conv 128 1 x 1 / 1 26 x 26 x 256 -&gt; 26 x 26 x 128 0.044 BFLOPs 97 upsample 2x 26 x 26 x 128 -&gt; 52 x 52 x 128 98 route 97 36 99 conv 128 1 x 1 / 1 52 x 52 x 384 -&gt; 52 x 52 x 128 0.266 BFLOPs 100 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 101 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 102 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 103 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 0.177 BFLOPs 104 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 1.595 BFLOPs 105 conv 255 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 255 0.353 BFLOPs 106 detection Loading weights from yolov3.weights…Done! data/dog.jpg: Predicted in 0.028881 seconds. dog: 99% truck: 93% bicycle: 99%<br>(predictions:21): Gtk-WARNING **: cannot open display: [/code] Windows版と遜色ない性能です。 Docker経由でも性能は変わりません。 CUIでの実行なので、本来はOpenCV経由で画像が画面に表示されますが、それはエラーになっています。 ただし、出力結果はディスクに<strong>predictions.jpg</strong>として出力されていますので確認できます。 <strong>scp</strong>コマンドで画像ファイルを転送するなりして確認します。 [code lang=”sh”] $ scp ./predictions.jpg XXXX@:~ [/code]<br><a href="../../../../public/2018/05/predictions.jpg"><img src="../../../../public/2018/05/predictions.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> gpupu </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
          <category> Darknet </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで機械学習を試してみる LibLinear.Net編 第1回</title>
      <link href="/2018/05/04/3000/"/>
      <url>/2018/05/04/3000/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>以前、<strong>LIBSVM</strong>という台湾生まれのSVMライブラリのC#ラッパーを作成しました。 今回、同じ台湾生まれの<strong>LIVLINEAR</strong>のC#ラッパー<strong>LibLinear.Net</strong>を作成しました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/LibLinearDotNet" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/LibLinearDotNet</div><div class="hbc-url">https://github.com/takuya-takeuchi/LibLinearDotNet</div><div class="hbc-description">.NET wrapper for LIBLINEAR written in C#. Contribute to takuya-takeuchi/LibLinearDotNet development by creating an account on GitHub.</div></div></div></div></a></div></div><p>LIVLINEARのライブラリも.NETラッパーは少ない感じです。</p><ul><li><a href="https://github.com/aardvark-platform/aardvark.semantictextonforests">libsvm.clr</a><ul><li>C++/CLIでLIBLINEARを再ビルドして.NETから呼べるようにしています。</li></ul></li></ul><p>めぼしいのはこれ位でした。 LibSvm.Netと同じく、</p><ul><li>XMLコメントほぼ全て英語と日本語で実装していますので、IntelliSenseがバリバリ</li><li>100%C#の.NETStandard準拠</li><li>Linuxで動く</li></ul><p>そして、前回と同じサンプルをLibLinear.Netで実装したものを持ってきました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/LibLinearDotNet</div><div class="hbc-url">https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits</div><div class="hbc-description">.NET wrapper for LIBLINEAR written in C#. Contribute to takuya-takeuchi/LibLinearDotNet development by creating an account on GitHub.</div></div></div></div></a></div></div><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>LibSvm.Netを使うには下記の作業が必要です。</p><p>1. NugetからLibLinear.Netのインストール</p><p>2. LIBLINEARのソースをダウンロード</p><p>3. LIBLINEARのソースをビルド</p><p>ちょっと面倒ですが、どれも手順はしっかりしています。 LIBLINEARのビルド手順はLibLinear.Netの<a href="https://github.com/takuya-takeuchi/LibLinearDotNet/wiki/Tutorial-for-Windows">Wikiでも説明しています</a>ので参考にしてください。</p><h1 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h1><p>[code lang=”csharp”] using System; using System.Diagnostics; using System.Linq; using LibLinearDotNet; using Microsoft.Extensions.CommandLineUtils;<br>namespace Pendigits {<br>internal class Program {<br>private static void Main(string[] args) { var app = new CommandLineApplication(false); app.Name = nameof(Pendigits); app.Description = “The exsample program for pendigits”; app.HelpOption(“-h|–help”);<br>var quietArgument = app.Argument(“quiet”, “Suppress output of LIBLINEAR”); var outputOption = app.Option(“-o|–output”, “output path for trained model”, CommandOptionType.SingleValue); var solverOption = app.Option(“-s|–solver”, “solver”, CommandOptionType.SingleValue); var biasOption = app.Option(“-b|–bias”, “bias”, CommandOptionType.SingleValue);<br>app.OnExecute(() =&gt; { if (quietArgument.Value != null) LibLinear.SetPrintFunction(null);<br>var biasStr = “-1”; if (biasOption.HasValue()) biasStr = biasOption.Value();<br>if (!double.TryParse(biasStr, out var bias)) { app.ShowHelp(); return -1; }<br>var solverStr = “1”; if (solverOption.HasValue()) solverStr = solverOption.Value();<br>if (!int.TryParse(solverStr, out var solver)) { app.ShowHelp(); return -1; }<br>if (Enum.GetValues(typeof(SolverType)).Cast<int>().All(s =&gt; s != solver)) { app.ShowHelp(); return -1; }<br>var sol = (SolverType)solver;<br>double eps = 0; switch (sol) { case SolverType.L2RegularizedLogisticRegression: case SolverType.L2RegularizedL2LossSupportVectorClassification: eps = 0.01; break; case SolverType.L2RegularizedL2LossSupportVectorRegression: eps = 0.001; break; case SolverType.L2RegularizedL2LossSupportVectorClassificationDual: case SolverType.L2RegularizedL1LossSupportVectorClassificationDual: case SolverType.MulticlassSupportVectorMachineCrammerSinger: case SolverType.L2RegularizedLogisticRegressionDual: eps = 0.1; break; case SolverType.L1RegularizedL2LossSupportVectorClassification: case SolverType.L1RegularizedLogisticRegression: eps = 0.01; break; case SolverType.L2RegularizedL2LossSupportVectorRegressionDual: case SolverType.L2RegularizedL1LossSupportVectorRegressionDual: eps = 0.1; break; }<br>var output = outputOption.Value();<br>// Load training data and test data set using (var train = Problem.FromFile(“pendigits”, bias)) using (var test = Problem.FromFile(“pendigits.t”, bias)) { // Configure parameter var param = new Parameter { SolverType = sol, C = 1d, Epsilon = eps, P = 0.1, WeightLabel = new int[0], Weight = new double[0] };<br>var message = LibLinear.CheckParameter(train, param); if (!string.IsNullOrWhiteSpace(message)) { Console.WriteLine($”Error: {message} for train problem”); return -1; }<br>// Train training data var sw = new Stopwatch(); sw.Start(); using (var model = LibLinear.Train(train, param)) { sw.Stop();<br>if (!string.IsNullOrWhiteSpace(output)) Model.Save(output, model);<br>var correct = 0; var total = 0; var x = test.X; var y = test.Y;<br>double error = 0; double sump = 0; double sumt = 0; double sumpp = 0; double sumtt = 0; double sumpt = 0;<br>for (var i = 0; i &lt; test.Length; i++) { // Get vector from test data var array = x[i];<br>// Get classification result (returns label) var target = y[i]; var predict = LibLinear.Predict(model, array); if (Math.Abs(predict - target) &lt; double.Epsilon) correct++;<br>error += (predict - target) * (predict - target); sump += predict; sumt += target; sumpp += predict * predict; sumtt += target * target; sumpt += predict * target;<br>total++; }<br>if (model.IsRegressionModel) { var mse = error / total; var scc = (total * sumpt - sump * sumt) * (total * sumpt - sump * sumt) / ((total * sumpp - sump * sump) * (total * sumtt - sumt * sumt)); Console.WriteLine($”Mean squared error: {mse:f5}%, Squared correlation coefficient: {scc:f6}, Elapsed: {sw.ElapsedMilliseconds}ms”); } else { var accuracy = correct / (double)total * 100; Console.WriteLine($”Accuracy: {accuracy:f4}% ({correct}/{total}), Elapsed: {sw.ElapsedMilliseconds}ms”); } } }<br>return 0; });<br>app.Execute(args); }<br>}<br>}[/code] このサンプルは、訓練データとテストデータの分類または回帰を実行します。 実行のために、</p><ul><li><a href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits">https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits</a></li><li><a href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits.t">https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/pendigits.t</a></li></ul><p>をダウンロードします。 これは手書き数字のデータセットです。MNISTと似ているのかな? 引数として、</p><ul><li>ソルバー (オプション)<ul><li>例: -s=4</li></ul></li><li>バイアス (オプション)<ul><li>例: -b=3</li></ul></li><li>学習済みファイルの出力先 (オプション)<ul><li>例: -o=trained.model</li></ul></li></ul><p>を指定できます。 分類と回帰によって実行結果が異なります。</p><h2 id="分類"><a href="#分類" class="headerlink" title="分類"></a>分類</h2><p>[code lang=”batch”] D:\Works\OpenSource\LibSvmDotNet\example\Pendigits&gt; dotnet run -c Release optimization finished, #iter = 1000<br>WARNING: reaching max number of iterations Using -s 2 may be faster (also see FAQ)<br>Objective value = -10.592368 nSV = 1404 * . . . WARNING: reaching max number of iterations Using -s 2 may be faster (also see FAQ)<br>Objective value = -3.640437 nSV = 592 Accuracy: 79.7027% (2788/3498), Elapsed: 1737ms [/code]</p><h2 id="回帰"><a href="#回帰" class="headerlink" title="回帰"></a>回帰</h2><p>[code lang=”batch”] D:\Works\OpenSource\LibSvmDotNet\example\Pendigits&gt; dotnet run -c Release “-s=11” iter 1 act 1.445e+05 pre 1.623e+05 delta 1.690e+01 f 2.026e+05 |g| 1.405e+07 CG 1 cg reaches trust region boundary iter 2 act 1.430e+04 pre 1.418e+04 delta 6.758e+01 f 5.808e+04 |g| 1.746e+06 CG 2 iter 3 act 5.313e+03 pre 5.281e+03 delta 6.758e+01 f 4.378e+04 |g| 2.849e+05 CG 9 iter 4 act 6.203e+01 pre 6.202e+01 delta 6.758e+01 f 3.847e+04 |g| 2.140e+04 CG 11 Mean squared error: 6.60231%, Squared correlation coefficient: 0.215259, Elapsed: 13ms [/code]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>またも、正直車輪の再発明な気がしないでもないですが… LibLinearのメリットは、大規模データに対してLibSvmよりも高速に実行できるところがウリのようです。 このあたりの高速性も紹介していきたいです。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits">https://github.com/takuya-takeuchi/LibLinearDotNet/tree/master/example/Pendigits</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net-framework </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
          <category> 機械学習 </category>
          
          <category> .NETで機械学習を試してみる LibLinear.Net編 </category>
          
          <category> LibLinear.Net </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その118 Dockerのビルド時間 (主にapt-getやyum) を短縮する</title>
      <link href="/2018/05/03/2995/"/>
      <url>/2018/05/03/2995/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 Dockerで毎回buildまたはrunするとき、apt-getやyumが含まれると構築に時間がかかります。 ネットで調べてみると透過型Proxyとか色々対応策がありましたが、上手くいきませんでした。 そんな中、DockerHubから取得したイメージそのものを更新する、という手法を見つけました。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>素晴らしいアイデアはこちら。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qiita.com/mojatter/items/1525ac40e61ff124543e" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DDockerfile%2520%25E3%2583%2593%25E3%2583%25AB%25E3%2583%2589%25E6%2599%2582%25E9%2596%2593%25E7%259F%25AD%25E7%25B8%25AE%2520tips%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3D5346295cb9507b8c6de57facc6d3932f&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540mojatter%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3De248b77b051eefa6f83b0d3d1981c51f&blend-align=center%2Cmiddle&blend-mode=normal&s=53f861de3f3f914523389b16ddb1bbd4"></img></div><div class="hbc-text"><div class="hbc-title">Dockerfile ビルド時間短縮 tips - Qiita</div><div class="hbc-url">https://qiita.com/mojatter/items/1525ac40e61ff124543e</div><div class="hbc-description">ubuntu や centos などの dockerhub イメージを使って Dockerfile を書くとき、大抵の場合 apt-get update や yum update を先頭に書きます。FROM ubuntu:late...</div></div></div></div></a></div></div><p>手順は下記</p><h2 id="1-ホストOS上"><a href="#1-ホストOS上" class="headerlink" title="1. ホストOS上"></a>1. ホストOS上</h2><p>[code lang=”sh”] # &lt;base_image&gt; から &lt;temp_containe_name&gt; というコンテナを実行 docker run -it –name &lt;temp_containe_name&gt; &lt;base_image&gt; [/code]</p><h2 id="2-コンテナ内"><a href="#2-コンテナ内" class="headerlink" title="2. コンテナ内"></a>2. コンテナ内</h2><p>[code lang=”sh”] # 取得したいパッケージのインストール $ apt-get update &amp;&amp; apt-get -y upgrade &amp;&amp; apt-get clean $ exit [/code]</p><h2 id="3-ホストOS上"><a href="#3-ホストOS上" class="headerlink" title="3. ホストOS上"></a>3. ホストOS上</h2><p>[code lang=”sh”] # &lt;base_image&gt; を上書き $ docker commit &lt;temp_containe_name&gt; &lt;base_image&gt; # 仮コンテナを削除 $ docker rm &lt;temp_containe_name&gt; [/code] 実際は、元となるイメージは複製しておくと、より安心ですね。 最終のビルドテスト時に、<strong>FROM</strong>をオリジナルに戻せば事足りそうです。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その117 UbuntuでDokcerイメージの置き場所を変更する</title>
      <link href="/2018/05/01/2984/"/>
      <url>/2018/05/01/2984/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>2018/05/01 更新 NTFSのパーティションを置き場所として指定しましたが、dockerではNTFSは未サポートとのこと。 詳細は、<a href="https://github.com/moby/moby/issues/23930#issuecomment-349333857">how to solve it? docker: error creating overlay mount to invalid argument #23930</a> 備忘録。 USBメモリに格納したUbuntuでdockerを動かしているが、dockerは何かとディスクの容量を食うのと、書き込みが多いとUSBの耐久性が心配なので、イメージの場所を変えてみることにした。</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>もぉそのままズバリな記事を書いてくださっている方が。ありがとうございます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://qiita.com/RyoMa_0923/items/e1174b2951411ddd1d08" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DDocker%25E3%2582%25A4%25E3%2583%25A1%25E3%2583%25BC%25E3%2582%25B8%25E3%2581%25AE%25E6%25A0%25BC%25E7%25B4%258D%25E5%2585%2588%25E5%25A4%2589%25E6%259B%25B4%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3Dbd5b83ad7eeb07d88e92e3f7b9b333a6&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540RyoMa_0923%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3D4b8a4a6350f29db6b80ba317537cf6b7&blend-align=center%2Cmiddle&blend-mode=normal&s=00fa16597097bc2ebb282ce935a5ce77"></img></div><div class="hbc-text"><div class="hbc-title">Dockerイメージの格納先変更 - Qiita</div><div class="hbc-url">https://qiita.com/RyoMa_0923/items/e1174b2951411ddd1d08</div><div class="hbc-description">Ubuntuでインストールしたdockerはデフォルトでは/var/lib/docker配下にイメージを格納します。とは言うでも/var/lib/dockerを含んだボリュームのサイズがそんなに大きくないよ!なんてことあると...</div></div></div></div></a></div></div><p>要するに、**/lib/systemd/system/docker.service**の中身を変更しなさい、ってことでした。 上の先人様は、docker.serviceを今後は編集したくない、ということで環境変数経由で設定を変更するという目から鱗な方法で対応されています。 渡しもそれを真似ます。</p><h2 id="docker-service-の修正"><a href="#docker-service-の修正" class="headerlink" title="docker.service の修正"></a>docker.service の修正</h2><p>[code lang=”sh”] $ sudo vi /lib/systemd/system/docker.service [/code] <strong>編集前</strong> [code lang=”vim”] ExecStart=/usr/bin/dockerd -H fd:// [/code] <strong>編集後</strong> [code lang=”vim”] #ExecStart=/usr/bin/dockerd -H fd:// EnvironmentFile=/opt/config/docker ExecStart=/usr/bin/dockerd $OPTIONS [/code]</p><h2 id="opt-config-docker-の作成"><a href="#opt-config-docker-の作成" class="headerlink" title="/opt/config/docker の作成"></a>/opt/config/docker の作成</h2><p>[code lang=”sh”] $ sudo mkdir /opt/config $ sudo vi /opt/config/docker [/code] <strong>追加</strong> [code lang=”vim”] OPTIONS=”-H fd:// -g /home/XXXXX/media/hdd/windows/VirtualMachines/docker/Ubuntu/“ [/code]</p><h2 id="編集の反映と確認"><a href="#編集の反映と確認" class="headerlink" title="編集の反映と確認"></a>編集の反映と確認</h2><p>[code lang=”sh”] $ sudo systemctl daemon-reload $ sudo systemctl restart docker<br>$ ps -ef | grep docker root 3593 1 4 21:37 ? 00:01:07 /usr/bin/dockerd -H fd:// -g /home/XXXXX/media/hdd/windows/VirtualMachines/docker/Ubuntu/ root 3622 3593 0 21:37 ? 00:00:02 docker-containerd –config /var/run/docker/containerd/containerd.toml takuya 4018 3865 0 21:59 pts/1 00:00:00 grep –color=auto docker [/code]</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その116 /etc/fstabでホームディレクトリを認識しない</title>
      <link href="/2018/05/01/2981/"/>
      <url>/2018/05/01/2981/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 <strong>/etc/fstab</strong> に下記のように書いてもマウントできなかった。 [code lang=”sh”] UUID=68ACE6B0ACE677C8 ~/media/hdd/windows ntfs default 0 0 [/code]</p><h1 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h1><p>まぁお察しの通り、ホームディレクトリを表すチルダ(~)は、fstabがロードされる時点では、どのユーザに対応づけられているかわからないためでした。 同じ事を聞いている人がいました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://ubuntuforums.org/showthread.php?t=1005309" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ubuntuforums.org"></img><div class="hbc-site-name">ubuntuforums.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">[all variants] mount a partition to ~/&lt;dir&gt;</div><div class="hbc-url">https://ubuntuforums.org/showthread.php?t=1005309</div><div class="hbc-description">How do I do this? I have a partition that is used just to store music files and I would like to mount it on the mount point ~/music for each…</div></div></div></div></a></div></div><p>きちんとフルパスで書きましょう。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その115 nvidia-dockerをUbuntu 18.04にインストールする</title>
      <link href="/2018/05/01/2967/"/>
      <url>/2018/05/01/2967/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>USBメモリに<strong>Ubuntu 18.04</strong>をインストールしたため、Windowsが入っているディスクを汚さずにUbuntuを使えるようになりました。 で、2018年4月26日にリリースされた<strong>Ubuntu 18.04 LTS</strong>をインストールしました。 が、情報が少ないせいか、dockerがインストールできない!!とか色々… 最初は、<strong>docker-ce</strong>がいるのか!!とか思ってapt-getだ、githubだ、ソースビルドだ、って頑張ったけど、そんなものはいらないことがわかりましした。</p><h1 id="Try-out"><a href="#Try-out" class="headerlink" title="Try out!!"></a>Try out!!</h1><p>手順はここに書いてあるとおり。事前にNvidia Driverは入れておきましょう。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/1728152?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">NVIDIA/nvidia-docker</div><div class="hbc-url">https://github.com/NVIDIA/nvidia-docker</div><div class="hbc-description">Build and run Docker containers leveraging NVIDIA GPUs - NVIDIA/nvidia-docker</div></div></div></div></a></div></div><p>[code lang=”sh”] # リポジトリを追加 $ curl -s -L <a href="https://nvidia.github.io/nvidia-docker/gpgkey">https://nvidia.github.io/nvidia-docker/gpgkey</a> | sudo apt-key add - $ distribution=$(. /etc/os-release;echo $ID$VERSION_ID) $ curl -s -L <a href="https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list">https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list</a> | \ sudo tee /etc/apt/sources.list.d/nvidia-docker.list $ sudo apt-get update<br># nvidia-docker2をインストール $ sudo apt-get install -y nvidia-docker2 # dockerのデーモンを設定して再読込 $ sudo pkill -SIGHUP dockerd<br># nvidia-smiをコンテナ上で動かす $ docker run –runtime=nvidia –rm nvidia/cuda nvidia-smi [/code] これだけです。 最後のコマンドを動かすと、グラフィックボードの状態が出力されます。 [code lang=”sh”] $ docker run –runtime=nvidia –rm nvidia/cuda nvidia-smi Tue May 1 10:58:19 2018 +—————————————————————————–+ | NVIDIA-SMI 390.48 Driver Version: 390.48 | |——————————-+———————-+———————-+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 GeForce GTX 1080 Off | 00000000:01:00.0 On | N/A | | 27% 33C P8 7W / 180W | 282MiB / 8117MiB | 0% Default | +——————————-+———————-+———————-+<br>+—————————————————————————–+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| +—————————————————————————–+ [/code] ちなみに、docker-ceの17.12が動いています。 [code lang=”sh”] $ docker version Client: Version: 17.12.1-ce API version: 1.35 Go version: go1.10.1 Git commit: 7390fc6 Built: Wed Apr 18 01:23:11 2018 OS/Arch: linux/amd64<br>$ apt-cache depends nvidia-docker2 nvidia-docker2 依存: nvidia-container-runtime 依存: docker.io 破壊: 置換: [/code] このことは、<a href="https://github.com/NVIDIA/nvidia-docker/issues/643">Can not install nvidia-docker2 with docker 17.12.0-ce installed #607</a>にも書いてありました。</p><blockquote><p>Packages released for ubuntu 18.04 today. It depends on docker.io, since docker-ce doesn’t have packages for 18.04 yet. Ubuntu 18.04 向けのパッケージが今日リリースされたよ。docker-ceは18.04向けのパッケージをまだ持っていないから、dockr.ioに依存しているよ。</p></blockquote><p>でもまぁ。nvidia-dockerが動くようになったので、遠慮無くcudaで遊べます。CUDAのバージョンとか気にしなくて良いので。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その114 Ubuntu 18.04でNvidia Driverをインストールする</title>
      <link href="/2018/05/01/2974/"/>
      <url>/2018/05/01/2974/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Ubuntu 16.04であれだけ苦汁をなめさせられたNvidia Driverのインストールが拍子抜けするくらい簡単になりました。 Unityを捨ててGNOMEに戻ってきたからですかねぇ?</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>下記のページが参考になりました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://linuxconfig.org/how-to-install-the-nvidia-drivers-on-ubuntu-18-04-bionic-beaver-linux" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=linuxconfig.org"></img><div class="hbc-site-name">linuxconfig.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">How to install the NVIDIA drivers on Ubuntu 18.04 Bionic Beaver Linux - LinuxConfig.org</div><div class="hbc-url">https://linuxconfig.org/how-to-install-the-nvidia-drivers-on-ubuntu-18-04-bionic-beaver-linux</div><div class="hbc-description">How to install the NVIDIA drivers on Ubuntu 18.04 Bionic Beaver Linux </div></div></div></div></a></div></div><p>手順は下記。 [code lang=”sh”] # デバイスの認識を確認 $ ubuntu-drivers devices == /sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0 == modalias : pci:v000010DEd00001B80sv00001028sd00003366bc03sc00i00 vendor : NVIDIA Corporation model : GP104 [GeForce GTX 1080] driver : nvidia-driver-390 - distro non-free recommended driver : xserver-xorg-video-nouveau - distro free builtin<br># 自動でインストール $ sudo ubuntu-drivers autoinstall<br># 再起動 $ sudo reboot<br># 挙動確認 $ nvidia-smi Mon Apr 30 19:13:18 2018 +—————————————————————————–+ | NVIDIA-SMI 390.48 Driver Version: 390.48 | |——————————-+———————-+———————-+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 GeForce GTX 1080 Off | 00000000:01:00.0 On | N/A | | 27% 41C P0 41W / 180W | 85MiB / 8117MiB | 0% Default | +——————————-+———————-+———————-+<br>+—————————————————————————–+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | 0 1145 G /usr/lib/xorg/Xorg 33MiB | | 0 1195 G /usr/bin/gnome-shell 48MiB | +—————————————————————————–+ [/code] 以上!! しかもきちんとデスクトップ画面も表示されます。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> gpupu </category>
          
          <category> Ubuntu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その113 Ubuntu 18.04でRAMディスクを使う</title>
      <link href="/2018/05/01/2968/"/>
      <url>/2018/05/01/2968/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>防備録。 Ubuntuが入っているマシンがメモリ32GBなのとUSBメモリにインストールされているのもあって、不要な書き込みは避けたいのでRAMディスクを使うことにしました。 Windowsも標準で対応しませんかねぇ?</p><h1 id="How-to"><a href="#How-to" class="headerlink" title="How to?"></a>How to?</h1><p>下記のページが参考になりました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://itemy.net/?p=501" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=itemy.net"></img><div class="hbc-site-name">Logfile</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://itemy.net/blog/wp-content/themes/simplicity2/images/og-image.jpg"></img></div><div class="hbc-text"><div class="hbc-title">UbuntuでRAMDISKにテンポラリやログを移す</div><div class="hbc-url">http://itemy.net/?p=501</div><div class="hbc-description">SDカードにUbuntuをインストールしてテスト用のサーバーを作ったけど、SDカードの寿命を考えて少しでもアクセスを減らすためにテンポラリやログファイルをRAMDISKに移す方法。ちょっとしたテスト用だから遡ってログファイルなんて見ないし保</div></div></div></div></a></div></div><p>上のページだと、<strong>nano</strong>を使ってエディタ編集していました。最初、nanoって何だっけ?って思いました。 手順は下記。</p><h2 id="RAMディスクの割り当て"><a href="#RAMディスクの割り当て" class="headerlink" title="RAMディスクの割り当て"></a>RAMディスクの割り当て</h2><p>[code lang=”sh”] $ sudo vi /etc/fstab [/code] 下記の記述を追加。 [code lang=”sh”] tmpfs /var/log tmpfs defaults,noatime,size=128m 0 0 tmpfs /var/tmp tmpfs defaults,noatime,size=512m 0 0 tmpfs /tmp tmpfs defaults,noatime,size=512m 0 0 [/code]</p><h2 id="ディレクトリの作成"><a href="#ディレクトリの作成" class="headerlink" title="ディレクトリの作成"></a>ディレクトリの作成</h2><p>起動時に上で割り当てたRAMディスクのマウント先を作成するようにします。 [code lang=”sh”] $ sudo vi /etc/rc.local [/code] 下記の記述を追加。 アプリでエラーが出たら都度追加します。 [code lang=”sh”] mkdir -p /var/log/apt mkdir -p /var/log/fsck<br>touch /var/log/lastlog touch /var/log/wtmp touch /var/log/btmp chown root.utmp /var/log/lastlog chown root.utmp /var/log/wtmp chown root.utmp /var/log/btmp [/code]</p><h2 id="確認"><a href="#確認" class="headerlink" title="確認"></a>確認</h2><p>[code lang=”sh”] $ sudo reboot [/code] 再起動してディレクトリが作成されることを確認。 [code lang=”sh”] $ df -h tmpfs 128M 404K 128M 1% /var/log tmpfs 512M 8.0K 512M 1% /tmp tmpfs 512M 0 512M 0% /var/tmp [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その112 YOLOv3をWindowsで試す</title>
      <link href="/2018/04/30/2956/"/>
      <url>/2018/04/30/2956/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>先月初めくらいに仕事で <strong>YOLOv2 (You Only Look Once v2)</strong> の検証をしていた矢先、突如現れた <strong>YOLOv3</strong>。 検証したくとも忙しいのと、自宅は<strong>750 Ti</strong>、会社で自由に使えるGPUマシンも<strong>750 Ti</strong>と検証するには、いささか物足りない状態でした。 が、今月頭に自宅の開発機を一新。</p><ul><li>Intel i7-8700 3.20GHz</li><li>32GB RAM</li><li>Nvidia GeForce GTX 1080</li></ul><p>を搭載し、一気に環境がグレードアップ。 GWに入ってもモチベーションが維持できていたため検証してみました。</p><h1 id="Try-out"><a href="#Try-out" class="headerlink" title="Try out!!"></a>Try out!!</h1><p>と言っても、GPUが乗っているマシンはWindows。別にUbuntu入れても良いんですが、デュアルブートにしたいので放置。 なので、YOLOを実装している深層学習フレームワーク <strong>Darknet</strong> のWindows版を試すことに。 </p><p>仕事でも上のリポジトリにはお世話になりました。 今回もこれを使います。 使い方は上に書いてあるとおり。</p><ul><li>OpenCV 3.4.0</li><li>cuDNN 7.0</li><li>CUDA 9.1</li></ul><p>を用意して、環境変数追加、C++のプロジェクトファイルの書き換えだけです。 なので省略!! 肝心の比較。 テスト画像はお馴染みの自転車と犬と車 (768x576)。 ちなみに公式ページと結果が異なるのは、Windows版であるからだとおもいますが、劇的に違うわけでは無いので無視。</p><h2 id="YOLOV2"><a href="#YOLOV2" class="headerlink" title="YOLOV2"></a>YOLOV2</h2><p>[code lang=”ps”] D:\Works\Local\darknet\build\darknet\x64&gt; .\darknet.exe detect cfg\yolov2.cfg yolov2.weights data\dog.jpg layer filters size input output 0 conv 32 3 x 3 / 1 416 x 416 x 3 -&gt; 416 x 416 x 32 1 max 2 x 2 / 2 416 x 416 x 32 -&gt; 208 x 208 x 32 2 conv 64 3 x 3 / 1 208 x 208 x 32 -&gt; 208 x 208 x 64 3 max 2 x 2 / 2 208 x 208 x 64 -&gt; 104 x 104 x 64 4 conv 128 3 x 3 / 1 104 x 104 x 64 -&gt; 104 x 104 x 128 5 conv 64 1 x 1 / 1 104 x 104 x 128 -&gt; 104 x 104 x 64 6 conv 128 3 x 3 / 1 104 x 104 x 64 -&gt; 104 x 104 x 128 7 max 2 x 2 / 2 104 x 104 x 128 -&gt; 52 x 52 x 128 8 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 9 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 10 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 11 max 2 x 2 / 2 52 x 52 x 256 -&gt; 26 x 26 x 256 12 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 13 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 14 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 15 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 16 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 17 max 2 x 2 / 2 26 x 26 x 512 -&gt; 13 x 13 x 512 18 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 19 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 20 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 21 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 22 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 23 conv 1024 3 x 3 / 1 13 x 13 x1024 -&gt; 13 x 13 x1024 24 conv 1024 3 x 3 / 1 13 x 13 x1024 -&gt; 13 x 13 x1024 25 route 16 26 conv 64 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 64 27 reorg / 2 26 x 26 x 64 -&gt; 13 x 13 x 256 28 route 27 24 29 conv 1024 3 x 3 / 1 13 x 13 x1280 -&gt; 13 x 13 x1024 30 conv 425 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 425 31 detection mask_scale: Using default ‘1.000000’ Loading weights from yolov2.weights… seen 32 Done! data\dog.jpg: Predicted in 0.012998 seconds. pottedplant: 24% bicycle: 25% dog: 82% bicycle: 82% truck: 74% [/code]</p><h2 id="YOLOV3"><a href="#YOLOV3" class="headerlink" title="YOLOV3"></a>YOLOV3</h2><p>[code lang=”ps”] PS D:\Works\Local\darknet\build\darknet\x64&gt; .\darknet.exe detect cfg\yolov3.cfg yolov3.weights data\dog.jpg layer filters size input output 0 conv 32 3 x 3 / 1 416 x 416 x 3 -&gt; 416 x 416 x 32 1 conv 64 3 x 3 / 2 416 x 416 x 32 -&gt; 208 x 208 x 64 2 conv 32 1 x 1 / 1 208 x 208 x 64 -&gt; 208 x 208 x 32 3 conv 64 3 x 3 / 1 208 x 208 x 32 -&gt; 208 x 208 x 64 4 Shortcut Layer: 1 5 conv 128 3 x 3 / 2 208 x 208 x 64 -&gt; 104 x 104 x 128 6 conv 64 1 x 1 / 1 104 x 104 x 128 -&gt; 104 x 104 x 64 7 conv 128 3 x 3 / 1 104 x 104 x 64 -&gt; 104 x 104 x 128 8 Shortcut Layer: 5 9 conv 64 1 x 1 / 1 104 x 104 x 128 -&gt; 104 x 104 x 64 10 conv 128 3 x 3 / 1 104 x 104 x 64 -&gt; 104 x 104 x 128 11 Shortcut Layer: 8 12 conv 256 3 x 3 / 2 104 x 104 x 128 -&gt; 52 x 52 x 256 13 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 14 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 15 Shortcut Layer: 12 16 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 17 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 18 Shortcut Layer: 15 19 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 20 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 21 Shortcut Layer: 18 22 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 23 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 24 Shortcut Layer: 21 25 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 26 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 27 Shortcut Layer: 24 28 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 29 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 30 Shortcut Layer: 27 31 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 32 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 33 Shortcut Layer: 30 34 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 35 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 36 Shortcut Layer: 33 37 conv 512 3 x 3 / 2 52 x 52 x 256 -&gt; 26 x 26 x 512 38 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 39 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 40 Shortcut Layer: 37 41 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 42 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 43 Shortcut Layer: 40 44 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 45 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 46 Shortcut Layer: 43 47 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 48 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 49 Shortcut Layer: 46 50 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 51 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 52 Shortcut Layer: 49 53 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 54 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 55 Shortcut Layer: 52 56 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 57 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 58 Shortcut Layer: 55 59 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 60 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 61 Shortcut Layer: 58 62 conv 1024 3 x 3 / 2 26 x 26 x 512 -&gt; 13 x 13 x1024 63 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 64 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 65 Shortcut Layer: 62 66 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 67 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 68 Shortcut Layer: 65 69 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 70 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 71 Shortcut Layer: 68 72 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 73 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 74 Shortcut Layer: 71 75 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 76 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 77 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 78 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 79 conv 512 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 80 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 81 conv 255 1 x 1 / 1 13 x 13 x1024 -&gt; 13 x 13 x 255 82 detection 83 route 79 84 conv 256 1 x 1 / 1 13 x 13 x 512 -&gt; 13 x 13 x 256 85 upsample 2x 13 x 13 x 256 -&gt; 26 x 26 x 256 86 route 85 61 87 conv 256 1 x 1 / 1 26 x 26 x 768 -&gt; 26 x 26 x 256 88 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 89 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 90 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 91 conv 256 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 256 92 conv 512 3 x 3 / 1 26 x 26 x 256 -&gt; 26 x 26 x 512 93 conv 255 1 x 1 / 1 26 x 26 x 512 -&gt; 26 x 26 x 255 94 detection 95 route 91 96 conv 128 1 x 1 / 1 26 x 26 x 256 -&gt; 26 x 26 x 128 97 upsample 2x 26 x 26 x 128 -&gt; 52 x 52 x 128 98 route 97 36 99 conv 128 1 x 1 / 1 52 x 52 x 384 -&gt; 52 x 52 x 128 100 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 101 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 102 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 103 conv 128 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 128 104 conv 256 3 x 3 / 1 52 x 52 x 128 -&gt; 52 x 52 x 256 105 conv 255 1 x 1 / 1 52 x 52 x 256 -&gt; 52 x 52 x 255 106 detection Loading weights from yolov3.weights… seen 64 Done! data\dog.jpg: Predicted in 0.027030 seconds. dog: 99% car: 25% bicycle: 99% truck: 93% [/code]</p><h2 id="Tiny-YOLO"><a href="#Tiny-YOLO" class="headerlink" title="Tiny YOLO"></a>Tiny YOLO</h2><p>[code lang=”ps”] D:\Works\Local\darknet\build\darknet\x64&gt; .\darknet.exe detect .\cfg\yolov2-tiny.cfg .\yolov2-tiny.weights .\data\dog .jpg layer filters size input output 0 conv 16 3 x 3 / 1 416 x 416 x 3 -&gt; 416 x 416 x 16 1 max 2 x 2 / 2 416 x 416 x 16 -&gt; 208 x 208 x 16 2 conv 32 3 x 3 / 1 208 x 208 x 16 -&gt; 208 x 208 x 32 3 max 2 x 2 / 2 208 x 208 x 32 -&gt; 104 x 104 x 32 4 conv 64 3 x 3 / 1 104 x 104 x 32 -&gt; 104 x 104 x 64 5 max 2 x 2 / 2 104 x 104 x 64 -&gt; 52 x 52 x 64 6 conv 128 3 x 3 / 1 52 x 52 x 64 -&gt; 52 x 52 x 128 7 max 2 x 2 / 2 52 x 52 x 128 -&gt; 26 x 26 x 128 8 conv 256 3 x 3 / 1 26 x 26 x 128 -&gt; 26 x 26 x 256 9 max 2 x 2 / 2 26 x 26 x 256 -&gt; 13 x 13 x 256 10 conv 512 3 x 3 / 1 13 x 13 x 256 -&gt; 13 x 13 x 512 11 max 2 x 2 / 1 13 x 13 x 512 -&gt; 13 x 13 x 512 12 conv 1024 3 x 3 / 1 13 x 13 x 512 -&gt; 13 x 13 x1024 13 conv 512 3 x 3 / 1 13 x 13 x1024 -&gt; 13 x 13 x 512 14 conv 425 1 x 1 / 1 13 x 13 x 512 -&gt; 13 x 13 x 425 15 detection mask_scale: Using default ‘1.000000’ Loading weights from .\yolov2-tiny.weights… seen 64 Done! .\data\dog.jpg: Predicted in 0.005972 seconds. dog: 82% car: 24% bicycle: 26% car: 30% bicycle: 59% person: 26% person: 28% car: 41% car: 73% [/code]</p><h1 id="Compare"><a href="#Compare" class="headerlink" title="Compare!!"></a>Compare!!</h1><p>GPUの性能が良いからなのか、速度が恐ろしいことになっています。 リアルタイムいけるやん(震え声) [table id=28 /] 画像の結果は下記。<br><a href="../../../../public/2018/04/6a381b1f8a1d79b21509a578ea3f2bb6.png"><img src="../../../../public/2018/04/6a381b1f8a1d79b21509a578ea3f2bb6.png"></a> <strong>YOLOv3</strong> <a href="../../../../public/2018/04/7f955b0dd729a4def0114f4dc242efd4.png"><img src="../../../../public/2018/04/7f955b0dd729a4def0114f4dc242efd4.png"></a> <strong>YOLOv2</strong> <a href="../../../../public/2018/04/3b12a0555434f5c98bc248183480e01d.png"><img src="../../../../public/2018/04/3b12a0555434f5c98bc248183480e01d.png"></a> <strong>Tiny YOLO</strong> 層が3倍になったからといって単純に速度が1/3という訳では無いですが、精度向上しても、これだけの速度低下なのは凄いことです。 YOLOv3の出力を見ると、<strong>Shortcut Layer</strong> という単語が頻出していますが、これは<strong>Residual Network</strong>ですかね。 <a href="https://pjreddie.com/media/files/papers/YOLOv3.pdf">論文</a><br>を見ると確かにそう書いてあります。</p><blockquote><p>We use a new network for performing feature extraction. Our new network is a hybrid approach between the network used in YOLOv2, Darknet-19, and that newfangled residual network stuff. 我々は特徴抽出を行う新しいネットワークを使用する。 我々の新しいネットワークは、YOLOv2、Darknet-19、そして、あの最新式のResidualネットワークで使われているネットワークのハイブリットなアプローチだ。</p></blockquote><p>こいつは凄い(小並感) ところでYOLOv4は何時ですかね(すっとぼけ)</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> gpupu </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
          <category> Darknet </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>YOLO_Comapre</title>
      <link href="/2018/04/30/2957/"/>
      <url>/2018/04/30/2957/</url>
      
        <content type="html"><![CDATA[<p>[[“”,”YOLOv3”,”YOLOv2”,”Tiny YOLO”],[“Speed”,”0.027030 sec (27ms)”,”0.012998 sec (12ms)”,”0.005972 sec (5ms)”],[“Layer Num”,”106”,”31”,”15”],[“Detected Object”,”dog: 99%”,”dog: 82%”,”dog: 82%”],[“#rowspan#”,”bicycle: 99%”,”bicycle: 82%”,”car: 73%”],[“#rowspan#”,”truck: 93%”,”truck: 74%”,”bicycle: 59%”],[“#rowspan#”,”car: 25%”,”bicycle: 25%”,”car: 41%”],[“#rowspan#”,””,”pottedplant: 24%”,”car: 30%”],[“#rowspan#”,””,””,”person: 28%”],[“#rowspan#”,””,””,”person: 26%”],[“#rowspan#”,””,””,”bicycle: 26%”],[“#rowspan#”,””,””,”car: 24%”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その111 MacOSXでX11が見つからない</title>
      <link href="/2018/04/30/2952/"/>
      <url>/2018/04/30/2952/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>備忘録。 <strong>dlib</strong>をMacでビルドしようと思ったら、見つからない、というので焦った。 brew installでそれらしい名前も無いので..</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>ずばり下記。 [code lang=”sh”] $ wget <a href="https://dl.bintray.com/xquartz/downloads/XQuartz-2.7.11.dmg">https://dl.bintray.com/xquartz/downloads/XQuartz-2.7.11.dmg</a> $ hdiutil mount XQuartz-2.7.11.dmg $ cd /Volumes/XQuartz-2.7.11 $ sudo installer -pkg XQuartz.pkg -target / -lang ja $ cd $ hdiutil detach /Volumes/XQuartz-2.7.11 [/code] wgetはhomebrewからインストールしておくこと。</p>]]></content>
      
      
      <categories>
          
          <category> Apple </category>
          
          <category> Mac </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで機械学習を試してみる LibSvm.Net編 第1回</title>
      <link href="/2018/04/30/2943/"/>
      <url>/2018/04/30/2943/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>直前の記事であろうことか説明とサンプルで使っているライブラリを間違えるというドジを踏みました。 謹んでお詫びします。 で、**Support Vector Machine (SVM)**のライブラリをたくさん調べたのですが、以前話したようにそこまで多くありません。 なので、自分で作ってみました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.nuget.org/packages/LibSvmDotNet" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.nuget.org"></img><div class="hbc-site-name">www.nuget.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://api.nuget.org/v3-flatcontainer/libsvmdotnet/1.0.2/icon"></img></div><div class="hbc-text"><div class="hbc-title">LibSvmDotNet 1.0.2</div><div class="hbc-url">https://www.nuget.org/packages/LibSvmDotNet</div><div class="hbc-description">.NET wrapper for LIBSVM written in C#. Please download libsvm.dll from https://github.com/cjlin1/libsvm</div></div></div></div></a></div></div><p>本当は、<strong>LibSvm.Net</strong> て名前で登録したかったんですが、既に存在するために泣く泣くこうなりました。 まぁ、githubのリポジトリのurlもこうだから、悪くないと言えば悪くないのですが… ところで、世の中に存在する.NETのSVMライブラリのほとんどが <strong>LIBSVM</strong> のラッパーであるのと同じく、自分で作ったのもラッパーです。 もう少し違いを説明します。</p><ul><li><a href="http://accord-framework.net/">Accord.NET</a><ul><li>有名どころです。SVM以外の機械学習も可能です。SVMは独自の実装の模様。ただ、LIBSVMのモデルファイルを読めたりします。</li></ul></li><li><a href="https://github.com/ksopyla/KMLib">KMLib</a><ul><li>GPUを使える模様。が、最終更新が5年前。CUDA 3.0…</li></ul></li><li><a href="https://github.com/ccerhan/LibSVMsharp">LibSVMsharp</a><ul><li>最新のLIBSVMに対応。libsvm.dllを直接読み込みます。</li></ul></li><li><a href="https://github.com/nicolaspanel/libsvm.net">libsvm.net</a><ul><li>最終更新が3年前。また、Javaのラッパー <em>IKVM</em> を経由しているため速度面で不利。</li></ul></li><li><a href="https://github.com/aardvark-platform/aardvark.semantictextonforests">libsvm.clr</a><ul><li>C++/CLIでLIBSVMを再ビルドして.NETから呼べるようにしています。</li></ul></li></ul><p>この中で立ち位置が近いのは、</p><ul><li>LibSVMsharp</li><li>libsvm.net</li><li>libsvm.clr</li></ul><p>です。 LibSvm.Netとの違いを説明すると、</p><ul><li>LibSVMsharp<ul><li>LibSVMsharpは、Predict関数を呼ぶ度にモデルファイルをアンマネージド領域にコピーしています。なので、何度も予測処理をかけたりする場合は、LibSvm.Netは効率よく動作します。</li><li>一応、何度も呼び出さないようにする方法もありますが、ポインタを受け渡しするという開発者泣かせの方式。</li></ul></li><li>libsvm.net<ul><li>Javaなんか経由しません。LibSvm.Netは100%C#でP/Invokeで直接LIBSVMを呼び出します。</li></ul></li><li>libsvm.clr<ul><li>C++/CLIなので、LinuxやMacで使えません。LibSvm.Netは100%C#の.NETStandard準拠です。他の依存ライブラリもありません。Linuxで動くことも確認しています。</li></ul></li></ul><p>何より、XMLコメントほぼ全て英語と日本語で実装していますので、IntelliSenseがバリバリ効きます!! 使い勝手は他とどっこいどっこいですが、前回と同じサンプルをLibSvm.Netで実装したものを持ってきました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/LibSvmDotNet</div><div class="hbc-url">https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10</div><div class="hbc-description">.NET wrapper for LIBSVM written in C#. Contribute to takuya-takeuchi/LibSvmDotNet development by creating an account on GitHub.</div></div></div></div></a></div></div><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>LibSvm.Netを使うには下記の作業が必要です。</p><p>1. NugetからLibSvm.Netのインストール</p><p>2. LIBSVMのソースをダウンロード</p><p>3. LIBSVMのソースをビルド</p><p>ちょっと面倒ですが、どれも手順はしっかりしています。 LIBSVMのビルド手順はLibSvm.Netの<a href="https://github.com/takuya-takeuchi/LibSvmDotNet/wiki/Tutorial-for-Windows">Wikiでも説明しています</a>ので参考にしてください。</p><h1 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h1><p>前回と同じですが、LibSvm.Netで再実装したソースです。 というか、LibSvm.Netのリポジトリにあるサンプルです。 [code lang=”csharp”] using System; using System.Collections.Generic; using System.IO; using System.Text; using LibSvmDotNet;<br>namespace Classification10 {<br>internal class Program {<br>private static void Main() { // Create random data var r = new Random(); const int trainCount = 500; const int testCount = 100;<br>var temp = Path.GetTempPath(); var trainDic = new StringBuilder(); var testDic = new StringBuilder(); var testDicAns = new List<int>();<br>for (var l = 0; l &lt; 10; l++) { for (var i = 0; i &lt; trainCount; i++) { // Create decimal value 0 or greater but less than 10 var v = r.NextDouble() + l; trainDic.AppendLine($”{l} 1:{v}”); } for (var i = 0; i &lt; testCount; i++) { // Create decimal value 0 or greater but less than 10 var v = r.NextDouble() + l; testDic.AppendLine($”{l} 1:{v}”); testDicAns.Add(l); } }<br>var tempTrainPath = Path.Combine(temp, “train”); var tempTestPath = Path.Combine(temp, “test”);<br>using (var fs = new FileStream(tempTrainPath, FileMode.Create, FileAccess.Write, FileShare.Write)) using (var sw = new StreamWriter(fs, Encoding.ASCII)) sw.Write(trainDic.ToString());<br>using (var fs = new FileStream(tempTestPath, FileMode.Create, FileAccess.Write, FileShare.Write)) using (var sw = new StreamWriter(fs, Encoding.ASCII)) sw.Write(testDic.ToString());<br>// Load training data and test data set using (var train = Problem.FromFile(tempTrainPath)) using (var test = Problem.FromFile(tempTestPath)) { // Configure parameter var param = new Parameter { SvmType = SvmType.CSVC, KernelType = KernelType.RBF, Gamma = 0.05d, C = 5d, CacheSize = 100, Degree = 3, Coef0 = 0, Nu = 0.5, Epsilon = 1e-3, P = 0.1, Shrinking = true, Probability = false, WeightLabel = new int[0], Weight = new double[0] };<br>var message = LibSvm.CheckParameter(train, param); if (!string.IsNullOrWhiteSpace(message)) { Console.WriteLine($”Error: {message} for train problem”); return; }<br>message = LibSvm.CheckParameter(test, param); if (!string.IsNullOrWhiteSpace(message)) { Console.WriteLine($”Error: {message} for test problem”); return; }<br>// Train training data using (var model = LibSvm.Train(train, param)) { var correct = 0; var total = 0; var x = test.X; for (var i = 0; i &lt; test.Length; i++) { // Get vector from test data var array = x[i];<br>// Get classification result (returns label) var ret1 = (int)LibSvm.Predict(model, array); if (ret1 == testDicAns[i]) correct++;<br>total++; }<br>Console.WriteLine($”Accuracy: {correct / (double)total * 100}%”); } } }<br>}<br>} [/code] 前回と違い、ModelとProblemがIDisposableな事くらいですかね、違いは。 ちなみに、libsvm.net、libsvm.clrはProblem、Model、Parameter、Nodeの全てが構造体です。 対して、LibSvm.NetはNodeだけが構造体です。古い記事ですが、.NETにおける構造体とクラスの使い分けの基準となるサイズの分水嶺は16バイトです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://mag.autumn.org/Content.modf?id=20061014194823" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=mag.autumn.org"></img><div class="hbc-site-name">mag.autumn.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">時代錯誤に今更こんなことを検証するのかよ!　C#で何バイトなら構造体にして許容できるか?             【▲→川俣晶の縁側→ソフトウェア→技術雑記】          </div><div class="hbc-url">http://mag.autumn.org/Content.modf?id=20061014194823</div></div></div></div></a></div></div><p>Nodeは16バイトで境界値の真上ですが、Modelは184バイト、Paramterは104バイトです。 Modelファイルは予測処理を行う場合、頻繁に受け渡しする値です。libsvm.clrとか大丈夫? 実行すると下記のような出力を行います。ここも同じですね。 強いて言うなら、.NET Coreのコンソールになっているくらいです。 [code lang=”batch”] D:\Works\OpenSource\LibSvmDotNet\example\Classification10&gt; dotnet run -c Release * optimization finished, #iter = 84 nu = 0.166000 obj = -636.290437, rho = 0.028434 nSV = 166, nBSV = 166 * . . . optimization finished, #iter = 79 nu = 0.156000 obj = -581.389855, rho = -0.017062 nSV = 156, nBSV = 156 Total nSV = 1406 Accuracy: 99.5% [/code]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>正直車輪の再発明な気がしないでもないですが、コメントを書くに当たりSVMの資料を漁るに漁ったので単語の意味とか朧気だったのが、ある程度わかるようになっています。 日本語に直すの大変ですよ、本当に。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10">https://github.com/takuya-takeuchi/LibSvmDotNet/tree/master/example/Classification10</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net-framework </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
          <category> 機械学習 </category>
          
          <category> .NETで機械学習を試してみる LibSvm.Net編 </category>
          
          <category> LibSvm.Net </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで機械学習を試してみる libsvm.clr編 第1回</title>
      <link href="/2018/04/22/2928/"/>
      <url>/2018/04/22/2928/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>2018/04/30 更新 記事の中で実際に使用しているライブラリが間違っていました。<strong>libsvm.net</strong> ではなく <strong>libsvm.clr</strong> でした。 そのため、記事の説明を <strong>libsvm.clr</strong> に変更しています。 機械学習といえば猫も杓子もディープラーニングって感じですが、ディープラーニングを使うにはちょっと重すぎるという場合に、まだまだいけるのが **Support Vector Machine (SVM)**です。 .NETでSVMを扱えるライブラリはそこまで多くありません。</p><ul><li>Accord.NET</li><li>KMLib</li><li>LibSVMsharp</li><li>libsvm.net</li><li>libsvm.clr</li></ul><p>位が簡単に見つかるところです。 <strong>dlib</strong>でもsvmは扱えますが、ラップ処理が終わっていませんので<strong>dlib.net</strong>では扱えません。 (テンプレートを.NETを移植するのは本当に辛いです) 今回は、<strong>libsvm.clr</strong>を使います。 libsvm.clrはlibsvmをC++/CLIでビルドし直したライブラリです。 libsvmは<a href="https://ja.wikipedia.org/wiki/LIBSVM">wikipedia</a>によれば、</p><blockquote><p>LIBSVMおよびLIBLINEARは広く使われるオープンソースの機械学習ライブラリである。両方とも国立台湾大学で開発され、C言語APIを用いたC++で記述されている。</p></blockquote><p>とあります。 2000年あたりから開発されているようで、現在でも開発が続いています。 (最終更新は2016年12月!!) ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/SVM1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/SVM1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>libsvm.clrを使うには下記の作業が必要です。</p><p>1. Nugetからlibsvm.clrのインストール</p><p>以上!!! [code] Install-Package libsvm.clr.vs2015.x64 [/code] で完了です。</p><h1 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h1><p>SVMといえば、2値判定が有名ですが、多値判定も可能です。 今回は多値判定をテストします。 ただし、libsvmは遅いです。これは今後解説しますが、データが線形で分類できるなら、<strong>liblinear</strong>の使用をお勧めします。 <a href="https://www.csie.ntu.edu.tw/~cjlin/liblinear/">公式ページ</a>にも</p><blockquote><p>When to use LIBLINEAR but not LIBSVM There are some large data for which with/without nonlinear mappings gives similar performances. Without using kernels, one can quickly train a much larger set via a linear classifier. Document classification is one such application. In the following example (20,242 instances and 47,236 features; available on LIBSVM data sets), the cross-validation time is significantly reduced by using LIBLINEAR: LIBSVMではなくLIBLINEARを使用するとき 非線形マッピングが有無に関わらず、近似したパフォーマンスが得られる巨大なデータがあります。カーネルを利用しない場合、線形分類器を通じて非常に大きなデータセットを高速に訓練できます。ドキュメント分類はそのアプローチの一つです。下記のサンプル (20,242インスタンスと47,236の特徴量; LIBSVMで利用可能なデータセット) において、LIBLINEARを使用することで交差検定の時間を大幅に減らしています。 (注:345.569sが2.944sと170倍の性能をたたき出しています!!)</p></blockquote><p>とあります。 まず、学習データについて。 libsvm.clr、というかlibsvmは、学習データをテキスト形式で用意します。 各学習対象データを整数または小数のベクトルで表現します。 例えば、 [code] 0.334343 0.7080 -23222 0 54544 [/code] というデータがある場合、 [code] 1:0.334343 2:0.7080 3:-23222 5:54544 [/code] と表現します。 libsvmにおいて、0という値は無視することができます。 そのために、ベクトル内の各値の先頭に1から始める要素番号を付与することで、0をスキップしたことを認識することができます。 1行1データとして学習データを生成します。 そして、大事なことですが、labelは整数または小数で指定します。さもなくばクラッシュします。文字列なんか使えません。 今回のサンプルでは、テストデータの生成も含んでいます。 内容は、</p><ul><li>0以上10未満の小数を 0 から 9 の整数に分類</li></ul><p>というもの。 例えば、0.5455は0、8.9843は8というような感じです。 [code lang=”csharp”] using System; using System.Collections.Generic; using System.IO; using System.Text; using LibSvm;<br>namespace SupportVectorMachineTest {<br>internal class Program {<br>private static void Main() { // ランダムにデータを作成 var r = new Random(); const int trainCount = 500; const int testCount = 100;<br>var temp = Path.GetTempPath(); var trainDic = new StringBuilder(); var testDic = new StringBuilder(); var testDicAns = new List<int>();<br>for (var l = 0; l &lt; 10; l++) { for (var i = 0; i &lt; trainCount; i++) { // 0 以上 10未満の小数を生成 var v = r.NextDouble() + l; trainDic.AppendLine($”{l} 1:{v}”); } for (var i = 0; i &lt; testCount; i++) { // 0 以上 10未満の小数を生成 var v = r.NextDouble() + l; testDic.AppendLine($”{l} 1:{v}”); testDicAns.Add(l); } }<br>var tempTrainPath = Path.Combine(temp, “train”); var tempTestPath = Path.Combine(temp, “test”);<br>using (var fs = new FileStream(tempTrainPath, FileMode.Create, FileAccess.Write, FileShare.Write)) using (var sw = new StreamWriter(fs, Encoding.ASCII)) sw.Write(trainDic.ToString());<br>using (var fs = new FileStream(tempTestPath, FileMode.Create, FileAccess.Write, FileShare.Write)) using (var sw = new StreamWriter(fs, Encoding.ASCII)) sw.Write(testDic.ToString());<br>// データセットの読み込み var train = Svm.ReadProblem(tempTrainPath); var test = Svm.ReadProblem(tempTestPath);<br>// パラメータの設定 var param = new Parameter(); param.SvmType = SvmType.C_SVC; param.KernelType = KernelType.RBF; param.Gamma = 0.05d; param.C = 5d; param.CacheSize = 100; param.Degree = 3; param.Coef0 = 0; param.Nu = 0.5; param.Eps = 1e-3; param.p = 0.1; param.Shrinking = 1; param.Probability = 0; param.WeightLabel = new int[0]; param.Weight = new double[0];<br>var message = Svm.CheckParameter(train, param); if (!string.IsNullOrWhiteSpace(message)) { Console.WriteLine($”Error: {message} for train problem”); return; }<br>message = Svm.CheckParameter(test, param); if (!string.IsNullOrWhiteSpace(message)) { Console.WriteLine($”Error: {message} for test problem”); return; }<br>// 学習データとパラメータから学習 var model = Svm.Train(train, param);<br>var correct = 0; var total = 0; for (var i = 0; i &lt; test.Count; i++) { // 学習データのベクトル var x = test.x[i];<br>// 分類結果 (ラベルが返ってくる) var ret1 = (int)Svm.Predict(model, x); if (ret1 == testDicAns[i]) correct++;<br>total++; }<br>Console.WriteLine($”Accuracy: {correct / (double)total * 100}%”); }<br>}<br>} [/code] ソースを見てもそこまで難しいことはしていません。 そして、実行すると下記のような出力を行います。 [code lang=”batch”] D:\Works\OpenSource\Demo\SVM1\SupportVectorMachineTest\bin\Release&gt; .\SupportVectorMachineTest.exe * optimization finished, #iter = 84 nu = 0.166000 obj = -636.290437, rho = 0.028434 nSV = 166, nBSV = 166 * . . . optimization finished, #iter = 79 nu = 0.156000 obj = -580.913665, rho = 0.001248 nSV = 156, nBSV = 156 Total nSV = 1442 Accuracy: 99.8% [/code] 10クラスで学習データが5000、テストデータが1000で、毎回99.0%以上の精度を叩き出します。 100%で欲しかったところですが、まぁまぁでしょう。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>簡単にSVMを試すことができて良い感じではあります。 ただ、機械学習系のライブラリは、ここ最近Pythonのが手軽な感じが否定できません。 もう少し日本語のドキュメントやC#のライブラリが充実してくれると良いのですが….</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/SVM1">https://github.com/takuya-takeuchi/Demo/tree/master/SVM1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net-framework </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETで機械学習を試してみる libsvm.clr編 </category>
          
          <category> 機械学習 </category>
          
          <category> libsvm.clr </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その110 Debian with Raspberry Pi Desktop on VirtualBoxでWebCamがselect timeoutで使えない</title>
      <link href="/2018/04/16/2923/"/>
      <url>/2018/04/16/2923/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>WebCamをVirtualBox上のゲストOS <strong>Debian with Raspberry Pi Desktop</strong> に接続してキャプチャをしても動かない件。<br>具体的には、</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select timeout </span><br></pre></td></tr></table></figure><p>と表示され何も動作しない。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>下記のページが参考になりました。</p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://farshbaf.net/en/artificial-intelligence/blog/usb-camera-error-virtual-machine-virtual-box-vmware-open-cv" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=farshbaf.net"></img><div class="hbc-site-name">farshbaf.net</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">USB 2.0 camera error on Virtual Machine (Virtual Box, VMWare) in Open CV : Farshbaf.NET Artificial Intelligence BlogUSB 2.0 camera error on Virtual Machine (Virtual Box, VMWare) in Open CV : Farshbaf.NET Artificial Intelligence Blog</div><div class="hbc-url">https://farshbaf.net/en/artificial-intelligence/blog/usb-camera-error-virtual-machine-virtual-box-vmware-open-cv</div></div></div></div></a></div></div><blockquote><p>I have change the usb setting in VM ware settings and make it to support USB 3.0. On the other hand I attached the camera to a USB 2.0 port and that works both of them</p></blockquote><p>要するに、</p><ul><li>USB 3.0をサポートするように仮想マシンの設定を変更</li><li>カメラをUSB 2.0ポートに接続</li></ul><p>ということ。<br>仮想マシン設定の<strong>USB</strong>から <strong>USB 3.0 (xHCI) コントローラー</strong>に変更すればOKです。</p><p>これでうまく動きます。<br>コードは下記です。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">c = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line">c.set(cv2.cv.CV_CAP_PROP_FRAME_WIDTH, <span class="number">1200</span>)</span><br><span class="line">c.set(cv2.cv.CV_CAP_PROP_FRAME_HEIGHT, <span class="number">800</span>)</span><br><span class="line">r, img = c.read()</span><br><span class="line">cv2.imwrite(<span class="string">&#x27;./capture.jpg&#x27;</span>, img)</span><br><span class="line">c.release()</span><br></pre></td></tr></table></figure><p>ただ、上のコードだと保存される画像が、960x544になっていました。<br>これは、指定したサイズがカメラでサポートしているサイズではなかったためです。<br>恐らく指定したサイズに何かしらのルールで近しいサイズに強制的に変更していると思われます。<br>テストしたカメラには、確かに960x544というサイズがありました。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Linux </category>
          
          <category> Python </category>
          
          <category> linux </category>
          
          <category> マルチメディア </category>
          
          <category> OpenCV </category>
          
          <category> Debian </category>
          
          <category> VirtualBox </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その109 Debian with Raspberry Pi Desktop on VirtualBoxでUSB機器を有効にする</title>
      <link href="/2018/04/14/2906/"/>
      <url>/2018/04/14/2906/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>VirtualBoxを使うメリットでゲスト側でUSB機器を使えることにあります。 Hyper-Vでも使えないことはないのですが、<strong>RemoteFX USB リダイレクト</strong>とかよーわからないテクノロジーを使わないといけません。 ましてやゲストOSが<strong>Windows 10 Enterprise限定</strong>。こんなのおかしいよ!! じゃぁVirtualBoxでUSB機器を使うのが簡単か？というとそうでもない。</p><h1 id="What’s-problem"><a href="#What’s-problem" class="headerlink" title="What’s problem?"></a>What’s problem?</h1><p>通常、仮想OSウィンドウの右下にあるUSBアイコンから認識したいUSB機器を選択すればよいのだが、それが失敗する。<br><a href="../../../../public/2018/04/317d696c3bfd24ac32f064ca810081a0.png"><img src="../../../../public/2018/04/317d696c3bfd24ac32f064ca810081a0.png"></a><br> 何がダメなのか詳しいメッセージをください…</p><h1 id="How-to-use-USB-device"><a href="#How-to-use-USB-device" class="headerlink" title="How to use USB device?"></a>How to use USB device?</h1><p>ゲストOSの拡張コンポーネント<strong>Extension Pack</strong>をインストールする必要があります。</p><h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p>まず<a href="https://www.virtualbox.org/wiki/Downloads">公式</a>からダウンロードしてきます。<br><a href="../../../../public/2018/04/963fabf15991782128f0722ecbd09523.png"><img src="../../../../public/2018/04/963fabf15991782128f0722ecbd09523-1024x563.png"></a></p><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>続いてインストール。 <strong>ファイル -&gt; 環境設定</strong>からダイアログを開き、<strong>機能拡張</strong>タブを選択します。<br><a href="../../../../public/2018/04/e6eee08249c76789b91a4b5cf8e31c08.png"><img src="../../../../public/2018/04/e6eee08249c76789b91a4b5cf8e31c08.png"></a> 右側の**+**ボタンを選択し、ダウンロードしてきたファイルを選択します。 <a href="../../../../public/2018/04/47d37e15108b1cf1bcb9880d8a6a91d4.png"><img src="../../../../public/2018/04/47d37e15108b1cf1bcb9880d8a6a91d4.png"></a> ライセンス条項は、最下段までスクロールしないと同意できません。 <a href="../../../../public/2018/04/df76f3497d7f931b48bdaacd11d0a519.png"><img src="../../../../public/2018/04/df76f3497d7f931b48bdaacd11d0a519.png"></a> <a href="../../../../public/2018/04/15f457906cd670e1f9d33563db0d9ceb.png"><img src="../../../../public/2018/04/15f457906cd670e1f9d33563db0d9ceb.png"></a> <a href="../../../../public/2018/04/5fca4a2b74a994ec3ae9d19ca25360fe.png"><img src="../../../../public/2018/04/5fca4a2b74a994ec3ae9d19ca25360fe.png"></a></p><h2 id="Enable-USB"><a href="#Enable-USB" class="headerlink" title="Enable USB"></a>Enable USB</h2><p>インストールできたらUSBを有効にします。 次は、ゲストOSの設定から<strong>USB</strong>を選択します。ゲストOS起動中には使えません。<br><a href="../../../../public/2018/04/2211d79632a7dea43e7ff269cab1b47d.png"><img src="../../../../public/2018/04/2211d79632a7dea43e7ff269cab1b47d.png"></a> 右側の**+<strong>ボタンから追加したいデバイスを選択、追加します。 <a href="../../../../public/2018/04/dfc2f823564cd2f022574cdcae836b7a.png"><img src="../../../../public/2018/04/dfc2f823564cd2f022574cdcae836b7a.png"></a> 機器によっては、</strong>USB 3.0 (xHCI)<br> コントローラー<strong>を選択しないとゲストOSが認識してくれません。 上の画像の</strong>Intel Realsense**がまさにそれです。 実際のデバイスがUSB 3.0ポートにつながっているかどうかは関係ないです。 設定完了後、ゲストOSを起動して、先述のエラーメッセージが表示されなければ成功です。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Debian </category>
          
          <category> VirtualBox </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その108 Debian with Raspberry Pi Desktop on VirtualBoxでGuest Additionsを追加する</title>
      <link href="/2018/04/14/2910/"/>
      <url>/2018/04/14/2910/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>VirtualBoxでもHyper-Vのゲスト拡張機能のようなものが用意されています。</p><h1 id="How-to-install"><a href="#How-to-install" class="headerlink" title="How to install?"></a>How to install?</h1><p>VirtualBox上のDebian with Raspberry Pi Desktopへの拡張インストールは下記が詳しいです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.aoakley.com/articles/2017-07-04-raspbian-x86-virtualbox.php" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.aoakley.com"></img><div class="hbc-site-name">www.aoakley.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="images/rpi-x86-vbox/rv00-desktop.jpg"></img></div><div class="hbc-text"><div class="hbc-title">Raspbian x86 on VirtualBox on a Windows PC</div><div class="hbc-url">http://www.aoakley.com/articles/2017-07-04-raspbian-x86-virtualbox.php</div><div class="hbc-description">How to run a Raspberry Pi desktop as a virtual machine on your Microsoft Windows PC or laptop.</div></div></div></div></a></div></div><p>ちなみに先にssh接続できるようにしておくと、コマンドをコピペできるので間違えなくて済みます。 まず、次のコマンドでDebianのリポジトリを使用可能にします。どうもRaspbianのGuest Additionsは長らくメンテされていない模様。 [code lang=”sh”] sudo apt update sudo apt install -y dirmngr sudo apt-key adv –keyserver keyserver.ubuntu.com –recv-key 8B48AD6246925553 sudo apt-key adv –keyserver keyserver.ubuntu.com –recv-key 7638D0442B90D010 echo “deb <a href="http://ftp.debian.org/debian">http://ftp.debian.org/debian</a> stretch-backports main contrib non-free” | sudo tee /etc/apt/sources.list.d/backports.list sudo chmod 644 /etc/apt/sources.list.d/backports.list [/code] ちなみに、apt-keyは下記の引数でproxyを指定することができます。会社とかのセキュアの環境ではこれが必要になるでしょう。 [code lang=”sh”] –keyserver-option http-proxy=http://<user>:<password>@<serveraddress>:<port> [/code] そしてインストール。 [code lang=”sh”] sudo apt update sudo apt install virtualbox-guest-dkms virtualbox-guest-x11 linux-headers-$(uname -r) sudo shutdown -r now [/code] これで拡張機能が使えます。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Debian </category>
          
          <category> VirtualBox </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その107 Debian with Raspberry Pi Desktop on VirtualBoxにssh接続</title>
      <link href="/2018/04/14/2902/"/>
      <url>/2018/04/14/2902/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Windows10のVirtualBox上に構築した<strong>Debian with Raspberry Pi Desktop</strong>に対して、ssh接続するのに少し嵌ったのでメモ。</p><h1 id="How-to-do"><a href="#How-to-do" class="headerlink" title="How to do?"></a>How to do?</h1><p>VirtualBox内の仮想マシンに外部からアクセスする場合、VirtualBoxのネットワーク設定を<strong>NAT</strong>にした上で、指定したポートを仮想マシンにポートフォワードする必要がある。 通常、sshは22で待ち受けるので、ホストPCへの22宛の通信をゲストOSの22へフォワードすればよい。 が、これがうまくいかない。 外から、sshでホストPC宛に接続を試みても、 [code lang=”shell”] Permission denied, please try again. [/code] というエラーが返ってくる。 そこで、下記のコマンドで、sshの接続に失敗したログを見てみる。 [code lang=”shell”] $ cat /var/log/auth.log | grep ‘sshd.*Invalid’ [/code] しかし、ログそのものが出力されていない。 こうなると、そもそもssh接続が仮想マシン側に到達していない、と考えるとが筋である。 なので、ポートフォワーディングを<br><a href="../../../../public/2018/04/3a495773eb924093597eb101367c034a.png"><img src="../../../../public/2018/04/3a495773eb924093597eb101367c034a.png"></a><br> のようにし、22ポート以外に変更する。 ssh接続も [code lang=”shell”] $ ssh <user>@<address> -p 222 [/code] に変更する。 こうすると上手くいった。</p><h1 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h1><p>ポートフォーワーディングは転送元ポートと転送先ポートが同じでも問題ないはずである。 なのにそれが失敗したのは、ホスト側で別のアプリが22でLISTENしていたからだと考えられる。 なので、ホストPCでLISTENしているポートを調べてみた。 外部から22ポート宛にssh接続してみる。 [code lang=”batch”] C:\Users\TAKUYA&gt;netstat | find “22” TCP 192.168.11.11:22 TAKUYA-PC2:52037 CLOSE_WAIT TCP 192.168.11.11:222 TAKUYA-PC2:51989 TIME_WAIT [/code] なんか22ポート使っている奴がいる… Windows10端末で22ポートで待ち受けするアプリなぞ思い当たらないので、調べてみた。 下記の記事を発見。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://ascii.jp/elem/000/001/555/1555599/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ascii.jp"></img><div class="hbc-site-name">ASCII.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ascii.jp/img/2017/09/24/1617423/l/079e96ef18c845c9.jpg?20200122"></img></div><div class="hbc-text"><div class="hbc-title">Windows 10でSSH（Secure Shell）サーバーを使う</div><div class="hbc-url">http://ascii.jp/elem/000/001/555/1555599/</div><div class="hbc-description">Windows 10のAnniversary Update（RS1）から、開発者モードをオンにすると、SSHサーバーが起動するようになっている。</div></div></div></div></a></div></div><p>上の記事によると、</p><blockquote><p>ハッキリしているのは、Windows 10（Desktop、Mobile、IoT）で開発者モードをオンにすると、SSH関連の2つのサービス（SSH Server Broker、SSH Server Proxy）が起動するようになるということだ。</p></blockquote><p><a href="../../../../public/2018/04/d7bdf4723b1f3f3ddf5e5357e124316c.png"><img src="../../../../public/2018/04/d7bdf4723b1f3f3ddf5e5357e124316c-1024x530.png"></a><br> 確かに動いています。 気づかなかった… とりえあず、Windows10端末でssh接続する予定はないので、この2つのサービスの自動起動を無効、停止しました。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Debian </category>
          
          <category> VirtualBox </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その106 compattelrunner.exeを停止する</title>
      <link href="/2018/04/14/2896/"/>
      <url>/2018/04/14/2896/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>少し古いWindows10マシン上でHDDへのアクセスがいつまでたっても100%のままで不安を覚え、リソースモニターでチェックしたのが事の始まり。 いくつか暴れまわっているプロセスの中で目に留まったのが <strong>compattelrunner.exe</strong>。何ぞこれぇ？</p><h1 id="What-is-compattelrunner-exe"><a href="#What-is-compattelrunner-exe" class="headerlink" title="What is compattelrunner.exe?"></a>What is compattelrunner.exe?</h1><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://blog.yam5.com/archives/1558" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=blog.yam5.com"></img><div class="hbc-site-name">blog.yam5.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">CompatTelRunner.exeを停止してWindows 10を軽くする方法 – コログ</div><div class="hbc-url">https://blog.yam5.com/archives/1558</div><div class="hbc-description">Windows 10を起動すると、1分近くHDDがガリガリ言ってることがあります。 高速なSSDでは影響ないかもしれませんが、HDDは大量のファイル読み書きが行われていると、他の動作も遅くなりパソコン操作に支障が出ます。 リソースモニターで探していると、 CompatTelRun…</div></div></div></div></a></div></div><p>上記ページによれば、</p><blockquote><p>カスタマーエクスペリエンス向上プログラム（マイクロソフトへの情報提供）に関するアプリケーションですが、これに同意していなくても強制的に起動し、起動時に怪しげな動作をします。</p></blockquote><p>とのこと。 名称からすると <strong>Compatible Telemetry Runner (互換性テレメトリーランナー)</strong> って感じです。 やることが鬼畜です顧客思いですね、Microsoftさん。 だけど、HDDに強烈なボディブローを長時間与えるのはよろしくないので、停止させていただきます。</p><h2 id="タスクスケジューラの起動"><a href="#タスクスケジューラの起動" class="headerlink" title="タスクスケジューラの起動"></a>タスクスケジューラの起動</h2><p>コントロールパネルからでもよいですが、Windows 10だとコントロールパネルへのアクセスが面倒なので、<strong>ファイル名を指定して実行</strong>より<strong>Taskschd.msc</strong>を起動</p><h2 id="compattelrunner-exeの起動タスクを停止"><a href="#compattelrunner-exeの起動タスクを停止" class="headerlink" title="compattelrunner.exeの起動タスクを停止"></a>compattelrunner.exeの起動タスクを停止</h2><p>まず、左側の<strong>タスクスケジューラライブラリ</strong>から <strong>Microsoft -&gt; Windows -&gt; Application Experience</strong> を選択。<br><a href="../../../../public/2018/04/2397a66fe2aa6255ab4e453792289f8c.png"><img src="../../../../public/2018/04/2397a66fe2aa6255ab4e453792289f8c.png"></a> 続いて、右側の<strong>Microsoft Compatibility Appraiser</strong> を選択してダブルクリック <a href="../../../../public/2018/04/f412e60bccb1f394aefa1ac20d4dee61.png"><img src="../../../../public/2018/04/f412e60bccb1f394aefa1ac20d4dee61.png"></a> <strong>操作タブ</strong>に移動 <a href="../../../../public/2018/04/1d64d7d049ddf745178272b471302501.png"><img src="../../../../public/2018/04/1d64d7d049ddf745178272b471302501.png"></a><br> compattelrunner.exeの開始を確認。 ダイアログを閉じ、<strong>Microsoft Compatibility Appraiser</strong>を右クリック、コンテキストメニューから<strong>無効</strong>を選択。 これで自動起動が止まります。</p><p>しかし、これでカスタマーエクスペリエンス向上につながるとは思えないんですけどね…</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その105 Hyper-VでDebian with Raspberry Pi Desktop を使う</title>
      <link href="/2018/04/13/2863/"/>
      <url>/2018/04/13/2863/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Raspberry Piを使ったデモシステムの構築を計画しており、見積書、発注まで来ているのですが、如何せんLinuxなので早めに調査をしておこうと思い、仮想環境上で実行環境を作ろうとしたのが始まり。 といっても会社はWindows7マシンでHyper-Vなぞ使えないし、Hyper-Vサーバーはありますがネットワークが別で、それがネックになり、泣く泣くVirtualBoxで環境を作りました。 でも自宅はHyper-V、細かいことは気にしない。</p><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><h2 id="ISOの入手"><a href="#ISOの入手" class="headerlink" title="ISOの入手"></a>ISOの入手</h2><p>まずはOSイメージのダウンロード。公式サイト<a href="https://www.raspberrypi.org/downloads/raspberry-pi-desktop/">RASPBERRY PI DESKTOP</a>からゲットします。<br><a href="../../../../public/2018/04/screencapture-raspberrypi-org-downloads-raspberry-pi-desktop-2018-04-13-19_34_42.png"><img src="../../../../public/2018/04/screencapture-raspberrypi-org-downloads-raspberry-pi-desktop-2018-04-13-19_34_42-1024x796.png"></a></p><h2 id="仮想マシンの用意"><a href="#仮想マシンの用意" class="headerlink" title="仮想マシンの用意"></a>仮想マシンの用意</h2><p>Hyper-Vマネージャーから仮想マシンを用意します。 今回は、Raspberry Pi 3に近しい性能にするため、</p><ul><li>メモリ1GB</li><li>HDD16GB</li></ul><p>に制限します。<br><a href="../../../../public/2018/04/04529353e5e48511242d91cf30ed0a8d.png"><img src="../../../../public/2018/04/04529353e5e48511242d91cf30ed0a8d.png"></a> <a href="../../../../public/2018/04/be7df588ff60ea488947ccb2b33369ce.png"><img src="../../../../public/2018/04/be7df588ff60ea488947ccb2b33369ce.png"></a> <a href="../../../../public/2018/04/d16be71b3ed5f96b2d84c72ed859bf0d.png"><img src="../../../../public/2018/04/d16be71b3ed5f96b2d84c72ed859bf0d.png"></a> <a href="../../../../public/2018/04/1f76318ac1e20e6f16f913d2b617236a.png"><img src="../../../../public/2018/04/1f76318ac1e20e6f16f913d2b617236a.png"></a> <a href="../../../../public/2018/04/29079c0e9b0a8fde4f8929230cf74f4d.png"><img src="../../../../public/2018/04/29079c0e9b0a8fde4f8929230cf74f4d.png"></a> <a href="../../../../public/2018/04/7b019e1409d5f7e7223aaad4051c88a2.png"><img src="../../../../public/2018/04/7b019e1409d5f7e7223aaad4051c88a2.png"></a> <a href="../../../../public/2018/04/a6e73b1d38bef6c6ad88cffda523d689.png"><img src="../../../../public/2018/04/a6e73b1d38bef6c6ad88cffda523d689.png"></a></p><h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p>仮想マシンンにインストールします。<br><a href="../../../../public/2018/04/fc77969e5383b348cb76340b9fd7bce1.png"><img src="../../../../public/2018/04/fc77969e5383b348cb76340b9fd7bce1.png"></a> <a href="../../../../public/2018/04/c26948fa1e137a5a756769b857ca3337.png"><img src="../../../../public/2018/04/c26948fa1e137a5a756769b857ca3337.png"></a> <a href="../../../../public/2018/04/fd3200ecdbc67c8b1a01a771c866e9da.png"><img src="../../../../public/2018/04/fd3200ecdbc67c8b1a01a771c866e9da.png"></a> <a href="../../../../public/2018/04/f0550ec4d2dad10a5bfe0232254ea263.png"><img src="../../../../public/2018/04/f0550ec4d2dad10a5bfe0232254ea263.png"></a> <a href="../../../../public/2018/04/d4733f3f7bdb19f0d866826de6189fd3.png"><img src="../../../../public/2018/04/d4733f3f7bdb19f0d866826de6189fd3.png"></a> <a href="../../../../public/2018/04/38bc67a2734fe5150516ae5ff435c63b.png"><img src="../../../../public/2018/04/38bc67a2734fe5150516ae5ff435c63b.png"></a> <a href="../../../../public/2018/04/295bbfb3d0d6dbf54e6de70697f62e42.png"><img src="../../../../public/2018/04/295bbfb3d0d6dbf54e6de70697f62e42.png"></a> <a href="../../../../public/2018/04/ac8991b472dfdbc791a148edea6b2e81.png"><img src="../../../../public/2018/04/ac8991b472dfdbc791a148edea6b2e81.png"></a> <a href="../../../../public/2018/04/f5cad5476d9f775a418e91691cd14a95.png"><img src="../../../../public/2018/04/f5cad5476d9f775a418e91691cd14a95.png"></a> <a href="../../../../public/2018/04/4ac6cbefa7fc87e05ab6d785f5f70d0d.png"><img src="../../../../public/2018/04/4ac6cbefa7fc87e05ab6d785f5f70d0d.png"></a> <a href="../../../../public/2018/04/0d9a6c2b8cf432cf470158516b5fe8a5.png"><img src="../../../../public/2018/04/0d9a6c2b8cf432cf470158516b5fe8a5.png"></a> <a href="../../../../public/2018/04/f9c4327009f7ce2bcd7733c46dc27d52.png"><img src="../../../../public/2018/04/f9c4327009f7ce2bcd7733c46dc27d52.png"></a> <a href="../../../../public/2018/04/28c1675f5c15d64aa95066b0571242ff.png"><img src="../../../../public/2018/04/28c1675f5c15d64aa95066b0571242ff.png"></a><br> これでインストールは完了です。 一度仮想マシンを停止して、ISOファイルを取り出します。そうしないと、インストール画面が再度表示されてしまいます。</p><h2 id="起動"><a href="#起動" class="headerlink" title="起動"></a>起動</h2><p>インストールが終わったので、起動してみます。<br><a href="../../../../public/2018/04/59ead51a2e8d9d54f279a6cc6d298d49.png"><img src="../../../../public/2018/04/59ead51a2e8d9d54f279a6cc6d298d49.png"></a> <a href="../../../../public/2018/04/2677311d412b54596df96bdcd06ad482.png"><img src="../../../../public/2018/04/2677311d412b54596df96bdcd06ad482.png"></a><br> 無事にデスクトップが表示されました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> IoT </category>
          
          <category> Hyper-V </category>
          
          <category> iot </category>
          
          <category> Raspbian </category>
          
          <category> Raspberry Pi </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで自動テストを試してみる 第1回</title>
      <link href="/2018/04/10/2852/"/>
      <url>/2018/04/10/2852/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>会社の海外現地法人にて、自動テストでコスト削減、みたいなことが話にあがり、こっちでもやらないとダメだよね、って話になりました。 その際に話題にあがったのが<strong>Appium</strong>。 <strong>Selenium</strong>と名前が少し似ているので、関係があると思ったら、まぁその通りで。 Seleniumは使ったことはなくて、Webアプリ用でしょ?デスクトップアプリに関係ない?と思ったら今は違っていて、Selenium(に互換のあるAPIを持つアプリ)がWebサーバーとして動作し、テスト対象アプリとテストを指示するクライアントを仲介することで、iOS、Android、VB(レガシーだよ!!)とか何でもござれのご様子。 <strong>RPA(Robotics Process Automation)**の一種やないと思い始めまして、ちょっと興味が。 で、Selenium互換のAPIを持つのがAppium。そのAppiumを経由することでWindowsアプリを操作することもできます。 ちなみに、この話は、</strong>Windows 10が対象で、7や8では試せません。** ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Appium1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Appium1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h1><p>Appiumを使うには下記の作業が必要。</p><p>1. Windows Application Driverのインストール</p><p>2. テストの記述・実行</p><h2 id="Windows-Application-Driverのインストール"><a href="#Windows-Application-Driverのインストール" class="headerlink" title="Windows Application Driverのインストール"></a>Windows Application Driverのインストール</h2><p>Windowsアプリを対象にするには、<strong>Windows Application Driver (WinAppDriver)</strong> が必要。 テスト対象Windowsアプリとテスト(を指示するアプリ)クライアントを仲介し、Windowsアプリの仕様や挙動を伝えるI/Fってことです。 まずは、こいつをインストールします。 下記からインストーラをダウンロードし、実行します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/Microsoft/WinAppDriver/releases" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/6154722?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">Releases · microsoft/WinAppDriver</div><div class="hbc-url">https://github.com/Microsoft/WinAppDriver/releases</div><div class="hbc-description">Windows Application Driver. Contribute to microsoft/WinAppDriver development by creating an account on GitHub.</div></div></div></div></a></div></div><p>インストールは大したことないので割愛。 どうでもいいですが、Windows7でもインストールは出来ますが、最終的にテスト実行時に<br><a href="../../../../public/2018/04/4c4a0878b1408f4534fcf9019e0f0e6a.png"><img src="../../../../public/2018/04/4c4a0878b1408f4534fcf9019e0f0e6a.png"></a></p><p>となりますので無駄骨です。</p><h2 id="テストの記述・実行"><a href="#テストの記述・実行" class="headerlink" title="テストの記述・実行"></a>テストの記述・実行</h2><p>もうテストが書けます!! <strong>Nuget</strong>でライブラリが配布されていますので、テストを記述したアプリを作成します。 基本は、</p><p>Windows Application Driverの起動</p><p>テストの記述・実行</p><p>です。 サンプルがネットに転がっているので少し改造させてもらいます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.ka-net.org/blog/?p=6879" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.ka-net.org"></img><div class="hbc-site-name">初心者備忘録</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://www.ka-net.org/blog/wp-content/uploads/eyecatch-Selenium.png"></img></div><div class="hbc-text"><div class="hbc-title">Windows Application Driverを試してみました。</div><div class="hbc-url">https://www.ka-net.org/blog/?p=6879</div><div class="hbc-description">Build 2016のセッション「UI Test Automation for Browsers and Ap…</div></div></div></div></a></div></div><p>上の記事は電卓(ただしUWP製の)を操作します。 が、こっちは、ネイティブのGuidgen.exeを操作してみます。 最初に <script src="https://gist.github.com/takuya-takeuchi/843d5c3664179dd8db886809f323fc48.js"></script> で、nugetの参照を追加します。 次はソースです。 <script src="https://gist.github.com/takuya-takeuchi/bd3509fb2c255eed8c6b8237830281c4.js"></script> 特に迷うポイントはありませんが、ボタンを探す際、ニーモニックがあると戸惑うくらいでしょう。 各コントロールの名前は、<strong>inspect.exe</strong>を使って調べることができます。<br><a href="../../../../public/2018/04/7785a5f7a54238bad49205954537c163.png"><img src="../../../../public/2018/04/7785a5f7a54238bad49205954537c163.png"></a> プログラムを実行すると、コンソールでWinAppDriver.exeが立ち上がり、Guidgen.exeが自動で操作されています。 <a href="../../../../public/2018/04/f141f66a167ac8ec698aed5c1856143c.png"><img src="../../../../public/2018/04/f141f66a167ac8ec698aed5c1856143c-1024x649.png"></a><br> 注意して欲しいのは、マウスカーソルが奪われますので、作業するのは止めた方が良いです。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Appium1">https://github.com/takuya-takeuchi/Demo/tree/master/Appium1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> Windows Application Driver </category>
          
          <category> .NETで自動テストを試してみる </category>
          
          <category> 自動テスト </category>
          
          <category> Appium </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その104 260文字を超えるパスを有効にする 追試験</title>
      <link href="/2018/04/05/2835/"/>
      <url>/2018/04/05/2835/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>以前、<a href="https://taktak.jp/2016/08/11/1502">開発メモ その9 260文字を超えるパスを有効にする</a>という記事を書いたのですが、どうもCreators Update以降、微妙に挙動が変わっているように見えます。 具体的には、レジストリを有効にし、app.configに設定を追記しても、長いパスが有効にならないのです。 検証は、</p><ul><li>Hyper-V上に英語版の<strong>Aniversary Update (Winver 1607)**、</strong>Creators Update (Winver 1703)**を新規に構築</li><li>ループポリシーで設定を有効にし、かつレジストリに設定が正しく書き込まれていることを確認</li><li>.NET 4.6.2.でビルドし、かつapp.configを用意</li></ul><p>それが下記の結果です。<br><a href="../../../../public/2018/04/5f1ffdff10528bf1a6f9bf9e25aed881.png"><img src="../../../../public/2018/04/5f1ffdff10528bf1a6f9bf9e25aed881-1024x655.png"></a><br> <strong>Aniversary Update</strong></p><p><a href="../../../../public/2018/04/f4c5b1a3c86b27c98d45b13955423373.png"><img src="../../../../public/2018/04/f4c5b1a3c86b27c98d45b13955423373-1024x655.png"></a><br> <strong>Creators Update</strong></p><p>同じサンプルを実行させたのに結果が違います。 何故でしょう?</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>対応策は、manifestを埋め込む、ということだけです。 埋め込むmanifestは [code lang=”xml”] <application xmlns="urn:schemas-microsoft-com:asm.v3"> <windowsSettings xmlns:ws2="http://schemas.microsoft.com/SMI/2016/WindowsSettings"> <a href="ws2:longPathAware">ws2:longPathAware</a>true</ws2:longPathAware> </windowsSettings> </application> [/code] です。 下記はmanifestを埋め込んだ結果です。<br><a href="../../../../public/2018/04/f0a6f771180a934e6c1d553737b72cbe.png"><img src="../../../../public/2018/04/f0a6f771180a934e6c1d553737b72cbe-1024x655.png"></a><br> <strong>Creators Update</strong></p><p>しかし、manifestを埋め込む、ということ自体は以前からMSDNに書いてあったはずです。 </p><p>上のページの途中の説明です。</p><blockquote><p>A registry key allows you to enable or disable the new long path behavior. To enable long path behavior set the registry key at HKLM\SYSTEM\CurrentControlSet\Control\FileSystem LongPathsEnabled (Type: REG_DWORD). The key’s value will be cached by the system (per process) after the first call to an affected Win32 file or directory function (list follows). The registry key will not be reloaded during the lifetime of the process. In order for all apps on the system to recognize the value of the key, a reboot might be required because some processes may have started before the key was set. The registry key can also be controlled via Group Policy at Computer Configuration &gt; Administrative Templates &gt; System &gt; Filesystem &gt; Enable NTFS long paths. You can also enable the new long path behavior per app via the manifest:</p></blockquote><p>要するに、</p><blockquote><p>レジストリキーが長いパスの新しい扱いの有効/無効を許可します。長いパスの扱いを有効にするために、**HKLM\SYSTEM\CurrentControlSet\Control\FileSystem LongPathsEnabled (Type: REG_DWORD)** にキーを設定します。キーの値は、影響のあるwin32のファイルまたはディレクトリ関数(後述のリスト)の最初の呼び出し後、システム(プロセス毎)によって、キャッシュされます。レジストリキーはプロセスの生存中は再読込されません。 システム上の全てのアプリケーションにキーの値を認識させるために、いくつかのプロセスは値が設定される前に起動されたがために、システムの再起動を要求されるかもしれません。 レジストリキーはグループポリシーの<strong>コンピューターの構成 -&gt; 管理用テンプレート -&gt; システム -&gt; ファイルシステム -&gt; Win32 の長いパスを有効にする</strong> によっても制御することが出来ます。 また、マニフェストによっても新しい長いパスの扱いを有効にすることが出来ます。</p></blockquote><p>です。 本文の<strong>also</strong>の係りをみるに、レジストリキーの設定さえあればOKのはずです。 ぶっちゃけ理由がわかりません。 が、manifestを有効にすれば動作しました。 最終的な検証は下記の通り。 [table id=27 /]</p><p>結局、Creators Updateから長いパスを扱うには、</p><ul><li>グループポリシー (またはレジストリ) の設定を有効</li><li>manifestで長いパスを扱えるよう設定</li></ul><p>の<strong>両方</strong>を満たす必要があるようです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その103 Sony Neural Network LibrariesのC++ライブラリをビルドする</title>
      <link href="/2018/04/01/2830/"/>
      <url>/2018/04/01/2830/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>そこまで面倒なことはないけど、自分メモ。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>ソースは上から入手。 手順は<a href="https://github.com/sony/nnabla/blob/master/doc/build/build_cpp_utils_windows.md">Build C++ libraries on Windows</a>に書いてあるとおり。 C++のライブラリだけど、それを作るのにPythonが必要です。 動かすのにPythonがいるわけではないです。 (ただし、学習はPythonが必要で推論はC++だけOK)</p><ol><li>clone</li><li>nnabla\build-tools\msvc\setup_cpp_utils_deps.bat を実行</li><li>nnabla\build-tools\msvc\cmake_cpp_utils.bat を実行</li></ol><p>です。 途中、Pythonでモジュールが足りない、って言われるときがあります。 [code lang=”batch”] $ cmake -G “Visual Studio 14 2015 Win64” -DBUILD_CPP_UTILS=ON -DBUILD_PYTHON_PACKAGE=OFF -DLibArchive_LIBRARY=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\libarchive-v3.3.2\build-folder\libarchive\Release\archive.lib -DLibArchive_INCLUDE_DIR=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\libarchive-v3.3.2\libarchive -DProtobuf_INCLUDE_DIR=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\protobuf-v3.4.1\src -DProtobuf_LIBRARY=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\protobuf-v3.4.1\build-folder\Release\libprotobuf.lib -DProtobuf_LITE_LIBRARY=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\protobuf-v3.4.1\build-folder\Release\libprotobuf-lite.lib -DProtobuf_PROTOC_EXECUTABLE=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\protobuf-v3.4.1\build-folder\Release\protoc.exe -DPROTOC_COMMAND=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\protobuf-v3.4.1\build-folder\Release\protoc.exe D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\.. -DZLIB_LIBRARY_RELEASE=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\zlib123dllx64\dll_x64\zlibwapi.lib -DZLIB_INCLUDE_DIR=D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\msvc\..\..\third_party\zlib123dllx64 || GOTO :error Traceback (most recent call last): File “D:/Works/OpenSource/NeuralNetworkLibrariesDotNet/nnabla/build-tools/code_generator/generate.py”, line 90, in <module> generate() File “D:/Works/OpenSource/NeuralNetworkLibrariesDotNet/nnabla/build-tools/code_generator/generate.py”, line 67, in generate solver_info, solver_types) File “D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\code_generator\code_generator_utils.py”, line 204, in generate_init generate_from_template(template, **kwargs) File “D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\code_generator\code_generator_utils.py”, line 95, in generate_from_template filename=path_template, template_kwargs=kwargs) File “D:\Works\OpenSource\NeuralNetworkLibrariesDotNet\nnabla\build-tools\code_generator\code_generator_utils.py”, line 54, in render_with_template from mako.template import Template ImportError: No module named mako.template CMake Error at CMakeLists.txt:67 (message): generate.py failed.<br>-- Configuring incomplete, errors occurred! See also “D:/Works/OpenSource/NeuralNetworkLibrariesDotNet/nnabla/build/CMakeFiles/CMakeOutput.log”. [/code] 上の場合は、<strong>mako.template</strong> が無いって文句言ってますので [code lang=”batch”] $ python -m pip install mako [/code] みたいにインストールします。</p><p>エラーが無ければ、<strong>nnabla\build\bin\Release</strong> にlibも含めたライブラリが生成されます。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Neural Network Libraries </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その102 CMakeから別ライブラリのクラスを呼び出す</title>
      <link href="/2018/03/31/2807/"/>
      <url>/2018/03/31/2807/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>会社で自社作成のクラスを提供する話がありましたが、ソースではなく、ライブラリとして提供することになりました。 選択肢は、</p><ol><li>静的ライブラリ</li><li>共有ライブラリ</li></ol><p>の2択。 静的にしても良かったのですが、CMakeで共有ライブラリを作って、クラスを呼んだことがないので、共有にしてみました。 サンプルソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/CMake3" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/CMake3</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>基本的に動的ライブラリを作るのは問題ありません。 <strong>CMakeLists.txt</strong>に [code lang=”cmake”] add_library(${PROJ_NAME} SHARED ${SOURCES} ${HEADERS}) [/code] 上記のように<strong>SHARED</strong>をつければ、dllまたはsoファイルが生成されます。 しかし、Windowsの場合、共有ライブラリを使用するには、libファイルが必要になります。 下記のクラスをdllにした場合、どうなるでしょう? [code lang=”cpp”] #ifndef _CPP_TEST_H_ #define _CPP_TEST_H_<br>class Test { public: Test(); virtual ~Test();<br>int Sum(int a, int b); };<br>#endif [/code] 生成されたdllを<strong>Dependency Walker</strong>で見てみました。<br><a href="../../../../public/2018/03/a72515a6c999250744da1596f1b009ce.png"><img src="../../../../public/2018/03/a72515a6c999250744da1596f1b009ce.png"></a><br> 何もエクスポートされていません。 そもそも、libファイルがないので、リンクできません。 当然、こんな状態でリンクできません。 共有ライブラリを作って、かつlibファイルを作成するには、一工夫が必要。 [code lang=”cpp”] #ifndef _CPP_TEST_H_ #define _CPP_TEST_H_<br>class __declspec( dllexport ) Test { public: Test(); virtual ~Test();<br>int Sum(int a, int b); };<br>#endif [/code] <strong>class</strong>の後に、<strong>dllexport</strong>属性を付与します。 シンボルが1つ以上エクスポートされるとlibが生成される模様。 </p><p>これで、dllと一緒に、libファイルが生成されます。 また、生成されたdllも適切にシンボルをエクスポートできています。<br><a href="../../../../public/2018/03/acb5a918fd65165f0204752919db922c.png"><img src="../../../../public/2018/03/acb5a918fd65165f0204752919db922c.png"></a> ただし、<strong>gcc</strong>の場合、デフォルトでエクスポートされます。 dllexport属性は余計でビルドエラーを生成しますので、プリプロセッサで切り分けておくと楽です。 [code lang=”cpp”] #ifdef _WINDOWS #define CLASSEXPORT __declspec( dllexport )<br> #else #define CLASSEXPORT #endif [/code] [code lang=”cpp”] #ifndef _CPP_TEST_H_ #define _CPP_TEST_H_<br>#include “export.h”<br>class CLASSEXPORT Test { public: Test(); virtual ~Test();<br>int Sum(int a, int b); }; #endif [/code]</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CMake3">https://github.com/takuya-takeuchi/Demo/tree/master/CMake3</a></p>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
          <category> その他 </category>
          
          <category> CMake </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その101 GitKrakenでpushしたら failed to get server certificate</title>
      <link href="/2018/03/31/2813/"/>
      <url>/2018/03/31/2813/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="../../../../public/2018/03/f19fb2c05d70de09bedfa9918c0de089.png"><img src="../../../../public/2018/03/f19fb2c05d70de09bedfa9918c0de089.png"></a></p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>ズバリな答え。 </p><p>要するに、Githubが</p><ul><li>TLSv1/TLSv1.1: <a href="https://github.com/">https://github.com</a> と <a href="https://api.github.comweb/">https://api.github.comWeb</a> へのAPI、Gitを含む全てのHTTPSコネクションに適用</li><li>diffie-hellman-group1-sha1: github.com へのSSHコネクションに適用</li><li>diffie-hellman-group14-sha1: github.com へのSSHコネクションに適用</li></ul><p>による弱い暗号標準が削除されたためとのこと。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://blog.github.com/2018-02-23-weak-cryptographic-standards-removed/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=blog.github.com"></img><div class="hbc-site-name">The GitHub Blog</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://github.blog/wp-content/uploads/2018/02/26907144-178243fc-4ba6-11e7-8f15-8985451b33c2.jpg?fit=1200%2C630"></img></div><div class="hbc-text"><div class="hbc-title">Weak cryptographic standards removed - The GitHub Blog</div><div class="hbc-url">https://blog.github.com/2018-02-23-weak-cryptographic-standards-removed/</div><div class="hbc-description">Earlier today we permanently removed support for the following weak cryptographic standards on github.com and api.github.com: TLSv1/TLSv1.1:…</div></div></div></div></a></div></div> <div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://news.mynavi.jp/article/20180226-588372/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=news.mynavi.jp"></img><div class="hbc-site-name">マイナビニュース</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://news.mynavi.jp/article/20180226-588372/index_images/index.jpg"></img></div><div class="hbc-text"><div class="hbc-title">GitHub、弱い暗号標準の利用を廃止</div><div class="hbc-url">https://news.mynavi.jp/article/20180226-588372/</div><div class="hbc-description">GitHubは2月23日、同日をもってgithub.comおよびapi.github.comから弱いとされる暗号標準の利用を廃止したと伝えた。これまでサポートしてきてこれらの暗号標準は今後利用することはできないとしている。</div></div></div></div></a></div></div><p>ですが、Stackoverflowの記事による、Windowsパッチの適用は効果がありませんでした(既に適用済みのパッチであったため)。 その次の修正ツールを適用し再起動したら直りました。 <a href="https://support.microsoft.com/ja-jp/help/3140245/update-to-enable-tls-1-1-and-tls-1-2-as-a-default-secure-protocols-in#easy">WinHTTP が Windows での既定のセキュリティで保護されたプロトコルとして TLS 1.1 および TLS 1.2 を有効にする更新プログラム</a><br><a href="../../../../public/2018/03/0431e5dcc7f6153fc3a208c5e787811f.png"><img src="../../../../public/2018/03/0431e5dcc7f6153fc3a208c5e787811f.png"></a></p><p><a href="../../../../public/2018/03/fbcad98c1f0191134817643ac76deaa7.png"><img src="../../../../public/2018/03/fbcad98c1f0191134817643ac76deaa7.png"></a> <a href="../../../../public/2018/03/e933c466666e5e3947ae90e3a45ce62a.png"><img src="../../../../public/2018/03/e933c466666e5e3947ae90e3a45ce62a.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> GitKraken </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その100 WPFのControlTemplate内のListBoxに対してStyleが適用されない</title>
      <link href="/2018/03/20/2804/"/>
      <url>/2018/03/20/2804/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Themes\Generic.xaml</strong> 内に定義した <strong>ControlTemplate</strong> についてのお話。 ControlTemplte 内のGridでRrsourcesセクションを用意し、下記のようなコードを書いた。 [code lang=”xaml”] <Style TargetType="{x:Type controls:TestControl}"> <Setter Property="Template"> &lt;Setter.Value&gt; <ControlTemplate TargetType="{x:Type controls:TestControl}"> <Grid x:Name="\_Grid" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"> &lt;Grid.Resources&gt; <Style BasedOn="{StaticResource {x:Type ListBox}}" TargetType="ListBox"> <Setter Property="FontSize" Value="24" /> </Style> &lt;/Grid.Resources&gt; <ListBox x:Name="ListBox1" Grid.Column="0" /> </Grid> </ControlTemplate> &lt;/Setter.Value&gt; </Setter> </Style> [/code] 期待しているのは、ListBoxのStyleを継承した、新しいStyleを継承すること。上のコードは省略してあって、本当はListBoxがもう少しあります。 ところが、上のコントロールを配置、実行するとStyleの継承がうまくいきませんでした。OSSのライブラリのクールなスタイルを継承したはずが、Windowsのもっさいスタイルが適用されていました…. しかも、Windows7だとうまくいくのに、Windows10だとうまくいかない、という不思議な挙動。 何故?</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>Windows7と10で挙動が異なる原因は不明でしたが、本現象は、ListBoxに対してStyleを使うのをやめると治ります。 つまり、直接ListBoxの要素のプロパティに値を設定します。 かなり納得がいかない修正でしたが、関係しそうな話題は見つかりました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://social.msdn.microsoft.com/Forums/ja-JP/355fc10b-5bb8-4433-be69-d4b0cbcc3684/genericxamldatatemplatedatatemplate?forum=wpfja" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=social.msdn.microsoft.com"></img><div class="hbc-site-name">social.msdn.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">    カスタムコントロールのGeneric.xamlにDataTemplateを書き、コードビハインドからDataTemplateを取得したい</div><div class="hbc-url">https://social.msdn.microsoft.com/Forums/ja-JP/355fc10b-5bb8-4433-be69-d4b0cbcc3684/genericxamldatatemplatedatatemplate?forum=wpfja</div></div></div></div></a></div></div><p>とりあえず解決したので良しとします。会社で無駄に悩みました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その99 Bitnami Redmineでthinが停止する場合の原因追及</title>
      <link href="/2018/02/01/2801/"/>
      <url>/2018/02/01/2801/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>昔自分で書いた記事を忘れていて、Googleで彷徨っていたのでメモ。 </p><p><strong>Bitnami Redmine Stack</strong>は非常に便利なので会社でも使っているのですが、バージョンアップの度に、エラーに悩まされるのでビクビクします。 今週も、<strong>3.2系</strong>から最新の<strong>3.4系</strong>にアップデートしたのですが、チケット画面に遷移できないという問題を抱えてしまい、泣く泣く戻すことにしました。 で、その際、<strong>thin</strong>が止まって、Redmineが起動すらしない、という状況に陥りました。 <strong>Apache2</strong>やRedmineはエラーログを吐いてくれるくせに、thinはエラーログを吐いてくれません。 なので、thinが起動しないときは、コンソールから起動して停止する理由を確認します。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>スタートメニューの<strong>Bitnami Redmine Stack を使用する</strong>からコンソールを立ち上げて、<strong>apps\redmine\htdocs</strong> まで移動し、コマンドを入力します。 [code lang=”batch”] $ cd apps\redmine\htdocs $ bundle exec thin start -e production Using rack adapter Thin web server (v1.2.11 codename Bat-Shit Crazy) Maximum connections set to 1024 Listening on 0.0.0.0:3000, CTRL+C to stop [/code] 上は上手く起動した場合ですが、失敗した場合はエラーログが出力されます。例えば、 [code lang=”batch”] Using rack adapter DL is deprecated, please use Fiddle C:/BitNami/redmine-3.2.2-0/apps/redmine/htdocs/vendor/bundle/ruby/2.1.0/gems/mysql2-0.4.2-x86-mingw32/lib/mysql2/client.rb:87:in `connect’: Can’t connect to MySQL server on ‘127.0.0.1’ (10061) (Mysql2::Error) [/code] みたいなエラーが表示されたりします。 原因を解決したら、エラーが出なくなるまで、起動と確認を繰り返します。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> Redmine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その98 boostをビルドする際のuser-config.jamの指定</title>
      <link href="/2018/01/30/2797/"/>
      <url>/2018/01/30/2797/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>boost</strong>をビルドする際、C++からPythonを制御できるboost.Python等の一部モジュールの設定を行う際、<strong>user-config.jam</strong>という設定ファイルを使用しますが、このファイル、<a href="http://www.boost.org/build/doc/html/bbv2/overview/configuration.html">公式サイト</a>では、**%HOMEDRIVE%<strong>, **%HOMEPATH%</strong>, <strong>%HOME%</strong>, <strong>%BOOST_BUILD_PATH%</strong> に展開するよう書いてあります。 でも、boostに関連するファイルを、全く無関係な場所に展開するのは、何か気持ち悪いです。 なので、その対応策をメモ。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>簡単。 [code lang=”batch”] b2.exe toolset=msvc-12.0 link=static runtime-link=static,shared –user-config=user-config.jam [/code] ビルド時に、<strong>--user-config</strong>を追加するだけ。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> boost </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その97 GitKrakenの最後に開いたリポジトリフォルダを消去する</title>
      <link href="/2018/01/06/2790/"/>
      <url>/2018/01/06/2790/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>GitKraken</strong>便利ですわー。巨大なリポジトリでもそれなりにサクサク動きます。 でも、あまりにも巨大だと、リポジトリを開く処理が終わらないんですよね… で、一度開いてしまうと、次の起動の初期リポジトリが、そこになってしまうんですよ。 そうなったら、どうにもなりません。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>そんな私の悩みを解決してくださった回答がこちら。 </p><p>ではなく、ここをヒントに、「最後に開いたリポジトリ」の設定がどこかにあるのか、ということを調べました。 <strong>%AppData%.gitkraken\profiles\<random string>\profile</strong> の <strong>lastOpenedRepository</strong> を削除すればOK!!</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> GitKraken </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その96 MSYSのHOMEはWindows上でどこにあるの?</title>
      <link href="/2018/01/04/2786/"/>
      <url>/2018/01/04/2786/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>ただの備忘録。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>[code lang=”dos”] $ pwd -W C:/msys64/home/TAKUYA [/code]</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> MSYS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その95 WindowsにBazelをインストールする</title>
      <link href="/2017/12/24/2767/"/>
      <url>/2017/12/24/2767/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>TensorFlow</strong>のビルドで一躍有名になったビルドシステム<strong>Bazel</strong>をインストールします。 といっても、TensorFlowではなく、別のgoogle製OSSのビルドに使いたいだけです。 Windowsでの導入記事が見つからないので自分でやってみます。 きっと会社で使うことになるでしょうし。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>まずは<a href="https://docs.bazel.build/versions/master/install-windows.html">公式</a>でWindowsへの導入説明を読みます。 Bazelのインストールは下記の3手法があります。</p><ul><li>バイナリのダウンロード</li><li>Chocolatey</li><li>ソースから自分でビルド</li></ul><p>今回はバイナリをダウンロードします。</p><h2 id="Downalod"><a href="#Downalod" class="headerlink" title="Downalod"></a>Downalod</h2><p>Githubでダウンロードできますので入手します。<a href="https://github.com/bazelbuild/bazel/releases">Releaseページ</a>から各自の環境に適合したものをダウンロードします。 2017/12/24現在で最新は0.9.0です。</p><h2 id="Let’s-install"><a href="#Let’s-install" class="headerlink" title="Let’s install"></a>Let’s install</h2><p>適当なフォルダに展開するだけです。 そして公式ページでは</p><blockquote><p>We recommend putting the binary in a directory that’s on your %PATH%.</p></blockquote><p>つまり、<strong>環境変数PATH上のディレクトリに展開することを推奨します。</strong>とのお達し。 このあたりは好みです。 今回は、<strong>C:\Program Files\Google\Bazel\bazel-0.9.0-windows-x86_64.exe</strong>に展開しました。 同じフォルダに、<strong>Bazel.exe</strong>というシンボリックリンクがあるとちょっと幸せな感じがします。</p><h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup!!"></a>Setup!!</h2><p>残念なことに、これで終わりではないです。 <strong>CMake</strong>とかインストーラーで終わりなのに、何この面倒な感じ。 公式における<a href="https://docs.bazel.build/versions/master/windows.html">インストール後の指示</a>には、</p><ul><li>Python 2.7またはそれ以降</li><li>msys2</li><li>msys2 パッケージ</li><li>Java JDK 8</li></ul><p>が必要だと書いてあります。 げんなりします。</p><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>既に私のシステムにはPythonがあるので省略します。 <strong>Anaconda</strong>なり<strong>Miniconda</strong>なりでインストールするのが簡単です。 Minicondaでしたら、インストールした際のスクリーンショット付きで記事があります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2016/05/28/1372" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">ディープラーニング Caffe for Windows その1 環境構築 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2016/05/28/1372</div></div></div></div></a></div></div><h3 id="msys2"><a href="#msys2" class="headerlink" title="msys2"></a>msys2</h3><p><strong>msys2</strong>はインストーラーで提供されています。 <a href="http://www.msys2.org/">公式ページ</a>からダウンロードでします。 msysは<a href="https://ja.wikipedia.org/wiki/MSYS">wiki</a>によると、</p><blockquote><p>Windows上で動作するUnixシェル(Bash)やテキスト操作ユーティリティ(gawk, sed, findutil)、ソースコードパッチ用ツール(diffutil), アーカイブツール(tar, bzip2, zlib)を統合したパッケージである。</p></blockquote><p>とのこと。 ようするにPowerShellみたいな別シェルですね(適当)。 注意するのは、インストール先に、</p><ul><li>非ASCII文字</li><li>空白</li><li>シンボリックリンク</li><li>ショートパス (恐らく8.3形式のことかと)</li></ul><p>を<strong>使うな</strong>、とありますので指示に従います。面倒だな。<br><a href="../../../../public/2017/12/05553478b817a3b4d04ad9ab494d03b7.png"><img src="../../../../public/2017/12/05553478b817a3b4d04ad9ab494d03b7.png"></a></p><p><a href="../../../../public/2017/12/8f15913c583c4882b7bcc3227603edec.png"><img src="../../../../public/2017/12/8f15913c583c4882b7bcc3227603edec.png"></a><br> インストール先に使う文字には注意!!</p><p><a href="../../../../public/2017/12/2b52fece42f95910e5da9d6abcf9557e.png"><img src="../../../../public/2017/12/2b52fece42f95910e5da9d6abcf9557e.png"></a></p><p><a href="../../../../public/2017/12/985697cc205ec5c8c8489a838c864f4a.png"><img src="../../../../public/2017/12/985697cc205ec5c8c8489a838c864f4a.png"></a></p><p><a href="../../../../public/2017/12/1c75a2b0b9d8aea24ebecf66d82ae689.png"><img src="../../../../public/2017/12/1c75a2b0b9d8aea24ebecf66d82ae689.png"></a><br> 完了!!</p><h3 id="msys2のパッケージ追加"><a href="#msys2のパッケージ追加" class="headerlink" title="msys2のパッケージ追加"></a>msys2のパッケージ追加</h3><p>追加のパッケージが必要とのことなので、先ほどインストールしたmsys2を起動します。 スタートメニューから<strong>MSYS2 64bit</strong>を開きます。<br><a href="../../../../public/2017/12/af94d0d0edc2e2da11158bbf6eb9be15.png"><img src="../../../../public/2017/12/af94d0d0edc2e2da11158bbf6eb9be15.png"></a> で、<strong>MSYS2 MSYS</strong>をクリックします。選択肢が複数あって、「うっ」って思いました。止めて欲しいね。 シェルが起動したら、 [code lang=”shell”] pacman -Syuu git curl zip unzip [/code] と入力します。 <a href="../../../../public/2017/12/747891ac95f49e1db245ff6ac40d1b80.png"><img src="../../../../public/2017/12/747891ac95f49e1db245ff6ac40d1b80.png"></a></p><p><a href="../../../../public/2017/12/c8552b1aab7f5b798ed5a0f0189ea3a3.png"><img src="../../../../public/2017/12/c8552b1aab7f5b798ed5a0f0189ea3a3.png"></a><br> インストールするか?と聞かれたので<strong>y</strong>と入力</p><p>が、途中で、<br><a href="../../../../public/2017/12/209ca7b4fdb5ea6e33703c1820bf65e5.png"><img src="../../../../public/2017/12/209ca7b4fdb5ea6e33703c1820bf65e5.png"></a><br> はぁ!?</p><p>[code lang=”shell”] 警告: terminate MSYS2 without returning to shell and check for updates again 警告: for example close your terminal window instead of calling exit [/code] と出ました。 要約すると、もう一度シェルを立ち上げ直して同じ事をしろ、ってことです。 が、閉じるボタンを押下すると、処理中なのか応答が鈍いですが、<br><a href="../../../../public/2017/12/9059c9edd4778555314c9512de4ca076.png"><img src="../../../../public/2017/12/9059c9edd4778555314c9512de4ca076.png"></a><br> と出るので、OKで停止します。 それでも応答なしとかになったら、タスクマネージャなり<strong>Alt+F4</strong>で停止させます。 鬱陶しい…. で、再起動後、また同じコマンドを入力したら上手くいきました。 何の苦行だよ…. 結構時間がかかりますので、コーヒー飲むなり風呂に入るなりして時間をつぶします。</p><h3 id="Java-JDK-8"><a href="#Java-JDK-8" class="headerlink" title="Java JDK 8"></a>Java JDK 8</h3><p>7でもなく9でもなく、8だそうです。何、この厳密なバージョン指定。 BazelにはJDK8が埋め込まれているそうです。なので、普通に起動できたらOKでしょう。 私は起動できたので、何もしませんでした。</p><h2 id="起動"><a href="#起動" class="headerlink" title="起動"></a>起動</h2><p>コマンドプロンプトから、bazel.exeを起動します。 [code lang=”batch”] $ C:\Program Files\Google\Bazel&gt;bazel.exe Extracting Bazel installation… [bazel release 0.9.0]<br>Usage: bazel <command> <options> …<br>Available commands: analyze-profile Analyzes build profile data. build Builds the specified targets. canonicalize-flags Canonicalizes a list of bazel options. clean Removes output files and optionally stops the server. coverage Generates code coverage report for specified test targets.<br>dump Dumps the internal state of the bazel server process. fetch Fetches external repositories that are prerequisites to th e targets. help Prints help for commands, or the index. info Displays runtime info about the bazel server. license Prints the license of this software. mobile-install Installs targets to mobile devices. print_action Prints the command line args for compiling a file. query Executes a dependency graph query. run Runs the specified target. shutdown Stops the bazel server. test Builds and runs the specified test targets. version Prints version information for bazel.<br>Getting more help: bazel help <command> Prints help and options for <command>. bazel help startup_options Options for the JVM hosting bazel. bazel help target-syntax Explains the syntax for specifying targets. bazel help info-keys Displays a list of keys used by the info command. [/code] 動いた感じですね。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まぁ、面倒な感じでした。 PythonやJDK8は既にインストール済みだったので、実質msys2のインストールがメインでしたが。</p>]]></content>
      
      
      <categories>
          
          <category> google </category>
          
          <category> Google </category>
          
          <category> Bazel </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その94 boostを使った最小のCMakeプロジェクト その2</title>
      <link href="/2017/12/23/2761/"/>
      <url>/2017/12/23/2761/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://taktak.jp/2017/12/21/2757">前回</a>の記事で、boostを使った簡単なクロスプラットフォームアプリを作りました。 で、それを会社でテンプレートにして手を加え、Windowsで動かしたらまったく動きませんでした。 というかビルドが通らない。 理由は<strong>lib</strong>が見つからないこと。 前回のサンプルは、libを使わず、ヘッダーだけで動作したプログラムだった模様。 なので、ちょっと修正します。 ソースは下記になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/CMake2" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/CMake2</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>まずは、CMakeLists.txt [code lang=”cmake”] cmake_minimum_required(VERSION 3.9.0) set(PROJ_NAME Test)<br>project(${PROJ_NAME} VERSION 1.0.0)<br># Select the release build type by default if (NOT CMAKE_BUILD_TYPE) set(CMAKE_BUILD_TYPE “Release”) endif()<br># target source and header files FILE(GLOB_RECURSE HEADERS ${PROJECT_SOURCE_DIR}/*.h) FILE(GLOB_RECURSE SOURCES ${PROJECT_SOURCE_DIR}/*.cpp)<br>include_directories(${BOOST_ROOT})<br>#add_executable(${PROJ_NAME} ${HEADERS} ${SOURCES}) add_executable(${PROJ_NAME} main.cpp)<br>if(CMAKE_GENERATOR MATCHES “Visual Studio”) set(STATIC_LIBRARIES ${BOOST_LIBRARYDIR}/libboost_system-vc140-mt-1_65_1.lib ${BOOST_LIBRARYDIR}/libboost_filesystem-vc140-mt-1_65_1.lib ) target_link_libraries(${PROJ_NAME} ${STATIC_LIBRARIES}) else() set(STATIC_LIBRARIES ${BOOST_LIBRARYDIR}/libboost_system.a ${BOOST_LIBRARYDIR}/libboost_filesystem.a ) target_link_libraries(${PROJ_NAME} ${STATIC_LIBRARIES}) endif()<br>set(CompilerFlags CMAKE_CXX_FLAGS CMAKE_CXX_FLAGS_DEBUG CMAKE_CXX_FLAGS_RELEASE CMAKE_C_FLAGS CMAKE_C_FLAGS_DEBUG CMAKE_C_FLAGS_RELEASE ) foreach(CompilerFlag ${CompilerFlags}) string(REPLACE “/MDd” “/MD” ${CompilerFlag} “${${CompilerFlag}}”) endforeach()<br>set(CPACK_PROJECT_NAME ${PROJECT_NAME}) set(CPACK_PROJECT_VERSION ${PROJECT_VERSION}) include(CPack) [/code] 今回の肝は、<strong>target_link_libraries</strong>の行。 コンパイラが<strong>Visual Studio</strong>なのかそうでないのかで、リンクするライブラリを変えています。 次に、main.cpp [code lang=”cpp”] #include <iostream> #include &lt;boost/filesystem.hpp&gt;<br>namespace fs = boost::filesystem;<br>int main(int argc, char* argv[]) { const fs::path path(argv[1]);<br>boost::system::error_code error; const bool result = fs::exists(path, error); if (!result || error) { printf(“%s does not exist!!\n”, argv[1]); } else { printf(“%s exists!!\n”, argv[1]); } }[/code] 引数で渡されたファイルが存在するかどうかを表示するだけです。</p><h1 id="Build-amp-Run"><a href="#Build-amp-Run" class="headerlink" title="Build&amp;Run"></a>Build&amp;Run</h1><p>ビルドします。 <strong>CMakeLists.txt</strong>と<strong>main.cp</strong>が同じ階層にあるものとし、カレントディレクトリがCMakeLists.txtと同じだとします。 また、CMakeのパスは通っているものとします。</p><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>[code lang=”batch”] $ mkdir build $ cd build $ cmake -G “Visual Studio 14 2015 Win64” -DBOOST_ROOT=D:\boost\1.65.1 -DBOOST_LIBRARYDIR=D:\boost\1.65.1\build\MSVC14.0\x64\lib .. $ cmake –build . –config Release $ cd Release $ Test.exe c:\Windows\System32\zipfldr.dll c:\Windows\System32\zipfldr.dll exists!! $ Test.exe c:\Windows\System32\zipfldr.dll2 c:\Windows\System32\zipfldr.dll2 does not exist!! [/code]</p><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>[code lang=”batch”] $ mkdir build $ cd build $ cmake -DBOOST_ROOT=/usr/include -DBOOST_LIBRARYDIR=/usr/lib64 .. $ cmake –build . –config Release $ ./Test /usr/local/bin/CMake2/main.cpp /usr/local/bin/CMake2/main.cpp exists!! $ ./Test /usr/local/bin/CMake2/main.cpp2 /usr/local/bin/CMake2/main.cpp2 does not exist!! [/code]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今度はきちんと静的リンクできています。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CMake2">https://github.com/takuya-takeuchi/Demo/tree/master/CMake2</a></p>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
          <category> その他 </category>
          
          <category> boost </category>
          
          <category> CMake </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その93 boostを使った最小のCMakeプロジェクト</title>
      <link href="/2017/12/21/2757/"/>
      <url>/2017/12/21/2757/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>クロスプラットフォームのアプリケーションを作成するとき、<strong>CMake</strong>は鉄板中の鉄板ですが、魔術のような<strong>CMakeLists.txt</strong>を書くのはうんざりします。 <strong>Visual Studio</strong>ならプロパティからヘッダーの参照、ライブラリの参照、という感じでスラスラ作業できますが。 そんな中クロスプラットフォームのコンソールアプリを作る必要に駆られたのでメモ。 ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/CMake1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/CMake1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>といっても、ソースそのものは本質では無く、CMakeLists.txtとboostの使い方が一番の肝。 特に、boostのパスを外部から指定してビルドするのがターゲットになります。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>まずは、CMakeLists.txt [code lang=”cmake”] cmake_minimum_required(VERSION 3.9.0) set(PROJ_NAME Test)<br>project(${PROJ_NAME} VERSION 1.0.0)<br># Select the release build type by default if (NOT CMAKE_BUILD_TYPE) set(CMAKE_BUILD_TYPE “Release”) endif()<br># target source and header files # FILE(GLOB_RECURSE HEADERS ${PROJECT_SOURCE_DIR}/*.h) # FILE(GLOB_RECURSE SOURCES ${PROJECT_SOURCE_DIR}/*.cpp)<br>include_directories(${BOOST_ROOT})<br>#add_executable(${PROJ_NAME} ${HEADERS} ${SOURCES}) add_executable(${PROJ_NAME} main.cpp)<br>set(CompilerFlags CMAKE_CXX_FLAGS CMAKE_CXX_FLAGS_DEBUG CMAKE_CXX_FLAGS_RELEASE CMAKE_C_FLAGS CMAKE_C_FLAGS_DEBUG CMAKE_C_FLAGS_RELEASE ) foreach(CompilerFlag ${CompilerFlags}) string(REPLACE “/MDd” “/MD” ${CompilerFlag} “${${CompilerFlag}}”) endforeach()<br>set(CPACK_PROJECT_NAME ${PROJECT_NAME}) set(CPACK_PROJECT_VERSION ${PROJECT_VERSION}) include(CPack) [/code] 色々コメントがありますが、<strong>add_executable</strong>で実行ファイルを指定しているのと、<strong>include_directories</strong>でboostのパスを指定するのが肝。 特に、include_directoriesが無いと、cmakeコマンドにboostのパスを渡してもビルドに失敗します。 次に、main.cpp [code lang=”cpp”] #include <iostream> #include <limits> #include &lt;boost/math/constants/constants.hpp&gt;<br>int main () { double pi = boost::math::constants::pi<double>();<br>std::cout.precision(std::numeric_limits<double>::max_digits10); std::cout &lt;&lt; pi &lt;&lt; std::endl; } [/code] 円周率を表示するだけです。</p><h1 id="Build-amp-Run"><a href="#Build-amp-Run" class="headerlink" title="Build&amp;Run"></a>Build&amp;Run</h1><p>ビルドします。 <strong>CMakeLists.txt</strong>と<strong>main.cp</strong>が同じ階層にあるものとし、カレントディレクトリがCMakeLists.txtと同じだとします。 また、CMakeのパスは通っているものとします。 [code lang=”batch”] $ mkdir build $ cd build $ cmake -G “Visual Studio 14 2015 Win64” -DBOOST_ROOT=D:\Works\Lib2\boost\boost_1_59_0 -DBOOS T_LIBRARYDIR=D:\Works\Lib2\boost\boost_1_59_0\lib64-msvc-12.0 .. $ cmake –build . –config Release $ cd Release $ Test.exe 3.1415926535897931 [/code] 上のような感じです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>意外とboost+CMakeの簡単なアプリという組み合わせが無くて困りました。 ましてや、boostのパスを外部から指定するタイプの完全なサンプルが無かったのです。 インストール済みのboostをfindするのはあったのですが。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CMake1">https://github.com/takuya-takeuchi/Demo/tree/master/CMake1</a></p>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
          <category> その他 </category>
          
          <category> boost </category>
          
          <category> CMake </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bluetooth Low Energyの自作ビーコンを作る その2</title>
      <link href="/2017/12/06/2750/"/>
      <url>/2017/12/06/2750/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://taktak.jp/2017/12/05/2718">前回</a>は、mbedのアカウント作成、ソースのコンパイルを行いました。 今回は実際にBEL Nanoにバイナリを書き込んで、動かしてみます。</p><h1 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h1><h2 id="接続"><a href="#接続" class="headerlink" title="接続"></a>接続</h2><p><strong>BLE Nano v2</strong>をPCに接続します。 購入時は、ボードとライターが接続されていましたが、もし外したのなら、向きに注意して接続します。 ボードとライターを接続したら、PCのUSB端子に接続します。 続いて、エクスプローラーを開きます。 Macとかだと、Finderに接続したBLE Nanoがドライブとして現れるようですが… 私のWindows7はUSBハブ経由だからなのか、見つかりませんでした。 見つからない場合は<a href="https://os.mbed.com/handbook/Windows-serial-configuration">mbed Windows serial port driver</a>をインストールします。 情報は<strong>JellyWare様</strong>より。ありがとうございます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://jellyware.jp/kurage/blenano/blenano_start.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=jellyware.jp"></img><div class="hbc-site-name">JellyWare Inc.</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://jellyware.jp/images/ogp.png"></img></div><div class="hbc-text"><div class="hbc-title">JellyWare株式会社</div><div class="hbc-url">http://jellyware.jp/kurage/blenano/blenano_start.html</div><div class="hbc-description">人が技術を作る。技術が人の暮らしをつくる。だから、人をつなげ、何かを作り、それをまた誰かに伝えたい。JellyWareはそんな人と技術が集まるプラットフォームです。</div></div></div></div></a></div></div><p>とりあえず、Windows10はドライバ無しでも認識しました、<br><a href="../../../../public/2017/12/7d02b04c14057d3cb2e90daa3906ccff.png"><img src="../../../../public/2017/12/7d02b04c14057d3cb2e90daa3906ccff.png"></a></p><h2 id="書き込み"><a href="#書き込み" class="headerlink" title="書き込み"></a>書き込み</h2><p>いざ書き込みです。 といっても想像の通り、ドラッグアンドドロップで、前回ダウンロードしたバイナリを書き込むだけの親切設計。</p><h2 id="実行"><a href="#実行" class="headerlink" title="実行"></a>実行</h2><p>前回買ってきたブレッドボードに接続してみます。<br><a href="../../../../public/2017/12/2b4484331fb1f6eda52c325ebfff59c5.jpeg"><img src="../../../../public/2017/12/2b4484331fb1f6eda52c325ebfff59c5.jpeg"></a><br> そして、iPhoneあたりにBLEビーコンを検出できるアプリがあるので、それを使って検知してみます。 今回はこれを使ってみました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://itunes.apple.com/jp/app/locate-beacon/id738709014?mt=8&ign-mpt=uo%3D4" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=itunes.apple.com"></img><div class="hbc-site-name">App Store</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://is4-ssl.mzstatic.com/image/thumb/Purple60/v4/eb/23/34/eb2334be-31df-0667-96c4-08c84831e976/mzl.wqkjbqgc.png/1200x630wa.png"></img></div><div class="hbc-text"><div class="hbc-title">‎Locate Beacon</div><div class="hbc-url">https://itunes.apple.com/jp/app/locate-beacon/id738709014?mt=8&ign-mpt=uo%3D4</div><div class="hbc-description">‎Makes your device transmit as a Proximity Beacon with iBeacon™ Technology and configurable identifiers.  Finds nearby beacons with Eddyston…</div></div></div></div></a></div></div><p>UUIDは前回の<strong>main.cpp</strong>に書かれていますので、それを入力します。 そして、検知結果がこちら。</p><p><a href="../../../../public/2017/12/14e2d244b4403b71d41794027eb96f48.png"><img src="../../../../public/2017/12/14e2d244b4403b71d41794027eb96f48-576x1024.png"></a></p><p>無事に動作しました。 電子工作、なかなか面白いですね。</p>]]></content>
      
      
      <categories>
          
          <category> IoT </category>
          
          <category> 無線通信 </category>
          
          <category> Bluetooth </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bluetooth Low Energyの自作ビーコンを作る その1</title>
      <link href="/2017/12/05/2718/"/>
      <url>/2017/12/05/2718/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>IoT熱が高まってついに電子工作を始めました。</p><ul><li><a href="https://www.switch-science.com/catalog/269/">透明なブレッドボード</a></li><li><a href="https://www.switch-science.com/catalog/620/">普通のジャンパワイヤ(オス～オス)</a></li><li><a href="https://www.switch-science.com/catalog/117/">コイン型電池ホルダCR2032用</a></li><li><a href="https://www.switch-science.com/catalog/3444/">RedBearLab BLE Nanoキット V2</a></li></ul><p>スイッチサイエンス、お世話になります。 で、何がしたいかというと、BLEビーコンを作ってみたいんですよ。 いやネット上でBLE Nanoキットを使ってサンプルは転がっているんですが、電子工作スキルなるものを習得できれば、と思います。 子供の頃はプラモデル作るのは好きでした。大丈夫でしょう。</p><h1 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h1><p>基本的には、<strong>JellyWare様</strong>の下記のページをなぞるだけです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://jellyware.jp/kurage/blenano/blenano2_minibread.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=jellyware.jp"></img><div class="hbc-site-name">JellyWare Inc.</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://jellyware.jp/images/ogp.png"></img></div><div class="hbc-text"><div class="hbc-title">JellyWare株式会社</div><div class="hbc-url">http://jellyware.jp/kurage/blenano/blenano2_minibread.html</div><div class="hbc-description">人が技術を作る。技術が人の暮らしをつくる。だから、人をつなげ、何かを作り、それをまた誰かに伝えたい。JellyWareはそんな人と技術が集まるプラットフォームです。</div></div></div></div></a></div></div><p>違うのは、ボリュームがない点です。 つまり、電池、コイン電池ホルダ、ジャンパワイヤ、BLE Nano v2、ブレッドボードだけを使います。 ひたすらパケットを送信するだけのビーコンです。 で、軽く記事を読むと、</p><ul><li>mbed<ul><li>ARM社のプロトタイピング用ワンボードマイコン用のプログラミング環境</li></ul></li></ul><p>が必要とのこと。Visual Studioで出来ないの?と温いことを思いますが、郷に入っては郷に従うの精神で行きます。</p><h2 id="mbedのアカウント取得"><a href="#mbedのアカウント取得" class="headerlink" title="mbedのアカウント取得"></a>mbedのアカウント取得</h2><p>無料出来る模様。どうやってマネタイズしているのか。 アカウント作成は<a href="https://os.mbed.com/">ここ</a>から。<br><a href="../../../../public/2017/12/screencapture-os-mbed-1512474425483.png"><img src="../../../../public/2017/12/screencapture-os-mbed-1512474425483.png"></a><br> Log In/Sign upを選択</p><p><a href="../../../../public/2017/12/screencapture-os-mbed-1512474720679.png"><img src="../../../../public/2017/12/screencapture-os-mbed-1512474720679.png"></a><br> Sign upを選択</p><p><a href="../../../../public/2017/12/screencapture-os-mbed-account-login-1512474449614.png"><img src="../../../../public/2017/12/screencapture-os-mbed-account-login-1512474449614.png"></a><br> メールアドレス、ユーザ名、パスワード、名前、名字、国名を入力</p><p>以上で完了です。 完了後、メールが届いて最終確認後、Sing Inできます。<br><a href="../../../../public/2017/12/screencapture-os-mbed-account-signup-1512474459878.png"><img src="../../../../public/2017/12/screencapture-os-mbed-account-signup-1512474459878.png"></a><br> Compilerを押して作業開始!!</p><h2 id="BLE-Nanoを動かす下準備"><a href="#BLE-Nanoを動かす下準備" class="headerlink" title="BLE Nanoを動かす下準備"></a>BLE Nanoを動かす下準備</h2><p>mbedはブラウザ上で作業が完結する模様。 なので、ブラウザ上でソース編集、デバイスに書き込みという往復作業になります。 まず、先の画面でCompilerをクリックすると、下記のような画面に遷移します。<br><a href="../../../../public/2017/12/screencapture-os-mbed-compiler-1512475342662.png"><img src="../../../../public/2017/12/screencapture-os-mbed-compiler-1512475342662-1024x663.png"></a></p><p>ここで、右上の<strong>デバイス未選択</strong>をクリック。<br><a href="../../../../public/2017/12/0d40a5e4a645fc6b96e767d64ac0878e.png"><img src="../../../../public/2017/12/0d40a5e4a645fc6b96e767d64ac0878e.png"></a></p><p><a href="../../../../public/2017/12/08380e686b3ff2ca21a20dfa3dfa0cdf.png"><img src="../../../../public/2017/12/08380e686b3ff2ca21a20dfa3dfa0cdf.png"></a><br> 表示されるダイアログの左下の<strong>Add Platform</strong>をクリック</p><p>別ウィンドウで開発ボードの一覧がリストアップされます。<br><a href="../../../../public/2017/12/cf4e206a27690c2fa42ff52ed5b22232.png"><img src="../../../../public/2017/12/cf4e206a27690c2fa42ff52ed5b22232.png"></a><br> <strong>RedBearLab BLE Nano</strong>を選択</p><p>続いて、BLE Nanoの詳細に移動しますので、画面右側中央の<strong>Add to your Mbed Compiler</strong>をクリック<br><a href="../../../../public/2017/12/9c935de28796773fd6510abb042265cb.png"><img src="../../../../public/2017/12/9c935de28796773fd6510abb042265cb.png"></a> <a href="../../../../public/2017/12/1482ba79f3d74b8d2f4bacd2d69baf50.png"><img src="../../../../public/2017/12/1482ba79f3d74b8d2f4bacd2d69baf50.png"></a><br> 成功しました。</p><h2 id="サンプルのインポート"><a href="#サンプルのインポート" class="headerlink" title="サンプルのインポート"></a>サンプルのインポート</h2><p>次にサンプルソースをインポートします。 <a href="https://os.mbed.com/teams/Bluetooth-Low-Energy/code/BLE_iBeacon/">BLE_iBeacon</a>というサンプルがありますので、これを自分の環境にインポートします。 画面左上の<strong>インポート</strong>をクリックします。<br><a href="../../../../public/2017/12/bb76dd5d620c8d707107b276108230ed.png"><img src="../../../../public/2017/12/bb76dd5d620c8d707107b276108230ed.png"></a></p><p><a href="../../../../public/2017/12/a0a58da8bf3e8683419f4711bbde78e9.png"><img src="../../../../public/2017/12/a0a58da8bf3e8683419f4711bbde78e9.png"></a><br> <strong>Source URL</strong>に先ほどのBLE_iBeaconのurlを入力し、Importを実行</p><p><a href="../../../../public/2017/12/79e56549ce789c59c19e6ca2cb63fa9a.png"><img src="../../../../public/2017/12/79e56549ce789c59c19e6ca2cb63fa9a-1024x611.png"></a><br> 成功するとプロジェクト一式が画面に表示されます</p><p>おもむろに、<strong>main.cpp</strong>を見てみます。 [code lang=”c++”] /* mbed Microcontroller Library * Copyright (c) 2006-2015 ARM Limited * * Licensed under the Apache License, Version 2.0 (the “License”); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a> * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an “AS IS” BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */<br>#include “mbed.h” #include “ble/services/iBeacon.h”<br>BLE ble;<br>void bleInitComplete(BLE::InitializationCompleteCallbackContext *params) { BLE &amp;ble = params-&gt;ble; ble_error_t error = params-&gt;error;<br>if (error != BLE_ERROR_NONE) { return; }<br>/** * The Beacon payload has the following composition: * 128-Bit / 16byte UUID = E2 0A 39 F4 73 F5 4B C4 A1 2F 17 D1 AD 07 A9 61 * Major/Minor = 0x1122 / 0x3344 * Tx Power = 0xC8 = 200, 2’s compliment is 256-200 = (-56dB) * * Note: please remember to calibrate your beacons TX Power for more accurate results. */ const uint8_t uuid[] = {0xE2, 0x0A, 0x39, 0xF4, 0x73, 0xF5, 0x4B, 0xC4, 0xA1, 0x2F, 0x17, 0xD1, 0xAD, 0x07, 0xA9, 0x61}; uint16_t majorNumber = 1122; uint16_t minorNumber = 3344; uint16_t txPower = 0xC8; iBeacon *ibeacon = new iBeacon(ble, uuid, majorNumber, minorNumber, txPower);<br>ble.gap().setAdvertisingInterval(1000); /* 1000ms. */ ble.gap().startAdvertising(); }<br>int main(void) { ble.init(bleInitComplete);<br>/* SpinWait for initialization to complete. This is necessary because the * BLE object is used in the main loop below. */ while (!ble.hasInitialized()) { /* spin loop */ }<br>while (true) { ble.waitForEvent(); // allows or low power operation } } [/code] すごくシンプルです。 main関数内で、おまじないした後は、全ての処理が<strong>bleInitComplete</strong>関数内に書いてあります。 サンプルは1秒毎にアドバタイジングパケットを送信する模様。 とりあえず、これをコンパイルします。<br><a href="../../../../public/2017/12/523cfc6344d3ed66b00dcec640bb60ed.png"><img src="../../../../public/2017/12/523cfc6344d3ed66b00dcec640bb60ed.png"></a><br> 画面左上のコンパイルをクリック</p><p><a href="../../../../public/2017/12/a36956468750cdc5a3db07e06abe8c25.png"><img src="../../../../public/2017/12/a36956468750cdc5a3db07e06abe8c25.png"></a><br> コンパイルが始まります</p><p><a href="../../../../public/2017/12/f8f2977af9c753bcd2f6808d6719c838.png"><img src="../../../../public/2017/12/f8f2977af9c753bcd2f6808d6719c838-1024x185.png"></a></p><p>が、エラーと警告。</p><ul><li>Warning: #warning directive: toolchain.h has been replaced by mbed_toolchain.h, please update to mbed_toolchain.h [since mbed-os-5.3] in “extras/mbed_e7ca05fa8600/platform/toolchain.h”, Line: 23, Col: 3</li><li>Error: Cannot open source input file “core_cmInstr.h”: No such file or directory in “BLE_API/ble/services/iBeacon.h”, Line: 19, Col: 27</li></ul><p>とりあえず警告は無視して、エラーを直します。エラー行右の**Fix it!**をクリック。 なんとライブラリを探してきて、候補を提示してくれます。 ただ、どれを選べば良いのか見当もつきません。 ということで調べてみると、 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://blog.akanumahiroaki.com/entry/2017/09/19/080000" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=blog.akanumahiroaki.com"></img><div class="hbc-site-name">Tech Blog by Akanuma Hiroaki</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png"></img></div><div class="hbc-text"><div class="hbc-title">BLE Nano を mbed で iBeacon 化する - Tech Blog by Akanuma Hiroaki</div><div class="hbc-url">http://blog.akanumahiroaki.com/entry/2017/09/19/080000</div><div class="hbc-description">前回 BLE Nano で Lチカまでやったので、今回は BLE Nano を iBeacon 化して、iOS アプリから検知してみたいと思います。 また、開発環境としては前回の記事で、 Vagrant で構築した VM からだと mbed import の途中で止まってしまった…</div></div></div></div></a></div></div><p>という記事が。 記事によれば、</p><blockquote><p>ですがこのビルドを指定すると下記のようなエラーになってしまったので、 4eea097334d6 で実行しています。</p></blockquote><p>とのこと。どうもインポート時に最新ビルドを持ってくるようにしたのが不味かった模様。 なので、プロジェクトを削除してもう一度インポートします。<br><a href="../../../../public/2017/12/1cc0b0c56302c9130ead7b679e91d8a3.png"><img src="../../../../public/2017/12/1cc0b0c56302c9130ead7b679e91d8a3.png"></a><br> <strong>Update all libraries to the latest revision</strong>のチェックを外します。</p><p>警告は出ますが、コンパイルに成功し、バイナリをダウンロードできるようになりました。<br><a href="../../../../public/2017/12/02632a26d596d01281833c5cc84317b6.png"><img src="../../../../public/2017/12/02632a26d596d01281833c5cc84317b6.png"></a></p><p>まずはコンパイルとバイナリ生成が完了。</p>]]></content>
      
      
      <categories>
          
          <category> IoT </category>
          
          <category> 無線通信 </category>
          
          <category> Bluetooth </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows 10 IoT Core での新規プロジェクト作成</title>
      <link href="/2017/12/04/2707/"/>
      <url>/2017/12/04/2707/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Visual Studio</strong>上で、しかもC#を使って、IoTデバイス上で動作できるアプリが簡単に作れる!!っていうのが、Microsoftのエコシステムの強みなんですけど、Visual Studioのどこから作成できるのかがわかりにくいのでメモ。</p><h1 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h1><h2 id="Application-Types"><a href="#Application-Types" class="headerlink" title="Application Types"></a>Application Types</h2><p>まず前提として、IoTデバイス上で動作するアプリは</p><ul><li>GUIあり (UWP)<ul><li>Foreground Apps</li></ul></li><li>GUIなし(UWP)<ul><li>Background Apps</li></ul></li><li>非UWP (C++のみ)<ul><li>Non-UWP Apps</li></ul></li></ul><p>の3種になります。 パフォーマンスとか考えると、C++の非UWPって気もしますが、そもそもパフォーマンス云々ならWindows IoTなんか選択しません。 Windows IoTを選ぶのは、開発効率の高さ、既存資産の流用、多数の言語サポートなのですから。</p><h2 id="Foreground-Apps"><a href="#Foreground-Apps" class="headerlink" title="Foreground Apps"></a>Foreground Apps</h2><p>で、前述の通り、GUIなら選択肢は<strong>Foreground Apps</strong>しかないといっています。 <a href="https://docs.microsoft.com/en-us/windows/iot-core/develop-your-app/buildingappsforiotcore">Developing foreground applications</a>によれば、</p><blockquote><p>All of the standard UWP languages and project templates are fully supported on IoT Core.</p></blockquote><h5 id="訳-全ての基本的なUWPの言語及びプロジェクトテンプレートはIoTコア上で完全にサポートされます。"><a href="#訳-全ての基本的なUWPの言語及びプロジェクトテンプレートはIoTコア上で完全にサポートされます。" class="headerlink" title="訳: 全ての基本的なUWPの言語及びプロジェクトテンプレートはIoTコア上で完全にサポートされます。"></a>訳: 全ての基本的なUWPの言語及びプロジェクトテンプレートはIoTコア上で完全にサポートされます。</h5><p>とあるので、普通にUWPアプリを作ればそれで動くはずです。</p><h2 id="Background-Apps"><a href="#Background-Apps" class="headerlink" title="Background Apps"></a>Background Apps</h2><p>問題は、GUIを使わないタイプ。 <strong>Background App</strong>とよばれる、このタイプはコンソールアプリなのですが、従来の<strong>Mainメソッド</strong>から構成されるものとは異なり、どちらかといえばサービスアプリケーションに近い印象を受けます。そもそもコンソール画面は表示されないので、コンソールアプリとも言えませんが。 Background Appsを作成するには、<strong>Windows.ApplicationModel.Background.IBackgroundTask インターフェイス</strong>を継承したクラスを作成するだけです。 そのクラスはタスクとして扱われ、バックグラウンドで実行されるという仕組みです。 サンプルを見る限りは非常に簡単ですが、ここはテンプレートを利用しましょう。 というか、MSDNにもそう書いてあります。 でも、Visual Studioをインストールしてもテンプレートは存在せず、<strong>Visual Studio Marketplace</strong>から入手せよとのこと。えぇ…</p><ul><li><a href="https://marketplace.visualstudio.com/items?itemName=MicrosoftIoT.WindowsIoTCoreProjectTemplates">Windows IoT Core Project Templates</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=MicrosoftIoT.WindowsIoTCoreProjectTemplatesforVS15">Windows IoT Core Project Templates for VS 2017</a></li></ul><p>入手したインストーラを実行し、<strong>新しいプロジェクト</strong>を開くと、<strong>Windows IoT Core</strong>が追加されます。<br><a href="../../../../public/2017/12/bd28c4a9a6ec722100d1bfed5cf509cf.png"><img src="../../../../public/2017/12/bd28c4a9a6ec722100d1bfed5cf509cf.png"></a></p><p><a href="../../../../public/2017/12/8c9a77301be08cfd6425cd68d0e3de7f.png"><img src="../../../../public/2017/12/8c9a77301be08cfd6425cd68d0e3de7f.png"></a><br> ターゲットのWindows 10のビルドを選択します。</p><p>作成されたプロジェクトは、<strong>StartupTask.cs</strong>というソースが一つ(+他の細々したもの)というシンプルなものです。<br><a href="../../../../public/2017/12/9fa909c177793da776f6ca453d6f9af7.png"><img src="../../../../public/2017/12/9fa909c177793da776f6ca453d6f9af7-1024x725.png"></a></p><p>これを元に作成していけば、アイデアを形に出来るでしょう。きっと。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> IoT </category>
          
          <category> Windows IoT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows 10 IoT Coreのセットアップ</title>
      <link href="/2017/12/04/2685/"/>
      <url>/2017/12/04/2685/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>新しいプロジェクト、と言いますか<strong>PoC</strong>のために、検証を休みの日とかに考えています。 その一環で<strong>Raspberry Pi3</strong>を使おうと思い、どうせなら<strong>Windows</strong>でやってみるか、ということで最新の<strong>Windows 10 IoT Core</strong>を試してみることに。</p><h1 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h1><h2 id="Download-Windows-10-IoT-Core-Dashboard"><a href="#Download-Windows-10-IoT-Core-Dashboard" class="headerlink" title="Download Windows 10 IoT Core Dashboard"></a>Download Windows 10 IoT Core Dashboard</h2><p>まずは、<strong>Windows 10 IoT Core Dashboard</strong>をダウンロードします。 これは、Windows 10にインストールする、IoTデバイスのダッシュボードアプリケーションです。 DashboardからOSのインストール、各種設定の変更が可能です。 <a href="https://docs.microsoft.com/en-us/windows/iot-core/connect-your-device/iotdashboard">Windows 10 IoT Core Dashboard</a>からダウンロードします。<br><a href="../../../../public/2017/12/screencapture-docs-microsoft-en-us-windows-iot-core-connect-your-device-iotdashboard-1512375005956.png"><img src="../../../../public/2017/12/screencapture-docs-microsoft-en-us-windows-iot-core-connect-your-device-iotdashboard-1512375005956-1024x379.png"></a></p><h2 id="Install-Windows-10-IoT-Core-Dashboard"><a href="#Install-Windows-10-IoT-Core-Dashboard" class="headerlink" title="Install Windows 10 IoT Core Dashboard"></a>Install Windows 10 IoT Core Dashboard</h2><p>次はインストールです。ダウンロードした<strong>Setup.exe</strong>をダブルクリックするだけです。 <strong>ClickOnce</strong>なのか、インストールはすぐ終わります。<br><a href="../../../../public/2017/12/ec73e51527bf37ac8109501e5073ba71.png"><img src="../../../../public/2017/12/ec73e51527bf37ac8109501e5073ba71.png"></a></p><p><a href="../../../../public/2017/12/2dd68645732b9f493d31e5b83924ee04.png"><img src="../../../../public/2017/12/2dd68645732b9f493d31e5b83924ee04.png"></a></p><h2 id="Launch-Dashboard"><a href="#Launch-Dashboard" class="headerlink" title="Launch Dashboard"></a>Launch Dashboard</h2><p>インストールが完了するとDashboardが立ち上がりますが、スタートメニューから起動も出来ます。<br><a href="../../../../public/2017/12/3f7fa114521dd1864cfe1810fa62cd07.png"><img src="../../../../public/2017/12/3f7fa114521dd1864cfe1810fa62cd07-1024x697.png"></a></p><p><a href="../../../../public/2017/12/5eda967b14cede1ab1dd6a0174aecefc.png"><img src="../../../../public/2017/12/5eda967b14cede1ab1dd6a0174aecefc.png"></a></p><p>Dashboardが立ち上がるとファイアウォールの許可を求めるダイアログが出るので、適当に許可を与えます。 許可しないと、OSイメージのダウンロードが出来ないと思われますので、必須でしょう。<br><a href="../../../../public/2017/12/5886a4cddd806495a669da6567f5898f.png"><img src="../../../../public/2017/12/5886a4cddd806495a669da6567f5898f.png"></a></p><h2 id="Setup-New-Device"><a href="#Setup-New-Device" class="headerlink" title="Setup New Device"></a>Setup New Device</h2><p>いよいよOSのインストールです。 インストールは、画面左の<strong>新しいデバイスのセットアップ</strong>から実行します。 <strong>デバイスの種類</strong>は<strong>Rasoberry Pi 2 &amp; 3</strong>、<strong>OS ビルド</strong>は、<strong>Windows !0 IoT Core (16299)**を選択します。 ドライブは、SDカードが挿入されたドライブを選択します。 **デバイス名</strong>は後から変更できますので、気にしなくても良いです。 <strong>管理者パスワード</strong>は、今後必要になるので忘れないでください。 <strong>ソフトウェア ライセンス条項に同意する</strong>をチェックし、<strong>ダウンロードとインストール</strong>をクリックしてOSイメージの作成を開始します。<br><a href="../../../../public/2017/12/6d9c4f0021b624a091773eb6aa5ccb07.png"><img src="../../../../public/2017/12/6d9c4f0021b624a091773eb6aa5ccb07-1024x691.png"></a></p><p><a href="../../../../public/2017/12/c31d32a52a6b62e2cfa8c7885561cd9d.png"><img src="../../../../public/2017/12/c31d32a52a6b62e2cfa8c7885561cd9d.png"></a><br> 暫くすると、コンソール画面が表示されますが、もう暫く待機します。</p><p><a href="../../../../public/2017/12/83c41adade8f9474b4460529557e1a78.png"><img src="../../../../public/2017/12/83c41adade8f9474b4460529557e1a78-1024x691.png"></a><br> セットアップが完了しましたので、SDカードを抜いて、お手持ちのIoTデバイスに差し込みます。</p><p>IoTデバイスをLANに接続後、画面右側の<strong>自分のデバイス</strong>に移動します。<br><a href="../../../../public/2017/12/3437177837007bfe4bdc3b1007e2042f.png"><img src="../../../../public/2017/12/3437177837007bfe4bdc3b1007e2042f-1024x691.png"></a><br> 自分のデバイスが表示されます。</p><p><a href="../../../../public/2017/12/14966e3f429b05464438d8e2f2e3f409.png"><img src="../../../../public/2017/12/14966e3f429b05464438d8e2f2e3f409-1024x691.png"></a><br> 項目をダブルクリックすると遷移する先でデバイス名を変更できます。</p><h2 id="Go-to-Device-Portal"><a href="#Go-to-Device-Portal" class="headerlink" title="Go to Device Portal"></a>Go to Device Portal</h2><p>Dashboardから出来るのは、OSのインストールとデバイス名の設定ぐらいで、各種詳細設定の変更、リモート接続などは、<strong>Device Portal</strong>から実行します。 デバイス一覧から、対象のデバイスを右クリックすると表示されるコンテキストメニューから<strong>Device Poratl で開く</strong>を選択します。<br><a href="../../../../public/2017/12/1901c5900717c02c163babdc338df3df.png"><img src="../../../../public/2017/12/1901c5900717c02c163babdc338df3df-1024x691.png"></a> 次に認証ダイアログが表示されます。 <a href="../../../../public/2017/12/978349dcf234b9fe0f418626cce2899e.png"><img src="../../../../public/2017/12/978349dcf234b9fe0f418626cce2899e.png"></a><br> 先ほど入力した管理者パスワードを利用してログインします。なおユーザ名は<strong>Administrator</strong>です。</p><p><a href="../../../../public/2017/12/b9d941b43eec258626e1b8164bbadc09.png"><img src="../../../../public/2017/12/b9d941b43eec258626e1b8164bbadc09-1024x704.png"></a><br> 起動しました。</p><p>セットアップは以上です。 <strong>Raspbian</strong>のインストールに比べると非常に簡単です。 このあたりは流石Microsoftといったところでしょう。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> IoT </category>
          
          <category> Windows IoT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WPF メモ その4 CustomControlに対してStyleが効かない</title>
      <link href="/2017/10/28/2681/"/>
      <url>/2017/10/28/2681/</url>
      
        <content type="html"><![CDATA[<h1 id="What-does-it-mean"><a href="#What-does-it-mean" class="headerlink" title="What does it mean?"></a>What does it mean?</h1><p>タイトル通り。 <strong>CustomControl</strong>を作成し、定義した<strong>Style</strong>を適用しても反映されない問題が発生。 小一時間悩みました。</p><h1 id="What’s-wrong"><a href="#What’s-wrong" class="headerlink" title="What’s wrong?"></a>What’s wrong?</h1><p>CustomControlのコンストラクタが悪かったようです。 普通は、 [code lang=”csharp”] public static readonly DependencyProperty OrientationProperty = DependencyProperty.Register( “Orientation”, typeof(Orientation), typeof(TestControl), new FrameworkPropertyMetadata( Orientation.Horizontal, PropertyChangedCallback));<br>public Orientation Orientation { get =&gt; (Orientation)GetValue(OrientationProperty); set =&gt; SetValue(OrientationProperty, value); } [/code]</p><p>みたいな感じでデフォルト値は、<strong>FrameworkPropertyMetadata</strong>の第一引数で指定します。 が、コンストラクタにおいて、 [code lang=”csharp”] public TestControl() { this.Orientation = Orientation.Horizontal; } [/code]</p><p>と余計なものを書いたのが運の尽き。 カスタムコントロールのStyleでOrientationのPropertyを定義しても適用されませんでした。 なので、コンストラクタ内での値の設定をコメントアウトしたら解決しました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで音声処理を試してみる NAudio編 第2回</title>
      <link href="/2017/10/28/2677/"/>
      <url>/2017/10/28/2677/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回から大分間が開きましたが、音声処理の仕事は継続中です。 といっても、毎日の作業全部が音声処理のタスクというわけではないのですが。 音声処理のタスクのうち、複数のチャネルを持つWAVファイルを分割する機能の実装があります。 <strong>5.1ch</strong>の分割を行うようですが、5.1chの**.1**って何？と思って調べてみたら、小数の0.1という訳ではないのね。事実上の6chということの模様。 今回はこの機能を実装してみました。 ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/NAudio3" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/NAudio3</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>今回はコンソールアプリでデモを作りました。 [code lang=”csharp”] using (var wav = new WaveFileReader(path)) { var channels = wav.WaveFormat.Channels; var bitsPerSample = wav.WaveFormat.BitsPerSample; var sampleRate = wav.WaveFormat.SampleRate; var length = (int)(wav.Length / channels); var bitLength = bitsPerSample / 8; if (channels &lt;= 1) { Console.WriteLine(“Input file does not contain multiple channels.”); return; }<br>int bytesRead; var buffer = new byte[bitLength * sampleRate * channels];<br>var buffers = new List<MemoryStream>(); for (var index = 0; index &lt; channels; index++) buffers.Add(new MemoryStream(length));<br>while ((bytesRead = wav.Read(buffer, 0, buffer.Length)) &gt; 0) { var offset = 0; while (offset &lt; bytesRead) { for (var n = 0; n &lt; channels; n++) { buffers[n].Write(buffer, offset, bitLength); offset += bitLength; } } }<br>for (var index = 0; index &lt; channels; index++) { using (var writer = new WaveFileWriter($”{index + 1}.wav”, new WaveFormat(sampleRate, bitsPerSample, 1))) { var buf = buffers[index].GetBuffer(); writer.Write(buf, 0, buf.Length); buffers[index].Dispose(); } } } [/code] wavファイルのパスを指定し、<strong>WaveFileReader</strong>で読み込み、分割を行った後に、チャネル毎に分割して書き出しを行っているだけです。 wavファイルで複数のチャネルは、16bitの4チャネルの場合、先頭から順番に ch1(2byte=16bit) ch2(2byte) ch3(2byte) ch4(2byte) ch1(2byte) ch2(2byte) ch3(2byte) ch4(2byte) .. と繰り返しで格納されています。 なので、それを順番にバッファに書き出しするだけです。 bitsPerSampleを8で除算しているのは、byteに変換しているからですね。</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>手元に複数チャネルの音声ファイルが無かったので、ネットから探しました。 そこで見つけたのが下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/Samples.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www-mmsp.ece.mcgill.ca"></img><div class="hbc-site-name">www-mmsp.ece.mcgill.ca</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">AIFF / AIFC Sample Files</div><div class="hbc-url">http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/Samples.html</div></div></div></div></a></div></div><p>不幸にも5.1chがリンク切れなのですが、8chとか普通じゃお目にかかりそうもないものを見つけたので試しに分割してみました。 <a href="http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/Samples/Microsoft/8_Channel_ID.wav">8_Channel_ID.wav</a>をダウンロードして、デモアプリに渡します。 するとデモアプリと同じフォルダに1.wav,2.wav….8.wavの8つのwavファイルが生成されます。 分割されたファイルにはそれぞれ、 1.wav: 1st: Front Left 2.wav: 2nd: Front Right 3.wav: 3rd: Centre 4.wav: 6th: tone 5.wav: 4th: Back Left 6.wav: 5th: Back Right 7.wav: 7th: Auxiliary Left 8.wav: 8th: Auxiliary Right という単語を発生する男性の声またはトーンだけが含まれています。 元々のファイルにもそれらが時間差で出力されていましたが、これらが綺麗に分離されているのがわかります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>複数チャネルの音声データの分割など、普通は用途がありませんが、そんな要求が来てもこれで大丈夫です。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/NAudio3">https://github.com/takuya-takeuchi/Demo/tree/master/NAudio3</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> マルチメディア </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETで音声処理を試してみる NAudio編 </category>
          
          <category> NAudio </category>
          
          <category> 音声処理 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その92 Visual Studio 2017.3が単体テストを検出できない</title>
      <link href="/2017/10/07/2672/"/>
      <url>/2017/10/07/2672/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>題名の通り。 VS2017からVS2017.3に更新したところ発生しました。 これまでの<strong>Visual Studio</strong>でも同様の事例はありましたが、ここまできてもこのような現象が発生すると萎えます。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>例のごとく<strong>Stackoverflow</strong>で回答が。 </p><p>ただ、最終的にAnswerにはなっておらず、一部のコメント投稿者は、後述の方法で解決した模様。 私が試したのは、<strong>MSTest.TestAdapter</strong>, <strong>MSTest.TestFramework</strong> というMicrosoft製のNugetパッケージを更新する方法でした。<br><a href="../../../../public/2017/10/6ea8cd337f014a1c80024ebc7363449c.png"><img src="../../../../public/2017/10/6ea8cd337f014a1c80024ebc7363449c.png"></a><br> どちらも1.1.18になっていればOKかと。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その91 WindowsでMiniconda2と3を共存させる</title>
      <link href="/2017/09/20/2670/"/>
      <url>/2017/09/20/2670/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>PythonのWindows用環境は<strong>Anaconda</strong>や<strong>Miniconda</strong>が有名ですが、初期パッケージの数が少ないMinicondaを専ら好んで使っています。 そんなMinicondaは<strong>Python 2.7</strong>と<strong>Python 3.6</strong>をインストールできるパッケージが用意されています。 これを使い分けて、Windowsの環境に共存させたいと思います。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="Case-of-Anaconda"><a href="#Case-of-Anaconda" class="headerlink" title="Case of Anaconda"></a>Case of Anaconda</h2><p>実は、Anacondaでの2と3の共存については記事があります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://whitecat-student.hatenablog.com/entry/2016/12/28/193156" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=whitecat-student.hatenablog.com"></img><div class="hbc-site-name">白猫学生のブログ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/8454420450088709163/10328749687201786710/1531993719"></img></div><div class="hbc-text"><div class="hbc-title">Anacondaを用いてPython2とPython3を共存させる方法 (Windows) - 白猫学生のブログ</div><div class="hbc-url">http://whitecat-student.hatenablog.com/entry/2016/12/28/193156</div><div class="hbc-description">はじめに Pythonはずっと昔に3系列にバージョンがアップされましたが，いまだに2系列を使用している人が数多くいると思います．(自分もその一人です) 当時はライブラリが3系列に対応していなかったり，仕様の微妙な変更等が理由でPython3への移行をしなかった方が多かったと思いま…</div></div></div></div></a></div></div><p>今回はこれを参考にさせてもらいました。</p><h2 id="Case-of-Miniconda"><a href="#Case-of-Miniconda" class="headerlink" title="Case of Miniconda"></a>Case of Miniconda</h2><p>やることは変わりません。 私は、Python2をデフォルトにしました。3をデフォルトにしてはいませんが、多分大丈夫? まず環境変数ですが、</p><ul><li>Miniconda2のインストール先<ul><li>C:\Program Files\Miniconda2</li></ul></li><li>Miniconda3のインストール先<ul><li>C:\Program Files\Miniconda3</li></ul></li></ul><p>とします。 ユーザーの環境変数 <strong>(システムの環境変数ではない!!)</strong> の<strong>PATH</strong>が、下記の順序で追加されているようにします。</p><ul><li>C:\Program Files\Miniconda2</li><li>C:\Program Files\Miniconda2\Scripts</li><li>C:\Program Files\Miniconda2\Library\bin</li><li>C:\Program Files\Miniconda3</li><li>C:\Program Files\Miniconda3\Scripts</li><li>C:\Program Files\Miniconda3\Library\bin</li></ul><p>最後に、コマンドプロンプトを立ち上げ、<strong>Miniconda3</strong>のインストールパスに移動します。 必要に応じて管理者権限は付与してください。 そして下記のコマンドを叩きます。 [code lang=”batch”] copy python.exe python3.exe cd Scripts move conda.exe conda3.exe move conda-script.py conda3-script.py move easy_install.exe easy_install3.exe move easy_install-script.py easy_install3-script.py move pip.exe pip3.exe move pip-script.py pip3-script.py [/code]</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>コマンドプロンプトを立ち上げ直します。 そして、正しく共存できているかを確認します。 [code lang=”batch”] C:\Users\XXXXXX&gt;python3 –version Python 3.6.1 :: Continuum Analytics, Inc.<br>C:\Users\XXXXXX&gt;python –version Python 2.7.11 :: Continuum Analytics, Inc. [/code] 無事に共存できました!!</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その90 Visual Studio Code on WindowsでCMakeを使うとエラーになる</title>
      <link href="/2017/09/17/2664/"/>
      <url>/2017/09/17/2664/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>最新の<strong>CMake 3.9.2</strong>が悪いのか、<strong>Visual Studio Code</strong>でCMakeを使おうとするとエラーになります。 WindowsのVisual Studio CodeでCmakeを使うという記事はたくさんあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://qiita.com/bigengelt/items/e4c6f08003fe15988b7d" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DVSCode%25E3%2581%25A7C%252B%252B%25E3%2583%2587%25E3%2583%2590%25E3%2583%2583%25E3%2582%25B0%2528Windows%2529%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3De7f854c6a7505bc0fb02c23d19f76bc2&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540bigengelt%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3Df8f2975fe15c9bbecccaf1b41bd9db12&blend-align=center%2Cmiddle&blend-mode=normal&s=ef6c390ac152d2ce137129e316208fc1"></img></div><div class="hbc-text"><div class="hbc-title">VSCodeでC++デバッグ(Windows) - Qiita</div><div class="hbc-url">http://qiita.com/bigengelt/items/e4c6f08003fe15988b7d</div><div class="hbc-description">概要Visual Studio Codeを使ってVC++のデバッグ＋ビルドを行う方法CMakeの使い方等はこの記事には載せませんので注意してください。また、記事に対するもっと良い方法等があれば是非コメントをお願い致します。...</div></div></div></div></a></div></div><p>が、それでも上手くいかない。 Lixnuでは既に自分でも試しており楽勝のはずだったのですが… </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2017/08/17/%e9%96%8b%e7%99%ba%e3%83%a1%e3%83%a2-%e3%81%9d%e3%81%ae83-fedora-26-server%e3%81%a7cmake%e3%81%8b%e3%82%89%e5%85%b1%e6%9c%89%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%82%92%e4%bd%9c%e6%88%90/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">開発メモ その83 Fedora 26 ServerでCMakeから共有ライブラリを作成する – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2017/08/17/%e9%96%8b%e7%99%ba%e3%83%a1%e3%83%a2-%e3%81%9d%e3%81%ae83-fedora-26-server%e3%81%a7cmake%e3%81%8b%e3%82%89%e5%85%b1%e6%9c%89%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%82%92%e4%bd%9c%e6%88%90/</div></div></div></div></a></div></div><p>具体的には、<br><a href="../../../../public/2017/09/acbabd5460f36a5f5ebd33f54fb0649a.png"><img src="../../../../public/2017/09/acbabd5460f36a5f5ebd33f54fb0649a-1024x697.png"></a><br> <strong>Started new CMake Server instance with PID 13456 Build program for generator Ninja is not found. Skipping… Build program for generator Unix Makefiles is not found. Skipping… None of preferred generators available on the system.</strong> というエラーが出力されております。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p><strong>CMake tools</strong>のIssueにヒントがありました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/vector-of-bool/vscode-cmake-tools/issues/132" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/6154722?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">CMake server: Unable to determine CMake Generator to use · Issue #132 · microsoft/vscode-cmake-tools</div><div class="hbc-url">https://github.com/vector-of-bool/vscode-cmake-tools/issues/132</div><div class="hbc-description">After upgrading my cmake install to 3.7.2, enabling the cmake server option in the vs code settings, and restarting vs code, I get the messa…</div></div></div></div></a></div></div><p>エラー出力にもありますが、<strong>Ninja</strong>が存在しない、って言っているのでそれをインストールします。</p><h2 id="What-is-Ninja"><a href="#What-is-Ninja" class="headerlink" title="What is Ninja?"></a>What is Ninja?</h2><p>Ninjaはスピードに特化した小型のビルドツールとのこと。 私はよくわからないので、詳しいことはググってください。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/ninja-build/ninja" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/11653218?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">ninja-build/ninja</div><div class="hbc-url">https://github.com/ninja-build/ninja</div><div class="hbc-description">a small build system with a focus on speed. Contribute to ninja-build/ninja development by creating an account on GitHub.</div></div></div></div></a></div></div><p>とりあえず、Githubのリリースから最新のバイナリをダウンロードして適当なフォルダに配置します。</p><h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>続いて、Visual Studio Codeの設定に、下記のような内容を記述します。 [code lang=”json”] { “cmake.generator”: “Ninja”, “cmake.configureSettings”: { “CMAKE_MAKE_PROGRAM”: “D:/Works/Lib/Ninja/1.8.2/ninja.exe” } } [/code] 設定後、Visual Studio Codeを再起動し、いつものように<strong>Cake: Quick Start</strong>的な感じで始めることが出来るようになっているはずです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> その他 </category>
          
          <category> CMake </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その89 dlibの顔検出性能をCUDA ON/OFFで比較</title>
      <link href="/2017/08/26/2498/"/>
      <url>/2017/08/26/2498/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>前回は<strong>dlib</strong>をCUDAを有効にしたバイナリ、無効にしたバイナリを生成しました。 </p><p>具体的に、CUDAを有効にしている状態で、どれだけ性能差が出るのかを比較したいと思います。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>まずは、実験に使う画像を用意します。 今回は下記を用意しました。<br><a href="../../../../public/2017/07/G7_summit_at_Shimakan_thumbnail.jpg"><img src="../../../../public/2017/07/G7_summit_at_Shimakan_thumbnail.jpg"></a><br> <strong>元画像: <a href="https://upload.wikimedia.org/wikipedia/commons/b/b7/G7/_summit/_at/_Shimakan.jpg">https://upload.wikimedia.org/wikipedia/commons/b/b7/G7\_summit\_at\_Shimakan.jpg</a></strong> 4368x2912の大きなサイズです。 次に計測を行うソースです。 <strong>examples\face_detection_ex.cpp</strong>という顔検出のサンプルがあります。 [code lang=”cpp”] #include &lt;dlib/image_processing/frontal_face_detector.h&gt; #include &lt;dlib/gui_widgets.h&gt; #include &lt;dlib/image_io.h&gt; #include <iostream><br>using namespace dlib; using namespace std;<br>// —————————————————————————————-<br>int main(int argc, char** argv) { try { if (argc == 1) { cout &lt;&lt; “Give some image files as arguments to this program.” &lt;&lt; endl; return 0; }<br>frontal_face_detector detector = get_frontal_face_detector(); image_window win;<br>// Loop over all the images provided on the command line. for (int i = 1; i &lt; argc; ++i) { cout &lt;&lt; “processing image “ &lt;&lt; argv[i] &lt;&lt; endl; array2d<unsigned char> img; load_image(img, argv[i]); // Make the image bigger by a factor of two. This is useful since // the face detector looks for faces that are about 80 by 80 pixels // or larger. Therefore, if you want to find faces that are smaller // than that then you need to upsample the image as we do here by // calling pyramid_up(). So this will allow it to detect faces that // are at least 40 by 40 pixels in size. We could call pyramid_up() // again to find even smaller faces, but note that every time we // upsample the image we make the detector run slower since it must // process a larger image. pyramid_up(img);<br>// Now tell the face detector to give us a list of bounding boxes // around all the faces it can find in the image. std::vector<rectangle> dets = detector(img);<br>cout &lt;&lt; “Number of faces detected: “ &lt;&lt; dets.size() &lt;&lt; endl; // Now we show the image on the screen and the face detections as // red overlay boxes. win.clear_overlay(); win.set_image(img); win.add_overlay(dets, rgb_pixel(255,0,0));<br>cout &lt;&lt; “Hit enter to process the next image…” &lt;&lt; endl; cin.get(); } } catch (exception&amp; e) { cout &lt;&lt; “\nexception thrown!” &lt;&lt; endl; cout &lt;&lt; e.what() &lt;&lt; endl; } } [/code] これに対して、上述の画像を認識させると<br><a href="../../../../public/2017/07/result.jpg"><img src="../../../../public/2017/07/result.jpg"></a><br> こうなります。</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>このソースを下記のように改造します。 [code lang=”cpp”] #include &lt;dlib/image_processing/frontal_face_detector.h&gt; #include &lt;dlib/gui_widgets.h&gt; #include &lt;dlib/image_io.h&gt; #include <iostream> #include <chrono><br>using namespace dlib; using namespace std;<br>// —————————————————————————————-<br>int main(int argc, char** argv) { try { if (argc == 1) { cout &lt;&lt; “Give some image files as arguments to this program.” &lt;&lt; endl; return 0; }<br>frontal_face_detector detector = get_frontal_face_detector(); image_window win;<br>std::chrono::system_clock::time_point start, end; start = std::chrono::system_clock::now();<br>// Loop over all the images provided on the command line. for (int c = 0; c &lt; 100; c++) for (int i = 1; i &lt; argc; ++i) { cout &lt;&lt; “processing image “ &lt;&lt; argv[i] &lt;&lt; endl; array2d<unsigned char> img; load_image(img, argv[i]); // Make the image bigger by a factor of two. This is useful since // the face detector looks for faces that are about 80 by 80 pixels // or larger. Therefore, if you want to find faces that are smaller // than that then you need to upsample the image as we do here by // calling pyramid_up(). So this will allow it to detect faces that // are at least 40 by 40 pixels in size. We could call pyramid_up() // again to find even smaller faces, but note that every time we // upsample the image we make the detector run slower since it must // process a larger image. pyramid_up(img);<br>// Now tell the face detector to give us a list of bounding boxes // around all the faces it can find in the image. std::vector<rectangle> dets = detector(img);<br>//cout &lt;&lt; “Number of faces detected: “ &lt;&lt; dets.size() &lt;&lt; endl; // Now we show the image on the screen and the face detections as // red overlay boxes. //win.clear_overlay(); //win.set_image(img); //win.add_overlay(dets, rgb_pixel(255,0,0));<br>//cout &lt;&lt; “Hit enter to process the next image…” &lt;&lt; endl; //cin.get(); }<br>end = std::chrono::system_clock::now(); double elapsed = std::chrono::duration_cast<a href="std::chrono::milliseconds">std::chrono::milliseconds</a>(end-start).count(); //ミリ秒に変換<br>std::cout &lt;&lt; std::fixed; cout &lt;&lt; “Total: “ &lt;&lt; std::setprecision(4) &lt;&lt; elapsed &lt;&lt; endl; cout &lt;&lt; “Average: “ &lt;&lt; std::setprecision(4) &lt;&lt; elapsed / 100 &lt;&lt; endl; } catch (exception&amp; e) { cout &lt;&lt; “\nexception thrown!” &lt;&lt; endl; cout &lt;&lt; e.what() &lt;&lt; endl; } } [/code] 要するに、入力した画像ファイルを100回認識させ、その処理に要した合計時間と平均時間を算出するようにしただけです。 下記がその結果です。</p><p>Left align</p><p>Total(ms)</p><p>Average(ms)</p><p>w/o CUDA</p><p>1007778.0000</p><p>10077.7800</p><p>w/ CUDA</p><p>997522.0000</p><p>9975.2200</p><p>正直微妙です。約10%しか差がありません。</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> gpupu </category>
          
          <category> CUDA </category>
          
          <category> 機械学習 </category>
          
          <category> GPUPU </category>
          
          <category> dlib </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第8回</title>
      <link href="/2017/08/22/2619/"/>
      <url>/2017/08/22/2619/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、自作のSharedライブラリに定義された関数をP/Invokeで呼び出してみました。 </p><p>しかしながら、毎回毎回**/usr/local/lib**とかにコピーするのってどうなんでしょう? Windowsみたいに、実行ファイルと同じディレクトリにSharedライブラリを配置しても動作するのでしょうか? Windowsの場合、exeが呼び出すdllは、実行ファイルから以下の順序で検索されます。</p><ol><li>実行中のプロセスの実行形式モジュールがあるフォルダー。</li><li>現在のフォルダー。</li><li>Windows システム フォルダー。 このフォルダーへのパスは、GetSystemDirectory 関数が取得します。</li><li>Windows ディレクトリ。 このフォルダーへのパスは、GetWindowsDirectory 関数が取得します。</li><li>環境変数 PATH 内に記述されたフォルダー。</li></ol><p>Linuxの場合、3,4以外は同じ条件で試すことができそうです。 ただ、.NET Coreの場合、<strong>dotnet run</strong>で動作する場合のカレントディレクトリに関して情報がないので、2もちょっと先送り。 最終的に下記の内容をテストしてみます。</p><ol><li>Sharedライブラリをシステムから削除</li><li>Sharedライブラリを実行ファイルと同じフォルダに配置</li><li>LD_LIBRARY_PATHと実行ファイルと同じフォルダの優先順位</li></ol><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>サンプルは、<a href="https://taktak.jp/2017/08/19/net%e3%81%a7linux%e3%81%a8%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%82%8b-visual-studio-code%e7%b7%a8-%e7%ac%ac7%e5%9b%9e/">.NETでLinuxと遊んでみる Visual Studio Code編 第7回</a>と同じものを使います。</p><h2 id="Sharedライブラリをシステムから削除"><a href="#Sharedライブラリをシステムから削除" class="headerlink" title="Sharedライブラリをシステムから削除"></a>Sharedライブラリをシステムから削除</h2><p>これは動かないはずです。 実行ファイルと同じディレクトリ、/usr/local/lib64にSharedライブラリが存在しないことを確認してから実行してみます。 [code lang=”sh”] $ sudo updatedb $ sudo locate libCppLib.so /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CppLib/build/libCppLib.so /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CsharpApp/bin/Debug/netcoreapp2.0/libCppLib.so.bak $ export | grep LD_LIBRARY_PATH $ pwd /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CsharpApp $ dotnet run 20 50<br>Unhandled Exception: System.DllNotFoundException: Unable to load DLL ‘libCppLib.so’: The specified module or one of its dependencies could not be found. (Exception from HRESULT: 0x8007007E) at CsharpApp.Program.Add(Int32 x, Int32 y) at CsharpApp.Program.Main(String[] args) in /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CsharpApp/Program.cs:line 15 [/code] Windowsと同じように、<strong>System.DllNotFoundException</strong>がスローされました。 期待通りです。</p><h2 id="Sharedライブラリを実行ファイルと同じフォルダに配置"><a href="#Sharedライブラリを実行ファイルと同じフォルダに配置" class="headerlink" title="Sharedライブラリを実行ファイルと同じフォルダに配置"></a>Sharedライブラリを実行ファイルと同じフォルダに配置</h2><p>[code lang=”sh”] $ pwd /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CsharpApp $ ls -la bin/Debug/netcoreapp2.0/ 合計 32 drwxrwxr-x 2 xxxxxx xxxxxx 171 8月 21 23:50 . drwxrwxr-x 3 xxxxxx xxxxxx 27 8月 19 06:58 .. -rw-rw-r– 1 xxxxxx xxxxxx 437 8月 19 07:41 CsharpApp.deps.json -rw-rw-r– 1 xxxxxx xxxxxx 4608 8月 21 23:43 CsharpApp.dll -rw-rw-r– 1 xxxxxx xxxxxx 568 8月 21 23:43 CsharpApp.pdb -rw-rw-r– 1 xxxxxx xxxxxx 206 8月 19 07:41 CsharpApp.runtimeconfig.dev.json -rw-rw-r– 1 xxxxxx xxxxxx 146 8月 19 07:41 CsharpApp.runtimeconfig.json -rwxr-xr-x 1 root root 8016 8月 19 07:56 libCppLib.so $ dotnet run 20 50 20 + 50 = 70 [/code] きちんと動作しました。</p><h2 id="LD-LIBRARY-PATHと実行ファイルと同じフォルダの優先順位"><a href="#LD-LIBRARY-PATHと実行ファイルと同じフォルダの優先順位" class="headerlink" title="LD_LIBRARY_PATHと実行ファイルと同じフォルダの優先順位"></a>LD_LIBRARY_PATHと実行ファイルと同じフォルダの優先順位</h2><p>これは気になりますね。 別に.NET Coreに関係なく、Linuxの仕組みと同じような気がしますが… 実行時、どちらが呼び出されたかわかるように、Sharedライブラリ側を修正します。 <strong>実行ファイルに配置するSharedライブラリ</strong> [code lang=”cpp”] #include <iostream><br>extern “C” int Add(int x, int y){ printf(“from executed directory\n”);return x + y; } [/code] <strong>/usr/local/lib64に配置するSharedライブラリ</strong> [code lang=”cpp”] #include <iostream><br>extern “C” int Add(int x, int y){ printf(“from /usr/local/lib64\n”);return x + y; } [/code] これらをそれぞれビルドして、**/usr/local/lib64<strong>、実行ファイルと同じディレクトリである</strong>bin/Debug/netcoreapp2.0/**にコピーします。 また、環境変数LD_LIBRARY_PATHに/usr/local/lib64を追加します。 一応、各ディレクトリにSharedライブラリがコピーされたことも確認しておきます。 そして、dotnet runで実行します。 [code lang=”sh”] $ pwd /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CsharpApp $ export LD_LIBRARY_PATH=/usr/local/lib64 $ sudo updatedb $ locate libCppLib.so /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CppLib/build/libCppLib.so /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CsharpApp/bin/Debug/netcoreapp2.0/libCppLib.so /usr/local/lib64/libCppLib.so $ dotnet run 20 53 from executed directory 20 + 53 = 73 $ rm bin/Debug/netcoreapp2.0/libCppLib.so $ dotnet run 20 53 from /usr/local/lib64 20 + 53 = 73 [/code] 結果としては、実行フォルダのSharedライブラリが優先されました。 また、実行フォルダのSharedライブラリを削除しても、/usr/local/lib64のSharedライブラリが使用され、きちんと動作することもわかりました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>結論としては、Windowsと同じく、実行ファイルのあるディレクトリに配置されているライブラリが優先のようですね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> C/C++ </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> Fedora </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その88 C/C++からPythonを呼び出せない</title>
      <link href="/2017/08/21/2645/"/>
      <url>/2017/08/21/2645/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>前回、C/C++のコードからPythonを呼び出してみました。 </p><p>が、自宅の環境だと、Windows 10で動作し、Windows 7で動作しないという問題が発生しました。</p><h2 id="Windows-10"><a href="#Windows-10" class="headerlink" title="Windows 10"></a>Windows 10</h2><p>[code lang=”batch”] b:\Release&gt;ver<br>Microsoft Windows [Version 10.0.15063]<br>b:\Release&gt;where python C:\Python27\python.exe C:\Program Files\Miniconda2\python.exe<br>b:\Release&gt;ConsoleApplication.exe 10 [/code]</p><h2 id="Windows-7"><a href="#Windows-7" class="headerlink" title="Windows 7"></a>Windows 7</h2><p>[code lang=”batch”] D:\Works\Demo\CppPython1\x64\Release&gt;ver<br>Microsoft Windows [Version 6.1.7601]<br>D:\Works\Demo\CppPython1\x64\Release&gt;where python C:\Program Files\Miniconda2\python.exe<br>D:\Works\Demo\CppPython1\x64\Release&gt;ConsoleApplication.exe ImportError: No module named site [/code] python.exeはPathが通っているのは間違いないのですが… きになるのは、Windows 10側はPythonインタプリタが一つ多いところ。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>調べてみると、そこそこ発生している問題の様子。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://stackoverflow.com/questions/38465049/python-no-module-named-site" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=stackoverflow.com"></img><div class="hbc-site-name">Stack Overflow</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded"></img></div><div class="hbc-text"><div class="hbc-title">python &quot;No module named site&quot;</div><div class="hbc-url">https://stackoverflow.com/questions/38465049/python-no-module-named-site</div><div class="hbc-description">So I have searched this question before, and it&#39;s been answered satisfactorily for other users on stackoverflow (Python (Windows) - ImportEr…</div></div></div></div></a></div></div><p>ただ、どれも<strong>環境変数PYTHONHOME, PYTHONPATH</strong>を通せ、という説明だけで、私の環境は解決できませんでした。 そもそも、Windows 10側にはこの2つの環境変数は定義されていませんでしたし。 そんな中、日本語の開発者向けQ&amp;Aコミュニティ<strong>teratail</strong>で回答を見つけました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://teratail.com/questions/28234" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=teratail.com"></img><div class="hbc-site-name">teratail[テラテイル]</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://teratail.com/img/imgFacebookShare.png"></img></div><div class="hbc-text"><div class="hbc-title">windows7/64bit下のpythonでのreportlabのインストール｜teratail</div><div class="hbc-url">https://teratail.com/questions/28234</div><div class="hbc-description">windows7/64bit,pytho2.6環境でreportlabをインストールしようとすると、pythonが見つからない旨のメッセージが表示されてしまい、インストールができません。pdfの生成で使いたいのですが、もし不可能なのであれば他の手段も考慮に入れたいと思っています。…</div></div></div></div></a></div></div><p>ようするに、レジストリがおかしいよ、という話。 確かに、Windows 10側には指摘されているレジストリの項目が存在していましたが、Windows 7側にはありませんでした。 そのため、レジストリに適切な値を追加することで動作するようです。 上のteratailの回答では親切にもレジストリへの追加スクリプトも用意してありましたので、適切に書き換えて実行するだけです。 実行前に、問題のレジストリが存在しないことを確認してから実行します。 自分の環境では、<strong>Miniconda</strong>に関連付けたいので下記のように修正しました。 インストールしてあるMinicondaは4.0.5 64bit (Python 2.7.11)版でした。 <strong>OS=64bit python=32bit用</strong> [code] Windows Registry Editor Version 5.00<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Python\PythonCore\2.7]<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Python\PythonCore\2.7\Help]<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Python\PythonCore\2.7\Help\MainPythonDocumentation] @=”C:\\Program Files (x86)\\Miniconda2\\Doc\\python2713.chm”<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Python\PythonCore\2.7\InstallPath] @=”C:\\Program Files (x86)\\Miniconda2\\“<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Python\PythonCore\2.7\InstallPath\InstallGroup] @=”Python 2.7”<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Python\PythonCore\2.7\Modules]<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Python\PythonCore\2.7\PythonPath] @=”C:\\Program Files\\Miniconda2 (x86)\\Lib;C:\\Program Files\\Miniconda2 (x86)\\DLLs;C:\\Program Files (x86)\\Miniconda2\\Lib\\lib-tk” [/code]</p><p><strong>OS=64bit python=64bit または OS=32bit用</strong> [code] Windows Registry Editor Version 5.00<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Python\PythonCore\2.7]<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Python\PythonCore\2.7\Help]<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Python\PythonCore\2.7\Help\MainPythonDocumentation] @=”C:\\Program Files\\Miniconda2\\Doc\\python2713.chm”<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Python\PythonCore\2.7\InstallPath] @=”C:\\Program Files\\Miniconda2\\“<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Python\PythonCore\2.7\InstallPath\InstallGroup] @=”Python 2.7”<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Python\PythonCore\2.7\Modules]<br>[HKEY_LOCAL_MACHINE\SOFTWARE\Python\PythonCore\2.7\PythonPath] @=”C:\\Program Files\\Miniconda2\\Lib;C:\\Program Files\\Miniconda2\\DLLs;C:\\Program Files\\Miniconda2\\Lib\\lib-tk” [/code] 上の内容を、**&lt;適当な名前&gt;.reg**とつけてファイルに保存し、ダブルクリックで実行します。 その後、プログラムを実行するとうまくいくようになりました、<br><a href="../../../../public/2017/08/6a69f2dcca0c98660993126e2b5a8910.png"><img src="../../../../public/2017/08/6a69f2dcca0c98660993126e2b5a8910.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> C/C++ </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その87 C/C++からPythonを呼び出す</title>
      <link href="/2017/08/21/2634/"/>
      <url>/2017/08/21/2634/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Pythonはグルー言語、として有名ですが、C#から呼び出す、というか**.NET Framework<strong>上で動作するPythonの実装である</strong>IronPython**はもう期待できる状態ではありません。 </p><p>ですが、Pythonで書かれたプログラムは豊富で、既存のプログラムから呼び出せるようにすると非常に便利なので、C/C++から呼び出す手法を習得してみます。<br>Visual Studioを想定しています。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p><strong>PythonMod.py</strong> </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">  <span class="keyword">return</span> x + y </span><br></pre></td></tr></table></figure><p>足し算を行う関数です。</p><h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><p><strong>ConsoleApplication.cpp</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsoleApplication.cpp : コンソール アプリケーションのエントリ ポイントを定義します。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOST_PYTHON_STATIC_LIB</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/python.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* scriptFileName = <span class="string">&quot;PythonMod.py&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* scriptAddFunc = <span class="string">&quot;add&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Py_Initialize();</span><br><span class="line"></span><br><span class="line">    boost::python::object modle = boost::python::<span class="keyword">import</span>(<span class="string">&quot;__main__&quot;</span>);</span><br><span class="line">    boost::python::object attr = modle.attr(<span class="string">&quot;__dict__&quot;</span>);</span><br><span class="line"></span><br><span class="line">    boost::python::exec_file(scriptFileName, attr, attr);</span><br><span class="line"></span><br><span class="line">    boost::python::object pythonFun = attr[scriptAddFunc];</span><br><span class="line"></span><br><span class="line">    boost::python::object v = pythonFun(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; boost::python::extract&lt;<span class="keyword">int</span>&gt;(v) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ソースはシンプルです。</p><h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><p>使用している関数の説明です。</p><h4 id="Py-Initialize"><a href="#Py-Initialize" class="headerlink" title="Py_Initialize"></a>Py_Initialize</h4><p>Python インタプリタを初期化。Python の埋め込みを行うアプリケーションでは、一番最初にこの関数を呼ぶ必要がある。 </p><h4 id="boost-python-import"><a href="#boost-python-import" class="headerlink" title="boost::python::import"></a>boost::python::import</h4><p>指定した名前のモジュールをインポートします。<br>また、attr関数は指定した名前の属性を取得します。<br><strong>__dict</strong>は特殊な属性で、クラスに対して使用した場合は、クラスに属するクラス変数やメソッドのオブジェクトが保存されており、クラスのインスタンスに対して使用した場合は、インスタンス変数の辞書が保存されている。<br>このあたりはお約束的なコードになる。</p><h4 id="boost-python-exec-file"><a href="#boost-python-exec-file" class="headerlink" title="boost::python::exec_file"></a>boost::python::exec_file</h4><p>指定したファイル名のPythonスクリプトを実行します。<br>ただ、実行するといっても、この時点では何か実行されるわけではないです。<br>似た関数として、<strong>boost::python::exec</strong>もあるが、こちらはPythonスクリプトの中身の文字列そのものを読み込む。<br>意味的には、第2引数、第3引数に指定した変数にデータを読み込んでいる感じ。</p><h4 id="attr-scriptAddFunc"><a href="#attr-scriptAddFunc" class="headerlink" title="attr[scriptAddFunc]"></a>attr[scriptAddFunc]</h4><p>先の説明にあったように、<strong>__dict</strong>属性は、メソッドや変数を保持している特殊な属性である。<br>そのため、<strong>exec_file</strong>で読み込んだ後は、メソッドなどを名前で検索できるようになっている。<br>先に示したPythonスクリプト内の<strong>add</strong>メソッドをオブジェクトとして取得しています。</p><h4 id="boost-python-object-v-pythonFun-2-5"><a href="#boost-python-object-v-pythonFun-2-5" class="headerlink" title="boost::python::object v = pythonFun(2, 5);"></a>boost::python::object v = pythonFun(2, 5);</h4><p>オブジェクトとして取得したaddメソッドに引数を与えて実行しています。</p><h4 id="boost-python-extract-gt-v"><a href="#boost-python-extract-gt-v" class="headerlink" title="boost::python::extract&gt;(v)"></a>boost::python::extract<int>&gt;(v)</h4><p>実行したaddメソッドの戻りを適切な型に変換しています。</p><h3 id="VC-Project-Setting"><a href="#VC-Project-Setting" class="headerlink" title="VC++ Project Setting"></a>VC++ Project Setting</h3><p>VC++のプロジェクトの設定として</p><h4 id="Include-Directory"><a href="#Include-Directory" class="headerlink" title="Include Directory"></a>Include Directory</h4><ul><li><strong>C:\Program Files\Miniconda2\pkgs\python-2.7.13-0\include</strong> <strong>Miniconda</strong>をインストールしている場合はここだが、環境依存。</li><li><strong>&lt;boost_dir&gt;</strong> boostのインストールディレクトリ。このディレクトリから<strong>boost/python.hpp</strong>が参照できる</li></ul><h4 id="Additional-Library-Directory"><a href="#Additional-Library-Directory" class="headerlink" title="Additional Library Directory"></a>Additional Library Directory</h4><ul><li><strong>C:\Program Files\Miniconda2\pkgs\python-2.7.13-0\libs</strong> <strong>Miniconda</strong>をインストールしている場合はここだが、環境依存。</li><li><strong>&lt;boost_dir&gt;\lib64-msvc-14.0</strong> インストールしているboostのバージョンに依存。</li></ul><h4 id="Additional-Library"><a href="#Additional-Library" class="headerlink" title="Additional Library"></a>Additional Library</h4><ul><li><strong>python27.lib</strong></li><li>boostのlib ソース側で<strong>BOOST_PYTHON_STATIC_LIB</strong>を指定しているため指定不要。boostを静的にリンクすることになる。</li></ul><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>特に考えず、普通にビルドして実行するだけです。<br>注意するのは、Pythonスクリプトを実行ファイルと同一ディレクトリに配置することくらいです。<br><strong>2+5</strong>の結果が正しく表示されています。</p><p><a href="../../../../public/2017/08/48c5ac4d726ce08cdbecdc1bfbd36f85.png"><img src="../../../../public/2017/08/48c5ac4d726ce08cdbecdc1bfbd36f85.png"></a></p><p><strong>PythonMod.py</strong>のaddメソッドを積算に変更した場合。</p><p><a href="../../../../public/2017/08/aab897268891e0c75f4877ad78a758ed.png"><img src="../../../../public/2017/08/aab897268891e0c75f4877ad78a758ed.png"></a></p><p>C++側の修正なしで挙動の変更が可能です。<br>このあたりはIronPythonと同じです。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> C/C++ </category>
          
          <category> その他 </category>
          
          <category> Python </category>
          
          <category> boost </category>
          
          <category> python-2 </category>
          
          <category> Boost.Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その86 Fedora 26 ServerでGitKrakenのデスクトップアイコンを表示する</title>
      <link href="/2017/08/21/2629/"/>
      <url>/2017/08/21/2629/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>前回、デスクトップにアイコンを表示できるようになりました。 </p> WindowsならExplorerからAlt+ドラッグアンドドロップでショートカットを作れます。 Linuxでも可能ですが、これで作られるのは、ただのシンボリックリンクです。<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p><strong>結論から言うと、やり方がわかりませんでした＼(^o^)／</strong></p><p>ですが、ランチャに登録する方法はわかりました。 GithubGistにアイコンも含めて登録するスクリプトを書いてくださった方いました。 </p><p>ただ、この方法だと、デスクトップに表示する方法で私の環境では動作しませんでした。 なので、少し書き換えて、ランチャに登録するようにしてみました。 [code lang=”sh”] echo “export PATH=\$PATH:/opt/gitkraken” &gt;&gt; ~/.bashrc source ~/.bashrc<br>wget <a href="http://img.informer.com/icons/_mac/png/128/422/422255.png">http://img.informer.com/icons\_mac/png/128/422/422255.png</a> mv 422255.png /opt/gitkraken/icon.png<br>cd ~/.local/share/applications<br>touch gitkraken.desktop vi gitkraken.desktop [/code] viで開いたテキストに下記の内容を入力して保存します。 [code] [Desktop Entry] Name=GitKraken Comment=Git Flow Exec=/opt/gitkraken/gitkraken Icon=/opt/gitkraken/icon.png Terminal=false Type=Application Encoding=UTF-8 Categories=Utility;Development; [/code] ランチャから<strong>GitKraken</strong>が見つかるようになりました。 アプリを起動し、お気に入りに追加することもできます。<br><a href="../../../../public/2017/08/08a108ca47a075c72548170833e80db0.png"><img src="../../../../public/2017/08/08a108ca47a075c72548170833e80db0-1024x668.png"></a></p><p>右クリックでメニューが表示されるので、<strong>お気に入りに追加</strong>をクリックします。<br><a href="../../../../public/2017/08/182e537fc3406f876214e4a213ef3ac0.png"><img src="../../../../public/2017/08/182e537fc3406f876214e4a213ef3ac0-1024x668.png"></a></p><p>左側のバーに追加されました。<br><a href="../../../../public/2017/08/02ffb98ff9ba5c1fffab88d09f3b9e61.png"><img src="../../../../public/2017/08/02ffb98ff9ba5c1fffab88d09f3b9e61-1024x668.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> バージョン管理システム </category>
          
          <category> Fedora </category>
          
          <category> git </category>
          
          <category> GitKraken </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その85 Fedora 26 Serverでデスクトップにアイコンを表示する</title>
      <link href="/2017/08/20/2624/"/>
      <url>/2017/08/20/2624/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Fedora 26</strong>をインストールしたとき、デスクトップに何も表示されていませんし、アプリをデスクトップに表示したいと思いましたが方法がわからないのでメモ。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>そのものズバリな記事を書いていらっしゃる方がいました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://bitwalk.blogspot.jp/2016/12/gnome.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=bitwalk.blogspot.jp"></img><div class="hbc-site-name">bitwalk.blogspot.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://1.bp.blogspot.com/-YlUonmrL_4E/VoOtbjPcImI/AAAAAAAAEZk/nMefjzdNxwI/w1200-h630-p-k-no-nu/gnome.png"></img></div><div class="hbc-text"><div class="hbc-title">GNOME デスクトップにアイコンを表示する</div><div class="hbc-url">http://bitwalk.blogspot.jp/2016/12/gnome.html</div><div class="hbc-description"> F edora 25 から、 Wayland  がデフォルトの ウィンドウシステム に採用されるようになりました。Wayland は、 X Window System  の代替を目指している Linux 向けに開発されたディスプレイサーバーのプロトコルで、 OpenGL ES …</div></div></div></div></a></div></div><p><strong>Gnome Tweak Tool</strong>をインストールして設定すれば使えるとのこと。 下記でインストール可能。 [code lang=”sh”] $ sudo dnf install -y gnome-tweak-tool $ which gnome-tweak-tool /usr/bin/gnome-tweak-tool [/code] 起動は、デスクトップ画面で端末を立ち上げて、<strong>gnome-tweak-tool</strong>として起動します。<br><a href="../../../../public/2017/08/e36043fd0b41ad6403b27ef2dc5cfeff.png"><img src="../../../../public/2017/08/e36043fd0b41ad6403b27ef2dc5cfeff-1024x668.png"></a></p><p><strong>デスクトップ</strong>タブを選択します。<br><a href="../../../../public/2017/08/a412ed2d82ca2d8d8b541e42a04dd5af.png"><img src="../../../../public/2017/08/a412ed2d82ca2d8d8b541e42a04dd5af-1024x668.png"></a></p><p><strong>デスクトップにアイコンを表示する</strong>を有効にすると、アイコンが表示されます。<br><a href="../../../../public/2017/08/47c5d13c0bc776be9ff32aa6e54f573e.png"><img src="../../../../public/2017/08/47c5d13c0bc776be9ff32aa6e54f573e-1024x668.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第7回</title>
      <link href="/2017/08/19/2610/"/>
      <url>/2017/08/19/2610/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前々回は、<strong>GLibc</strong>内の関数をP/Invokeで呼び出してみました。 </p><p>また、CMakeでビルドしたC++のライブラリで関数を公開してみました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2017/08/19/%E9%96%8B%E7%99%BA%E3%83%A1%E3%83%A2-%E3%81%9D%E3%81%AE84-visual-studio-code%E3%81%AEcmake%E3%81%8B%E3%82%89%E9%96%A2%E6%95%B0%E3%82%92export%E3%81%99%E3%82%8B/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">開発メモ その84 Visual Studio CodeのCMakeから関数をExportする – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2017/08/19/%E9%96%8B%E7%99%BA%E3%83%A1%E3%83%A2-%E3%81%9D%E3%81%AE84-visual-studio-code%E3%81%AEcmake%E3%81%8B%E3%82%89%E9%96%A2%E6%95%B0%E3%82%92export%E3%81%99%E3%82%8B/</div></div></div></div></a></div></div><p>これを利用して、.NET CoreでビルドしたC#のアプリケーションから、自作のC++ライブラリの関数を呼びだしてみます。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>C#とC++の簡単なプロジェクトを用意します。 今回のサンプルは </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/DotNetCoreLinux6" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/DotNetCoreLinux6</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>になります。 サンプルは下記の構成になります。</p><ul><li>C++ 2つのint型の引数の和を返すAdd関数を備えたSharedライブラリ</li><li>C# コマンドラインの2つの引数を整数に変換し、その引数をAdd関数に渡した結果を標準出力に表示する実行アプリ</li></ul><h2 id="C"><a href="#C" class="headerlink" title="C#"></a>C#</h2><p><strong>Program.cs</strong> [code lang=”csharp”] using System; using System.Runtime.InteropServices;<br>namespace CsharpApp { class Program { [DllImport(“libCppLib.so”)] private static extern int Add(int x, int y);<br>static void Main(string[] args) { var x = int.Parse(args[0]); var y = int.Parse(args[1]); var sum = Add(x, y); Console.WriteLine($”{x} + {y} = {sum}”); } } } [/code]</p><h2 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h2><p><strong>libCppLib.cpp</strong> [code lang=”cpp”] #include <iostream><br>extern “C” int Add(int x, int y){ return x + y; } [/code]</p><p><strong>CMakeLists.txt</strong> [code lang=”cmake”] cmake_minimum_required(VERSION 3.0.0) project(CppLib VERSION 0.0.0)<br>include(CTest) enable_testing()<br>add_library(CppLib SHARED CppLib.cpp)<br>set(CPACK_PROJECT_NAME ${PROJECT_NAME}) set(CPACK_PROJECT_VERSION ${PROJECT_VERSION}) include(CPack) [/code]</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>C++側は、Visual Studio Codeで、CMakeを使ってビルドします。 ビルド完了後、buildフォルダ配下に<strong>libCppLib.so</strong>が生成されます。 このファイルをシステムの共有フォルダに移動します。 <strong>FHS (Filesystem Hierarchy Standard)**のルールに従って適切なフォルダにSharedライブラリをコピーします。 今回は、</strong>/usr/local/lib64<strong>にコピーします。 [code lang=”sh”] $ file cp CppLib/build/libCppLib.so CppLib/build/libCppLib.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, BuildID[sha1]=73b7791b3eeb907e40dadcfbac6ec14df4da8eef, not stripped $ nm -D CppLib/build/libCppLib.so 0000000000000760 T Add w _ITM_deregisterTMCloneTable w _ITM_registerTMCloneTable U _ZNSt8ios_base4InitC1Ev U _ZNSt8ios_base4InitD1Ev 0000000000201028 B __bss_start U __cxa_atexit w __cxa_finalize w __gmon_start__ 0000000000201028 D _edata 0000000000201030 B _end 0000000000000764 T _fini 00000000000005f8 T _init $ sudo cp CppLib/build/libCppLib.so /usr/local/lib64 [/code] きちんと、Sharedライブラリがx64形式になっていることと、Add関数が公開されていることを確認し、フォルダにコピーしています。 C#側もビルドしますが、ビルド完了後、</strong>環境変数LD_LIBRARY_PATH<strong>に</strong>/usr/local/lib64**を追加します。 そうしないと、C#のアプリがライブラリを見つけることができません。 [code lang=”sh”] $ cd CsharpApp $ dotnet restore $ dotnet build Microsoft (R) Build Engine version 15.3.409.57025 for .NET Core Copyright (C) Microsoft Corporation. All rights reserved.<br>CsharpApp -&gt; /home/xxxxxx/Work/Demo/DotNetCoreLinux6/CsharpApp/bin/Debug/netcoreapp2.0/CsharpApp.dll<br>Build succeeded. 0 Warning(s) 0 Error(s)<br>Time Elapsed 00:00:10.24 $ export LD_LIBRARY_PATH=/usr/local/lib64:$LD_LIBRARY_PATH $ dotnet run 2 4 2 + 4 = 6 $ dotnet run 12 664 12 + 664 = 676 [/code] 期待通りの結果になりました。 環境変数LD_LIBRARY_PATHへの追加は一時的なものですので、別のシェルを立ち上げたりすると、そのシェルでは認識しないので、再度追加するか永続的に認識するよう別途対応しましょう。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>自作ライブラリを使えるようになりました。 これによりLinuxでやれることが広がりました。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/DotNetCoreLinux6">https://github.com/takuya-takeuchi/Demo/tree/master/DotNetCoreLinux6</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> C/C++ </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> Fedora </category>
          
          <category> net </category>
          
          <category> C# </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その84 Visual Studio CodeのCMakeから関数をExportする</title>
      <link href="/2017/08/19/2607/"/>
      <url>/2017/08/19/2607/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>前回は、Visual Studio CodeからSharedライブラリを作成しました。 </p><p>C#からSharedライブラリを呼び出すには、<strong>P/Invoke</strong>を使うしかありませんが、Sharedライブラリ側で関数をExportする必要があります。 <strong>Visual C++**ならdefファイルでも定義するか、シンプルに</strong>C++/CLI**を使ってクラス経由で使えるようすることも一つの手ですが、Linuxでは後者は使えません。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>前回と同じように、Visual Studio Codeから<strong>CMake</strong>でテンプレートを作成し、Sharedライブラリを生成する状態まで準備します。 この状態で生成された*.soファイルを<strong>nm</strong>コマンドを<strong>-D</strong>オプションをつけて実行することで、ライブラリに含まれるシンボルを表示してみます。 [code lang=”sh”] $ nm -D libTestCMake.so w _ITM_deregisterTMCloneTable w _ITM_registerTMCloneTable 00000000000007ea T _Z9say_hellov U _ZNSt8ios_base4InitC1Ev U _ZNSt8ios_base4InitD1Ev U _ZSt4cout U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc 0000000000201030 B __bss_start U __cxa_atexit w __cxa_finalize w __gmon_start__ 0000000000201030 D _edata 0000000000201038 B _end 0000000000000868 T _fini 00000000000006a8 T _init [/code] 元のソースは [code lang=”cpp”] #include <iostream><br>void say_hello(){ std::cout &lt;&lt; “Hello, from TestCMake!\n”; } [/code] です。 シンボルに**say_hello**という文字が見えます。 ですが、前後に不規則?な英数字が付与されています。 では、関数をExportしてみます。 ソースコードを下記のように修正し、ビルドした後、シンボルを表示してみます。 [code lang=”cpp”] #include <iostream><br>extern “C” void say_hello(){ std::cout &lt;&lt; “Hello, from TestCMake!\n”; } [/code] [code lang=”sh”] $ nm -D libTestCMake.so w _ITM_deregisterTMCloneTable w _ITM_registerTMCloneTable U _ZNSt8ios_base4InitC1Ev U _ZNSt8ios_base4InitD1Ev U _ZSt4cout U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc 0000000000201030 B __bss_start U __cxa_atexit w __cxa_finalize w __gmon_start__ 0000000000201030 D _edata 0000000000201038 B _end 0000000000000868 T _fini 00000000000006a8 T _init 00000000000007ea T say_hello [/code] 今度は、<strong>say_hello</strong>という文字列が完全に表示されています。 無事に公開されているようです。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> C/C++ </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その83 Fedora 26 ServerでCMakeから共有ライブラリを作成する</title>
      <link href="/2017/08/17/2594/"/>
      <url>/2017/08/17/2594/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>前回は、Visual Studio CodeからC++で開発を行う環境の構築を行いました。 </p><p>Visual Studio Codeでの開発情報も増えつつありますが、まだまだLinux上での開発記事は少ないです。 CMakeの知識が少ないと、</p><ul><li>.a <strong>Staticライブラリ</strong></li><li>.so <strong>Sharedライブラリ</strong></li></ul><p>の作成を切り替えることもままなりません。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="Initialize-Project"><a href="#Initialize-Project" class="headerlink" title="Initialize Project"></a>Initialize Project</h2><p><strong>CMake Tools</strong>を使うと、ボイラープレートよろしくプロジェクトのテンプレートを作成することができます。 まず、空のフォルダをVisual Studio Codeで開きます。<br><a href="../../../../public/2017/08/016628ad5797244d7c545a102175954e.png"><img src="../../../../public/2017/08/016628ad5797244d7c545a102175954e-1024x768.png"></a></p><p>次に、コマンドパレットから、<strong>CMake: Quick Start</strong>を選択または入力します。<br><a href="../../../../public/2017/08/6aea62a6c0929d0cf5e100b8fa1864ff.png"><img src="../../../../public/2017/08/6aea62a6c0929d0cf5e100b8fa1864ff-1024x276.png"></a></p><p>次に、プロジェクト名を入力します。<br><a href="../../../../public/2017/08/5ff2fb6ff7d8ddacba285309b543ec5b.png"><img src="../../../../public/2017/08/5ff2fb6ff7d8ddacba285309b543ec5b-1024x276.png"></a></p><p>次に、プロジェクトの種別を選択します。</p><ul><li>Library <strong>Staticライブラリ</strong></li><li>Executable 実行形式モジュール</li></ul><p>の2形式を選択できます。Staticライブラリは後で変更できます。 今回は、<strong>Library</strong>を選択。<br><a href="../../../../public/2017/08/1b65a6a9b2de786640a61678d20f460f.png"><img src="../../../../public/2017/08/1b65a6a9b2de786640a61678d20f460f-1024x276.png"></a></p><p>ビルド構成を選択します。<br><a href="../../../../public/2017/08/304689f7220de3666d6a320a9742f216.png"><img src="../../../../public/2017/08/304689f7220de3666d6a320a9742f216-1024x276.png"></a><br> これでテンプレートが完成します。</p><h2 id="Build-Project"><a href="#Build-Project" class="headerlink" title="Build Project"></a>Build Project</h2><p>この状態で、一度ビルドを行います。 コマンドパレットから、<strong>CMake: Build</strong>を選択または入力します。<br><a href="../../../../public/2017/08/d72e8a8f47d1b26846515e0808eaa206.png"><img src="../../../../public/2017/08/d72e8a8f47d1b26846515e0808eaa206-1024x276.png"></a></p><p>ビルドが成功すると、<strong>build</strong>フォルダの配下に、<strong>lib&lt;プロジェクト名&gt;.a</strong>が生成されます。<br><a href="../../../../public/2017/08/32f0b672b8578bcc6b7d3bc9709f00ea.png"><img src="../../../../public/2017/08/32f0b672b8578bcc6b7d3bc9709f00ea-1024x768.png"></a><br> テンプレートなので、ソースファイルは、**&lt;プロジェクト名&gt;.cpp**という下記の内容のファイルです。 [code lang=”cpp”] #include <iostream><br>void say_hello(){ std::cout &lt;&lt; “Hello, from TestCMake!\n”; } [/code] シンプルですが、これでStaticライブラリが簡単に生成できます。</p><h2 id="Create-Shared-Library-so"><a href="#Create-Shared-Library-so" class="headerlink" title="Create Shared Library (*.so)"></a>Create Shared Library (*.so)</h2><p>続いては、Sharedライブラリを作成する方法です。 <strong>CMakeLists.txt</strong>を開きます。 [code lang=”cmake”] add_library(TestCMake TestCMake.cpp) [/code] を [code lang=”cmake”] add_library(TestCMake SHARED TestCMake.cpp) [/code] に変更し、再度ビルドします。 すると、今度は、<strong>build</strong>フォルダの配下に、<strong>lib&lt;プロジェクト名&gt;.so</strong>が生成されます。<br><a href="../../../../public/2017/08/d0f31abbf02d03448d693fdd1e5c042b.png"><img src="../../../../public/2017/08/d0f31abbf02d03448d693fdd1e5c042b-1024x768.png"></a><br> Sharedライブラリを作れるようになったので、C#からP/Invokeで呼び出すこともできるようになります。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Visual Studio </category>
          
          <category> Fedora </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第6回</title>
      <link href="/2017/08/17/2578/"/>
      <url>/2017/08/17/2578/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、<strong>Visual Studio Code</strong>からデバッグしてみました。 </p><p>今回は、.NET Core 2.0をインストールし、Visual Studio Codeから実行してみます。 公式ページにはコマンドプロンプトから実行していますので、動作確認も含んでいます。 また、今回から、対象が<strong>Red Hat Enterprise Linux</strong>から<strong>Fedora</strong>に変わりました。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><h2 id="Install-NET-Core-2-0-0"><a href="#Install-NET-Core-2-0-0" class="headerlink" title="Install .NET Core 2.0.0"></a>Install .NET Core 2.0.0</h2><p>公式ページを参考にしてインストール。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.microsoft.com/net/core#linuxfedora" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.microsoft.com"></img><div class="hbc-site-name">Microsoft</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://dotnet.microsoft.com/static/images/redesign/social/square.png"></img></div><div class="hbc-text"><div class="hbc-title">Download .NET (Linux, macOS, and Windows)</div><div class="hbc-url">https://www.microsoft.com/net/core#linuxfedora</div><div class="hbc-description">Free downloads for building and running .NET apps on Linux, macOS, and Windows. Runtimes, SDKs, and developer packs for .NET Framework, .NET…</div></div></div></div></a></div></div><p>下記のコマンドを実行するだけです。 インストール先が、**/dotnet**なので、気に入らなければ変更します。 ただ、公式ページの警告</p><blockquote><p>Note, a user-controlled directory must be used when installing from tar.gz on Linux systems.</p></blockquote><p>を考えると、ユーザーが制御できるフォルダにするべき、とあるのでホームが無難でしょう。 [code lang=”sh”] $ sudo dnf install libunwind libicu $ curl -sSL -o dotnet.tar.gz <a href="https://aka.ms/dotnet-sdk-2.0.0-linux-x64">https://aka.ms/dotnet-sdk-2.0.0-linux-x64</a> $ mkdir -p ~/dotnet &amp;&amp; tar zxf dotnet.tar.gz -C ~/dotnet $ export PATH=$PATH:$HOME/dotnet $ rm dotnet.tar.gz [/code] バージョン情報を調べると、きちんと<strong>2.0.0</strong>になっています。 [code lang=”sh”] $ dotnet –version 2.0.0 [/code]</p><h2 id="Test-NET-Core-2-0-0"><a href="#Test-NET-Core-2-0-0" class="headerlink" title="Test .NET Core 2.0.0"></a>Test .NET Core 2.0.0</h2><p>こちらも公式ページを参考に、CUIでテストします。 カレントに<strong>hwapp</strong>フォルダを作成し、そこで初期化処理を行い、実行します。 **Hello World!**と表示されれば成功です。 [code lang=”sh”] $ dotnet new console -o hwapp $ cd hwapp $ dotnet run Hello World! [/code]</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>ここからはVisual Studio Codeを使います。 Visual Studio Codeから先ほどのhwappフォルダを開きます。 この時、 <strong>The .NET CLI tools cannnot be located. .NET Core debugging will not be enabled. Make sure .NET CLI tools are installed and are on the path.</strong> という警告が表示されるかもしれません。 これは、普通に.NET Core SDKのことを指しています。先ほどインストールしたものがそうですので、Visual Studio Codeから認識できていません。 この状態だと、ビルドしても、<br><a href="../../../../public/2017/08/bb826afe55947d4405577c90b4deeeb6.png"><img src="../../../../public/2017/08/bb826afe55947d4405577c90b4deeeb6-1024x768.png"></a> というようにエラーになります。 なので、<strong>export PATH=$PATH:$HOME/dotnet</strong>を実行した端末(ターミナル)<br>からcodeを実行するか、 [code lang=”sh”] $ vi ~/.bash_profile [/code] で、末尾に、 [code lang=”sh”] export PATH=$PATH:$HOME/dotnet [/code] を追加してから、codeを立ち上げるかのどちらかです。 再度立ち上げ直して、ビルド、デバッグ実行を行うと、<strong>launch.json</strong>や<strong>tasks.json</strong>の作成を要求されますので、指示に従います。 作成後、<strong>launch.json</strong>を開いて、</p><ul><li><insert-target-framework-here> *<strong>.csproj</strong>の<strong>TargetFramework</strong>要素で置換。今回は、<strong>netcoreapp2.0</strong>です。</li><li><insert-project-name-here> *<strong>.csproj</strong>のファイル名部分です。今回は、<strong>hwapp</strong>です。</li></ul><p>というように修正を行います。 その後、デバッグができるようになっているはずです。<br><a href="../../../../public/2017/08/e1df33be33b71d0b77f8ae14f8763e51.png"><img src="../../../../public/2017/08/e1df33be33b71d0b77f8ae14f8763e51-1024x768.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>2.0.0に変更されても、大きな違いはないです。しいて言うなら、プロジェクトファイルの仕様が、*.csprojに完全に戻ったことですかな。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> Fedora </category>
          
          <category> net </category>
          
          <category> Visual Studio Code </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その82 Fedora 26 ServerでVisual Studio CodeでのC++開発環境を準備する</title>
      <link href="/2017/08/17/2567/"/>
      <url>/2017/08/17/2567/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>もう<strong>Redhat Enterprise Linux</strong>には見切りを付けました。 <strong>GLibc</strong>が古かったり、リポジトリが古かったり、さんざんな目に遭いました。 今後は、Fedoraをメインにしていきたいです。 そこで、開発環境を再度整えることになったので、メモしておきます。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h2><p><strong>RHEL</strong>とは異なり、CMakeは最初から<strong>ServerMode</strong>でビルドされていました。 またきちんと最新版が用意されています。 [code lang=”sh”] sudo dnf -y install CMake [/code]</p><h2 id="GCC-C"><a href="#GCC-C" class="headerlink" title="GCC C++"></a>GCC C++</h2><p>C++の開発をするのに必須のコンパイラー。 これも最新版が用意されています。 [code lang=”sh”] sudo dnf -y install gcc-c++ [/code]</p><h2 id="Visual-Studio-Code"><a href="#Visual-Studio-Code" class="headerlink" title="Visual Studio Code"></a>Visual Studio Code</h2><p>Fedoraへのインストールは公式に書いてあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://code.visualstudio.com/docs/setup/linux" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=code.visualstudio.com"></img><div class="hbc-site-name">code.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://code.visualstudio.com/opengraphimg/opengraph-docs.png"></img></div><div class="hbc-text"><div class="hbc-title">Running Visual Studio Code on Linux</div><div class="hbc-url">https://code.visualstudio.com/docs/setup/linux</div><div class="hbc-description">Get Visual Studio Code up and running on Linux.</div></div></div></div></a></div></div><p>[code lang=”sh”] sudo rpm –import <a href="https://packages.microsoft.com/keys/microsoft.asc">https://packages.microsoft.com/keys/microsoft.asc</a> sudo sh -c ‘echo -e “[code]\nname=Visual Studio Code\nbaseurl=<a href="https://packages.microsoft.com/yumrepos/vscode//nenabled=1//ngpgcheck=1//ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot;">https://packages.microsoft.com/yumrepos/vscode\\nenabled=1\\ngpgcheck=1\\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot;</a> &gt; /etc/yum.repos.d/vscode.repo’ sudo dnf check-update sudo dnf install code [/code] 次に拡張を追加します。 インストールする拡張は、</p><h3 id="C-C"><a href="#C-C" class="headerlink" title="C/C++"></a>C/C++</h3><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ms-vscode.gallerycdn.vsassets.io/extensions/ms-vscode/cpptools/1.1.1/1604970226321/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">C/C++ - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools</div><div class="hbc-description">Extension for Visual Studio Code - C/C++ IntelliSense, debugging, and code browsing.</div></div></div></div></a></div></div><h3 id="C"><a href="#C" class="headerlink" title="C#"></a>C#</h3><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ms-dotnettools.gallerycdn.vsassets.io/extensions/ms-dotnettools/csharp/1.23.6/1605311230265/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">C# - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp</div><div class="hbc-description">Extension for Visual Studio Code - C# for Visual Studio Code (powered by OmniSharp).</div></div></div></div></a></div></div><h3 id="CMake-1"><a href="#CMake-1" class="headerlink" title="CMake"></a>CMake</h3><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=twxs.cmake" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://twxs.gallerycdn.vsassets.io/extensions/twxs/cmake/0.0.17/1488841920286/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">CMake - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=twxs.cmake</div><div class="hbc-description">Extension for Visual Studio Code - CMake langage support for Visual Studio Code</div></div></div></div></a></div></div><h3 id="CMake-Tools"><a href="#CMake-Tools" class="headerlink" title="CMake Tools"></a>CMake Tools</h3><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=vector-of-bool.cmake-tools" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ms-vscode.gallerycdn.vsassets.io/extensions/ms-vscode/cmake-tools/1.5.2/1604978749609/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">CMake Tools - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=vector-of-bool.cmake-tools</div><div class="hbc-description">Extension for Visual Studio Code - Extended CMake support in Visual Studio Code</div></div></div></div></a></div></div><h3 id="vscode-icons"><a href="#vscode-icons" class="headerlink" title="vscode-icons"></a>vscode-icons</h3><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://vscode-icons-team.gallerycdn.vsassets.io/extensions/vscode-icons-team/vscode-icons/11.0.0/1600368328068/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">vscode-icons - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons</div><div class="hbc-description">Extension for Visual Studio Code - Icons for Visual Studio Code</div></div></div></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その81 Fedora 26 ServerにVNC Serverをインストールする</title>
      <link href="/2017/08/17/2556/"/>
      <url>/2017/08/17/2556/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Fedora 26 Server</strong>で<strong>GNOME</strong>をインストールした後です。 ちなみに、GNOMEのインストールは、 [code lang=”sh”] $ su - # SELINUX=enforcing を SELINUX=disabled に変更 $ vi /etc/sysconfig/selinux $ reboot $ sestatus SELinux status: disabled # GNOMEのインストール $ sudo dnf -y group install “Fedora Workstation” $ echo “exec /usr/bin/gnome-session” &gt;&gt; ~/.xinitrc $ sudo systemctl set-default graphical.target Removed /etc/systemd/system/default.target. Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/graphical.target. $ systemctl get-default graphical.target $ systemctl -f enable gdm.service Created symlink /etc/systemd/system/display-manager.service → /usr/lib/systemd/system/gdm.service. $ systemctl restart gdm.service [/code] 途中でさらっと流していますが、<strong>SELinux</strong>の無効化が大事です。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>[code lang=”sh”] $ sudo dnf install tigervnc-server $ sudo firewall-cmd –add-service=vnc-server –permanent success $ sudo firewall-cmd –reload success [/code]</p><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><p>一度、起動してみて、繋がるかどうかを確認します。 [code lang=”sh”] # 初回起動時にパスワードの設定と各種設定の自動実行 $ vncserver<br>You will require a password to access your desktops.<br>Password: Verify: Would you like to enter a view-only password (y/n)? n<br>New ‘XXXXXX-YYYYYY:1 (xxxxxx)’ desktop is XXXXXX-YYYYYY:1<br>Creating default startup script /home/xxxxxx/.vnc/xstartup Creating default config /home/xxxxxx/.vnc/config Starting applications specified in /home/xxxxxx/.vnc/xstartup Log file is /home/xxxxxx/.vnc/XXXXXX-YYYYYY:1.log<br># 起動 $ vncserver [/code]</p><h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><p>自動起動の設定を行います。 まず設定ファイルを作成。 [code lang=”sh”] $ sudo cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service $ sudo vi /etc/systemd/system/vncserver@:1.service [/code] ファイル中の、という文字列をユーザー名で置換します。 [code lang=”sh”] $ sudo systemctl daemon-reload $ sudo systemctl enable vncserver@:1.service $ sudo systemctl start vncserver@:1.service [/code] この時、すぐに応答が帰ってこず、エラーが表示された場合、 [code lang=”sh”] $ sudo systemctl status vncserver@\:1.service ● vncserver@:1.service - Remote desktop service (VNC) Loaded: loaded (/etc/systemd/system/vncserver@:1.service; enabled; vendor preset: disabled) Active: failed (Result: timeout) since Thu 2017-08-17 09:20:55 JST; 1min 25s ago Process: 3039 ExecStart=/usr/bin/vncserver :1 (code=exited, status=0/SUCCESS) Process: 3034 ExecStartPre=/usr/bin/vncserver -kill :1 (code=exited, status=0/SUCCESS)<br>8月 17 09:20:52 XXXXXX-YYYYYY tracker-miner-fs.desktop[3373]: Received signal:15-&gt;’Terminated’ 8月 17 09:20:52 XXXXXX-YYYYYY tracker-extract.desktop[3371]: Received signal:15-&gt;’Terminated’ 8月 17 09:20:52 XXXXXX-YYYYYY tracker-miner-user-guides.desktop[3374]: Received signal:15-&gt;’Termina 8月 17 09:20:52 XXXXXX-YYYYYY tracker-miner-user-guides.desktop[3374]: OK 8月 17 09:20:52 XXXXXX-YYYYYY tracker-miner-apps.desktop[3372]: Received signal:15-&gt;’Terminated’ 8月 17 09:20:52 XXXXXX-YYYYYY tracker-miner-apps.desktop[3372]: OK 8月 17 09:20:52 XXXXXX-YYYYYY tracker-miner-fs.desktop[3373]: OK 8月 17 09:20:55 XXXXXX-YYYYYY systemd[1]: Failed to start Remote desktop service (VNC). 8月 17 09:20:55 XXXXXX-YYYYYY systemd[1]: vncserver@:1.service: Unit entered failed state. 8月 17 09:20:55 XXXXXX-YYYYYY systemd[1]: vncserver@:1.service: Failed with result ‘timeout’. [/code] 起動がタイムアウトしている場合があります。 どうもSELinuxが悪さをしている感じがしました。OS再インストール後、SELinuxを無効化してから実行したら、この現象は発生しませんでした。 ただ、OS起動時のVNC自動起動で接続してもカーソルが表示されない状態になってしまって使い物になりません。 OS起動後、手動で<strong>vncserver</strong>で起動した場合は、正しく接続できましたので、しばらくはこれで対応します。 ですので、 [code lang=”sh”] $ sudo systemctl disable vncserver@:1.service [/code] で、自動起動を無効にしました。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> VNC </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その80 Cent7/RHEL7でVisual Studio CodeでC++の開発をお勧めしない</title>
      <link href="/2017/08/17/2558/"/>
      <url>/2017/08/17/2558/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Visual Studio Code</strong>は素晴らしい開発環境です。 Windows/Mac/Linuxで動作するマルチプラットフォーム対応が売りですが、Linuxはディストリビューションが多すぎて、コアの部分の挙動が異なります。 原因として、システムに使われているモジュールの依存関係が牙をむきます。 自分は、Visual Studio Codeの言語拡張機能である、**C/C++**を使っていました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ms-vscode.gallerycdn.vsassets.io/extensions/ms-vscode/cpptools/1.1.1/1604970226321/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">C/C++ - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools</div><div class="hbc-description">Extension for Visual Studio Code - C/C++ IntelliSense, debugging, and code browsing.</div></div></div></div></a></div></div><p>Microsoft謹製のツールで信頼がおける、と思っていました。 しかし、<strong>Redhat Enterprise Linux 7</strong>では、この拡張は動きませんでした。 拡張機能である、CMake Tools経由でビルドしてみました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=vector-of-bool.cmake-tools" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ms-vscode.gallerycdn.vsassets.io/extensions/ms-vscode/cmake-tools/1.5.2/1604978749609/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">CMake Tools - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=vector-of-bool.cmake-tools</div><div class="hbc-description">Extension for Visual Studio Code - Extended CMake support in Visual Studio Code</div></div></div></div></a></div></div><p><a href="../../../../public/2017/08/1afca26085ef41a6a0aa2d04845c3469.png"><img src="../../../../public/2017/08/1afca26085ef41a6a0aa2d04845c3469-1024x719.png"></a><br> <strong>CMakeTools extension was unable to initialize: [cmake-server] Failed to activate protocol version: “generator” is unset but required.</strong> というエラーを吐いて、ビルドが停止します。</p><h1 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h1><p>一見、<strong>CMakeTools</strong>が悪いように思えます。 未確認ですが、CMakeToolsはServerModeで動作しているCMakeを経由して言語拡張にビルドを要求している? ともかくとして、調べてみると、どうも<strong>GLibc</strong>のバージョンに問題があるようです。 CentOS7、RHEL7のGLibcは<strong>2.17</strong>がデフォルトでインストールされています。 [code lang=”sh”] $ yum list installed | grep glibc Repo rhel-server-rhscl-7-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/4481450522517738742-key.pem Repo rhel-7-server-dotnet-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/4481450522517738742-key.pem Repo rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/4481450522517738742-key.pem Repo rhel-7-server-rt-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/4481450522517738742-key.pem glibc.i686 2.17-196.el7 @rhel-7-server-rpms glibc.x86_64 2.17-196.el7 @rhel-7-server-rpms glibc-common.x86_64 2.17-196.el7 @rhel-7-server-rpms glibc-devel.i686 2.17-196.el7 @rhel-7-server-rpms glibc-devel.x86_64 2.17-196.el7 @rhel-7-server-rpms glibc-headers.x86_64 2.17-196.el7 @rhel-7-server-rpms [/code] ところが、C/C++言語拡張は<strong>2.18</strong>を要求します。 [code lang=”sh”] $ ldd /home/xxxxxx/.vscode/extensions/ms-vscode.cpptools-0.12.2/bin/Microsoft.VSCode.CPP.Extension.linux /home/xxxxxx/.vscode/extensions/ms-vscode.cpptools-0.12.2/bin/Microsoft.VSCode.CPP.Extension.linux: /lib64/libc.so.6: version `GLIBC_2.18’ not found (required by /home/xxxxxx/.vscode/extensions/ms-vscode.cpptools-0.12.2/bin/Microsoft.VSCode.CPP.Extension.linux) linux-vdso.so.1 =&gt; (0x00007ffe613a7000) libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fb11b780000) libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fb11b564000) libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fb11b1a0000) libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fb11af9c000) librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fb11ad94000) libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fb11ab7d000) /lib64/ld-linux-x86-64.so.2 (0x00007fb11ba98000) [/code] この問題は、Issueとして報告されています。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/Microsoft/vscode-cpptools/issues/293" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/6154722?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">&quot;Connection to server is erroring&quot; on RHEL7.2 · Issue #293 · microsoft/vscode-cpptools</div><div class="hbc-url">https://github.com/Microsoft/vscode-cpptools/issues/293</div><div class="hbc-description">VSCode 1.6.1, Extension 0.9.2 I&amp;#39;m seeing error below when trying to use the extension on RHEL7.2: [4:18:22 PM] Connection to server is e…</div></div></div></div></a></div></div> <div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/Microsoft/vscode-cpptools/issues/19" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/6154722?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">GLIBC 2.18 dependency · Issue #19 · microsoft/vscode-cpptools</div><div class="hbc-url">https://github.com/Microsoft/vscode-cpptools/issues/19</div><div class="hbc-description">This was copied from the reviews on the extension page. Not sure if it is a language service issue, or a debugger issue.</div></div></div></div></a></div></div><p>解決に向けて取り組んでいるようですが、<a href="https://github.com/Microsoft/vscode-cpptools/issues/19">#19</a>は2016年4月に報告されており、それからコメントが増え続けていますが、解決されていません。 Linuxのようにディストリビューションごとにコアのモジュールに大きく差が出てくると、かつてWindowsが陥った<a href="https://ja.wikipedia.org/wiki/DLL%E5%9C%B0%E7%8D%84">DLL地獄</a>のような問題は避けられないようですね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その79 Fedora 26でSSHを有効にする</title>
      <link href="/2017/08/16/2554/"/>
      <url>/2017/08/16/2554/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>OSインストール直後、SSHは組み込まれていますが、デーモンとして起動していません。 インストールが終わり、ネットワークに接続できたら、何を差し置いても、まずはSSHを有効にしないと始まりません。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="デーモンの起動"><a href="#デーモンの起動" class="headerlink" title="デーモンの起動"></a>デーモンの起動</h2><p>[code lang=”sh”] $ sudo systemctl start sshd.service [/code]</p><h2 id="OS起動時にデーモンも起動"><a href="#OS起動時にデーモンも起動" class="headerlink" title="OS起動時にデーモンも起動"></a>OS起動時にデーモンも起動</h2><p>[code lang=”sh”] $ sudo systemctl enable sshd.service [/code]</p><p>特に停止することはないので、停止、スタートアップ起動の無効化は不要ですね。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Fedora </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その78 Intel NUC DN2820FYKHにFedora 26をインストールする</title>
      <link href="/2017/08/16/2551/"/>
      <url>/2017/08/16/2551/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>以前、Intel NUCにFedora 24をインストールして失敗しました。 </p><p>最新のFedora 26をインストールしてみたところ普通に成功しました。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>特に手順は変わりません。</p><ol><li><a href="http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/">Universal USB Installer</a>でブータブルUSBを作成</li><li>USBから起動</li><li>Install to Hard Driveを選択してHDDにインストール</li></ol><p>という普通の手順です。 Fedora 24と異なり、何の問題もありませんでした。 <strong>BIOS</strong>のバージョンは0056でした。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Intel </category>
          
          <category> Fedora </category>
          
          <category> intel </category>
          
          <category> NUC </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その77 Red Hat Enterprise Linux 7.3でBlueZをビルドしてみる</title>
      <link href="/2017/08/10/2540/"/>
      <url>/2017/08/10/2540/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>前回はBluetoothを使ってみました。 </p><p>ただ、これはCUIで操作していたので、使い勝手が悪いです。 せっかくなので、プログラムから使えるようにしてみたいです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>単純に、<strong>bluez</strong>をyumからインストールしても、ライブラリやヘッダーがインストールされないようなので、自分でビルドする必要があるようです。 [code lang=”sh”] $ wget <a href="https://www.kernel.org/pub/linux/bluetooth/bluez-5.44.tar.gz">https://www.kernel.org/pub/linux/bluetooth/bluez-5.44.tar.gz</a> $ tar xfz bluez-5.44.tar.gz $ rm bluez-5.44.tar.gz $ cd bluez-5.44 $ ./configure –disable-systemd –enable-library checking for GLIB… no configure: error: GLib &gt;= 2.28 is required [/code] というエラーがでるのでシステムにインストールされているglibを調べてみました。 [code lang=”sh”] $ yum info glib 利用可能なパッケージ 名前 : glib アーキテクチャー : x86_64 エポック : 1 バージョン : 1.2.10 リリース : 41.el7 容量 : 137 k リポジトリー : epel/x86_64 要約 : A library of handy utility functions URL : <a href="http://www.gtk.org/">http://www.gtk.org/</a> ライセンス : LGPLv2+ 説明 : GLib is a handy library of utility functions. This C library is : designed to solve some portability problems and provide other useful : functionality that most programs require. [/code] 相当古い。 しかし、ここでyum install glibしても、どうもリポジトリに含まれているglibが古いようで無意味でした。 が、実は落とし穴で、正しくは [code lang=”sh”] $ sudo yum install glib2-devel [/code] になります。 再度試してみます。 [code lang=”sh”] $ ./configure –disable-systemd –enable-library checking for DBUS… no configure: error: D-Bus &gt;= 1.6 is required [/code] 次はD-Busです。これも単純に、yum install dbusではだめで、 [code lang=”sh”] $ sudo yum install dbus-devel [/code] になります。 次は、 [code lang=”sh”] $ ./configure –disable-systemd –enable-library checking for UDEV… no configure: error: libudev &gt;= 172 is required [/code] とでますので、 [code lang=”sh”] $ sudo yum install libudev-devel [/code] になります。 次は、 [code lang=”sh”] $ ./configure –disable-systemd –enable-library checking for ICAL… no configure: error: libical is required [/code] とでますので、 [code lang=”sh”] $ sudo yum install libical-devel [/code] になります。 次は、 [code lang=”sh”] $ ./configure –disable-systemd –enable-library checking readline/readline.h usability… no checking readline/readline.h presence… no checking for readline/readline.h… no configure: error: readline header files are required [/code] とでますので、 [code lang=”sh”] $ sudo yum install readline-devel [/code] になります。 最終的にこれで依存関係が解決するはずで、 [code lang=”sh”] $ ./configure –disable-systemd –enable-library $ make $ sudo make install [/code] が成功するはずです。 インストール後、 [code lang=”sh”] $ ls -la /usr/local/include/bluetooth/ 合計 164 drwxr-xr-x. 2 root root 4096 8月 10 23:44 . drwxr-xr-x. 5 root root 56 8月 10 23:44 .. -rw-r–r–. 1 root root 9415 8月 10 23:44 bluetooth.h -rw-r–r–. 1 root root 3938 8月 10 23:44 bnep.h -rw-r–r–. 1 root root 1600 8月 10 23:44 cmtp.h -rw-r–r–. 1 root root 63804 8月 10 23:44 hci.h -rw-r–r–. 1 root root 10494 8月 10 23:44 hci_lib.h -rw-r–r–. 1 root root 2087 8月 10 23:44 hidp.h -rw-r–r–. 1 root root 6648 8月 10 23:44 l2cap.h -rw-r–r–. 1 root root 2309 8月 10 23:44 rfcomm.h -rw-r–r–. 1 root root 1541 8月 10 23:44 sco.h -rw-r–r–. 1 root root 18197 8月 10 23:44 sdp.h -rw-r–r–. 1 root root 21725 8月 10 23:44 sdp_lib.h $ ls -la /usr/local/lib/libbluetooth* -rwxr-xr-x. 1 root root 961 8月 10 23:44 /usr/local/lib/libbluetooth.la lrwxrwxrwx. 1 root root 23 8月 10 23:44 /usr/local/lib/libbluetooth.so -&gt; libbluetooth.so.3.18.15 lrwxrwxrwx. 1 root root 23 8月 10 23:44 /usr/local/lib/libbluetooth.so.3 -&gt; libbluetooth.so.3.18.15 -rwxr-xr-x. 1 root root 397416 8月 10 23:44 /usr/local/lib/libbluetooth.so.3.18.15 [/code] ライブラリやヘッダーファイルがインストールされていることが確認できます。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> 無線通信 </category>
          
          <category> Bluetooth </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる JetBrains Rider編 第0.5回</title>
      <link href="/2017/08/10/2530/"/>
      <url>/2017/08/10/2530/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Jetbrains Rider</strong>をインストールしました。 </p><p>ですが、しばらく使っていないうちに、正式版がリリースされたので、そのインストールをちょっとだけ。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>まずは、ダウンロード。 2017/08の時点で2017.1が最新です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.jetbrains.com/rider/download/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.jetbrains.com"></img><div class="hbc-site-name">JetBrains</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"></img></div><div class="hbc-text"><div class="hbc-title">Download Rider: The Cross-Platform .NET IDE</div><div class="hbc-url">https://www.jetbrains.com/rider/download/</div><div class="hbc-description">Download the latest version of Rider for Windows, macOS or Linux.</div></div></div></div></a></div></div><p>ダウンロードしたら、端末を開きます。 おそらく、ダウンロードフォルダにダウンロードしたファイルがあるので、ダウンロードフォルダに移動します。 このあたりは前回と同じです。 [code lang=”sh”] $ sudo mv JetBrains.Rider-2017.1.tar.gz /opt $ cd /opt $ sudo tar xfz JetBrains.Rider-2017.1.tar.gz $ sudo rm xfz JetBrains.Rider-2017.1.tar.gz $ ls -la drwxr-xr-x. 7 root root 110 8月 10 18:47 Rider-2017.1 $ cd Rider-2017.1/bin $ sudo ./rider.sh Startup Error: Unable to detect graphics environment [/code] ダイアログが立ち上がり、設定を引き継ぐかどうかを尋ねられます。<br><a href="../../../../public/2017/05/2a25c929f6bb4f046272c29e5872a6d1.png"><img src="../../../../public/2017/05/2a25c929f6bb4f046272c29e5872a6d1.png"></a> 次にライセンス認証を要求されます。 ライセンスを持っていないならトライアルが可能です。 <a href="../../../../public/2017/08/36755281596f38b0e5ba79de8aca1a03.png"><img src="../../../../public/2017/08/36755281596f38b0e5ba79de8aca1a03.png"></a></p><p>スプラッシュスクリーンです。<br><a href="../../../../public/2017/08/a9b054b4a026a1dbe70af186e6e7d469.png"><img src="../../../../public/2017/08/a9b054b4a026a1dbe70af186e6e7d469.png"></a></p><p>メイン画面です。<br><a href="../../../../public/2017/08/73fd8e8c0dc2c0fefe38f6174fa126f6.png"><img src="../../../../public/2017/08/73fd8e8c0dc2c0fefe38f6174fa126f6.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回はバージョンアップのみ。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> JetBrains </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
          <category> jetbrains </category>
          
          <category> Rider </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる JetBrains Rider編 第0回</title>
      <link href="/2017/08/10/2317/"/>
      <url>/2017/08/10/2317/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>.NET Core</strong>をDocker経由で動かしたりしました。 </p><p>ですが、WindowsまたはLinuxの端末上でエディットしてコンパイルするのは面倒だしつまらない。 なので、LinuxのGUI上で開発すればいいじゃん、ということで</p><ul><li><strong>Visual Studio Code</strong></li><li><strong>JetBrains Rider</strong></li></ul><p>の2つに白羽の矢が立ちました。<strong>Eclipse</strong>?知らないなぁ…. 自分はJetBrains Toolboxをサブスクライブしているので、今後EAPがとれて正式リリースされても継続利用できます。 なにより、<strong>Resharper</strong>、<strong>Clion</strong>を使ってきて満足しているので、Riderもきっと素晴らしい、と信じています。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>まずは、ダウンロード。 2017/05/14の時点でEAP Build21が最新です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.jetbrains.com/rider/download/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.jetbrains.com"></img><div class="hbc-site-name">JetBrains</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"></img></div><div class="hbc-text"><div class="hbc-title">Download Rider: The Cross-Platform .NET IDE</div><div class="hbc-url">https://www.jetbrains.com/rider/download/</div><div class="hbc-description">Download the latest version of Rider for Windows, macOS or Linux.</div></div></div></div></a></div></div><p>ダウンロードしたら、端末を開きます。 おそらく、ダウンロードフォルダにダウンロードしたファイルがあるので、ダウンロードフォルダに移動します。 [code lang=”sh”] $ cd ~/ダウンロード $ ls -la drwxr-xr-x. 2 hogehoge hogehoge 40 5月 14 12:51 . drwx——. 21 hogehoge hogehoge 4096 5月 14 12:32 .. -rw-rw-r–. 1 hogehoge hogehoge 376135045 5月 14 12:51 riderRS-171.4089.466.tar.gz [/code] インストール先は、Riderのマニュアルがあればそれに従うのですが存在しないので、<strong>IntellJ IDEA</strong>のマニュアルに従い、**/opt<strong>にインストールします。 <a href="https://www.jetbrains.com/help/idea/2017.1/installing-and-launching.html#d923076e245">Starting IntelliJ IDEA on Linux</a> [code lang=”sh”] $ sudo mv riderRS-171.4089.466.tar.gz /opt $ cd /opt $ sudo tar xfz riderRS-171.4089.466.tar.gz $ sudo rm xfz riderRS-171.4089.466.tar.gz $ ls -la drwxr-xr-x. 7 root root 4096 5月 14 13:11 Rider-171.4089.466 [/code] **/opt/Rider-171.4089.466</strong>に展開されました。 中を見てみますと、<strong>Install-Linux-tar.txt</strong>があるので、確認します。</p><blockquote><p>Rider INSTALLATION INSTRUCTIONS =============================================================================== Linux Installation Instructions —————————————————————————— 1. Unpack the Rider distribution archive that you downloaded to where you wish to install the program. We will refer to this destination location as your {installation home} below. 2. Open a console and cd into “{installation home}/bin” and type: ./rider.sh to start the application. As a side effect, this will initialize various configuration files in the <del>/.Rider10 directory. 3. [OPTIONAL] Add “{installation home}/bin” to your PATH environment variable so that you may start Rider from any directory. 4. [OPTIONAL] To adjust the value of the JVM heap size, create ~/.Rider10/rider.vmoptions (or rider64.vmoptions if using a 64-bit JDK), and set the -Xms and -Xmx parameters. To see how to do this, you can reference the vmoptions file under “{installation home}/bin” as a model. [OPTIONAL] Changing the location of “config” and “system” directories —————————————————————————— By default, Rider stores all your settings under the ~/.Rider10/config directory and uses ~/.Rider10/system as a data cache. If you want to change these settings, 1. Open a console and cd into ~/.Rider10/ 2. Create the file “idea.properties” and open it in an editor. Set the idea.system.path and/or idea.config.path variables as desired, for example: idea.system.path=</del>/custom/system idea.config.path=~/custom/config 3. Note that we recommend to store data cache (“system” directory) on a disk with at least 1GB of free space. Enjoy! -Rider Development Team</p></blockquote><p><strong>/bin/.rider.sh</strong>を実行するという指示があるので実行します。 [code lang=”sh”] $ cd Rider-171.4089.466/bin $ sudo ./rider.sh [YourKit Java Profiler 2016.02-b43] Log file: /root/.yjp/log/Rider10-9605.log<br>Startup Error: Unable to detect graphics environment [/code] どうも、SSH経由ではダメな模様。 GUIに移動し端末を起動し再度トライ。 ダイアログが立ち上がり、設定を引き継ぐかどうかを尋ねられます。 初めてインストールしたので、<strong>Do not import setting</strong>を選択し、OKを押下します。<br><a href="../../../../public/2017/05/2a25c929f6bb4f046272c29e5872a6d1.png"><img src="../../../../public/2017/05/2a25c929f6bb4f046272c29e5872a6d1.png"></a></p><p>次にJetBRains Privacy Policyへの同意を求められますので、<strong>Accept</strong>を押下します。<br><a href="../../../../public/2017/05/7b6fca4120f7feb9115ce94495c00b0f.png"><img src="../../../../public/2017/05/7b6fca4120f7feb9115ce94495c00b0f.png"></a></p><p>Themaを選択します。これはお好みを選択し、<strong>Next: Editor Color Schemes</strong>を押下します。<br><a href="../../../../public/2017/05/a3828491ebad1d6a58699c125e5785d4.png"><img src="../../../../public/2017/05/a3828491ebad1d6a58699c125e5785d4.png"></a></p><p>エディターの色定義を選択します。これもお好みを選択し、<strong>Next: Keymaps</strong>を押下します。<br><a href="../../../../public/2017/05/387f7d19d0cd9740b77158d370bf64d7.png"><img src="../../../../public/2017/05/387f7d19d0cd9740b77158d370bf64d7.png"></a></p><p>キーの割り当てを選択します。これもお好みを選択し、<strong>Next: Desktop Entry</strong>を押下します。<br><a href="../../../../public/2017/05/b6c45b005abf1f97a09511360f14ff0a.png"><img src="../../../../public/2017/05/b6c45b005abf1f97a09511360f14ff0a.png"></a></p><p>ショートカットをデスクトップに作成するかどうかです。なぜかIntelliJ IDEAのアイコンです。これもお好みを選択し、<strong>Next: Default plugins</strong>を押下します。<br><a href="../../../../public/2017/05/ec2aebb0468c9dbdf25b216825499d2f.png"><img src="../../../../public/2017/05/ec2aebb0468c9dbdf25b216825499d2f.png"></a></p><p>プラグインを選択します。ここでは、<strong>Web Development</strong>、<strong>Version Controls</strong>、<strong>Database Tools</strong>、<strong>Other Tools</strong>を選択できます。 全部欲しければそのままで良いです。<strong>Next: Featured plugins</strong>を押下します。<br><a href="../../../../public/2017/05/88c96622801e3cd227b10334a2679d41.png"><img src="../../../../public/2017/05/88c96622801e3cd227b10334a2679d41.png"></a></p><p>Featutedプラグインを選択します。ここでは、<strong>IdeaVim</strong>、<strong>Resharper Unity</strong>、<strong>Help AllocationsViewer</strong>、<strong>Python Community Edition</strong>を選択できます。 必要に応じて選択します。自分はResharper Unityだけ追加しました。終わったら、<strong>Next: Rider EAP</strong>を押下します。<br><a href="../../../../public/2017/05/5fea8e6a2fa758ae69dc2a500025f275.png"><img src="../../../../public/2017/05/5fea8e6a2fa758ae69dc2a500025f275.png"></a></p><p>スタートアップガイドやバグトラッカーの案内です。 これで完了です。 <strong>Start using Rider</strong>を押下して終了します。<br><a href="../../../../public/2017/05/272aed6ad854ecb9b13344879ade00db.png"><img src="../../../../public/2017/05/272aed6ad854ecb9b13344879ade00db.png"></a></p><p>スプラッシュスクリーンです。<br><a href="../../../../public/2017/05/7c5ff0226a9450756f6afb81da039fed.png"><img src="../../../../public/2017/05/7c5ff0226a9450756f6afb81da039fed.png"></a></p><p>メイン画面です。ここはClion等と同一ですね・<br><a href="../../../../public/2017/05/1ae6125e5727fd0eaf480cb104e1bcb1.png"><img src="../../../../public/2017/05/1ae6125e5727fd0eaf480cb104e1bcb1.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回は導入のみ。 次回は、プロジェクトを作ってサンプルを実行してみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> JetBrains </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
          <category> jetbrains </category>
          
          <category> Rider </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その76 DockerからBluetoothを使ってみる</title>
      <link href="/2017/07/31/2525/"/>
      <url>/2017/07/31/2525/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Bluetoothを内蔵するホストマシンで、<strong>Docker</strong>上に構築したUbuntuから<strong>hciconfig up</strong>したら、 [code lang=”sh”] $ hciconfig up Can’t open HCI socket.: Address family not supported by protocol [/code] ってなってしまった。 そんな時の解決法。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>解決策はこちら。 </p><p><strong>--net host</strong>を付けて、<strong>docker run</strong>しろとのことです。 専ら、<strong>Portainer</strong>でGUIから使う私の場合は、コマンドなんて打ちません。 Portainerの場合はコンテナ作成時に、下記のように<strong>host</strong>を選択するだけです。<br><a href="../../../../public/2017/07/e05a64c2cb84a3283c4d7eaa6c171252.png"><img src="../../../../public/2017/07/e05a64c2cb84a3283c4d7eaa6c171252-1024x246.png"></a><br> 途中から変更できないので、必要に応じてコンテナからイメージを作成し、コンテナを作り直すのが吉です。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> 無線通信 </category>
          
          <category> Portainer </category>
          
          <category> Bluetooth </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その75 Red Hat Enterprise Linux 7.3でPython 3をDockerで使ってみる</title>
      <link href="/2017/07/30/2521/"/>
      <url>/2017/07/30/2521/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>前回はRHELでPython3を使えるようにしましたが、何か微妙になりました。 </p><p>なので、<strong>Docker</strong>にPython3を使える環境を用意することにしました。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>既に先人の方が、Dockerファイルを用意してくださっています。 しかも、pip付きで。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://qiita.com/kekedadamama/items/154753aa8974774a8b2b" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DDocker%25E3%2581%25AEubuntu%25E3%2581%25AB%25E3%2582%2588%25E3%2582%258Bpython3.6%25E3%2581%25AE%25E3%2581%259F%25E3%2582%2581%25E3%2581%25AEDockerfile%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3D7a01a2ee5afb21c89a674a55d06482bf&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540kekedadamama%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3Db029b148801ccb2d0fc23df840dc9e14&blend-align=center%2Cmiddle&blend-mode=normal&s=4355ad5a8dae0293b0ced4124e23c64b"></img></div><div class="hbc-text"><div class="hbc-title">Dockerのubuntuによるpython3.6のためのDockerfile - Qiita</div><div class="hbc-url">http://qiita.com/kekedadamama/items/154753aa8974774a8b2b</div><div class="hbc-description">はじめにPython3.6 から追加された文法機能の記事を見かけ、使ってみようと思った時、とりあえずちょろっと使うだけだからDocker(Ubuntu)で試そうとしました。しかし、apt-getでpython3.6を入れ...</div></div></div></div></a></div></div><p>下記の内容を<strong>Dockerfile</strong>という名前で任意のフォルダに保存します。 [code lang=”dockerfile”] FROM ubuntu:16.10 MAINTAINER kekedadamama<br>RUN apt-get update -y &amp;&amp; apt-get install -yq wget build-essential gcc zlib1g-dev<br>WORKDIR /root/ RUN wget <a href="https://www.python.org/ftp/python/3.6.0/Python-3.6.0.tgz">https://www.python.org/ftp/python/3.6.0/Python-3.6.0.tgz</a> \ &amp;&amp; tar zxf Python-3.6.0.tgz \ &amp;&amp; cd Python-3.6.0 \ &amp;&amp; ./configure \ &amp;&amp; make altinstall ENV PYTHONIOENCODING “utf-8”<br>WORKDIR / [/code] 続いて、保存したDockerfileのある場所で下記のコマンドを実行します。 [code lang=”sh”] $ sudo docker build . … Removing intermediate container 6c279bffa616 Successfully built a86393df781f [/code] これでビルドが実行されイメージが生成されます。 ですが、上のページだとDockeファイルの名前が、<strong>DockerFile</strong>になっており、 [code lang=”sh”] $ unable to prepare context: unable to evaluate symlinks in Dockerfile path: lstat /home/takuya/DockerFiles/Ubuntu-Python36-pip/Dockerfile: no such file or directory [/code] というエラーが表示され5分ほど悩んでいました。 正しくは<strong>Dockerfile</strong>です。大文字小文字を区別する模様。面倒な。</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>イメージが生成されているので、dockerで実行するだけです。 <strong>Portainer</strong>で実行しても構いません。 細かい実行の際の設定は </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://wp.me/p7138e-yg" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=wp.me"></img><div class="hbc-site-name">wp.me</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">.NET Core 2.0 PreviewとVisual Studio Codeでコンソールアプリをつくる Linux準備編 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://wp.me/p7138e-yg</div></div></div></div></a></div></div><p>を参考に。 Pythonは [code lang=”sh”] $ python3.6 -V Python 3.6.0 [/code] です。 必要なら [code lang=”sh”] $ alias python=’python3.6’ [/code] で使いやすく出来ます。 以上で環境の構築は終わりです。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Linux </category>
          
          <category> Python </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> Portainer </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その74 Red Hat Enterprise Linux 7.3でPython 3を使ってみる</title>
      <link href="/2017/07/29/2518/"/>
      <url>/2017/07/29/2518/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>いつインストールしたのかはわかりませんが、<strong>Red Hat Enterprise Linux 7.3</strong>には<strong>Python 2</strong>が入っていました。 しかし諸事情で<strong>Python 3</strong>を使う必要があり、その手順を調べました。 標準のリポジトリには3は入っていない様子。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>ぶっちゃけると、下記のページに全ての手順が書かれております。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://ytooyama.hatenadiary.jp/entry/2017/03/02/000846" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ytooyama.hatenadiary.jp"></img><div class="hbc-site-name">ytooyamaのブログ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/8454420450106446556/10328749687222527553/1508340513"></img></div><div class="hbc-text"><div class="hbc-title">RHELやCentOSなどでPython 3を使う - ytooyamaのブログ</div><div class="hbc-url">http://ytooyama.hatenadiary.jp/entry/2017/03/02/000846</div><div class="hbc-description">Python 3の環境をCentOS 7で作るのは大変と聞いたのでブログにまとめようと思いました。 Python 3環境をLinuxで作るんだったら迷わず FedoraやUbuntu、openSUSEをオススメします。これらは比較的新しいパッケージを提供するためです。 ただし、ど…</div></div></div></div></a></div></div><p>感謝感謝。 要点は、Python3が入っているリポジトリを追加する、だけです。 [code lang=”sh”] $ sudo yum-config-manager –enable rhel-server-rhscl-7-rpms [/code] で追加可能。 その後、 [code lang=”sh”] $ sudo yum install rh-python35 [/code] で、インストールします。 古いPythonと同居していますので、<strong>scl</strong>で環境を切り替えます。 [code lang=”sh”] $ scl enable rh-python35 bash $ python -V Python 3.5.1 $ which python /opt/rh/rh-python35/root/usr/bin/python [/code] ついでに、何かと便利な<strong>pip</strong>もインストトールしておきます。 [code lang=”sh”] $ wget <a href="https://bootstrap.pypa.io/get-pip.py">https://bootstrap.pypa.io/get-pip.py</a> $ sudo python get-pip.py $ rm get-pip.py [/code] が、どうやっても、pipを最新版にアップデートできなかったので、微妙な環境になってしまいました…</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Linux </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その73 Red Hat Enterprise Linux 7.3でbluetoothを使ってみる</title>
      <link href="/2017/07/29/2514/"/>
      <url>/2017/07/29/2514/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>IntelのNUC <strong>DN2820FYKH</strong>には内蔵のBluetoothが付属してます。 こいつを使えるようにしてみましょう。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>といっても、RHEL 7.3には最初からbluetoothのプロトコルスタック<strong>BlueZ</strong>がインストールされていました。 インストールされているかどうかは [code lang=”sh”] $ bluetoothctl –version 5.41 [/code] でわかります。 インストールされていないなら、 [code lang=”sh”] $ sudo yum install bluez [/code] でインストールできます。 次に下記のコマンドを叩きます。 [code lang=”sh”] $ sudo hciconfig up hci0: Type: Primary Bus: USB BD Address: A0:A8:CD:4B:93:07 ACL MTU: 1021:5 SCO MTU: 96:5 DOWN RX bytes:631 acl:0 sco:0 events:37 errors:0 TX bytes:401 acl:0 sco:0 commands:37 errors:0 [/code] ここで、<strong>DOWN</strong>と出ている場合は、本体のbluetoothが準備できていないので、 [code lang=”sh”] $ sudo hciconfig hci0 up [/code] と叩きます。 これにより [code lang=”sh”] $ sudo hciconfig up hci0: Type: Primary Bus: USB BD Address: A0:A8:CD:4B:93:07 ACL MTU: 1021:5 SCO MTU: 96:5 UP RUNNING RX bytes:1253 acl:0 sco:0 events:75 errors:0 TX bytes:1119 acl:0 sco:0 commands:75 errors:0 [/code] <strong>UP RUNNING</strong>に変化しました。 続いて、接続したいbluetoothデバイスを待機状態にし、下記のコマンドを叩きます。 [code lang=”sh”] $ sudo hcitool lescan LE Scan … 54:6C:0E:79:1A:87 (unknown) 54:6C:0E:79:1A:87 CC2650 SensorTag [/code] 待機状態のデバイスが認識されました。 <strong>Ctrl+C</strong>でスキャンを解除できます。</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>続いて、デバイスに接続を行います。 [code lang=”sh”] $ sudo gatttool -b 54:6C:0E:79:1A:87 –interactive [54:6C:0E:79:1A:87][LE]&gt; [/code] 入力モードに切り替わるので、 [code lang=”sh”] [54:6C:0E:79:1A:87][LE]&gt; connect Attempting to connect to 54:6C:0E:79:1A:87 Connection successful [/code] とします。 ここで、 [code lang=”sh”] Error: connect error: Connection refused (111) [/code] が出力された場合、デバイスの待機状態や電源が切れていますので、接続からやり直します。 接続が完了しましたら、実際にデータを送信してみます。 下記は、私が接続したデバイスから、計測した温度を取得するコマンドです。 [code lang=”sh”] [54:6C:0E:79:1A:87][LE]&gt; char-write-cmd 0x24 01 [54:6C:0E:79:1A:87][LE]&gt; char-read-hnd 0x21 Characteristic value/descriptor: 04 00 ad 27 01 11 31 [/code] 最初が、温度の計測を有効にし、次が温度を実際に取得するコマンドになります。 ここのコマンドは一例ですので、必要に怖じてデバイスのマニュアルを読む必要があります。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> Intel </category>
          
          <category> 無線通信 </category>
          
          <category> intel </category>
          
          <category> Bluetooth </category>
          
          <category> NUC </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その72 dlibをCUDAを有効にしてビルドする</title>
      <link href="/2017/07/07/2485/"/>
      <url>/2017/07/07/2485/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>OpenCV</strong>には顔検出用の関数があるが、どうにも精度が良くないときがある。 そこで最近名前を聞くようになった<strong>dlib</strong>を使って見ることにする。 ただ、C#のラッパーなどは出回っておらず、C++から呼び出す泥臭いことが必要な模様。 ただ、ソースのサンプルが豊富なので、試してみるのは簡単そう…. と思っていましたがそうでは無かったです。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><h2 id="ソース"><a href="#ソース" class="headerlink" title="ソース"></a>ソース</h2><p>まずはソースをダウンロード。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://dlib.net/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=dlib.net"></img><div class="hbc-site-name">dlib.net</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://dlib.net/dlib-logo-small.png"></img></div><div class="hbc-text"><div class="hbc-title">dlib C++ Library</div><div class="hbc-url">http://dlib.net/</div></div></div></div></a></div></div><p>ページ左下の青いボタンがダウンロードになります。2017/07/05時点の最新版は19.4です。<br><a href="../../../../public/2017/07/screencapture-dlib-net-1499263587443.png"><img src="../../../../public/2017/07/screencapture-dlib-net-1499263587443-1024x274.png"></a><br> ダウンロード後、任意の場所に展開します。 ここでは、<strong>D:\Works\Lib\DLib\19.4</strong>とします。 配下には下記のファイル、フォルダが展開されます。 dlib docs examples python_examples tools CMakeLists.txt documentation.html MANIFEST.in README.md setup.py</p><h2 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h2><p>dlibはCUDAを利用することで性能を大幅に向上させることが出来ます。 ただし、利用できるCUDAは7.5以降になります。今回は8.0を選択。 ダウンロードは下記になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=developer.nvidia.com"></img><div class="hbc-site-name">NVIDIA Developer</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">CUDA Toolkit 11.1 Update 1 Downloads</div><div class="hbc-url">https://developer.nvidia.com/cuda-downloads</div><div class="hbc-description">Please Note: Due to an incompatibility issue, we advise users to defer updating to Linux Kernel 5.9+ until mid-November when an NVIDIA Linux…</div></div></div></div></a></div></div><p>今回はWindows 10用のインストーラを入手します。<br><a href="../../../../public/2017/07/screencapture-developer-nvidia-cuda-downloads-1499263676219.png"><img src="../../../../public/2017/07/screencapture-developer-nvidia-cuda-downloads-1499263676219-1024x888.png"></a><br> パッチもダウンロードできるようなので、そちらもダウンロードします。 バージョンは異なりますが、インストールは下記を参考にできます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2016/02/11/net%E3%81%A7gpupu%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-cuda%E7%B7%A8-%E7%AC%AC0%E5%9B%9E/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">.NETでGPUPUを試してみる CUDA編 第0回 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2016/02/11/net%E3%81%A7gpupu%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-cuda%E7%B7%A8-%E7%AC%AC0%E5%9B%9E/</div></div></div></div></a></div></div><h2 id="cuDNN"><a href="#cuDNN" class="headerlink" title="cuDNN"></a>cuDNN</h2><p>CUDAを利用するにはcuDNNが必要です。 インストールしたCUDAに合わせたバージョンを使います。6.0はdlibで利用できないので、5.1を利用します。 ダウンロードは下記になります。 NVIDIAの開発者登録が必要ですので、登録を済ませておいてください。 </p><p>入手や展開は下記を参考にできます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2016/07/30/%E3%83%87%E3%82%A3%E3%83%BC%E3%83%97%E3%83%A9%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0-caffe-for-windows-%E3%81%9D%E3%81%AE3-cudnn-5-0%E5%AF%BE%E5%BF%9C/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">ディープラーニング Caffe for Windows その3 cuDNN 5.0対応 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2016/07/30/%E3%83%87%E3%82%A3%E3%83%BC%E3%83%97%E3%83%A9%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0-caffe-for-windows-%E3%81%9D%E3%81%AE3-cudnn-5-0%E5%AF%BE%E5%BF%9C/</div></div></div></div></a></div></div><p>今回は、<strong>D:\Works\Lib\NVIDIA\cuDNN</strong>に展開します。</p><h2 id="OpenCV"><a href="#OpenCV" class="headerlink" title="OpenCV"></a>OpenCV</h2><p>下記からインストーラをダウンロードしてインストールしておきます。2017/07/05の時点で最新は3.2.0になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://opencv.org/releases.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=opencv.org"></img><div class="hbc-site-name">opencv.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Releases</div><div class="hbc-url">http://opencv.org/releases.html</div></div></div></div></a></div></div><p>今回は、<strong>D:\Works\Lib\OpenCV\opencv-3.2.0</strong>に展開します。</p><h2 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h2><p>Visual Studioのソリューションファイルを生成するために必要です。 下記でダウンロードしインストールします。2017/07/05時点の最新の安定版は3.8.2です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://cmake.org/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=cmake.org"></img><div class="hbc-site-name">cmake.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">CMake</div><div class="hbc-url">https://cmake.org/</div></div></div></div></a></div></div><p>インストール時、CMakeを環境変数PATHに追加するか選択できますが、そこは好みで。</p><h2 id="Visual-Studio"><a href="#Visual-Studio" class="headerlink" title="Visual Studio"></a>Visual Studio</h2><p>ビルドに使います。当たり前かもしれませんが、これがくせ者。 まず、dlibが対応しているCUDAは7.5以降になります。今回は8.0にします。 しかし、8.0に対応しているのはVisual Studio 2015以前です。 2017は<strong>対応していません</strong> </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html#axzz4lyCjEB3M" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.nvidia.com"></img><div class="hbc-site-name">docs.nvidia.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Installation Guide Windows :: CUDA Toolkit Documentation</div><div class="hbc-url">http://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html#axzz4lyCjEB3M</div><div class="hbc-description">The installation instructions for the CUDA Toolkit on MS-Windows systems.</div></div></div></div></a></div></div><h1 id="Build-with-CUDA"><a href="#Build-with-CUDA" class="headerlink" title="Build with CUDA"></a>Build with CUDA</h1><p>まずコマンドプロンプトで、dlibの展開フォルダを開きます。 なお、<strong>build</strong>フォルダの名前は自由です。 [code lang=”batch”] D:\Works\Lib\DLib\19.4&gt;cd examples D:\Works\Lib\DLib\19.4\examples&gt;mkdir build D:\Works\Lib\DLib\19.4\examples&gt;cd build D:\Works\Lib\DLib\19.4\examples\build&gt;”C:\Program Files\CMake\bin\cmake.exe” -G “Visual Studio 14 2015 Win64” -DCOMPILER_CAN_DO_CPP_11=ON -DOpenCV_DIR=D:\Works\Lib\OpenCV\opencv-3.2.0\build .. – The C compiler identification is MSVC 19.0.24215.1 – The CXX compiler identification is MSVC 19.0.24215.1 – Check for working C compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – Check for working C compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – works – Detecting C compiler ABI info – Detecting C compiler ABI info - done – Check for working CXX compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – Check for working CXX compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – works – Detecting CXX compiler ABI info – Detecting CXX compiler ABI info - done – Detecting CXX compile features – Detecting CXX compile features - done – Looking for sys/types.h – Looking for sys/types.h - found – Looking for stdint.h – Looking for stdint.h - found – Looking for stddef.h – Looking for stddef.h - found – Check size of void* – Check size of void* - done – Enabling SSE2 instructions – Looking for png_create_read_struct – Looking for png_create_read_struct - found – Looking for jpeg_read_header – Looking for jpeg_read_header - not found – Searching for BLAS and LAPACK – Found CUDA: C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v8.0 (found suitable version “8.0”, minimum required is “7.5”) – Looking for cuDNN install… – *** cuDNN V5.0 OR GREATER NOT FOUND. DLIB WILL NOT USE CUDA. *** – *** If you have cuDNN then set CMAKE_PREFIX_PATH to include cuDNN’s folder. – Configuring done – Generating done – Build files have been written to: D:/Works/Lib/DLib/19.4/examples/build [/code] しかし、Cmakeが失敗します。 ネットを見ると、<strong>-DCMAKE_PREFIX_PATH</strong>に<strong>cuDNN</strong>のルートフォルダを指定する、みたいなことが書いてありますが、これでは私の環境ではダメでした。 解決策は、cuDNN内の <strong>cuda\include\cudnn.h</strong> <strong>cuda\lib\x64\cudnn.lib</strong> を、それぞれ <strong>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v8.0\include</strong> <strong>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v8.0\lib\x64</strong> にコピーします。 その後、buildフォルダ内を削除し、先のコマンドを実行します。 [code lang=”batch”] D:\Works\Lib\DLib\19.4\examples\build&gt;”C:\Program Files\CMake\bin\cmake.exe” -G “Visual Studio 14 2015 Win64” -DCOMPILER_CAN_DO_CPP_11=ON -DOpenCV_DIR=D:\Works\Lib\OpenCV\opencv-3.2.0\build ..<br>-- Found CUDA: C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v8.0 (found suitable version “8.0”, minimum required is “7.5”) – Looking for cuDNN install… – Building a CUDA test project to see if your compiler is compatible with CUDA… – Checking if you have the right version of cuDNN installed. – Found cuDNN: C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v8.0/lib/x64/cudnn.lib – Configuring done – Generating done – Build files have been written to: D:/Works/Lib/DLib/19.4/examples/build [/code] CMakeでVisual Studioのソリューションファイルの生成に成功しましたので、下記のようにビルドします。 [code lang=”batch”] D:\Works\Lib\DLib\19.4&gt;”C:\Program Files\CMake\bin\cmake.exe” –build . –config Release<br>..大量のログ..<br>188 個の警告 0 エラー<br>経過時間 00:21:08.86 [/code]</p><h1 id="Build-without-CUDA"><a href="#Build-without-CUDA" class="headerlink" title="Build without CUDA"></a>Build without CUDA</h1><p>もし、CUDAを無効にしたいなら [code lang=”batch”] D:\Works\Lib\DLib\19.4&gt;cd examples D:\Works\Lib\DLib\19.4\examples&gt;mkdir build_cuda_off D:\Works\Lib\DLib\19.4\examples&gt;cd build_cuda_off D:\Works\Lib\DLib\19.4\examples\build_cuda_off&gt;”C:\Program Files\CMake\bin\cmake.exe” -G “Visual Studio 14 2015 Win64” -DOpenCV_DIR=D:\Works\Lib\OpenCV\opencv-3.2.0\build -DDLIB_USE_CUDA=OFF .. – The C compiler identification is MSVC 19.0.24215.1 – The CXX compiler identification is MSVC 19.0.24215.1 – Check for working C compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – Check for working C compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – works – Detecting C compiler ABI info – Detecting C compiler ABI info - done – Check for working CXX compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – Check for working CXX compiler: C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/bin/x86_amd64/cl.exe – works – Detecting CXX compiler ABI info – Detecting CXX compiler ABI info - done – Detecting CXX compile features – Detecting CXX compile features - done – C++11 activated. – Looking for sys/types.h – Looking for sys/types.h - found – Looking for stdint.h – Looking for stdint.h - found – Looking for stddef.h – Looking for stddef.h - found – Check size of void* – Check size of void* - done – Enabling SSE2 instructions – Looking for png_create_read_struct – Looking for png_create_read_struct - found – Looking for jpeg_read_header – Looking for jpeg_read_header - not found – Searching for BLAS and LAPACK – Configuring done – Generating done – Build files have been written to: D:/Works/Lib/DLib/19.4/examples/build_cuda_off [/code] とします。 この際、cmakeを実行するフォルダを<strong>build</strong>フォルダと別名にしておかないと、CUDAを有効にしたバイナリが上書きされますので注意です。 ビルドは同様に、 [code lang=”batch”] D:\Works\Lib\DLib\19.4\examples\build_cuda_off&gt;”C:\Program Files\CMake\bin\cmake.exe” –build . –config Release<br>..大量のログ..<br>188 個の警告 0 エラー<br>経過時間 00:21:28.63 [/code] とします。</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> gpupu </category>
          
          <category> CUDA </category>
          
          <category> 機械学習 </category>
          
          <category> GPUPU </category>
          
          <category> dlib </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その71 NLogでLoggerの読み込みに失敗する</title>
      <link href="/2017/06/20/2475/"/>
      <url>/2017/06/20/2475/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>NLog</strong>はシンプルで使いやすいです。 個人的にはlog4netよりもシンプルで使いやすくて好きです。 そんなNLogで、複数のLoggerを準備している際に問題が起きました。 下記のような<strong>NLog.config</strong>です。 [code lang=”xml”] <?xml version="1.0" encoding="utf-8" ?> <nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><br><targets> <target name="ABC" xsi:type="File" fileName="file.txt" /> <target name="DEF\_" xsi:type="File" fileName="file.txt" /> <target name="GHI" xsi:type="File" fileName="file.txt" /> </targets><br><rules> <logger name="ABCLogger" minlevel="Info" writeTo="ABC" /> <logger name="DEFLogger" minlevel="Trace" writeTo="DEF" /> <logger name="GHILogger" minlevel="Trace" writeTo="GHI" /> </rules> </nlog> [/code] このファイルをアプリと一緒に読み込み、**LogManager.GetLogger(“GHILogger”);**と実行してもログを書き出すことができません。 しかもエラーも発生しません。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>ポイントは、targets内の、targetセクションにおいて、rules内のloggerセクションのwriteTo属性と対応付けすることが出来ないtargetが存在することになります。 つまり、<strong>DEF_</strong>がそれです。 このため、NLogの内部では処理がおかしくなっているのか、<strong>ABCLogger</strong>は読み込めますが、次の<strong>DEFLogger</strong>は対応付く<strong>DEF</strong>が存在しないため読み込めません。 さらに不味いのは、この状態だと後続の<strong>GHILogger</strong>も読めません。 途中で対応付けに失敗すると、それ以降の対応付けに失敗あるいは対応付けそのものを中止してしまうのでしょう。 対応は簡単です。 targetのname属性またはloggerのwriteTo属性を正しく対応付けるように修正するだけです。 この場合は、2番目のtargetのname属性を<strong>DEF</strong>に修正することで正しく動きます。 仕事で、ログが出力されなくて悩みましたが、一見無関係に見える、使っていないLoggerが影響するとは思いませんでした。</p>]]></content>
      
      
      <categories>
          
          <category> Logging </category>
          
          <category> logging </category>
          
          <category> NLog </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第5回</title>
      <link href="/2017/05/27/2466/"/>
      <url>/2017/05/27/2466/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、<strong>System.IO.FileStream</strong>を使ってファイルのアクセス権限を確認してみました。 </p><p>今回は少し高度なファイルへのアクセス可否についてです。</p><h1 id="P-Invoke"><a href="#P-Invoke" class="headerlink" title="P/Invoke"></a>P/Invoke</h1><p>ファイルに実際にアクセスしてみて、アクセスできるかどうかを試すって、結構良くないと思います。 かといって、Windowsの.NET Frameworkにアクセスできるかどうかを試すAPIは無かったはずです。 ですが、Linuxのシステムコールを使えば、それが実現可能です。 システムコールの呼び出しは当然<strong>P/Invoke</strong>で実現します。 Linuxのシステムコールで、ファイルに対して、読み込みができるか、書き込みが出来るか、実行できるか、という状態を調べるには、<strong>access</strong>を呼び出します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://linuxjm.osdn.jp/html/LDP_man-pages/man2/access.2.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=linuxjm.osdn.jp"></img><div class="hbc-site-name">linuxjm.osdn.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Man page of ACCESS</div><div class="hbc-url">https://linuxjm.osdn.jp/html/LDP_man-pages/man2/access.2.html</div></div></div></div></a></div></div><p>大抵のシステムコールは<strong>libc</strong>に定義されています。 実際に、libcに定義されている関数の一覧からaccessを探してみます。 そのために、<strong>nm</strong>コマンドに<strong>-D</strong>オプションを渡します。 [code lang=”sh”] $ nm -D /usr/lib64/lib.so.6 | grep access 00000000000e8ce0 W access 00000000000e8d10 W eaccess 00000000000e8d10 W euidaccess 00000000000e8e30 T faccessat [/code] これでlibcにaccessが定義されていることがわかりました。 次にaccessの使い方です。 定義は下記です。 [code lang=”cpp”] int access(const char *pathname, int mode); [/code] 第一引数はファイルパスです。 第二引数は調べるモードを表します。</p><p>値</p><p>意味</p><p>F_OK</p><p>存在するか</p><p>R_OK</p><p>読み込み可能か</p><p>W_OK</p><p>書き込み可能か</p><p>X_OK</p><p>実行可能か</p><p>第二引数のモードを組み合わせることで、アクセス可否をチェックします。 指定したモードを満たせば、0を返します。 満たさない場合は-1を返します。</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>今回は、**/etc/passwd<strong>を調べてみます。 [code lang=”sh”] $ ls -la /etc/passwd -rw-r–r–. 1 root root 2336 4月 20 23:58 /etc/passwd [/code] root以外は、読み込みしかできません。 では、これをコードで調べてみます。 [code lang=”csharp”] using System; using System.IO; using System.Runtime.InteropServices; using System.Text;<br>namespace ConsoleApplication { public class Program {<br>internal enum Mode : int { F_OK = 0, X_OK = 1, W_OK = 2, R_OK = 4 }<br>[DllImport(“libc”)] internal static extern int access(string path, Mode mode);<br>public static void Main(string[] args) { if (args.Length != 1) { Console.WriteLine(“Must specify full path!!”); return; }<br>var path = args[0]; if (access(path, Mode.F_OK) != 0) { Console.WriteLine(“Specified path does not exist!!”); return; }<br>Console.WriteLine(access(path, Mode.R_OK) == 0 ? “Can read” : “Can not read”); Console.WriteLine(access(path, Mode.W_OK) == 0 ? “Can write” : “Can not write”); Console.WriteLine(access(path, Mode.X_OK) == 0 ? “Can exec” : “Can not exec”); } }<br>} [/code] 引数で指定したファイルの読み込み、書き込み、実行の可否を調べます。 前回同様、まずは、一般ユーザで確認します。 **which</strong>でdotnetコマンドの場所を調べているのは、rootユーザで<strong>dotnet</strong>までのパスが通っていなかったので、実施しているだけです。 パスが通っているなら不要です。 引数のファイルパスは<strong>dotnet run</strong>の直後に追記することで指定できます。 [code lang=”sh”] # dotnetコマンドの場所を調べます $ which dotnet /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet<br>$ /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet run /etc/passwd Can read Can not write Can not exec [/code] 読み込みしかできないようです。 <strong>ls -la</strong>で調べたとおりです。 続いて、rootで確認します。 [code lang=”sh”] $ sudo /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet run /etc/passwd Can read Can write Can not exec [/code] 読み書きができて、実行できないことが確認できました。 これも、<strong>ls -la</strong>で調べたとおりです。 では、存在しないファイルを指定してみます。 [code lang=”sh”] $ /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet run /etc/passwd2 Specified path does not exist!! [/code] きちんと存在しないことを確認してくれます。 フォルダも調べることが出来ます。 [code lang=”sh”] $ ls -lad /etc drwxr-xr-x. 141 root root 8192 5月 27 16:15 /etc $ /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet run /etc Can read Can not write Can exec $ sudo /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet run /etc Can read Can write Can exec [/code]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Windows同様、P/Invokeが利用可能であることを確認できました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> C# </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第4回</title>
      <link href="/2017/05/27/2461/"/>
      <url>/2017/05/27/2461/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、<strong>System.IO.DirectoryInfo</strong>を使って、ファイルの一覧を列挙してみました。 </p><p>今回はファイルへのアクセス可否についてです。</p><h1 id="May-I-open-this-file"><a href="#May-I-open-this-file" class="headerlink" title="May I open this file?"></a>May I open this file?</h1><p>Windows上のC#なら、ファイルに書き込みできるかどうか等は、実際にファイルへのストリームを作成してみたりします。 [code lang=”csharp”] private bool CanRead(string path) { FileStream stream = null;<br>try { stream = new FileStream(path, FileMode.Open, FileAccess.Read, FileShare.None); } catch { return false; } finally { stream?.Dispose(); }<br>return true; } [/code] では、Linuxでこれを実施するとどうなるでしょう? ありがちなのは、所有者がrootになっていて、root以外が読み込みも出来ないパターンです。 例えば、**/etc/sudo.conf<strong>がそうです。 [code lang=”sh”] $ ls -la /etc/sudo.conf -rw-r—–. 1 root root 1786 11月 24 2016 /etc/sudo.conf $ cat /etc/sudo.conf cat: sudo.conf: 許可がありません [/code] なので、こんなソースを用意してみました。 [code lang=”csharp”] using System; using System.IO;<br>namespace ConsoleApplication { public class Program { public static void Main(string[] args) { if (args.Length != 1) { Console.WriteLine(“Must specify full path!!”); return; }<br>var path = args[0]; if (!File.Exists(path)) { Console.WriteLine(“Specified path does not exist!!”); return; }<br>FileStream stream = null;<br>try { stream = new FileStream(path, FileMode.Open, FileAccess.Read, FileShare.None); Console.WriteLine($”‘{path}’ can be opened!!”); } catch (Exception ex) { Console.WriteLine($”Can not open file. Reason: {ex.Message}!!”); } finally { stream?.Dispose(); } } } } [/code] 引数で指定したファイルを開くことが出来れば、</strong>‘’ can be opened!!<strong>と表示されます。 ファイルを開こうとして、例外を投げれば、開けなかった理由が表示される、というシンプルなテストです。 ソースを記述したら、プロジェクトフォルダで [code lang=”sh”] $ dotnet restore $ dotnet build [/code] を実行します。 これでビルドが成功するはずです。 まずは、一般ユーザで確認します。 **which</strong>でdotnetコマンドの場所を調べているのは、rootユーザで<strong>dotnet</strong>までのパスが通っていなかったので、実施しているだけです。 パスが通っているなら不要です。 引数のファイルパスは<strong>dotnet run</strong>の直後に追記することで指定できます。 [code lang=”sh”] # dotnetコマンドの場所を調べます $ which dotnet /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet<br>$ /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet run /etc/sudo.conf Can not open file. Reason: Access to the path ‘/etc/sudo.conf’ is denied.!! [/code] アクセスが拒否されています。 続いて、rootで確認します。 [code lang=”sh”] $ sudo /opt/rh/rh-dotnetcore11/root/usr/bin/dotnet run /etc/sudo.conf ‘/etc/sudo.conf’ can be opened!! [/code] 無事にアクセスできました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>基本的なアクセス権も.NET Coreで対処できそうです。 次回は、もう少し高度な方法で読み書きできるかを調べてみたいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> C# </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第3回</title>
      <link href="/2017/05/26/2451/"/>
      <url>/2017/05/26/2451/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、デバッグ時に引数を指定して実行してみました。 </p><p>今回はファイルパスを使ったAPIのメモです。</p><h1 id="System-IO-DirectoryInfo"><a href="#System-IO-DirectoryInfo" class="headerlink" title="System.IO.DirectoryInfo"></a>System.IO.DirectoryInfo</h1><h2 id="相対パス扱いなの"><a href="#相対パス扱いなの" class="headerlink" title="相対パス扱いなの?"></a>相対パス扱いなの?</h2><p>前回、デバッグ引数として、**<del>/<strong>を指定しました。 Linuxにおいてこのパスは、実行ユーザのホームディレクトリを示します。 (</strong></del>**も同様。) これを使って、下記のコードを実行します。 [code lang=”csharp”] using System;<br>namespace ConsoleApplication { public class Program { public static void Main(string[] args) { var path = args[0]; Console.WriteLine($”Path is ‘{path}’”); foreach(var f in new System.IO.DirectoryInfo(path).GetFiles()) Console.WriteLine($”{f.Name}”); } } } [/code] よくある、指定したパスの配下のファイルを列挙するプログラムです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://docs.microsoft.com/en-us/dotnet/api/system.io.directoryinfo.getfiles?view=netcore-1.1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.microsoft.com"></img><div class="hbc-site-name">docs.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">DirectoryInfo.GetFiles Method (System.IO)</div><div class="hbc-url">https://docs.microsoft.com/en-us/dotnet/api/system.io.directoryinfo.getfiles?view=netcore-1.1</div><div class="hbc-description">Returns a file list from the current directory. </div></div></div></div></a></div></div><p>これを実行すると下記の例外を投げます。 [code] Unhandled Exception: System.IO.DirectoryNotFoundException: Could not find a part of the path ‘/home/XXXXXX/git/Demo/DotNetCoreLinux3/<del>/‘. at System.IO.UnixFileSystem.FileSystemEnumerable`1.OpenDirectory(String fullPath) at System.IO.UnixFileSystem.FileSystemEnumerable`1.Enumerate() at System.IO.UnixFileSystem.FileSystemEnumerable`1..ctor(String userPath, String searchPattern, SearchOption searchOption, SearchTarget searchTarget, Func`3 translateResult) at System.IO.UnixFileSystem.EnumerateFileSystemInfos(String fullPath, String searchPattern, SearchOption searchOption, SearchTarget searchTarget) at System.IO.DirectoryInfo.InternalGetFiles(String searchPattern, SearchOption searchOption) at System.IO.DirectoryInfo.GetFiles() at ConsoleApplication.Program.Main(String[] args) in /home/XXXXXX/git/Demo/DotNetCoreLinux3/Program.cs:line 11 [/code] **Could not find a part of the path ‘/home/XXXXXX/git/Demo/DotNetCoreLinux3/</del>/‘<strong>という記述から、指定したパスは、カレントディレクトリからの相対パス扱いになってしまいました。 なので、</strong>System.IO.Path.GetFullPath**メソッドで絶対パスに変換してみます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://docs.microsoft.com/en-us/dotnet/api/system.io.path.getfullpath?view=netcore-1.1#System_IO_Path_GetFullPath_System_String_" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.microsoft.com"></img><div class="hbc-site-name">docs.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">Path.GetFullPath Method (System.IO)</div><div class="hbc-url">https://docs.microsoft.com/en-us/dotnet/api/system.io.path.getfullpath?view=netcore-1.1#System_IO_Path_GetFullPath_System_String_</div><div class="hbc-description">Returns the absolute path for the specified path string. </div></div></div></div></a></div></div><p>[code lang=”csharp”] using System;<br>namespace ConsoleApplication { public class Program { public static void Main(string[] args) { Console.WriteLine($”Argument is ‘{args[0]}’”);<br>var path = System.IO.Path.GetFullPath(args[0]); Console.WriteLine($”Path is ‘{path}’”);<br>foreach(var f in new System.IO.DirectoryInfo(path).GetFiles()) Console.WriteLine($”{f.Name}”); } } } [/code] 変わらず同じ例外が出力されます。 デバッグコンソールの出力は下記のようになります。 [code] Argument is ‘<del>‘ Path is ‘/home/XXXXXX/git/Demo/DotNetCoreLinux3/</del>‘ [/code] なので、**~**はダメな模様。</p><h2 id="ルートから指定してみる"><a href="#ルートから指定してみる" class="headerlink" title="ルートから指定してみる"></a>ルートから指定してみる</h2><p>Windowsでも、パス指定の際の基準はカレントディレクトリになりました。 でも、フルパスを指定したなら、それはフルパスとして解釈されます。 間違っても、**&lt;カレントディレクトリ&gt;\&lt;フルパス&gt;<strong>みたいな解釈はされません。 Linuxでもそうなるでしょうか? Linuxにおけるルートは</strong>/<strong>になります。 次は、デバッグ引数に</strong>/<strong>を指定して、実行してみます。 無事に最後まで実行できています。 また、</strong>/<strong>はGetFullPathでも</strong>/**として認識されています。<br><a href="../../../../public/2017/05/bfaee64cfd5435b06420a1383643a39b.png"><img src="../../../../public/2017/05/bfaee64cfd5435b06420a1383643a39b.png"></a> きちんとルートディレクトリの内容と比較してみます。 同じ内容であることがわかります。 <a href="../../../../public/2017/05/8f9faae92bcd8eacc4c3635614bada4c.png"><img src="../../../../public/2017/05/8f9faae92bcd8eacc4c3635614bada4c.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>少しずつ基本的なAPIを使えるようになってきました。 Windows/Mac/Linuxでの挙動の違いを比較してみたいですね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> C# </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
          <category> Visual Studio Code </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第2回</title>
      <link href="/2017/05/25/2419/"/>
      <url>/2017/05/25/2419/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、GUIからgitによるコミットを実行しました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2017/05/25/net%E3%81%A7linux%E3%81%A8%E9%81%8A%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B-visual-studio-code%E7%B7%A8-%E7%AC%AC1-5%E5%9B%9E/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">.NETでLinuxと遊んでみる Visual Studio Code編 第1.5回 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2017/05/25/net%E3%81%A7linux%E3%81%A8%E9%81%8A%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B-visual-studio-code%E7%B7%A8-%E7%AC%AC1-5%E5%9B%9E/</div></div></div></div></a></div></div><p>今回はDebug時の引数指定のメモです。</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>デバッグ時の引数を指定してみます。 <strong>Visula Studio</strong>使っているなら、プロジェクトのプロパティ見て、引数を、ってのがすぐ思い浮かべますが、プロジェクトファイルが存在しない(.NET Core 1.1の場合)ので、ちょっと構えてしまいます。 Debugの手順については、きちんと下記の公式ページの<strong>Launch.json attributes</strong>に明記されています。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://code.visualstudio.com/docs/editor/debugging#_launchjson-attributes" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=code.visualstudio.com"></img><div class="hbc-site-name">code.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://code.visualstudio.com/assets/docs/editor/debugging/Debugging.png"></img></div><div class="hbc-text"><div class="hbc-title">Debugging in Visual Studio Code</div><div class="hbc-url">https://code.visualstudio.com/docs/editor/debugging#_launchjson-attributes</div><div class="hbc-description">One of the great things in Visual Studio Code is debugging support.  Set breakpoints, step-in, inspect variables and more.</div></div></div></div></a></div></div><p>この<strong>launch.json</strong>が肝になります。 ちょっと上のページは文字だけでわかりにくいので画像をつけて。 まず<strong>dotnet new</strong>でプロジェクト作成後のフォルダを開いた状態です。<br><a href="../../../../public/2017/05/b33fa965fed8ada85e64e9dd08bfc4b4.png"><img src="../../../../public/2017/05/b33fa965fed8ada85e64e9dd08bfc4b4-1024x693.png"></a><br> <strong>Program.cs</strong>の内容は [code lang=”csharp”] using System;<br>namespace ConsoleApplication { public class Program { public static void Main(string[] args) { Console.WriteLine(args[0]); } } } [/code] に変更します。 また、Console.WriteLineの行とその次の行にブレークポイントを貼っておきます。</p><p>左側のデバッグアイコンをクリックします。<br><a href="../../../../public/2017/05/dac71873847fdf5d634c5677a4472d88.png"><img src="../../../../public/2017/05/dac71873847fdf5d634c5677a4472d88.png"></a></p><p>デバッグペインが出現するので、上部の歯車アイコンをクリックします。<br><a href="../../../../public/2017/05/01b28b7b1badb6a76ec0f2cfad5c496f.png"><img src="../../../../public/2017/05/01b28b7b1badb6a76ec0f2cfad5c496f.png"></a></p><p><strong>.NET Core</strong>を選択します。<br><a href="../../../../public/2017/05/ec3811c36ff1efb98d3d7c15467e6fe0.png"><img src="../../../../public/2017/05/ec3811c36ff1efb98d3d7c15467e6fe0.png"></a></p><p><strong>launch.json</strong>が作成されて表示されます。 <strong>name:**が</strong>.NET Core Launch (console)**になっているセクションを</p><ul><li><p>“program”: ${workspaceRoot}/bin/Debug//&lt;project-name.dll&gt;</p><ul><li><strong>“program”: ${workspaceRoot}/bin/Debug/netcoreapp1.1/DotNetCoreLinux2.dll</strong> に変更</li></ul></li><li><p>“args: []“</p><ul><li><strong>“args: [“~/“]“</strong></li></ul></li></ul><p>に変更して、保存します。<br><a href="../../../../public/2017/05/b548eff4976ef2708a1512afce234a8c.png"><img src="../../../../public/2017/05/b548eff4976ef2708a1512afce234a8c.png"></a></p><p>この状態で<strong>F5</strong>でデバッグを開始すると、<strong>エラー preLaunchTask ‘build’ が見つかりませんでした。</strong>とエラーが表示されます。 右側の<strong>タスクランナーの構成</strong>という選択肢を選択します。<br><a href="../../../../public/2017/05/d8bae97927166d82a5b51285c5353f12.png"><img src="../../../../public/2017/05/d8bae97927166d82a5b51285c5353f12-1024x117.png"></a></p><p>ドロップダウンから**.NET Core**を選択します。<br><a href="../../../../public/2017/05/b0497188a75a8df4831b285ece8a754b.png"><img src="../../../../public/2017/05/b0497188a75a8df4831b285ece8a754b-1024x356.png"></a></p><p><strong>tasks.json</strong>が作成されて、表示されます。 特に変更する必要はありません。<br><a href="../../../../public/2017/05/3ce5e21ee467c72540334d132aebf979.png"><img src="../../../../public/2017/05/3ce5e21ee467c72540334d132aebf979.png"></a></p><p>再度、F5でデバッグを実施します。 コードにエラーが無くても、<strong>エラー preLaunchTask ‘build’ の実行中にビルド エラーが検出されました。</strong>とエラーが表示されるかもしれませんが、そのままデバッグが始まります。<br><a href="../../../../public/2017/05/88e89113e3040b616417f331b3a203c9.png"><img src="../../../../public/2017/05/88e89113e3040b616417f331b3a203c9-1024x384.png"></a></p><p>引数<strong>args</strong>にカーソルを合わせると、ウォッチ出来ます。 <strong>launch.json</strong>で指定した引数が、先頭に格納されているのがわかります。<br><a href="../../../../public/2017/05/a8322cec489e74ab2030642466378480.png"><img src="../../../../public/2017/05/a8322cec489e74ab2030642466378480.png"></a></p><p>次の行に進めます。<strong>デバッグコンソール</strong>に**args[0]**の内容が表示されています。<br><a href="../../../../public/2017/05/22c292813423d3775269bd3bb8f6182f.png"><img src="../../../../public/2017/05/22c292813423d3775269bd3bb8f6182f.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>引数の指定が出来るようになりました。 次回は、ファイルパスを利用したAPIを試してみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> Visual Studio Code </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第1.5回</title>
      <link href="/2017/05/25/2401/"/>
      <url>/2017/05/25/2401/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、CUI、GUIから.NET Coreのプロジェクトを実行、デバッグしました。 </p><p>今回はちょっと脇道で、バージョン管理システムとしてgitをVisual Studio Codeから使ってみます。 個人的には、コミット、履歴表示、元に戻す(チェックアウト)は、IDEから実施し、プッシュやブランチの作成は、Gitクライアントから実行するという切り分けが好きです。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>まずは、gitをインストールする必要があります。 Visual Studio Codeは、gitに標準で対応していますが、gitの機能そのものにはgitそれ自体に依存しています。 下記のコマンドで実行しますが、<strong>-y</strong>はこの時点で付与しません。 [code lang=”sh”] $ yum install git 読み込んだプラグイン:langpacks, product-id, search-disabled-repos, subscription-manager 依存性の解決をしています –&gt; トランザクションの確認を実行しています。 —&gt; パッケージ git.x86_64 0:1.8.3.1-6.el7_2.1 を インストール –&gt; 依存性の処理をしています: perl-Git = 1.8.3.1-6.el7_2.1 のパッケージ: git-1.8.3.1-6.el7_2.1.x86_64 –&gt; 依存性の処理をしています: perl(Error) のパッケージ: git-1.8.3.1-6.el7_2.1.x86_64 –&gt; 依存性の処理をしています: perl(Git) のパッケージ: git-1.8.3.1-6.el7_2.1.x86_64 –&gt; 依存性の処理をしています: perl(Term::ReadKey) のパッケージ: git-1.8.3.1-6.el7_2.1.x86_64 –&gt; トランザクションの確認を実行しています。 —&gt; パッケージ perl-Error.noarch 1:0.17020-2.el7 を インストール —&gt; パッケージ perl-Git.noarch 0:1.8.3.1-6.el7_2.1 を インストール —&gt; パッケージ perl-TermReadKey.x86_64 0:2.30-20.el7 を インストール –&gt; 依存性解決を終了しました。<br>依存性を解決しました<br>==================================================================================================================================================================================== Package アーキテクチャー バージョン リポジトリー 容量 ==================================================================================================================================================================================== インストール中: git x86_64 1.8.3.1-6.el7_2.1 rhel-7-server-rpms 4.4 M 依存性関連でのインストールをします: perl-Error noarch 1:0.17020-2.el7 rhel-7-server-rpms 32 k perl-Git noarch 1.8.3.1-6.el7_2.1 rhel-7-server-rpms 53 k perl-TermReadKey x86_64 2.30-20.el7 rhel-7-server-rpms 31 k<br>トランザクションの要約 ==================================================================================================================================================================================== インストール 1 パッケージ (+3 個の依存関係のパッケージ)<br>総ダウンロード容量: 4.5 M インストール容量: 22 M Is this ok [y/d/N]: [/code] どうもyumリポジトリに入っているgitのバージョンが1.8とかなり古いようです。 (2017/05/17時点で最新版は2.13.0) なので、自分でビルドします。 作業手順は下記を参照しました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://bacchi.me/linux/how-to-install-git/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=bacchi.me"></img><div class="hbc-site-name">bacchi.me</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">CentOS に最新版のGitをインストールする - bacchi.me</div><div class="hbc-url">https://bacchi.me/linux/how-to-install-git/</div></div></div></div></a></div></div><h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>ただし、上記は、古いgitがインストールされている環境です。 対して、こっちはGitKrakenがいるので、GitKrakenを使って、gitのソースをCloneします。 cloneするソースはmasterブランチなので、<strong><a href="https://github.com/git/git.git">https://github.com/git/git.git</a></strong>になります。<br><a href="../../../../public/2017/05/5f0ed32cde66228d4a4e68d8255499a7.png"><img src="../../../../public/2017/05/5f0ed32cde66228d4a4e68d8255499a7-1024x693.png"></a></p><p>Cloneが完了した、Clone先のフォルダに移動します。 まず必要な依存関係を解決します。 [code lang=”sh”] $ cd &lt;gitのクローン先&gt; $ yum -y install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-ExtUtils-MakeMaker # GCCがないならインストール $ yum -y install gcc [/code] 続いて、ビルドとインストールを実行します。 GCCがないなら、makeそのものが失敗するので要確認。 [code lang=”sh”] $ make prefix=/usr/local all $ make prefix=/usr/local install [/code] 私の場合、インストール完了後、再度シェルを立ち上げ直すと、gitが有効になりました。 [code lang=”sh”] $ git –version git version 2.13.GIT [/code]</p><h1 id="git-from-Visual-Studio-Code"><a href="#git-from-Visual-Studio-Code" class="headerlink" title="git from Visual Studio Code"></a>git from Visual Studio Code</h1><p>gitをインストールし、Visual Studio Codeを起動し、プロジェクトフォルダを開きます。 既に、プロジェクトフォルダがgitで初期化されている場合、下記のように、左端の<strong>ソース管理</strong>から、未コミット状態のファイル一覧が表示されるようになります。<br><a href="../../../../public/2017/05/94bab03186d05879b987bb1715fd1d99.png"><img src="../../../../public/2017/05/94bab03186d05879b987bb1715fd1d99-1024x359.png"></a> 次に、ファイルにカーソルを合わせると、**+<strong>ボタンが表示されるので、それをクリックすることでステージングできます。 <a href="../../../../public/2017/05/50966824538250ebbd03c2e8dfd0be21.png"><img src="../../../../public/2017/05/50966824538250ebbd03c2e8dfd0be21.png"></a> ステージングが完了したらコメントを入力します。 入力が完了したら</strong>Enterキー<strong>または</strong>コミットボタン**でコミットできます。 <a href="../../../../public/2017/05/96022b0f3db2e821f9ce3278fa34140a.png"><img src="../../../../public/2017/05/96022b0f3db2e821f9ce3278fa34140a.png"></a><br> 後は、pushするなり何なりします。 私は前述のように、pushはGitKraken等のGitクライアントに任せます。 一応Visual Studio Codeからpush等も可能ですが、ここでは割愛します。</p><h1 id="Conslusion"><a href="#Conslusion" class="headerlink" title="Conslusion"></a>Conslusion</h1><p>開発環境が完成した感じです。 後は、Visual Studio Codeに慣れていけば、Macでもどこでも開発できるでしょう。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> バージョン管理システム </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> git </category>
          
          <category> Visual Studio Code </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第1回</title>
      <link href="/2017/05/24/2389/"/>
      <url>/2017/05/24/2389/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、**.NET Core<strong>、</strong>Visual Studio Code<strong>、</strong>拡張機能**をインストールしました。 </p><p>今回はプロジェクトを作って実行します。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>まずは、プロジェクトフォルダを作成します。 これはどこでも良いので、今回は、**~/git/Demo/DotNetCoreLinux1<strong>とします。 このフォルダを移行プロジェクトフォルダと呼称します。 まず端末を開き、プロジェクトフォルダに移動し、下記のコマンドを入力します。 [code lang=”sh”] $ cd ~/git/Demo/DotNetCoreLinux1 $ dotnet new Welcome to .NET Core! ——————— Learn more about .NET Core @ <a href="https://aka.ms/dotnet-docs">https://aka.ms/dotnet-docs</a>. Use dotnet –help to see available commands or go to <a href="https://aka.ms/dotnet-cli-docs">https://aka.ms/dotnet-cli-docs</a>. Telemetry ————– The .NET Core tools collect usage data in order to improve your experience. The data is anonymous and does not include commandline arguments. The data is collected by Microsoft and shared with the community. You can opt out of telemetry by setting a DOTNET_CLI_TELEMETRY_OPTOUT environment variable to 1 using your favorite shell. You can read more about .NET Core tools telemetry @ <a href="https://aka.ms/dotnet-cli-telemetry">https://aka.ms/dotnet-cli-telemetry</a>. Configuring… ——————- A command is running to initially populate your local package cache, to improve restore speed and enable offline access. This command will take up to a minute to complete and will only happen once. Decompressing 100% 5707 ms Expanding 100% 20878 ms Created new C# project in /home/XXXXX/git/Demo/DotNetCoreLinux1. [/code] 初めて</strong>dotnet new**した場合は、環境の初期化が実行されます。 以降は表示されません。 これにより、プロジェクトフォルダ配下に</p><ul><li><strong>Program.cs</strong></li><li><strong>project.json</strong></li></ul><p>が生成されます。 なお、<strong>project.json</strong>によるプロジェクト管理は、.NET Core 2.0から廃止が決定されています。 下記では、.NET Core 2.0のプレビュー利用しました。作成されたのは、<strong>corecli.csproj</strong>という見慣れた拡張子でした。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2017/04/23/visual-studio-code%E3%81%A7%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B-by-net-core-2-0-preview/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">.NET Core 2.0 PreviewとVisual Studio Codeでコンソールアプリをつくる 準備&amp;作成編 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2017/04/23/visual-studio-code%E3%81%A7%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B-by-net-core-2-0-preview/</div></div></div></div></a></div></div><p>なので、正直、.NET Core 1.1系で勉強する意味は無いのですが、Linux初心者な自分にとっては、Linuxを使って何かをなすことが大事なので無視します。 ですが、2017/05/16に.NET Core 2.0の正式なプレビューがリリースされました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.infoq.com/jp/news/2017/05/netcore2preview?utm_campaign=rightbar_v2&utm_source=infoq&utm_medium=news_link&utm_content=link_text" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.infoq.com"></img><div class="hbc-site-name">InfoQ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn.infoq.com/statics_s2_20201020-0324/styles/static/images/logo/logo-big.jpg"></img></div><div class="hbc-text"><div class="hbc-title">.NET Core 2.0 Previewリリース、Visual Basicをサポート </div><div class="hbc-url">https://www.infoq.com/jp/news/2017/05/netcore2preview?utm_campaign=rightbar_v2&utm_source=infoq&utm_medium=news_link&utm_content=link_text</div><div class="hbc-description">Microsoftが.NET Core 2 Preview 1のリリースを発表した。.NET Standard 2準拠になり、はじめてVisual Basicをサポートする。</div></div></div></div></a></div></div><p>なので、RHELでのサポートも近いでしょう。</p><h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>準備が出来ました。 プロジェクトの作成が出来たので、ビルドして実行します。 単純にHello, Worldと表示されるだけですが、重要なのは、環境構築ができており、.NET Coreを使ったプログラミングが可能であることの確認です。 まず、下記のコマンドを実行し、リストアします。 newした直後は、最低限しかファイルが内ので、nugetのリストアみたいに依存関係にあるライブラリの復元を行います。 [code lang=”sh”] $ dotnet restore log : Restoring packages for /home/XXXXXX/git/Demo/DotNetCoreLinux1/project.json… log : Installing System.Reflection.Metadata 1.4.1. log : Installing System.Collections.Immutable 1.3.0. log : Writing lock file to disk. Path: /home/XXXXXX/git/Demo/DotNetCoreLinux1/project.lock.json log : /home/XXXXXX/git/Demo/DotNetCoreLinux1/project.json log : Restore completed in 6214ms. [/code] 続いてビルドします。 [code lang=”sh”] $ dotnet build Project DotNetCoreLinux1 (.NETCoreApp,Version=v1.1) will be compiled because expected outputs are missing Compiling DotNetCoreLinux1 for .NETCoreApp,Version=v1.1<br>Compilation succeeded. 0 Warning(s) 0 Error(s)<br>Time elapsed 00:00:04.7665117 [/code]</p><h1 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h1><p>エラーがないので、実行します。 [code lang=”sh”] $ dotnet run Project DotNetCoreLinux1 (.NETCoreApp,Version=v1.1) was previously compiled. Skipping compilation. Hello World! [/code] 予想通りの結果です。 ちなみに、プロジェクトフォルダ直下で<strong>dotnet run</strong>ではなく、次のように、実際のバイナリがあるフォルダで実行も出来ます。 [code lang=”sh”] $ cd bin/Debug/netcoreapp1.1/ $ dotnet DotNetCoreLinux1.dll Hello World! [/code] dllとなっていますが、実行ファイルです。 [code lang=”sh”] $ file DotNetCoreLinux1.dll DotNetCoreLinux1.dll: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows [/code]</p><h1 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h1><p>まず、コンソールが問題ないことがわかりましたので、プロジェクトフォルダをVisual Studio Codeで開きます。 <strong>ファイル</strong>-&gt;<strong>フォルダーを開く</strong>で開くことが可能です。<br><a href="../../../../public/2017/05/acf0aa975f917842a79926093b3c5a06.png"><img src="../../../../public/2017/05/acf0aa975f917842a79926093b3c5a06-1024x693.png"></a></p><p>プロジェクトを開いた状態です。<br><a href="../../../../public/2017/05/a718a47a917da9d8d467c357bcfca2fd.png"><img src="../../../../public/2017/05/a718a47a917da9d8d467c357bcfca2fd-1024x693.png"></a></p><p><strong>Program.cs</strong>を選択し、実行可能行の左端をクリックするか、実行可能業にカーソルを置いて<strong>F9</strong>を押下して、ブレークポイントを貼ります。 Visual Studioと同じ操作です。<br><a href="../../../../public/2017/05/30e54297a4a7544fa6afe22d31b30764.png"><img src="../../../../public/2017/05/30e54297a4a7544fa6afe22d31b30764-1024x348.png"></a></p><p><strong>F5</strong>を押下してデバッグ実行します。 こちらもVisual Studioと同じ操作です。 しかし、実行できません。 よく見ると、ビルドとデバッグに必要なアセットが見つからないので、追加するかを尋ねられますので、<strong>Yes</strong>と応えます。 こういう細かいところはまだ日本語化されていない模様。<br><a href="../../../../public/2017/05/18e08add50c45088bc6ffa63d667d979.png"><img src="../../../../public/2017/05/18e08add50c45088bc6ffa63d667d979-1024x118.png"></a></p><p>再度実行すると、成功し、ブレークポイントで実行が停止しているのがわかります。<br><a href="../../../../public/2017/05/f5afce25449a3051fd438caf8a5a942e.png"><img src="../../../../public/2017/05/f5afce25449a3051fd438caf8a5a942e-1024x693.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Dockerのようなコンテナでは無く、自分で構築したOS上に、自分で.NET Coreをインストールし、CUI、GUI上で実行、デバッグまで出来るようになりました。 次は何か小さなツールを作ってみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> Visual Studio Code </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる Visual Studio Code編 第0回</title>
      <link href="/2017/05/22/2366/"/>
      <url>/2017/05/22/2366/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>.NET Core</strong>をDocker経由で動かしたりしました。 </p><p>ですが、WindowsまたはLinuxの端末上でエディットしてコンパイルするのは面倒だしつまらない。 なので、LinuxのGUI上で開発すればいいじゃん、ということで</p><ul><li><strong>Visual Studio Code</strong></li><li><strong>JetBrains Rider</strong></li></ul><p>の2つに白羽の矢が立ちました。<strong>Eclipse</strong>?知らないなぁ…. 会社でも自由に(コスト的な意味で)使えるVisual Studio Codeを使ってみます。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><h2 id="Install-NET-Core"><a href="#Install-NET-Core" class="headerlink" title="Install .NET Core"></a>Install .NET Core</h2><p>最初にインストールしておくと良いでしょう。 インストールは下記を参照。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2017/05/16/net%e3%81%a7linux%e3%81%a8%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%82%8b-net-core-%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab%e7%b7%a8/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">.NETでLinuxと遊んでみる .NET Core インストール編 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2017/05/16/net%e3%81%a7linux%e3%81%a8%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%82%8b-net-core-%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab%e7%b7%a8/</div></div></div></div></a></div></div><h2 id="Install-Visual-Studio-Code"><a href="#Install-Visual-Studio-Code" class="headerlink" title="Install Visual Studio Code"></a>Install Visual Studio Code</h2><p>まずは、ダウンロード。 2017/05/16の時点でVersion 1.12が最新です。 RHELなので**.rpm**を選択してダウンロードします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://code.visualstudio.com/download" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=code.visualstudio.com"></img><div class="hbc-site-name">code.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://code.visualstudio.com/opengraphimg/opengraph-home.png"></img></div><div class="hbc-text"><div class="hbc-title">Download Visual Studio Code - Mac, Linux, Windows</div><div class="hbc-url">https://code.visualstudio.com/download</div><div class="hbc-description">Visual Studio Code is free and available on your favorite platform - Linux, macOS, and Windows.  Download Visual Studio Code to experience a…</div></div></div></div></a></div></div><p><a href="../../../../public/2017/05/1241cc474517798c2a6951ff0b8a1749.png"><img src="../../../../public/2017/05/1241cc474517798c2a6951ff0b8a1749-1024x590.png"></a> パッケージは不要なので、そのままインストールします。 <a href="../../../../public/2017/05/cde2fc418b0725d0a7a0edb24e3801cd.png"><img src="../../../../public/2017/05/cde2fc418b0725d0a7a0edb24e3801cd.png"></a> <strong>アプリケーションインストーラー</strong>が開くので、<strong>インストール</strong>を押下します。 <a href="../../../../public/2017/05/b39d02f69ea1721313814d90e47611bf.png"><img src="../../../../public/2017/05/b39d02f69ea1721313814d90e47611bf-1024x266.png"></a> 認証を実行します。 <a href="../../../../public/2017/05/5c678fb5aa14f9c3fd8ab09bc9df11d7.png"><img src="../../../../public/2017/05/5c678fb5aa14f9c3fd8ab09bc9df11d7.png"></a> 暫くすると、インストールが完了します。 アプリケーションインストーラーは終了してもOKです。 端末を開きます。 Visual Studio Codeは下記のコマンドで実行できます。 [code lang=”sh”] $ /usr/bin/code [/code] 実行すると次の初期画面が表示されます。 <a href="../../../../public/2017/05/93c81037c58d1a33e07eee4b72dabd1a.png"><img src="../../../../public/2017/05/93c81037c58d1a33e07eee4b72dabd1a-1024x693.png"></a></p><h2 id="Install-Plugins"><a href="#Install-Plugins" class="headerlink" title="Install Plugins"></a>Install Plugins</h2><p>Visual Studio Codeは拡張機能をインストールすることで真価を発揮します。 下記の拡張機能をインストールします。</p><h3 id="C-拡張"><a href="#C-拡張" class="headerlink" title="C## 拡張"></a>C## 拡張</h3><p>Microsoft製の純正拡張機能です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ms-dotnettools.gallerycdn.vsassets.io/extensions/ms-dotnettools/csharp/1.23.6/1605311230265/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">C# - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp</div><div class="hbc-description">Extension for Visual Studio Code - C# for Visual Studio Code (powered by OmniSharp).</div></div></div></div></a></div></div><h3 id="VSCode-Icons"><a href="#VSCode-Icons" class="headerlink" title="VSCode-Icons"></a>VSCode-Icons</h3><p>UI中のアイコン表示を増やして、綺麗にしてくれます。別に無くてもいいんですが、使っていて楽しいUIは重要です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=marketplace.visualstudio.com"></img><div class="hbc-site-name">marketplace.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://vscode-icons-team.gallerycdn.vsassets.io/extensions/vscode-icons-team/vscode-icons/11.0.0/1600368328068/Microsoft.VisualStudio.Services.Icons.Default"></img></div><div class="hbc-text"><div class="hbc-title">vscode-icons - Visual Studio Marketplace</div><div class="hbc-url">https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons</div><div class="hbc-description">Extension for Visual Studio Code - Icons for Visual Studio Code</div></div></div></div></a></div></div><p>インストールは簡単です。</p><p>まず、<strong>Ctrl+P</strong>でクイックオープンを開きます。<br><a href="../../../../public/2017/05/f9476fe637ae01ba374d9ebcf03123f3.png"><img src="../../../../public/2017/05/f9476fe637ae01ba374d9ebcf03123f3-1024x170.png"></a></p><p>次に、下記のコマンドを一つずつ入力しEnterを押下します。 [code lang=”sh”] ext install csharp ext install vscode-icons [/code] すると、該当する拡張機能が、左側に表示される拡張機能ペインの先頭に表示されますので、<strong>インストール</strong>を押下します。<br><a href="../../../../public/2017/05/cdd22dc1f6fbc661fe550ca947ca6d7d.png"><img src="../../../../public/2017/05/cdd22dc1f6fbc661fe550ca947ca6d7d-1024x283.png"></a></p><p><strong>VSCode-icons</strong>は設定で別途有効にする必要があります。 まず、<strong>ファイル</strong>-&gt;<strong>基本設定</strong>-&gt;<strong>ファイルアイコンのテーマ</strong>を選択します。<br><a href="../../../../public/2017/05/46fe0c66dd1748dbe0603c131963d674.png"><img src="../../../../public/2017/05/46fe0c66dd1748dbe0603c131963d674-1024x472.png"></a></p><p>そして表示されるリストから<strong>VSCode Icons</strong>を選択します。<br><a href="../../../../public/2017/05/203add4c18763b1ef60bc309779cf17a.png"><img src="../../../../public/2017/05/203add4c18763b1ef60bc309779cf17a-1024x250.png"></a><br> 以上で完了です。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回は導入のみ。 次回は、プロジェクトを作ってサンプルを実行してみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> Visual Studio Code </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる JetBrains Rider編 第1回</title>
      <link href="/2017/05/22/2350/"/>
      <url>/2017/05/22/2350/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は<strong>JetBrains Rider 2017.1</strong>をインストールしました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://taktak.jp/2017/08/10/net%e3%81%a7linux%e3%81%a8%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%82%8b-jetbrains-rider%e7%b7%a8-%e7%ac%ac0-5%e5%9b%9e/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=taktak.jp"></img><div class="hbc-site-name">taktak.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">.NETでLinuxと遊んでみる JetBrains Rider編 第0.5回 – A certain engineer &quot;COMPLEX&quot;</div><div class="hbc-url">https://taktak.jp/2017/08/10/net%e3%81%a7linux%e3%81%a8%e9%81%8a%e3%82%93%e3%81%a7%e3%81%bf%e3%82%8b-jetbrains-rider%e7%b7%a8-%e7%ac%ac0-5%e5%9b%9e/</div></div></div></div></a></div></div><p>今回はプロジェクトを作成します。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>まずはRiderを起動し、<strong>New solution</strong>を選択。<br><a href="../../../../public/2017/05/7cfeff4406b5f875ee1fc04c0c688b3b.png"><img src="../../../../public/2017/05/7cfeff4406b5f875ee1fc04c0c688b3b.png"></a></p><p>プロジェクトの作成ダイアログが表示されます。<br><a href="../../../../public/2017/05/621e54d42676e3a41e502043def15564.png"><img src="../../../../public/2017/05/621e54d42676e3a41e502043def15564.png"></a></p><p><strong>.NET Core Project</strong>を選択します。 しかし、.NET Coreがインストールされていないことが通知されますので、Riderを終了して、.NET Coreをインストールします。<br><a href="../../../../public/2017/05/b10f28f4052643d32e72fd0bf4acff80.png"><img src="../../../../public/2017/05/b10f28f4052643d32e72fd0bf4acff80.png"></a></p><p>表示されていた<a href="https://www.microsoft.com/net/download/core">https://www.microsoft.com/net/download/core</a>に移動し、Linuxへのインストール方法をチェックします。</p><h2 id="Install-NET-Core"><a href="#Install-NET-Core" class="headerlink" title="Install .NET Core"></a>Install .NET Core</h2><p>RHELへのパッケージインストール方法が記載されていますので、その通り実行します。 しかし 結論から言えば、<a href="https://www.microsoft.com/net/download/core">https://www.microsoft.com/net/download/core</a>では、ダメです。 例えば、インストールコマンドを入力すると、 [code lang=”sh”] $ sudo yum install rh-dotnetcore10 読み込んだプラグイン:langpacks, product-id, search-disabled-repos, subscription-manager Repo rhel-rs-for-rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-extras-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-ha-for-rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rt-beta-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-rs-for-rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-ha-for-rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rt-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem <a href="https://cdn.redhat.com/content/beta/rhel/server/7/x86/_64/rt/os/repodata/repomd.xml">https://cdn.redhat.com/content/beta/rhel/server/7/x86\_64/rt/os/repodata/repomd.xml</a>: [Errno 14] curl#58 - “unable to load client key: -8178 (SEC_ERROR_BAD_KEY)” 他のミラーを試します。 警告: 一致するものが見つかりません: dotnetcore No matches found [/code] パッケージが見つかりません。 実は、RHELの場合、これだけではダメで、サブスクリプションを再登録し、リポジトリへ.NET Coreのチャネルを登録する必要があります。 <a href="https://access.redhat.com/documentation/en-us/net_core/1.0/html/getting_started_guide/gs_install_dotnet">CHAPTER 1. INSTALL .NET CORE 1.0 ON RED HAT ENTERPRISE LINUX</a> また、Riderが対応する.NET Coreは1.1です。 これを踏まえて説明します。</p><h3 id="サブスクリプションの再登録"><a href="#サブスクリプションの再登録" class="headerlink" title="サブスクリプションの再登録"></a>サブスクリプションの再登録</h3><p>[code lang=”sh”] $ subscription-manager unregister $ subscription-manager clean # RedHatのアカウントを入力 $ subscription-manager register 登録中: subscription.rhsm.redhat.com:443/subscription ユーザー名: <a href="mailto:&#88;&#88;&#x58;&#x40;&#89;&#89;&#89;&#x2e;&#x5a;&#90;&#x5a;">&#88;&#88;&#x58;&#x40;&#89;&#89;&#89;&#x2e;&#x5a;&#90;&#x5a;</a> パスワード: このシステムは次の ID で登録されました: XXXXXXXX-YYYY-ZZZZ-AAAA-BBBBCCCCDDDD # 日本語環境なら、subscription-manager list –available | egrep “サブスクリプション名|プール ID” $ subscription-manager list –available | egrep “Subscription Name|Pool” サブスクリプション名: Red Hat Enterprise Linux Developer Suite プール ID: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX subscription-manager attach –pool=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX サブスクリプションが正しく割り当てられました: Red Hat Enterprise Linux Developer Suite [/code]</p><h3 id="リポジトリの登録"><a href="#リポジトリの登録" class="headerlink" title="リポジトリの登録"></a>リポジトリの登録</h3><p>[code lang=”sh”] # workstationなら -server- を -workstation- に変更 $ subscription-manager repos –enable=rhel-7-server-dotnet-rpms # ついでにベータのリポジトリを無効 $ subscription-manager repos –disable=rhel-7-server-rt-beta-rpms [/code]</p><h3 id="scl-utilsのインストール"><a href="#scl-utilsのインストール" class="headerlink" title="scl-utilsのインストール"></a>scl-utilsのインストール</h3><p>[code lang=”sh”] $ yum install scl-utils [/code]</p><h3 id="NET-Coreのインストール"><a href="#NET-Coreのインストール" class="headerlink" title=".NET Coreのインストール"></a>.NET Coreのインストール</h3><p>.NET Core 1.1をインストールします。</p><ul><li>誤) <strong>dotnetcore10</strong></li><li>正) <strong>dotnetcore11</strong></li></ul><p>です。 [code lang=”sh”] $ yum install rh-dotnetcore11 -y [/code]</p><h3 id="NET-Coreの有効化"><a href="#NET-Coreの有効化" class="headerlink" title=".NET Coreの有効化"></a>.NET Coreの有効化</h3><p>まだこの状態では.NET Coreは使えません。下記のコマンドを実行して、.NET Coreを有効化します。 [code lang=”sh”] $ scl enable rh-dotnetcore11 bash [/code] 上記コマンド実行後、同一のシェルのみで、<strong>dotnet</strong>が使えます。 逆を言えば、別のシェルを立ち上げても、<strong>dotnet</strong>は使えません。 毎回、上記コマンドを実行するのは面倒なので、 [code lang=”sh”] $ source scl_source enable rh-dotnetcore11 [/code] を実行すれば良い、と前述のRedhatのページに書いてあるのですが、何故か効果がありません。 なので、シェルを立ち上げる際に、毎回自動で実行されるよう、**~/.bashrc**にコマンドを追記します。 [code lang=”sh”] $ su - $ vi ~/.bashrc [/code] viを起動し、末尾に [code lang=”sh”] source scl_source enable rh-dotnetcore10 [/code] を追記します。 そして、シェルを立ち上げ直して、dotnetのバージョンを確認します。 [code lang=”sh”] $ dotnet –version 1.0.0-preview2-1-003177 [/code]</p><h2 id="Install-Mono"><a href="#Install-Mono" class="headerlink" title="Install Mono"></a>Install Mono</h2><h3 id="Extra-Packages-for-Enterprise-Linuxの追加"><a href="#Extra-Packages-for-Enterprise-Linuxの追加" class="headerlink" title="Extra Packages for Enterprise Linuxの追加"></a>Extra Packages for Enterprise Linuxの追加</h3><p>[code lang=”sh”] $ cd ~/ $ wget <a href="http://ftp-srv2.kddilabs.jp/Linux/distributions/fedora/epel/7/x86/_64/e/epel-release-7-9.noarch.rpm">http://ftp-srv2.kddilabs.jp/Linux/distributions/fedora/epel/7/x86\_64/e/epel-release-7-9.noarch.rpm</a> $ rpm -ivh epel-release-7-9.noarch.rpm $ rm epel-release-7-9.noarch.rpm [/code]</p><h1 id="yum-install-yum-utils"><a href="#yum-install-yum-utils" class="headerlink" title="yum install yum-utils"></a>yum install yum-utils</h1><h4 id="Mono-4-8"><a href="#Mono-4-8" class="headerlink" title="Mono 4.8"></a>Mono 4.8</h4><p>[code lang=”sh”] # rpm –import “<a href="http://keyserver.ubuntu.com/pks/lookup?op=get&amp;search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF&quot;">http://keyserver.ubuntu.com/pks/lookup?op=get&amp;search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF&quot;</a> # yum-config-manager –add-repo <a href="http://download.mono-project.com/repo/centos/">http://download.mono-project.com/repo/centos/</a> [/code]</p><h4 id="Mono-5-0"><a href="#Mono-5-0" class="headerlink" title="Mono 5.0"></a>Mono 5.0</h4><p>[code lang=”sh”] # rpm –import “<a href="http://keyserver.ubuntu.com/pks/lookup?op=get&amp;search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF&quot;">http://keyserver.ubuntu.com/pks/lookup?op=get&amp;search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF&quot;</a> # yum-config-manager –add-repo <a href="http://download.mono-project.com/repo/centos7/">http://download.mono-project.com/repo/centos7/</a> [/code]</p><h3 id="Mono"><a href="#Mono" class="headerlink" title="Mono"></a>Mono</h3><p>[code lang=”sh”] yum install mono-complete -y<br>mono –version Mono JIT compiler version 5.0.0 (Stable 5.0.0.100/9667aa6 Thu May 11 10:16:39 UTC 2017) Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. <a href="http://www.mono-project.com/">www.mono-project.com</a> TLS: __thread SIGSEGV: altstack Notifications: epoll Architecture: amd64 Disabled: none Misc: softdebug LLVM: supported, not enabled. GC: sgen (concurrent by default) [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> net-framework </category>
          
          <category> linux </category>
          
          <category> .NET Framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> net </category>
          
          <category> JetBrains </category>
          
          <category> .NET Core </category>
          
          <category> .NETでLinuxと遊んでみる </category>
          
          <category> jetbrains </category>
          
          <category> Rider </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その70 Red Hat Enterprise Linux 7.3で端末での大文字小文字区別を無効にする</title>
      <link href="/2017/05/16/2387/"/>
      <url>/2017/05/16/2387/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Linuxだと、端末(CUI)で入力中、ファイルやフォルダ名等、現在の入力から推測できる候補をTabキーで切り替えることができます。 けど、大文字小文字を区別するため、例えば</p><ul><li>test.txt</li><li>Test1.txt</li></ul><p>というファイルが存在したとして、 [code lang=”sh”] $ cp t [/code] という状態でTabキーを押下しても、表示されるのは<strong>test.txt</strong>だけです。 結構不便なので、対応したメモです。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>対応は簡単です。 [code lang=”sh”] $ vi ~/.inputrc [/code] でviを起動し、下記の一文を末尾に追加します。 ファイルが存在しなくてもそのまま作成して問題ありません。 [code] set completion-ignore-case on [/code] これで、そのホームディレクトリのユーザでは、TAbキー補完において、大文字小文字の区別が無くなります。 設定を有効にするために再度ログインか、端末上で、<strong>CTRL+X、CTRL+R</strong>を連続で押下する必要があります。 全ユーザに対して、大文字小文字の区別をなくす場合は、 [code lang=”sh”] $ sudo vi /etc/inputrc [/code] で同様に記述を追記します。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでLinuxと遊んでみる .NET Core インストール編</title>
      <link href="/2017/05/16/2372/"/>
      <url>/2017/05/16/2372/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>.NET Core</strong>をDocker経由で動かしたりしました。 </p><p>今回はGUIで動かしたいですし、きちんとホストOSに環境を構築します。 対象は<strong>Redhat Enterprise Linux 7.3</strong>です。</p><h1 id="Install-NET-Core"><a href="#Install-NET-Core" class="headerlink" title="Install .NET Core"></a>Install .NET Core</h1><p>結論から良うと、2017/05/16の時点で、<a href="https://www.microsoft.com/net/download/core">.NET Coreの公式ページ</a>のRHELへのインストール手順は動きません。 コマンド自体は間違っていませんが、</p><ul><li>コマンドが古い<ul><li>.NET Core 1.0がインストールされてしまう</li></ul></li><li>パッケージが見つからない<ul><li>RHELは下準備が必要</li></ul></li></ul><p>なのです。 実際に、インストールコマンドを入力すると、 [code lang=”sh”] $ sudo yum install rh-dotnetcore10 読み込んだプラグイン:langpacks, product-id, search-disabled-repos, subscription-manager Repo rhel-rs-for-rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-extras-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-ha-for-rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rt-beta-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-rs-for-rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-ha-for-rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rt-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem <a href="https://cdn.redhat.com/content/beta/rhel/server/7/x86/_64/rt/os/repodata/repomd.xml">https://cdn.redhat.com/content/beta/rhel/server/7/x86\_64/rt/os/repodata/repomd.xml</a>: [Errno 14] curl#58 - “unable to load client key: -8178 (SEC_ERROR_BAD_KEY)” 他のミラーを試します。 警告: 一致するものが見つかりません: dotnetcore No matches found [/code] となります。 RHELの場合、サブスクリプションを再登録し、リポジトリへ.NET Coreのチャネルを登録する必要があります。 <a href="https://access.redhat.com/documentation/en-us/net_core/1.0/html/getting_started_guide/gs_install_dotnet">CHAPTER 1. INSTALL .NET CORE 1.0 ON RED HAT ENTERPRISE LINUX</a></p><h3 id="サブスクリプションの再登録"><a href="#サブスクリプションの再登録" class="headerlink" title="サブスクリプションの再登録"></a>サブスクリプションの再登録</h3><p>[code lang=”sh”] $ subscription-manager unregister $ subscription-manager clean # RedHatのアカウントを入力 $ subscription-manager register 登録中: subscription.rhsm.redhat.com:443/subscription ユーザー名: <a href="mailto:&#x58;&#88;&#88;&#64;&#x59;&#89;&#89;&#46;&#x5a;&#90;&#x5a;">&#x58;&#88;&#88;&#64;&#x59;&#89;&#89;&#46;&#x5a;&#90;&#x5a;</a> パスワード: このシステムは次の ID で登録されました: XXXXXXXX-YYYY-ZZZZ-AAAA-BBBBCCCCDDDD # 日本語環境なら、subscription-manager list –available | egrep “サブスクリプション名|プール ID” $ subscription-manager list –available | egrep “Subscription Name|Pool” サブスクリプション名: Red Hat Enterprise Linux Developer Suite プール ID: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX subscription-manager attach –pool=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX サブスクリプションが正しく割り当てられました: Red Hat Enterprise Linux Developer Suite [/code]</p><h3 id="リポジトリの登録"><a href="#リポジトリの登録" class="headerlink" title="リポジトリの登録"></a>リポジトリの登録</h3><p>[code lang=”sh”] # workstationなら -server- を -workstation- に変更 $ subscription-manager repos –enable=rhel-7-server-dotnet-rpms # ついでにベータのリポジトリを無効 $ subscription-manager repos –disable=rhel-7-server-rt-beta-rpms [/code]</p><h3 id="scl-utilsのインストール"><a href="#scl-utilsのインストール" class="headerlink" title="scl-utilsのインストール"></a>scl-utilsのインストール</h3><p>[code lang=”sh”] $ yum install scl-utils [/code]</p><h3 id="NET-Coreのインストール"><a href="#NET-Coreのインストール" class="headerlink" title=".NET Coreのインストール"></a>.NET Coreのインストール</h3><p>.NET Core 1.1をインストールします。</p><ul><li>誤) <strong>dotnetcore10</strong></li><li>正) <strong>dotnetcore11</strong></li></ul><p>です。 [code lang=”sh”] $ yum install rh-dotnetcore11 -y [/code]</p><h3 id="NET-Coreの有効化"><a href="#NET-Coreの有効化" class="headerlink" title=".NET Coreの有効化"></a>.NET Coreの有効化</h3><p>まだこの状態では.NET Coreは使えません。下記のコマンドを実行して、.NET Coreを有効化します。 [code lang=”sh”] $ scl enable rh-dotnetcore11 bash [/code] 上記コマンド実行後、同一のシェルのみで、<strong>dotnet</strong>が使えます。 逆を言えば、別のシェルを立ち上げても、<strong>dotnet</strong>は使えません。 毎回、上記コマンドを実行するのは面倒なので、 [code lang=”sh”] $ source scl_source enable rh-dotnetcore11 [/code] を実行すれば良い、と前述のRedhatのページに書いてあるのですが、何故か効果がありません。 なので、シェルを立ち上げる際に、毎回自動で実行されるよう、**~/.bashrc**にコマンドを追記します。 [code lang=”sh”] $ su - $ vi ~/.bashrc [/code] viを起動し、末尾に [code lang=”sh”] source scl_source enable rh-dotnetcore10 [/code] を追記します。 そして、シェルを立ち上げ直して、dotnetのバージョンを確認します。 [code lang=”sh”] $ dotnet –version 1.0.0-preview2-1-003177 [/code] これで、.NET Coreが利用できるようになりました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>基本となる.NET Coreの導入が完了です。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その69 OpenCV 3.2 with ContribモジュールでInpaintを使用する</title>
      <link href="/2017/05/16/2291/"/>
      <url>/2017/05/16/2291/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>OpenCVSharp</strong>にPull Requestを投げました。 内容は、<strong>OpenCV</strong>の拡張モジュールに含まれる、xphoto内に用意されている<strong>Inpainting</strong>と呼ばれる画像修復関数のOpenCVSharp対応です。 </p><p>そんな画像修復をC++で試してみたメモになります。</p><h2 id="What-is-Inpainting"><a href="#What-is-Inpainting" class="headerlink" title="What is Inpainting?"></a>What is Inpainting?</h2><p>Inpaintingとは聞き慣れない単語ですが、<strong>画像修復</strong>です。 Wikipediaの<a href="https://en.wikipedia.org/wiki/Inpainting">Inpaintingの記事 (英語。日本語記事は無し)</a>によれば</p><blockquote><p>Inpainting is the process of reconstructing lost or deteriorated parts of images and videos. In the museum world, in the case of a valuable painting, this task would be carried out by a skilled art conservator or art restorer. In the digital world, inpainting (also known as image interpolation or video interpolation) refers to the application of sophisticated algorithms to replace lost or corrupted parts of the image data (mainly small regions or to remove small defects).</p></blockquote><blockquote><p>Inpaintingは画像や映像における消失または悪化した部分を再構成する手順である。美術の世界において、価値ある絵画の場合、この仕事は技術的に優れた修復士または美術修復家によって為される。デジタルの世界において、inpainting (画像補間またはビデオ補間とも知られている) は、画像データ (主に小さな領域または小さな結果を取り除くため) の消失または壊れた部分を置換するために洗練されたアルゴリズムのアプリケーションを示している。</p></blockquote><p>とあります。 有名なPhotoshopもこの機能があります。 流石に、Photoshop程の性能はありませんが、適切な場面で用いればOpenCVのInpaintingは威力を発揮します。</p><h2 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use?"></a>How to use?</h2><p>Inpaintingは拡張モジュールにもありますが、通常の<strong>cv名前空間</strong>にも<strong>inpaint関数</strong>があります。 どちらも、修復対象の画像、マスク画像 (8ビットグレイスケール)、出力先画像、パラメータを指定しますが、両者の違いはマスク画像の指定方法とパラメータの有無にあります。</p><ul><li><strong>cv::xphoto::inpaint</strong><ul><li>マスク画像の非0 (通常は輝度値255)を有効な画像領域、0 (つまり黒)を修復対象の領域として扱う</li></ul></li><li><strong>cv::inpaint</strong><ul><li>マスク画像の0 (つまり黒)を有効な画像領域、非0 (通常は輝度値255)を修復対象の領域として扱う</li><li>パラメータとして、</li><li>修復される各点を中心とする近傍円形領域の半径</li><li>修復手法 (INPAINT_NSまたはINPAINT_TELEA) を指定</li></ul></li></ul><p>という違いがあります。 正確には、cv::xphoto::inpaintにも指定できるパラメータはありますが、OpenCV 3.2の時点では利用できるパラメータは1つだけなので、事実上パラメータはありません。 なので、拡張モジュールのcv::xphoto::inpaintは非常に簡単に利用できます。 また、cv::xphoto::inpaintの実装は、<strong>Microsoft Research Asia</strong>の<a href="http://kaiminghe.com/eccv12/index.html">Statistics of Patch Offsets for Image Completion</a>という論文の実装の模様。</p><h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>Inpaintingのアルゴリズムは、近隣の領域の複製になります。 近隣の近似している領域を継ぎ目が自然となるように、補正対象領域のピクセルを置換していきます。 当然、壊れた領域はまわりのピクセルから推測されて複製されるため、そこに存在しないものは修復できません。 例えば、野球選手の背番号が完全に隠れていて、それを補正した場合、正しい背番号は修復できない、ということです。 このケースの場合、ユニフォームの布地の大部分で背番号の部分が補完されるでしょう。</p><h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>下記がサンプルです。 cv::xphoto::inpaintとcv::inpaintを実行し、元画像、マスク画像、修復後の画像を上下に表示して比較します。 [code lang=”c++”] #include “stdafx.h” #include &lt;opencv2/core.hpp&gt; #include &lt;opencv2/highgui.hpp&gt; #include &lt;opencv2/opencv.hpp&gt; #include &lt;opencv2/xphoto.hpp&gt;<br>int main(int argc, const char * argv[]) { // <a href="https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB:Tokyo/_Tower/_and/_around/_Skyscrapers.jpg">https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB:Tokyo\_Tower\_and\_around\_Skyscrapers.jpg</a> auto path = “B:\\300px-Tokyo_Tower_and_around_Skyscrapers.jpg”; auto maskpath = “B:\\300px-Tokyo_Tower_and_around_Skyscrapers_mask.bmp”;<br>auto src = cv::imread(path); auto mask = cv::imread(maskpath, cv::IMREAD_GRAYSCALE); if (mask.channels() != 1) return -1;<br>// xphotoのinpaint cv::Mat dst(src.rows, src.cols, src.type()); cv::xphoto::inpaint(src, mask, dst, cv::xphoto::INPAINT_SHIFTMAP);<br>// 従来のinpaint cv::Mat dst2(src.rows, src.cols, src.type()); cv::Mat mask2(mask.rows, mask.cols, mask.type()); // 従来のinpaintのマスクは白領域が修復対象 cv::bitwise_not(mask, mask2); cv::inpaint(src, mask2, dst2, 3, cv::INPAINT_TELEA);<br>// 元画像、マスク画像、修復後の画像の合成画像 cv::Mat combiend(src.rows * 2, src.cols * 3, src.type());<br>cv::Rect roi_rect; roi_rect.x = 0; roi_rect.y = 0; roi_rect.width = src.cols; roi_rect.height = src.rows;<br>cv::Mat roi_src(combiend, roi_rect); src.copyTo(roi_src);<br>roi_rect.x = src.cols; cv::Mat roi_mask(combiend, roi_rect); cv::Mat colorMask(mask.rows, mask.cols, src.type()); cv::cvtColor(mask, colorMask, cv::COLOR_GRAY2BGR); colorMask.copyTo(roi_mask);<br>roi_rect.x = src.cols * 2; cv::Mat roi_dst(combiend, roi_rect); dst.copyTo(roi_dst);<br>roi_rect.x = 0; roi_rect.y = src.rows; cv::Mat roi_src2(combiend, roi_rect); src.copyTo(roi_src2);<br>roi_rect.x = src.cols; cv::Mat roi_mask2(combiend, roi_rect); cv::Mat colorMask2(mask.rows, mask.cols, src.type()); cv::cvtColor(mask2, colorMask2, cv::COLOR_GRAY2BGR); colorMask2.copyTo(roi_mask2);<br>roi_rect.x = src.cols * 2; cv::Mat roi_dst2(combiend, roi_rect); dst2.copyTo(roi_dst2);<br>cv::namedWindow(“preview”); cv::imshow(“preview”, combiend);<br>cv::waitKey();<br>return 0; } [/code] サンプルでは、Wikipediaの<a href="https://ja.wikipedia.org/wiki/%E6%9D%B1%E4%BA%AC%E3%82%BF%E3%83%AF%E3%83%BC">東京タワーの記事</a>の、ある画像中から東京タワーを除去しています。<br><a href="../../../../public/2017/05/1694ff4ab6d4577d3b03337798861275.png"><img src="../../../../public/2017/05/1694ff4ab6d4577d3b03337798861275.png"></a> 上段がcv::xphoto::inpaint、下段がcv::inpaintを実行した結果になります。 ぱっと見た感じ、cv::xphoto::inpaintは良い感じです。 細かく見ると、付近の建物が複製されているのが目立ちます。 <a href="../../../../public/2017/05/check.png"><img src="../../../../public/2017/05/check.png"></a><br> 一方、cv::inpaintはぼけた感じになってしまいました。 パラメータを調整すれば変わる可能性はあると思いますが、いくつか試してみても、どれも似た感じで大差ありませんでした。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Photoshopが凄すぎるのであって、OSSでここまで実行できるというのは相当凄いことだと実感できます。 流石に、人間の手による修復にはかないませんが、近年のAIやDNNなどで、こうした画像修復の分野も、やがて人間に匹敵する性能を見せることになっていくのでしょう。</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> OpenCV </category>
          
          <category> 画像修復 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その68 Red Hat Enterprise Linux 7.2でGitKrakenを使う</title>
      <link href="/2017/05/15/2344/"/>
      <url>/2017/05/15/2344/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>GitKraken</strong>は美しいUIかつ直感的に利用できる素晴らしいアプリです。 そんなGitKrakenはWindows,Mac,Linuxで動作するクロスプラットフォームなアプリケーションです。 しかし、<a href="https://www.gitkraken.com/download">公式ページのダウンロードページ</a>のLinuxには、</p><ul><li>Linux (*.deb)<ul><li>Ubuntu LTS 12.04+, Debian 8+</li></ul></li><li>Linux (GZip)<ul><li>Ubuntu LTS 12.04+, Debian 8+</li></ul></li></ul><p>と記述されており、RedHat系である<strong>rpm</strong>に関する記述がありません。 ですが、わざわざGZipが用意してあるので、試してみます。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>まずはGZip版をダウンロードします。 2015/05/15の時点で最新版は2.5.0になります。 ダウンロードしたら、端末を開きます。 おそらく、ダウンロードフォルダにダウンロードしたファイルがあるので、ダウンロードフォルダに移動します。 [code lang=”sh”] $ cd ~/ダウンロード $ ls -la 合計 129284 drwxr-xr-x. 2 hogehoge hogehoge 35 5月 14 18:29 . drwx——. 21 hogehoge hogehoge 4096 5月 14 12:32 .. -rw-rw-r–. 1 hogehoge hogehoge 73006182 5月 14 18:29 gitkraken-amd64.tar.gz [/code] 続いてインストール先にファイルを移動します。今回は**/opt<strong>に展開します。 [code lang=”sh”] $ sudo mv gitkraken-amd64.tar.gz /opt $ cd /opt $ sudo tar xfz gitkraken-amd64.tar.gz $ sudo rm gitkraken-amd64.tar.gz $ ls -la drwxr-xr-x. 4 root root 4096 5月 3 00:49 gitkraken [/code] gitkrakenフォルダの中にgitkrakenがあるので実行します。 しかし、下記のエラーが発生します。 [code lang=”sh”] $ cd gitkraken $ sudo ./gitkraken ./gitkraken: error while loading shared libraries: libXss.so.1: cannot open shared object file: No such file or directory [/code] **libXss.so.1</strong>が存在しない模様。 なので、yumでインストールします。 [code lang=”sh”] $ yum search libXss libXScrnSaver.i686 : X.Org X11 libXss runtime library libXScrnSaver.x86_64 : X.Org X11 libXss runtime library [/code] <strong>libXss</strong>は<strong>libXScrnSaver</strong>の模様。今回はx64をインストールします。 [code lang=”sh”] $ sudo yum install libXScrnSaver.x86_64 -y 読み込んだプラグイン:langpacks, product-id, search-disabled-repos, subscription-manager <a href="https://cdn.redhat.com/content/beta/rhel/server/7/x86/_64/rt/os/repodata/repomd.xml">https://cdn.redhat.com/content/beta/rhel/server/7/x86\_64/rt/os/repodata/repomd.xml</a>: [Errno 14] HTTPS Error 403 - Forbidden 他のミラーを試します。 To address this issue please refer to the below knowledge base article<br><a href="https://access.redhat.com/solutions/69319">https://access.redhat.com/solutions/69319</a><br>If above article doesn’t help to resolve this issue please open a ticket with Red Hat Support.<br>依存性の解決をしています –&gt; トランザクションの確認を実行しています。 —&gt; パッケージ libXScrnSaver.x86_64 0:1.2.2-6.1.el7 を インストール –&gt; 依存性解決を終了しました。<br>依存性を解決しました<br>===================================================================================================================================================================================== Package アーキテクチャー バージョン リポジトリー 容量 ===================================================================================================================================================================================== インストール中: libXScrnSaver x86_64 1.2.2-6.1.el7 rhel-7-server-eus-rpms 24 k<br>トランザクションの要約 ===================================================================================================================================================================================== インストール 1 パッケージ<br>総ダウンロード容量: 24 k インストール容量: 40 k Downloading packages: libXScrnSaver-1.2.2-6.1.el7.x86_64.rpm | 24 kB 00:00:03 Running transaction check Running transaction test Transaction test succeeded Running transaction インストール中 : libXScrnSaver-1.2.2-6.1.el7.x86_64 1/1 検証中 : libXScrnSaver-1.2.2-6.1.el7.x86_64 1/1<br>インストール: libXScrnSaver.x86_64 0:1.2.2-6.1.el7<br>完了しました! [/code] もう一度実行します。 スプラッシュスクリーンが起動します。<br><a href="../../../../public/2017/05/62b1497999195e52d4f0e5c88fb9a81c.png"><img src="../../../../public/2017/05/62b1497999195e52d4f0e5c88fb9a81c.png"></a></p><p>起動に成功しました。<br><a href="../../../../public/2017/05/1cbadb78b01adb942c606779b5c093d0.png"><img src="../../../../public/2017/05/1cbadb78b01adb942c606779b5c093d0-1024x693.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> GitKraken </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その67 Red Hat Enterprise Linux 7.2で名前解決が出来ない</title>
      <link href="/2017/05/14/2313/"/>
      <url>/2017/05/14/2313/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>パッケージを最新にしようと思い、 [code lang=”sh”] <a href="https://cdn.redhat.com/content/dist/rhel/server/7/7Server/x86/_64/os/Packages/firefox-52.1.0-2.el7/_3.x86/_64.rpm">https://cdn.redhat.com/content/dist/rhel/server/7/7Server/x86\_64/os/Packages/firefox-52.1.0-2.el7\_3.x86\_64.rpm</a>: [Errno 14] curl#6 - “Could not resolve host: cdn.redhat.com; Unknown error” [/code] ホストが解決できないと言っている。 嫌な予感がして、Firefoxを立ち上げて、<strong><a href="http://www.google.co.jp/">www.google.co.jp</a></strong>にアクセスすると、</p><h3 id="サーバーが見つかりませんでした"><a href="#サーバーが見つかりませんでした" class="headerlink" title="サーバーが見つかりませんでした"></a>サーバーが見つかりませんでした</h3><p>という無慈悲なエラー。 何故?</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>結論から言うと、**/etc/resolv.conf** が勝手に書き換わっており名前解決が出来なくなっていた模様。 どうも、有名な問題らしい。 確かに [code lang=”sh”] $ cat /etc/resolv.conf # Generated by resolvconf [/code] 空になっていた。 いや、そもそも手動で編集した記憶は無いけど。 ともかく、手動でDNSを設定すれば良いらしい。 [code lang=”sh”] $ sudo vi /etc/resolv.conf [/code] で、viを起動し、 [code lang=”vim”] nameserver 8.8.8.8 [/code] を追記した。 疎通確認を実行する。 [code lang=”sh”] $ ping <a href="http://www.google.co.jp/">www.google.co.jp</a> PING <a href="http://www.google.co.jp/">www.google.co.jp</a> (172.217.26.3) 56(84) bytes of data. 64 bytes from nrt20s02-in-f3.1e100.net (172.217.26.3): icmp_seq=1 ttl=55 time=11.3 ms 64 bytes from nrt20s02-in-f3.1e100.net (172.217.26.3): icmp_seq=2 ttl=55 time=13.5 ms 64 bytes from nrt20s02-in-f3.1e100.net (172.217.26.3): icmp_seq=3 ttl=55 time=18.2 ms [/code] 解決!!</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="http://hlis-toproad.com/blog/2014/06/02/254/">[技術]resolv.confが勝手に書き換わる問題</a></li><li><a href="http://blog.netandfield.com/shar/2015/06/resolvconf.html">あり？resolv.conf が初期化されちゃった？？？</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その66 Red Hat Enterprise Linux 7.2のVNC Serverの解像度を変更する</title>
      <link href="/2017/05/14/2297/"/>
      <url>/2017/05/14/2297/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="https://wp.me/p7138e-xx">開発メモ その47 Red Hat Enterprise Linux 7.2にVNC Serverをインストールする</a>で<strong>VNC</strong>をインストールしました。 が、解像度が1024x768という前時代的な解像度で不満が募ったので、その対応メモ。 ググると、Ubuntuだったり、CentOS6 (systemdではなくinit)だったり、なかなかRHEL7またはCentOS7の情報がなくて面倒でした。 VNCの設定は共通なんでしょうけど、そのあたりディストリビューションの差異がどう影響するかわからないから、確実に同じ環境の情報が欲しかった..</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>[code lang=”sh”] $ sudo vi /usr/bin/vncserver [/code] 下記の行を修正します。 [code] $geometry = “1280x1024”; [/code] 修正後、VNCを再起動します。 [code lang=”sh”] $ systemctl restart vncserver@:1.service [/code]</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="http://note.websmil.com/linux/centos/centos7-vnc%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">CentOS7 VNCインストール</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> VNC </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その65 OpenCV 3.2 with ContribモジュールでTrackingを使用する</title>
      <link href="/2017/05/13/2280/"/>
      <url>/2017/05/13/2280/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>OpenCVSharp</strong>にPull Requestを投げました。 内容は、<strong>OpenCV</strong>の拡張モジュールに含まれる、<strong>Tracking</strong>と呼ばれる物体追跡用モジュールのOpenCVSharp対応です。 </p><p>そんな物体追跡をC++で試してみたメモになります。</p><h2 id="What-is-Tracking"><a href="#What-is-Tracking" class="headerlink" title="What is Tracking?"></a>What is Tracking?</h2><p>詳しい理論などは、</p><ul><li><a href="http://news.mynavi.jp/series/cv_future/027/">動く人・物を追跡する(1) - OpenCVによるトラッキング</a></li><li><a href="http://qiita.com/hmichu/items/3615ddcc93851ad59abe">こんなに簡単!? トラッキング</a></li><li><a href="http://irohalog.hatenablog.com/entry/opencv_tracking_api">OpenCV Tracking API について</a></li></ul><p>がわかりやすいです。 ともかく</p><ol><li>画像上の任意矩形を初期位置を設定</li><li>矩形内の特徴を学習</li><li>矩形周辺を探索し移動量推定</li><li>2.から繰り返し</li></ol><p>という流れです。 物体追跡を使えば、現実世界において、通過する車両の数を計算したり出来そうですね。</p><h2 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use?"></a>How to use?</h2><p>Trackingの使い方は非常にシンプルです。</p><ol><li>インスタンスの生成<ul><li>cv::Ptr Tracker::create(const cv::String&amp; trackerType)</li></ul></li><li>インスタンスの初期化<ul><li>bool Tracker::init(const cv::Mat&amp; image, const cv::Rect2d&amp; boundingBox)</li></ul></li><li>更新<ul><li>bool Tracker::update(const cv::Mat&amp; image, cv::Rect2d&amp; boundingBox)</li></ul></li><li>3を繰り返す</li></ol><p>以上です。</p><h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>物体追跡にはいくつかのアルゴリズムが用意されており、先述のインスタンスの生成の際に、文字列としてアルゴリズムを指定します。 OpenCV3.2で利用できるアルゴリズムは</p><ul><li>MIL<ul><li><a href="http://docs.opencv.org/trunk/d0/d26/classcv_1_1TrackerMIL.html">cv::TrackerMIL Class Reference</a></li></ul></li><li>TLD<ul><li><a href="http://docs.opencv.org/trunk/dc/d1c/classcv_1_1TrackerTLD.html">cv::TrackerTLD Class Reference</a></li></ul></li><li>BOOSTING<ul><li><a href="http://docs.opencv.org/trunk/d1/d1a/classcv_1_1TrackerBoosting.html">cv::TrackerBoosting Class Reference</a></li></ul></li><li>KCF<ul><li><a href="http://docs.opencv.org/trunk/d2/dff/classcv_1_1TrackerKCF.html">cv::TrackerKCF Class Reference</a></li></ul></li><li>MEDIANFLOW<ul><li><a href="http://docs.opencv.org/trunk/d7/d86/classcv_1_1TrackerMedianFlow.html">cv::TrackerMedianFlow Class Reference</a></li></ul></li><li>GOTURN<ul><li><a href="http://docs.opencv.org/trunk/d7/d4c/classcv_1_1TrackerGOTURN.html">cv::TrackerGOTURN Class Reference</a></li></ul></li></ul><p>の6つになります。 ただし、<strong>GOTURN</strong>は、Caffeを利用しており、入力として、<strong>goturn.prototxt</strong>と<strong>goturn.caffemodel</strong>を実行フォルダに展開する必要があります。 さもなくば、</p><blockquote><p>OpenCV Error: Unspecified error (FAILED: fs.is_open(). Can’t open “goturn.prototxt”) in cv::dnn::ReadProtoFromTextFile, file D:\Works\Lib\OpenCV\src\opencv_contrib-3.2.0\modules\dnn\src\caffe\caffe_io.cpp, line 1077 D:\Works\Lib\OpenCV\src\opencv_contrib-3.2.0\modules\dnn\src\caffe\caffe_io.cpp:1077: error: (-2) FAILED: fs.is_open(). Can’t open “goturn.prototxt” in function cv::dnn::ReadProtoFromTextFile</p></blockquote><blockquote><p>OpenCV Error: Unspecified error (FAILED: fs.is_open(). Can’t open “goturn.caffemodel”) in cv::dnn::ReadProtoFromBinaryFile, file D:\Works\Lib\OpenCV\src\opencv_contrib-3.2.0\modules\dnn\src\caffe\caffe_io.cpp, line 1086 D:\Works\Lib\OpenCV\src\opencv_contrib-3.2.0\modules\dnn\src\caffe\caffe_io.cpp:1086: error: (-2) FAILED: fs.is_open(). Can’t open “goturn.caffemodel” in function cv::dnn::ReadProtoFromBinaryFile</p></blockquote><p>というエラーが発生します。 入手先は下記の2箇所になります。</p><ol><li>Train you own GOTURN model using<ul><li><a href="https://github.com/Auron-X/GOTURN_Training_Toolkit">https://github.com/Auron-X/GOTURN_Training_Toolkit</a></li></ul></li><li>Download pretrained caffemodel<ul><li><a href="https://github.com/opencv/opencv_extra">https://github.com/opencv/opencv_extra</a></li></ul></li></ol><p>ただ、上記2つを見てもそれらしいのはありませんし、protoxtxtやcaffemodelの名前を変更して実行してもエラーになったりして試すことが出来ませんでした。</p><blockquote><p>OpenCV Error: Requested object was not found (Requested blob “.data1” not found) in cv::dnn::Net::setBlob, file D:\Works\Lib\OpenCV\src\opencv_contrib-.2.0\modules\dnn\src\dnn.cpp, line 516</p></blockquote><p>とりあえず、今回は、GOTURN以外を試しました。</p><h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>下記がサンプルです。 [code lang=”cpp”] #include “stdafx.h” #include &lt;opencv2/core.hpp&gt; #include &lt;opencv2/highgui.hpp&gt; #include &lt;opencv2/opencv.hpp&gt; #include &lt;opencv2/tracking.hpp&gt;<br>int main(int argc, const char * argv[]) { // <a href="https://www.youtube.com/watch?v=QAYX9MZ77w8">https://www.youtube.com/watch?v=QAYX9MZ77w8</a> auto path = “B:\\poochy_yoshis_woolly_world.mp4”; cv::VideoCapture vc(path); if (!vc.isOpened()) return -1;<br>cv::Mat img; vc &gt;&gt; img; if (img.empty()) return -1;<br>// 横方向の画像数 const int cols = 3;<br>const int cnt = 5; cv::String trakerTypes[cnt]; cv::Rect2d rois[cnt]; cv::Ptr<a href="cv::Tracker">cv::Tracker</a> trackers[cnt];<br>// Trackerの設定 trakerTypes[0] = cv::String(“KCF”); trakerTypes[1] = cv::String(“MIL”); trakerTypes[2] = cv::String(“MEDIANFLOW”); trakerTypes[3] = cv::String(“TLD”); trakerTypes[4] = cv::String(“BOOSTING”); //trakerTypes[5] = cv::String(“GOTURN”);<br>for(auto index = 0; index &lt; cnt; index++) trackers[index] = cv::Tracker::create(trakerTypes[index]);<br>// 縮小後のサイズ auto ratio = 0.5; const auto iw = img.cols * ratio; const auto ih = img.rows * ratio; const cv::Size size(iw, ih);<br>// 初期位置 const int x = 80; const int y = 60; const int w = 200; const int h = 220; cv::Rect2d roi(x, y, w, h);<br>for (auto index = 0; index &lt; cnt; index++) rois[index] = roi;<br>// 初回フレームの設定 for (auto index = 0; index &lt; cnt; index++) trackers[index]-&gt;init(img, rois[index]);<br>cv::Mat combined_img(cv::Size(iw * cols, ceil(cnt / static_cast<double>(cols)) * ih ), CV_8UC3); cv::namedWindow(“preview”);<br>while (!img.empty()) { cv::Rect roi_rect; roi_rect.width = iw; roi_rect.height = ih; for (auto index = 0; index &lt; cnt; index++) { cv::Mat cloned = img.clone(); roi_rect.x = iw * (index % cols); roi_rect.y = ih * (index / cols);<br>cv::Point p1(rois[index].x, rois[index].y); cv::Point p2(p1.x + rois[index].width, p1.y + rois[index].height); cv::rectangle(cloned, p1, p2, CvScalar(255, 0, 0), 3);<br>cv::putText(cloned, trakerTypes[index], cv::Point(20, 40), cv::FONT_HERSHEY_PLAIN, 2, CvScalar(0, 0, 255), 2);<br>cv::Mat roi(combined_img, roi_rect);<br>cv::Mat resized; cv::resize(cloned, resized, size); resized.copyTo(roi); }<br>cv::imshow(“preview”, combined_img);<br>// ESC key check auto key = static_cast<char>(cv::waitKey(30)); if (key == 27) break;<br>vc &gt;&gt; img; if (img.empty() || vc.get(CV_CAP_PROP_POS_AVI_RATIO) == 1) break;<br>for (auto index = 0; index &lt; cnt; index++) trackers[index]-&gt;update(img, rois[index]); } } [/code] これを動かすと、次のようになります。 サンプルとして、<strong>ニンテンドー3DS「ポチと! ヨッシー ウールワールドポチと! ヨッシー ウールワールド」</strong>の任天堂Youtube公式チャンネルから<a href="http://pvhttps//www.youtube.com/watch?v=QAYX9MZ77w8">ポチと! ヨッシー ウールワールド ゲームで見られるアニメ 「かけっこ編」</a>を使っています。 映像中の青ヨッシーを追跡します。 5fpsで録画した上、かなりフレーム数を間引いてGIFアニメにしていますが、アルゴリズム毎の性能はわかると思います。 [video width=”960” height=”390” mp4=”../../../../public/2017/05/anime22.mp4”][/video] 評価としては、下記の感じです。</p><ul><li>MIL<ul><li>やや安定。途中で緑ヨッシーにつられてしまっている。</li></ul></li><li>TLD<ul><li>なんかランダムみたいな感じ</li></ul></li><li>BOOSTING<ul><li>そこそこ安定。ただし、一度青ヨッシーが枠から外れたため、途中で緑ヨッシーを追跡している。</li></ul></li><li>KCF<ul><li>一番安定。ただし、枠外に外れてしまうと追跡できなくなる</li></ul></li><li>MEDIANFLOW<ul><li>まったく動いていない</li></ul></li></ul><p>画像を縮小して高速化も試しています。 まだまだ工夫の余地はあると思いますが、それなりに目的は達成できています。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>いくつか問題はありますが、物体追跡は色々楽しめそうな技術ですね。 画像全体の探索はコストがかかりますが、一度見つかった物体の探索は、物体追跡が一番低コストかもしれません。</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> OpenCV </category>
          
          <category> 物体追跡 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ64 .NET Core SDKの過去バージョンを入手する</title>
      <link href="/2017/05/12/2275/"/>
      <url>/2017/05/12/2275/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://github.com/shimat/opencvsharp">OpenCVSharp</a>をFolkしてPull Requestを投げたりしています。 おかげさまで、追加修正などはありますが、全て受け入れてもらっています。 で、現在のOpenCVSharpは.NET Coreを採用しており、<strong>global.json</strong>を見ると、<strong>1.0.0-preview2-1-003177</strong>を記述されています。 しかし、このバージョンは過去のものになっております。 開発するなら、ここを書き換えて自分がインストールしているバージョンに書き換えます。 ですが、毎回書き換えて、コミットしないように注意するのは、ちょっと面倒です。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>幸いにして、わかりにくいですが過去のバージョンがあります。 <a href="https://github.com/dotnet/core/blob/master/release-notes/download-archive.md">.NET Core Runtime and SDK download archive</a> どうでもいいですが、OpenCVSharpは<strong>1.0.0-preview2-1-003177</strong>を使っていますが、上のページに該当するバージョンがありません。 これ、実は、**.NET Core 1.1.0 SDK Preview 2.1 build 3177<strong>が該当します。 ちゃんとリンク先のページの、</strong>SDK Binaries<strong>をダウンロードすると、</strong>dotnet-dev-win-x64.1.0.0-preview2-1-003177.zip<strong>が入手でき、展開すれば意図したバージョンのSDKが入手できます。 その証拠に展開したファイルをコマンドプロンプトから実行すると表示されるバージョンは、</strong>1.0.0-preview2-1-003177<strong>になっています。 [code lang=”batch”] $ dotnet.exe –version 1.0.0-preview2-1-003177 [/code] 展開したファイル群に含まれる_sdkフォルダ</strong>の中身を、<strong>C:\Program Files\dotnet\sdk_に移動すればインストール完了です。 つまり、</strong>“C:\Program Files\dotnet\sdk\1.0.0-preview2-1-003177\dotnet.dll”**のような構成になれば正解です。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その63 GitLabを始める&amp;GitHubから引っ越し</title>
      <link href="/2017/05/12/2252/"/>
      <url>/2017/05/12/2252/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="http://wp.me/p7138e-zW">開発メモ その61 Visual Studio Team Serviceを始める&amp;Githubから引っ越し</a>にて、**Visual Studio Team Service (以下VSTS)**のアカウントの作成を実施しました。 しかしながら、ものの一時間で使いにくい、という不満が高まってきました。 何が面倒って、</p><ul><li>画面のUIが複雑</li><li>Iterationの概念が複雑</li></ul><p>の2点です。 特に、2つ目。仕事でも使っていましたが、やっぱりダメでした。 Issue作って、アサインしたりするワークフローを回すという作業が非常に面倒です。 個人のプロジェクトで利用するなら、ここまでの複雑なタスク管理は不要なんですよね。</p><h1 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h1><p>なので、Githubに似たサービスを利用することにしました。</p><ul><li>GitLab</li><li>Bitbucket</li><li>GitBucket</li><li>Gitblit</li><li>Gogs</li></ul><p>が調べて存在するサービスです。 今回は知名度が高い<strong>GitLab</strong>を採用することにしました。 ただし、知名度の高さは2017年2月に引き起こしたデータ消失事件も少なからず影響しています。 <a href="https://techcrunch.com/2017/02/01/gitlab-suffers-major-backup-failure-after-data-deletion-incident/">GitLab suffers major backup failure after data deletion incident</a> この件と下記のメリットを考慮して、GitLabの利用を決断しました。</p><ul><li>プライベートリポジトリを無制限に無料で利用できる</li><li>Githubに似たLook and feel</li><li>最悪、GitLabからGithubに戻れる</li></ul><h1 id="Sign-up"><a href="#Sign-up" class="headerlink" title="Sign up"></a>Sign up</h1><p>公式ページは、<a href="https://about.gitlab.com/">https://about.gitlab.com/</a>です。 まず、右上の<strong>Sign Up</strong>を選択します。<br><a href="../../../../public/2017/05/1-2.png"><img src="../../../../public/2017/05/1-2-1024x668.png"></a><br> 次に、<strong>Register</strong>を選択し必要な情報を入力してきます。</p><ul><li>Full name<ul><li>自分の名前を入力します。この名前はユーザ認証に使われません。</li></ul></li><li>Username<ul><li>ユーザ認証に利用するユーザ名</li></ul></li><li>Email<ul><li>GitLabからの連絡や問い合わせに使うメールアドレス。メールアドレスを使ってログインも可能です。</li></ul></li><li>Email confirmation<ul><li>入力したメールアドレスの確認</li></ul></li><li>Password<ul><li>パスワード</li></ul></li></ul><p>入力が完了したら、CAPTCHAのチェックボックスにチェックを入れ、Registerボタンをクリックします。<br><a href="../../../../public/2017/05/2-2.png"><img src="../../../../public/2017/05/2-2-1024x769.png"></a> 確認メールが入力したメールアドレスに送信されますので、メールを確認して登録を終了させます。 <a href="../../../../public/2017/05/3-2.png"><img src="../../../../public/2017/05/3-2-1024x372.png"></a> 登録の確認が完了するとメインページに遷移します。 <a href="../../../../public/2017/05/4-2.png"><img src="../../../../public/2017/05/4-2-1024x488.png"></a><br> これで登録が完了です。</p><h1 id="Import-from-Github"><a href="#Import-from-Github" class="headerlink" title="Import from Github"></a>Import from Github</h1><p>インポートも簡単でした。 まず、上部のバーの**+<strong>ボタンをクリックします。<br><a href="../../../../public/2017/05/5-2.png"><img src="../../../../public/2017/05/5-2-1024x488.png"></a> 続いて、インポート元のプロジェクトを選択します。 今回は</strong>GitHub<strong>を選択。 <a href="../../../../public/2017/05/6-1.png"><img src="../../../../public/2017/05/6-1-1024x728.png"></a> **List your GitHub repositories</strong>をクリックします。 <a href="../../../../public/2017/05/7-1.png"><img src="../../../../public/2017/05/7-1-1024x728.png"></a> GitHubへのログインを済ませ、GitLabとGitHubとの連携を許可します。 <strong>Authorize application</strong>をクリックします。 <a href="../../../../public/2017/05/8.png"><img src="../../../../public/2017/05/8-1024x728.png"></a> GitHub内のprivateを含むプロジェクトの一覧が表示されます。 インポートしたい必要なプロジェクトの右側にある<strong>Import</strong>ボタンをクリックします。 <a href="../../../../public/2017/05/9.png"><img src="../../../../public/2017/05/9-1024x790.png"></a> 暫くすると、インポートが完了します。 <a href="../../../../public/2017/05/12.png"><img src="../../../../public/2017/05/12-1024x741.png"></a> 適当にプロジェクト名をクリックして、インポート結果を確認します。 ソースコードがインポートされていることが確認できます。 <a href="../../../../public/2017/05/10.png"><img src="../../../../public/2017/05/10-955x1024.png"></a> <strong>Visual Studio Team Service</strong>とは異なりIssueもインポートに成功しています。素晴らしい。 <a href="../../../../public/2017/05/11.png"><img src="../../../../public/2017/05/11-1024x948.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>最近のWebサービスは本当に親切ですね。インポートも簡単でした。 これが本当に無料で利用できるなんて、信じられません。 サービス事業者は厳しい競争にさらされてると思いますが、頑張って欲しいです。</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> GitLab </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その62 Visual Studio Team Serviceのアカウントを削除する</title>
      <link href="/2017/05/07/2244/"/>
      <url>/2017/05/07/2244/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="http://wp.me/p7138e-zW">開発メモ その61 Visual Studio Team Serviceを始める&amp;Githubから引っ越し</a>にて、**Visual Studio Team Service (以下VSTS)**のアカウントの作成を実施しました。 しかしながら、その後、既に自分はアカウントを持っていることに気づきました。 ですので、前回作成したアカウントを削除します。</p><h1 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h1><p>削除の手順は、下記の英語ページでしかMSDNに記述されていませんでした。 <a href="https://www.visualstudio.com/en-us/docs/setup-admin/team-services/delete-or-recover-your-account-vs">Delete or recover Visual Studio Team Services account</a> まずは、削除したいアカウントにアクセスし、どれでもよいのでプロジェクトを開きます。 次に、画面上のバーにある歯車にマウスカーソルを合わせます。<br><a href="../../../../public/2017/05/1-1.png"><img src="../../../../public/2017/05/1-1-1024x659.png"></a> カーソルを合わせるとポップアップメニューが出現するので、一番下の<strong>Account settings</strong>を選択します。 <a href="../../../../public/2017/05/2-1.png"><img src="../../../../public/2017/05/2-1-1024x587.png"></a> 続いて、<strong>Settings</strong>タブを選択します。 <a href="../../../../public/2017/05/3-1.png"><img src="../../../../public/2017/05/3-1-1024x613.png"></a> 次に、中央の<strong>Advanced administration tasks</strong>の<strong>Delete Account</strong>をクリックします。 <a href="../../../../public/2017/05/4-1.png"><img src="../../../../public/2017/05/4-1-1024x613.png"></a><br> 削除の確認ダイアログが表示されます。 ダイアログの内容は</p><blockquote><p>アカウントを削除すると、あなたのアカウント({youraccount}.visualstudio.com)内の全てのユーザーは即座にアクセスできなくなります。 お別れするのが残念です。一度アカウントを削除すると90日間はアカウントは無効状態になり、その後永久に削除されます。詳細はdeleting or recovering your accountを見れます。</p></blockquote><p>になります。 削除に必要な下記の情報を入力します。</p><ul><li>削除理由 (オプション)<ul><li>アカウントの削除理由。適当にコンボボックスから選択します。</li></ul></li><li>削除アカウントの確認<ul><li>https://{youraccount}.visualstudio.comの**{youraccount}**部分を入力します</li></ul></li></ul><p><a href="../../../../public/2017/05/5-1.png"><img src="../../../../public/2017/05/5-1-1024x613.png"></a><br> そして、Deleteボタンをクリックすると削除が実行され、VSTSのポータルサイトに遷移します。 以上で削除は完了です。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Team Service </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その61 Visual Studio Team Serviceを始める&amp;Githubから引っ越し</title>
      <link href="/2017/05/07/2228/"/>
      <url>/2017/05/07/2228/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Github</strong>のプライベートリポジトリを利用するには、7ドル/月の利用料が必要になります。 プライベートリポジトリは<strong>Visual Studio Team Service (以下VSTS)**に移動して、Githubの有料プランを解約しようと思います。 勘違いして欲しくないのは、Githubの機能に一切の不満はありません。 プライベートリポジトリの保持のために一定の支出があるのが耐えられないだけなんです。 削れる支出は削るべきです。 また、VSTSを利用するのも、色々なサービスに触れて知見を得るというメリットもあります。 何より、仕事で海外のグループ会社は</strong>Team Foundation Service**を使っているので、その類似サービスであるVSTSを利用する際の学習コストは少なくて済むのでは、という目論見もあります。 注意 VSTSはインターフェイスが全て英語です。</p><h1 id="Sign-up"><a href="#Sign-up" class="headerlink" title="Sign up"></a>Sign up</h1><p>VSTSは5ユーザーまでは無料で利用できます。 つまり個人で利用する分にはリポジトリの個数無制限で無料です。 詳細な利用料金は<a href="https://azure.microsoft.com/ja-jp/pricing/calculator/?service=visual-studio-team-services">利用料金ツール</a>を利用します。 サインアップは簡単です。 <a href="https://www.visualstudio.com/ja/team-services/">Visual Studio Team Services</a>にアクセスして、右上の無料アカウントをクリックします。 なお既にMicrosoftアカウントを保有しているものとします。<br><a href="../../../../public/2017/05/0.png"><img src="../../../../public/2017/05/0-1024x636.png"></a><br> ログイン後、必要な情報を入力していきます。</p><ul><li>覚えやすい名前を選んでください<ul><li>他の利用者と重複しないユニークな名称を利用</li></ul></li><li>コードの管理<ul><li><strong>Git</strong>, <strong>Team Foundation バージョン管理</strong>を選択できます。後から変更できないようです。</li></ul></li><li>プロジェクト名<ul><li>後から変更できますので、慎重になる必要はありません</li></ul></li><li>作業の整理方法 (プロセス)<ul><li><strong>Agile</strong>, <strong>Scrum</strong>, <strong>CMMI</strong>がありますが、後から変更できないようです</li></ul></li><li>ホストする地域<ul><li>どこでも良いですが、これも変更できません。ここはアメリカの信頼性を信じました。</li></ul></li></ul><p><a href="../../../../public/2017/05/1.png"><img src="../../../../public/2017/05/1-1024x708.png"></a> 続行をクリックして、暫くすると次の画面に遷移してプロジェクトの作成とVSTSのアカウント作成が完了します。 <a href="../../../../public/2017/05/2.png"><img src="../../../../public/2017/05/2-1024x663.png"></a></p><h1 id="Import-from-Github"><a href="#Import-from-Github" class="headerlink" title="Import from Github"></a>Import from Github</h1><p>プロジェクトの作成が完了したら、Githubからリポジトリを引っ越しします。 引っ越しは非常に簡単です。 プロジェクトのホームの中央にある<strong>or import a repository</strong>をクリックし、<strong>Import</strong>ボタンをクリックします。<br><a href="../../../../public/2017/05/3.png"><img src="../../../../public/2017/05/3-1024x663.png"></a><br> 表示されるダイアログに必要な事項を入力します。</p><ul><li>Source Type<ul><li><strong>Git</strong>, <strong>VSTS</strong>から選択。今回はGit</li></ul></li><li>Clone URL<ul><li>Githubでリポジトリのトップページのurlを貼り付けるだけです</li></ul></li><li>Requires authorization<ul><li>プライベートリポジトリからのインポートの場合、チェックして次のUsernameとPasswordを入力します。</li></ul></li><li>Username<ul><li>Githubアカウントのユーザ名</li></ul></li><li>Password / PAT<ul><li>Githubアカウントのパスワード</li></ul></li></ul><p><a href="../../../../public/2017/05/4.png"><img src="../../../../public/2017/05/4-1024x663.png"></a> 入力後、Importをクリックすると、インポートが開始されます。 <a href="../../../../public/2017/05/5.png"><img src="../../../../public/2017/05/5-1024x663.png"></a> 暫くしてインポートが完了すると、自動的にコード画面に遷移し、インポートが完了します。 <a href="../../../../public/2017/05/6.png"><img src="../../../../public/2017/05/6-1024x708.png"></a> Historyタブに移動すると、履歴もインポートされていることがわかります。 <a href="../../../../public/2017/05/7.png"><img src="../../../../public/2017/05/7-1024x663.png"></a><br> さすがにIssueはインポートされてはいませんでした。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回のGithubからインポートを実施して、MicrosoftがOSSを初めとする自社製品以外のプロジェクトやソフトウェアと連携を積極的に推進しているという意思を強く感じました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio Team Service </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その60 Visual Studioで.NET Coreの単体テスト実行後dotnet.exeが大量に残る</title>
      <link href="/2017/05/06/2222/"/>
      <url>/2017/05/06/2222/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>更新 (2017/05/07) 本問題は、.NET Coreのバージョンが古いからサポート外、という結果になりIssueはCloseされましたので未解決です <strong>OpenCVSharp</strong>の単体テストを実行後、何気なくタスクマネージャーを見てみたら、<strong>dotnet.exe</strong>が大量に存在していました。<br><a href="../../../../public/2017/05/5e78658974931a18e7029b4a3bf13e03.png"><img src="../../../../public/2017/05/5e78658974931a18e7029b4a3bf13e03-1024x640.png"></a><br> 実行コマンドラインを見てみると、 [code lang=”batch”] “C:\Program Files\dotnet\dotnet.exe” test “&lt;単体テストのプロジェクトフォルダ&gt;\project.json” – port 56300 [/code] となっており、単体テストの実行によって実行されたプロセスのようです。</p><h1 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h1><p>とりあえず原因がわからないので、githubに投げてみました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/dotnet/cli/issues/6528" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/9141961?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">dotnet.exe remains even though Visual Studio unit test finishes · Issue #8217 · dotnet/sdk</div><div class="hbc-url">https://github.com/dotnet/cli/issues/6528</div><div class="hbc-description">Steps to reproduce Do unit test in VS 2015. Target project is *.xproj. And my environmental is dotnet.exe --version 1.0.3 Expected behavior …</div></div></div></div></a></div></div><p>どちらかといえば、Visual Studioのバグな気がするけど、まずは**.NET Command Line Interface**のリポジトリのIssueに。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net </category>
          
          <category> Visual Studio </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OSS IssueReport</title>
      <link href="/2017/05/06/2216/"/>
      <url>/2017/05/06/2216/</url>
      
        <content type="html"><![CDATA[<p>[[“Date”,”Site”,”Url”,”Title”,”Type”,”Result”],[“2017\/05\/06”,”github”,”<a href="%22https://github.com/dotnet/cli/issues/6528%22">https:\/\/github.com\/dotnet\/cli\/issues\/6528&lt;\/a&gt;”,”dotnet.exe remains even though Visual Studio unit test finishes”,”-“,”Open”],[“2017\/03\/30”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/issues/345%22">https:\/\/github.com\/shimat\/opencvsharp\/issues\/345&lt;\/a&gt;”,”FastFeatureDetector does not work”,”-“,”Open”],[“2017\/03\/21”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/issues/329%22">https:\/\/github.com\/shimat\/opencvsharp\/issues\/329&lt;\/a&gt;”,”Mat.Diag(Mat) does not reutrn a square diagonal matrix”,”Bug”,”Close”],[“2016\/03\/24”,”github”,”</a>https:\/\/github.com\/Microsoft\/CNTK\/issues\/224&lt;\/a&gt;”,”Fix Missing api-ms-win-core-path-l1-1-0.dll #224”,”Bug”,”Close”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その59 OpenCV 3.2 with ContribモジュールでArUcoを使用する</title>
      <link href="/2017/05/04/2204/"/>
      <url>/2017/05/04/2204/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>OpenCVSharp</strong>に新しいPull Requestを投げました。 内容は、<strong>OpenCV</strong>の拡張モジュールに含まれる、<strong>ArUco</strong>と呼ばれる拡張現実アプリケーション用の計量ライブラリのOpenCVSharpへの移植です。 移植作業において、P/Invokeを書くことも大変だったのですが、ライブラリそのものの使い方も大変でしたのでメモします。</p><h2 id="What-is-ArUco"><a href="#What-is-ArUco" class="headerlink" title="What is ArUco?"></a>What is ArUco?</h2><p>まず、ArUcoの公式ページは下記のようです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.uco.es/investiga/grupos/ava/node/26" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.uco.es"></img><div class="hbc-site-name">www.uco.es</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title"> ArUco: a minimal library for Augmented Reality applications based on OpenCV | Aplicaciones de la Visión Artificial</div><div class="hbc-url">http://www.uco.es/investiga/grupos/ava/node/26</div></div></div></div></a></div></div><p>ArUcoという名称は、おそらく、<strong>Augmented Reality Universidad de Córdoba</strong>の略なのだと思います。 ucoというは、Universidad de Córdoba、つまりスペインのコルドバ大学のドメインです。</p><h2 id="特徴"><a href="#特徴" class="headerlink" title="特徴"></a>特徴</h2><p>下記は、ArUcoについてのOpenCVの下記のドキュメントページです。 </p><p>そこで、</p><blockquote><p>ArUco markers are binary square fiducial markers that can be used for camera pose estimation. Their main benefit is that their detection is robust, fast and simple. The aruco module includes the detection of these types of markers and the tools to employ them for pose estimation and camera calibration. Also, the ChArUco functionalities combine ArUco markers with traditional chessboards to allow an easy and versatile corner detection. The module also includes the functions to detect ChArUco corners and use them for pose estimation and camera calibration.</p></blockquote><p>AuUcoマーカーはカメラの姿勢推定に用いことが可能な二値化された位置合わせマーカーです。主な利点はそれらの検出がロバスト、高速かつシンプルであることです。 ArUcoモジュールには、これらの種別の検出、姿勢推定とカメラキャリブレーションのためのツールを含みます。 また、ChArUcoの機能は、ArUcoマーカーに従来のチェスボードを組み合わせることで、簡単で多目的に使えるコーナー検出を可能にします。モジュールは、ChArUcoのコーナー検出、それらを使用した姿勢推定とカメラキャリブレーション機能も含みます。 と記述してあります。 とりあえず、位置合わせマーカーが全ての起点となります。 画像中からマーカーを見つけ出し、マーカーの位置関係から、壁や床の向き、角度を計算できる模様。</p><h1 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h1><p>最初に使い方が大変だったと書きましたが、コード自体は大したことがないです。後述のソース見ればわかりますが、マーカーの検出自体は数行です。 何にはまったかというと、</p><ul><li>OpenCVに含まれるサンプル画像は使えない</li><li>辞書が一致しないと検出できない</li></ul><p>とい2点です。</p><h2 id="サンプル画像が使えない"><a href="#サンプル画像が使えない" class="headerlink" title="サンプル画像が使えない"></a>サンプル画像が使えない</h2><p>例えば、<a href="https://github.com/opencv/opencv_contrib/blob/master/modules/aruco/tutorials/aruco_detection/images/singlemarkersoriginal.png">https://github.com/opencv/opencv_contrib/blob/master/modules/aruco/tutorials/aruco_detection/images/singlemarkersoriginal.png</a>というサンプルがあります。OpenCVの公式リポジトリにあるサンプルです。 普通に、この画像を読み込んで、<strong>cv::aruco::detectMarkers</strong>に渡しても何も返ってきません。 どうも、サンプル画像のマーカーは、現行の辞書で生成される画像とは異なる模様。 下記のコミュニティのAnswerでの回答です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://answers.opencv.org/question/92137/valid-marker-ends-up-in-rejected-candidates-with-aruco-marker-detection/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=answers.opencv.org"></img><div class="hbc-site-name">answers.opencv.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Valid marker ends up in rejected candidates with aruco marker detection - OpenCV Q&amp;A Forum</div><div class="hbc-url">http://answers.opencv.org/question/92137/valid-marker-ends-up-in-rejected-candidates-with-aruco-marker-detection/</div><div class="hbc-description">Hello, I am trying to test the basic functionalities with aruco. I have two problems. I am getting an numpad_chunk() : invalid pointer error…</div></div></div></div></a></div></div><p>なので、自分でマーカーを作って、検出しているのが、後述のソースになります。</p><h2 id="辞書が一致しないと検出できない"><a href="#辞書が一致しないと検出できない" class="headerlink" title="辞書が一致しないと検出できない"></a>辞書が一致しないと検出できない</h2><p>これは、考えてみれば当たり前なのですが、マーカーを検出する際、どの辞書を使うかを引数に渡しています。 つまり、検出対象の画像に含まれるマーカーの基になった辞書と、検出に利用する辞書が一致しないと何も検出できません。 これに気づかなかったため、OpenCVSharpに移植する際、P/Invokeの記述ミスやメモリ破壊を疑ってしまい、無駄に時間を消費してしまいました。</p><h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>下記がサンプルです。 [code lang=”cpp”] #include “stdafx.h” #include <iostream> #include <vector> #include &lt;opencv2/core.hpp&gt; #include &lt;opencv2/highgui.hpp&gt; #include &lt;opencv2/aruco.hpp&gt; #include &lt;opencv2/opencv.hpp&gt;<br>int main(int argc, const char * argv[]) { // 共通パラメータ const auto name = cv::aruco::DICT_6X6_250; const auto dictionary = cv::aruco::getPredefinedDictionary(name);<br>// マーカー画像を生成 const auto markerSidePixels = 128; const auto columns = 4; const auto rows = 5; const auto margin = 20;<br>auto width = columns * markerSidePixels + margin * (columns + 1); auto height = rows * markerSidePixels + margin * (rows + 1);<br>auto id = 0; cv::Rect roi(0, 0, markerSidePixels, markerSidePixels); cv::Mat marker(cv::Size(width, height), CV_8UC1, cv::Scalar::all(255));<br>for (auto y = 0; y &lt; rows; y++) { roi.y = y * markerSidePixels + margin * (y + 1);<br>for (auto x = 0; x &lt; columns; x++) { roi.x = x * markerSidePixels + margin * (x + 1);<br>cv::Mat roiMat(marker, roi); cv::Mat markerImage; cv::aruco::drawMarker(dictionary, id++, markerSidePixels, markerImage, 1); markerImage.copyTo(roiMat); } }<br>std::vector<int> markerIds; std::vector&lt;std::vector<a href="cv::Point2f">cv::Point2f</a>&gt; markerCorners, rejectedCandidates; cv::Ptr<a href="cv::aruco::DetectorParameters">cv::aruco::DetectorParameters</a> parameters(new cv::aruco::DetectorParameters());<br>// マーカーの検出 cv::aruco::detectMarkers(marker, dictionary, markerCorners, markerIds, parameters, rejectedCandidates); cv::Mat detected_marker; cv::cvtColor(marker, detected_marker, cv::COLOR_GRAY2RGB); cv::aruco::drawDetectedMarkers(detected_marker, markerCorners, markerIds, CvScalar(255, 0, 0)); // rejectedCandidatesにはidがないのでnoArray cv::aruco::drawDetectedMarkers(detected_marker, rejectedCandidates, cv::noArray(), CvScalar(0, 0, 255));<br>/* 表示 */ cv::namedWindow(“marker”); cv::namedWindow(“detected”); cv::imshow(“marker”, marker); cv::imshow(“detected”, detected_marker); cv::waitKey(0);<br>return 0; } [/code] これを動かすと、次のようになります。 [caption id=”attachment_2209” align=”alignleft” width=”233”]<br><a href="../../../../public/2017/05/0bde279f01158ab3d1847cfeeb476963.png"><img src="../../../../public/2017/05/0bde279f01158ab3d1847cfeeb476963-233x300.png"></a> マーカー画像[/caption] [caption id=”attachment_2210” align=”alignright” width=”233”]<a href="../../../../public/2017/05/e8fc75a46239cd683a875c32097c5b51.png"><img src="../../../../public/2017/05/e8fc75a46239cd683a875c32097c5b51-233x300.png"></a><br> 検出後[/caption]<br>検出後の画像には、マーカーを青で囲んでいます。 赤い領域は、候補として検出されたがマーカーとしては識別されなかった棄却された領域です。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回は歪みもない画像なので検出精度は100%ですが、現実の空間でもきちんとマーカーの位置を検出できます。 マーカーを紙面に印刷し、壁やボードに貼ることで、カメラの位置もわかりますし、付近の物体の位置関係も推定できそうです。</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> OpenCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その58 OpenCV 3.2 with Contribモジュールをスタティックライブラリとしてビルドする</title>
      <link href="/2017/05/04/2202/"/>
      <url>/2017/05/04/2202/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://wp.me/p7138e-zd">開発メモ その55 OpenCV 3.2のContribモジュールをビルドする</a>にて、<strong>OpenCV</strong>を拡張モジュール付きでビルドしましたが、これをスタティックライブラリでビルドする手順のメモ。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p><a href="http://takacity.blog.fc2.com/blog-entry-93.html">C++でOpenCVのフォームアプリを作る(3) - 静的リンク -</a>というそのものズバリなサイトがありました。 <strong>CMake</strong>で<strong>BUILD_SHARED_LIBS</strong>をOFFにすれば、スタティックライブラリとして生成されます。 ソースファイルを下記のように展開したとします。</p><ul><li>c:\src\opencv_contrib-3.2.0<ul><li>doc</li><li>modules</li><li>samples</li><li>…</li></ul></li><li>c:\src\oopencv-3.2.0<ul><li>3rdparty</li><li>apps</li><li>…</li></ul></li></ul><p>この状態で、出力先を<strong>c:\src\opencv-3.2.0\build</strong>とした場合、スタティックライブラリは、<strong>c:\src\opencv-3.2.0\build\lib\Release</strong>または<strong>c:\src\opencv-3.2.0\build\lib\Debug</strong>に出力されます。 つまり、BUILD_SHARED_LIBSを状態に関係なく、同じ場所に出力されます。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> マルチメディア </category>
          
          <category> CMake </category>
          
          <category> OpenCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その57 が見つかりませんでした</title>
      <link href="/2017/05/02/2197/"/>
      <url>/2017/05/02/2197/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>OpenCVSharp</strong>をビルドしようと思ったら、プロジェクトファイルが開けなくなっており、Visual Studio 2015に表示されていたエラーについてのメモ。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="Net-Core-1-0-1-tools-Preview-2-をインストール"><a href="#Net-Core-1-0-1-tools-Preview-2-をインストール" class="headerlink" title=".Net Core 1.0.1 tools Preview 2 をインストール"></a>.Net Core 1.0.1 tools Preview 2 をインストール</h2><p>海外の方が同じ問題に遭遇しておりました。日本語では遭遇例がありませんでした。悲しい。いと悲しい。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://richardleeman.blogspot.jp/2017/02/cprogram-files-x86msbuildmicrosoftvisua.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=richardleeman.blogspot.jp"></img><div class="hbc-site-name">richardleeman.blogspot.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">&quot;C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v14.0\DotNet\Microsoft.DotNet.Props&quot; was not found</div><div class="hbc-url">http://richardleeman.blogspot.jp/2017/02/cprogram-files-x86msbuildmicrosoftvisua.html</div><div class="hbc-description">I recently opened a sample project from a colleague and encountered the following error:   &quot;C:\Program Files (x86)\MSBuild\Microsoft\VisualS…</div></div></div></div></a></div></div><p><strong>.Net Core 1.0.1 tools Preview 2</strong>をインストールすれば良いです。</p><h2 id="0x80070490-要素が見つかりません。"><a href="#0x80070490-要素が見つかりません。" class="headerlink" title="0x80070490 - 要素が見つかりません。"></a>0x80070490 - 要素が見つかりません。</h2><p>が、インストール中にエラーが発生。<br><a href="../../../../public/2017/05/8cb366446e4e68857905698fd368f0b0.png"><img src="../../../../public/2017/05/8cb366446e4e68857905698fd368f0b0.png"></a><br> こちらも同じ現象に、遭遇している方が海外に。日本人?いませんねぇ。 </p><p>どうも、<strong>Visual Studio 2017</strong>がインストールされている環境に、.Net Core 1.0.1 tools Preview 2をインストールすると遭遇する模様。 正確には、<strong>Microsoft Visual C++ 2017 Redistributable</strong>が邪魔をしているらしい。 対処法は</p><ul><li>Microsoft Visual C++ 2017 Redistributableをアンインストール</li><li>Microsoft Visual C++ 2015 Redistributableをインストール</li><li>.Net Core 1.0.1 tools Preview 2を再インストール</li><li>Microsoft Visual C++ 2017 Redistributableを再インストール</li></ul><p>という風にすれば良いです。 ちなみに、Microsoft Visual C++ 2017 Redistributableをインストールすると、Microsoft Visual C++ 2015 Redistributableは消えてしまいます。 再頒布可能パッケージは下記から入手可能。</p><h2 id="Microsoft-Visual-C-2015-Redistributable"><a href="#Microsoft-Visual-C-2015-Redistributable" class="headerlink" title="Microsoft Visual C++ 2015 Redistributable"></a>Microsoft Visual C++ 2015 Redistributable</h2><p><a href="https://www.microsoft.com/ja-jp/download/details.aspx?id=53587">Microsoft Visual C++ 2015 再頒布可能パッケージ Update 3</a></p><h2 id="Microsoft-Visual-C-2017-Redistributable"><a href="#Microsoft-Visual-C-2017-Redistributable" class="headerlink" title="Microsoft Visual C++ 2017 Redistributable"></a>Microsoft Visual C++ 2017 Redistributable</h2><p>ちょっとこっちはわかりにくいです。 <a href="https://www.visualstudio.com/downloads/">Visual Studio のダウンロード</a>の<strong>Other Tools and Frameworks</strong>にリンクが記載されています。<br><a href="../../../../public/2017/05/3f169495fe417c9196a810bfaee4e414.png"><img src="../../../../public/2017/05/3f169495fe417c9196a810bfaee4e414-1024x468.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その56 Red Hat Enterprise Linux 7.2でDockerとコンテナを自動で再起動</title>
      <link href="/2017/05/01/2191/"/>
      <url>/2017/05/01/2191/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>マシン再起動後、自動起動してほしいコンテナってありますよね。 <strong>Portainer</strong>とか特にそうです。 そんな自動起動の方法のメモ。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h2 id="Dockerの自動起動"><a href="#Dockerの自動起動" class="headerlink" title="Dockerの自動起動"></a>Dockerの自動起動</h2><p>恐らくデフォルトで自動起動になっているとは思います。 もし、自動起動設定になっていない場合は下記。 [code lang=”sh”] $ systemctl enable docker [/code]</p><h2 id="コンテナの自動起動"><a href="#コンテナの自動起動" class="headerlink" title="コンテナの自動起動"></a>コンテナの自動起動</h2><p>再起動を指定できるのは、Dockerのバージョン1.2.0から。 <strong>run</strong>実行時に<strong>--restartオプション</strong>を付与することでDocker起動時にコンテナを自動で起動させることができます。 また、オプションに追加可能なポリシーは下記。</p><p>ポリシー</p><p>内容</p><p>no</p><p>再起動しない (既定値)</p><p>on-failure</p><p>終了ステータスが非0の場合に再起動する</p><p>on-failure:X</p><p>終了ステータスが非0の場合にX回だけ再起動する</p><p>always</p><p>終了ステータスを無視して再起動する</p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://docs.docker.com/engine/reference/run/#restart-policies---restart" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.docker.com"></img><div class="hbc-site-name">Docker Documentation</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="/favicons/docs@2x.ico"></img></div><div class="hbc-text"><div class="hbc-title">Docker run reference</div><div class="hbc-url">https://docs.docker.com/engine/reference/run/#restart-policies---restart</div><div class="hbc-description">Configure containers at runtime</div></div></div></div></a></div></div><p>ただし、上記の場合は、runで指定する場合で、既に作成したコンテナには使えません。 作成済みコンテナのに対してrestartを設定するには下記。 [code lang=”sh”] $ docker update –restart=always [/code] </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://docs.docker.jp/engine/reference/commandline/update.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=docs.docker.jp"></img><div class="hbc-site-name">docs.docker.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">update — Docker-docs-ja 17.06 ドキュメント</div><div class="hbc-url">http://docs.docker.jp/engine/reference/commandline/update.html</div></div></div></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その55 OpenCV 3.2のContribモジュールをビルドする</title>
      <link href="/2017/04/29/2183/"/>
      <url>/2017/04/29/2183/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>OpenCV</strong>には拡張モジュールと呼ばれる標準のパッケージには含まれず、自分でビルドすることで利用可能なライブラリ群がある。 それをビルドする際、罠に嵌まったのでメモ。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><h2 id="基本設定"><a href="#基本設定" class="headerlink" title="基本設定"></a>基本設定</h2><p>拡張モジュールは<a href="https://github.com/opencv/opencv_contrib/releases">https://github.com/opencv/opencv_contrib/releases</a>から取得します。 また、拡張モジュールのビルドに本体であるOpenCVのソースが必要なので、<a href="http://opencv.org/releases.html">http://opencv.org/releases.html</a>からcontribと同じバージョンのソースをダウンロードします。 ダウンロードすると2つのzipが入手できますので、それを適当なフォルダに展開します。 展開先を<strong>c:\src</strong>とすると、</p><ul><li>c:\src\opencv_contrib-3.2.0<ul><li>doc</li><li>modules</li><li>samples</li><li>…</li></ul></li><li>c:\src\oopencv-3.2.0<ul><li>3rdparty</li><li>apps</li><li>…</li></ul></li></ul><p>という構成になるはずです。</p><h2 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h2><p><strong>CMake</strong>のGUIを起動し、下記のテキストボックスに記載した値を入力します。</p><ul><li><em>Where is the source code</em><ul><li>c:\src\oopencv-3.2.0 を指定</li></ul></li><li><em>Where to build the binaries</em><ul><li>c:\src\oopencv-3.2.0\build を指定</li></ul></li></ul><p>この状態で、一度<strong>Configure</strong>を押下します。 押下すると、ダイアログでプロジェクトの形式を聞かれます。 これは拡張モジュールを利用するプロジェクトに応じて決めます。 今回は<strong>Visual Studio 14 2015 Win64</strong>を選択しました。 ラジオボタンの選択は、<strong>Use default native compilers</strong>でOKです。 選択完了後、<strong>Finish</strong>を押下します。</p><h2 id="OPENCV-EXTRA-MODULES-PATH"><a href="#OPENCV-EXTRA-MODULES-PATH" class="headerlink" title="OPENCV_EXTRA_MODULES_PATH"></a>OPENCV_EXTRA_MODULES_PATH</h2><p>Configure押下後、画面中央のリストにたくさん値が現れるので、<strong>OPENCV_EXTRA_MODULES_PATH</strong>に<strong>c:/src/opencv_contrib-3.2.0/modules</strong>を設定します。 注意するのは、**(バックスラッシュ)<strong>ではなく</strong>/(スラッシュ)**でパスを指定することです。 さもなくば、 Call Stack (most recent call first): modules/CMakeLists.txt:7 (ocv_glob_modules) というエラーに遭遇します。</p><h2 id="IPP"><a href="#IPP" class="headerlink" title="IPP"></a>IPP</h2><p><strong>Intel Performance Primitives</strong>が無いと CMake Error at cmake/OpenCVFindIPP.cmake:243 (include): include could not find load file: みたいなエラーがでます。 エラーが発生したら、<strong>WITH_IPP</strong>のチェックボックスをオフにします。</p><h2 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h2><p>GPUを搭載していないなら、<strong>WITH_CUDA</strong>のチェックボックスをオフにします。 さもなくば、Visual Studioでのビルド時に大量のエラーに遭遇します。</p><h2 id="Generate"><a href="#Generate" class="headerlink" title="Generate"></a>Generate</h2><p>エラーが無くなったら、<strong>Configuring done</strong>と表示されるので、<strong>Generate</strong>を押下します。 すると、<strong>c:\src\oopencv-3.2.0\build</strong>に<strong>OpenCV.sln</strong>が作成されるので、Visual Studioで開きます。 <strong>ソリューションエクスプローラー</strong>から<strong>CMakeTargets\INSTALL</strong>を右クリックしてスタートアッププロジェクトに指定します。 その後、ソリューションをビルドすれば、</p><ul><li>dll<ul><li><strong>c:\src\opencv-3.2.0\build\bin\Release</strong>または<strong>c:\src\opencv-3.2.0\build\bin\Debug</strong></li></ul></li><li>lib<ul><li><strong>c:\src\opencv-3.2.0\build\lib\Release</strong>または<strong>c:\src\opencv-3.2.0\build\lib\Debug</strong></li></ul></li><li>header<ul><li><strong>c:\src\opencv-3.2.0\build\install\include</strong></li></ul></li></ul><p>に生成されます。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> マルチメディア </category>
          
          <category> CMake </category>
          
          <category> OpenCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NET Core 2.0 PreviewとVisual Studio Codeでコンソールアプリをつくる Linux実行編</title>
      <link href="/2017/04/28/2140/"/>
      <url>/2017/04/28/2140/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="http://wp.me/p7138e-yg">.NET Core 2.0 PreviewとVisual Studio Codeでコンソールアプリをつくる Linux準備編</a>にて、<strong>Portainer</strong>を経由し、<strong>Docker</strong>で、</p><ul><li>debianベースの.NET Core 2.0 Preview SDKのImageをPull</li><li>コンテナの作成</li></ul><p>を実行しました。 今回は.NET Coreでソースのビルドと実行を行います。</p><h1 id="コンソールに接続"><a href="#コンソールに接続" class="headerlink" title="コンソールに接続"></a>コンソールに接続</h1><p>Portainerで前回作成したコンテナの詳細画面に遷移します。 <strong>Container Status</strong>に<strong>Console</strong>というリンクがあるのでクリックします。 そうすると、<strong>Container console</strong>という画面に遷移します。<br><a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492893892110.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492893892110-1024x647.png"></a> ここで、ペンギンアイコンのコンボボックスを開くと、**/bin/sh<strong>と</strong>/bin/bash<strong>を選べます。 今回は/bin/bashを選んで、</strong>Connect<strong>をクリックすると、黒い背景のコンソールが出現します。 ここで、</strong>ls -la<strong>と入力してEnterキーを叩きます。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492894095245.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492894095245-1024x669.png"></a><br> きちんとコンテナ内につながっているようです。Portainer経由でコンテナに接続もできます。凄い。 次に、</strong>cd home/Projects**と叩きます。 コンテナ作成時にマッピングしたディレクトリです。きちんと移動したことがわかります。</p><h1 id="dotnet"><a href="#dotnet" class="headerlink" title="dotnet"></a>dotnet</h1><p>コンテナに繋がっていることがわかったので、.NET Coreが利用できることを確認し、ビルドと実行を行っていきます。 まず、<strong>dotnet –info</strong>と入力します。 [code lang=”sh”] # dotnet –info .NET Command Line Tools (2.0.0-preview1-005825)<br>Product Information: Version: 2.0.0-preview1-005825 Commit SHA-1 hash: b4a821109d<br>Runtime Environment: OS Name: debian OS Version: 8 OS Platform: Linux RID: debian.8-x64 Base Path: /usr/share/dotnet/sdk/2.0.0-preview1-005825/<br>Microsoft .NET Core Shared Framework Host<br>Version : 2.0.0-preview1-002028-00 Build : 6d0caecf154d3398b9bc0e637089b6af9e250479 [/code] .NET Core 2.0 previewがインストールされている、debianであることが確認できました。 ここまでくれば、あとは前々回と同じく、**Hello, world!!**を表示するコンソールを作り、ビルド、実行します。 [code lang=”sh”] $ dotnet new console The template “Console Application” was created successfully.<br>Processing post-creation actions… Running ‘dotnet restore’ on /home/Projects/Projects.csproj… Restore succeeded.<br>$ dotnet build Microsoft (R) Build Engine version 15.2.93.5465 Copyright (C) Microsoft Corporation. All rights reserved.<br>Projects -&gt; /home/Projects/bin/Debug/netcoreapp2.0/Projects.dll<br>Build succeeded. 0 Warning(s) 0 Error(s)<br>Time Elapsed 00:00:08.68 $ dotnet run Hello World! [/code]<br><a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492895087015.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492895087015-1024x669.png"></a><br> 実行できました。 Docker環境でも.NET Coreを動かせることを証明できました。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Microsoft </category>
          
          <category> Docker </category>
          
          <category> .NET </category>
          
          <category> Portainer </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NET Core 2.0 PreviewとVisual Studio Codeでコンソールアプリをつくる Linux準備編</title>
      <link href="/2017/04/27/2124/"/>
      <url>/2017/04/27/2124/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="http://wp.me/p7138e-y2">.NET Core 2.0 PreviewとVisual Studio Codeでコンソールアプリをつくる 準備&amp;作成編</a>にて、**.NET Core 2.0 Preview**を使って、コンソールアプリを</p><ul><li>Visual Studio Codeからデバッグ&amp;実行</li><li>コマンドプロンプトからビルド&amp;実行</li></ul><p>しました。 前回の目標に、Linuxでの実行がありましたので、宣言通り、Linuxで実行していきます。</p><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>今回は、Dockerを使って、Linuxでの実行環境を構築します。 <a href="http://wp.me/p7138e-xL">開発メモ その51 Red Hat Enterprise Linux 7.2にPortainerをインストールする</a>にて導入した<strong>Portainer</strong>によって、WebからDockerの管理ができるようになったので、それを使います。</p><h2 id="Docker-Imageの入手"><a href="#Docker-Imageの入手" class="headerlink" title="Docker Imageの入手"></a>Docker Imageの入手</h2><p>.NET Core 2.0の入ったDocker Imageを引っ張ってきます。 PortainerのImagesを開きます。 <strong>Name</strong>と書かれたテキストボックスに<strong>microsoft/dotnet-nightly:2.0-sdk</strong>と入力して。<strong>Pull</strong>ボタンを押下します。 この表記は、<strong>DockerImage名:タグ名</strong>となっています。 今回は、<a href="https://hub.docker.com/r/microsoft/dotnet-nightly/">microsoft/dotnet-nightly</a>から、debianの.NET Core SDK 2.0 Previewを持ってくるために、microsoft/dotnet-nightly:2.0-sdkと入力しました。<br><a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492887134732.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492887134732-1024x659.png"></a> 回線環境にもよりますが、私の場合3-4分くらいでPullが完了し、下部の一覧に追加されているのがわかります。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492887778591.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492887778591-1024x659.png"></a> <strong>Id</strong>をクリックして詳細を見てみます。 詳しい情報を確認できます。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492888249836.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492888249836-1024x1001.png"></a><br> なお、<strong>Imaeg Tags</strong>の<strong>docker.io/microsoft/dotnet-nightly:2.0-sdk</strong>という文字列は次の作業で使用します。</p><h2 id="コンテナの作成"><a href="#コンテナの作成" class="headerlink" title="コンテナの作成"></a>コンテナの作成</h2><p>画面左のメニューから<strong>Containers</strong>をクリックし、<strong>Add container</strong>をクリックします。<br><a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492889589053.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492889589053-1024x955.png"></a><br> 今回の入力内容は下記になります。</p><p>入力項目名</p><p>説明</p><p>内容</p><p><strong>Name</strong></p><p>コンテナの名前なので自由に名前を付けることができます。</p><p>dotnet-nightly-2.0-sdk_debian</p><h3 id="Image-configuration"><a href="#Image-configuration" class="headerlink" title="Image configuration"></a>Image configuration</h3><p>入力項目名</p><p>説明</p><p>内容</p><p><strong>Image</strong></p><p>コンテナのベースとなるImage。先ほどPullしたImage Tagです。</p><p>docker.io/microsoft/dotnet-nightly:2.0-sdk</p><p><strong>Always pull images</strong></p><p>コンテナ作成前にImageを常にPullするかどうか</p><p>off</p><h3 id="Ports-configuration"><a href="#Ports-configuration" class="headerlink" title="Ports configuration"></a>Ports configuration</h3><p>入力項目名</p><p>説明</p><p>内容</p><p><strong>Publish all exposed ports</strong>ランダムな値のポートをDockerに公開させるか</p><p>off</p><p><strong>Port mapping</strong></p><p>map addtional portをクリックしてポートのマッピングを設定できます。<br>複数設定可能。</p><p>なし</p><h3 id="Access-control"><a href="#Access-control" class="headerlink" title="Access control"></a>Access control</h3><p>入力項目名</p><p>説明</p><p>内容</p><p><strong>Ownership</strong></p><p>privateにすると、Portainer上においてAdminとコンテナを作成した本人のみがコンテナを操作できます。</p><p>Public</p><h3 id="Advanced-container-settings"><a href="#Advanced-container-settings" class="headerlink" title="Advanced container settings"></a>Advanced container settings</h3><h4 id="Volume"><a href="#Volume" class="headerlink" title="Volume"></a>Volume</h4><p>入力項目名</p><p>説明</p><p>内容</p><p><strong>Volume mapping</strong></p><p>ホスト側のディレクトリとコンテナ側のディレクトリをマッピングします。<br><strong>Bind</strong>をクリックすることで<strong>host</strong>に入力できます。</p><p>container /home/Projects<br>host /home/takuya/Docker/Projects</p><p><strong>Console</strong></p><p>コンテナと対話するコンソールを指定します。</p><p>Interactive &amp; TTY</p><h4 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h4><p>入力項目名</p><p>説明</p><p>内容</p><p>Privileged mode</p><p>コンテナ以外のホスト上のプロセスと同じレベルでホストへのアクセスを許可するかどうか</p><p>on</p><p>注意 1. 今回のケースのような実行環境を作りたい場合、ConsoleでNoneを指定すると、即座にコンテナが停止します。 2. Privileged modeがonでないと、ホストにマッピングしたディレクトリに何も書き込めません 入力後、<strong>Actions</strong>の<strong>Start container</strong>をクリックします。 成功すれば、下記のようなメッセージが、画面右上に表示されます。 <code>Container Started 65425079d33e4b10c91a627785d5035715a05e200b0c4e4ede591a3ed9e58e5d</code> <code>作成後、詳細を確認できます。  [![](../../../../public/2017/04/screencapture-192-168-11-18-9000-1492892214548-805x1024.png)](../../../../public/2017/04/screencapture-192-168-11-18-9000-1492892214548.png)  今回はここまで。</code></p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Microsoft </category>
          
          <category> Docker </category>
          
          <category> .NET </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> Portainer </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その54 BitNami Redmine Statckでthinが動かない原因を探る</title>
      <link href="/2017/04/27/2178/"/>
      <url>/2017/04/27/2178/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>会社での話ですが、OS起動後、<strong>Thin_Redmine</strong>と<strong>Thin_Redmine2</strong>が停止していることがある。 何故だかは不明ですが、BitNamiインストール配下のruby関係のファイルが壊れているために、ruby関係であるthinが起動しない模様。 ただ、膨大な数のruby関係のファイルから壊れているファイルだけを探すのは至難の業。 そのための問題を見つける手段。</p><h1 id="Solution1"><a href="#Solution1" class="headerlink" title="Solution1"></a>Solution1</h1><p>スタートメニューから<strong>Bitnami Redmine Stack を使用する</strong>を起動し、コマンドプロンプトを立ち上げます。 それで、どこでもいいので、<strong>bundle</strong>を実行できるフォルダに移動します。 多分、htdocsが最短。 [code lang=”batch”] $ cd apps\redmine\htdocs $ bundle exec rake tmp:cache:clear [/code] と実行します。 この時、<strong>rbファイル</strong>や<strong>gemspecファイル</strong>壊れていると、rubyが動かないので、 [code lang=”batch”] C:\BitNami\redmine-3.2.2-0\ruby\lib\ruby\gems\2.1.0\specifications\default\json-1.8.1.gemspec:2: invalid multibyte char (UTF-8) [/code] のように該当するファイルがエラーを吐きますので、正常なファイルと置き換えます。</p><h1 id="Solution2"><a href="#Solution2" class="headerlink" title="Solution2"></a>Solution2</h1><p>Windows版のthinは<strong>-log</strong>オプションが使えません。 <strong>apps\redmine\htdocs\vendor\bundle\ruby\2.1.0\gems\thin-1.6.1-x86-mingw32\lib\thin\runner.rb</strong>内の下記の記述を見てください。 [code lang=”ruby”] unless Thin.win? # Daemonizing not supported on Windows opts.separator “” opts.separator “Daemon options:”<br>opts.on(“-d”, “–daemonize”, “Run daemonized in the background”) { @options[:daemonize] = true } opts.on(“-l”, “–log FILE”, “File to redirect output “ +<br>“(default: #{@options[:log]})”) { |file| @options[:log] = file } opts.on(“-P”, “–pid FILE”, “File to store PID “ +<br>“(default: #{@options[:pid]})”) { |file| @options[:pid] = file } opts.on(“-u”, “–user NAME”, “User to run daemon as (use with -g)”) { |user| @options[:user] = user } opts.on(“-g”, “–group NAME”, “Group to run daemon as (use with -u)”) { |group| @options[:group] = group } opts.on( “–tag NAME”, “Additional text to display in process listing”) { |tag| @options[:tag] = tag }<br>opts.separator “” opts.separator “Cluster options:”<br>opts.on(“-s”, “–servers NUM”, “Number of servers to start”) { |num| @options[:servers] = num.to_i } opts.on(“-o”, “–only NUM”, “Send command to only one server of the cluster”) { |only| @options[:only] = only.to_i } opts.on(“-C”, “–config FILE”, “Load options from config file”) { |file| @options[:config] = file } opts.on( “–all [DIR]“, “Send command to each config files in DIR”) { |dir| @options[:all] = dir } if Thin.linux? opts.on(“-O”, “–onebyone”, “Restart the cluster one by one (only works with restart command)”) { @options[:onebyone] = true } opts.on(“-w”, “–wait NUM”, “Maximum wait time for server to be started in seconds (use with -O)”) { |time| @options[:wait] = time.to_i } end[/code] Windowsでは、サポートしていない旨があります。 ここを改造しても無駄です。 実際にログを吐く処理と思しき、<strong>apps\redmine\htdocs\vendor\bundle\ruby\2.1.0\gems\thin-1.6.1-x86-mingw32\lib\thin\daemonizing.rb</strong>に、 [code lang=”ruby”] def daemonize raise PlatformNotSupported, ‘Daemonizing is not supported on Windows’ if Thin.win? raise ArgumentError, ‘You must specify a pid_file to daemonize’ unless @pid_file [/code] とあるので、無意味でしょう。 なので、ログではなく、<strong>--debug</strong>オプションを使います。 で、一度サービスを停止し、<strong>Bitnami Redmine Stack を使用する</strong>を立ち上げます。 そして、 [code lang=”batch”] $ “<InstallDir>\ruby\bin\ruby.exe” “<InstallDir>/apps/redmine\htdocs\bin\thin” start -p 3001 -e production –debug -c “<InstallDir>\apps\redmine\htdocs” -a 127.0.0.1 –prefix /redmine 2&gt; F:\thin_debug.log [/code] と実行し、しばらくしてから、Ctrl+Cで停止します。**2&gt;**が重要です。 するといっぱいログがファイルに吐き出されるはずですので、原因がつかめるかもしれません。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> Redmine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング Caffe その3 環境構築 with GPU</title>
      <link href="/2017/04/23/2148/"/>
      <url>/2017/04/23/2148/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>1年以上前、<a href="http://wp.me/p7138e-d2">ディープラーニング Caffe その1 環境構築</a>という記事でにて、14.04でCPUを使ったCaffe環境を構築しました。 最近、会社でUbuntu 14.04に<strong>GeForce GTX 1080 Ti</strong>を2枚差すという、金に物を言わせたマシンが届き、そのテストをしています。 が、これが動かない。 具体的には、ドライバを入れるとGPUは認識し、Caffe、GPUのテストなどはクリアするが、ログイン画面が真っ黒になってしまう、という現象に陥る。 恐らく、オンボードのグラフィックボードを無効化したのが原因だと思われる。オンボードのグラッフィクドライバは<strong>nouveau</strong>を使っている? ネットのBlogだと、オングラフィックのIntelのグラフィックボードを無効にしろ、みたいなこと書いてあります。 でも、会社のマシンだと、1080 Tiには、出力端子がなかったんだよね… だから、画面を表示するには、オンボードのグラフィックを有効にしておかないといけない気がするんだけど、仕事のときは気づかなかった。 で、とりあえず、自宅の環境で、<strong>GeForece GTX 750 Ti</strong>を有効化した状態で、各所で発生する問題が起きるかを検証し、手順をメモします。 目標は</p><ul><li>ドライバのインストール</li><li>Caffeのテストを全部Pass</li><li>Nvidiaのデバイステストをパス</li></ul><p>を達成することです。 検証環境は</p><ul><li>Dell Vostro 3800</li><li>Ubuntu 14.04 LTSを新規インストールした直後</li><li>Intel Core i3-4130 3.40Ghz</li><li>メモリ16GB</li><li>GeForece GTX 750 Ti</li></ul><p>になります。 なお、モニタは、グラフィックボードのHDMI端子に接続しています。 また、記事中のコマンドでは、sudoは省略するために、<strong>sudo -s</strong>でrootになっています。</p><h1 id="ソフトウェアの更新"><a href="#ソフトウェアの更新" class="headerlink" title="ソフトウェアの更新"></a>ソフトウェアの更新</h1><p>OSインストール直後だと、ソフトウェアの更新通知が来ますので全て更新します。来ていないなら、「ソフトウェアの更新」を明示的に実行します。 ただし、Ubuntuそのものは最新版に更新しないでください。 なお、グラフィックドライバを導入していない状態で、ボードの端子で出力していると、画面の表示文字列が一部だけ欠如していたり、突然ロック画面に戻ったりと不安定になっています。<br><a href="../../../../public/2017/04/d5f8768433ecc3a9c2ba8c3a4bf52561.jpeg"><img src="../../../../public/2017/04/d5f8768433ecc3a9c2ba8c3a4bf52561-1024x768.jpeg"></a></p><h1 id="SSHサーバー導入"><a href="#SSHサーバー導入" class="headerlink" title="SSHサーバー導入"></a>SSHサーバー導入</h1><p>マシンの前にいるのはつらいので。 [code lang=”sh”] $ apt-get install openssh-server $ vi /etc/ssh/sshd_config [/code] 下記のように更新 [code lang=”diff”] + #PermitRootLogin without-password - PermitRootLogin without-password + PermitRootLogin no [/code]</p><h1 id="nouveau無効化"><a href="#nouveau無効化" class="headerlink" title="nouveau無効化"></a>nouveau無効化</h1><p>ひょっとすると、オンボードしかない場合は、ここをオフにすると、何も表示されない可能性があるので、このセクションは無視しても可 [code lang=”sh”] $ vi /etc/modprobe.d/blacklist-nouveau.conf [/code] 下記のように更新 [code lang=”diff”] + blacklist nouveau + blacklist lbm-nouveau + options nouveau modeset=0 + alias nouveau off + alias lbm-nouveau off [/code] [code lang=”sh”] $ vi /etc/modprobe.d/nouveau-kms.conf [/code] 下記のように更新 [code lang=”diff”] + options nouveau modeset=0 [/code] 更新後、設定を反映し、再起動。 [code lang=”sh”] $ update-initramfs -u $ reboot [/code]</p><h2 id="接続しているボードの確認"><a href="#接続しているボードの確認" class="headerlink" title="接続しているボードの確認"></a>接続しているボードの確認</h2><p>[code lang=”sh”] # 1080Ti等は、内部のデータベースに存在しないので、まずは更新 $ update-pciids Downloaded daily snapshot dated 2017-04-23 03:15:02 $ lspci | grep VGA 01:00.0 VGA compatible controller: NVIDIA Corporation GM107 [GeForce GTX 750 Ti] (rev a2) [/code]</p><h2 id="ドライバのインストール"><a href="#ドライバのインストール" class="headerlink" title="ドライバのインストール"></a>ドライバのインストール</h2><p>[code lang=”sh”] $ apt-add-repository ppa:xorg-edgers/ppa $ apt-get update $ apt-get upgrade # 検索して見つかる最新をインストールする $ apt-cache search ‘nvidia-[0-9]+$’ $ apt-get install nvidia-375 $ reboot [/code] 再起動後、ログインループなら、Ctrl+Alt+F1でCUIでログインし、下記のコマンドを実行。 [code lang=”sh”] # ユーザフォルダに存在する以下を削除することで、ループを回避できる可能性がある # 自分の環境はこれでログイン成功 $ rm .Xauthority .ICEauthority $ reboot [/code]</p><h2 id="ドライバのバージョン確認"><a href="#ドライバのバージョン確認" class="headerlink" title="ドライバのバージョン確認"></a>ドライバのバージョン確認</h2><p>[code lang=”sh”] $ cat /proc/driver/nvidia/version NVRM version: NVIDIA UNIX x86_64 Kernel Module 375.39 Tue Jan 31 20:47:00 PST 2017 GCC version: gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3) [/code]</p><h2 id="CUDA-Toolkitのインストール"><a href="#CUDA-Toolkitのインストール" class="headerlink" title="CUDA Toolkitのインストール"></a>CUDA Toolkitのインストール</h2><p>[code lang=”sh”] # Ubuntu 14.04 x86_64 network debを入手 $ wget <a href="http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1404/x86/_64/cuda-repo-ubuntu1404/_8.0.61-1/_amd64.deb">http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1404/x86\_64/cuda-repo-ubuntu1404\_8.0.61-1\_amd64.deb</a> $ apt-get install aptitude -y $ dpkg -i cuda-repo-ubuntu1404_8.0.61-1_amd64.deb $ aptitude update $ aptitude install -y cuda $ reboot [/code]</p><h1 id="検証"><a href="#検証" class="headerlink" title="検証"></a>検証</h1><h2 id="Caffeの検証"><a href="#Caffeの検証" class="headerlink" title="Caffeの検証"></a>Caffeの検証</h2><p>Caffeのソースをダウンロードしてきて、ビルド及びtestを実行します。 [code lang=”sh”] $ wget <a href="https://github.com/BVLC/caffe/archive/1.0.zip">https://github.com/BVLC/caffe/archive/1.0.zip</a> $ unzip 1.0.zip $ cd caffe-1.0 $ cp Makefile.config.example Makefile.config $ vi Makefile.config<br>- CUDA_DIR := /usr/local/cuda + CUDA_DIR := /usr/local/cuda-8.0<br>$ apt-get install libatlas-base-dev libboost-all-dev libgflags-dev libgoogle-glog-dev libhdf5-serial-dev libleveldb-dev liblmdb-dev libopencv-dev libprotobuf-dev protobuf-compiler libsnappy-dev -y $ make $ make test $ make runtest …<br>[———-] Global test environment tear-down [==========] 2041 tests from 267 test cases ran. (421631 ms total) [ PASSED ] 2041 tests. [/code]</p><h2 id="GPUの検証1"><a href="#GPUの検証1" class="headerlink" title="GPUの検証1"></a>GPUの検証1</h2><p>[code lang=”sh”] $ cd /usr/local/cuda-8.0/samples # cudnn.hが存在しないというエラーになって途中で止まりますがOK $ make # 停止したら実行 $ ./bin/x86_64/linux/release/deviceQuery ./bin/x86_64/linux/release/deviceQuery Starting…<br>CUDA Device Query (Runtime API) version (CUDART static linking)<br>Detected 1 CUDA Capable device(s)<br>Device 0: “GeForce GTX 750 Ti” CUDA Driver Version / Runtime Version 8.0 / 8.0 CUDA Capability Major/Minor version number: 5.0 Total amount of global memory: 2000 MBytes (2097414144 bytes) ( 5) Multiprocessors, (128) CUDA Cores/MP: 640 CUDA Cores GPU Max Clock rate: 1084 MHz (1.08 GHz) Memory Clock rate: 2700 Mhz Memory Bus Width: 128-bit L2 Cache Size: 2097152 bytes Maximum Texture Dimension Size (x,y,z) 1D=(65536), 2D=(65536, 65536), 3D=(4096, 4096, 4096) Maximum Layered 1D Texture Size, (num) layers 1D=(16384), 2048 layers Maximum Layered 2D Texture Size, (num) layers 2D=(16384, 16384), 2048 layers Total amount of constant memory: 65536 bytes Total amount of shared memory per block: 49152 bytes Total number of registers available per block: 65536 Warp size: 32 Maximum number of threads per multiprocessor: 2048 Maximum number of threads per block: 1024 Max dimension size of a thread block (x,y,z): (1024, 1024, 64) Max dimension size of a grid size (x,y,z): (2147483647, 65535, 65535) Maximum memory pitch: 2147483647 bytes Texture alignment: 512 bytes Concurrent copy and kernel execution: Yes with 1 copy engine(s) Run time limit on kernels: Yes Integrated GPU sharing Host Memory: No Support host page-locked memory mapping: Yes Alignment requirement for Surfaces: Yes Device has ECC support: Disabled Device supports Unified Addressing (UVA): Yes Device PCI Domain ID / Bus ID / location ID: 0 / 1 / 0 Compute Mode: &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;<br>deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 8.0, CUDA Runtime Version = 8.0, NumDevs = 1, Device0 = GeForce GTX 750 Ti Result = PASS [/code]</p><h2 id="GPUの検証2"><a href="#GPUの検証2" class="headerlink" title="GPUの検証2"></a>GPUの検証2</h2><p>[code lang=”sh”] $ nvidia-smi Sun Apr 23 22:14:27 2017 +—————————————————————————–+ | NVIDIA-SMI 375.51 Driver Version: 375.51 | |——————————-+———————-+———————-+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 GeForce GTX 750 Ti On | 0000:01:00.0 On | N/A | | 40% 31C P8 1W / 38W | 140MiB / 2000MiB | 0% Default | +——————————-+———————-+———————-+<br>+—————————————————————————–+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | 0 1361 G /usr/bin/X 99MiB | | 0 2075 G compiz 39MiB | +—————————————————————————–+ [/code]</p><h2 id="NVIDIA-Cuda-compiler"><a href="#NVIDIA-Cuda-compiler" class="headerlink" title="NVIDIA Cuda compiler"></a>NVIDIA Cuda compiler</h2><p>[code lang=”sh”] $ /usr/local/cuda-8.0/bin/nvcc -V nvcc: NVIDIA (R) Cuda compiler driver Copyright (c) 2005-2016 NVIDIA Corporation Built on Tue_Jan_10_13:22:03_CST_2017 Cuda compilation tools, release 8.0, V8.0.61 [/code] 無事に動きました。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Caffe </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NET Core 2.0 PreviewとVisual Studio Codeでコンソールアプリをつくる 準備&amp;作成編</title>
      <link href="/2017/04/23/2110/"/>
      <url>/2017/04/23/2110/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>2017/04/23現在、**.NET Core 2.0**の開発が進められます。 そんな.NET Core 2.0のPreviewを使ってコンソールアプリを作ります。 目標は</p><ul><li>Visual Studio Codeを使えるようになる</li><li>.NET Coreを使えるようになる</li><li>Linuxでビルドして実行</li></ul><p>になります。 特にLinuxでの実行が重要になります。 開発環境を広げないと、飯の種が無くなってしまいますので。 今回は準備と作成を。</p><h1 id="NET-Core-2-0-Preview"><a href="#NET-Core-2-0-Preview" class="headerlink" title=".NET Core 2.0 Preview"></a>.NET Core 2.0 Preview</h1><p>まずは.NET Coreを入手します。 入手先は下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/dotnet/cli" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/9141961?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">dotnet/cli</div><div class="hbc-url">https://github.com/dotnet/cli</div><div class="hbc-description">The .NET Core command-line (CLI) tools, used for building .NET Core apps and libraries through your development flow (compiling, NuGet packa…</div></div></div></div></a></div></div><p>上のページで、<strong>Installers and Binaries</strong>ってセクションから環境に応じたものを入手します。 今回は、zipで入手します。Previewなんて先行版をインストーラでインストールしたくありません(ｷﾘｯ) これは適当な場所に置いておきます。今回は<strong>D:\Works\Lib\Microsoft.NET Core CLI\2.0.0-preview2-005840\bin</strong>に展開します。 パスを通すかはお好みで。</p><h1 id="Visual-Studio-Code"><a href="#Visual-Studio-Code" class="headerlink" title="Visual Studio Code"></a>Visual Studio Code</h1><h2 id="入手"><a href="#入手" class="headerlink" title="入手"></a>入手</h2><p>ダウンロード先は下記です。以上。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://code.visualstudio.com/download" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=code.visualstudio.com"></img><div class="hbc-site-name">code.visualstudio.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://code.visualstudio.com/opengraphimg/opengraph-home.png"></img></div><div class="hbc-text"><div class="hbc-title">Download Visual Studio Code - Mac, Linux, Windows</div><div class="hbc-url">https://code.visualstudio.com/download</div><div class="hbc-description">Visual Studio Code is free and available on your favorite platform - Linux, macOS, and Windows.  Download Visual Studio Code to experience a…</div></div></div></div></a></div></div><h2 id="C-Extension"><a href="#C-Extension" class="headerlink" title="C# Extension"></a>C# Extension</h2><p>Visual Studio Code起動後、拡張機能を導入します。 C#はMicrosoftにおける第一級のプログラミング言語ですが、Visual Studio Codeは、クロスプラットフォームで動作するので、そのあたりの特別扱いはできなかった、あるいはIDEではなくエディタという位置づけなので、言語対応は全て拡張機能で追加しましょう、なスタンスのご様子。面倒。<br><a href="../../../../public/2017/04/052c09a990c125f192abcb54c1fb45fd.png"><img src="../../../../public/2017/04/052c09a990c125f192abcb54c1fb45fd-1024x768.png"></a></p><h1 id="コーディング"><a href="#コーディング" class="headerlink" title="コーディング"></a>コーディング</h1><p>まず、プロジェクトフォルダを作成します。 Visual Studio Codeでは、プロジェクトという概念がありません。エディタだからですかね。 あるのは、開いたフォルダが起点となるという概念だけです。 今回は<strong>D:\Works\temp\corecli</strong>をプロジェクトフォルダにします。 プロジェクトの作成は、先ほど入手した.NET Coreを使います。 まず、コマンドラインでプロジェクトフォルダに移動します。 続いて、.NET Coreに含まれる<strong>dotnet.exe</strong>を–helpをつけて呼び出します。 [code lang=”cmd”] D:\Works\temp\corecli&gt;”D:\Works\Lib\Microsoft\.NET Core CLI\2.0.0-preview2-005840\bin\dotnet.exe” –help .NET Command Line Tools (2.0.0-preview2-005840) Usage: dotnet [host-options] [command] [arguments] [common-options]<br>Arguments: [command] The command to execute [arguments] Arguments to pass to the command [host-options] Options specific to dotnet (host) [common-options] Options common to all commands<br>Common options: -v|–verbose Enable verbose output -h|–help Show help<br>Host options (passed before the command): -d|–diagnostics Enable diagnostic output –version Display .NET CLI Version Number –info Display .NET CLI Info<br>Commands: new Initialize .NET projects. restore Restore dependencies specified in the .NET project. build Builds a .NET project. publish Publishes a .NET project for deployment (including the runtime). run Compiles and immediately executes a .NET project. test Runs unit tests using the test runner specified in the project. pack Creates a NuGet package. migrate Migrates a project.json based project to a msbuild based project. clean Clean build output(s). sln Modify solution (SLN) files.<br>Project modification commands: add Add items to the project. remove Remove items from the project. list List items in the project.<br>Advanced Commands: nuget Provides additional NuGet commands. msbuild Runs Microsoft Build Engine (MSBuild). vstest Runs Microsoft Test Execution Command Line Tool. [/code] 色々ありますが、<strong>new</strong>でプロジェクトを初期化することがわかります。 ではnewをつけて呼び出します。 [code lang=”cmd”] D:\Works\temp\corecli&gt;”D:\Works\Lib\Microsoft\.NET Core CLI\2.0.0-preview2-005840\bin\dotnet.exe” new Template Instantiation Commands for .NET Core CLI<br>Usage: new [options]<br>Options: -h, –help Displays help for this command. -l, –list Lists templates containing the specified name. If no name is specified, lists all templates. -n, –name The name for the output being created. If no name is specified, the name of the current directory is used. -o, –output Location to place the generated output. -i, –install Installs a source or a template pack. -u, –uninstall Uninstalls a source or a template pack. –type Shows a subset of the available templates. Valid values are “project”, “item” or “other”. –force Forces content to be generated even if it would change existing files. -lang, –language Specifies the language of the template to create.<br>Templates Short Name Language Tags ———————————————————————– Console Application console [C#], F# Common/Console Class library classlib [C#], F# Common/Library Unit Test Project mstest [C#], F# Test/MSTest xUnit Test Project xunit [C#], F# Test/xUnit ASP.NET Core Empty web [C#] Web/Empty ASP.NET Core Web App mvc [C#], F# Web/MVC ASP.NET Core Web API webapi [C#] Web/WebAPI Nuget Config nugetconfig Config Web Config webconfig Config Solution File sln Solution<br>Examples: dotnet new mvc –framework netcoreapp2.0 –auth Individual dotnet new console –framework netcoreapp2.0 dotnet new –help [/code] コンソールアプリは、<strong>console</strong>をつける模様。 最後に、<strong>new console</strong>を付けて実行します。 [code lang=”cmd”] D:\Works\temp\corecli&amp;gt;”D:\Works\Lib\Microsoft\.NET Core CLI\2.0.0-preview2-005840\bin\dotnet.exe” new console The template “Console Application” was created successfully.<br>Processing post-creation actions… Running ‘dotnet restore’ on D:\Works\temp\corecli\corecli.csproj… Restore succeeded. [/code] そうすると、プロジェクトフォルダに、</p><ul><li>obj</li><li>corecli.csproj</li><li>NuGet.config</li><li>Program.cs</li></ul><p>が作成されます。 csprojを見ると、Visual Studioを思い出しますが、中身は少し違います。 ファイルへの参照がない。 [code lang=”xhtml”] <Project Sdk="Microsoft.NET.Sdk"><br><PropertyGroup> <OutputType>Exe</OutputType> <TargetFramework>netcoreapp2.0</TargetFramework> </PropertyGroup><br></Project> [/code] 次に、このフォルダをVisual Studio Codeで開きます。メニューに<strong>フォルダーを開く</strong>がありますので、そこから開きます。<br><a href="../../../../public/2017/04/76279b2073aaa126655eb5579cb096a1.png"><img src="../../../../public/2017/04/76279b2073aaa126655eb5579cb096a1-1024x768.png"></a> すると、**Required assets to build and debug are missing from ‘corecli’. Add them?**と聞かれます。 <a href="../../../../public/2017/04/a956c2fecc47c357ed5ade8f7d4668e2.png"><img src="../../../../public/2017/04/a956c2fecc47c357ed5ade8f7d4668e2-1024x768.png"></a><br> Yesと応えると、プロジェクトに</p><ul><li>.vscode\tasks.json</li><li>.vscode\launch.json</li></ul><p>が追加されます。 同時に、**There are unresolved dependencies from ‘corecli.csproj’. Please execute the restore command to continue.**と聞かれますが、Restoreを選んでも下記のエラーになります。 <code>error: Invalid input &#39;d:\Works\temp\corecli\corecli.csproj&#39;. The file type was not recognized. Done: 1.</code> なので、これは諦めます。</p><h1 id="デバッグ-amp-実行"><a href="#デバッグ-amp-実行" class="headerlink" title="デバッグ&amp;実行"></a>デバッグ&amp;実行</h1><p>現時点で、Program.csには、<strong>Hello World!**と表示するコードが書かれています。 これを実行します。 **Console.WriteLine</strong>にF9でブレークポイントを置き、F5で実行してみます。このあたりはVisual Studioと同じで助かります。 実行すると、エラーがでます。<br><a href="../../../../public/2017/04/7d168e1a70d55585dc1f55ad068700cd.png"><img src="../../../../public/2017/04/7d168e1a70d55585dc1f55ad068700cd-1024x768.png"></a> <strong>問題を表示する</strong>とあるのでクリックしますが、 <a href="../../../../public/2017/04/ae09d27d5975a106b62397b00925376d.png"><img src="../../../../public/2017/04/ae09d27d5975a106b62397b00925376d-1024x768.png"></a> <strong>現時点で問題はワークスペースで検出されていません。</strong>と言われます。意味がわかりません。 仕方ないので、もう一度実行し、今度は<strong>このままデバッグを続ける</strong>をクリックします。 すると、今度は下記のメッセージが表示されました。 [code lang=”cmd”] ——————————————————————- You may only use the Microsoft .NET Core Debugger (vsdbg)<br> with Visual Studio Code, Visual Studio or Visual Studio for Mac software to help you develop and test your applications. ——————————————————————- The specified framework ‘Microsoft.NETCore.App’, version ‘2.0.0-preview1-002061-00’ was not found.<br>- Check application dependencies and target a framework version installed at:<br>C:\Program Files\dotnet\shared\Microsoft.NETCore.App<br>- The following versions are installed:<br>1.0.0<br>- Alternatively, install the framework version ‘2.0.0-preview1-002061-00’.<br>The target process exited without raising a CoreCLR started event. Ensure that the target process is configured to use .NET Core. This may be expected if the target process did not run on .NET Core. The program ‘[23568] corecli.dll’ has exited with code -2147450749 (0x80008083). [/code] どうも、依存関係が見つからないご様子。 なので、.NET Core 2.0のフォルダにある、<strong>shared\Microsoft.NETCore.App\2.0.0-preview1-002061-00</strong>を<strong>C:\Program Files\dotnet\shared\Microsoft.NETCore.App</strong>にコピーします。 その後、もう一度F5実行し、<strong>このままデバッグを続ける</strong>をクリックします。 今度は、実行に成功し、ブレークポイントに停止しました。<br><a href="../../../../public/2017/04/bbed7d4da07f33b2a5fe5c237d39b2aa.png"><img src="../../../../public/2017/04/bbed7d4da07f33b2a5fe5c237d39b2aa-1024x768.png"></a><br> カーソルを次に進めると、下のコンソールに**Hello World!**が表示されます。 少し手こずりましたが、何とか動きました。 あと、実行アセンブリは、dllが拡張子なのね…</p><h1 id="コンソールからビルド-amp-実行"><a href="#コンソールからビルド-amp-実行" class="headerlink" title="コンソールからビルド&amp;実行"></a>コンソールからビルド&amp;実行</h1><p>Visual Studio Codeから実行しましたが、dotnet.exeからもビルドしてみます。 同じようにカレントをプロジェクトフォルダに移動したコマンドプロンプトから下記でビルドします。 [code lang=”cmd”] D:\Works\temp\corecli&gt;”D:\Works\Lib\Microsoft\.NET Core CLI\2.0.0-preview2-005840\bin\dotnet.exe” build Microsoft (R) Build Engine version 15.2.93.5465 Copyright (C) Microsoft Corporation. All rights reserved.<br>corecli -&gt; D:\Works\temp\corecli\bin\Debug\netcoreapp2.0\corecli.dll<br>Build succeeded. 0 Warning(s) 0 Error(s)<br>Time Elapsed 00:00:02.92 [/code] 続いて実行します。 [code lang=”cmd”] D:\Works\temp\corecli&gt;”D:\Works\Lib\Microsoft\.NET Core CLI\2.0.0-preview2-005840\bin\dotnet.exe” run Hello World! [/code] 問題なく実行できました。 これならLinuxでも実行できそうです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET </category>
          
          <category> Visual Studio Code </category>
          
          <category> net </category>
          
          <category> .NET Core </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その53 DockerのベースOSについて</title>
      <link href="/2017/04/22/2104/"/>
      <url>/2017/04/22/2104/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Docker</strong>を調べていると、どうしても理解しにくいのが、<strong>カーネルの共有</strong>の概念。 世間様のBlogを見ていると、Dockerの概要図で、各層のスタックを<strong>インフラ-マシン-ホストOS-Dockerエンジン-Bin/Lib-App</strong>みたいな表記しているところがいっぱいある。 で、<a href="https://hub.docker.com/">Docker Hub</a>で配布しているイメージを見ていると、<strong>App</strong>だけが配布してあって混乱する。</p><ul><li><strong>Bin/Lib</strong>はDokcerエンジンが提供している?</li><li>カーネルの共有ってことは、<strong>App</strong>はホストOSのカーネル部分にアクセスする (Bin/Libを経由して)?</li><li>サンドボックスに近い?</li></ul><p>みたいな勘違いをしていた。 さらに混乱したのが、<strong>Docker軽量OS</strong>である<strong>CoreOS</strong>、<strong>Alpine Linux</strong>等の存在。 「結局OSがいるじゃん、上のBin/Libsとか何?」ってなった。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>結論から言えば、やっぱりOSはいるんですよ。 [slideshare id=54615053&amp;doc=introductiontodockermanagementandoperations2nd-151101144211-lva1-app6892] リンク元:<a href="https://www.slideshare.net/zembutsu/introduction-to-docker-management-and-operations-2nd">https://www.slideshare.net/zembutsu/introduction-to-docker-management-and-operations-2nd</a> 著者:Masahito Zembutsu様</p><p>上のスライドの67Pにおける、<strong>ベースイメージ (公式) Ubuntu、CentOS等</strong>って言葉。 OSはいるんです。67P付近がすごくわかりやすい。まじで。 <a href="https://www.docker.com/what-container">公式ページの説明</a>にも、こんな図がある。<br><a href="../../../../public/2017/04/what_is_a_container.png"><img src="../../../../public/2017/04/what_is_a_container.png"></a><br> <a href="https://www.docker.com/sites/default/files/what/_is/_a/_container.png">https://www.docker.com/sites/default/files/what\_is\_a\_container.png</a> より</p><p>いろんなBlog見ていると、Dockerエンジンの上にいきなりAppがいたりする。 これ見たら、「他のコンテナからは独立、カーネルは共有、ホストOSから見たら単一のプロセスに見える」って、サンドボックスと勘違いしますわ。少なくとも。 多分、従来の仮想OSと差別化して見せたいから、意図的にOSがあることをぼかして、Bin/Libsとか、極端にDockerエンジン-App、っていう図を提示してたんですよ。 広告としてはわかりやすいし、魅力的だもんね。 素直に、ベースイメージ≓Bin/Libsって書いてくれれば迷わなかったね。</p><h1 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h1><p><strong>Dockerfile</strong>ってあるよね。 ちゃんと仕組みを理解すれば、上の疑問なんてありえないけど、Dockerfileの仕組みを早く知りたかった。 なんで、「ベースイメージがある」、ってことが確信に変わったかっていうと、このDockerfileを眺めていたから。 JenkinsっていうCIのアプリがあるけど、あれのDockerイメージって、冒頭は下記のような記述になっている。 [code lang=”docker”] FROM openjdk:8-jdk<br>RUN apt-get update &amp;&amp; apt-get install -y git curl &amp;&amp; rm -rf /var/lib/apt/lists/*<br>ENV JENKINS_HOME /var/jenkins_home ENV JENKINS_SLAVE_AGENT_PORT 50000 [/code] <strong>FROM</strong>って見て思いました。これ、他のDockerfileを参照するな、って。 だから、Docker Hubでopenjdkを調べました。 そしたら、openjdkの8-jdkってなっているDockerfileの冒頭は下記。 [code lang=”docker”] FROM buildpack-deps:jessie-scm [/code] 次は、buildpack-depsのjessie-scmの冒頭。 [code lang=”docker”] FROM buildpack-deps:jessie-curl [/code] 次は、buildpack-depsのjessie-curlの冒頭。 [code lang=”docker”] FROM debian:jessie [/code] 次は、debianのjessieの冒頭。debianは有名なLinuxディストリビューションですね。 [code lang=”docker”] FROM scratch [/code] <a href="https://hub.docker.com/_/scratch/">scratchのページ</a>にたどり着きました。 下記のようにあります。</p><blockquote><p>an explicitly empty image, especially for building images “FROM scratch”</p></blockquote><p>要するに起点ですね。 これまで辿ってきて、先述のSlideshareを身をもって理解できたわけですよ。 OSはいるんだ、って。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その52 Red Hat Enterprise Linux 7.2でListenしているポートの一覧を表示する</title>
      <link href="/2017/04/22/2102/"/>
      <url>/2017/04/22/2102/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>掲題の通り。<strong>netstat</strong>なのはわかるんですけど、引数がわからないのです。 まぁRHELだけの話ではないですけど。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>こんな感じ。 [code lang=”sh”] $ netstat -tanp | grep LISTEN (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) tcp 0 0 0.0.0.0:5900 0.0.0.0:* LISTEN 30587/vino-server tcp 0 0 0.0.0.0:5901 0.0.0.0:* LISTEN 31497/vino-server tcp 0 0 0.0.0.0:5902 0.0.0.0:* LISTEN 30335/Xvnc tcp 0 0 0.0.0.0:5903 0.0.0.0:* LISTEN 31265/Xvnc tcp 0 0 0.0.0.0:111 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:6002 0.0.0.0:* LISTEN 30335/Xvnc tcp 0 0 0.0.0.0:6003 0.0.0.0:* LISTEN 31265/Xvnc tcp 0 0 192.168.122.1:53 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN - tcp6 0 0 :::5900 :::* LISTEN 30587/vino-server tcp6 0 0 :::5901 :::* LISTEN 31497/vino-server tcp6 0 0 :::5902 :::* LISTEN 30335/Xvnc tcp6 0 0 :::5903 :::* LISTEN 31265/Xvnc tcp6 0 0 :::111 :::* LISTEN - tcp6 0 0 :::6002 :::* LISTEN 30335/Xvnc tcp6 0 0 :::6003 :::* LISTEN 31265/Xvnc tcp6 0 0 :::22 :::* LISTEN - tcp6 0 0 ::1:631 :::* LISTEN - tcp6 0 0 ::1:25 :::* LISTEN - tcp6 20 0 :::2375 :::* LISTEN - tcp6 0 0 :::9000 :::* LISTEN - [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その51 Red Hat Enterprise Linux 7.2にPortainerをインストールする</title>
      <link href="/2017/04/22/2093/"/>
      <url>/2017/04/22/2093/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://wp.me/p7138e-xC">開発メモ その49 Red Hat Enterprise Linux 7.2にshipyardをインストールする</a>にて、<strong>shipyard</strong>をインストールしました。 けど、結論から言うと使えませんでした。 どうやっても管理画面から、コンテナとイメージの一覧が表示されなくて挫折しました。 でも諦めずに調査したら、<strong>Portainer</strong>という管理ツールがあることを知りましたのでこれをインストールしました。 いや、こうやって試すというのはdockerの実地訓練なんですよね。 Portainerの公式は下記です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://portainer.io/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=portainer.io"></img><div class="hbc-site-name">Portainer.io</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Simple Container Management | Kubernetes, Docker, Docker Swarm &amp; ACI UI</div><div class="hbc-url">http://portainer.io/</div><div class="hbc-description">Portainer makes managing containerized software environments quick and easy by giving users a simple &#39;click-to-configure&#39; UI that anyone can…</div></div></div></div></a></div></div><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>まずはじめに、<strong>Docker Remote API</strong>の設定を行います。 これ、公式ドキュメントに書いて無くて苦労しました。 下記のページが参考になりました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://qiita.com/makotoomori@github/items/de0e39c5d67e5c69a741#2-remote-api%E3%81%AE%E8%A8%AD%E5%AE%9A" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DCoreOS%25E3%2581%25A7Docker%25E3%2582%25A4%25E3%2583%25B3%25E3%2582%25B9%25E3%2583%2588%25E3%2583%25BC%25E3%2583%25AB%25E3%2581%2597%25E3%2581%25A6Remote%2520API%25E4%25BD%25BF%25E7%2594%25A8%25E3%2581%2597%25E3%2581%25A6%25E3%2582%25B3%25E3%2583%25B3%25E3%2583%2586%25E3%2583%258A%25E3%2582%2592%25E6%2593%258D%25E4%25BD%259C%25E3%2581%2597%25E3%2581%25A6%25E3%2581%25BF%25E3%2582%258B%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3Db1447726aeac3593302867fc098e7f89&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540makotoomori%2540github%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3D1805a5f2b8dd49aded120176cae6f1d3&blend-align=center%2Cmiddle&blend-mode=normal&s=31de83bc20aa274868d2198a5ebdf085"></img></div><div class="hbc-text"><div class="hbc-title">CoreOSでDockerインストールしてRemote API使用してコンテナを操作してみる - Qiita</div><div class="hbc-url">http://qiita.com/makotoomori@github/items/de0e39c5d67e5c69a741#2-remote-api%E3%81%AE%E8%A8%AD%E5%AE%9A</div><div class="hbc-description">CoreOSとはDockerを利用してコンテナを動かすことに特化した軽量なLinuxディストリビューションの一つです。コンテナを実行させるためのDocker以外にetcd(設定情報共有)、fleet(クラスタリング)などのツールが標...</div></div></div></div></a></div></div><p>Remote APIを設定したら、下記を入力してインストールします。ポート番号は自由に決定できますが、ここは公式と同じ9000にします。 [code lang=”sh”] $ docker run -d -p 9000:9000 –privileged -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer [/code] 注意して欲しいのは、<strong>--priviledged</strong>を付けることです。公式ドキュメントに下記のようにこっそり書いてあります。これに気づかず何度も<strong>docker rm</strong>してはインストールを繰り返していました。</p><blockquote><p>Note: If your host is using SELinux, you’ll need to pass the –privileged flag to the Docker run command:</p></blockquote><p>インストール後、ブラウザから<strong>http://&lt;端末のIP&gt;:9000</strong>でアクセスします。 初回アクセス時に、パスワードの設定を要求されます。<br><a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492789248650.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492789248650.png"></a> 設定したパスワードでログインします。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492789271848.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492789271848.png"></a> 今回は、Portainerのインストール先がDockerホストなので、最初の項目を選択します。 選択後、<strong>Connect</strong>を押下します。この際、Docker Remote APIが設定してなかったり、–privilegedを付与していないと、Unable to connect to the Docker endpointと怒られます。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492790322083.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492790322083.png"></a> 無事に接続すると、管理画面に移行します。 shipyardと異なり、既にコンテナが一つ動いているのがわかります。これはPortainer自身です。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492791754228.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492791754228-1024x662.png"></a> コンテナの一覧画面です。 非常にモダンでわかりやすいです。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492791818000.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-9000-1492791818000-1024x662.png"></a></p><p>以上です。 ここまで長かったです。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> Portainer </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その50 sudoよりsudo -sのが良いらしい</title>
      <link href="/2017/04/22/2091/"/>
      <url>/2017/04/22/2091/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Linuxにまだまだ慣れない私は、<strong>sudo</strong>を便利なコマンドだと思って多用していました。 「とりあえずsudoつけておけばいいや」的な感じで。 でも世間様のblogを見ていると、sudoしている記述例ってあまりないのね。 特に<strong>yum install</strong>なんかその例。何か間違っているの?って思って調べてみました。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>下記のページで良くない理由が(ざっくり)書かれている。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://qiita.com/sksmnagisa/items/fb78f2cc4f5ca85a639e" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=qiita.com"></img><div class="hbc-site-name">Qiita</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Farticle-ogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&w=1200&mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3D%25E3%2580%2590yum%25E3%2580%2591yum%25E3%2581%258C%25E5%258B%2595%25E3%2581%258B%25E3%2581%25AA%25E3%2581%2584%25E3%2581%25A8%25E3%2581%258D%25E3%2581%25AE%25E7%25B0%25A1%25E6%2598%2593%25E5%25AF%25BE%25E5%2587%25A6%25E6%2596%25B9%25E6%25B3%2595%25E9%259B%2586%25EF%25BC%2588IOError%25E3%2580%2581Trying%2520other%2520mirror%25E3%2580%2581Determining%2520fastest%2520mirrors%25E3%2580%2581%25E3%2583%2595%25E3%2583%25AA%25E3%2583%25BC%25E3%2582%25BA%25E2%2580%25A6%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3D05d7e6f04eba97c3cd85af7067ab7976&mark-align=center%2Cmiddle&blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540sksmnagisa%26txt-color%3D%2523333%26txt-font%3DHiragino%2520Sans%2520W6%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3Da3e44e073664e70ee84e01c51190cd5e&blend-align=center%2Cmiddle&blend-mode=normal&s=8085a5c22b01cfd859639464f0a7dc4c"></img></div><div class="hbc-text"><div class="hbc-title">【yum】yumが動かないときの簡易対処方法集（IOError、Trying other mirror、Determining fastest mirrors、フリーズ等） - Qiita</div><div class="hbc-url">http://qiita.com/sksmnagisa/items/fb78f2cc4f5ca85a639e</div><div class="hbc-description">何か昔同じタイトルの記事を見たことあるって人へこの記事は昔やってたブログの記事の移植です。昔の内容で有用そうなものをQiitaに少し修正を加えて移植してます(現在進行形で)。概要yumが正常に動作しない場合には様々...</div></div></div></div></a></div></div><p><strong>sudo -s</strong>でrootになってから実行しましょう、ということらしい。 なので、<a href="http://wp.me/p7138e-xC">前回</a>、<a href="http://wp.me/p7138e-xz">前々回</a>の<strong>Docker</strong>、<strong>shipyard</strong>のインストールで毎回sudoする必要は無かったわけです。 難しいなぁ…</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その49 Red Hat Enterprise Linux 7.2にshipyardをインストールする</title>
      <link href="/2017/04/21/2084/"/>
      <url>/2017/04/21/2084/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://wp.me/p7138e-xz">開発メモ その48 Red Hat Enterprise Linux 7.2にDockerをインストールする</a>にて、<strong>Docker</strong>をインストールしました。 けど、自分はCLIは苦手だし、コマンド覚えるのが嫌です。 GUI万歳!!! というわけで管理ツールを導入します。 Dockerの管理ツールはいくつかありますが、Webで管理できるのは下記の2点</p><ul><li>DockerUI</li><li>shipyard</li></ul><p>があります。 今回は多機能なshipyardを導入します。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>下記のページにて、**/var/run/docker.sock**をマウントすることに危険性を説いています。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://rimuru.lunanet.gr.jp/notes/post/how-to-root-from-inside-container/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=rimuru.lunanet.gr.jp"></img><div class="hbc-site-name">rimuru.lunanet.gr.jp</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Dockerコンテナ内からホストマシンのルートを取る具体的な方法（あるいは/var/run/docker.sockを晒すことへの注意喚起） | 48JIGEN *Reloaded*</div><div class="hbc-url">https://rimuru.lunanet.gr.jp/notes/post/how-to-root-from-inside-container/</div></div></div></div></a></div></div><p>特にshipyardについても言及しています。 対応策が語られていないのですが、そういうものだと割り切ります。 このあたり、本番環境に導入するというのは自己責任ですね。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>インストール方法自体は、非常にシンプルです。 [code lang=”sh”] $ curl -s <a href="https://shipyard-project.com/deploy">https://shipyard-project.com/deploy</a> | bash -s [/code] ですが、上の方法だと、下記のメッセージが表示されてしまい、実行できませんでした。 [code lang=”sh”] /usr/bin/docker-current: Cannot connect to the Docker daemon. Is the docker daemon running on this host?. See ‘/usr/bin/docker-current run –help’. Deploying Shipyard -&gt; Starting Database /usr/bin/docker-current: Cannot connect to the Docker daemon. Is the docker daemon running on this host? [/code] dockerのサービスデーモンが実行されていないのでは？というメッセージですが、<strong>sudo service docker status</strong>を実行すると正しく動作していることは示しています。 ですが、<strong>docker ps</strong>だと、同じように<strong>Cannot connect to the Docker daemon. Is the docker daemon running on this host?**を表示されます。 そこでふと思ったのが、</strong>sudo<strong>したらどうなる?と思って実行したら、</strong>sudo dcker ps<strong>が成功しました。 なので、先述のインストールコマンドも [code lang=”sh”] $ curl -s <a href="https://shipyard-project.com/deploy">https://shipyard-project.com/deploy</a> | sudo bash -s [/code] することで動作しました。 気づくのに時間がかかりました。 ここで注意するのは、上のコマンド、先述の</strong>/var/run/docker.sock**をマウントするコマンドが実行される点です。 これだけは認識しておいてください。 さて、上のコマンドでDockerにコンテナが追加されました。 shipyard自体がコンテナで実行されるアプリケーションです。 それなのに、自分以外のコンテナの状態を管理するツールになり得るのは、/var/run/docker.sockをマウントして色々やっているからとのことです インストールが完了すると、 [code lang=”sh”] Waiting for Shipyard on 端末のIP:8080<br>Shipyard available at http://&lt;端末のIP&gt;:8080 Username: admin Password: shipyard [/code] と表示されます。 パスワードはデフォルトは危険なのですぐに変えましょう。 外部のブラウザから、http://&lt;端末のIP&gt;:8080でアクセスすると、下記の美しいログイン画面が表示されます。<br><a href="../../../../public/2017/04/screencapture-192-168-11-18-8080-1492772353772.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-8080-1492772353772.png"></a> ログイン後の画面。 <a href="../../../../public/2017/04/screencapture-192-168-11-18-8080-1492772412394.png"><img src="../../../../public/2017/04/screencapture-192-168-11-18-8080-1492772412394.png"></a><br> 以上です。</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> shipyard </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その48 Red Hat Enterprise Linux 7.2にDockerをインストールする</title>
      <link href="/2017/04/21/2081/"/>
      <url>/2017/04/21/2081/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>.NET Core</strong>を試したくなったけど、環境を汚すのが嫌なので、<strong>Docker</strong>をインストールし、そこで遊んでみることにしました。 とは言っても、Dockerを触ったことはないので、インストール方法含めて、メモを残します。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>インストール方法自体は、Redhatの公式ページに記載してあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://jp-redhat.com/migration/docker/article.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=jp-redhat.com"></img><div class="hbc-site-name">jp-redhat.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">今日からできるDocker on RHEL7 | Docker on Red Hat Enterprise Linux 7</div><div class="hbc-url">http://jp-redhat.com/migration/docker/article.html</div></div></div></div></a></div></div><p>[code lang=”sh”] # インストール # RHEL 7 の Extrasチャンネル(rhel-7-server-extras-rpms)を有効化 $ subscription-manager repos –enable=rhel-7-server-extras-rpms $ sudo yum install docker -y<br># Dockerサービスを開始する # systemd で docker サービスを開始します。初回サービス開始時にコンテナーのデータ領域を確保する処理を行うため、初回のサービス起動には少し時間がかかります。 $ sudo systemctl start docker.service $ sudo systemctl enable docker.service [/code] 起動状態は下記で確認できます。 [code lang=”sh”] $ sudo systemctl status docker.service ● docker.service - Docker Application Container Engine Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled) Active: active (running) since 金 2017-04-21 00:05:56 JST; 51s ago Docs: <a href="http://docs.docker.com/">http://docs.docker.com</a> Main PID: 5211 (dockerd-current) CGroup: /system.slice/docker.service ├─5211 /usr/bin/dockerd-current –add-runtime docker-runc=/usr/libexec/docker/docker-runc-current –default-runtime=docker-runc –authorization-plugin=rhel-push-plugin… └─5218 /usr/bin/docker-containerd-current -l unix:///var/run/docker/libcontainerd/docker-containerd.sock –shim docker-containerd-shim –metrics-interval=0 –start-tim…<br>4月 21 00:05:55 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:55.505085195+09:00” level=info msg=”devmapper: Successfully created filesystem xfs on devi…5409-base” 4月 21 00:05:55 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:55.877823056+09:00” level=info msg=”Graph migration to content-addressability took 0.00 seconds” 4月 21 00:05:55 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:55.879686801+09:00” level=info msg=”Loading containers: start.” 4月 21 00:05:55 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:55.965820706+09:00” level=info msg=”Firewalld running: true” 4月 21 00:05:56 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:56.449814977+09:00” level=info msg=”Default bridge (docker0) is assigned with an IP addres…P address” 4月 21 00:05:56 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:56.911254692+09:00” level=info msg=”Loading containers: done.” 4月 21 00:05:56 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:56.912002456+09:00” level=info msg=”Daemon has completed initialization” 4月 21 00:05:56 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:56.912069092+09:00” level=info msg=”Docker daemon” commit=”3a094bd/1.12.6” graphdriver=dev…ion=1.12.6 4月 21 00:05:56 takuya-redhat dockerd-current[5211]: time=”2017-04-21T00:05:56.927181794+09:00” level=info msg=”API listen on /var/run/docker.sock” 4月 21 00:05:56 takuya-redhat systemd[1]: Started Docker Application Container Engine. Hint: Some lines were ellipsized, use -l to show in full. [/code]</p>]]></content>
      
      
      <categories>
          
          <category> 仮想化 </category>
          
          <category> Docker </category>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その47 Red Hat Enterprise Linux 7.2にVNC Serverをインストールする</title>
      <link href="/2017/04/20/2079/"/>
      <url>/2017/04/20/2079/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://wp.me/p7138e-xt">開発メモ その46 Redhat上のTeamViewerが反応しない</a>で<strong>TeamViewer</strong>が使えないような状態になったので、TeamViewerに見切りをつけて、<strong>VNC</strong>をインストールすることにする。 最短で利用できるメモ。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>想定しているVNCは<strong>tigervnc-server</strong>。 2017/04/20時点でバージョンは1.3.1-9.el7。 コマンドは下記。適宜sudoするなりする。 [code lang=”sh”] $ yum install tigervnc-server $ cp -a /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service<br># <USER>をログインユーザ名に変更 $ vi /etc/systemd/system/vncserver@:1.service<br>$ systemctl daemon-reload<br># 自動起動の有効化 $ systemctl enable vncserver@:1.service<br># 起動 $ systemctl start vncserver@:1.service<br># ファイアウォールの設定を変更してポート開放 firewall-cmd –add-service=vnc-server –permanent firewall-cmd –reload [/code] 接続ポートは5901でつなげます。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> VNC </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その46 Redhat上のTeamViewerが反応しない</title>
      <link href="/2017/04/20/2075/"/>
      <url>/2017/04/20/2075/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Redhat</strong>上で起動している<strong>TeamViewer</strong>にWindowsからアクセスすると、パスワード認証は成功するのだが、画面が真っ暗である。<br><a href="../../../../public/2017/04/af84a45524f0bf705ede38cbf96fee0b.png"><img src="../../../../public/2017/04/af84a45524f0bf705ede38cbf96fee0b-1024x820.png"></a><br> 何これ?</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>公式のKBに </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://community.teamviewer.com/t5/Knowledge-Base/Why-do-I-only-see-a-black-screen-after-connection-establishment/ta-p/4773" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=community.teamviewer.com"></img><div class="hbc-site-name">community.teamviewer.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Why do I only see a black screen after connection establishment?</div><div class="hbc-url">https://community.teamviewer.com/t5/Knowledge-Base/Why-do-I-only-see-a-black-screen-after-connection-establishment/ta-p/4773</div><div class="hbc-description">Read this article in Chinese | French | German | Japanese | Spanish   This article applies to all TeamViewer users.   General Occasionally w…</div></div></div></div></a></div></div><blockquote><p>In most cases you can already solve this problem by updating both sides of the connection to the newest release available within your major version.</p></blockquote><p>とあったので、とりあえず、最新のTeamViewerに更新する。 sshでログインして下記を実行。 [code lang=”sh”] $ wget <a href="https://download.teamviewer.com/download/teamviewer.i686.rpm">https://download.teamviewer.com/download/teamviewer.i686.rpm</a> $ suod yum localinstall teamviewer.i686.rpm 読み込んだプラグイン:langpacks, product-id, search-disabled-repos, subscription-manager teamviewer.i686.rpm を調べています: teamviewer-12.0.76279-0.i686 次のリポジトリーへの更新として teamviewer.i686.rpm を設定します: teamviewer-12.0.71510-0.i686 依存性の解決をしています –&gt; トランザクションの確認を実行しています。 —&gt; パッケージ teamviewer.i686 0:12.0.71510-0 を 更新 —&gt; パッケージ teamviewer.i686 0:12.0.76279-0 を アップデート –&gt; 依存性解決を終了しました。<br>依存性を解決しました<br>========================================================================================================================================= Package アーキテクチャー バージョン リポジトリー 容量 ========================================================================================================================================= 更新します: teamviewer i686 12.0.76279-0 /teamviewer.i686 143 M<br>トランザクションの要約 ========================================================================================================================================= 更新 1 パッケージ<br>合計容量: 143 M Is this ok [y/d/N]:y Downloading packages: Running transaction check Running transaction test Transaction test succeeded Running transaction 更新します : teamviewer-12.0.76279-0.i686 1/2 Removed symlink /etc/systemd/system/multi-user.target.wants/teamviewerd.service. gtk-update-icon-cache: Cache file created successfully. 整理中 : teamviewer-12.0.71510-0.i686 2/2 検証中 : teamviewer-12.0.76279-0.i686 1/2 検証中 : teamviewer-12.0.71510-0.i686 2/2<br>更新: teamviewer.i686 0:12.0.76279-0<br>完了しました! [/code]</p><h2 id="でも変わらず真っ黒-ﾟдﾟ"><a href="#でも変わらず真っ黒-ﾟдﾟ" class="headerlink" title="でも変わらず真っ黒(ﾟдﾟ)"></a>でも変わらず真っ黒(ﾟдﾟ)</h2><p>もうTeamViewer止めようかな….</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> TeamViewer </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その45 Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast</title>
      <link href="/2017/04/20/2068/"/>
      <url>/2017/04/20/2068/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>yum list</strong>でパッケージの一覧を確認しようと思ったら表示されたのが掲題のメッセージ。 [code lang=”sh”] $ yum list 読み込んだプラグイン:langpacks, product-id, search-disabled-repos, subscription-manager Repo rhel-rs-for-rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-ha-for-rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-eus-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rt-beta-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-rs-for-rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-ha-for-rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repo rhel-7-server-rt-rpms forced skip_if_unavailable=True due to: /etc/pki/entitlement/7836591386407218947-key.pem Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast [/code] 何これ?</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>Google先生に確認したところ下記のページを確認。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://coderinthebox.com/howto/repodata-is-2-weeks-old-install-yum-cron-run-or-yum-makecache-fast/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=coderinthebox.com"></img><div class="hbc-site-name">Coder in the Box</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://i0.wp.com/coderinthebox.com/wp-content/uploads/2016/01/server-management-video-series.jpg?fit=1280%2C720&ssl=1"></img></div><div class="hbc-text"><div class="hbc-title">YUM: Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast - Coder in the Box</div><div class="hbc-url">https://coderinthebox.com/howto/repodata-is-2-weeks-old-install-yum-cron-run-or-yum-makecache-fast/</div><div class="hbc-description">Have you ever ecounter this error &quot;Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast&quot;?  If you are running a server…</div></div></div></div></a></div></div><p>数週間、アクティブなリポジトリに接続できなかった場合に表示される模様。 解決は下記。 [code lang=”sh”] $ yum clean all [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi 3をUSBからブートする (失敗)</title>
      <link href="/2017/04/19/2033/"/>
      <url>/2017/04/19/2033/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回、SDカードを使ってマウス、キーボード、ディスプレイなしで<strong>Raspberry Pi 3</strong>のセットアップを完了。 でも、SDカードって信用できないのね。 USBメモリのがまだましって感じ。 USBメモリのが扱いやすいしね。 あんな小さい筐体に32GBや64GBとか狂気の沙汰やで。 今回は下記を参考にしてセットアップしました。 有益な情報ありがとうございます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://jyn.jp/raspberrypi-usb-only-boot/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=jyn.jp"></img><div class="hbc-site-name">純規の暇人趣味ブログ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://jyn.jp/wp-core/wp-content/uploads/2016/05/raspberrypi-usb-boot-001.jpg"></img></div><div class="hbc-text"><div class="hbc-title">Raspberry PiをUSB(HDD)だけで動かす(SD不要) | 純規の暇人趣味ブログ</div><div class="hbc-url">https://jyn.jp/raspberrypi-usb-only-boot/</div><div class="hbc-description">「Raspberry PiをUSB(HDD)で起動させる」というやり方は既にあります。しかし、これは単にデータ(OS)の部分をHDDに移しただけであり、依然としてブートローダとなるSDカードは必要でした。比較的新しめのRaspberry Piでは、ブートローダーとなるSDカードす…</div></div></div></div></a></div></div><h1 id="用意するもの"><a href="#用意するもの" class="headerlink" title="用意するもの"></a>用意するもの</h1><ul><li>USBメモリ</li></ul><p>以上。</p><h1 id="ファームウェア更新"><a href="#ファームウェア更新" class="headerlink" title="ファームウェア更新"></a>ファームウェア更新</h1><p>新しいファームでないとUSBブートはできない模様。 下記のブログによれば、安易に後述のコマンドで更新するのは非推奨の模様。 </p><p>[code lang=”sh”] # まずはパッケージリストを更新 sudo apt-get update # ファームウェアの最新版を取得 sudo apt-get install -y rpi-update # 更新を実行 sudo rpi-update<br># USBブートを有効 echo “program_usb_boot_mode=1” | sudo tee -a /boot/config.txt<br># 再起動 sudo shutdown -r now [/code] 再起動後、下記の結果になることを確認。 [code lang=”sh”] $ vcgencmd otp_dump | grep 17: 17:3020000a [/code]</p><h1 id="USBにパーティションを作成"><a href="#USBにパーティションを作成" class="headerlink" title="USBにパーティションを作成"></a>USBにパーティションを作成</h1><p>USBを差し込みます。 当然、この後フォーマットするからデータが消えます。 差し込んだ後、下記のコマンドで、Deviceに差し込んだUSBが表示されていることを確認。 [code lang=”sh”] # sudo fdisk -l<br>Device Boot Start End Sectors Size Id Type /dev/mmcblk0p1 8192 92159 83968 41M c W95 FAT32 (LBA) /dev/mmcblk0p2 92160 62333951 62241792 29.7G 83 Linux<br>Disk /dev/sda: 28.9 GiB, 30995906560 bytes, 60538880 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x545445f1<br>Device Boot Start End Sectors Size Id Type /dev/sda1 * 8064 60538879 60530816 28.9G c W95 FAT32 (LBA) [/code] <strong>/dev/sda</strong>にデバイスがあることが確認できたので、下記のコマンドでパーティションを作成します。 しかし、<strong>sudo fdisk -l</strong>でデバイスが使用中になってしまった模様。 なので、再起動します。 [code lang=”sh”] $ sudo parted /dev/sda GNU Parted 3.2 Using /dev/sda Welcome to GNU Parted! Type ‘help’ to view a list of commands. (parted) mktable msdos Warning: Partition(s) on /dev/sda are being used. Ignore/Cancel? Ignore Warning: The existing disk label on /dev/sda will be destroyed and all data on this disk will be lost. Do you want to continue? Yes/No? Yes Error: Partition(s) 1 on /dev/sda have been written, but we have been unable to inform the kernel of the change, probably because it/they are in use. As a result, the old partition(s) will remain in use. You should reboot now before making further changes. Ignore/Cancel? Ignore [/code] 再起動後、再度コマンドを実施。 [code lang=”sh”] $ sudo parted /dev/sda GNU Parted 3.2 Using /dev/sda Welcome to GNU Parted! Type ‘help’ to view a list of commands. (parted) mktable msdos Warning: The existing disk label on /dev/sda will be destroyed and all data on this disk will be lost. Do you want to continue? Yes/No? Yes (parted) mkpart primary fat32 0% 100M (parted) mkpart primary ext4 100M 100% (parted) print Model: TDK LoR TF10 (scsi) Disk /dev/sda: 31.0GB Sector size (logical/physical): 512B/512B Partition Table: msdos Disk Flags:<br>Number Start End Size Type File system Flags 1 1049kB 99.6MB 98.6MB primary fat32 lba 2 99.6MB 31.0GB 30.9GB primary ext4 lba<br>(parted) quit Information: You may need to update /etc/fstab. [/code] 上記によって、**/dev/sda1<strong>と</strong>/dev/sda2**が作成されます。 続いて、フォーマット [code lang=”sh”] $ sudo mkfs.vfat -n BOOT -F 32 /dev/sda1 sudo mkfs.ext4 /dev/sda2mkfs.fat 3.0.27 (2014-11-12) $ sudo mkfs.ext4 /dev/sda2 mke2fs 1.42.12 (29-Aug-2014) Creating filesystem with 7543040 4k blocks and 1888656 inodes Filesystem UUID: 4b3bdbe7-f63e-46a4-ad88-7e2a00bd40a1 Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 4096000<br>Allocating group tables: done Writing inode tables: done Creating journal (32768 blocks): done Writing superblocks and filesystem accounting information: done [/code]</p><h1 id="SDカードの複製"><a href="#SDカードの複製" class="headerlink" title="SDカードの複製"></a>SDカードの複製</h1><p>SDカードに全データが入っている状態なので、USBにコピーします。 <strong>rsync</strong>で複製ができる模様。 [code lang=”sh”] $ sudo apt-get install -y rsync [/code] 次に、フォーマットした領域をマウントします。 Linuxは直接デバイスにアクセスするのに<strong>mount</strong>が必要なので面倒。 いや、Windowsも背後でExplorerに表示するために、ドライブという形でマウントはしているんですけど… 下記は、**/mnt/target<strong>、</strong>/mnt/target/boot<strong>を作成し、そこにそれぞれ</strong>/dev/sda2<strong>と</strong>/dev/sda2**をマウントします。 その後、rsyncでコピーを開始します。 [code lang=”sh”] sudo mkdir -p /mnt/target sudo mount /dev/sda2 /mnt/target/ sudo mkdir /mnt/target/boot sudo mount /dev/sda1 /mnt/target/boot/ sudo rsync -ax –progress / /boot /mnt/target [/code]</p><h1 id="ブート情報の編集"><a href="#ブート情報の編集" class="headerlink" title="ブート情報の編集"></a>ブート情報の編集</h1><p>参考ページの手順だと上手くいきませんでしたので、頑張って調べました。 まず、デバイスを一意に識別する<strong>PARTUUID</strong>を調べます。 これにより、デバイスファイル名が変わっても安心。 [code lang=”sh”] sudo blkid /dev/mmcblk0p1: LABEL=”boot” UUID=”95E0-9AC4” TYPE=”vfat” PARTUUID=”85d563bf-01” /dev/mmcblk0p2: UUID=”b105f9a8-f450-4976-8ac8-69053f57bab4” TYPE=”ext4” PARTUUID=”85d563bf-02” /dev/sda1: LABEL=”BOOT” UUID=”87CD-DAAB” TYPE=”vfat” PARTUUID=”a40eeb1f-01” /dev/mmcblk0: PTUUID=”85d563bf” PTTYPE=”dos” /dev/sda2: UUID=”4b3bdbe7-f63e-46a4-ad88-7e2a00bd40a1” TYPE=”ext4” PARTUUID=”a40eeb1f-02” [/code] 次に**/mnt/target/boot/cmdline.txt<strong>を確認します。 **cmdline.txt</strong>は、起動時にLinux Kernelに渡されるコマンド引数を記述したテキストとのこと。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://elinux.org/RPi_cmdline.txt" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=elinux.org"></img><div class="hbc-site-name">elinux.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">RPi cmdline.txt - eLinux.org</div><div class="hbc-url">http://elinux.org/RPi_cmdline.txt</div></div></div></div></a></div></div><p>[code lang=”sh”] cat /mnt/target/boot/cmdline.txt dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=PARTUUID=85d563bf-02 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles [/code] <strong>root=PARTUUID=85d563bf-02</strong>になっているのを修正する必要があります。 そこで先ほどの<strong>blkid</strong>で調べたPARTUUIDを調べます。 USBメモリのext4になっているPARTUUIDは<strong>a40eeb1f-02</strong>になります。 続いて、**/mnt/target/etc/fstab<strong>を確認します。 **fstab</strong>は<strong>file system table</strong>の略らしい。 起動時に<strong>mount</strong>に読み込まれるコマンドになります。 [code lang=”sh”] $ cat /mnt/target/etc/fstab proc /proc proc defaults 0 0 PARTUUID=85d563bf-01 /boot vfat defaults 0 2 PARTUUID=85d563bf-02 / ext4 defaults,noatime 0 1 # a swapfile is not a swap partition, no line here # use dphys-swapfile swap[on|off] for that [/code] <strong>PARTUUID=85d563bf</strong>はSDカードを指しています。 これを<strong>a40eeb1f</strong>に置換すれば、全部変換できそうです。 以上より、下記のコマンドでファイルを書き換えます。 当然、上述のPARTUUIDは環境依存ですので適宜書き換えてください。 [code lang=”sh”] sudo sed -i.bak “s,85d563bf,a40eeb1f,” /mnt/target/boot/cmdline.txt sudo sed -i.bak “s,85d563bf,a40eeb1f,” /mnt/target/etc/fstab [/code] ちなみに、<strong>sed</strong>はテキストとかの文字列を編集したりするコマンド。 String Editorの略だと思っていたら、<strong>Stream Editor</strong>の略らしい。 <strong>-i.bak</strong>で拡張子bakで編集前のファイルのバックアップを取ってから**i(in place)**を実行します。</p><h1 id="再起動"><a href="#再起動" class="headerlink" title="再起動"></a>再起動</h1><p>アンマウントして再起動します。 再起動と言っても、一度SDカードを抜く必要があるので、電源を落とします。 [code lang=”sh”] cd ~ sudo umount /mnt/target/boot sudo umount /mnt/target sudo shutdown -h now [/code] 電源が落ちたら、SDカードを抜いて、電源プラグを差し直します。 するとまた勝手に起動します。</p><h2 id="起動しない-ﾟдﾟ"><a href="#起動しない-ﾟдﾟ" class="headerlink" title="起動しない(ﾟдﾟ)"></a>起動しない(ﾟдﾟ)</h2><p>なんでやねん。 最新版はダメなのか、USBメモリがダメなのか、原因は不明。 とりあえず今回はここまで。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> IoT </category>
          
          <category> iot </category>
          
          <category> Raspbian </category>
          
          <category> Raspberry Pi </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MAXPATH</title>
      <link href="/2017/04/19/2061/"/>
      <url>/2017/04/19/2061/</url>
      
        <content type="html"><![CDATA[<p>[[“”,”\u30ed\u30fc\u30ab\u30eb\u30b0\u30eb\u30fc\u30d7\u30dd\u30ea\u30b7\u30fc\u6709\u52b9”,”#colspan#”,”\u30ed\u30fc\u30ab\u30eb\u30b0\u30eb\u30fc\u30d7\u30dd\u30ea\u30b7\u30fc\u7121\u52b9”,”#colspan#”],[“”,”App.config\u3042\u308a”,”App.config\u306a\u3057”,”App.config\u3042\u308a”,”App.config\u306a\u3057”],[“.NET 4.6.2”,”OK”,”OK”,”DirectoryNotFoundException”,”DirectoryNotFoundException”],[“.NET 4.6.1”,”OK”,”PathTooLongException”,”DirectoryNotFoundException”,”PathTooLongException”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OSS PullRequests</title>
      <link href="/2017/04/19/2062/"/>
      <url>/2017/04/19/2062/</url>
      
        <content type="html"><![CDATA[<p>[[“Date”,”Site”,”Url”,”Title”,”Result”],[“2017\/08\/20”,”github”,”<a href="%22https://github.com/Terminals-Origin/Terminals/pull/79%22">https:\/\/github.com\/Terminals-Origin\/Terminals\/pull\/79&lt;\/a&gt;”,”Fixed ConnectionLost event blocks thread”,”Merged”],[“2017\/05\/18”,”github”,”</a><a href="%22https://github.com/Terminals-Origin/Terminals/pull/28%22">https:\/\/github.com\/Terminals-Origin\/Terminals\/pull\/28&lt;\/a&gt;”,”Vnc session crashes if click non-client area”,”Merged”],[“2017\/05\/13”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/pull/350%22">https:\/\/github.com\/shimat\/opencvsharp\/pull\/350&lt;\/a&gt;”,”Support WhileBalance”,”Merged”],[“2017\/05\/06”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/pull/347%22">https:\/\/github.com\/shimat\/opencvsharp\/pull\/347&lt;\/a&gt;”,”Add LshIndexParams”,”Merged”],[“2017\/05\/06”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/pull/346%22">https:\/\/github.com\/shimat\/opencvsharp\/pull\/346&lt;\/a&gt;”,”#349: FastFeatureDetector does not work”,”Merged”],[“2017\/05\/06”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/pull/344%22">https:\/\/github.com\/shimat\/opencvsharp\/pull\/344&lt;\/a&gt;”,”Support Tracking module”,”Merged”],[“2017\/05\/02”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/pull/343%22">https:\/\/github.com\/shimat\/opencvsharp\/pull\/343&lt;\/a&gt;”,”#292: Support ArUco”,”Merged”],[“2017\/03\/30”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/pull/336%22">https:\/\/github.com\/shimat\/opencvsharp\/pull\/336&lt;\/a&gt;”,”#331: SURF detector fails”,”Merged”],[“2017\/03\/21”,”github”,”</a><a href="%22https://github.com/shimat/opencvsharp/pull/330%22">https:\/\/github.com\/shimat\/opencvsharp\/pull\/330&lt;\/a&gt;”,”#329: Mat.Diag(Mat) does not reutrn a square diagonal matrix”,”Merged”],[“2016\/03\/24”,”github”,”</a><a href="%22https://github.com/Microsoft/CNTK/pull/237%22">https:\/\/github.com\/Microsoft\/CNTK\/pull\/237&lt;\/a&gt;”,”Fix Missing api-ms-win-core-path-l1-1-0.dll #224”,”Merged”]]</a></p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>紋様</title>
      <link href="/2017/04/19/2060/"/>
      <url>/2017/04/19/2060/</url>
      
        <content type="html"><![CDATA[<p>[[“\u548c\u540d”,”\u82f1\u8a9e”,”\u7565”],[“\u6e26\u72b6\u7d0b”,”Whorls”,”W”],[“\u5f13\u72b6\u7d0b”,”Arch”,”A”],[“\u8e44\u72b6\u7d0b”,”Loops”,”L”],[“\u7a81\u8d77\u5f13\u72b6\u7d0b”,”Tented Arch”,”T”],[“\u5074\u8e44\u72b6\u7d0b”,”Right Loop”,”R”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Compact</title>
      <link href="/2017/04/19/2057/"/>
      <url>/2017/04/19/2057/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30c7\u30fc\u30bf\/\u30b3\u30ec\u30af\u30b7\u30e7\u30f3”,”SmallObjectData”,”#colspan#”,”MiddleObjectData”,”#colspan#”,”LargeObjectData”,”#colspan#”,”LargeData”,”#colspan#”,”Data”,”#colspan#”],[“#colspan#”,”Before”,”After”,”Before”,”After”,”Before”,”After”,”Before”,”After”,”Before”,”After”],[“Collections (incl. system.namespaces)”,”1”,”1”,”1”,”1”,”1”,”1”,”1”,”1”,”1”,”1”],[“Data Size”,”51.0 mb”,”51.0 mb”,”80.1 gb”,”80.1 gb”,”100 gb”,”100 gb”,”100 gb”,”100 gb”,”51.0 mb”,”51.0 mb”],[“Storage Size”,”14.4 mb”,”14.4 mb”,”4.12 gb”,”4.12 gb”,”8.22 gb”,”8.22 gb”,”8.22 gb”,”8.22 gb”,”14.4 mb”,”14.3 mb”],[“Avg Obj Size #”,”51.0 bytes”,”51.0 bytes”,”80.1 kb”,”80.1 kb”,”100 kb”,”100 kb”,”100 kb”,”100 kb”,”51.0 bytes”,”51.0 bytes”],[“Objects #”,”1000000”,”1000000”,”1000000”,”1000000”,”1000000”,”1000000”,”1000000”,”1000000”,”1000000”,”1000000”],[“Extents #”,”0”,”0”,”0”,”0”,”0”,”0”,”0”,”0”,”0”,”0”],[“Indexes #”,”2”,”2”,”2”,”2”,”2”,”2”,”1”,”1”,”1”,”1”],[“Index Size”,”19.7 mb”,”19.7 mb”,”19.7 mb”,”19.7 mb”,”19.7 mb”,”19.7 mb”,”8.91 mb”,”8.91 mb”,”8.92 mb”,”8.92 mb”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで○○○を試してみる 一覧</title>
      <link href="/2017/04/19/2058/"/>
      <url>/2017/04/19/2058/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30b7\u30ea\u30fc\u30ba\u540d”,”\u958b\u59cb\u6642\u671f”],[“.NET\u3067RPC\u3092\u8a66\u3057\u3066\u307f\u308b Apache Thrift\u7de8”,”2017\u5e744\u6708”],[“.NET\u3067RPC\u3092\u8a66\u3057\u3066\u307f\u308b gRPC\u7de8”,”2017\u5e743\u6708”],[“.NET\u3067\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\u3092\u8a66\u3057\u3066\u307f\u308b SharpPcap\u7de8”,”2017\u5e743\u6708”],[“.NET\u3067\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\u3092\u8a66\u3057\u3066\u307f\u308b Pcap.Net\u7de8”,”2017\u5e743\u6708”],[“.NET\u3067\u97f3\u58f0\u51e6\u7406\u3092\u8a66\u3057\u3066\u307f\u308b NAudio\u7de8”,”2017\u5e743\u6708”],[“.NET\u3067Python\u3092\u8a66\u3057\u3066\u307f\u308b”,”2017\u5e742\u6708”],[“.NET\u3067IBM Bluemix\u3092\u8a66\u3057\u3066\u307f\u308b”,”2016\u5e748\u6708”],[“.NET\u3067\u9854\u8a8d\u8b58\u3092\u8a66\u3057\u3066\u307f\u308b Microsoft Cognitive Services Face\u7de8”,”2016\u5e744\u6708”],[“.NET\u3067OneDrive\u3092\u8a66\u3057\u3066\u307f\u308b”,”2016\u5e743\u6708”],[“NET\u3067\u30c7\u30a3\u30fc\u30d7\u30e9\u30fc\u30cb\u30f3\u30b0\u3092\u8a66\u3057\u3066\u307f\u308b CNTK\u7de8”,”2016\u5e743\u6708”],[“.NET\u3067GPUPU\u3092\u8a66\u3057\u3066\u307f\u308b CUDA\u7de8”,”2016\u5e741\u6708”],[“.NET\u3067NoSQL\u3092\u8a66\u3057\u3066\u307f\u308b MongoDB\u7de8”,”2015\u5e7412\u6708”],[“.NET\u3067\u753b\u50cf\u51e6\u7406\u3092\u8a66\u3057\u3066\u307f\u308b OpenCVSharp\u7de8”,”2015\u5e7412\u6708”],[“.NET\u3067\u96e3\u8aad\u5316\u3092\u8a66\u3057\u3066\u307f\u308b”,”2012\u5e745\u6708”],[“.NET\u3067\u30b3\u30fc\u30c9 \u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3092\u8a66\u3057\u3066\u307f\u308b”,”2012\u5e744\u6708”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.Forms</title>
      <link href="/2017/04/19/2059/"/>
      <url>/2017/04/19/2059/</url>
      
        <content type="html"><![CDATA[<p>[[“\u7a2e\u985e”,”\u5185\u5bb9”],[“Forms ContentPage”,”cs\u30d5\u30a1\u30a4\u30eb”],[“Forms ContentView”,”cs\u30d5\u30a1\u30a4\u30eb”],[“Forms Xaml Page”,”cs\u30d5\u30a1\u30a4\u30eb\r\nXaml\u30d5\u30a1\u30a4\u30eb”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB パフォーマンス3</title>
      <link href="/2017/04/19/2054/"/>
      <url>/2017/04/19/2054/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b5\u30a4\u30ba\/\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6570”,”1,000,000”],[“Small (\t51.0 bytes)”,”420.8 ms”],[“Middle (80.1 kb)”,”221577.1 ms”],[“Large (100 kb)”,”\u8a08\u6e2c\u4e0d\u53ef”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB パフォーマンス4</title>
      <link href="/2017/04/19/2055/"/>
      <url>/2017/04/19/2055/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b5\u30a4\u30ba\/\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6570”,”1,000,000”,”1,000,000 (\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u9069\u7528\u5f8c)”],[“Small (51.0 bytes)”,”420.8 ms”,”610.8 ms”],[“Middle (80.1 kb)”,”221577.1 ms”,”586 ms”],[“Large (100 kb)”,”\u8a08\u6e2c\u4e0d\u53ef”,”588 ms”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB パフォーマンス5</title>
      <link href="/2017/04/19/2056/"/>
      <url>/2017/04/19/2056/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b5\u30a4\u30ba\/\u691c\u7d22\u7d50\u679c\u6570”,”10”,”100”,”1,000”,”10,000”,”100,000”],[“Small (51.0 bytes)”,”610.8 ms”,”515.6 ms”,”558.5 ms”,”582.8 ms”,”956.2 ms”],[“Middle (80.1 kb)”,”586 ms”,”512 ms”,”1571.4 ms”,”7171.2 ms”,”\u8a08\u6e2c\u4e0d\u53ef”],[“Large (100 kb)”,”588 ms”,”494.7 ms”,”1870.2 ms”,”11292.6 ms”,”\u8a08\u6e2c\u4e0d\u53ef”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB パフォーマンス1</title>
      <link href="/2017/04/19/2052/"/>
      <url>/2017/04/19/2052/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\/\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6570”,”1,000,000”],[“Drop”,”228.5 ms”],[“Insert (One)”,”132881.25 ms”],[“Insert (Many)”,”131191.67 ms”],[“Select (Count\u3060\u3051)”,”11 ms”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB パフォーマンス2</title>
      <link href="/2017/04/19/2053/"/>
      <url>/2017/04/19/2053/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\/\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6570”,”25,000”,”1,000,000”],[“Drop”,”235 ms”,”246.3 ms”],[“Insert (One)”,”16815 ms”,”818100 ms”],[“Insert (Many)”,”19671 ms”,”\u8a08\u6e2c\u4e0d\u53ef”],[“Select (Count\u3060\u3051)”,”14.67 ms”,”\u8a08\u6e2c\u4e0d\u53ef”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OpenCV2 Performance Test</title>
      <link href="/2017/04/19/2051/"/>
      <url>/2017/04/19/2051/</url>
      
        <content type="html"><![CDATA[<p>[[“\u7a2e\u5225\/\u30eb\u30fc\u30d7\u6570”,”100”,”1000”,”10000”],[“Sequential”,”228.6666667 ms”,”2270 ms\r\n”,”22841.66667 ms”],[“OpenCV”,”86.66666667 ms”,”853.6666667 ms”,”8483.333333 ms”],[“Optimized”,”128.6666667 ms”,”961.6666667 ms”,”9478 ms”],[“Optimized (Parallel)”,”88 ms”,”979.3333333 ms”,”9556 ms”],[“Optimized (C++\/CLI)”,”69.33333333 ms”,”582 ms”,”5680.333333 ms”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Certifications</title>
      <link href="/2017/04/19/2049/"/>
      <url>/2017/04/19/2049/</url>
      
        <content type="html"><![CDATA[<p>[[“\u8cc7\u683c\u540d”,”\u767a\u884c\u5143”,”\u53d6\u5f97\u6642\u671f”],[“\u666e\u901a\u81ea\u52d5\u8eca\u514d\u8a311\u7a2e”,”\u516c\u5b89\u59d4\u54e1\u4f1a”,”2005\u5e7410\u6708”],[“\u57fa\u672c\u60c5\u5831\u6280\u8853\u8005”,”\u7d4c\u6e08\u7523\u696d\u7701”,”2007\u5e74”],[“\u5fdc\u7528\u60c5\u5831\u6280\u8853\u8005”,”\u7d4c\u6e08\u7523\u696d\u7701”,”2009\u5e74”],[“MCA Platform”,”Microsoft”,”2009\u5e741\u6708\r\n”],[“MCA Application”,”Microsoft”,”2009\u5e742\u6708”],[“MCA Security”,”Microsoft”,”2009\u5e742\u6708”],[“MCA Database”,”Microsoft”,”2009\u5e742\u6708”],[“Sun Certified Programmer for Java 2 Platform 5.0”,”Oracle”,”2009\u5e745\u6708”],[“UMTP L1”,”UML\u30e2\u30c7\u30ea\u30f3\u30b0\u63a8\u9032\u5354\u8b70\u4f1a”,”2009\u5e7412\u6708”],[“\u60c5\u5831\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b9\u30da\u30b7\u30e3\u30ea\u30b9\u30c8”,”\u7d4c\u6e08\u7523\u696d\u7701”,”2010\u5e74”],[“Exam 70-536 - TS: Microsoft .NET Framework - Application Development Foundation”,”Microsoft”,”2010\u5e7411\u6708”],[“Exam 70-505 - TS - Microsoft .NET Framework 3.5, Windows Forms Application Development”,”Microsoft”,”2012\u5e749\u6708”],[“Exam 70-563 - Pro: Designing and Developing Windows Applications Using the Microsoft .NET Framework 3.5”,”Microsoft”,”2012\u5e7410\u6708”],[“Exam 70-521: Upgrade: Transition your MCPD .NET Framework 3.5 Windows Developer Skills to MCPD .NET 4.0 Windows Applications Developer”,”Microsoft”,”2013\u5e744\u6708”],[“ITIL V3 Foundation”,”EXIN”,”2013\u5e7411\u6708”],[“Exam 70-484: Essentials of Developing Windows Store Apps Using C#”,”Microsoft”,”2016\u5e749\u6708”],[“Exam 70-485: Advanced Windows Store App Development Using C#”,”Microsoft”,”2016\u5e749\u6708”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MVAHistory</title>
      <link href="/2017/04/19/2048/"/>
      <url>/2017/04/19/2048/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30b3\u30fc\u30b9”,”\u30e2\u30b8\u30e5\u30fc\u30eb”,”\u6559\u6750”,”\u53d7\u8b1b\u65e5\u6642”,”\u30dd\u30a4\u30f3\u30c8”,”\u6642\u9593 (\u5206)”],[“C# \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 \u30b8\u30e3\u30f3\u30d7 \u30b9\u30bf\u30fc\u30c8 (MCP \u8a66\u9a13: 70-483)”,”01 | \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4e2d\u5fc3\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3001\u7ba1\u7406\u3055\u308c\u305f\u8a00\u8a9e\u3001 C#”,”01 | Slide Presentation”,”2014\/04\/27”,”1”,”5”],[“#rowspan#”,”#rowspan#”,”01 | \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4e2d\u5fc3\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3001\u7ba1\u7406\u3055\u308c\u305f\u8a00\u8a9e\u3001 C#”,”2014\/04\/27”,”3”,”59”],[“#rowspan#”,”02 | \u30b3\u30f3\u30d7\u30ec\u30c3\u30af\u30b9\u30bf\u30a4\u30d7\u306e\u69cb\u7bc9\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3084\u7d99\u627f”,”02 | Slide Presentation”,”2014\/04\/27”,”1”,”5”],[“#rowspan#”,”#rowspan#”,”02 | \u30b3\u30f3\u30d7\u30ec\u30c3\u30af\u30b9\u30bf\u30a4\u30d7\u306e\u69cb\u7bc9\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3084\u7d99\u627f”,”2014\/04\/27”,”3”,”62”],[“#rowspan#”,”03 | \u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u6d41\u308c\u3092\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b; \u30bf\u30a4\u30d7\u3068\u30b9\u30c8\u30ea\u30f3\u30b0\u3092\u64cd\u308b”,”03 | Slide Presentation”,”2014\/04\/30”,”1”,”3”],[“#rowspan#”,”#rowspan#”,”03 | \u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u6d41\u308c\u3092\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b; \u30bf\u30a4\u30d7\u3068\u30b9\u30c8\u30ea\u30f3\u30b0\u3092\u64cd\u308b”,”2014\/04\/30”,”3”,”47”],[“#rowspan#”,”04 | \u30b3\u30fc\u30c9\u306e\u53cd\u6620\u3068\u60c5\u5831\u3001 \u30ac\u30fc\u30d9\u30c3\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u305f\u4f5c\u696d”,”04 | Slide Presentation”,”2014\/04\/30”,”1”,”3”],[“#rowspan#”,”#rowspan#”,”04 | \u30b3\u30fc\u30c9\u306e\u53cd\u6620\u3068\u60c5\u5831\u3001 \u30ac\u30fc\u30d9\u30c3\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u305f\u4f5c\u696d”,”2014\/04\/30”,”3”,”50”],[“#rowspan#”,”05 | \u9ad8\u5ea6\u306eC#\u3001\u30bf\u30a4\u30d7\u3068\u5024\u306e\u691c\u8a3c\u3001 \u6697\u53f7\u5316\u30c6\u30af\u30cb\u30c3\u30af”,”05 | Slide Presentation”,”2014\/04\/30”,”1”,”3”],[“#rowspan#”,”#rowspan#”,”05 | \u9ad8\u5ea6\u306eC#\u3001\u30bf\u30a4\u30d7\u3068\u5024\u306e\u691c\u8a3c\u3001 \u6697\u53f7\u5316\u30c6\u30af\u30cb\u30c3\u30af”,”2014\/04\/30”,”3”,”62”],[“#rowspan#”,”06 | \u30a2\u30bb\u30f3\u30d6\u30ea\u30fc\u3068WinMD\u306e\u5206\u5272\u3001 \u8a3a\u65ad\u3068\u5668\u5177\u7de8\u6210”,”06 | Slide Presentation”,”2014\/05\/01”,”1”,”3”],[“#rowspan#”,”#rowspan#”,”06 | \u30a2\u30bb\u30f3\u30d6\u30ea\u30fc\u3068WinMD\u306e\u5206\u5272\u3001 \u8a3a\u65ad\u3068\u5668\u5177\u7de8\u6210”,”2014\/05\/01”,”3”,”57”],[“#rowspan#”,”07 | \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u76f8\u4e92\u4f5c\u7528\u3001 \u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306e\u6d3b\u7528”,”07 | Slide Presentation”,”2014\/05\/02”,”1”,”3”],[“#rowspan#”,”#rowspan#”,”07 | \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u76f8\u4e92\u4f5c\u7528\u3001 \u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306e\u6d3b\u7528”,”2014\/05\/02”,”3”,”46”],[“#rowspan#”,”08 | \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068XML\u306b\u5bfe\u3059\u308bLINQ\u306e\u4f7f\u7528\u3001\u30b7\u30ea\u30a2\u30eb\u5316\u306e\u57fa\u790e”,”08 | Slide Presentation”,”2014\/05\/02”,”1”,”3”],[“#rowspan#”,”#rowspan#”,”08 | \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068XML\u306b\u5bfe\u3059\u308bLINQ\u306e\u4f7f\u7528\u3001\u30b7\u30ea\u30a2\u30eb\u5316\u306e\u57fa\u790e”,”2014\/05\/02”,”3”,”53”],[“#rowspan#”,”C#\u306b\u95a2\u3057\u63a8\u85a6\u3055\u308c\u308b\u30ea\u30bd\u30fc\u30b9\u3068\u6b21\u306e\u30b9\u30c6\u30c3\u30d7”,”Q&amp;A Log | Programming in C# Jump Start”,”2014\/05\/02”,”1”,”0”],[“#rowspan#”,”#rowspan#”,”Sample Code | xamlShow”,”2014\/05\/02”,”1”,”0”],[“#rowspan#”,”#rowspan#”,”Course | Attend a more in-depth course at a location near you”,”2014\/05\/02”,”1”,”0”],[“#rowspan#”,”#rowspan#”,”Book | Microsoft\u00ae Visual C#\u00ae 2012 Step by Step, 1st Edition”,”2014\/05\/02”,”1”,”0”],[“#rowspan#”,”#rowspan#”,”Book | CLR via C#, 4th Edition”,”2014\/05\/02”,”1”,”0”],[“#rowspan#”,”#rowspan#”,”Book | Programming Windows\u00ae, Sixth Edition”,”2014\/05\/02”,”1”,”0”],[“#rowspan#”,”\u30c8\u30e9\u30c3\u30af\u5b8c\u4e86”,”\u30dc\u30fc\u30ca\u30b9\u30dd\u30a4\u30f3\u30c8”,”2014\/05\/02”,”15”,”0”],[“Build 2014 \u901f\u5831”,”Build 2014 \u901f\u5831 \uff5e Windows \u7de8 \uff5e”,”Build 2014 \u901f\u5831 \uff5e Windows \u7de8 \uff5e (Video)”,”2014\/04\/30”,”2”,”14”],[“#rowspan#”,”#rowspan#”,”Build 2014 \u901f\u5831 \uff5e Windows \u7de8 \uff5e (PDF\/1.34 MB)”,”2014\/04\/30”,”1”,”2”],[“#rowspan#”,”Build 2014 \u901f\u5831 \uff5e Azure \u7de8 \uff5e”,”Build 2014 \u901f\u5831 \uff5e Azure \u7de8 \uff5e (Video)”,”2014\/04\/30”,”2”,”5”],[“#rowspan#”,”#rowspan#”,”Build 2014 \u901f\u5831 \uff5e Azure \u7de8 \uff5e (PDF\/1.64 MB)”,”2014\/04\/30”,”1”,”2”],[“#rowspan#”,”\u30105\/29 - 30 \u958b\u50ac\u3011Build \u306e\u5185\u5bb9\u3092\u51dd\u7e2e\u3057\u3066\u304a\u5c4a\u3051! de:code “,”\u30105\/29 - 30 \u958b\u50ac\u3011Build \u306e\u5185\u5bb9\u3092\u51dd\u7e2e\u3057\u3066\u304a\u5c4a\u3051! de:code “,”2014\/04\/30”,”1”,”3”],[“\u3044\u307e\u3055\u3089\u805e\u3051\u306a\u3044 Windows \u30a2\u30d7\u30ea\u958b\u767a\u5165\u9580 XAML\/C# \u7de8”,”Windows \u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\u958b\u767a\u5165\u9580”,”Windows \u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\u958b\u767a\u5165\u9580 (Video)”,”2014\/05\/04”,”2”,”6”],[“#rowspan#”,”#rowspan#”,”Windows \u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\u958b\u767a\u5165\u9580 (PDF \u5f62\u5f0f\/698 KB)”,”2014\/05\/04”,”2”,”1”],[“#rowspan#”,”Hello World \uff5e\u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\/C# \u7de8\uff5e”,”Hello World \uff5e\u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\/C# \u7de8\uff5e (Video)”,”2014\/05\/04”,”2”,”5”],[“#rowspan#”,”#rowspan#”,”Hello World \uff5e\u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\/C# \u7de8\uff5e (PDF \u5f62\u5f0f\/648 KB)”,”2014\/05\/04”,”2”,”1”],[“#rowspan#”,”\u30a2\u30d7\u30ea\u516c\u958b\u307e\u3067\u306e\u9053\u306e\u308a”,”\u30a2\u30d7\u30ea\u516c\u958b\u307e\u3067\u306e\u9053\u306e\u308a (Video)”,”2014\/05\/04”,”2”,”10”],[“#rowspan#”,”#rowspan#”,”\u30a2\u30d7\u30ea\u516c\u958b\u307e\u3067\u306e\u9053\u306e\u308a (PDF \u5f62\u5f0f\/1.00 MB)”,”2014\/05\/04”,”2”,”1”],[“#rowspan#”,”Windows \u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\u5be9\u67fb\u306e\u6ce8\u610f\u70b9”,”Windows \u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\u5be9\u67fb\u306e\u6ce8\u610f\u70b9 (Video)”,”2014\/05\/04”,”2”,”7”],[“#rowspan#”,”#rowspan#”,”Windows \u30b9\u30c8\u30a2 \u30a2\u30d7\u30ea\u5be9\u67fb\u306e\u6ce8\u610f\u70b9 (PDF \u5f62\u5f0f\/772 KB)”,”2014\/05\/04”,”2”,”1”],[“\u521d\u3081\u3066\u306e Windows Server 2012”,”Windows Server 2012 \u306e\u5168\u4f53\u50cf “,”Windows Server 2012 \u306e\u5168\u4f53\u50cf”,”2014\/05\/06”,”3”,”50”],[“#rowspan#”,”#rowspan#”,”Windows Server 2012 Release Candidate (RC) \u8a55\u4fa1\u7248\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9”,”2014\/05\/06”,”1”,”3”],[“#rowspan#”,”#rowspan#”,”\u3010\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u8cc7\u6599\u3011Windows Server 2012 \u306e\u5168\u4f53\u50cf”,”2014\/05\/06”,”2”,”3”],[“#rowspan#”,”#rowspan#”,”\u30af\u30e9\u30a6\u30c9\u306b\u3088\u308b IT \u306e\u6700\u9069\u5316 Windows Server 2012 RC”,”2014\/05\/06”,”2”,”3”],[“#rowspan#”,”#rowspan#”,”Windows Server 2012 RC \u88fd\u54c1\u6982\u8981”,”2014\/05\/06”,”2”,”3”],[“#rowspan#”,”#rowspan#”,”Windows Server 2012 RC \u8a55\u4fa1\u30ac\u30a4\u30c9”,”2014\/05\/06”,”2”,”3”],[“#rowspan#”,”#rowspan#”,”\u30c6\u30b9\u30c8”,”2014\/05\/06”,”5”,”5”],[“#rowspan#”,”Windows Server 2012: \u4eee\u60f3\u5316\u3092\u8d85\u3048\u308b\u6a5f\u80fd”,”Beyond Virtualization with Windows Server 2012 Part 1 (\u82f1\u8a9e)”,”2014\/05\/11”,”3”,”24”],[“#rowspan#”,”#rowspan#”,”Beyond Virtualization with Windows Server 2012 Part 2 (\u82f1\u8a9e) “,”2014\/05\/11”,”3”,”25”],[“#rowspan#”,”#rowspan#”,”\u30c6\u30b9\u30c8”,”2014\/05\/11”,”5”,”5”],[“#rowspan#”,”Windows Server 2012: \u591a\u6570\u30b5\u30fc\u30d0\u30fc\u306e\u6a5f\u80fd”,”Windows Server 2012, The Power of Many Servers Part 1 (\u82f1\u8a9e)\r\n”,”2014\/05\/11”,”3”,”21”],[“#rowspan#”,”#rowspan#”,”Windows Server 2012, The Power of Many Servers Part 2 (\u82f1\u8a9e)”,”2014\/05\/11”,”3”,”28”],[“#rowspan#”,”#rowspan#”,”\u3010\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u8cc7\u6599\u3011Windows Server 2012: \u591a\u6570\u30b5\u30fc\u30d0\u30fc\u306e\u6a5f\u80fd”,”2014\/05\/11”,”2”,”10”],[“#rowspan#”,”#rowspan#”,”\u30c6\u30b9\u30c8”,”2014\/05\/11”,”5”,”5”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Profile</title>
      <link href="/2017/04/19/2050/"/>
      <url>/2017/04/19/2050/</url>
      
        <content type="html"><![CDATA[<p>[[“\u540d\u524d”,”Takuya Takeuchi”,”\u65e5\u672c\u4eba”],[“\u8077\u696d”,”\u30d7\u30ed\u30b0\u30e9\u30de\u30fc”,”PM\u6bd4\u7387\u304c\u591a\u3044\u4e2d\u3001\u6570\u5c11\u306a\u3044\u6280\u8853\u5c02\u653b\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\r\n\u203b\u767a\u8a00\u306f\u3059\u3079\u3066\u500b\u4eba\u306b\u5e30\u5c5e\u3057\u307e\u3059\u3002\u6240\u5c5e\u3059\u308b\u7d44\u7e54\u306e\u516c\u5f0f\u898b\u89e3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002”],[“\u5834\u6240”,”\u611b\u77e5\u770c”,”\u540d\u53e4\u5c4b\u8fd1\u90ca”],[“\u8da3\u5473”,”\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0”,”C# (WinForms + WPF)”],[“#rowspan#”,”\u30d5\u30a3\u30c3\u30c8\u30cd\u30b9\u30fb\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0”,”\u4f53\u578b\u7dad\u6301\u3068\u4f53\u529b\u7dad\u6301\u304c\u30e1\u30a4\u30f3”],[“Web”,”Blog”,”http:\/\/ouranos.sakura.ne.jp\/“],[“#rowspan#”,”Github”,”https:\/\/github.com\/takuya-takeuchi”],[“#rowspan#”,”Facebook”,”https:\/\/<a href="http://www.facebook.com///takuya.takeuchi.sns&quot;/],/[&quot;#rowspan#&quot;,&quot;Twitter&quot;,&quot;https:\\/\\/twitter.com\\/takuya\_takeuchi&quot;\]\]">www.facebook.com\\/takuya.takeuchi.sns&quot;\],\[&quot;#rowspan#&quot;,&quot;Twitter&quot;,&quot;https:\\/\\/twitter.com\\/takuya\_takeuchi&quot;\]\]</a></p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Redmine_Log_Level</title>
      <link href="/2017/04/19/2047/"/>
      <url>/2017/04/19/2047/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30ec\u30d9\u30eb”,”\u610f\u5473”],[“unknown”,”\u4e0d\u660e”],[“fatal”,”\u81f4\u547d\u7684”],[“error”,”\u30a8\u30e9\u30fc”],[“warn”,”\u8b66\u544a”],[“info”,”\u60c5\u5831”],[“debug”,”\u30c7\u30d0\u30c3\u30b0”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport8</title>
      <link href="/2017/04/19/2045/"/>
      <url>/2017/04/19/2045/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”ForShort”,”ForLong”,”ForEachShort”,”ForEachLong”,”LinqShort”,”LinqLong”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”81”,”77”,”82”,”78”,”77”,”77”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”2”,”2”,”2”,”2”,”3”,”3”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”2”,”2”,”2”,”2”,”4”,”4”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”-“,”-“,”-“,”-“,”-“,”-“],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”2”,”3”,”2”,”3”,”3”,”3”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport9</title>
      <link href="/2017/04/19/2046/"/>
      <url>/2017/04/19/2046/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”ForShort”,”ForLong”,”ForEachShort”,”ForEachLong”,”LinqShort”,”LinqLong”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”72”,”72”,”69”,”69”,”74”,”74”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”2”,”2”,”2”,”2”,”3”,”3”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”2”,”2”,”2”,”2”,”4”,”4”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”-“,”-“,”-“,”-“,”-“,”-“],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”5”,”5”,”6”,”6”,”4”,”4”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport5</title>
      <link href="/2017/04/19/2042/"/>
      <url>/2017/04/19/2042/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”IImagineBreaker”,”ISupernaturalPower”,”IAccelerator”,”IMagic”,”IAutoReverse”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”100”,”100”,”100”,”100”,”100”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”2”,”1”,”0”,”1”,”0”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”2”,”0”,”1”,”0”,”1”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”0”,”0”,”0”,”0”,”0”],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”0”,”0”,”0”,”0”,”0”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport6</title>
      <link href="/2017/04/19/2043/"/>
      <url>/2017/04/19/2043/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”Family”,”FireVampire”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”100”,”100”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”1”,”1”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”0”,”1”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”1”,”2”],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”1”,”1”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport7</title>
      <link href="/2017/04/19/2044/"/>
      <url>/2017/04/19/2044/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”Cthugha”,”Nyarlathotep”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”97”,”97”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”2”,”2”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”2”,”1”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”2”,”2”],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”2”,”2”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport2</title>
      <link href="/2017/04/19/2039/"/>
      <url>/2017/04/19/2039/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”CodeMetricsTest.exe”,”CodeMetricsTest”,”Program”,”Main(string[]) : void”,”Program()”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”23”,”23”,”23”,”15”,”100”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”2”,”2”,”2”,”1”,”1”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”0”,”0”,”0”,”0”,”0”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”1”,”1”,”1”,”-“,”-“],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”502”,”502”,”502”,”501”,”1”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport3</title>
      <link href="/2017/04/19/2040/"/>
      <url>/2017/04/19/2040/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”Case1”,”Case2”,”Case3”,”Case4”,”Case5”,”Case6”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”71”,”66”,”67”,”67”,”78”,”70”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”4”,”7”,”4”,”4”,”2”,”4”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”2”,”2”,”2”,”2”,”1”,”1”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”-“,”-“,”-“,”-“,”-“,”-“],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”5”,”8”,”7”,”7”,”3”,”5”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport4</title>
      <link href="/2017/04/19/2041/"/>
      <url>/2017/04/19/2041/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”Human”,”Student”,”KamijoToma”,”Accelerator”,”TsuchimikadoMotoharu”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”100”,”100”,”95”,”96”,”95”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”1”,”1”,”5”,”3”,”4”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”0”,”1”,”5”,”4”,”5”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”1”,”2”,”3”,”3”,”3”],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”1”,”1”,”5”,”3”,”4”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeMetricsTestReport</title>
      <link href="/2017/04/19/2038/"/>
      <url>/2017/04/19/2038/</url>
      
        <content type="html"><![CDATA[<p>[[“\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u9805\u76ee”,”CodeMetricsTest.exe”,”CodeMetricsTest”,”Program”,”Main(string[]) : void”,”Program()”],[“MaintainabilityIndex \r\n(\u4fdd\u5b88\u5bb9\u6613\u6027\u6307\u6570)”,”100”,”100”,”100”,”100”,”100”],[“CyclomaticComplexity\r\n (\u30b5\u30a4\u30af\u30ed\u30de\u30c6\u30a3\u30c3\u30af\u8907\u96d1\u5ea6)”,”2”,”2”,”2”,”1”,”1”],[“ClassCoupling \r\n(\u30af\u30e9\u30b9\u7d50\u5408\u5ea6)”,”0”,”0”,”0”,”0”,”0”],[“DepthOfInheritance \r\n(\u7d99\u627f\u306e\u6df1\u3055)”,”1”,”1”,”1”,”-“,”-“],[“LinesOfCode\r\n (\u30b3\u30fc\u30c9\u884c)”,”1”,”1”,”1”,”0”,”1”]]</p>]]></content>
      
      
      <categories>
          
          <category> uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi 3をマウス、キーボード、ディスプレイなしでセットアップ</title>
      <link href="/2017/04/14/2021/"/>
      <url>/2017/04/14/2021/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>ようやくIoTデビューです。 やがては、<strong>Windows 10 IoT</strong>とか使って何かしたいです。 が、Raspberry Piは初めてなので、下記を参考にしてセットアップしました。 有益な情報ありがとうございます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://karaage.hatenadiary.jp/entry/2015/07/15/080000" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=karaage.hatenadiary.jp"></img><div class="hbc-site-name">karaage. [からあげ]</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/k/karaage/20150428/20150428225756.jpg"></img></div><div class="hbc-text"><div class="hbc-title">Raspberry Piをディスプレイ・キーボード・マウス無しの三重苦でもセットアップする方法 - karaage. [からあげ]</div><div class="hbc-url">http://karaage.hatenadiary.jp/entry/2015/07/15/080000</div><div class="hbc-description">おらの村にはディスプレイもねぇ！キーボードもねぇ！マウスもねぇ！ 色々な事情で、モニタやキーボードがないところでRaspberry Piをセットアップしたくなることありますよね？（私はあります）。sshにさえアクセスできれば！ファイルに直接アクセスできればなんとかなるのに！という…</div></div></div></div></a></div></div><h1 id="用意するもの"><a href="#用意するもの" class="headerlink" title="用意するもの"></a>用意するもの</h1><ul><li>Raspberry Pi 3 Model B</li><li>マイクロSDカード</li><li>OS</li><li>電源アダプタ</li><li>LANケーブル</li></ul><p>以上。 マウスとキーボード、ディスプレイは使いません。 接続が面倒なので。</p><h1 id="Raspbianのダウンロード"><a href="#Raspbianのダウンロード" class="headerlink" title="Raspbianのダウンロード"></a>Raspbianのダウンロード</h1><p>何はともあれ、OSを入手。 公式サイトである下記から入手できます。 2017/04/14の時点で、最新版は2017-04-10です。 <strong>RASPBIAN JJESSIE WITH PIXEL</strong>と<strong>RASPBIAN JESSIE LITE</strong>と違いは初期状態で入っているパッケージの違いです。 大きいのはGUIの有無です。 今回はRASPBIAN JJESSIE WITH PIXELを選択。 約1.5GBあります。 </p><p>混雑しているので、ミラーサイトを利用したほうが無難です。ほとんどつながりませんでしたし、回線激重でした。 混雑しているとこんなお詫びが。<br><a href="../../../../public/2017/04/screencapture-director-downloads-raspberrypi-org-raspbian-images-raspbian-2017-04-10-2017-04-10-raspbian-jessie-zip-1492171127206.png"><img src="../../../../public/2017/04/screencapture-director-downloads-raspberrypi-org-raspbian-images-raspbian-2017-04-10-2017-04-10-raspbian-jessie-zip-1492171127206.png"></a> ミラーサイトは<a href="http://ftp.jaist.ac.jp/pub/raspberrypi/raspbian/images/">こちら</a><br>。</p><h1 id="SDカードの初期化"><a href="#SDカードの初期化" class="headerlink" title="SDカードの初期化"></a>SDカードの初期化</h1><p>WindowsのExplorerからでも初期化できますが、最適な性能を得るために専用ソフトを使いましょう、とGoogle先生に言われたので従います。 でも下記のツールでフォーマットしてもFAT32だった。意味なくね? ダウンロードは<a href="https://www.sdcard.org/jp/downloads/formatter_4/eula_windows/index.html">SDカードフォーマッター Windows用</a>から。 Install Sheildのセットアップが始まるので、粛々と進めます。 初期化は特に説明は不要なほど簡単なので省略。</p><h1 id="OSの書き込み"><a href="#OSの書き込み" class="headerlink" title="OSの書き込み"></a>OSの書き込み</h1><p><strong>Etcher</strong>という非常にUIの美しい書き込みツールがあるので、それを使いましょう。しかもポータブル版があるのが最高。 公式サイトは下記。 2017/04/14の時点で、最新版は1.0.0-beta.19です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://etcher.io/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=etcher.io"></img><div class="hbc-site-name">balenaEtcher</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://www.balena.io/etcher/avatar.png"></img></div><div class="hbc-text"><div class="hbc-title">balenaEtcher - Flash OS images to SD cards &amp; USB drives</div><div class="hbc-url">https://etcher.io/</div><div class="hbc-description">A cross-platform tool to flash OS images onto SD cards and USB drives safely and easily. Free and open source for makers around the world.</div></div></div></div></a></div></div><p>画面はこんなの。<br><a href="../../../../public/2017/04/30b083ca07e7a59f1bb1edbe3cbf8b6b.png"><img src="../../../../public/2017/04/30b083ca07e7a59f1bb1edbe3cbf8b6b.png"></a><br> 使い方は簡単。</p><ol><li>左端の<strong>Select image</strong>でダウンロードしたRASPBIANのzipを選択</li><li>中央の<strong>Select drive</strong>でSDカードを挿入したドライブを選択</li><li>右端の**Flash!**で書き込み</li></ol><p>以上。簡単です。素晴らしい。</p><h1 id="SSHを有効にする"><a href="#SSHを有効にする" class="headerlink" title="SSHを有効にする"></a>SSHを有効にする</h1><p>マウスやキーボードはつなぎたくないので、SSHをデフォルトで有効にします。 が、途中のバージョンでSSHが初期状態で無効になった模様。 以下の記事を参考に回避します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.raspi.jp/2016/12/raspbian-2016-11-25-release/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.raspi.jp"></img><div class="hbc-site-name">Japanese Raspberry Pi Users Group</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Raspbian 2016-11-25リリース</div><div class="hbc-url">http://www.raspi.jp/2016/12/raspbian-2016-11-25-release/</div><div class="hbc-description">Raspbian 2016-11-25がリリースされました。https://www.raspberrypi.org/blog/a-security-update-for-raspbian-pixel/昨今のIoTデバイスへの攻撃を考慮して、SSHサーバーがデフォルトで無効…</div></div></div></div></a></div></div><p>要するに、作成したSDカードの**/boot<strong>に</strong>ssh**という空のフォルダを作成する、というだけです。 下記のような感じ。<br><a href="../../../../public/2017/04/ad82d3a67a89eaceec5b047735f92f25.png"><img src="../../../../public/2017/04/ad82d3a67a89eaceec5b047735f92f25-1024x611.png"></a><br> 作成が終わったら、SDカード、LANケーブルをRaspberry Piに差し込み、電源アダプタを接続します。 すると自動で起動します。</p><h1 id="IPを探索"><a href="#IPを探索" class="headerlink" title="IPを探索"></a>IPを探索</h1><p>SSHで接続するには、IPが必要ですが、まだログインしていないし、マウス、キーボードはおろか、ディスプレイもないのでIPがわかりません。 なので、ルータのログとか情報、または何かしらツールでIPを調べます。 有線NICのMACアドレスは<strong>B8:27:EB</strong>で始まる値のようです。 下記を参考にしました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://boysenberrypi.hatenadiary.jp/entry/2014/03/29/222028" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=boysenberrypi.hatenadiary.jp"></img><div class="hbc-site-name">落書き以上、技術メモ以下</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/12921228815712697031/12921228815720713163/1396099350"></img></div><div class="hbc-text"><div class="hbc-title">Raspberry PiのMACアドレスはROMから読んでいない件 - 落書き以上、技術メモ以下</div><div class="hbc-url">http://boysenberrypi.hatenadiary.jp/entry/2014/03/29/222028</div><div class="hbc-description">Raspberry PiのMACアドレスはEEPROMなどから読み込んではいないようです。 xinu/docs/arm/rpi/SMSC-LAN9512.rst at master · xinu-os/xinu · GitHub には次のように書いています。 To have a …</div></div></div></div></a></div></div><p>ですので、ルータからの接続情報を見たら<br><a href="../../../../public/2017/04/screencapture-192-168-11-1-cgi-bin-cgi-1492175093310.png"><img src="../../../../public/2017/04/screencapture-192-168-11-1-cgi-bin-cgi-1492175093310.png"></a><br> みたいになります。</p><h1 id="SSHでログイン"><a href="#SSHでログイン" class="headerlink" title="SSHでログイン"></a>SSHでログイン</h1><p><strong>Windows 10 Anniversary Update</strong>があったので、<strong>Bash on Ubuntu on Windows</strong>でログイン。 こんな感じ。 [code lang=”sh”] XXXXXX@YYYYYYY:<del>$ ssh <a href="mailto:&#x70;&#x69;&#64;&#x31;&#57;&#x32;&#46;&#x31;&#x36;&#56;&#46;&#x31;&#x31;&#x2e;&#x31;&#55;">&#x70;&#x69;&#64;&#x31;&#57;&#x32;&#46;&#x31;&#x36;&#56;&#46;&#x31;&#x31;&#x2e;&#x31;&#55;</a> The authenticity of host ‘192.168.11.17 (192.168.11.17)’ can’t be established. ECDSA key fingerprint is 86:1a:cd:e6:fc:d2:85:70:42:1c:0d:a2:6f:82:88:77. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added ‘192.168.11.17’ (ECDSA) to the list of known hosts. <a href="mailto:&#112;&#x69;&#64;&#49;&#x39;&#x32;&#46;&#x31;&#x36;&#x38;&#46;&#x31;&#x31;&#46;&#49;&#55;">&#112;&#x69;&#64;&#49;&#x39;&#x32;&#46;&#x31;&#x36;&#x38;&#46;&#x31;&#x31;&#46;&#49;&#55;</a>‘s password:<br>The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright.<br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Mon Apr 10 10:09:47 2017<br>SSH is enabled and the default password for the ‘pi’ user has not been changed. This is a security risk - please login as the ‘pi’ user and type ‘passwd’ to set a new password.<br>pi@raspberrypi:</del> $ [/code] 初期パスワードは<strong>raspberry</strong>です。 ログインが終わったら変更しましょう。 変更手順はいつか….</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> IoT </category>
          
          <category> iot </category>
          
          <category> Raspbian </category>
          
          <category> Raspberry Pi </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その44 thriftファイルからドキュメントを生成する</title>
      <link href="/2017/04/14/2016/"/>
      <url>/2017/04/14/2016/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://wp.me/p7138e-vp">開発メモ その35 protoファイルからドキュメントを生成する</a>と同じように、APIドキュメントを生成できないか、と思って調べてみました。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>なんと、<strong>Thrift.exe</strong>自体がドキュメントを生成できる模様。 構文は簡単で [code lang=”batch”] thrift.exe –gen html &lt;thriftファイル&gt; [/code] です。 これにより、カレントディレクトリ内部に、<strong>gen-html</strong>フォルダが生成され、</p><ul><li>index.html</li><li>style.css</li><li>&lt;thriftファイル内のサービス&gt;.html</li></ul><p>という感じのファイルが出来ます。 <strong>index.html</strong>は、普通に目次ですね。 [code lang=”thrift”] struct TestStruct { /** Unique id */ 1: string id, /** Value */ 2: i32 value = 10, }<br>/** Image manipulation service */ service imageProcService { /** * Invert passed image binary */ binary Revert(1:binary image,2:i32 width,3:i32 height, 4:TestStruct test), } [/code] 上記の<strong>thriftファイル</strong>を渡せば下記のようなドキュメントが生成されます。<br><a href="../../../../public/2017/04/screencapture-file-D-Works-Demo-RPC-ApacheTrift1-gen-html-ImageProcService-html-1492099378398.png"><img src="../../../../public/2017/04/screencapture-file-D-Works-Demo-RPC-ApacheTrift1-gen-html-ImageProcService-html-1492099378398.png"></a><br> コメントや既定値もきちんと反映されます。</p>]]></content>
      
      
      <categories>
          
          <category> remote-procedure-call </category>
          
          <category> Apache Thrift </category>
          
          <category> Remote Procedure Call </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その43 OpenCvSharp.MatからROIを指定してRawを抜き出す</title>
      <link href="/2017/04/12/2014/"/>
      <url>/2017/04/12/2014/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>掲題の件、普通は下記のような形でRAWデータ <strong>(ここでは、画素値だけを格納したデータ形式)**だけを抜き出す。 [code lang=”csharp”] var mat = Cv2.ImRead(@”Test.png”, ImreadModes.GrayScale); var raw = new byte[mat.Total()]; Marshal.Copy(mat.Data, raw, 0, raw.Length); [/code] 問題は、あるMatから</strong>ROI**を指定した後に、ROIで抽出されたMatをRAWデータを抜き出す場合。 つまり下記のようなケース。 [code lang=”csharp”] var mat = Cv2.ImRead(@”Test.png”, ImreadModes.GrayScale);<br>// ROIを設定 var cropped = new Mat(mat, new Rect(50, 50, 100, 100));<br>var raw = new byte[cropped.Total()]; Marshal.Copy(cropped.Data, raw, 0, raw.Length); [/code] 上記のケースで抜き出されるRAWデータは壊れているようなデータになる。 ROIを指定した場合、抜き出されたMatは、元のMatのデータ領域を指し示しているだけで、コピーでは無い。 そのため、抜き出されたMatのDataプロパティからポインタを介してメモリ領域から連続したデータを抜き出しても意味が無い。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>回答は下記。 [code lang=”csharp”] var mat = Cv2.ImRead(@”Test.png”, ImreadModes.GrayScale);<br>// ROIを設定 var temp = new Mat(mat, new Rect(50, 50, 100, 100));<br>// ROIを設定した領域を新しいMatとして切り出す var cropped = new Mat(100, 100, MatType.CV_8U); temp.CopyTo(cropped);<br>var raw = new byte[cropped.Total()]; Marshal.Copy(cropped.Data, raw, 0, raw.Length); [/code] <strong>OpenCvSharp.Mat.CopyToメソッド</strong>を利用して、ROIで切り出したMatを新しく確保したMatにコピーしています。 これで意図した結果になります。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> マルチメディア </category>
          
          <category> OpenCV </category>
          
          <category> OpenCvSharp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その42 環境変数PATHの最大長を2047から4095に緩和する</title>
      <link href="/2017/04/11/2011/"/>
      <url>/2017/04/11/2011/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>開発環境に<strong>Visual Studio</strong>、<strong>SQL Server</strong>、<strong>Intel製品</strong>、<strong>CUDA</strong>とかインストールしていると、環境変数PAHTの長さが恐ろしいことになる。今数えてみたら、2400を超えていた。 試しに整理してみたら、</p><ul><li>C:\Intel\INDE\code_builder_5.2.0.65\bin\GTPin</li><li>C:\Intel\INDE\code_builder_5.2.0.65\bin\Pin</li><li>C:\Intel\INDE\code_builder_5.2.0.65\bin\x64</li><li>C:\Intel\INDE\code_builder_5.2.0.65\bin\x86</li><li>C:\Intel\INDE\IDEintegration\ANT</li><li>C:\Intel\INDE\IDEintegration\NDK</li><li>C:\Intel\INDE\IDEintegration\NDK\build\tools</li><li>C:\Intel\INDE\IDEintegration\SDK\platform-tools</li><li>C:\Intel\INDE\IDEintegration\SDK\tools</li><li>C:\Intel\INDE\media_sdk_6.0.0.388\bin\win32</li><li>C:\Intel\INDE\media_sdk_6.0.0.388\bin\x64</li><li>C:\Program Files (x86)\Calibre2\</li><li>C:\Program Files (x86)\Common Files\Acronis\SnapAPI\</li><li>C:\Program Files (x86)\Common Files\Microsoft Shared\Windows Live</li><li>C:\Program Files (x86)\GtkSharp\2.12\bin</li><li>C:\Program Files (x86)\Microsoft ASP.NET\ASP.NET Web Pages\v1.0\</li><li>C:\Program Files (x86)\Microsoft SDKs\TypeScript\1.0\</li><li>C:\Program Files (x86)\Microsoft SQL Server\90\Tools\binn\</li><li>C:\Program Files (x86)\nodejs\</li><li>C:\Program Files (x86)\NVIDIA Corporation\PhysX\Common</li><li>C:\Program Files (x86)\Skype\Phone\</li><li>C:\Program Files (x86)\Windows Kits\10\Windows Performance Toolkit\</li><li>C:\Program Files (x86)\Windows Kits\8.0\Windows Performance Toolkit\</li><li>C:\Program Files (x86)\Windows Kits\8.1\Windows Performance Toolkit\</li><li>C:\Program Files (x86)\Windows Live\Shared</li><li>C:\Program Files\CloudFoundry</li><li>C:\Program Files\Common Files\Microsoft Shared\Windows Live</li><li>C:\Program Files\dotnet\</li><li>C:\Program Files\Git\cmd</li><li>C:\Program Files\IBM\Bluemix\bin</li><li>C:\Program Files\Microsoft DNX\Dnvm\</li><li>C:\Program Files\Microsoft MPI\Bin\</li><li>C:\Program Files\Microsoft SQL Server\110\Tools\Binn\</li><li>C:\Program Files\Microsoft SQL Server\120\Tools\Binn\</li><li>C:\Program Files\Microsoft SQL Server\130\Tools\Binn\</li><li>C:\Program Files\Microsoft Windows Performance Toolkit\</li><li>C:\Program Files\Microsoft\Web Platform Installer\</li><li>C:\Program Files\Miniconda2</li><li>C:\Program Files\Miniconda2\Library\bin</li><li>C:\Program Files\Miniconda2\Scripts</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.0\bin</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.0\libnvvp</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\bin</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\libnvvp</li><li>C:\Program Files\TortoiseGit\bin</li><li>C:\Program Files\TortoiseSVN\bin</li><li>C:\Program Files\WinMerge</li><li>C:\ProgramData\Oracle\Java\javapath</li><li>C:\Users\XXXXXX.dnx\bin</li><li>C:\Users\XXXXXX\AppData\Roaming\npm</li><li>C:\Windows</li><li>C:\Windows\system32</li><li>C:\Windows\System32\Wbem</li><li>C:\Windows\System32\WindowsPowerShell\v1.0\</li><li>C:\Windows\System32\WindowsPowerShell\v1.0\</li><li>C:\Windows\System32\WindowsPowerShell\v1.0\</li><li>C:\Windows\System32\WindowsPowerShell\v1.0\</li><li>C:\Windows\System32\WindowsPowerShell\v1.0\</li><li>C:\Windows\System32\WindowsPowerShell\v1.0\</li></ul><p>になっていた。 何でPowerShellは重複しているんですかねぇ… とりあえず不要なパスを削りましたが、まだ2290…多すぎます。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>で、どうもひっそりと環境変数PATHの最大長を伸ばすパッチがWindows7用に公開されているとのこと。 パッチは下記から入手可能。 <a href="https://support.microsoft.com/en-us/help/2685893/error-messages-after-you-change-the-2047-character-limit-in-an-environment-variable-on-a-computer-that-is-running-windows-vista,-windows-7,-windows-server-2008-or-windows-server-2008-r2">Error messages after you change the 2047 character limit in an environment variable on a computer that is running Windows Vista, Windows 7, Windows Server 2008 or Windows Server 2008 R2</a> ページ上部の<strong>Hotfix download available</strong>からダウンロードできます。 ダウンロードはメールアドレスを入力してから、そのアドレスにダウンロード先が転送される方式です。 対象は</p><ul><li>Windows Vista Service Pack 2 (SP2)</li><li>Windows Server 2008 Service Pack 2 (SP2)</li><li>Windows 7</li><li>Windows 7 Service Pack 1 (SP1)</li><li>Windows Server 2008 R2</li><li>Windows Server 2008 R2 Service Pack 1 (SP1)</li></ul><p>になります。 ただし注意として</p><blockquote><p>A supported hotfix is available from Microsoft. However, this hotfix is intended to correct only the problem that is described in this article. Apply this hotfix only to systems that are experiencing the problem described in this article. This hotfix might receive additional testing. Therefore, if you are not severely affected by this problem, we recommend that you wait for the next software update that contains this hotfix.</p></blockquote><p><strong>サポートするHotfixはMicrosoftから利用できます。しかしながら、このHotfixはこの記事で記載している問題のみを是正することを意図しています。この記事で記載している問題に遭遇しているシステムに対してのみ、このHotfixを適用します。このHotfixは追加のテストを受けているでしょう、そのため、この問題で深刻な問題を受けていないならば、(Microsoftは)このHotfixが含まれる次のソフトウェアのアップデートを待つことをお勧めします。</strong> とあります。 自己責任でお願いします。 パッチ適用後は再起動が必須。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでRPCを試してみる Apache Thrift編 第1回</title>
      <link href="/2017/04/09/2004/"/>
      <url>/2017/04/09/2004/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="http://wp.me/p7138e-w7">前回</a>は、<strong>Apache Thrift</strong>のビルドを実施しました。 今回は、C++のサーバーとC#のクライアントを作成します。 今回のソースは下記になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/RPC-ApacheTrift1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/RPC-ApacheTrift1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>順番に作成していきます。</p><h2 id="Win32コンソールアプリ"><a href="#Win32コンソールアプリ" class="headerlink" title="Win32コンソールアプリ"></a>Win32コンソールアプリ</h2><p>Visual Stuidoで、Win32コンソールアプリを作成します。</p><h3 id="追加のインクルード-ディレクトリ"><a href="#追加のインクルード-ディレクトリ" class="headerlink" title="追加のインクルード ディレクトリ"></a>追加のインクルード ディレクトリ</h3><p>作成したプロジェクトのプロパティから<code>C/C++ -&gt; 全般</code>を開き、<strong>追加のインクルード ディレクトリ</strong>に下記を追加します。</p><ul><li>{boost_install_dir}</li><li>{thrift_install_dir}\lib\cpp\src\thrift\windows</li><li>{thrift_install_dir}\lib\cpp\src\thrift</li><li>{thrift_install_dir}\lib\cpp\src</li></ul><h3 id="追加の依存ファイル"><a href="#追加の依存ファイル" class="headerlink" title="追加の依存ファイル"></a>追加の依存ファイル</h3><p><code>ライブラリアン -&gt; 入力</code>を開き、<strong>追加の依存ファイル</strong>に下記を追加します。</p><ul><li>libboost_thread-vc140-mt-gd-1_59.lib</li><li>libboost_chrono-vc140-mt-gd-1_59.lib</li><li>libthrift.lib</li><li>libthriftnb.lib</li><li>libeay32.lib</li><li>ssleay32.lib</li></ul><h3 id="追加のライブラリ-ディレクトリ"><a href="#追加のライブラリ-ディレクトリ" class="headerlink" title="追加のライブラリ ディレクトリ"></a>追加のライブラリ ディレクトリ</h3><p><code>ライブラリアン -&gt; 全般</code>を開き、<strong>追加のライブラリ ディレクトリ</strong>に下記を追加します。</p><ul><li>{boost_install_dir}\lib64-msvc-14.0</li><li>{thrift_install_dir}\lib\cpp\Debug</li><li>{openssll_install_dir}\lib</li></ul><p>lib64-msvc-14.0は、インストールしたboostのVCのバージョンに依存します。<strong>lib64-msvc-12.0</strong>かもしれません。 最後の、<strong>Debug</strong>の部分は、<strong>Release, Release-mt, Debug, Debug-mt</strong>から好きなのを選んでください。つまり、libthriftビルド時の出力先です。</p><h2 id="thriftファイル"><a href="#thriftファイル" class="headerlink" title=".thriftファイル"></a>.thriftファイル</h2><p>クライアントとサーバーを生成するための定義ファイルです。 今回は下記のようなファイル<strong>ImageProcService.thrift</strong>です。 [code lang=”thrift”] service imageProcService { binary Revert(1:binary image,2:i32 width,3:i32 height), } [/code] <strong>Revert</strong>は渡されたバイナリ(RAW画像データ)の画素を反転させます。</p><h2 id="コード生成"><a href="#コード生成" class="headerlink" title="コード生成"></a>コード生成</h2><p>前回ダウンロードしたThriftのコンパイラーを使ってコードを生成します。 [code lang=”batch”] thrift-0.10.0.exe-r –gen cpp ImageProcService.thrift [/code] 上記のコマンドで、<strong>gen-cpp</strong>というフォルダが生成され、その中に、</p><ul><li>imageProcService.cpp</li><li>imageProcService.h</li><li>imageProcService_server.skeleton.cpp</li><li>Server_constants.cpp</li><li>Server_constants.h</li><li>Server_types.cpp</li><li>Server_types.h</li></ul><p>が作成されます。</p><h2 id="for-C"><a href="#for-C" class="headerlink" title="for C++"></a>for C++</h2><p>サーバー側です。 前項の、<strong>imageProcService_server.skeleton.cpp</strong>がサーバー側の実装のスケルトンコードなので、そのまま流用します。 下記がソースです。 [code lang=”cpp”] // Server.cpp : コンソール アプリケーションのエントリ ポイントを定義します。 //<br>#include “stdafx.h” #include “gen-cpp/imageProcService.h” #include &lt;thrift/protocol/TBinaryProtocol.h&gt; #include &lt;thrift/server/TSimpleServer.h&gt; #include &lt;thrift/transport/TServerSocket.h&gt; #include &lt;thrift/transport/TBufferTransports.h&gt;<br>using namespace ::apache::thrift; using namespace ::apache::thrift::protocol; using namespace ::apache::thrift::transport; using namespace ::apache::thrift::server;<br>using boost::shared_ptr;<br>class imageProcServiceHandler : virtual public imageProcServiceIf { public: imageProcServiceHandler() { // Your initialization goes here }<br>void Revert(std::string&amp; _return, const std::string&amp; image, const int32_t width, const int32_t height) { unsigned char* tmp = static_cast&lt;unsigned char*&gt;(malloc(sizeof(unsigned char) * image.length())); copy(image.begin(), image.end(), tmp);<br>printf(“image length: %llu\n”, image.length());<br>for (int index = 0; index &lt; image.length(); index++) tmp[index] = 255 - tmp[index];<br>_return.append(tmp, tmp + image.length()); printf(“_return length: %llu\n”, image.length()); free(tmp);<br>printf(“Revert\n”); }<br>};<br>int main() { int port = 9090; shared_ptr<imageProcServiceHandler> handler(new imageProcServiceHandler()); shared_ptr<TProcessor> processor(new imageProcServiceProcessor(handler)); shared_ptr<TServerTransport> serverTransport(new TServerSocket(port)); shared_ptr<TTransportFactory> transportFactory(new TBufferedTransportFactory()); shared_ptr<TProtocolFactory> protocolFactory(new TBinaryProtocolFactory());<br>TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory); server.serve(); return 0; }[/code] 注意するのは、*<em>.thrift<strong>で指定したimageの型がbinaryなのに、</strong>std::string<strong>になっていることでしょう。 これはバグではなく仕様です。</strong>unsigned char**</em>になることを期待していましたが仕方ありません。 なので、うまく型を変換して内部のデータにアクセスします。 戻りもstd::stringなので、操作したデータを格納するようにします。 しかし、ビルドが通りません。 どうも調べてみると<strong>libthrift</strong>のソースでいくつか必要なファイルがプロジェクトから除外されていることが原因の模様。 そのため、libthriftのプロジェクトに下記を追加します。</p><ul><li>src\thrift\server\TConnectedClient.cpp”</li><li>src\thrift\server\TConnectedClient.h</li><li>src\thrift\server\TNonblockingServer.cpp</li><li>src\thrift\server\TNonblockingServer.h</li><li>src\thrift\server\TServer.cpp</li><li>src\thrift\server\TServerFramework.cpp</li><li>src\thrift\server\TServerFramework.h</li></ul><p>次に、libthriftのプロパティを開きます。 C/C++ -&gt; 全般を開き、追加のインクルード ディレクトリに下記を追加します。</p><ul><li>{libevent_install_dir}</li><li>{libevent_install_dir}\include</li><li>{libevent_install_dir}\WIN32-Code\nmake</li></ul><p>これで、libthriftを再度ビルドし、利用する側もリビルドします。 今度は成功するはずです。</p><h2 id="for-C-1"><a href="#for-C-1" class="headerlink" title="for C"></a>for C</h2><p>クライアント側のソースです。 C++側と異なり、Thriftのビルドは不要でNugetで完結します。 パッケージマネージャー コンソールから下記のコマンドでインストールします。 [code lang=”batch”] Install-Package ApacheThrift -Pre [/code] 2017/04/09現在、安定版は、0.9.3が最新で、C++の最新版である0.10.0とは異なるので不安ですが、これしかないので、これを使います。 クライアントである、C#側は、<a href="http://wp.me/p7138e-v7">.NETでRPCを試してみる gRPC編 第1回</a>と同じ感じです。 クライアントのソースは、Thriftのコンパイラーを使ってコードを生成します。 [code lang=”batch”] thrift-0.10.0.exe-r –gen csharp ImageProcService.thrift [/code] で生成できます。<strong>gen-csharp</strong>というフォルダが生成され、その中に、</p><ul><li>imageProcService.cs</li></ul><p>だけ生成されます。 上記のファイルをC#プロジェクトの適切なフォルダに移動します。 サーバーへアクセスするソースだけ記載します。 [code lang=”csharp”] using System; using System.Windows; using System.Windows.Media; using System.Windows.Media.Imaging; using GalaSoft.MvvmLight; using GalaSoft.MvvmLight.Command; using ImageProcClient.Contracts; using ImageProcClient.ViewModels.Interfaces; using Microsoft.WindowsAPICodePack.Dialogs; using Thrift.Protocol; using Thrift.Transport;<br>namespace ImageProcClient.ViewModels {<br>internal sealed class MainViewModel : ViewModelBase, IMainViewModel {<br>#region Properties<br>private RelayCommand _OpenFileCommand;<br>public RelayCommand OpenFileCommand { get { return this._OpenFileCommand ?? (this._OpenFileCommand = new RelayCommand(() =&gt; { using (var dlg = new CommonOpenFileDialog()) { dlg.IsFolderPicker = false; dlg.AddToMostRecentlyUsedList = false; dlg.AllowNonFileSystemItems = false; dlg.EnsureFileExists = true; dlg.EnsurePathExists = true; dlg.EnsureReadOnly = false; dlg.EnsureValidNames = true; dlg.Multiselect = false; dlg.ShowPlacesList = true;<br>var dialogResult = dlg.ShowDialog(); if (dialogResult != CommonFileDialogResult.Ok) return;<br>var bitmap = new BitmapImage(); try { bitmap.BeginInit(); bitmap.UriSource = new Uri(dlg.FileName); bitmap.EndInit(); this.SourceImage = bitmap; } catch (Exception ex) { MessageBox.Show(ex.Message); } }<br>this._ServerRequestCommand?.RaiseCanExecuteChanged(); }, () =&gt; true)); } }<br>private ImageSource _ResultImage;<br>public ImageSource ResultImage { get { return this._ResultImage; } private set { this._ResultImage = value; this.RaisePropertyChanged(); } }<br>private RelayCommand _ServerRequestCommand;<br>public RelayCommand ServerRequestCommand { get { return this._ServerRequestCommand ?? (this._ServerRequestCommand = new RelayCommand(() =&gt; { var bitmap = this._SourceImage as BitmapImage; if (bitmap == null) return;<br>var width = bitmap.PixelWidth; var height = bitmap.PixelHeight; var stride = (width * bitmap.Format.BitsPerPixel + 7) / 8; var bitsPerPixel = bitmap.Format.BitsPerPixel; var bytesPerPixel = bitsPerPixel / 8; var originalPixels = new byte[width * height * bytesPerPixel]; bitmap.CopyPixels(originalPixels, stride, 0);<br>try { TTransport transport = new TSocket(“localhost”, 9090); TProtocol protocol = new TBinaryProtocol(transport); imageProcService.Client client = new imageProcService.Client(protocol);<br>transport.Open(); try { client.send_Revert(originalPixels, width, height); var resultPixels = client.recv_Revert(); if (resultPixels != null) { var bmpSource = BitmapSource.Create( width, height, bitmap.DpiX, bitmap.DpiY, bitmap.Format, null, resultPixels, stride); if (bmpSource.CanFreeze) bmpSource.Freeze();<br>this.ResultImage = bmpSource; } } finally { transport.Close(); } } catch (Exception x) { Console.WriteLine(x.StackTrace); }<br>}, () =&gt; this._SourceImage != null)); } }<br>private ImageSource _SourceImage;<br>public ImageSource SourceImage { get { return this._SourceImage; } private set { this._SourceImage = value; this.RaisePropertyChanged(); } }<br>#endregion<br>}<br>} [/code] <strong>gRPC</strong>とことなり、メソッドの呼び出し(<strong>send_XXXX</strong>)で即座に結果を返すわけでなく、<strong>recv_XXXX</strong>を追加で呼ぶ必要があります。 こうなると、余計な通信が発生する気がしますが…そういう仕様なので仕方ないのでしょう。</p><h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>実行結果です。 入力画像が反転しているのがわかります。<br><a href="../../../../public/2017/04/test.gif"><img src="../../../../public/2017/04/test-1024x419.gif"></a><br> 別マシンでサーバーを起動して、IPを変更してもきちんと動きます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>C++側が面倒でしたが、それ以外はgRPCと大差ありません。 一度ライブラリを作ってしまえば後は流用できますので、導入コストが少し高いだけです。 その後は、マシン間通信がこれでもか、というくらい楽になります。 C++でサーバー側を実装するなら、gRPCよりもThriftのがおすすめな感じはします(gRPCのC++は試していませんが…)</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/RPC-ApacheTrift1">https://github.com/takuya-takeuchi/Demo/tree/master/RPC-ApacheTrift1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> remote-procedure-call </category>
          
          <category> .NETでRPCを試してみる </category>
          
          <category> Apache Thrift </category>
          
          <category> Remote Procedure Call </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでRPCを試してみる Apache Thrift編 第0回</title>
      <link href="/2017/04/09/1991/"/>
      <url>/2017/04/09/1991/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="http://wp.me/p7138e-v2">.NETでRPCを試してみる gRPC編 第0回</a>のように、最新のRPCとして<strong>gRPC</strong>を試しました。 さまざまな言語をサポートしているので、C++でしか動かない (C#のP/InvokeやC++/CLIからも動作しない) ライブラリをRPCで動かそうと思いました。 ところが、C++でgRPCを動かすのは面倒な模様。</p><ul><li>CMake</li><li>Active State Perl</li><li>Ninja</li><li>Go</li><li>yasm</li></ul><p>といったモジュールのインストールが必要のため断念。 かわりに見つけたのが<strong>Apache Thrift</strong>。 こちらも、クライアント/サーバーのコードを生成して利用するため、ロジックの実装に注力できるRPCフレームワーク。 公式は下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://thrift.apache.org/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=thrift.apache.org"></img><div class="hbc-site-name">thrift.apache.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Apache Thrift - Home</div><div class="hbc-url">https://thrift.apache.org/</div></div></div></div></a></div></div><p>今回は、クライアントをC#、サーバーをC++として試してみます。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>Thriftのライブラリは自分でビルドする必要があります。 そのために、下記の手順で、関連ライブラリなどを入手していきます。</p><h2 id="boost"><a href="#boost" class="headerlink" title="boost"></a>boost</h2><p><a href="https://sourceforge.net/projects/boost/">Boost C++ Libraries</a>からインストーラを落としてきて展開します。 2017/04/09時点で、1.63が安定版の最新です。</p><h2 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h2><p><strong>Heartbleed</strong>でも有名になったSSLのライブラリですね。公式ページは下記。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.openssl.org/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.openssl.org"></img><div class="hbc-site-name">www.openssl.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">  /index.html  </div><div class="hbc-url">https://www.openssl.org/</div></div></div></div></a></div></div><p>OpenSSLは、2017/04/09時点で、1.1.0eが安定版の最新ですが、1.1.0系はネット上で転がっている情報が少ないし、ビルド方法が違っていて、ビルドできなかったので、1.0.2系を使います。 2017/04/09時点で、1.0.2jが1.0.2系の最新です。 一応説明すると、バイナリの入手は2通りあります。</p><ul><li>有志が配布しているバイナリの入手<ul><li>現在有志が配布していて、最新版はインストーラのみで環境が汚れてしまう、かつ寄付を求められます。</li></ul></li><li>自分でビルド<ul><li>Perlのインストールが必要で、環境が汚れてしまう。</li><li>Perlの有名どころの<strong>ActivePerl</strong>は無償と有償がある。企業利用でも、<strong>pre-production development and prototyping</strong>なら無償版が使える。<ul><li>ビルドのためだけなので無償版でOK?</li></ul></li><li>最近は、<a href="http://strawberryperl.com/">Strawberry Perl</a>というのがあり、かつzipのようなポータブル版もある。</li></ul></li></ul><p>というわけで、インストーラは嫌なので、今回は自分でビルドするために、Strawberry PerlのPortable版を入手しました。 2017/04/09時点で、Strawberry Perlは、5.24.1.1が安定版の最新です。 Portable版でも123MBあります。展開後は、400MBを超えますのでディスク容量には注意。 Strawberry Perlを展開後、<code>スタート &gt; 全てのプログラム &gt; Visual Studio 2015 &gt; Windows Desktop Command Prompts &gt; VS2015 x64 Native Tools コマンド プロンプト</code>を起動、そしてStrawberry Perlの展開先まで移動し、下記のように実行します。 [code lang=”batch”] D:\Works\Lib\Strawberry Perl\5.24.1.1&gt;portableshell.bat ———————————————- Welcome to Strawberry Perl Portable Edition! * URL - <a href="http://www.strawberryperl.com/">http://www.strawberryperl.com/</a> * see README.TXT for more info ———————————————- Perl executable: D:\Works\Lib\Strawberry Perl\5.24.1.1\perl\bin\perl.exe Perl version : 5.24.1 / MSWin32-x64-multi-thread [/code] 続いて、OpenSSLの展開先まで移動します。そして、下記のように実行します。 [code lang=”batch”] c:\openssl-1.0.2j&gt;mkdir “openssl-1.0.2j_x64_VC-WIN” c:\openssl-1.0.2j&gt;set TARGET=%CD%\openssl-1.0.2j_x64_VC-WIN c:\openssl-1.0.2j&gt;perl Configure VC-WIN64A –prefix=”%TARGET%” no-asm Configuring for VC-WIN64A no-asm [option] OPENSSL_NO_ASM no-ec_nistp_64_gcc_128 [default] OPENSSL_NO_EC_NISTP_64_GCC_128 (skip dir) no-gmp [default] OPENSSL_NO_GMP (skip dir) no-jpake [experimental] OPENSSL_NO_JPAKE (skip dir) no-krb5 [krb5-flavor not specified] OPENSSL_NO_KRB5 no-libunbound [experimental] OPENSSL_NO_LIBUNBOUND (skip dir) no-md2 [default] OPENSSL_NO_MD2 (skip dir) no-rc5 [default] OPENSSL_NO_RC5 (skip dir) no-rfc3779 [default] OPENSSL_NO_RFC3779 (skip dir) no-sctp [default] OPENSSL_NO_SCTP (skip dir) no-shared [default] no-ssl-trace [default] OPENSSL_NO_SSL_TRACE (skip dir) no-ssl2 [default] OPENSSL_NO_SSL2 (skip dir) no-store [experimental] OPENSSL_NO_STORE (skip dir) no-unit-test [default] OPENSSL_NO_UNIT_TEST (skip dir) no-weak-ssl-ciphers [default] OPENSSL_NO_WEAK_SSL_CIPHERS (skip dir) no-zlib [default] no-zlib-dynamic [default] IsMK1MF=1 CC =cl CFLAG =-DOPENSSL_THREADS -DDSO_WIN32 -W3 -Gs0 -Gy -nologo -DOPENSSL_SYS NAME_WIN32 -DWIN32_LEAN_AND_MEAN -DL_ENDIAN -DUNICODE -D_UNICODE -D_CRT_SECURE_NO_DEPRECATE EX_LIBS = CPUID_OBJ =mem_clr.o BN_ASM =bn_asm.o EC_ASM = DES_ENC =des_enc.o fcrypt_b.o AES_ENC =aes_core.o aes_cbc.o BF_ENC =bf_enc.o CAST_ENC =c_enc.o RC4_ENC =rc4_enc.o rc4_skey.o RC5_ENC =rc5_enc.o MD5_OBJ_ASM = SHA1_OBJ_ASM = RMD160_OBJ_ASM= CMLL_ENC =camellia.o cmll_misc.o cmll_cbc.o MODES_OBJ = ENGINES_OBJ = PROCESSOR = RANLIB =true ARFLAGS = PERL =perl SIXTY_FOUR_BIT mode DES_INT used RC4_CHUNK is unsigned long long<br>Configured for VC-WIN64A. [/code] 次に、<strong>do_win64a.bat</strong>というバッチを実行します。 [code lang=”batch”] C:\openssl-1.0.2j&gt;ms\do_win64a.bat<br>C:\openssl-1.0.2j&gt;perl util\mkfiles.pl 1&gt;MINFO<br>C:\openssl-1.0.2j&gt;cmd /c “nasm -f win64 -v” 1&gt;NUL 2&gt;&amp;1<br>C:\openssl-1.0.2j&gt;if 0 NEQ 0 goto ml64<br>C:\openssl-1.0.2j&gt;perl ms\uplink-x86_64.pl nasm 1&gt;ms\uptable.asm<br>C:\openssl-1.0.2j&gt;nasm -f win64 -o ms\uptable.obj ms\uptable.asm ms\uptable.asm:17: warning: absolute address can not be RIP-relative ms\uptable.asm:24: warning: absolute address can not be RIP-relative ms\uptable.asm:37: warning: absolute address can not be RIP-relative ms\uptable.asm:44: warning: absolute address can not be RIP-relative ms\uptable.asm:57: warning: absolute address can not be RIP-relative ms\uptable.asm:64: warning: absolute address can not be RIP-relative ms\uptable.asm:77: warning: absolute address can not be RIP-relative ms\uptable.asm:84: warning: absolute address can not be RIP-relative ms\uptable.asm:97: warning: absolute address can not be RIP-relative ms\uptable.asm:104: warning: absolute address can not be RIP-relative ms\uptable.asm:117: warning: absolute address can not be RIP-relative ms\uptable.asm:124: warning: absolute address can not be RIP-relative ms\uptable.asm:137: warning: absolute address can not be RIP-relative ms\uptable.asm:144: warning: absolute address can not be RIP-relative ms\uptable.asm:157: warning: absolute address can not be RIP-relative ms\uptable.asm:164: warning: absolute address can not be RIP-relative ms\uptable.asm:177: warning: absolute address can not be RIP-relative ms\uptable.asm:184: warning: absolute address can not be RIP-relative ms\uptable.asm:197: warning: absolute address can not be RIP-relative ms\uptable.asm:204: warning: absolute address can not be RIP-relative ms\uptable.asm:217: warning: absolute address can not be RIP-relative ms\uptable.asm:224: warning: absolute address can not be RIP-relative ms\uptable.asm:237: warning: absolute address can not be RIP-relative ms\uptable.asm:244: warning: absolute address can not be RIP-relative ms\uptable.asm:257: warning: absolute address can not be RIP-relative ms\uptable.asm:264: warning: absolute address can not be RIP-relative ms\uptable.asm:277: warning: absolute address can not be RIP-relative ms\uptable.asm:284: warning: absolute address can not be RIP-relative ms\uptable.asm:297: warning: absolute address can not be RIP-relative ms\uptable.asm:304: warning: absolute address can not be RIP-relative ms\uptable.asm:317: warning: absolute address can not be RIP-relative ms\uptable.asm:324: warning: absolute address can not be RIP-relative ms\uptable.asm:337: warning: absolute address can not be RIP-relative ms\uptable.asm:344: warning: absolute address can not be RIP-relative ms\uptable.asm:357: warning: absolute address can not be RIP-relative ms\uptable.asm:364: warning: absolute address can not be RIP-relative ms\uptable.asm:377: warning: absolute address can not be RIP-relative ms\uptable.asm:384: warning: absolute address can not be RIP-relative ms\uptable.asm:397: warning: absolute address can not be RIP-relative ms\uptable.asm:404: warning: absolute address can not be RIP-relative ms\uptable.asm:417: warning: absolute address can not be RIP-relative ms\uptable.asm:424: warning: absolute address can not be RIP-relative ms\uptable.asm:437: warning: absolute address can not be RIP-relative ms\uptable.asm:444: warning: absolute address can not be RIP-relative<br>C:\openssl-1.0.2j&gt;goto proceed<br>C:\openssl-1.0.2j&gt;perl util\mk1mf.pl VC-WIN64A 1&gt;ms\nt.mak<br>C:\openssl-1.0.2j&gt;perl util\mk1mf.pl dll VC-WIN64A 1&gt;ms\ntdll.mak<br>C:\openssl-1.0.2j&gt;perl util\mkdef.pl 32 libeay 1&gt;ms\libeay32.def<br>C:\openssl-1.0.2j&gt;perl util\mkdef.pl 32 ssleay 1&gt;ms\ssleay32.def [/code] 以上で、ビルドの準備ができました。 そして、下記のコマンドを実行することで、<strong>openssl-1.0.2j_x64_VC-WIN</strong>に成果物が出来上がります。 [code lang=”batch”] C:\openssl-1.0.2j&gt;nmake -f ms\nt.mak C:\openssl-1.0.2j&gt;nmake -f ms\nt.mak install [/code] 成功すると、</p><ul><li>openssl-1.0.2j_x64_VC-WIN\bin</li><li>openssl-1.0.2j_x64_VC-WIN\include</li><li>openssl-1.0.2j_x64_VC-WIN\lib</li><li>openssl-1.0.2j_x64_VC-WIN\ssl</li></ul><p>というフォルダができています。</p><h2 id="libevent"><a href="#libevent" class="headerlink" title="libevent"></a>libevent</h2><p>聞きなれないライブラリですが、公式ページ </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://libevent.org/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=libevent.org"></img><div class="hbc-site-name">libevent.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">libevent</div><div class="hbc-url">http://libevent.org/</div></div></div></div></a></div></div><p>によれば、</p><blockquote><p>The libevent API provides a mechanism to execute a callback function when a specific event occurs on a file descriptor or after a timeout has been reached. Furthermore, libevent also support callbacks due to signals or regular timeouts. libevent is meant to replace the event loop found in event driven network servers</p></blockquote><p>とのこと。つまり、特定のイベントが発生したりしたら、コールバック関数を実行するメカニズムを提供するAPIがlibeventであり、イベントドリブンなネットワークサービス内のイベントループを置き換えるもの、とのこと。 確かに、C++ってイベントみたいな機構って、コールバックしかないし、それらをモジュールで積極的に使うってシーンがないから、こういうライブラリはありがたいのかも。 詳しい説明は例のごとくWikipedia。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://en.wikipedia.org/wiki/Libevent" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=en.wikipedia.org"></img><div class="hbc-site-name">en.wikipedia.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">libevent - Wikipedia</div><div class="hbc-url">https://en.wikipedia.org/wiki/Libevent</div></div></div></div></a></div></div><p>入手先は、公式ページの<strong>Download–Stable releases</strong>から。 2017/04/09時点で、2.1.8が安定版の最新です。 ソースからビルドするタイプです。 ビルドは簡単で、</p><ol><li><code>スタート &gt; 全てのプログラム &gt; Visual Studio 2015 &gt; 開発者コマンド プロンプト for VS2015</code> を開く</li><li>libeventの展開先フォルダに移動</li><li><strong>nmake -f Makefile.nmake</strong> を実行</li></ol><p>以上です。 終了時に、 [code lang=”batch”] NMAKE : fatal error U1073: ‘print-winsock-errors.obj’ のビルド方法が指定されていません。 Stop. NMAKE : fatal error U1077: ‘“C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\BIN\nmake.exe”‘ : リターン コード ‘0x2’ Stop. [/code] と表示されますが、 libevent.lib libevent_core.lib libevent_extras.lib が、フォルダに出来上がっています。</p><h2 id="Apache-Thrift-amp-Compiler"><a href="#Apache-Thrift-amp-Compiler" class="headerlink" title="Apache Thrift &amp; Compiler"></a>Apache Thrift &amp; Compiler</h2><p>ソースとコンパイラーを入手します。 <a href="https://thrift.apache.org/download">Download</a>から、<strong>thrift-0.10.0.tar.gz</strong>、<strong>Thrift compiler for Windows</strong>をダウンロードします。 2017/04/09時点で、0.10.0が最新です。 コンパイラーといっても、<strong>gRPC tool</strong>のように、定義ファイルからコードを生成するだけのものです。 ソースは、任意の場所に展開します。 展開先の<strong>lib\cpp</strong>に<strong>thrift.sln</strong>があるので、Visual Studioで起動します。</p><h3 id="libthrift"><a href="#libthrift" class="headerlink" title="libthrift"></a>libthrift</h3><p>libthriftのプロパティを開きます。 <code>C/C++ -&gt; 全般</code>を開き、<strong>追加のインクルード ディレクトリ</strong>に下記を追加します。 [code] {boost_install_dir}\boost_X_YZ_0 {boost_install_dir}\boost_X_YZ_0\boost {openssl_install_dir}\include [/code] <code>ライブラリアン -&gt; 全般</code>を開き、<strong>追加のライブラリ ディレクトリ</strong>に下記を追加します。&gt;を開き、<strong>追加のライブラリ ディレクトリ</strong>に下記を追加します。 [code] {openss_install_dir}\lib [/code] 最後に、libthrift\concurrency\BoostThreadFactory.cppを<strong>プロジェクトから除外</strong>します。</p><h3 id="libthriftnb"><a href="#libthriftnb" class="headerlink" title="libthriftnb"></a>libthriftnb</h3><p>libthriftのプロパティを開きます。 <code>C/C++ -&gt; 全般</code>を開き、<strong>追加のインクルード ディレクトリ</strong>に下記を追加します。 [code] {boost_install_dir} {libevent_install_dir} {libevent_install_dir}\include {libevent_install_dir}\WIN32-Code\nmake [/code] 以上の設定を終えたら、ビルドが可能になります。 ソリューションでDebug/Release/Debug-mt/Release-mt、ターゲットプラットフォーム(x64/Win32)を選択してビルドします。</p><ul><li>libthriftnb.lib</li><li>libthrift.lib</li></ul><p>が生成されているはずです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回は導入のみ。 次回は、C#-C++で通信してみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> remote-procedure-call </category>
          
          <category> .NETでRPCを試してみる </category>
          
          <category> Apache Thrift </category>
          
          <category> Remote Procedure Call </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その41 OpenCVで非ユニコード文字列ファイル名を扱う</title>
      <link href="/2017/04/06/1981/"/>
      <url>/2017/04/06/1981/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>OpenCVSharp</strong>の<strong>OpenCVSharp.Cv2.ImReadメソッド</strong>は、内部的には、<strong>OpenCV</strong>の<strong>cv::imread関数</strong>を呼んでいます。 問題は、OpenCVがユニコード文字列を扱えないため、<strong>ANSI文字列</strong>しか受け取れないことです。 より正確には、OpenCVSharpからネイティブに自動的にマーシャリングされる際に、<strong>System.String</strong>、つまり<strong>UTF-16</strong>からANSI文字列に変換されています。 その際、非ユニコードに変換できない文字列を含むと以下の例外を投げます。 [caption id=”attachment_1982” align=”aligncenter” width=”452”]<br><a href="../../../../public/2017/04/1074ec724367dd0925df33536aa3376a.png"><img src="../../../../public/2017/04/1074ec724367dd0925df33536aa3376a.png"></a><br> マーシャリングできません: マップできない文字を検出しました。[/caption] UTF-16から、ANSIへのマーシャリングは、.NETのソースを見ると、<strong>System.String.ConvertToAnsiメソッド</strong>を経由し、<strong>WideCharToMultiByte関数</strong>が呼ばれています。 なので、どうしようもありません。 本当に?</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>問題は、下記にように、ファイルパスを渡しているから問題が起きるわけです。 [code lang=”csharp”] var mat = OpenCvSharp.Cv2.ImRead(filepath); [/code] つまり、下記のように、メモリデータを直接渡し、デコードすれば良いわけです。 [code lang=”csharp”] var array = File.ReadAllBytes(filepath); var mat = Cv2.ImDecode(array, ImreadModes.Color); [/code] <strong>Cv2.ImDecode</strong>の第2引数は指定が必須です。OpenCvSharp.Cv2.ImReadは本来第2引数がありますが、既定で<strong>ImreadModes.Color</strong>が設定されるので、同じ値にしておきました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> マルチメディア </category>
          
          <category> OpenCV </category>
          
          <category> OpenCvSharp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その40 DEP0700 : アプリケーションの登録に失敗しました</title>
      <link href="/2017/04/04/1976/"/>
      <url>/2017/04/04/1976/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="../../../../public/2017/04/10d4564c607d12d78e9df6bdb413548a.png"><img src="../../../../public/2017/04/10d4564c607d12d78e9df6bdb413548a.png"></a></p><blockquote><p>DEP0700 : アプリケーションの登録に失敗しました。エラー 0x80070005: エラー アクセスが拒否されました。 が発生したため、場所 AppxManifest.xml からファイルを開くことができませんでした。 (0x80070005)</p></blockquote><p>なんともわかりにくいですが…こんな問題が発生しました。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>原因はプロジェクトが存在している親ディレクトリのアクセス権がおかしくなっていたからでした。 フォルダのプロパティ内のセキュリティタブに、<strong>Authenticated Users</strong>グループが存在していなかったため、追加して、再度展開したらうまくいきました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その39 外部プロセスからUWPAppにメッセージを送信できるか?</title>
      <link href="/2017/04/03/1970/"/>
      <url>/2017/04/03/1970/</url>
      
        <content type="html"><![CDATA[<h1 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h1><p><a href="http://wp.me/p7138e-vC">開発メモ その38 プロセスIDからUWPAppのHWNDは取得できるか?</a>からの追加調査というか本題。 ウィンドウハンドルが取得できれば、たいていのことはできるのがWindows。 <strong>WinForms</strong>でも<strong>WPF</strong>でも、結局かゆいところは<strong>Win32API</strong>様を三顧の礼で迎え入れる必要がある。 で、サンドボックス環境で動作するUWPアプリに対して、ウィンドウハンドルを経由して操作ができるか。 これができるかどうかは結構大きい。 <a href="http://stackoverflow.com/questions/34935077/getting-hwnd-off-of-corewindow-object-in-uwp">Getting HWND off of CoreWindow object in UWP</a>にで、<strong>Microsoft</strong>の人間がこのようにコメントしている。</p><blockquote><p>Please note there are no supported APIs for UWP that accept an HWND. Any API you call will fail Windows Store certification, and even if you avoid the Windows Store (eg, side-load or go through an Enterprise deployment) there is no guarantee the app will work in the future.</p></blockquote><p>パッと見、Win32APIの呼び出しがダメ、みたいに見えるけど、よく読むと、**(APIを呼び出すと)ストア認証に失敗する**って言っているだけで、APIそのものの成否ついては言及していない。 なので、試してみた。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><h2 id="一部成功。"><a href="#一部成功。" class="headerlink" title="一部成功。"></a>一部成功。</h2><p>[code lang=”csharp”] using System; using System.Linq; using System.Runtime.InteropServices; using System.Text; using DWORD = System.UInt32;<br>namespace ConsoleApplication1 { class Program { delegate bool Win32Callback(IntPtr hWnd, ref IntPtr lParam);<br>[DllImport(“user32.dll”)] [return: MarshalAs(UnmanagedType.Bool)] static extern bool EnumWindows(Win32Callback lpEnumFunc, ref IntPtr lParam);<br>[DllImport(“user32.dll”, SetLastError = true)] static extern IntPtr FindWindowEx(IntPtr hwndParent, IntPtr hwndChildAfter, string lpszClass, string lpszWindow);<br>[DllImport(“user32.dll”, CharSet = CharSet.Auto)] static extern int GetClassName(IntPtr hWnd, StringBuilder lpClassName, int nMaxCount);<br>[DllImport(“user32.dll”, SetLastError = true)] static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);<br>[DllImport(“user32.dll”, EntryPoint = “MapVirtualKeyA”)] static extern int MapVirtualKey(int wCode, int wMapType);<br>[DllImport(“user32.dll”, SetLastError = true)] static extern uint SendInput(uint cInputs, KEYBOARDINPUT[] inputs, int cbSize);<br>[DllImport(“user32.dll”)] static extern int SetForegroundWindow(IntPtr hWnd);<br>const uint INPUT_KEYBOARD = 1;<br>const uint KEYEVENTF_KEYDOWN = 0;<br>const uint KEYEVENTF_KEYUP = 2;<br>const ushort VK_DELETE = 0x2E;<br>const int KBD_UNICODE = 0x0004;<br>[StructLayout(LayoutKind.Sequential)] private struct KEYBOARDINPUT { public uint type; public ushort wVk; public ushort wScan; public uint dwFlags; public uint time; public uint dwExtraInfo; public uint unused1; public uint unused2; }<br>static readonly uint GW_HWNDNEXT = 2;<br>static readonly int GWL_HWNDPARENT = -8;<br>static readonly IntPtr NULL = System.IntPtr.Zero;<br>static void Main(string[] args) { var hTarget = IntPtr.Zero; var ps = System.Diagnostics.Process.GetProcesses().Where(process =&gt; process.ProcessName == “Calculator”); if (!ps.Any()) return;<br>var calc = ps.First(); var pid = calc.Id;<br>Console.WriteLine(“プロセス名: {0}”, calc.ProcessName); Console.WriteLine(“ID: {0}”, calc.Id);<br>// EnumWindowsProc で探索対象のプロセスIDを設定 TargetProcessId = (uint)pid;<br>var proc = new Win32Callback(EnumWindowsProc);<br>EnumWindows(proc, ref hTarget);<br>Console.WriteLine(“HWND: {0}”, hTarget.ToString(“X”));<br>if (hTarget == NULL) { Console.WriteLine(“EnumWindows fails”); return; }<br>SendDelKey(hTarget); }<br>private static void SendDelKey(IntPtr hwnd) { // フォアグラウンドに移動 if (SetForegroundWindow(hwnd) == 0) { Console.WriteLine(“SetForegroundWindow fails”); return; }<br>// Delキーを送って、電卓の数字を0にする KEYBOARDINPUT[] inputs; uint retVal; inputs = new KEYBOARDINPUT[2]; inputs[0].type = INPUT_KEYBOARD; inputs[0].wVk = VK_DELETE; inputs[0].wScan = (ushort)MapVirtualKey(VK_DELETE, 0); inputs[0].dwFlags = (KEYEVENTF_KEYDOWN | KBD_UNICODE);<br>inputs[1].type = INPUT_KEYBOARD; inputs[1].wVk = VK_DELETE; inputs[1].wScan = (ushort)MapVirtualKey(VK_DELETE, 0); inputs[1].dwFlags = (KEYEVENTF_KEYUP | KBD_UNICODE);<br>var cbSize = Marshal.SizeOf<KEYBOARDINPUT>(); if (SendInput(2, inputs, cbSize) == 0) { Console.WriteLine(“SendInput fails”); return; } }<br>private static uint TargetProcessId;<br>static bool EnumWindowsProc(IntPtr hWnd, ref IntPtr lParam) { var hChild = IntPtr.Zero; var buf = new StringBuilder(1024); GetClassName(hWnd, buf, buf.Capacity); switch (buf.ToString()) { case “ApplicationFrameWindow”: hChild = FindWindowEx(hWnd, IntPtr.Zero, “Windows.UI.Core.CoreWindow”, null); DWORD processId; GetWindowThreadProcessId(hChild, out processId); if (TargetProcessId == processId) { lParam = hChild; return false; } break; default: break; } return true; }<br>} } [/code] 電卓に対してDELキーを送信し、数字を消すだけ。 でも、電卓は<strong>SetForegroundWindow</strong>で前面には来たけど、<strong>SendInput</strong>が失敗する。 Win7の電卓アプリで、似たようなコードが成功するかは確認済み。</p><h1 id="Supplement"><a href="#Supplement" class="headerlink" title="Supplement"></a>Supplement</h1><p>結局、<a href="http://stackoverflow.com/questions/33026109/windows-10-universal-app-key-press-simulation-what-os-context/33027256#33027256">Windows 10 Universal App Key Press Simulation, what OS Context?</a>という記事で、Microsoftの人間が</p><blockquote><p>There is no way to synthesize input in a Universal app. The SendInput API (and equivalents) that InputSimulator uses to inject input is available only to classic Win32 desktop apps, not to Windows Runtime apps.</p></blockquote><p>と発言しているから無理なんでしょう。 全てのWin32APIが無効、というわけではないが、入出力系は全滅かもしれない。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その38 プロセスIDからUWPAppのHWNDは取得できるか?</title>
      <link href="/2017/04/02/1960/"/>
      <url>/2017/04/02/1960/</url>
      
        <content type="html"><![CDATA[<h1 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h1><p>またまたつまらない疑問。 <a href="http://wp.me/p7138e-vv">開発メモ その36 UWPAppはSystem.Diagnostics.Process.GetProcessesで列挙されるか?</a>で試したように、プロセスIDがわかれば<strong>Win32API</strong>を駆使してHWNDを取得できるか?という件。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p>ちょっと面倒な模様。 <a href="http://wp.me/p7138e-vy">開発メモ その37 UWPAppはどういうウィンドウ構造をしているか?</a>で書いたように、UWPアプリは、</p><ul><li>ApplicationFrameWindow<ul><li>Windows.UI.Core.CoreWindow</li></ul></li></ul><p>という構造になっている状態。 で、<strong>Spy++**で調べた結果、先の</strong>System.Diagnostics.Process.GetProcessesメソッド<strong>で取得できるプロセスIDは</strong>Windows.UI.Core.CoreWindow**のものであることがわかった、 つまり、<br><a href="../../../../public/2017/04/eb9b61e54967a2b697bd592c0f22fb40.png"><img src="../../../../public/2017/04/eb9b61e54967a2b697bd592c0f22fb40.png"></a> <a href="../../../../public/2017/04/41d12a955711c9847aa105f4dde27a91.png"><img src="../../../../public/2017/04/41d12a955711c9847aa105f4dde27a91.png"></a> プロセスIDが違うのである。 なので、<a href="https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms633514(v=vs.85).aspx">GetTopWindow</a>、<a href="https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms633522(v=vs.85).aspx">GetWindowThreadProcessId</a>、<a href="https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms633515(v=vs.85).aspx">GetWindow</a><br>を駆使して、トップレベルウィンドウから対象のプロセスIDを探す方法ではダメ。 面倒だが、トップレベルウィンドウのクラス名がApplicationFrameWindowかつ子ウィンドウのクラス名がWindows.UI.Core.CoreWindowになっているウィンドウを探し出し、そのプロセスIDと比較する必要がありそう。 具体的には、 [code lang=”csharp”] using System; using System.Linq; using System.Runtime.InteropServices; using System.Text; using HWND = System.IntPtr; using DWORD = System.UInt32;<br>namespace ConsoleApplication1 { class Program { delegate bool Win32Callback(IntPtr hWnd, ref IntPtr lParam);<br>[DllImport(“user32.dll”)] [return: MarshalAs(UnmanagedType.Bool)] static extern bool EnumWindows(Win32Callback lpEnumFunc, ref IntPtr lParam);<br>[DllImport(“user32.dll”, SetLastError = true)] static extern IntPtr FindWindowEx(IntPtr hwndParent, IntPtr hwndChildAfter, string lpszClass, string lpszWindow);<br>[DllImport(“user32.dll”, CharSet = CharSet.Auto)] static extern int GetClassName(IntPtr hWnd, StringBuilder lpClassName, int nMaxCount);<br>[DllImport(“user32.dll”, SetLastError = true)] static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);<br>static readonly uint GW_HWNDNEXT = 2;<br>static readonly int GWL_HWNDPARENT = -8;<br>static readonly IntPtr NULL = System.IntPtr.Zero;<br>static void Main(string[] args) { var ps = System.Diagnostics.Process.GetProcesses().Where(process =&gt; process.ProcessName == “Calculator”); if (!ps.Any()) return;<br>var calc = ps.First(); var pid = calc.Id;<br>Console.WriteLine(“プロセス名: {0}”, calc.ProcessName); Console.WriteLine(“ID: {0}”, calc.Id);<br>// EnumWindowsProc で探索対象のプロセスIDを設定 TargetProcessId = (uint)pid;<br>var proc = new Win32Callback(EnumWindowsProc);<br>var hTarget = IntPtr.Zero; EnumWindows(proc, ref hTarget);<br>Console.WriteLine(“HWND: {0}”, hTarget.ToString(“X”)); }<br>private static uint TargetProcessId;<br>static bool EnumWindowsProc(IntPtr hWnd, ref IntPtr lParam) { var hChild = IntPtr.Zero; var buf = new StringBuilder(1024); GetClassName(hWnd, buf, buf.Capacity); switch (buf.ToString()) { case “ApplicationFrameWindow”: hChild = FindWindowEx(hWnd, IntPtr.Zero, “Windows.UI.Core.CoreWindow”, null); DWORD processId; GetWindowThreadProcessId(hChild, out processId); if (TargetProcessId == processId) { lParam = hChild; return false; } break; } return true; }<br>} } [/code] これで、電卓のウィンドウハンドルを取得できる。<br><a href="../../../../public/2017/04/a2712cf3558c2556384502efa76ee838.png"><img src="../../../../public/2017/04/a2712cf3558c2556384502efa76ee838.png"></a> <a href="../../../../public/2017/04/761cb6a027065618b3ec41be0f7e7c25.png"><img src="../../../../public/2017/04/761cb6a027065618b3ec41be0f7e7c25.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その37 UWPAppはどういうウィンドウ構造をしているか?</title>
      <link href="/2017/04/02/1956/"/>
      <url>/2017/04/02/1956/</url>
      
        <content type="html"><![CDATA[<h1 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h1><p>またもつまらない疑問。 単純にGoogleで**”UWP” “Spy++”**って検索してもなかなかどうして意図した結果が見つからない。 なので、試してみた。</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><p><strong>Spy++**でチェックしてみた。<br><a href="../../../../public/2017/04/fd7811306d0495d36c96177f16b148ad.png"><img src="../../../../public/2017/04/fd7811306d0495d36c96177f16b148ad.png"></a> <a href="https://msdn.microsoft.com/library/windows/apps/Windows.UI.Core.CoreWindow">Windows.UI.Core.CoreWindow</a><br>はわかります。 **UWP</strong>で<strong>HWND</strong>にアクセスすするためのI/Fですね。 <strong>ApplicationFrameWindow</strong>って何さ?って感じですが、ストアアプリをラップしているだけなのか? このあたりは、<strong>MVP</strong>の<strong>Tomoaki Masuda氏</strong>が記事にしていました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.moonmile.net/blog/archives/6433" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.moonmile.net"></img><div class="hbc-site-name">www.moonmile.net</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Windows 10 Technical Preview を Hyper-V で試す | Moonmile Solutions Blog</div><div class="hbc-url">http://www.moonmile.net/blog/archives/6433</div></div></div></div></a></div></div><p>MSDNでも記事が無いですね….</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その36 UWPAppはSystem.Diagnostics.Process.GetProcessesで列挙されるか?</title>
      <link href="/2017/04/02/1953/"/>
      <url>/2017/04/02/1953/</url>
      
        <content type="html"><![CDATA[<h1 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h1><p><strong>System.Diagnostics.Process.GetProcesses メソッド</strong>は、<strong>UWPアプリ</strong>を列挙するのか? というつまらない疑問。 ネット上見ても、出来る、出来ない、すら書いてない。 自明のことだから書いてないだけなの?</p><h1 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h1><h2 id="できる。"><a href="#できる。" class="headerlink" title="できる。"></a>できる。</h2><p>電卓を起動し、下記のプログラムを実行する。 [code lang=”csharp”] using System; using System.Linq;<br>namespace ConsoleApplication1 { class Program { static void Main(string[] args) { var ps = System.Diagnostics.Process.GetProcesses(); foreach (var p in ps.Where(process =&gt; process.ProcessName == “Calculator”)) { try { Console.WriteLine(“プロセス名: {0}”, p.ProcessName); Console.WriteLine(“ID: {0}”, p.Id); Console.WriteLine(“ファイル名: {0}”, p.MainModule.FileName); } catch (Exception ex) { Console.WriteLine(“エラー: {0}”, ex.Message); }<br>Console.WriteLine(); } } } } [/code] 実行結果は、 [code lang=”batch”] プロセス名: Calculator ID: 49308 ファイル名: C:\Program Files\WindowsApps\Microsoft.WindowsCalculator_10.1703.601.0_x64__8wekyb3d8bbwe\Calculator.exe [/code]</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その35 protoファイルからドキュメントを生成する</title>
      <link href="/2017/03/27/1947/"/>
      <url>/2017/03/27/1947/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://www.grpc.io/">gRPC</a>は非常に良い技術です。 protoファイルから、クライアント側とサーバー側のコードを自動で生成してくれます。 つまり、protoファイルそのものが仕様書になるわけです。 でも、その仕様書からドキュメントを作成できたら、さらに良くないですか? コーディングをしているエンジニアの大半は、ドキュメント化が苦手ではないでしょうか？(偏見) ソースにコメントを書くのは好きですけど、WordまたはExcelで、見栄えの良いドキュメントを作るのはしんどいです。 ましてや、ソースにある、メソッド名やクラス名を、もう一度書くとか苦行です。 そんな苦行から私たちを解放してくれるのが、<strong>protoc-gen-doc</strong>です。 </p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p><a href="https://github.com/estan/protoc-gen-doc#invoking-the-plugin">githubでの説明</a>が、かなり端折っていてげんなりしますが、実行は簡単です。 <a href="https://github.com/estan/protoc-gen-doc/releases">protoc-gen-doc</a>からWindows版がリリースされていますので、ダウンロードして、展開します。 次に、<a href="https://github.com/google/protobuf">Protocol Buffers</a>から<strong>protoc.exe</strong>を入手します。 または、NugetでgRPC toolsを入手していれば、</p><ul><li>%USERPROFILE%.nuget\packages\grpc.tools\X.Y.Z\tools\windows_x64\protoc.exe</li><li>%USERPROFILE%.nuget\packages\grpc.tools\X.Y.Z\tools\windows_x86\protoc.exe</li></ul><p>が展開されていますので、それを利用します。 X.Y.Zはバージョン部分ですので、入手時期によって、変わります。 試しに、<a href="http://wp.me/p7138e-v7">.NETでgRPCを試してみる 第1回</a>で使った、protoファイルからドキュメントを生成してみます。 そして、下記のバッチを作成し、<strong>PLUGIN_PROTOC_GEN_DOC</strong>や<strong>PROTOC</strong>等を適切な場所に変更します。 [code lang=”batch”] set PROTOC=%USERPROFILE%\.nuget\packages\grpc.tools\1.2.0\tools\windows_x64\protoc.exe set OUT_FILENAME=index.html set OUT_DIR=doc set PLUGIN_PROTOC_GEN_DOC=%USERPROFILE%\Downloads\protoc-gen-doc-v0.9-win32\protoc-gen-doc.exe set PROTOC_FILE=imageProc.proto mkdir %OUT_DIR% “%PROTOC%” –doc_out=html,%OUT_FILENAME%:%OUT_DIR% %PROTOC_FILE% –plugin=protoc-gen-doc=”%PLUGIN_PROTOC_GEN_DOC%” [/code] <strong>PROTO_FILE</strong>の場所も変更します。上のバッチファイルは、PROTO_FILEがある場所をカレントディレクトリにしていますので、適宜変更してください。 実行すると、カレントディレクトリに<strong>doc\index.html</strong>が作成されます。 こんな感じです。<br><a href="../../../../public/2017/03/index.png"><img src="../../../../public/2017/03/index-1017x1024.png"></a><br> 基本英語なので、ドキュメント生成時点から、日本語にしたい場合は、ソースコードから変更する必要がありそうです。</p>]]></content>
      
      
      <categories>
          
          <category> remote-procedure-call </category>
          
          <category> gRPC </category>
          
          <category> Remote Procedure Call </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでRPCを試してみる gRPC編 第1回</title>
      <link href="/2017/03/27/1929/"/>
      <url>/2017/03/27/1929/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="http://wp.me/p7138e-v2">前回</a>は導入手順の紹介しました。<br>C#をサポートしているので、試してみないわけにはいきません。<br>Pythonもサポートしており、簡単にテストできそうです。<br>内容としては、C#(クライアント)-Python(サーバー)とし、クライアントから送信した画像をサーバー側で反転して返すというプログラムになります。<br>今回のソースは下記になります。</p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/gRPC1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/gRPC1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>C#側は前回インストールしましたので省略します。</p><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>Pythonにもインストールしておきます。<br>Pythonインタープリターは、いつも通り<strong>Miniconda</strong>になります。<br>pipでインストールする場合は、pipのバージョンが8以降であることが条件です。<br>バージョンは下記の手順で確認。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Miniconda2</span>&gt;<span class="title">python</span> -<span class="title">m</span> <span class="title">pip</span> --<span class="title">version</span></span></span><br><span class="line"><span class="function"><span class="title">pip</span> 9.0.1 <span class="title">from</span> <span class="title">C</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">python</span> 2.7)</span></span><br></pre></td></tr></table></figure><p><strong>gRPC</strong>をインストールします。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Miniconda2</span>&gt;<span class="title">python</span> -<span class="title">m</span> <span class="title">pip</span> <span class="title">install</span> <span class="title">grpcio</span></span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">grpcio</span></span></span><br><span class="line"><span class="function">  <span class="title">Downloading</span> <span class="title">grpcio</span>-1.2.0-<span class="title">cp27</span>-<span class="title">cp27m</span>-<span class="title">win_amd64.whl</span> (1.1<span class="title">MB</span>)</span></span><br><span class="line"><span class="function">    100% |################################| 1.1<span class="title">MB</span> 846<span class="title">kB</span>/<span class="title">s</span></span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">six</span>&gt;=1.5.2 <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">from</span> <span class="title">grpcio</span>)</span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">protobuf</span>&gt;=3.2.0 (<span class="title">from</span> <span class="title">grpcio</span>)</span></span><br><span class="line"><span class="function">  <span class="title">Downloading</span> <span class="title">protobuf</span>-3.2.0-<span class="title">py2.py3</span>-<span class="title">none</span>-<span class="title">any.whl</span> (360<span class="title">kB</span>)</span></span><br><span class="line"><span class="function">    100% |################################| 368<span class="title">kB</span> 1.8<span class="title">MB</span>/<span class="title">s</span></span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">enum34</span>&gt;=1.0.4 <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">from</span> <span class="title">grpcio</span>)</span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">futures</span>&gt;=2.2.0 (<span class="title">from</span> <span class="title">grpcio</span>)</span></span><br><span class="line"><span class="function">  <span class="title">Downloading</span> <span class="title">futures</span>-3.0.5-<span class="title">py2</span>-<span class="title">none</span>-<span class="title">any.whl</span></span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">setuptools</span> <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span>\<span class="title">setuptools</span>-20.3-<span class="title">py2</span>.7.<span class="title">egg</span> (<span class="title">from</span> <span class="title">protobuf</span>&gt;=3.2.0-&gt;<span class="title">grpcio</span>)</span></span><br><span class="line"><span class="function"><span class="title">Installing</span> <span class="title">collected</span> <span class="title">packages</span>: <span class="title">protobuf</span>, <span class="title">futures</span>, <span class="title">grpcio</span></span></span><br><span class="line"><span class="function">  <span class="title">Found</span> <span class="title">existing</span> <span class="title">installation</span>: <span class="title">protobuf</span> 2.6.1</span></span><br><span class="line"><span class="function">    <span class="title">Uninstalling</span> <span class="title">protobuf</span>-2.6.1:</span></span><br><span class="line"><span class="function">      <span class="title">Successfully</span> <span class="title">uninstalled</span> <span class="title">protobuf</span>-2.6.1</span></span><br><span class="line"><span class="function"><span class="title">Successfully</span> <span class="title">installed</span> <span class="title">futures</span>-3.0.5 <span class="title">grpcio</span>-1.2.0 <span class="title">protobuf</span>-3.2.0</span></span><br></pre></td></tr></table></figure><p>続いて、<strong>gRPC tools</strong>をインストールします。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Miniconda2</span>&gt;<span class="title">python</span> -<span class="title">m</span> <span class="title">pip</span> <span class="title">install</span> <span class="title">grpcio</span>-<span class="title">tools</span></span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">grpcio</span>-<span class="title">tools</span></span></span><br><span class="line"><span class="function">  <span class="title">Downloading</span> <span class="title">grpcio_tools</span>-1.2.0-<span class="title">cp27</span>-<span class="title">cp27m</span>-<span class="title">win_amd64.whl</span> (1.5<span class="title">MB</span>)</span></span><br><span class="line"><span class="function">    100% |################################| 1.5<span class="title">MB</span> 687<span class="title">kB</span>/<span class="title">s</span></span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">grpcio</span>&gt;=1.2.0 <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">from</span> <span class="title">grpcio</span>-<span class="title">tools</span>)</span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">protobuf</span>&gt;=3.2.0 <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">from</span> <span class="title">grpcio</span>-<span class="title">tools</span>)</span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">six</span>&gt;=1.5.2 <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">from</span> <span class="title">grpcio</span>&gt;=1.2.0-&gt;<span class="title">grpcio</span>-<span class="title">tools</span>)</span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">enum34</span>&gt;=1.0.4 <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">from</span> <span class="title">grpcio</span>&gt;=1.2.0-&gt;<span class="title">grpcio</span>-<span class="title">tools</span>)</span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">futures</span>&gt;=2.2.0 <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span> (<span class="title">from</span> <span class="title">grpcio</span>&gt;=1.2.0-&gt;<span class="title">grpcio</span>-<span class="title">tools</span>)</span></span><br><span class="line"><span class="function"><span class="title">Requirement</span> <span class="title">already</span> <span class="title">satisfied</span>: <span class="title">setuptools</span> <span class="title">in</span> <span class="title">c</span>:\<span class="title">program</span> <span class="title">files</span>\<span class="title">miniconda2</span>\<span class="title">lib</span>\<span class="title">site</span>-<span class="title">packages</span>\<span class="title">setuptools</span>-20.3-<span class="title">py2</span>.7.<span class="title">egg</span> (<span class="title">from</span> <span class="title">protobuf</span>&gt;=3.2.0-&gt;<span class="title">grpcio</span>-<span class="title">tools</span>)</span></span><br><span class="line"><span class="function"><span class="title">Installing</span> <span class="title">collected</span> <span class="title">packages</span>: <span class="title">grpcio</span>-<span class="title">tools</span></span></span><br><span class="line"><span class="function"><span class="title">Successfully</span> <span class="title">installed</span> <span class="title">grpcio</span>-<span class="title">tools</span>-1.2.0</span></span><br></pre></td></tr></table></figure><p>gRPC toolsは <strong>proto</strong> というファイルから、サーバー、クライアント側のコードを生成するためのジェネレーターになります。</p><h1 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h1><h2 id="gRPC-tools"><a href="#gRPC-tools" class="headerlink" title="gRPC tools"></a>gRPC tools</h2><p>protoファイルを用意して、サーバー、クライアントのコードを生成します。</p><h3 id="imageProc-proto"><a href="#imageProc-proto" class="headerlink" title="imageProc.proto"></a>imageProc.proto</h3><p>サンプルが <a href="https://github.com/grpc/grpc/blob/master/examples/protos/helloworld.proto">github</a> にありますが、面白くないので、手を加えます。</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> imageProc;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">ImageProc</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> Enhancement (EnhancementRequest) <span class="keyword">returns</span> (EnhancementReply) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">EnhancementRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int32</span>  width = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">int32</span>  height = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">int32</span>  channel = <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">bytes</span>  image = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">EnhancementReply</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int32</span>  result = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">int32</span>  width = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">int32</span>  height = <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">int32</span>  channel = <span class="number">4</span>;</span><br><span class="line">  <span class="built_in">bytes</span>  image = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>続いて、imageProc.protoからコードを生成します。<br>gRPC toolsから生成しますが、PythonとC#側でそれぞれ生成する必要があります。<br>また、言語用にそれぞれgRPC toolsがあるので、それぞれ入手します。</p><h3 id="for-Python"><a href="#for-Python" class="headerlink" title="for Python"></a>for Python</h3><p>PythonでのgRPC toolsは下記のように使います。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m grpc\_tools.protoc -I&lt;protoファイルの存在ディレクトリ&gt; --python\_out=&lt;出力先のパス&gt; --grpc\_python\_out=&lt;出力先のパス&gt; &lt;protoファイルのパス&gt; </span><br></pre></td></tr></table></figure><p>今回のソース構成では、gRPC1フォルダにimageProc.protoがありますので、そこをカレントディレクトリにして下記を実行します。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m grpc\_tools.protoc -I. --python\_out=python --grpc\_python\_out=python imageProc.proto </span><br></pre></td></tr></table></figure><p>これにより、<strong>Python\imageProc_pb2.py</strong>と<strong>Python\imageProc_pb2_grpc.py</strong> が生成されます。</p><h3 id="for-C"><a href="#for-C" class="headerlink" title="for C#"></a>for C#</h3><p>C#側は少し面倒です。<br>まず、nugetを入手します。<br>これはVisual Studioから実行できるものではなく、スタンドアロンのコマンドラインツールです。<br><a href="https://dist.nuget.org/index.html">Available NuGet Distribution Versions</a>から、**nuget.exe - recommended latest (v3.5.0)**を選択します。<br>ダウンロードしたnuget.exeを適切な場所に展開し、ソースフォルダのpackagesフォルダをカレントディレクトにして、次のコマンドを入力します。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\<span class="title">Works</span>\<span class="title">Demo</span>\<span class="title">gRPC1</span>\<span class="title">packages</span>&gt;&quot;<span class="title">C</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">NuGet</span>\<span class="title">nuget.exe</span>&quot; <span class="title">install</span> <span class="title">Grpc.Tools</span></span></span><br><span class="line"><span class="function"><span class="title">Feeds</span> <span class="title">used</span>:</span></span><br><span class="line"><span class="function">  <span class="title">https</span>://<span class="title">api.nuget.org</span>/<span class="title">v3</span>/<span class="title">index.json</span></span></span><br><span class="line"><span class="function">  <span class="title">C</span>:\<span class="title">Program</span> <span class="title">Files</span> (<span class="title">x86</span>)\<span class="title">Microsoft</span> <span class="title">SDKs</span>\<span class="title">NuGetPackages</span>\</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">GET</span> <span class="title">https</span>://<span class="title">api.nuget.org</span>/<span class="title">v3</span>/<span class="title">registration1</span>-<span class="title">gz</span>/<span class="title">grpc.tools</span>/<span class="title">index.json</span></span></span><br><span class="line"><span class="function">  <span class="title">OK</span> <span class="title">https</span>://<span class="title">api.nuget.org</span>/<span class="title">v3</span>/<span class="title">registration1</span>-<span class="title">gz</span>/<span class="title">grpc.tools</span>/<span class="title">index.json</span> 672<span class="title">ms</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Attempting</span> <span class="title">to</span> <span class="title">gather</span> <span class="title">dependency</span> <span class="title">information</span> <span class="title">for</span> <span class="title">package</span> &#x27;<span class="title">Grpc.Tools</span>.1.2.0&#x27; <span class="title">with</span></span></span><br><span class="line"><span class="function"><span class="title">respect</span> <span class="title">to</span> <span class="title">project</span> &#x27;<span class="title">D</span>:\<span class="title">Works</span>\<span class="title">Demo</span>\<span class="title">gRPC1</span>\<span class="title">packages</span>&#x27;, <span class="title">targeting</span> &#x27;<span class="title">Any</span>,<span class="title">Version</span>=<span class="title">v0</span>.0&#x27;</span></span><br><span class="line"><span class="function"><span class="title">Gathering</span> <span class="title">dependency</span> <span class="title">information</span> <span class="title">took</span> 15.35 <span class="title">ms</span></span></span><br><span class="line"><span class="function"><span class="title">Attempting</span> <span class="title">to</span> <span class="title">resolve</span> <span class="title">dependencies</span> <span class="title">for</span> <span class="title">package</span> &#x27;<span class="title">Grpc.Tools</span>.1.2.0&#x27; <span class="title">with</span> <span class="title">DependencyBehavior</span> &#x27;<span class="title">Lowest</span>&#x27;</span></span><br><span class="line"><span class="function"><span class="title">Resolving</span> <span class="title">dependency</span> <span class="title">information</span> <span class="title">took</span> 0 <span class="title">ms</span></span></span><br><span class="line"><span class="function"><span class="title">Resolving</span> <span class="title">actions</span> <span class="title">to</span> <span class="title">install</span> <span class="title">package</span> &#x27;<span class="title">Grpc.Tools</span>.1.2.0&#x27;</span></span><br><span class="line"><span class="function"><span class="title">Resolved</span> <span class="title">actions</span> <span class="title">to</span> <span class="title">install</span> <span class="title">package</span> &#x27;<span class="title">Grpc.Tools</span>.1.2.0&#x27;</span></span><br><span class="line"><span class="function"><span class="title">Retrieving</span> <span class="title">package</span> &#x27;<span class="title">Grpc.Tools</span> 1.2.0&#x27; <span class="title">from</span> &#x27;<span class="title">nuget.org</span>&#x27;.</span></span><br><span class="line"><span class="function"><span class="title">Adding</span> <span class="title">package</span> &#x27;<span class="title">Grpc.Tools</span>.1.2.0&#x27; <span class="title">to</span> <span class="title">folder</span> &#x27;<span class="title">D</span>:\<span class="title">Works</span>\<span class="title">Demo</span>\<span class="title">gRPC1</span>\<span class="title">packages</span>&#x27;</span></span><br><span class="line"><span class="function"><span class="title">Added</span> <span class="title">package</span> &#x27;<span class="title">Grpc.Tools</span>.1.2.0&#x27; <span class="title">to</span> <span class="title">folder</span> &#x27;<span class="title">D</span>:\<span class="title">Works</span>\<span class="title">Demo</span>\<span class="title">gRPC1</span>\<span class="title">packages</span>&#x27;</span></span><br><span class="line"><span class="function"><span class="title">Successfully</span> <span class="title">installed</span> &#x27;<span class="title">Grpc.Tools</span> 1.2.0&#x27; <span class="title">to</span> <span class="title">D</span>:\<span class="title">Works</span>\<span class="title">Demo</span>\<span class="title">gRPC1</span>\<span class="title">packages</span></span></span><br><span class="line"><span class="function"><span class="title">Executing</span> <span class="title">nuget</span> <span class="title">actions</span> <span class="title">took</span> 176.33 <span class="title">ms</span> </span></span><br></pre></td></tr></table></figure><p>カレントディレクトリに<strong>Grpc.Tools.1.2.0</strong>が作成されます。<br>続いて、コードを生成します。<br>構文はPythonと似ています。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc.exe -I&lt;protpファイルの存在ディレクトリ&gt; --csharp\_out &lt;出力先のパス&gt; --grpc\_out &lt;出力先のパス&gt; &lt;protoファイルのパス&gt; --plugin=protoc-gen-grpc=&lt;grpc\_csharp\_plugin.exeのパス&gt; </span><br></pre></td></tr></table></figure><p>grpc_csharp_plugin.exeは先ほどのnuget.exeでGrpc.Toolsをインストールした際に、同時にインストールされます。<br>ですので、下記のようにしてimageProc.protoからコードを生成します。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\\<span class="title">Works</span>\\<span class="title">Demo</span>\\<span class="title">gRPC1</span>&gt;<span class="title">mkdir</span> <span class="title">gRPC</span>\\<span class="title">Contracts</span> <span class="title">D</span>:\\<span class="title">Works</span>\\<span class="title">Demo</span>\\<span class="title">gRPC1</span>&gt;<span class="title">packages</span>\\<span class="title">Grpc.Tools</span>.1.2.0\\<span class="title">tools</span>\\<span class="title">windows</span>\<span class="title">_x86</span>\\<span class="title">protoc.exe</span> -<span class="title">I</span>. --<span class="title">csharp</span>\<span class="title">_out</span> <span class="title">gRPC</span>\\<span class="title">Contracts</span> --<span class="title">grpc</span>\<span class="title">_out</span> <span class="title">gRPC</span>\\<span class="title">Contracts</span> <span class="title">imageProc.proto</span> --<span class="title">plugin</span>=<span class="title">protoc</span>-<span class="title">gen</span>-<span class="title">grpc</span>=<span class="title">packages</span>\\<span class="title">Grpc.Tools</span>.1.2.0\\<span class="title">tools</span>\\<span class="title">windows</span>\<span class="title">_x86</span>\\<span class="title">grpc</span>\<span class="title">_csharp</span>\<span class="title">_plugin.exe</span> </span></span><br></pre></td></tr></table></figure><p>これにより、<strong>gRPC\Contracts\ImageProc.cs</strong>と<strong>gRPC\Contracts\ImageProcGrpc.cs</strong> が生成されます。</p><h2 id="Python-1"><a href="#Python-1" class="headerlink" title="Python"></a>Python</h2><p>コードの生成が完了したので、Python側でgRPCを利用するコードを記述していきます。</p><h3 id="imageProc-server-py"><a href="#imageProc-server-py" class="headerlink" title="imageProc_server.py"></a>imageProc_server.py</h3><p><strong>xxx_pb2_grpc.py</strong> というファイルにて、クライアント、サービスの基底クラスが定義されていますので、これらから派生したクラスを実装していきます。<br>Python側がサーバーになるので、<strong>ImageProcServicer</strong>から派生します。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> PIL.ImageOps</span><br><span class="line"><span class="keyword">import</span> imageProc_pb2</span><br><span class="line"><span class="keyword">import</span> imageProc_pb2_grpc</span><br><span class="line"></span><br><span class="line">_ONE_DAY_IN_SECONDS = <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageProc</span>(<span class="params">imageProc_pb2_grpc.ImageProcServicer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Enhancement</span>(<span class="params">self, request, context</span>):</span></span><br><span class="line">        reply = imageProc_pb2.EnhancementReply()</span><br><span class="line">        reply.width = request.width</span><br><span class="line">        reply.height = request.height</span><br><span class="line">        reply.channel = request.channel</span><br><span class="line"></span><br><span class="line">        imageSize = request.width, request.height</span><br><span class="line">        <span class="comment"># 1 (1-bit pixels, black and white, stored with one pixel per byte)</span></span><br><span class="line">        <span class="comment"># L (8-bit pixels, black and white)</span></span><br><span class="line">        <span class="comment"># P (8-bit pixels, mapped to any other mode using a colour palette)</span></span><br><span class="line">        <span class="comment"># RGB (3x8-bit pixels, true colour)</span></span><br><span class="line">        <span class="comment"># RGBA (4x8-bit pixels, true colour with transparency mask)</span></span><br><span class="line">        <span class="comment"># CMYK (4x8-bit pixels, colour separation)</span></span><br><span class="line">        <span class="comment"># YCbCr (3x8-bit pixels, colour video format)</span></span><br><span class="line">        <span class="comment"># I (32-bit signed integer pixels)</span></span><br><span class="line">        <span class="comment"># F (32-bit floating point pixels)</span></span><br><span class="line">        channel = request.channel</span><br><span class="line">        <span class="keyword">if</span> channel == <span class="number">4</span>:</span><br><span class="line">            print(<span class="string">&#x27;channel is 4&#x27;</span>)</span><br><span class="line">            <span class="comment"># PIL.ImageOps.invert does NOT support RGBA</span></span><br><span class="line">            tmp = Image.frombytes(<span class="string">&#x27;RGBA&#x27;</span>,  imageSize, request.image)</span><br><span class="line">            r, g, b, a = tmp.split()</span><br><span class="line">            rgb = Image.merge(<span class="string">&quot;RGB&quot;</span>, (b, g, r))</span><br><span class="line">            inverted = PIL.ImageOps.invert(rgb)</span><br><span class="line">            r, g, b = inverted.split()</span><br><span class="line">            reply.image = Image.merge(<span class="string">&quot;RGBA&quot;</span>, (r, g, b, a)).tobytes()</span><br><span class="line">        <span class="keyword">elif</span> channel == <span class="number">3</span>:</span><br><span class="line">            print(<span class="string">&#x27;channel is 3&#x27;</span>)</span><br><span class="line">            reply.image = PIL.ImageOps.invert(Image.frombytes(<span class="string">&#x27;RGB&#x27;</span>, imageSize, request.image)).tobytes()</span><br><span class="line">        <span class="keyword">elif</span> channel == <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">&#x27;channel is 1&#x27;</span>)</span><br><span class="line">            reply.image = PIL.ImageOps.invert(Image.frombytes(<span class="string">&#x27;1&#x27;</span>, imageSize, request.image)).tobytes()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;channel is unknown&#x27;</span>)</span><br><span class="line">            reply.image = PIL.ImageOps.invert(Image.frombytes(<span class="string">&#x27;L&#x27;</span>, imageSize, request.image)).tobytes()</span><br><span class="line"></span><br><span class="line">        reply.result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> reply</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serve</span>():</span></span><br><span class="line">    server = grpc.server(futures.ThreadPoolExecutor(max_workers=<span class="number">10</span>))</span><br><span class="line">    imageProc_pb2_grpc.add_ImageProcServicer_to_server(ImageProc(), server)</span><br><span class="line">    server.add_insecure_port(<span class="string">&#x27;[::]:50051&#x27;</span>)</span><br><span class="line">    server.start()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            time.sleep(_ONE_DAY_IN_SECONDS)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        server.stop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  serve()</span><br></pre></td></tr></table></figure><p><strong>ImageProc</strong>は自動生成された<strong>ImageProcServicer</strong>から派生して適宜実装します。<br>今回は、入力されたバイナリデータを反転する処理を書いています。<br>main関数はserve関数を呼び出しています。<br>serve関数は、<a href="https://github.com/grpc/grpc/blob/master/examples/python/helloworld/greeter_server.py">https://github.com/grpc/grpc/blob/master/examples/python/helloworld/greeter_server.py</a>を参考に記述しますので簡単です。</p><h2 id="C"><a href="#C" class="headerlink" title="C#"></a>C#</h2><p>MVVMで実装します。<br>画像ファイルを読み込むボタン、読み込んだ画像を表示するパネル、サーバーと通信するための送信ボタン、サーバーからの結果を表示するためのパネルを備えています。<br>また、実装を開始する前に、nugetで<strong>Google.Protobuf</strong>をインストールします。</p><h3 id="MainViewModel-cs"><a href="#MainViewModel-cs" class="headerlink" title="MainViewModel.cs"></a>MainViewModel.cs</h3><p>まずは、interfaceです。<br>Xaml上のButtonに対応するCommandと、Imgaeに対応するImageSourceを備えているだけです。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Windows.Media;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight.Command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Grpc1.ViewModels.Interfaces</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IMainViewModel</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Properties</span></span><br><span class="line"></span><br><span class="line">        RelayCommand OpenFileCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ImageSource ResultImage</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        RelayCommand ServerRequestCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ImageSource SourceImage</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="IMainViewModel-cs"><a href="#IMainViewModel-cs" class="headerlink" title="IMainViewModel.cs"></a>IMainViewModel.cs</h3><p><strong>IMainViewModel</strong>を継承しています。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Media;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Media.Imaging;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight.Command;</span><br><span class="line"><span class="keyword">using</span> Google.Protobuf;</span><br><span class="line"><span class="keyword">using</span> Grpc1.ViewModels.Interfaces;</span><br><span class="line"><span class="keyword">using</span> ImageProc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.WindowsAPICodePack.Dialogs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Grpc1.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">MainViewModel</span> : <span class="title">ViewModelBase</span>, <span class="title">IMainViewModel</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Properties</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RelayCommand _OpenFileCommand;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> RelayCommand OpenFileCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._OpenFileCommand ?? (<span class="keyword">this</span>._OpenFileCommand = <span class="keyword">new</span> RelayCommand(() =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">using</span> (<span class="keyword">var</span> dlg = <span class="keyword">new</span> CommonOpenFileDialog())</span><br><span class="line">                    &#123;</span><br><span class="line">                        dlg.IsFolderPicker = <span class="literal">false</span>;</span><br><span class="line">                        dlg.AddToMostRecentlyUsedList = <span class="literal">false</span>;</span><br><span class="line">                        dlg.AllowNonFileSystemItems = <span class="literal">false</span>;</span><br><span class="line">                        dlg.EnsureFileExists = <span class="literal">true</span>;</span><br><span class="line">                        dlg.EnsurePathExists = <span class="literal">true</span>;</span><br><span class="line">                        dlg.EnsureReadOnly = <span class="literal">false</span>;</span><br><span class="line">                        dlg.EnsureValidNames = <span class="literal">true</span>;</span><br><span class="line">                        dlg.Multiselect = <span class="literal">false</span>;</span><br><span class="line">                        dlg.ShowPlacesList = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">var</span> dialogResult = dlg.ShowDialog();</span><br><span class="line">                        <span class="keyword">if</span> (dialogResult != CommonFileDialogResult.Ok)</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">var</span> bitmap = <span class="keyword">new</span> BitmapImage();</span><br><span class="line">                        <span class="keyword">try</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            bitmap.BeginInit();</span><br><span class="line">                            bitmap.UriSource = <span class="keyword">new</span> Uri(dlg.FileName);</span><br><span class="line">                            bitmap.EndInit();</span><br><span class="line">                            <span class="keyword">this</span>.SourceImage = bitmap;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">                        &#123;</span><br><span class="line">                            MessageBox.Show(ex.Message);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">this</span>._ServerRequestCommand?.RaiseCanExecuteChanged();</span><br><span class="line">                &#125;, () =&gt; <span class="literal">true</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> ImageSource _ResultImage;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ImageSource ResultImage</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._ResultImage;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>._ResultImage = <span class="keyword">value</span>;</span><br><span class="line">                <span class="keyword">this</span>.RaisePropertyChanged();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RelayCommand _ServerRequestCommand;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> RelayCommand ServerRequestCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._ServerRequestCommand ?? (<span class="keyword">this</span>._ServerRequestCommand = <span class="keyword">new</span> RelayCommand(<span class="keyword">async</span> () =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> bitmap = <span class="keyword">this</span>._SourceImage <span class="keyword">as</span> BitmapImage;</span><br><span class="line">                    <span class="keyword">if</span> (bitmap == <span class="literal">null</span>)</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> width = bitmap.PixelWidth;</span><br><span class="line">                    <span class="keyword">var</span> height = bitmap.PixelHeight;</span><br><span class="line">                    <span class="keyword">var</span> stride = (width * bitmap.Format.BitsPerPixel + <span class="number">7</span>) / <span class="number">8</span>;</span><br><span class="line">                    <span class="keyword">var</span> bitsPerPixel = bitmap.Format.BitsPerPixel;</span><br><span class="line">                    <span class="keyword">var</span> bytesPerPixel = bitsPerPixel / <span class="number">8</span>;</span><br><span class="line">                    <span class="keyword">var</span> originalPixels = <span class="keyword">new</span> <span class="keyword">byte</span>[width * height * bytesPerPixel];</span><br><span class="line">                    bitmap.CopyPixels(originalPixels, stride, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">var</span> channel = <span class="keyword">new</span> Grpc.Core.Channel(<span class="string">&quot;127.0.0.1:50051&quot;</span>, Grpc.Core.ChannelCredentials.Insecure);</span><br><span class="line">                        <span class="keyword">var</span> client = <span class="keyword">new</span> ImageProc.ImageProc.ImageProcClient(channel);</span><br><span class="line">                        <span class="keyword">var</span> reply = <span class="keyword">await</span> client.EnhancementAsync(<span class="keyword">new</span> EnhancementRequest</span><br><span class="line">                        &#123;</span><br><span class="line">                            Height = height,</span><br><span class="line">                            Width = width,</span><br><span class="line">                            Channel = bytesPerPixel,</span><br><span class="line">                            Image = ByteString.CopyFrom(originalPixels)</span><br><span class="line">                        &#125;);</span><br><span class="line">                        channel.ShutdownAsync().Wait();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">var</span> resultPixels = reply.Image.ToByteArray();</span><br><span class="line">                        <span class="keyword">if</span> (resultPixels != <span class="literal">null</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">var</span> bmpSource = BitmapSource.Create(</span><br><span class="line">                                width,</span><br><span class="line">                                height,</span><br><span class="line">                                bitmap.DpiX,</span><br><span class="line">                                bitmap.DpiY,</span><br><span class="line">                                bitmap.Format,</span><br><span class="line">                                <span class="literal">null</span>,</span><br><span class="line">                                resultPixels,</span><br><span class="line">                                stride);</span><br><span class="line">                            <span class="keyword">if</span> (bmpSource.CanFreeze)</span><br><span class="line">                                bmpSource.Freeze();</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">this</span>.ResultImage = bmpSource;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span></span><br><span class="line">                    &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, () =&gt; <span class="keyword">this</span>._SourceImage != <span class="literal">null</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> ImageSource _SourceImage;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ImageSource SourceImage</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._SourceImage;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>._SourceImage = <span class="keyword">value</span>;</span><br><span class="line">                <span class="keyword">this</span>.RaisePropertyChanged();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>OpenFileCommand</strong>は、画像ファイルを<strong>System.Windows.Media.Imaging.BitmapImage</strong>に変換して、<strong>SourceImage</strong>に設定するだけです。<br>注目は、<strong>ServerRequestCommand</strong>の下記の部分です。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Grpc.Core.Channel(<span class="string">&quot;127.0.0.1:50051&quot;</span>, Grpc.Core.ChannelCredentials.Insecure);</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> ImageProc.ImageProc.ImageProcClient(channel);</span><br><span class="line"><span class="keyword">var</span> reply = <span class="keyword">await</span> client.EnhancementAsync(<span class="keyword">new</span> EnhancementRequest</span><br><span class="line">&#123;</span><br><span class="line">    Height = height,</span><br><span class="line">    Width = width,</span><br><span class="line">    Channel = bytesPerPixel,</span><br><span class="line">    Image = ByteString.CopyFrom(originalPixels)</span><br><span class="line">&#125;);</span><br><span class="line">channel.ShutdownAsync().Wait();</span><br></pre></td></tr></table></figure><p>ローカル(127.0.0.1)のポート50051に対して、gRPCで通信を確立し、APIを呼び出しています。<br><strong>ImageProc.ImageProc.ImageProcClient</strong>は、gRPC toolsで自動生成しているものです。<br>通信に関係するコードはすべて自動で生成されるので、クライアント側は、ちょっとした呼び出しのコードを記述するだけで、簡単にサーバー側のAPIを呼び出せるわけです。</p><h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>サーバー側とクライアント側をテストしてみます。<br>サーバー側(<strong>imageProc_server.py</strong>)を起動し、任意の画像ファイルを読み込み、サーバー側APIを呼び出すと、反転した画像が返ってきます。</p><p><a href="../../../../public/2017/03/test-2.gif"><img src="../../../../public/2017/03/test-2-1024x417.gif"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>通信周りはすべて自動生成に任せ、ビジネスロジックの実装に注力できるのは、本当に楽です。<br>今時、ソケットだのコールバックだの考えるのは本当に面倒です。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/gRPC1">https://github.com/takuya-takeuchi/Demo/tree/master/gRPC1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> remote-procedure-call </category>
          
          <category> gRPC </category>
          
          <category> .NETでRPCを試してみる </category>
          
          <category> Remote Procedure Call </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでRPCを試してみる gRPC編 第0回</title>
      <link href="/2017/03/26/1924/"/>
      <url>/2017/03/26/1924/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>RESTを使って、簡単なクラサバアプリを構築したのですが、</p><ul><li>バイナリの転送が重い<ul><li>jsonまたはxmlで返すから、BASE64で通信量が増える</li></ul></li></ul><p>というのが、制約になって食指が動きません。 そんな中、<strong>gRPC</strong> なるGoogleが作った<strong>HTTP/2</strong>を標準でサポートした新しいRPC (Remote Procedure Call ) フレームワークを見つけました。 2015年2月に発表されたらしいので、今さら感が漂いますが… </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.grpc.io/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.grpc.io"></img><div class="hbc-site-name">gRPC</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://grpc.io/img/logos/grpc-icon-color.png"></img></div><div class="hbc-text"><div class="hbc-title">gRPC</div><div class="hbc-url">http://www.grpc.io/</div><div class="hbc-description">A high-performance, open source universal RPC framework</div></div></div></div></a></div></div><p><strong>HTTP/2</strong>を基礎としており、<strong>Protocol Buffers</strong>を使ってサービスを定義するので高速な通信が可能、と最新技術を使っているのも、カッコいい。 素晴らしいのは、言語サポートが広く、<a href="http://www.grpc.io/">公式ページ</a>によれば、</p><ul><li>C++</li><li>Java</li><li>Python</li><li>Go</li><li>Ruby</li><li>Node.js</li><li>C#</li><li>Objective-C</li><li>Android</li><li>Java</li><li>PHP</li></ul><p>をサポートしています。 C#をサポートしているので、試してみないわけにはいきません。 Pythonもサポートしており、簡単にテストできそうです。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>自分でビルドするか、nugetでインストールもできます。 お手軽に nuget でインストールします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.nuget.org/packages/Grpc/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.nuget.org"></img><div class="hbc-site-name">www.nuget.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://api.nuget.org/v3-flatcontainer/grpc/2.33.1/icon"></img></div><div class="hbc-text"><div class="hbc-title">Grpc 2.33.1</div><div class="hbc-url">https://www.nuget.org/packages/Grpc/</div><div class="hbc-description">Metapackage for gRPC C#</div></div></div></div></a></div></div><p>簡単ですね。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回は導入のみ。 次回は、C#-Pythonで通信してみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> remote-procedure-call </category>
          
          <category> gRPC </category>
          
          <category> .NETでRPCを試してみる </category>
          
          <category> Remote Procedure Call </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでパケットキャプチャを試してみる SharpPcap編 第1回</title>
      <link href="/2017/03/24/1921/"/>
      <url>/2017/03/24/1921/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-uQ">前回</a>はPcap.Netでキャプチャを実施しました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>今回は<strong>SharpPcap</strong>を使います。ライセンスは<strong>LGPL</strong>です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/chmorgan/sharppcap" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/1211904?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">chmorgan/sharppcap</div><div class="hbc-url">https://github.com/chmorgan/sharppcap</div><div class="hbc-description">Official repository - Fully managed, cross platform (Windows, Mac, Linux) .NET library for capturing packets - chmorgan/sharppcap</div></div></div></div></a></div></div><p>Nugetにパッケージはありますが、またも公式では無い様子。 githubに公式ページがありますが、Nugetについて言及が無いので、野良配布でしょう。 なので、githubのリリースページから最新版を入手します。 2017年3月末時点で4.2.0が最新版です。 Pcap.Netとは異なり、バイナリにx86版とx64版はありません。</p><ul><li>SharpPcap.dll</li><li>PacketDotNet.dll</li></ul><p>なので、前回と違って気にすることは少ないです。 また、SharpPcapは<strong>Packet.Net</strong>というライブラリに依存しています。こちらもLGPLです。 今回のソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.SharpPcap1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.SharpPcap1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h1><p>前回と同じ、Xamlです。 また、前回はinterfaceを駆使しているため、編集するソースは1ファイルだけになります。 実装をinterfaceで分離したかいがありました。 SharpPcapのライブラリは、<strong>sln</strong> ファイルと同じ階層にあるlibフォルダに、下記のように配置してください。</p><ul><li>lib\SharpPcap-4.2.0\Release\SharpPcap.dll</li><li>lib\SharpPcap-4.2.0\Release\PacketDotNet.dll</li></ul><h2 id="PacketCaptureService"><a href="#PacketCaptureService" class="headerlink" title="PacketCaptureService"></a>PacketCaptureService</h2><p>前回のソースを基準にしますので、interfaceは一切変更しません。 Pcap.NetのクラスをSharpPcapのクラスに置換したりするだけです。 修正ファイルは、<strong>PacketCaptureService.cs</strong> のみです。 [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Threading.Tasks; using PacketDotNet; using SharpPcap; using WPF.PacketCapture.Models.Interfaces; using WPF.PacketCapture.Services.Interfaces;<br>namespace WPF.PacketCapture.Services {<br>public sealed class PacketCaptureService : IPacketCaptureService {<br>#region Methods<br>public IEnumerable<IPacketCaptureDeviceModel> GetAllDevices() { return CaptureDeviceList.Instance.Select(device =&gt; new PacketCaptureDeviceModel(device)); }<br>#endregion<br>private sealed class PacketCaptureDeviceModel : IPacketCaptureDeviceModel {<br>#region Events<br>public event EventHandler<IPacketModel> PacketReceived;<br>#endregion<br>#region Fields<br>private readonly ICaptureDevice _Device;<br>private Task _Task;<br>#endregion<br>#region Constructors<br>public PacketCaptureDeviceModel(ICaptureDevice device) { this._Device = device; this._Device.OnPacketArrival += this.OnPacketReceived; }<br>#endregion<br>#region Properties<br>public string Description =&gt; this._Device.Description;<br>public string Name =&gt; this._Device.Name;<br>#endregion<br>#region Methods<br>public void StartCapture() { this._Device.StopCapture();<br>// read timeout var timeout = 1000; this._Device.Open(DeviceMode.Promiscuous, timeout); this._Device.Filter = “ip and tcp and port http”;<br>this._Task?.Dispose(); this._Task = Task.Run(() =&gt; { try { this._Device.StartCapture(); } catch (Exception e) { Console.WriteLine(e); } }); }<br>public void StopCapture() { try { // 停止時に例外を投げるが原因が不明 this._Device.StopCapture(); } catch (Exception e) { Console.WriteLine(e); }<br>this._Task?.Dispose(); }<br>#region Helper Methods<br>private void OnPacketReceived(object sender, CaptureEventArgs captureEventArgs) { this.PacketReceived?.Invoke(this, new PacketModel(captureEventArgs.Packet)); }<br>#endregion<br>#endregion }<br>private sealed class PacketModel : IPacketModel {<br>#region Fields<br>private readonly Packet _Packet;<br>private readonly RawCapture _RawCapture;<br>#endregion<br>#region Constructors<br>public PacketModel(RawCapture rawPacket) { this._RawCapture = rawPacket; this._Packet = Packet.ParsePacket(rawPacket.LinkLayerType, rawPacket.Data); }<br>#endregion<br>#region Properties<br>public string Destination =&gt; (this._Packet.PayloadPacket as IPv4Packet)?.DestinationAddress?.ToString();<br>public int Length =&gt; this._Packet.Bytes.Length;<br>public DateTime Timestamp =&gt; this._RawCapture.Timeval.Date;<br>public string Source =&gt; (this._Packet.PayloadPacket as IPv4Packet)?.SourceAddress?.ToString();<br>#endregion<br>}<br>}<br>} [/code] Pcap.Netと異なり、DestnationやSourceを取得する際に、型のキャストが必要になるのが面倒かな。 パケットはデータリンク層かもしれないので、アドレスがない可能性があるのはわかりますが。 フィルタの構文はPcap.Netと同じです。 これは、WinPcapを使っているためです。</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>実際に実行してみます。 お好きなキャプチャデバイスを選択してStart Captureを押下することでキャプチャが実行されます。 HTTPのみ許容しているので、Webブラウザでどこかにアクセスしてみてください。 前回と全く同じです。<br><a href="../../../../public/2017/03/test-1.gif"><img src="../../../../public/2017/03/test-1.gif"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回も簡単にキャプチャできました。 基本的にWinPcapのラッパーなので、似た使い方になるので、移植も簡単でしたね。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.SharpPcap1">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.SharpPcap1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Windows Presentation Foundation </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでパケットキャプチャを試してみる </category>
          
          <category> %e3%83%91%e3%82%b1%e3%83%83%e3%83%88%e3%82%ad%e3%83%a3%e3%83%97%e3%83%81%e3%83%a3 </category>
          
          <category> SharpPcap </category>
          
          <category> WinPcap </category>
          
          <category> パケットキャプチャ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでパケットキャプチャを試してみる Pcap.Net編 第1回</title>
      <link href="/2017/03/23/1912/"/>
      <url>/2017/03/23/1912/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ux">前回</a>は下準備でした。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>まずは、Pcap.Netを入手します。 Nugetにパッケージはありますが、公式では無い様子。 githubに公式ページがありますが、そこでNugetについて言及が無いので、野良配布でしょう。 なので、githubのリリースページから最新版を入手します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/PcapDotNet/Pcap.Net" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/11466079?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">PcapDotNet/Pcap.Net</div><div class="hbc-url">https://github.com/PcapDotNet/Pcap.Net</div><div class="hbc-description">.NET wrapper for WinPcap written in C++/CLI and C#, which features almost all WinPcap features and includes a packet interpretation framewor…</div></div></div></div></a></div></div><p>注意して欲しいのは、解凍後の中身にx86版とx64版が存在することです。 正確には、</p><ul><li>PcapDotNet.Core.dll</li><li>PcapDotNet.Core.Extensions.dll</li></ul><p>の2つが、x86またはx64でビルドされており、残りはAnyでビルドされています。 つまり、配布時には、これらを切り替えて実行フォルダに配置しないと <strong>System.BadImageFormatException</strong> で落ちます。 そのため、ソリューションの構成にAnyは含みませんが、参照dllはやむなくx64のPcap.Netを参照しています。 実行時にdllを適切に配置すれば良いのですが、若干気持ち悪いかな… ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Pcap.Net1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Pcap.Net1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h1><p>いつも通り、簡単にMVVMを使用して簡単なプロジェクトを作成します。 ネットワークアダプタを選択するリストボックス、選択したリストボックスに流れるHTTPトラフィックを表示するグリッドマップ、キャプチャの開始ボタンを備えています。 Xaml側は省略します。 Pcap.Netのライブラリは、<strong>sln</strong> ファイルと同じ階層にあるlibフォルダに、下記のように配置してください。</p><ul><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Base.dll</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Base.pdb</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Base.xml</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Core.dll</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Core.Extensions.dll</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Core.Extensions.pdb</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Core.Extensions.XML</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Core.pdb</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Core.xml</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Packets.dll</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Packets.pdb</li><li>\lib\PcapDotNet\PcapDotNet.Binaries.1.0.4.x64\PcapDotNet.Packets.xml</li></ul><h2 id="IPacketCaptureService"><a href="#IPacketCaptureService" class="headerlink" title="IPacketCaptureService"></a>IPacketCaptureService</h2><p>まず、DI(依存性注入)のため、パケットキャプチャを担当するinterfaceを定義します。 Pcap.Netとの依存性を極力減らすために、入出力の型もinterfaceに限定しています。 つまり、interface実装側で具象クラスを生成しますが、サービスの利用側は実際の型を意識しなくて済むので、依存性を断ち切れます。 [code lang=”csharp”] using System.Collections.Generic; using WPF.PcapNet.Models.Interfaces;<br>namespace WPF.PcapNet.Services.Interfaces {<br>public interface IPacketCaptureService {<br>IEnumerable<IPacketCaptureDeviceModel> GetAllDevices();<br>}<br>} [/code]</p><h2 id="IPacketCaptureDeviceModel"><a href="#IPacketCaptureDeviceModel" class="headerlink" title="IPacketCaptureDeviceModel"></a>IPacketCaptureDeviceModel</h2><p><strong>IPacketCaptureService.GetAllDevices</strong> の戻りの要素である、ネットワークキャプチャデバイスを表現します。 このinterfaceからパケットのキャプチャの開始、停止を指示します。 [code lang=”csharp”] using System;<br>namespace WPF.PcapNet.Models.Interfaces {<br>public interface IPacketCaptureDeviceModel {<br>#region Events<br>event EventHandler<IPacketModel> PacketReceived;<br>#endregion<br>#region Properties<br>string Description { get; }<br>string Name { get; }<br>#endregion<br>#region Methods<br>void StartCapture();<br>void StopCapture();<br>#endregion<br>}<br>} [/code]</p><h2 id="IPacketModel"><a href="#IPacketModel" class="headerlink" title="IPacketModel"></a>IPacketModel</h2><p>パケットデータを表現します。 今回は、送信元アドレス、送信先アドレス、パケット長、送受信日時のみ用意します。 [code lang=”csharp”] using System;<br>namespace WPF.PcapNet.Models.Interfaces {<br>public interface IPacketModel {<br>#region Properties<br>string Destination { get; }<br>int Length { get; }<br>DateTime Timestamp { get; }<br>string Source { get; }<br>#endregion<br>}<br>} [/code]</p><h1 id="PacketCaptureService"><a href="#PacketCaptureService" class="headerlink" title="PacketCaptureService"></a>PacketCaptureService</h1><p>今回の肝です。 型をネストしているのは、型の情報を外部が知る必要は無いですし、無関係のクラスが型を使用しないようにすることを意識させやすくするためです。 まぁprivateだからアクセスできませんが。 必要な情報は、interfaceを経由し、Pcap.Netの具体的なデータにアクセスします。 [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Threading.Tasks; using PcapDotNet.Core; using PcapDotNet.Packets; using WPF.PcapNet.Models.Interfaces; using WPF.PcapNet.Services.Interfaces;<br>namespace WPF.PcapNet.Services {<br>public sealed class PacketCaptureService : IPacketCaptureService {<br>#region Methods<br>public IEnumerable<IPacketCaptureDeviceModel> GetAllDevices() { return LivePacketDevice.AllLocalMachine.Select(device =&gt; new PacketCaptureDeviceModel(device)); }<br>#endregion<br>private sealed class PacketCaptureDeviceModel : IPacketCaptureDeviceModel {<br>#region Events<br>public event EventHandler<IPacketModel> PacketReceived;<br>#endregion<br>#region Fields<br>private readonly LivePacketDevice _Device;<br>private BerkeleyPacketFilter _Filter;<br>private PacketCommunicator _PacketCommunicator;<br>private Task _Task;<br>#endregion<br>#region Constructors<br>public PacketCaptureDeviceModel(LivePacketDevice device) { this._Device = device; }<br>#endregion<br>#region Properties<br>public string Description =&gt; this._Device.Description;<br>public string Name =&gt; this._Device.Name;<br>#endregion<br>#region Methods<br>public void StartCapture() { // portion of the packet to capture // 65536 guarantees that the whole packet will be captured on all the link layers var snapshotLength = 65536;<br>// promiscuous mode var packetDeviceOpenAttributes = PacketDeviceOpenAttributes.Promiscuous;<br>// read timeout var timeout = 1000;<br>this._PacketCommunicator?.Break(); this._PacketCommunicator?.Dispose(); this._PacketCommunicator = this._Device.Open(snapshotLength, packetDeviceOpenAttributes, timeout);<br>this._Filter?.Dispose();<br>this._Filter = this._PacketCommunicator.CreateFilter(“ip and tcp and port http”); this._PacketCommunicator.SetFilter(this._Filter);<br>this._Task?.Dispose(); this._Task = Task.Run(() =&gt; { try { // 停止時に例外を投げるが、原因不明 this._PacketCommunicator.ReceivePackets(0, this.OnPacketReceived); } catch (Exception e) { Console.WriteLine(e); } }); }<br>public void StopCapture() { this._PacketCommunicator?.Break(); this._PacketCommunicator?.Dispose(); this._Filter?.Dispose();<br>this._PacketCommunicator = null; this._Filter = null; }<br>#region Helper Methods<br>private void OnPacketReceived(Packet packet) { this.PacketReceived?.Invoke(this, new PacketModel(packet)); }<br>#endregion<br>#endregion }<br>private sealed class PacketModel : IPacketModel {<br>#region Fields<br>private readonly Packet _Packet;<br>#endregion<br>#region Constructors<br>public PacketModel(Packet packet) { this._Packet = packet; }<br>#endregion<br>#region Properties<br>public string Destination =&gt; this._Packet.IpV4.Destination.ToString();<br>public int Length =&gt; this._Packet.Length;<br>public DateTime Timestamp =&gt; this._Packet.Timestamp;<br>public string Source =&gt; this._Packet.IpV4.Source.ToString();<br>#endregion<br>}<br>}<br>} [/code] <strong>StartCapture</strong> が重要です。 <strong>LivePacketDevice.Open</strong>でパケットのキャプチャを開始するオブジェクトを取得します。 その後、フィルターを設定し、IPかつTCPかつHTTP以外を弾きます。 最後に、<strong>PacketCommunicator.ReceivePackets</strong> で、コールバック関数を指定してキャプチャを開始します。 注意してほしいのは、このメソッドはスレッドをブロックします。 よって、Taskによる非同期実行しています。 本当は、StartCaptureをasyncすれば良かったのですが、これで動くので良いです。 停止は、<strong>PacketCommunicator.Break</strong> を呼びます。 ただし、Task内で、<strong>InvalidOpeationException</strong>を投げる原因がわかりませんので、try-catchで囲っています。 キャプチャ中に停止しているのが不味いのだと思いますが…</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>実際に実行してみます。 お好きなキャプチャデバイスを選択してStart Captureを押下することでキャプチャが実行されます。 HTTPのみ許容しているので、Webブラウザでどこかにアクセスしてみてください。<br><a href="../../../../public/2017/03/test.gif"><img src="../../../../public/2017/03/test-300x215.gif"></a><br> ちょっとマウスカーソルが途中でどこか行ったのは、Webブラウザを操作しに行ったからです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>簡単にキャプチャできました。 フィルタ条件が若干覚えないといけないですが、このあたりを自分が理解できやすいUIにすることで、グッと使いやすくなると思います。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Pcap.Net1">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Pcap.Net1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Windows Presentation Foundation </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでパケットキャプチャを試してみる </category>
          
          <category> %e3%83%91%e3%82%b1%e3%83%83%e3%83%88%e3%82%ad%e3%83%a3%e3%83%97%e3%83%81%e3%83%a3 </category>
          
          <category> Pcap.net </category>
          
          <category> WinPcap </category>
          
          <category> パケットキャプチャ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでパケットキャプチャを試してみる 第0回</title>
      <link href="/2017/03/22/1893/"/>
      <url>/2017/03/22/1893/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>キャプチャアプリケーションと銘打って、画像、動画、音声をキャプチャして、色々なフィルタを適用するアプリを個人的に作っています。 現在、テキストデータを連続するフィルタに通して加工する仕組みを考えています。 それと同時に、ネットワークを流れるパケットもキャプチャできたら面白いなぁ、って思っています。 パケットキャプチャを使う機会はそう多くは無いのですが、どれも重たいし、複雑すぎる印象があります。 代表的なのは</p><ul><li>Wireshark</li><li>Fiddler</li><li>Microsoft Message Analyzer (旧Microsoft Network Monitor)</li></ul><p>です。 そんなパケットキャプチャを.NETで使ってみようという趣旨です。 パケットキャプチャは大抵 <strong>WinPcap.dll</strong> というパケットキャプチャライブラリを使っています。 WinPcap.dllはLinuxの <strong>libpcap</strong> をWindowsに移植したものです。 WinPcap.dllは高水準APIであり、低水準APIである <strong>Packet.dll</strong> を使っています。 さらに、Packet.dllは <strong>Npf.sys</strong> というフィルタドライバを使います。Npfはきっと <strong>Network Packet Filter</strong> の略でしょう。 で、当然これらは <strong>C/C++</strong> で記述されたネイティブライブラリなので、.NETから呼ぶのは、P/Invokeを定義し、使いやすいようにラップする必要があります。 幸い、.NETのラッパーが存在しています。</p><ul><li>SharpPcap</li><li>Pcap.net</li></ul><p>がある模様。 <a href="http://stackoverflow.com/questions/6650754/pcap-net-vs-sharppcap" title="Pcap.net vs Sharppcap">Pcap.net vs Sharppcap</a>にて、この2つのどちらがよいか、という質問がありました。 Acceptedにはなっていないコメントですが、Pcap.netはC++/CLIが使われていて、パフォーマンスも考慮されているし、機能的にも優れている、とありました。 なので、次回からPcap.netを使います。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>先ほど話したとおり、パケットキャプチャはWinPcapを使っています。Microsoftのパケットキャプチャはそんなの使っていないでしょうが。 まずはWinPcapをインストールします。 なお、Windows 10と互換性のある <a href="http://www.win10pcap.org/ja/download/" title="Win10Pcap">Win10Pcap</a> もありますが、今回は割愛。 なぜなら、Win10Pcapは <strong>GNUライセンス</strong> だから… ちなみに、WinPcapは <strong>BSDライセンス</strong> です。</p><h2 id="WinPcapのインストール"><a href="#WinPcapのインストール" class="headerlink" title="WinPcapのインストール"></a>WinPcapのインストール</h2><p><a href="http://www.winpcap.org/" title="WinPcap">公式ページ</a>からダウンロードします。最新版は4.1.3になります。 インストールはexeを実行するだけです。<br><a href="../../../../public/2017/03/4fc6cc22f63a0359c4b9a07bef9a17b2.png"><img src="../../../../public/2017/03/4fc6cc22f63a0359c4b9a07bef9a17b2-300x232.png"></a> <a href="../../../../public/2017/03/80554133c8d1e6856e46168bb311d72e.png"><img src="../../../../public/2017/03/80554133c8d1e6856e46168bb311d72e-300x232.png"></a> Windows起動時にWinPcapを起動するかというチェックですが、そのままにしておきます。 <a href="../../../../public/2017/03/8bf828acc64c1d794783a9db3ef152f6.png"><img src="../../../../public/2017/03/8bf828acc64c1d794783a9db3ef152f6-300x232.png"></a> <a href="../../../../public/2017/03/c153d9beaf0c314e8046505603939a2a.png"><img src="../../../../public/2017/03/c153d9beaf0c314e8046505603939a2a-300x232.png"></a> <a href="../../../../public/2017/03/fb1f5e86f9a862d193d9e17ff8e9ca4c.png"><img src="../../../../public/2017/03/fb1f5e86f9a862d193d9e17ff8e9ca4c-300x232.png"></a><br> 以上で完了。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>次回から、実際にPcap.netを使ってパケットキャプチャを実施していきます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでパケットキャプチャを試してみる </category>
          
          <category> %e3%83%91%e3%82%b1%e3%83%83%e3%83%88%e3%82%ad%e3%83%a3%e3%83%97%e3%83%81%e3%83%a3 </category>
          
          <category> Pcap.net </category>
          
          <category> WinPcap </category>
          
          <category> パケットキャプチャ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その34 OxyPlotのグラフ境界線を非表示にする</title>
      <link href="/2017/03/21/1884/"/>
      <url>/2017/03/21/1884/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://www.oxyplot.org/">OxyPlot</a> は、.NETで簡単にグラフを描画できるライブラリです。 ライセンスもMITで非常に使い勝手が良いです。 グラフの描画が簡単なのですが、Xamlとの連携で、「あれ？」と思う箇所がありました。 グラフ表示領域の枠線をXamlから非表示にしようとしたところ、非表示にできなくて困りました。 下記のような感じですね。 [code lang=”xaml”] &lt;oxy:PlotView BorderThickness=”0” /&gt; [/code] これでは消えないので、メモとして残します。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>コードから実行します。 通常、<strong>OxyPlot.Wpf.PlotView.Model プロパティ</strong>に <strong>OxyPlot.PlotModel クラス</strong>をバインディングします。 そのPlotModelで境界線を制御します。 下記のような感じです。 [code lang=”csharp”] var model = new PlotModel { PlotAreaBorderThickness = new OxyThickness(0), }; [/code]</p>]]></content>
      
      
      <categories>
          
          <category> グラフ </category>
          
          <category> OxyPlot </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その33 GitKrakenからPull Requestを投げる</title>
      <link href="/2017/03/20/1869/"/>
      <url>/2017/03/20/1869/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="https://www.gitkraken.com/">GitKraken</a> いいですね。 直感的で美しいGUIで、SourceTreeとちがって、非常にさくさく動きます。 <strong>gitflow</strong> に対応しているのも良いです。 で、GitKrakenからGithubにPull Requestを投げる方法の日本語資料がなかったので、メモしておきます。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>今回は、<a href="https://github.com/shimat/opencvsharp">OpenCVSharp</a>に実際にPull Requestしましたので、その画像で説明します。</p><h2 id="Fork"><a href="#Fork" class="headerlink" title="Fork"></a>Fork</h2><p>Forkします。 ForkはGithubから直接実施します。</p><h2 id="Clone"><a href="#Clone" class="headerlink" title="Clone"></a>Clone</h2><p>ForkしたリポジトリをローカルにCloneし、GitKrakenで開きます。<br><a href="../../../../public/2017/03/8c896128533338806aa30e2cbc25a510.png"><img src="../../../../public/2017/03/8c896128533338806aa30e2cbc25a510-300x181.png"></a> 次に、gitflowの初期化を行います。 これ、いちいち設定画面を開くのが面倒なんですよね。 <a href="../../../../public/2017/03/a332d484c66f703172c6ed73a0342e74.png"><img src="../../../../public/2017/03/a332d484c66f703172c6ed73a0342e74-300x181.png"></a></p><p><a href="../../../../public/2017/03/3c989d5d33328a8b9aabbbabf0173736-1.png"><img src="../../../../public/2017/03/3c989d5d33328a8b9aabbbabf0173736-1-300x181.png"></a></p><h2 id="feature"><a href="#feature" class="headerlink" title="feature"></a>feature</h2><p>トピックブランチ、すなわちgitflowでいうfeatureブランチを作成します。 ここでは、MatDiagFixという名前にしてあります。<br><a href="../../../../public/2017/03/883a708ab987ba7866c961e429a79211.png"><img src="../../../../public/2017/03/883a708ab987ba7866c961e429a79211-300x181.png"></a></p><p><a href="../../../../public/2017/03/7619ea8fa7f90bf656243fc7020abd64.png"><img src="../../../../public/2017/03/7619ea8fa7f90bf656243fc7020abd64-300x181.png"></a></p><h2 id="Commit"><a href="#Commit" class="headerlink" title="Commit"></a>Commit</h2><p>普通に編集してコミットまで実施します。 <strong>まだ、finishはしないでください。</strong></p><h2 id="Push"><a href="#Push" class="headerlink" title="Push"></a>Push</h2><p><strong>Finishはしないでください。</strong> Pull RequestをGitKrakenから投げる場合、リモートにトピックブランチ(この場合、MatDiagFix)をプッシュすると同時にPull Requestを作成する機能があります。<br><a href="../../../../public/2017/03/e69f11d30b7e77d48ac96c861fc7eeba.png"><img src="../../../../public/2017/03/e69f11d30b7e77d48ac96c861fc7eeba-300x182.png"></a></p><p>Push先はそのままでOKなので、Submitを押下します。<br><a href="../../../../public/2017/03/2533ef056aa9138004b306bc6fc38fe5.png"><img src="../../../../public/2017/03/2533ef056aa9138004b306bc6fc38fe5-300x181.png"></a></p><h2 id="Create-Pull-Request"><a href="#Create-Pull-Request" class="headerlink" title="Create Pull Request"></a>Create Pull Request</h2><p>Pushが完了すると、Pull Requestを作成するダイアログが表示されます。 右側の To Repoのコンボボックスで、Fork元、つまり今回はOpenCVSharpのリポジトリを選択します。 ブランチはmasterしかないので、masterを選びます。 Pull Requestのタイトルは、コミットメッセージが既定で挿入されていますので、必要に応じて修正します。 確認が終わったら、Create Pull Requestを押下して完了です。<br><a href="../../../../public/2017/03/23217d628d93aaa339a299511c114b8f.png"><img src="../../../../public/2017/03/23217d628d93aaa339a299511c114b8f-300x181.png"></a></p><h2 id="Githubでは"><a href="#Githubでは" class="headerlink" title="Githubでは?"></a>Githubでは?</h2><p>GithubでPull Requestを確認してみます。 Fork元のPull Requestsを見てみると、<a href="https://github.com/shimat/opencvsharp/pull/330">#329: Mat.Diag(Mat) does not reutrn a square diagonal matrix</a> がきちんと追加されていることがわかります。</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> GitKraken </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>雑記 「書き込み」ボタンを消す</title>
      <link href="/2017/03/14/1864/"/>
      <url>/2017/03/14/1864/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="../../../../public/2017/03/334e27d4e5abd45f78c6b34784448599.png"><img src="../../../../public/2017/03/334e27d4e5abd45f78c6b34784448599-300x222.png"></a><br> これが邪魔です。 </p><h1 id="Get-out-here"><a href="#Get-out-here" class="headerlink" title="Get out here!!"></a>Get out here!!</h1><p>レジストリエディタを開き、以下のキーを開きます。 <strong>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer</strong> 続いて、<strong>NoCDBurning</strong>をいうキーを<strong>DWORD (32ビット) 値</strong>で作成し、値を <strong>1</strong> にします。 そして、再起動またはログオフすれば消えます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> 雑記 </category>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WordPressの高速化</title>
      <link href="/2017/03/12/1854/"/>
      <url>/2017/03/12/1854/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>このサイトのレスポンスが悪くなってきたので、サーバーの移転とかを検討しています。 しかしその前に、設定の見直しなどで高速化できないか、と調べてみました。</p><h1 id="Google-PageSpeed-Insights"><a href="#Google-PageSpeed-Insights" class="headerlink" title="Google PageSpeed Insights"></a>Google PageSpeed Insights</h1><p><a href="https://developers.google.com/speed/pagespeed/insights/">Google PageSpeed Insights</a> は、携帯端末やデスクトップ端末向けのページのパフォーマンスを測定します。 計測後、点数(100点満点)で評価付けを行い、パフォーマンスの改善施策を提案してくれます。 下記は、このサイトを計測してみた結果になります。<br><a href="../../../../public/2017/03/screencapture-developers-google-speed-pagespeed-insights-1489314827990.png"><img src="../../../../public/2017/03/screencapture-developers-google-speed-pagespeed-insights-1489314827990-282x300.png"></a> スコアが<strong>59/100</strong>とあまり芳しくないご様子。 修正として <strong>gzip や deflate を使用してリソースを圧縮することで、ネットワークで送信されるバイト数を減らすことができます。</strong> という提案があります。 この修正案を全部適用すれば、<strong>転送サイズを 509 KB (71%)<br> 削減できます。</strong> とあります。これは大きい。 ですので、リソースの圧縮を適用することにします。</p><h2 id="圧縮を有効"><a href="#圧縮を有効" class="headerlink" title="圧縮を有効"></a>圧縮を有効</h2><p><a href="http://webkaru.net/wordpress/">WordPressの使い方と設定</a> というサイト様で、<a href="http://webkaru.net/wordpress/pagespeed-insights-deflate/">圧縮を有効にする - PageSpeed Insights</a> という記事がありましたので、それを参考に設定を実施します。 まず、FTPでWordPressにアクセスします。 その際、FTPクライアントの設定によっては、**.htaccess** が表示されません。 例えば、WinSCP では、下記のように隠しファイルを表示する設定を有効にしないと表示されません。<br><a href="../../../../public/2017/03/1956b52021231e12487d67234161afe7.png"><img src="../../../../public/2017/03/1956b52021231e12487d67234161afe7-300x254.png"></a> 設定を有効後、**/home//www/wordpress/.htaccess** が表示されるはずです。 .htaccessをダウンロードして適当なエディタで開きます。 その後、下記の記述を追加します。 </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_deflate.c&gt;</span></span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE text/plain</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE text/html</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE text/xml</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE text/css</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE application/xml</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE application/xhtml+xml</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE application/rss+xml</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE application/javascript</span><br><span class="line"><span class="attribute">AddOutputFilterByType</span> DEFLATE application/x-javascript</span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure><p>追加後、.htaccessファイルを転送し上書きします。 特にApacheの再起動などは不要です。 再度、PageSpeed Insightsで計測し、<strong>gzip や deflate を使用してリソースを圧縮することで、ネットワークで送信されるバイト数を減らすことができます。</strong> という提案が無くなっていることを確認します。 <a href="../../../../public/2017/03/screencapture-developers-google-speed-pagespeed-insights-1489316921379.png"><img src="../../../../public/2017/03/screencapture-developers-google-speed-pagespeed-insights-1489316921379-300x210.png"></a><br> スコアが<strong>85/100</strong>と大幅に改善しました。</p><h2 id="ブラウザキャッシュを有効"><a href="#ブラウザキャッシュを有効" class="headerlink" title="ブラウザキャッシュを有効"></a>ブラウザキャッシュを有効</h2><p>続いて、下記の記述を追加して、ブラウザのキャッシュを有効にします。 </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_expires.c&gt;</span></span><br><span class="line"><span class="attribute">ExpiresActive</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">ExpiresByType</span> image/png <span class="string">&quot;access plus 1 months&quot;</span></span><br><span class="line"><span class="attribute">ExpiresByType</span> image/jpeg <span class="string">&quot;access plus 1 months&quot;</span></span><br><span class="line"><span class="attribute">ExpiresByType</span> application/x-javascript <span class="string">&quot;access plus 1 months&quot;</span></span><br><span class="line"><span class="attribute">ExpiresByType</span> application/x-font-ttf <span class="string">&quot;access plus 1 months&quot;</span></span><br><span class="line"><span class="attribute">ExpiresByType</span> application/x-font-woff <span class="string">&quot;access plus 1 months&quot;</span></span><br><span class="line"><span class="attribute">ExpiresByType</span> text/javascript <span class="string">&quot;access plus 1 months&quot;</span></span><br><span class="line"><span class="attribute">ExpiresByType</span> text/css <span class="string">&quot;access plus 1 months&quot;</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure><p>こちらも再度パフォーマンス計測しなおします。<br><a href="../../../../public/2017/03/screencapture-developers-google-speed-pagespeed-insights-1489319008466.png"><img src="../../../../public/2017/03/screencapture-developers-google-speed-pagespeed-insights-1489319008466-300x199.png"></a><br> スコアが<strong>91/100</strong>と改善しました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>数値的に大幅に改善したことがわかると、精神的に楽になります。 確かにブラウザでアクセスすると、ページの表示が速くなったのが目に見えて体感できました。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> 雑記 </category>
          
          <category> WordPress </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでPythonを試してみる 第5回</title>
      <link href="/2017/03/12/1849/"/>
      <url>/2017/03/12/1849/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-tq">前回</a>はIronPythonを捨てて、RESTを使ってPythonと連携しました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>C#からPythonで公開したREST APIを呼び出すことには成功しました。<br>逆にC#で公開したREST APIを呼び出すことも可能です。<br>定期的にPython側での処理結果をC#側にプッシュするような形態のシステムもあり得ますので、PythonからC#への通信方法を知ることも有用でしょう。<br>今回のソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python5" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python5</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><h2 id="requestsインストール"><a href="#requestsインストール" class="headerlink" title="requestsインストール"></a>requestsインストール</h2><p>requestsは「人間のためのHTTP」と銘打った、極めてシンプルで洗練されたHTTPライブラリです。</p><p>インストールもお馴染みのpipで簡単。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python -m pip install requests</span><br><span class="line">Collecting requests</span><br><span class="line">  Downloading requests-<span class="number">2</span>.<span class="number">13</span>.<span class="number">0</span>-py2.py3-none-any.whl (<span class="number">584</span>kB)</span><br><span class="line">    <span class="number">100</span>% |################################| <span class="number">593</span>kB <span class="number">1</span>.<span class="number">1</span>MB/s</span><br><span class="line">Installing collected packages: requests</span><br><span class="line">Successfully installed requests-<span class="number">2</span>.<span class="number">13</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p>以上でインストールは完了です。</p><h2 id="ソース"><a href="#ソース" class="headerlink" title="ソース"></a>ソース</h2><p>前回のソースに手を加えた感じです。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Resource, Api</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime <span class="keyword">as</span> dt</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateTimeServiceClient</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_send</span>(<span class="params">self, datetime</span>):</span></span><br><span class="line">        s = requests.session()</span><br><span class="line"></span><br><span class="line">        tstr = datetime.strftime(<span class="string">&quot;%Y/%m/%d %H:%M:%S.&quot;</span>) + <span class="string">&quot;%03d&quot;</span> % (datetime.microsecond // <span class="number">1000</span>)</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;dateTime&#x27;</span>: tstr,</span><br><span class="line">        &#125;</span><br><span class="line">        headers = &#123;<span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">        r =  s.post(<span class="string">&#x27;http://localhost:5002/DateTimeService/Send&#x27;</span>, params=params, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span>(<span class="params">Resource</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        dtsc = DateTimeServiceClient();</span><br><span class="line">        tdatetime = dt.now()</span><br><span class="line">        dtsc._send(tdatetime);</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;hello&#x27;</span>: <span class="string">&#x27;world&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">api.add_resource(HelloWorld, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>getメソッド内で、<strong>DateTimeServiceClient._sendメソッド</strong>を呼び出します。<br>_sendメソッドは、外部のREST APIに対してPOSTで現在時刻を渡します。<br>つまり、外部(C#)から自身のREST APIを呼ばれている最中に、外部(C#)のREST APIを呼び出します。<br>重要なことですが、</p><ul><li><strong>headers</strong>は<strong>postメソッド</strong>に渡してください</li><li><strong>params</strong>の<strong>dateTimeキー</strong>の文字列を間違えないでください</li><li><strong>postメソッド</strong>の第一引数はC#側ときちんと一致させること</li></ul><p>これらが守られないと、クラッシュしたり、正しく動きません。<br>Python側は以上です。</p><h1 id="C"><a href="#C" class="headerlink" title="C#"></a>C#</h1><p>インストールするライブラリは前回と同じです。</p><h2 id="ソース-1"><a href="#ソース-1" class="headerlink" title="ソース"></a>ソース</h2><p>WPFです。Xaml側は省略します。<br>Xamlは、Python側のREST APIを呼び出すButton、Python側から受け取る現在時刻情報を追加するListBoxです。<br>ViewModelもButtonに対応するコマンドと現在時刻のコレクションだけです。<br>まずは、公開するREST APIです。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython.Contracts.Service</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ServiceContract</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDateTimeService</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">event</span> EventHandler&lt;DateTime&gt; DateTimeReceived;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Send</span>(<span class="params"><span class="keyword">string</span> paramDateTime</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel.Web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython.Contracts.Service</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ServiceBehavior(InstanceContextMode = InstanceContextMode.Single)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">DateTimeService</span> : <span class="title">IDateTimeService</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> イベント</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> EventHandler&lt;DateTime&gt; DateTimeReceived;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> メソッド</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">WebInvoke(Method = <span class="meta-string">&quot;POST&quot;</span>, UriTemplate = <span class="meta-string">&quot;Send?dateTime=&#123;paramDateTime&#125;&quot;</span>,</span></span><br><span class="line"><span class="meta">          RequestFormat = WebMessageFormat.Json)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Send</span>(<span class="params"><span class="keyword">string</span> paramDateTime</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> dt = DateTime.Parse(paramDateTime);</span><br><span class="line">            <span class="keyword">this</span>.DateTimeReceived?.Invoke(<span class="keyword">this</span>, dt);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>肝はSendメソッドに付与された<strong>WebInvoke属性</strong>です。<br>プロパティは重要ですが、<strong>UriTemplateプロパティ</strong>の値は特に重要です。<br>Sendメソッドの名前と、UriTemplateプロパティのSendは一致させる必要はありませんが、UriTemplateプロパティのSendはPython側で、postメソッドで指定した値と一致させます。<br>同様に、dateTimeもPython側のparamsのキーと一致させます。<br>ちなみに、UriTemplateプロパティのparamDateTimeの部分は、Sendメソッドの引数、paramDateTimeと一致させないと、アプリ起動時にクラッシュします。<br>Sendメソッドの中身は単純で、渡ってきた文字列をDateTime型に変換し、イベントを呼び出すだけです。<br>次にViewModelです。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.ObjectModel;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight.Command;</span><br><span class="line"><span class="keyword">using</span> WPFPython.Contracts.Service;</span><br><span class="line"><span class="keyword">using</span> WPFPython.ViewModels.Interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">MainViewModel</span> : <span class="title">ViewModelBase</span>, <span class="title">IMainViewModel</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> フィールド</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IDateTimeService _DateTimeService;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> コンストラクタ</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span>(<span class="params">IDateTimeService dateTimeService</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dateTimeService == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(dateTimeService));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._DateTimeService = dateTimeService;</span><br><span class="line">            <span class="keyword">this</span>._DateTimeService.DateTimeReceived += (sender, time) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>._Responses.Insert(<span class="number">0</span>, time.ToString(<span class="string">&quot;yyyy/MM/dd hh:mm:ss.fff&quot;</span>));</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._Responses = <span class="keyword">new</span> ObservableCollection&lt;<span class="keyword">string</span>&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> プロパティ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RelayCommand _MessageCommand;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> RelayCommand MessageCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._MessageCommand ?? <span class="keyword">new</span> RelayCommand(<span class="keyword">async</span> () =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> httpClient = <span class="keyword">new</span> HttpClient();</span><br><span class="line">                    <span class="keyword">await</span> httpClient.GetStringAsync(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ObservableCollection&lt;<span class="keyword">string</span>&gt; _Responses;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ObservableCollection&lt;<span class="keyword">string</span>&gt; Responses</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._Responses;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MessageCommandがPython側のREST APIを呼び出します。<br>また、その呼び出しで、C#側のREST APIがPython側から実行され、Python側から渡ってきた時刻がResponsesコレクションに追加されます。<br>最後にViewModelLocatorです。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  In App.xaml:</span></span><br><span class="line"><span class="comment">  &lt;Application.Resources&gt;</span></span><br><span class="line"><span class="comment">      &lt;vm:ViewModelLocator xmlns:vm=&quot;clr-namespace:WPF1&quot;</span></span><br><span class="line"><span class="comment">                                   x:Key=&quot;Locator&quot; /&gt;</span></span><br><span class="line"><span class="comment">  &lt;/Application.Resources&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  In the View:</span></span><br><span class="line"><span class="comment">  DataContext=&quot;&#123;Binding Source=&#123;StaticResource Locator&#125;, Path=ViewModelName&#125;&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel.Web;</span><br><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight.Ioc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Practices.ServiceLocation;</span><br><span class="line"><span class="keyword">using</span> WPFPython.Contracts.Service;</span><br><span class="line"><span class="keyword">using</span> WPFPython.ViewModels;</span><br><span class="line"><span class="keyword">using</span> WPFPython.ViewModels.Interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> This class contains static references to all the view models in the</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> application and provides an entry point for the bindings.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;para&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> See http://www.galasoft.ch/mvvm</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/para&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ViewModelLocator</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> ServiceHost _ServiceHost;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="title">ViewModelLocator</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            ServiceLocator.SetLocatorProvider(() =&gt; SimpleIoc.Default);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ViewModelBase.IsInDesignModeStatic)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// SimpleIoc.Default.Register&lt;IDataService, Design.DesignDataService&gt;();</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// SimpleIoc.Default.Register&lt;IDataService, DataService&gt;();</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> port = <span class="number">5002</span>;</span><br><span class="line">            <span class="keyword">var</span> baseAddress = <span class="string">&quot;http://&quot;</span> + Environment.MachineName + <span class="string">$&quot;:<span class="subst">&#123;port&#125;</span>/<span class="subst">&#123;<span class="keyword">typeof</span>(DateTimeService).Name&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">var</span> dateTimeService = <span class="keyword">new</span> DateTimeService();</span><br><span class="line">            _ServiceHost = <span class="keyword">new</span> WebServiceHost(dateTimeService, <span class="keyword">new</span> Uri(baseAddress));</span><br><span class="line">            _ServiceHost.Open();</span><br><span class="line"></span><br><span class="line">            SimpleIoc.Default.Register&lt;IDateTimeService&gt;(() =&gt; dateTimeService);</span><br><span class="line">            SimpleIoc.Default.Register&lt;IMainViewModel, MainViewModel&gt;();</span><br><span class="line"></span><br><span class="line">            Application.Current.Exit += CurrentOnExit;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CurrentOnExit</span>(<span class="params"><span class="keyword">object</span> sender, ExitEventArgs exitEventArgs</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                _ServiceHost.Close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Gets the Main property.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">System.Diagnostics.CodeAnalysis.SuppressMessage(<span class="meta-string">&quot;Microsoft.Performance&quot;</span>,</span></span><br><span class="line"><span class="meta">            <span class="meta-string">&quot;CA1822:MarkMembersAsStatic&quot;</span>,</span></span><br><span class="line"><span class="meta">            Justification = <span class="meta-string">&quot;This non-static member is needed for data binding purposes.&quot;</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> IMainViewModel Main</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> ServiceLocator.Current.GetInstance&lt;IMainViewModel&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>WebServiceHostインスタンス生成時のUrlに注意するのと、IDateTimeServiceに対応する実際の型は、MinaViewModelに保持するインスタンスと、WebServiceHostで保持するインスタンスは同一であることに注意します。<br>ポート番号も一致させます。<br>C#は以上です。</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>実際に実行してみます。<br>C#側を起動する前に、PythonでRESTサービス側を起動しておいてください。<br>ボタンを押下すると、Python側から受け取った現在時刻が画面下部のListBoxに追加されていきます。</p><p><a href="../../../../public/2017/03/39abe2940aaa28bb948b44bcd1277838.png"><img src="../../../../public/2017/03/39abe2940aaa28bb948b44bcd1277838-173x300.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>C#側のRESTを活用して、C#とPythonで双方向通信が可能になりました。<br>実はRESTを使用したアプリを作るのは初めてでした。<br>WebInvoke属性の値の設定で苦労しましたが、良い経験になりました。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python5">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python5</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> Python </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Windows Presentation Foundation </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでPythonを試してみる </category>
          
          <category> web-framework </category>
          
          <category> Flask </category>
          
          <category> Web Framework </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでPythonを試してみる 第4回</title>
      <link href="/2017/03/12/1824/"/>
      <url>/2017/03/12/1824/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-sU">前回</a>はパッケージのインストールに失敗しました。</p><a id="more"></a><h1 id="謝罪"><a href="#謝罪" class="headerlink" title="謝罪"></a>謝罪</h1><p>まずはじめに。 <strong>IronPython</strong> の使用を諦めることにしました。 理由はモジュールのインストールができなかったことです。 一番シンプルだと思っていた <strong>simplejson</strong> すらまともにできませんでした。 正確には、インストールはできましたが、いざ import simplejson すると、動かない。 他にも、</p><ul><li>CPythonと同じ方法でC言語ベースのライブラリと相互運用が<strong>できない</strong></li><li>2017/03/11時点で、<a href="https://github.com/IronLanguages/main/issues">Issue</a>の数が700越え。あまりにも利用者の声に応える余裕がない。</li></ul><p>結局、ネット上で調べると、動かないという情報ばかり、でこれ以上貴重な時間を費やすことはできない、という判断に至りました。 4日以上使いましたが、本当に無駄骨に終わりました。</p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>なので、方針を変えます。 <strong>「.NETからPythonを使う」</strong> という目的を達するなら、思いつく限り、</p><ul><li>Pythonをコマンドプロンプトで呼び出し、標準出力で結果を受け取り解析</li><li>Pythonをコマンドプロンプトで呼び出し、ファイルで結果を受け取り解析</li><li>Pythonで動作しているWebサービスのAPIを叩く</li></ul><p>あたりでしょうか。 1,2番目は面倒ですし、なによりださいので、3番目を利用します。 Webサービスなら、WCFによって簡単に.NETから呼び出せます。 というのも、Pythonをコマンドプロンプトで呼ぶと、呼び出しのコストが大きいと思います。 試してみた限り、Pythonの起動は遅いです。おそらく必要なモジュールなどを読み込んでいるからだと思うのですが、無視できない間隔で待たされます。 なので、起動コストを無視するために、常に起動しっぱなしにして、必要なときに必要な演算結果を受け取る形式がベスト。 ですので、今回はPythonでシンプルなRESTfulサービスを作成し、C#アプリからアクセスします。 そのために軽量なWebフレームワークであるPythonモジュール <strong>Flask</strong> を使用します。 Flaskについては下記を。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://ja.wikipedia.org/wiki/Flask" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ja.wikipedia.org"></img><div class="hbc-site-name">ja.wikipedia.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Flask - Wikipedia</div><div class="hbc-url">https://ja.wikipedia.org/wiki/Flask</div></div></div></div></a></div></div><p>また、使用するPythonはMinicondaを使用します。 今回のソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python4" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python4</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><h2 id="Flaskインストール"><a href="#Flaskインストール" class="headerlink" title="Flaskインストール"></a>Flaskインストール</h2><p>さくっとインストールします。 下記に従うだけです。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ python -m pip install flask-restful</span><br><span class="line">Collecting flask-restful</span><br><span class="line">  Downloading Flask_RESTful-<span class="number">0</span>.<span class="number">3</span>.<span class="number">5</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting aniso8601&gt;=<span class="number">0</span>.<span class="number">82</span> (from flask-restful)</span><br><span class="line">  Downloading aniso8601-<span class="number">1</span>.<span class="number">2</span>.<span class="number">0</span>.tar.gz (<span class="number">59</span>kB)</span><br><span class="line">    <span class="number">100</span>% |################################| <span class="number">61</span>kB <span class="number">503</span>kB/s</span><br><span class="line">Requirement already satisfied: pytz <span class="keyword">in</span> c:\program files\miniconda2\lib\site-packages (from flask-restful)</span><br><span class="line">Requirement already satisfied: six&gt;=<span class="number">1</span>.<span class="number">3</span>.<span class="number">0</span> <span class="keyword">in</span> c:\program files\miniconda2\lib\site-packages (from flask-restful)</span><br><span class="line">Collecting Flask&gt;=<span class="number">0</span>.<span class="number">8</span> (from flask-restful)</span><br><span class="line">  Downloading Flask-<span class="number">0</span>.<span class="number">12</span>-py2.py3-none-any.whl (<span class="number">82</span>kB)</span><br><span class="line">    <span class="number">100</span>% |################################| <span class="number">92</span>kB <span class="number">1</span>.<span class="number">1</span>MB/s</span><br><span class="line">Requirement already satisfied: python-dateutil <span class="keyword">in</span> c:\program files\miniconda2\lib\site-packages (from aniso8601&gt;=<span class="number">0</span>.<span class="number">82</span>-&gt;flask-restful)</span><br><span class="line">Collecting Jinja2&gt;=<span class="number">2</span>.<span class="number">4</span> (from Flask&gt;=<span class="number">0</span>.<span class="number">8</span>-&gt;flask-restful)</span><br><span class="line">  Downloading Jinja2-<span class="number">2</span>.<span class="number">9</span>.<span class="number">5</span>-py2.py3-none-any.whl (<span class="number">340</span>kB)</span><br><span class="line">    <span class="number">100</span>% |################################| <span class="number">348</span>kB <span class="number">1</span>.<span class="number">5</span>MB/s</span><br><span class="line">Collecting Werkzeug&gt;=<span class="number">0</span>.<span class="number">7</span> (from Flask&gt;=<span class="number">0</span>.<span class="number">8</span>-&gt;flask-restful)</span><br><span class="line">  Downloading Werkzeug-<span class="number">0</span>.<span class="number">12</span>-py2.py3-none-any.whl (<span class="number">312</span>kB)</span><br><span class="line">    <span class="number">100</span>% |################################| <span class="number">317</span>kB <span class="number">1</span>.<span class="number">6</span>MB/s</span><br><span class="line">Collecting click&gt;=<span class="number">2</span>.<span class="number">0</span> (from Flask&gt;=<span class="number">0</span>.<span class="number">8</span>-&gt;flask-restful)</span><br><span class="line">  Downloading click-<span class="number">6</span>.<span class="number">7</span>-py2.py3-none-any.whl (<span class="number">71</span>kB)</span><br><span class="line">    <span class="number">100</span>% |################################| <span class="number">71</span>kB <span class="number">2</span>.<span class="number">3</span>MB/s</span><br><span class="line">Collecting itsdangerous&gt;=<span class="number">0</span>.<span class="number">21</span> (from Flask&gt;=<span class="number">0</span>.<span class="number">8</span>-&gt;flask-restful)</span><br><span class="line">  Downloading itsdangerous-<span class="number">0</span>.<span class="number">24</span>.tar.gz (<span class="number">46</span>kB)</span><br><span class="line">    <span class="number">100</span>% |################################| <span class="number">51</span>kB <span class="number">2</span>.<span class="number">3</span>MB/s</span><br><span class="line">Collecting MarkupSafe&gt;=<span class="number">0</span>.<span class="number">23</span> (from Jinja2&gt;=<span class="number">2</span>.<span class="number">4</span>-&gt;Flask&gt;=<span class="number">0</span>.<span class="number">8</span>-&gt;flask-restful)</span><br><span class="line">  Downloading MarkupSafe-<span class="number">1</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">Building wheels <span class="keyword">for</span> collected packages: aniso8601, itsdangerous, MarkupSafe</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> aniso8601 ... done</span><br><span class="line">  Stored <span class="keyword">in</span> directory: C:\Users\TAKUYA\AppData\Local\pip\Cache\wheels\<span class="number">9</span>e\<span class="number">75</span>\c1\aa2de49c0d1ade4893e73009c0b7792ce89bc6c903a31f854b</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> itsdangerous ... done</span><br><span class="line">  Stored <span class="keyword">in</span> directory: C:\Users\TAKUYA\AppData\Local\pip\Cache\wheels\fc\a8\<span class="number">66</span>\<span class="number">24</span>d655233c757e178d45dea2de22a04c6d92766abfb741129a</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> MarkupSafe ... done</span><br><span class="line">  Stored <span class="keyword">in</span> directory: C:\Users\TAKUYA\AppData\Local\pip\Cache\wheels\<span class="number">88</span>\a7\<span class="number">30</span>\e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57</span><br><span class="line">Successfully built aniso8601 itsdangerous MarkupSafe</span><br><span class="line">Installing collected packages: aniso8601, MarkupSafe, Jinja2, Werkzeug, click, itsdangerous, Flask, flask-restful</span><br><span class="line">Successfully installed Flask-<span class="number">0</span>.<span class="number">12</span> Jinja2-<span class="number">2</span>.<span class="number">9</span>.<span class="number">5</span> MarkupSafe-<span class="number">1</span>.<span class="number">0</span> Werkzeug-<span class="number">0</span>.<span class="number">12</span> aniso8601-<span class="number">1</span>.<span class="number">2</span>.<span class="number">0</span> click-<span class="number">6</span>.<span class="number">7</span> flask-restful-<span class="number">0</span>.<span class="number">3</span>.<span class="number">5</span> itsdangerous-<span class="number">0</span>.<span class="number">24</span></span><br></pre></td></tr></table></figure><p>以上でインストールは完了です。</p><h2 id="動作確認"><a href="#動作確認" class="headerlink" title="動作確認"></a>動作確認</h2><p>最小のRESTfulなアプリが下記ドキュメントにあるのでファイルに保存します。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Resource, Api</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span>(<span class="params">Resource</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;hello&#x27;</span>: <span class="string">&#x27;world&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">api.add_resource(HelloWorld, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>以上のソースを下記で起動します。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python Python.py</span><br><span class="line"> * Restarting with stat</span><br><span class="line"> * Debugger is active!</span><br><span class="line"> * Debugger PIN: <span class="number">177</span>-<span class="number">715</span>-<span class="number">949</span></span><br><span class="line"> * Running on http://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">5000</span>/ (Press CTRL+C to quit) </span><br></pre></td></tr></table></figure><p>Webブラウザで <strong><a href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a></strong> へアクセスすると、下記が表示されます。 </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;hello&quot;</span>: <span class="string">&quot;world&quot;</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>jsonで返ってきています。 以上でFlaskのテストは完了です。</p><h1 id="C"><a href="#C" class="headerlink" title="C#"></a>C#</h1><p>SOAPであるならば、エンドポイントを参照して、クライアントクラス等の生成が自動でできますが、RESTにそんな便利機能はありません。</p><h2 id="Microsoft-Net-Http"><a href="#Microsoft-Net-Http" class="headerlink" title="Microsoft.Net.Http"></a>Microsoft.Net.Http</h2><p>RESTful APIへのアクセスです。RESTful APIへのアクセスはライブラリを使って簡略化します。 幸い<strong>Microsoft.Net.Http</strong>というライブラリがあるのでNuGetで導入します。 </p><h2 id="Newtonsoft-Json"><a href="#Newtonsoft-Json" class="headerlink" title="Newtonsoft.Json"></a>Newtonsoft.Json</h2><p>RESTful APIから返ってきたjsonの逆シリアライズを<strong>Newtonsoft.Json</strong>で実行します。 こちらもNuGetで導入します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.newtonsoft.com/json" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.newtonsoft.com"></img><div class="hbc-site-name">www.newtonsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Json.NET - Newtonsoft</div><div class="hbc-url">http://www.newtonsoft.com/json</div><div class="hbc-description">Json.NET is a popular high-performance JSON framework for .NET</div></div></div></div></a></div></div><h2 id="ソース"><a href="#ソース" class="headerlink" title="ソース"></a>ソース</h2><p>WPFです。Xaml側は省略します。 Xamlは、結果を表示するためのメッセージボックスを呼び出すButtonだけです。 ViewModelもButtonに対応するコマンドだけです。 まずは、先ほどのjsonに対するModelクラスです。 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">JsonObject(<span class="meta-string">&quot;message&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">MessageModel</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">JsonProperty(<span class="meta-string">&quot;hello&quot;</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Hello &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>次はViewModelです。 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.ObjectModel;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight.Command;</span><br><span class="line"><span class="keyword">using</span> WPFPython.Models;</span><br><span class="line"><span class="keyword">using</span> WPFPython.ViewModels.Interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">MainViewModel</span> : <span class="title">ViewModelBase</span>, <span class="title">IMainViewModel</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> フィールド</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IMessageDialog _MessageDialog;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> コンストラクタ</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span>(<span class="params">IMessageDialog messageDialog</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (messageDialog == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(messageDialog));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._MessageDialog = messageDialog;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> プロパティ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RelayCommand _MessageCommand;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> RelayCommand MessageCommand</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>._MessageCommand ?? <span class="keyword">new</span> RelayCommand(<span class="keyword">async</span> () =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> httpClient = <span class="keyword">new</span> HttpClient();</span><br><span class="line">                    <span class="keyword">var</span> stringAsync = httpClient.GetStringAsync(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span>);</span><br><span class="line">                    <span class="keyword">string</span> result = <span class="keyword">await</span> stringAsync;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> messageModel = Newtonsoft.Json.JsonConvert.DeserializeObject&lt;MessageModel&gt;(result);</span><br><span class="line">                    <span class="keyword">this</span>._MessageDialog.ShowMessage(messageModel.Hello);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>実際に実行してみます。 C#側を起動する前に、PythonでRESTサービス側を起動しておいてください。 ボタンを押下すると、REST APIのjsonを受け取り、そのjson唯一のメンバーである、Helloキーに対応する値をメッセージボックスで表示します。<br><a href="../../../../public/2017/03/8a4025a85ae44b8c3ffc267797049cd1.png"><img src="../../../../public/2017/03/8a4025a85ae44b8c3ffc267797049cd1.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>IronPythonが期待外れに終わった今、Pythonの既存資産を生かす方法として、Webサービス化は有用な手段です。 単純に結果を呼び出すだけならRESTful APIは簡単で魅力的です。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python4">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python4</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> Python </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Windows Presentation Foundation </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでPythonを試してみる </category>
          
          <category> web-framework </category>
          
          <category> Flask </category>
          
          <category> Web Framework </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでPythonを試してみる 第3回</title>
      <link href="/2017/03/09/1792/"/>
      <url>/2017/03/09/1792/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-sO">前回</a>は配列を引数で渡し、戻りを配列で受け取る関数を呼び出してみました。</p><a id="more"></a><p>&lt;style=”margin-top: 40px;”/&gt;</p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>今回の目的は、パッケージを使います。<br>PythonもNuget、npm、apt-getよろしくパッケージ管理マネージャー <strong>pip</strong> が存在します。<br>英語版Wikiによれば、pipとは、再帰的頭字語で、<strong>Pip Installs Packages</strong> または <strong>Pip Installs Python</strong> とのこと。<br>昔あったLAMEとかと同じですね。古い。</p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://en.wikipedia.org/wiki/Pip_(package_manager)" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=en.wikipedia.org"></img><div class="hbc-site-name">en.wikipedia.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://upload.wikimedia.org/wikipedia/commons/0/02/Pip_help.png"></img></div><div class="hbc-text"><div class="hbc-title">pip (package manager) - Wikipedia</div><div class="hbc-url">https://en.wikipedia.org/wiki/Pip_(package_manager)</div></div></div></div></a></div></div><p>IronPythonからPythonを呼ぶにしても、Python単独でできることは限られます。<br>画像処理とかグラフの描画など、豊富なパッケージを利用して、開発工数を削減できますし、高品質なアプリを構築できます。</p><p>しかしながら、Pythonを使うときは、普通 <strong>Python.exe</strong> からスクリプトを呼び出しますし、そこでパッケージのインストールを行います。<br>つまり、今実行している場所が基盤であることが意識できます。</p><p>対して、IronPython、つまり.NETで動作しているときは、このあたりが意識しづらいです。<br>バックエンドでPythonがごにょごにょしているのはわかるのですが、もやもやします。</p><p>なので、実際にパッケージを使って見ます。</p><p>使うパッケージは簡単で、<a href="https://pypi.python.org/pypi/simplejson/">simplejson</a> を使います。<br>その名の通り、jsonファイルを扱います。<br>.NETは標準で.jsonを扱えるのでわざわざこれを使う必要性は薄いのですが…<br>軽量なパッケージでわかりやすいのがこれだったので… 今回のソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python3" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python3</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>ただし、今回は最終的には</p><p><strong>失敗</strong></p><p>です。<br>忘備録として残してあります。</p><h1 id="Python側"><a href="#Python側" class="headerlink" title="Python側"></a>Python側</h1><p>Pythonのソースは下記になります。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> simplejson</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PythonTest</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load</span>(<span class="params">self, path</span>):</span></span><br><span class="line">        f = open(path, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        data = json.load(f)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>jsonのファイルパスを読み込んで、辞書データを返すだけです。<br>ここでは、パッケージの利用と、辞書形式クラスの扱いが肝になります。</p><h1 id="C-側"><a href="#C-側" class="headerlink" title="C#側"></a>C#側</h1><p>WPFです。Xaml側は省略します。<br>jsonファイルから値を読み込むキーを指定するComboBox、結果を表示するためのメッセージボックスを呼び出すButtonだけです。<br>PythonWrapperのメソッドを呼び出す<strong>RelayCommand</strong>です。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> RelayCommand MessageCommand</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._MessageCommand ?? <span class="keyword">new</span> RelayCommand(() =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> array = Enumerable.Range(<span class="keyword">this</span>._Start, <span class="keyword">this</span>._End - <span class="keyword">this</span>._Start + <span class="number">1</span>).ToArray();</span><br><span class="line">            <span class="keyword">var</span> sum = array.Sum();</span><br><span class="line">            <span class="keyword">var</span> list = <span class="keyword">this</span>._PythonWrapper.Twice(array);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> message = <span class="string">$&quot;Initial total:<span class="subst">&#123;sum&#125;</span>, final total:<span class="subst">&#123;list.Sum()&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">this</span>._MessageDialog.ShowMessage(message);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PythonWrapperの中身です。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Scripting.Hosting;</span><br><span class="line"><span class="keyword">using</span> WPFPython.ViewModels.Interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">PythonWrapper</span> : <span class="title">IPythonWrapper</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> フィールド</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ScriptRuntime _ScriptRuntime;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">dynamic</span> _PythonObject;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">dynamic</span> _PythonTest;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">string</span> _Path;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> コンストラクタ</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PythonWrapper</span>(<span class="params">ScriptRuntime scriptRuntime, <span class="keyword">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (scriptRuntime == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(scriptRuntime));</span><br><span class="line">            <span class="keyword">if</span> (path == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(path));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._ScriptRuntime = scriptRuntime;</span><br><span class="line">            <span class="keyword">this</span>._Path = path;</span><br><span class="line">            <span class="keyword">this</span>._PythonObject = <span class="keyword">this</span>._ScriptRuntime.UseFile(<span class="keyword">this</span>._Path);</span><br><span class="line">            <span class="keyword">this</span>._PythonTest = <span class="keyword">this</span>._PythonObject.PythonTest();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> メソッド</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">object</span>&gt; <span class="title">load</span>(<span class="params"><span class="keyword">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._PythonTest.load(path);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>引数に読み出したいjsonファイルのパスを渡すloadメソッドだけです。<br>戻りは Dicrionary&lt;string, object&gt; を返します。<br>Pythonが得意とする辞書をそのまま返すということです。</p><h1 id="テスト-パッケージインストール前"><a href="#テスト-パッケージインストール前" class="headerlink" title="テスト (パッケージインストール前)"></a>テスト (パッケージインストール前)</h1><p>さて、ためしにこれを実行してみます。<br>simplejsonパッケージをインストールする前です。<br>通常のPythonなら <strong>No module named XXX</strong> というお馴染みのメッセージが出ます。<br>IronPythonだとどうなるでしょう。</p><p><a href="../../../../public/2017/03/b8bbf21eb9da042e3413685afbff54ea.png"><img src="../../../../public/2017/03/b8bbf21eb9da042e3413685afbff54ea-300x265.png"></a><br> Microsoft.Scripting.Hosting.ScriptRuntime.UseFile メソッドでpyファイルを渡した瞬間に例外を投げました。<br><strong>IronPython.Runtime.Exceptions.ImportException</strong> がスローされるようです。</p><h1 id="テスト-パッケージインストール-失敗編"><a href="#テスト-パッケージインストール-失敗編" class="headerlink" title="テスト (パッケージインストール 失敗編)"></a>テスト (パッケージインストール 失敗編)</h1><h2 id="Visual-Studio-からインストール"><a href="#Visual-Studio-からインストール" class="headerlink" title="Visual Studio からインストール"></a>Visual Studio からインストール</h2><p>パッケージをインストールします。<br>モジュールのインストールは、VisualStudioから実行できます。</p><p><a href="../../../../public/2017/03/0d40a5e4a645fc6b96e767d64ac0878e.png"><img src="../../../../public/2017/03/0d40a5e4a645fc6b96e767d64ac0878e-300x221.png"></a> <strong>Python Environments</strong> から IronPythonを選択します。今回は 64bit 環境なので、<strong>IronPython 64bit 2.7</strong> を右クリック。<br><a href="../../../../public/2017/03/bfe555476f58150c92828373aa3519db.png"><img src="../../../../public/2017/03/bfe555476f58150c92828373aa3519db-300x248.png"></a> <strong>Install Python Package…</strong> を選択します。<br><a href="../../../../public/2017/03/7b5b57db814f433f49437c32d4dc75a8.png"><img src="../../../../public/2017/03/7b5b57db814f433f49437c32d4dc75a8-300x147.png"></a> インストールするパッケージ名を入力して、OKを押下します。<br><a href="../../../../public/2017/03/cef9d1a7e2d9d659cd3f3c1aeb171afa.png"><img src="../../../../public/2017/03/cef9d1a7e2d9d659cd3f3c1aeb171afa-300x144.png"></a> OK <a href="../../../../public/2017/03/8c9b9c40e55b3b8505eb48c815c302a0.png"><img src="../../../../public/2017/03/8c9b9c40e55b3b8505eb48c815c302a0-300x90.png"></a> しかし失敗してしまいます。<br>ログを見ると、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Installing &#x27;pip&#x27; package manager.</span><br><span class="line">Restarting IronPython with -X:Frames</span><br><span class="line">Downloading pip from https://go.microsoft.com/fwlink/?LinkId=<span class="number">616663</span></span><br><span class="line">Failed to install. Attempting direct download.</span><br><span class="line">Downloading setuptools from http://go.microsoft.com/fwlink/?LinkId=<span class="number">317603</span></span><br><span class="line">Traceback (most recent <span class="keyword">call</span> last):</span><br></pre></td></tr></table></figure><p>とあります。<br>そもそも pip が入っていない様子。</p><h2 id="ensurepip"><a href="#ensurepip" class="headerlink" title="ensurepip"></a>ensurepip</h2><p>手動でpipの導入が必要らしいので、<a href="http://ironpython.net/blog/2014/12/07/pip-in-ironpython-275.html">Pip in IronPython 2.7.5</a> に従って、pipをインストールします。<br>ipy.exe がある場所 (デフォルトは <strong>C:\Program Files (x86)\IronPython 2.7</strong>、以下 IronPythonディレクトリ) を管理者権限をつけたコマンドプロンプトで開きます。<br>そして下記コマンドを入力します。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Program</span> <span class="title">Files</span> (<span class="title">x86</span>)\<span class="title">IronPython</span> 2.7&gt;<span class="title">ipy.exe</span> -<span class="title">X:Frames</span> -<span class="title">m</span> <span class="title">ensurepip</span></span></span><br><span class="line"><span class="function"><span class="title">Unhandled</span> <span class="title">exception</span>:</span></span><br><span class="line"><span class="function"><span class="title">Traceback</span> (<span class="title">most</span> <span class="title">recent</span> <span class="title">call</span> <span class="title">last</span>):</span></span><br><span class="line"><span class="function">  <span class="title">File</span> &quot;<span class="title">C</span>:\<span class="title">Program</span> <span class="title">Files</span> (<span class="title">x86</span>)\<span class="title">IronPython</span> 2.7\<span class="title">Lib</span>\<span class="title">runpy.py</span>&quot;, <span class="title">line</span> 170, <span class="title">in</span> <span class="title">run_module</span></span></span><br><span class="line"><span class="function">  <span class="title">File</span> &quot;<span class="title">C</span>:\<span class="title">Program</span> <span class="title">Files</span> (<span class="title">x86</span>)\<span class="title">IronPython</span> 2.7\<span class="title">Lib</span>\<span class="title">runpy.py</span>&quot;, <span class="title">line</span> 103, <span class="title">in</span> <span class="title">_get_module_details</span></span></span><br><span class="line"><span class="function"><span class="title">ImportError</span>: <span class="title">No</span> <span class="title">module</span> <span class="title">named</span> <span class="title">ensurepip</span></span></span><br></pre></td></tr></table></figure><p>が、失敗します。<br>ensurepip が無いって言っています。</p><h2 id="get-pip-py"><a href="#get-pip-py" class="headerlink" title="get-pip.py"></a>get-pip.py</h2><p>ensurepipのインストールがダメでした。<br>次の施策として、上のメッセージにある、<strong><a href="https://go.microsoft.com/fwlink/?LinkId=616663">https://go.microsoft.com/fwlink/?LinkId=616663</a></strong> にアクセスし、<strong>get-pip.py</strong> をダウンロードし、IronPythonディレクトリへコピーします。<br>管理者権限をつけたコマンドプロンプトで、IronPythonディレクトリを開き、下記コマンドを入力します。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Program</span> <span class="title">Files</span> (<span class="title">x86</span>)\<span class="title">IronPython</span> 2.7&gt;<span class="title">ipy.exe</span> <span class="title">get</span>-<span class="title">pip.py</span></span></span><br><span class="line"><span class="function"><span class="title">Traceback</span> (<span class="title">most</span> <span class="title">recent</span> <span class="title">call</span> <span class="title">last</span>):</span></span><br><span class="line"><span class="function">  <span class="title">File</span> &quot;<span class="title">get</span>-<span class="title">pip.py</span>&quot;, <span class="title">line</span> 20061, <span class="title">in</span> &lt;<span class="title">module</span>&gt;</span></span><br><span class="line"><span class="function">  <span class="title">File</span> &quot;<span class="title">get</span>-<span class="title">pip.py</span>&quot;, <span class="title">line</span> 188, <span class="title">in</span> <span class="title">main</span></span></span><br><span class="line"><span class="function">  <span class="title">File</span> &quot;<span class="title">get</span>-<span class="title">pip.py</span>&quot;, <span class="title">line</span> 74, <span class="title">in</span> <span class="title">b85decode</span></span></span><br><span class="line"><span class="function"><span class="title">TypeError</span>: <span class="title">sequence</span> <span class="title">item</span> 0: <span class="title">expected</span> <span class="title">bytes</span> <span class="title">or</span> <span class="title">byte</span> <span class="title">array</span>, <span class="title">str</span> <span class="title">found</span></span></span><br></pre></td></tr></table></figure><p>が、これも失敗します。</p><h2 id="バージョンアップ"><a href="#バージョンアップ" class="headerlink" title="バージョンアップ"></a>バージョンアップ</h2><p>ここでふと気づきます。<br>システムに入っているIronPythonのバージョンが <strong>2.7.4</strong> でした。<br>上のensurepipに関するBlogは<strong>2.7.5</strong>に関する記事で、上の問題は<strong>2.7.4</strong>で発生していました。<br>ですので、古いバージョンを削除し、2.7.7を再度インストールします。<br>アップデートし終わって、再度ensurepipの導入を試みます。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Program</span> <span class="title">Files</span> (<span class="title">x86</span>)\<span class="title">IronPython</span> 2.7&gt;<span class="title">ipy.exe</span> -<span class="title">X:Frames</span> -<span class="title">m</span> <span class="title">ensurepip</span></span></span><br><span class="line"><span class="function"><span class="title">Ignoring</span> <span class="title">indexes</span>: <span class="title">https</span>://<span class="title">pypi.python.org</span>/<span class="title">simple</span></span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">setuptools</span></span></span><br><span class="line"><span class="function"><span class="title">Collecting</span> <span class="title">pip</span></span></span><br><span class="line"><span class="function"><span class="title">Installing</span> <span class="title">collected</span> <span class="title">packages</span>: <span class="title">setuptools</span>, <span class="title">pip</span></span></span><br><span class="line"><span class="function"><span class="title">Successfully</span> <span class="title">installed</span> <span class="title">pip</span>-8.1.1 <span class="title">setuptools</span>-20.10.1</span></span><br></pre></td></tr></table></figure><p>上手くいきました。<br>では、お待ちかねのsimplejsonをインストールします。<br>前の同じように、Visual Studioからインストールします。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Installing &#x27;simplejson&#x27;</span><br><span class="line">Unhandled exception:</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> last):</span><br><span class="line">  File &quot;C:\Program Files (x86)\IronPython <span class="number">2</span>.<span class="number">7</span>\Lib\runpy.py&quot;, line <span class="number">182</span>, <span class="keyword">in</span> run_module</span><br><span class="line">  File &quot;C:\Program Files (x86)\IronPython <span class="number">2</span>.<span class="number">7</span>\Lib\runpy.py&quot;, line <span class="number">111</span>, <span class="keyword">in</span> _get_module_details</span><br><span class="line">  File &quot;C:\Program Files (x86)\IronPython <span class="number">2</span>.<span class="number">7</span>\Lib\site-packages\pip\__init__.py&quot;, line <span class="number">13</span>, <span class="keyword">in</span> </span><br><span class="line">  File &quot;C:\Program Files (x86)\IronPython <span class="number">2</span>.<span class="number">7</span>\Lib\site-packages\pip\exceptions.py&quot;, line <span class="number">6</span>, <span class="keyword">in</span> </span><br><span class="line">  File &quot;C:\Program Files (x86)\IronPython <span class="number">2</span>.<span class="number">7</span>\Lib\site-packages\pip\_vendor\six.py&quot;, line <span class="number">701</span>, <span class="keyword">in</span> </span><br><span class="line">  File &quot;C:\Program Files (x86)\IronPython <span class="number">2</span>.<span class="number">7</span>\Lib\site-packages\pip\_vendor\six.py&quot;, line <span class="number">692</span>, <span class="keyword">in</span> exec_</span><br><span class="line"><span class="function">AttributeError: &#x27;<span class="title">module</span>&#x27; <span class="title">object</span> <span class="title">has</span> <span class="title">no</span> <span class="title">attribute</span> &#x27;<span class="title">_getframe</span>&#x27;</span></span><br></pre></td></tr></table></figure><p>またしても失敗です。<br>この <strong>_getframe</strong> という単語を足掛かりに検索してみます。<br>すると下記の記事が見つかりました。</p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://stackoverflow.com/questions/37370537/pip-in-visual-studio-not-installing-packages" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=stackoverflow.com"></img><div class="hbc-site-name">Stack Overflow</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded"></img></div><div class="hbc-text"><div class="hbc-title">Pip in Visual Studio not installing packages</div><div class="hbc-url">http://stackoverflow.com/questions/37370537/pip-in-visual-studio-not-installing-packages</div><div class="hbc-description">Whenever I try to install a package (&#39;theano&#39;, in this case) it gives me this:----- Installing &#39;theano&#39; -----Unhandled exception:Traceba…</div></div></div></div></a></div></div><p>しかし、結論から言うと、ここに書いてある方法もダメでした。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回はまさかの失敗です。<br>モジュールがインストールできないなんて、Pythonを使う意味が全くありません。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python3">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python3</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> Python </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Windows Presentation Foundation </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> python-2 </category>
          
          <category> .NETでPythonを試してみる </category>
          
          <category> IronPython </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで音声処理を試してみる NAudio編 第1回</title>
      <link href="/2017/03/07/1800/"/>
      <url>/2017/03/07/1800/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>仕事の絡みで音響認識をすることになったのですが、画像処理なら <strong>OpenCV</strong> 使うなりして、それなりに対応できますが、音声となるとまったく…です。 それで、自分の引き出しを増やすために、音声処理系のライブラリを試してみました。 今回は <strong>Microsoft Public License</strong> で開発が進められている <strong>NAudio</strong> を試しました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://naudio.codeplex.com/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=naudio.codeplex.com"></img><div class="hbc-site-name">CodePlex Archive</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://archive.codeplex.com/codeplex.png"></img></div><div class="hbc-text"><div class="hbc-title">CodePlex Archive</div><div class="hbc-url">https://naudio.codeplex.com/</div><div class="hbc-description">An archive of the CodePlex open source hosting site</div></div></div></div></a></div></div><p>NAudioはマイクからの入力やスピーカーへの出力をキャプチャしてファイルに出力したりできます。 そうです。録音ソフトを作成できます。 今回は、ヘッドフォンやスピーカーへの出力をファイルに書き出すサンプルを作りました。 ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/NAudio1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/NAudio1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>いつも通り、MVVMを利用します。 <strong>MainWindow</strong> に対応する <strong>MainViewModel</strong>、音声の出力デバイスを取得する <strong>AudioService</strong>、デバイスからの音声データをファイルに書き込む <strong>AudioOutputWriter</strong> から成り立ちます。</p><h2 id="AudioService"><a href="#AudioService" class="headerlink" title="AudioService"></a>AudioService</h2><p>[code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using NAudio.CoreAudioApi; using NAudioDemo.Services.Interfaces;<br>namespace NAudioDemo.Services {<br>public sealed class AudioService : IAudioService {<br>public MMDeviceCollection GetActiveRender() { var collection = new MMDeviceEnumerator().EnumerateAudioEndPoints(DataFlow.Render, DeviceState.Active); return collection; }<br>}<br>} [/code] <strong>GetActiveRender</strong> は、PCに接続されているアクティブな出力デバイス一覧を取得します。 NAudioの用語で、<strong>Render</strong> は出力、<strong>Capture</strong> は入力を表します。 <strong>MMDeviceEnumerator</strong> は、<strong>Multimedia Device</strong> であり、<a href="https://msdn.microsoft.com/ja-jp/library/windows/desktop/dd371399(v=vs.85).aspx">IMMDeviceEnumerator</a> のラッパーでしょう。</p><h2 id="AudioOutputWriter"><a href="#AudioOutputWriter" class="headerlink" title="AudioOutputWriter"></a>AudioOutputWriter</h2><p>今回の肝です。 [code lang=”csharp”] using System; using System.Collections.Generic; using System.IO; using System.Linq; using System.Text; using System.Threading.Tasks; using NAudio.CoreAudioApi; using NAudio.Wave;<br>namespace NAudioDemo.Models {<br>public sealed class AudioOutputWriter : IDisposable {<br>#region イベント<br>public event EventHandler<WaveInEventArgs> DataAvailable;<br>#endregion<br>#region フィールド<br>private readonly string _FileName;<br>private WasapiLoopbackCapture _WaveIn;<br>private Stream _Stream;<br>private WaveFileWriter _WaveFileWriter;<br>#endregion<br>#region コンストラクタ<br>public AudioOutputWriter(string fileName, MMDevice device) { if (device == null) throw new ArgumentNullException(nameof(device));<br>this._FileName = fileName; this._WaveIn = new WasapiLoopbackCapture(device); this._WaveIn.DataAvailable += this.WaveInOnDataAvailable; this._WaveIn.RecordingStopped += this.WaveInOnRecordingStopped;<br>this._Stream = new FileStream(fileName, FileMode.Create, FileAccess.Write, FileShare.Write); this._WaveFileWriter = new WaveFileWriter(this._Stream, this._WaveIn.WaveFormat); }<br>#endregion<br>#region プロパティ<br>public bool IsRecording { get; private set; }<br>#endregion<br>#region メソッド<br>public void Start() { this.IsRecording = true; this._WaveIn.StartRecording(); }<br>public void Stop() { this.IsRecording = false; this._WaveIn.StopRecording(); }<br>#region オーバーライド #endregion<br>#region イベントハンドラ<br>private void WaveInOnRecordingStopped(object sender, StoppedEventArgs e) { if (this._WaveFileWriter != null) { this._WaveFileWriter.Close(); this._WaveFileWriter = null; }<br>if (this._Stream != null) { this._Stream.Close(); this._Stream = null; }<br>this.Dispose(); }<br>private void WaveInOnDataAvailable(object sender, WaveInEventArgs e) { this._WaveFileWriter.Write(e.Buffer, 0, e.BytesRecorded); this.DataAvailable?.Invoke(this, e); }<br>#endregion<br>#region ヘルパーメソッド #endregion<br>#endregion<br>#region IDisposable メンバー<br>public void Dispose() { this._WaveIn.DataAvailable -= this.WaveInOnDataAvailable; this._WaveIn.RecordingStopped -= this.WaveInOnRecordingStopped;<br>this._WaveIn?.Dispose(); this._WaveFileWriter?.Dispose(); this._Stream?.Dispose(); }<br>#endregion<br>}<br>} [/code] コンストラクタが全ての重要なことを行っています。 <strong>WasapiLoopbackCapture</strong> は、WASAPI、つまり <strong>Windows Audio Session API</strong> のオーディオ処理をループバックさせキャプチャするためのクラスです。つまり、MMDeviceで指定したデバイスをキャプチャします。 WASAPI については、Wikipediaを見てください。といっても、日本語の記事は情報がないですが。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://ja.wikipedia.org/wiki/WASAPI" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ja.wikipedia.org"></img><div class="hbc-site-name">ja.wikipedia.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">WASAPI - Wikipedia</div><div class="hbc-url">https://ja.wikipedia.org/wiki/WASAPI</div></div></div></div></a></div></div><p>次は、<strong>DataAvailable</strong> イベントをサブスクライブします。 これは、キャプチャした生のバイトデータを処理できます。 このイベントでファイルへの出力を実行しています。 このファイルへの出力は、<strong>WaveFileWriter</strong> クラスが担っています。 今回は、同一ファイルが存在したら上書きする形でストリームを生成し、第一引数に渡しています。 第二引数は、出力する WAVE ファイルのフォーマットを指定します。 これは、ループバックからキャプチャされる形式と同一にしています。 あとは、任意のタイミングで、<strong>WasapiLoopbackCapture.StartRecording メソッド</strong>で録音を開始し、<strong>WasapiLoopbackCapture.StopRecording メソッド</strong>で録音を停止するだけです。</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>実行するアプリは、左側に出力デバイス一覧、右側には出力先ファイルを指定するテキストボックス、録音の開始ボタン、録音の停止ボタン、キャプチャデータのキャプチャタイミングのログを表示するリストから成り立っています。<br><a href="../../../../public/2017/03/550b56b8f5f914bdb0dfaf698267cdc7.png"><img src="../../../../public/2017/03/550b56b8f5f914bdb0dfaf698267cdc7-300x200.png"></a><br> ファイルを指定して、Startボタンを押下するとPCで再生される音声をファイルに書き出し始めます。 Stopを押下して録音を停止し、出力されたファイルをメディアプレイヤーで再生すると、録音された音声が再生されるのがわかるはずです。 また、録音中、音声データが細切れになってファイルに書き込まれていくことがログからわかります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>長くなりましたが、それなりに簡単にできました。 NAudio の音声処理の向き等、理解することは多いですが、基本さえつかめれば、入力データの加工等もできるのでしょう。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/NAudio1">https://github.com/takuya-takeuchi/Demo/tree/master/NAudio1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> マルチメディア </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> オープンソース </category>
          
          <category> .NETで音声処理を試してみる NAudio編 </category>
          
          <category> NAudio </category>
          
          <category> 音声処理 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その32 NLogで既存の設定を流用しファイルパスだけ動的に変更する</title>
      <link href="/2017/02/27/1797/"/>
      <url>/2017/02/27/1797/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><a href="http://wp.me/p7138e-sX">前回</a>はログの出力パスを動的に設定する方法を書きました。 ですが、あの方法は <strong>Variablesプロパティ</strong> に設定した値がロガー全体で共有されてしまいます。 私がやりたかったのは、ログの設定は同一の設定を使うがファイルパスだけ変更したい。ただし、ファイルパスは、プロセスやインスタンス毎に変更したい、という要求でした。 プロセスやインスタンスが常に一定であるならば、<strong>NLog.config</strong> に必要な数だけ設定を追加すれば済みますが、ファイルパスだけ異なるのに、似たような記述を増やすのは、面倒です。 ここでは、ロガー毎に<strong>Variablesプロパティ</strong>の値を独立して設定する方法を記します。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>まずは、<strong>NLog.config</strong>を変更します。 <script src="https://gist.github.com/takuya-takeuchi/6e2705884ee48064efc617c4c433b2db.js"></script> ここは<a href="http://wp.me/p7138e-sX">前回</a>と同じです。 次に、ソース部分です。 <script src="https://gist.github.com/takuya-takeuchi/494c7223ac78d74f771edd812774068c.js"></script> 前回と異なるのは、<strong>LogManager.GetLogger メソッド</strong>を使うのではなく、LogFactoryのインスタンスを自分で生成し、<strong>LogFactory.GetLogger メソッド</strong>を呼び出している箇所です。 <strong>logger.Factory プロパティ</strong>を見るとわかりますが、このプロパティは、<strong>LogFactory.GetLogger メソッド</strong>から取得している場合、常に同一の値を指すため、当然<strong>Configuration.Variables プロパティ</strong>の中身も一致してしまいます。 これにより、下記のように、Loggerのインスタンス毎に出力先を簡単に切り替えることができます。 <script src="https://gist.github.com/takuya-takeuchi/6ea9d0a91500fcd93f678bc6d62c15f4.js"></script></p>]]></content>
      
      
      <categories>
          
          <category> Logging </category>
          
          <category> logging </category>
          
          <category> NLog </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その31 NLogで動的にファイル名を設定する</title>
      <link href="/2017/02/26/1795/"/>
      <url>/2017/02/26/1795/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>NLogは動的にファイル名を設定する機能があります。 ここでは、ファイルパスを設定するプレースホルダーを解析するのではなく、独自のプレースホルダーを設定し、そのプレースホルダーに任意のテキストを設定する方法でファイル名を変更します。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>まずは、<strong>NLog.config</strong>を変更します。 <script src="https://gist.github.com/takuya-takeuchi/28f92cceb888c666248e5db3a0c18b1f.js"></script> 上記の <strong>${var:runtime}</strong> に注目です。 ここが、プログラム実行中に変化する部分です。<strong>runtime</strong> の部分は任意の文字列を設定できます。 次に、ソース部分です。 <script src="https://gist.github.com/takuya-takeuchi/4af743eda971f9dd2b117d892bd8852c.js"></script> <strong>Variablesプロパティ</strong>に、先ほどの runtime をキーにして、任意の値を設定しています。 そして、設定を反映させるために、<strong>ReconfigExistingLoggers メソッド</strong>を呼び出しています。 以上で、出力先の実際のパスが <strong>実行フォルダのパス\Logs\test\yyyyMMdd.log</strong> というログとして解釈されるようになります。</p>]]></content>
      
      
      <categories>
          
          <category> Logging </category>
          
          <category> logging </category>
          
          <category> NLog </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでPythonを試してみる 第2回</title>
      <link href="/2017/02/13/1786/"/>
      <url>/2017/02/13/1786/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-sF">前回</a>は簡単な関数を呼び出してみました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>今回の目的は、引数を渡し、その戻りを表示します。<br>ただ、単純に文字列や数値を渡すのは面白くありません。<br>今回は配列を渡して、配列を返します。<br>なんと言っても、Pythonは配列、リスト、タップルの操作を得意としており、またそれらを操作するライブラリが豊富です。<br>すなわち、配列をPythonで処理させ、その結果をC#で受け取ることができれば、より実践的なアプリが作成できます。<br>今回は、2つの数値を指定し、その数値を数列の先頭、末尾として扱い、差が1の階差数列を生成します。<br>その階差数列をPythonに渡し、各要素を2倍にした配列をC#に返し、最終的に配列内の要素の総和を返すアプリです。<br>例えば、1、10を指定すれば、1,2,…9,10が生成され、最終的な値は55*2の110と表示されます。<br>今回のソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python2" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python2</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Python側"><a href="#Python側" class="headerlink" title="Python側"></a>Python側</h1><p>Python側のプロジェクトを作成します。<br>Pythonのソースは下記になります。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PythonTest</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twice</span>(<span class="params">selt, array</span>):</span></span><br><span class="line">        list = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(array))]</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> array:</span><br><span class="line">            list[i] = x * <span class="number">2</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> list;</span><br></pre></td></tr></table></figure><p>Pythonの文法をかなり忘れているので、ググりながら作成しました。情けない。<br>まず、list変数は、引数に渡ってきた配列arrayの長さの個数を持ち、かつ各要素は0で初期化されます。<br>次に、渡ってきた配列arrayをループで各要素、つまりxにアクセス、そのxを2倍にし、先頭から順にlistに格納します。<br>そして、listを返します。</p><h1 id="C-側"><a href="#C-側" class="headerlink" title="C#側"></a>C#側</h1><p>今回もWPFです。Xaml側は省略します。<br>数列の開始数値と終了数値を入力できるTextBox、結果を表示するメッセージボックスを表示するボタンだけです。<br>IronPythonの参照方法、<strong>Microsoft.Scripting.Hosting.ScriptRuntime 型</strong>、<strong>IronPython.Hosting.Python.CreateRuntime メソッド</strong>、<strong>UseFile メソッド</strong>の説明は前回の記事を参照してください。<br>今回は、Pythonと配列をやりとりする箇所のみ説明します。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> RelayCommand MessageCommand</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._MessageCommand ?? <span class="keyword">new</span> RelayCommand(() =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> array = Enumerable.Range(<span class="keyword">this</span>._Start, <span class="keyword">this</span>._End - <span class="keyword">this</span>._Start + <span class="number">1</span>).ToArray();</span><br><span class="line">            <span class="keyword">var</span> sum = array.Sum();</span><br><span class="line">            <span class="keyword">var</span> list = <span class="keyword">this</span>._PythonWrapper.Twice(array);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> message = <span class="string">$&quot;Initial total:<span class="subst">&#123;sum&#125;</span>, final total:<span class="subst">&#123;list.Sum()&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">this</span>._MessageDialog.ShowMessage(message);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>_PythonWrapper.Twiceが今回、Pythonスクリプトの関数を呼び出します。<br>arrayはint[]です。<br>そしてlistもint[]です。<br>では、PythonWrapperの中身です。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Scripting.Hosting;</span><br><span class="line"><span class="keyword">using</span> WPFPython2.ViewModels.Interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython2.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">PythonWrapper</span> : <span class="title">IPythonWrapper</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> フィールド</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ScriptRuntime _ScriptRuntime;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">dynamic</span> _PythonObject;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">dynamic</span> _PythonTest;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">string</span> _Path;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> コンストラクタ</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PythonWrapper</span>(<span class="params">ScriptRuntime scriptRuntime, <span class="keyword">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (scriptRuntime == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(scriptRuntime));</span><br><span class="line">            <span class="keyword">if</span> (path == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(path));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._ScriptRuntime = scriptRuntime;</span><br><span class="line">            <span class="keyword">this</span>._Path = path;</span><br><span class="line">            <span class="keyword">this</span>._PythonObject = <span class="keyword">this</span>._ScriptRuntime.UseFile(<span class="keyword">this</span>._Path);</span><br><span class="line">            <span class="keyword">this</span>._PythonTest = <span class="keyword">this</span>._PythonObject.PythonTest();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> メソッド</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">Twice</span>(<span class="params"><span class="keyword">int</span>[] array</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> list = <span class="keyword">this</span>._PythonTest.twice(array);</span><br><span class="line">            <span class="keyword">return</span> ((IList&lt;<span class="keyword">object</span>&gt;)list).Cast&lt;<span class="keyword">int</span>&gt;().ToArray();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>コンストラクタは前回と同じです。Twiceメソッドだけが肝です。<br>まず、普通にint[]をPython側に渡しています。<br>しかし、戻ってきたlist変数はそのまま返すことはできません。<br>この変数の正確な型は、<strong>IronPython.Runtime.List</strong> という型です。<br>この変数を <strong>GetType().GetMembers()</strong> するとわかるのですが、 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">Void set_Item(IronPython.Runtime.Slice, System.Object)</span><br><span class="line">Void set_Item(Int32, System.Object)</span><br><span class="line">Void set_Item(System.Numerics.BigInteger, System.Object)</span><br><span class="line">Void set_Item(System.Object, System.Object)</span><br><span class="line">Void __init__()</span><br><span class="line">Void __init__(System.Collections.IEnumerable)</span><br><span class="line">Void __init__(System.Collections.ICollection)</span><br><span class="line">Void __init__(IronPython.Runtime.SetCollection)</span><br><span class="line">Void __init__(IronPython.Runtime.FrozenSetCollection)</span><br><span class="line">Void __init__(IronPython.Runtime.List)</span><br><span class="line">Void __init__(System.String)</span><br><span class="line">Void __init__(IronPython.Runtime.CodeContext, System.Object)</span><br><span class="line">System.Object __new__(IronPython.Runtime.CodeContext, IronPython.Runtime.Types.PythonType)</span><br><span class="line">System.Object __new__(IronPython.Runtime.CodeContext, IronPython.Runtime.Types.PythonType, System.Object)</span><br><span class="line">System.Object __new__(IronPython.Runtime.CodeContext, IronPython.Runtime.Types.PythonType, System.Object[])</span><br><span class="line">System.Object __new__(IronPython.Runtime.CodeContext, IronPython.Runtime.Types.PythonType, System.Collections.Generic.IDictionary&#96;2[System.Object,System.Object], System.Object[])</span><br><span class="line">IronPython.Runtime.List op_Addition(IronPython.Runtime.List, IronPython.Runtime.List)</span><br><span class="line">IronPython.Runtime.List op_Multiply(IronPython.Runtime.List, Int32)</span><br><span class="line">IronPython.Runtime.List op_Multiply(Int32, IronPython.Runtime.List)</span><br><span class="line">System.Object op_Multiply(IronPython.Runtime.List, IronPython.Runtime.Index)</span><br><span class="line">System.Object op_Multiply(IronPython.Runtime.Index, IronPython.Runtime.List)</span><br><span class="line">System.Object op_Multiply(IronPython.Runtime.List, System.Object)</span><br><span class="line">System.Object op_Multiply(System.Object, IronPython.Runtime.List)</span><br><span class="line">Int32 __len__()</span><br><span class="line">System.Collections.IEnumerator __iter__()</span><br><span class="line">System.Collections.IEnumerator __reversed__()</span><br><span class="line">Boolean __contains__(System.Object)</span><br><span class="line">System.Object InPlaceAdd(System.Object)</span><br><span class="line">IronPython.Runtime.List InPlaceMultiply(Int32)</span><br><span class="line">System.Object InPlaceMultiply(IronPython.Runtime.Index)</span><br><span class="line">System.Object InPlaceMultiply(System.Object)</span><br><span class="line">System.Object __getslice__(Int32, Int32)</span><br><span class="line">Void __setslice__(Int32, Int32, System.Object)</span><br><span class="line">Void __delslice__(Int32, Int32)</span><br><span class="line">System.Object get_Item(IronPython.Runtime.Slice)</span><br><span class="line">Void __delitem__(Int32)</span><br><span class="line">Void __delitem__(System.Object)</span><br><span class="line">Void __delitem__(IronPython.Runtime.Slice)</span><br><span class="line">Void append(System.Object)</span><br><span class="line">Int32 count(System.Object)</span><br><span class="line">Void extend(IronPython.Runtime.List)</span><br><span class="line">Void extend(IronPython.Runtime.PythonTuple)</span><br><span class="line">Void extend(System.Object)</span><br><span class="line">Int32 index(System.Object)</span><br><span class="line">Int32 index(System.Object, Int32)</span><br><span class="line">Int32 index(System.Object, Int32, Int32)</span><br><span class="line">Int32 index(System.Object, System.Object)</span><br><span class="line">Int32 index(System.Object, System.Object, System.Object)</span><br><span class="line">Void insert(Int32, System.Object)</span><br><span class="line">Void Insert(Int32, System.Object)</span><br><span class="line">System.Object pop()</span><br><span class="line">System.Object pop(Int32)</span><br><span class="line">Void remove(System.Object)</span><br><span class="line">Void reverse()</span><br><span class="line">Void sort(IronPython.Runtime.CodeContext)</span><br><span class="line">Void sort(IronPython.Runtime.CodeContext, System.Object)</span><br><span class="line">Void sort(IronPython.Runtime.CodeContext, System.Object, System.Object)</span><br><span class="line">Void sort(IronPython.Runtime.CodeContext, System.Object, System.Object, Boolean)</span><br><span class="line">System.Object get_Item(Int32)</span><br><span class="line">System.Object get_Item(System.Numerics.BigInteger)</span><br><span class="line">System.Object get_Item(System.Object)</span><br><span class="line">Void RemoveAt(Int32)</span><br><span class="line">Boolean Contains(System.Object)</span><br><span class="line">Void Clear()</span><br><span class="line">Int32 IndexOf(System.Object)</span><br><span class="line">Int32 Add(System.Object)</span><br><span class="line">Int32 get_Count()</span><br><span class="line">Void CopyTo(System.Array, Int32)</span><br><span class="line">System.Collections.IEnumerator GetEnumerator()</span><br><span class="line">System.String __repr__(IronPython.Runtime.CodeContext)</span><br><span class="line">Void CopyTo(System.Object[], Int32)</span><br><span class="line">Boolean Remove(System.Object)</span><br><span class="line">System.Object op_GreaterThan(IronPython.Runtime.List, System.Object)</span><br><span class="line">System.Object op_LessThan(IronPython.Runtime.List, System.Object)</span><br><span class="line">System.Object op_GreaterThanOrEqual(IronPython.Runtime.List, System.Object)</span><br><span class="line">System.Object op_LessThanOrEqual(IronPython.Runtime.List, System.Object)</span><br><span class="line">System.String ToString()</span><br><span class="line">Boolean Equals(System.Object)</span><br><span class="line">Int32 GetHashCode()</span><br><span class="line">System.Type GetType()</span><br><span class="line">Void .ctor()</span><br><span class="line">System.Object Item [IronPython.Runtime.Slice]</span><br><span class="line">System.Object Item [Int32]</span><br><span class="line">System.Object Item [System.Numerics.BigInteger]</span><br><span class="line">System.Object Item [System.Object]</span><br><span class="line">Int32 Count</span><br><span class="line">System.Object __hash__</span><br></pre></td></tr></table></figure><p>ところどころ、Pythonで提供している関数名が見つかります。また、Int32 Countやインデクサがあることから、System.Collections.IListを実装していそうなことはわかります。<br>実際にキャストもできます。<br>ですが、Pythonでは型はあってないようなものですし、要素の型がわからないため、明示的にキャストして呼び出し元に返しています。<br>キャストこそ面倒ですが、配列を渡す、呼び出すことに全く問題はありません。</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>実際に実行してみます。<br>サンプルソースをビルドすると実行ディレクトリに、pythonsフォルダが生成され、<strong>Python2.py</strong>ファイルがコピーされます。<br>このファイルはPythonプロジェクトのファイルそのものです。<br>実行するとButtonが1つとTextBoxが2つ。。</p><p><a href="../../../../public/2017/02/2f18568491823fb77999e5278edfd49f.png"><img src="../../../../public/2017/02/2f18568491823fb77999e5278edfd49f.png"></a></p><p>ボタンを押すと、Python2.pyのtwiceの戻りの内容の総和が表示されます。</p><p><a href="../../../../public/2017/02/b797a53aff385fe3fc1e790f3515fd10.png"><img src="../../../../public/2017/02/b797a53aff385fe3fc1e790f3515fd10.png"></a></p><p>アプリを終了し、Python2.pyのtwice関数内の、2倍の部分を3に変更したりすれば、今回も内容が変わることがわかります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回も簡単に実行できました。<br>異なる言語間のやりとりで面倒なことの筆頭は配列の扱いだと思います。例えば、C#とC/C++におけるポインタとか。<br>しかし、そんな面倒なところを感じさせないところは、Pythonがグルー言語と言われるところでしょう。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python2">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python2</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> Python </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Windows Presentation Foundation </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> python-2 </category>
          
          <category> .NETでPythonを試してみる </category>
          
          <category> IronPython </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでPythonを試してみる 第1回</title>
      <link href="/2017/02/13/1777/"/>
      <url>/2017/02/13/1777/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-st">前回</a>は下準備でした。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>今回の目的は、WPFからPythonスクリプト、つまり**.py<strong>ファイルを呼び出します。<br>また、WPFなので、MVVMを使います。MVVMフレームワークは **MVVM Light Toolkit</strong> ですが、そのあたりは自由に適宜選択してください。<br>ソースは下記になります </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Python側"><a href="#Python側" class="headerlink" title="Python側"></a>Python側</h1><p>Python側のプロジェクトを作成します。<br>と言っても、Python側はソースを管理し、コーディングの際にインテリセンスを有効にするためだけで、C#側から直接プロジェクトを参照するというわけではありません。<br>Pythonのプロジェクトは、<strong>Python Tools for Visual Studio</strong>をインストールした上で、ソリューションに対してプロジェクトを追加する際、下記のテンプレートを選択します。</p><p><a href="../../../../public/2017/02/bb8a5a21d0fcc4492415c1f43f23d530.png"><img src="../../../../public/2017/02/bb8a5a21d0fcc4492415c1f43f23d530-300x207.png"></a></p><p>追加したプロジェクトには、<strong>python1.py</strong>だけが存在します。<br>エクスプローラ上には、<strong>Python1.pyproj</strong>と<strong>python1.py</strong>というシンプル構成です。<br>次に、Pythonのソースを。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PythonTest</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">showMessage</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello world from Python&quot;</span></span><br></pre></td></tr></table></figure><p>PythonTestというクラスが、showMessageというメソッドを持っているだけです。<br>目的は、C#側から、このメソッドを呼び出すことです。<br>つまり、クラスのインスタンス化、クラスメソッドの呼び出し、戻り値の表示、という3つの基礎的な題材をテストできます。</p><h1 id="C-側"><a href="#C-側" class="headerlink" title="C#側"></a>C#側</h1><p>いつも通り、簡単にMVVMを使用して簡単なプロジェクトを作成します。<br>今回はボタンを押すと、メッセージボックスが表示され、pythonスクリプトに書かれた、つまりshowMessageメソッドの戻りの値が表示されるというアプリケーションになります。<br>Xaml側は省略します。<br>最初に、IronPythonを利用するために、参照を追加します。<br><strong>C:\Program Files (x86)\IronPython 2.7\Platforms</strong> に <strong>Net35</strong>、<strong>Net40</strong>、<strong>Sl5</strong> というフォルダが存在します。<br>それらのうちの一つを選び配下から、<strong>IronPython.dll</strong>、<strong>Microsoft.Scripting.dll</strong>、<strong>Microsoft.Dynamic.dll</strong> をプロジェクトに追加します。<br>これでプロジェクトの設定は終了です。<br>次に、Pythonを呼び出す側のコードです。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython1.ViewModels.Interfaces</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IPythonWrapper</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">string</span> <span class="title">ShowMessage</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Scripting.Hosting;</span><br><span class="line"><span class="keyword">using</span> WPFPython1.ViewModels.Interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython1.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">PythonWrapper</span> : <span class="title">IPythonWrapper</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> フィールド</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ScriptRuntime _ScriptRuntime;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">dynamic</span> _PythonObject;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">dynamic</span> _PythonTest;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">string</span> _Path;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> コンストラクタ</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PythonWrapper</span>(<span class="params">ScriptRuntime scriptRuntime, <span class="keyword">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (scriptRuntime == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(scriptRuntime));</span><br><span class="line">            <span class="keyword">if</span> (path == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(path));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._ScriptRuntime = scriptRuntime;</span><br><span class="line">            <span class="keyword">this</span>._Path = path;</span><br><span class="line">            <span class="keyword">this</span>._PythonObject = <span class="keyword">this</span>._ScriptRuntime.UseFile(<span class="keyword">this</span>._Path);</span><br><span class="line">            <span class="keyword">this</span>._PythonTest = <span class="keyword">this</span>._PythonObject.PythonTest();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> メソッド</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">ShowMessage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._PythonTest.showMessage();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ScriptRuntime 変数</strong>は、<strong>Microsoft.Scripting.Hosting.ScriptRuntime 型</strong>で、Pythonの実行環境を表します。<br>次のソースの <strong>IronPython.Hosting.Python.CreateRuntime メソッド</strong>の戻りでもあります。<br><strong>UseFile メソッド</strong>には呼び出したいPythonファイルを指定します。戻りを <strong>dynamic 型</strong>にして、メンバ変数に格納します。<br><strong>_PythonObject メンバ変数</strong>から <strong>PythonTest クラス</strong>をインスタンス化して、<strong>_PythonTest メンバ変数</strong>に格納します。</p><p>そして、ShowMessage メソッドで、pythonの <strong>showMessage 関数</strong>を呼び出します。<br>dynamic型なので、コンパイル時にエラーは解決できませんので、記述が間違っていてもエラーになりませんので注意が必要です。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight;</span><br><span class="line"><span class="keyword">using</span> GalaSoft.MvvmLight.Ioc;</span><br><span class="line"><span class="keyword">using</span> IronPython.Hosting;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Practices.ServiceLocation;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Scripting.Hosting;</span><br><span class="line"><span class="keyword">using</span> WPFPython1.ViewModels;</span><br><span class="line"><span class="keyword">using</span> WPFPython1.ViewModels.Interfaces;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WPFPython1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> This class contains static references to all the view models in the</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> application and provides an entry point for the bindings.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;para&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> See http://www.galasoft.ch/mvvm</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/para&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ViewModelLocator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="title">ViewModelLocator</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            ServiceLocator.SetLocatorProvider(() =&gt; SimpleIoc.Default);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ViewModelBase.IsInDesignModeStatic)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// SimpleIoc.Default.Register&lt;IDataService, Design.DesignDataService&gt;();</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// SimpleIoc.Default.Register&lt;IDataService, DataService&gt;();</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SimpleIoc.Default.Register&lt;IMessageDialog&gt;(() =&gt; <span class="keyword">new</span> MessageDialog(Application.Current.MainWindow));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> py = Python.CreateRuntime();</span><br><span class="line">            SimpleIoc.Default.Register&lt;IPythonWrapper&gt;(()=&gt; <span class="keyword">new</span> PythonWrapper(py, <span class="string">@&quot;pythons\Python1.py&quot;</span>));</span><br><span class="line">            SimpleIoc.Default.Register&lt;IMainViewModel, MainViewModel&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Gets the Main property.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">System.Diagnostics.CodeAnalysis.SuppressMessage(<span class="meta-string">&quot;Microsoft.Performance&quot;</span>,</span></span><br><span class="line"><span class="meta">            <span class="meta-string">&quot;CA1822:MarkMembersAsStatic&quot;</span>,</span></span><br><span class="line"><span class="meta">            Justification = <span class="meta-string">&quot;This non-static member is needed for data binding purposes.&quot;</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> IMainViewModel Main</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> ServiceLocator.Current.GetInstance&lt;IMainViewModel&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>見たままです。<br>ScriptRuntimeを生成し、実行したいPythonスクリプトをパス指定しているだけです。<br>MessageDialogは単純に <strong>System.Windows.MessageBox.Show メソッド</strong>を呼ぶためだけのinterfaceです。</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>実際に実行してみます。<br>サンプルソースをビルドすると実行ディレクトリに、pythonsフォルダが生成され、<strong>Python1.py</strong>ファイルがコピーされます。<br>このファイルはPythonプロジェクトのファイルそのものです。<br>実行するとボタンが一つ。</p><p><a href="../../../../public/2017/02/5686f2a0827b903d38955a1c956295f7.png"><img src="../../../../public/2017/02/5686f2a0827b903d38955a1c956295f7-300x186.png"></a></p><p>ボタンを押すと、Python1.pyのshowMessageの戻りの内容が表示されます。</p><p><a href="../../../../public/2017/02/ca0bd229563208221d0d5897057a48f2.png"><img src="../../../../public/2017/02/ca0bd229563208221d0d5897057a48f2.png"></a></p><p>アプリを終了し、Python1.pyのshowMessage の内容を書き換え、再度実行するとメッセージの内容が書き換わっているのがわかります。</p><p><a href="../../../../public/2017/02/603886d29b4ebbf98af1a05e3c8e9ca7.png"><img src="../../../../public/2017/02/603886d29b4ebbf98af1a05e3c8e9ca7.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>簡単に実行できました。<br>Pythonの実行処理を分離したので、I/Fさえ維持すれば、呼び出す対象のライブラリをPythonからC++にする！！とかいう選択も可能になるでしょう。<br>このあたり、MVVMできちんと分離してあるのが良い感じです。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python1">https://github.com/takuya-takeuchi/Demo/tree/master/WPF.Python1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> Python </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> Windows Presentation Foundation </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> python-2 </category>
          
          <category> .NETでPythonを試してみる </category>
          
          <category> IronPython </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでPythonを試してみる 第0回</title>
      <link href="/2017/02/13/1765/"/>
      <url>/2017/02/13/1765/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>仕事でPythonを使う機会が再び訪れ、そのPythonをGUIから使えたらいいなぁ、って感じで調べたら<strong>IronPython</strong>があることを思い出して、実際に試してみようと思ったのがきっかけ。 IronPythonについてはWikipediaで調べてください。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://ja.wikipedia.org/wiki/IronPython" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ja.wikipedia.org"></img><div class="hbc-site-name">ja.wikipedia.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">IronPython - Wikipedia</div><div class="hbc-url">https://ja.wikipedia.org/wiki/IronPython</div></div></div></div></a></div></div><p>で、確かにIronPythonを使っている記事は各所にあるのですが、大抵はコンソールアプリで味気なく、実務に即していない。 なので、WPFから使ってみようというのが目的です。</p><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>何はともあれ、IronPythonのインストールです。 公式サイトからダウンロードしてインストールするだけです。 なお、Pythonのインストールは既に完了しているものとします。 Python環境の構築は<a href="http://wp.me/p7138e-m8">ディープラーニング Caffe for Windows その1 環境構築</a>を参考にしてください。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://ironpython.net/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ironpython.net"></img><div class="hbc-site-name">ironpython.net</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">IronPython.net / </div><div class="hbc-url">http://ironpython.net/</div></div></div></div></a></div></div><p>公式サイトにアクセスすると、<strong>Download Python 2.7</strong> とあるので、クリックすると github のページ飛ぶので、zip か msi ファイルをダウンロードします。<br><a href="../../../../public/2017/02/screencapture-ironpython-net-1486911382563.png"><img src="../../../../public/2017/02/screencapture-ironpython-net-1486911382563-1024x416.png"></a></p><p>今回は下記のようにmsiを使ってインストールします。 インストール自体は、ウィザードに従っていくだけです。<br><a href="../../../../public/2017/02/b8bcd77b3be586509c2b6d74a66d0c13.png"><img src="../../../../public/2017/02/b8bcd77b3be586509c2b6d74a66d0c13.png"></a></p><p><a href="../../../../public/2017/02/b81a9b50f24a78edc563e1d46932ae74.png"><img src="../../../../public/2017/02/b81a9b50f24a78edc563e1d46932ae74.png"></a></p><p><a href="../../../../public/2017/02/948e17965a90a7a2300f60f0b740e73d.png"><img src="../../../../public/2017/02/948e17965a90a7a2300f60f0b740e73d.png"></a></p><p><a href="../../../../public/2017/02/827fc6dc9a130067b2281a40e582d35b.png"><img src="../../../../public/2017/02/827fc6dc9a130067b2281a40e582d35b.png"></a></p><p><a href="../../../../public/2017/02/0c15ffc277b617632a37cd7eac720e2f.png"><img src="../../../../public/2017/02/0c15ffc277b617632a37cd7eac720e2f.png"></a></p><p><a href="../../../../public/2017/02/b09a006b0bb8da92ded603c96a10e738.png"><img src="../../../../public/2017/02/b09a006b0bb8da92ded603c96a10e738.png"></a></p><p><a href="../../../../public/2017/02/151633eb8118d6e5b711b0c9c38c456a.png"><img src="../../../../public/2017/02/151633eb8118d6e5b711b0c9c38c456a.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まずは下準備が終わりました。 次回は実際にWPFからPythonスクリプトを呼び出してみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> net-framework </category>
          
          <category> Python </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> python-2 </category>
          
          <category> .NETでPythonを試してみる </category>
          
          <category> IronPython </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その30 LoggerServiceを実装する</title>
      <link href="/2017/01/22/1760/"/>
      <url>/2017/01/22/1760/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>世の中にロギングライブラリはたくさんあります。有名どころでは <a href="https://logging.apache.org/log4net/">log4net</a>, <a href="http://nlog-project.org/">NLog</a> とかです。 単純にこれらのロギングライブラリをアプリにリンクすると、万が一ロギングライブラリに問題が生じたり、ログの出力先をWebServiceに投げたい、とかなったらログ出力を記述している個所を全部書き換える必要があります。 (NLogはWebServiceとかDatabaseへ出力することもできますが…) なので、これらのライブラリとの依存性を減らすべく、ラップするなりします。ましてや、Dependency Injectionならなおさらです。 でも、ここで気づきます。</p><h3 id="あれ？ログに出力される呼び出し元メソッド名が全部ラッパーになる＼-o-／"><a href="#あれ？ログに出力される呼び出し元メソッド名が全部ラッパーになる＼-o-／" class="headerlink" title="あれ？ログに出力される呼び出し元メソッド名が全部ラッパーになる＼(^o^)／"></a>あれ？ログに出力される呼び出し元メソッド名が全部ラッパーになる＼(^o^)／</h3><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>幸いにして、log4net、NLogともに解決策があります。 問題は、ログ出力メソッドの呼び出し元を正しく出力することです。 通常は、各ライブラリのメソッドをダイレクトに呼び出しているメソッドのクラスが基点になります。 ですが、ラッパーをかましている場合は、ライブラリのログ出力メソッドを呼び出している箇所との間にラッパーが存在します。</p><h4 id="NLogの場合"><a href="#NLogの場合" class="headerlink" title="NLogの場合"></a>NLogの場合</h4><p>[code lang=”csharp”] public interface ILogService {<br>void Info(string message);<br>void Info(Exception exception, IFormatProvider formatProvider, string message);<br>}<br>public interface ILogFactoryService {<br>ILogService Create();<br>ILogService Create(string name);<br>}<br>public sealed class NLogLogService : ILogService {<br>#region フィールド<br>private readonly Logger _Logger;<br>#endregion<br>#region コンストラクタ<br>internal NLogLogService(Logger logger) { this._Logger = logger; }<br>#endregion<br>#region メソッド<br>private void Write(LogLevel logLevel, string message) { this._Logger.Log(typeof(NLogLogService), LogEventInfo.Create(logLevel, this._Logger.Name, message)); }<br>private void Write(LogLevel logLevel, Exception exception, IFormatProvider formatProvider, string message) { this._Logger.Log(typeof(NLogLogService), LogEventInfo.Create(logLevel, this._Logger.Name, exception, formatProvider, message)); }<br>#endregion<br>#region ILogService メンバー<br>public void Info(string message) { this.Write(LogLevel.Info, message); }<br>public void Info(Exception exception, IFormatProvider formatProvider, string message) { this.Write(LogLevel.Info, exception, formatProvider, message); }<br>#endregion<br>}<br>public sealed class NLogLogFactoryService : ILogFactoryService {<br>#region ILogFactoryService メンバー<br>public ILogService Create() { return new NLogLogService(LogManager.GetCurrentClassLogger()); }<br>public ILogService Create(string name) { return new NLogLogService(LogManager.GetLogger(name)); }<br>#endregion<br>} [/code] 上がラッパーになります。 ポイントは、<strong>Logメソッド</strong>になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://nlog-project.org/documentation/v2.0.1/html/M_NLog_Logger_Log_35.htm" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=nlog-project.org"></img><div class="hbc-site-name">nlog-project.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Log Method (, LogEventInfo)</div><div class="hbc-url">http://nlog-project.org/documentation/v2.0.1/html/M_NLog_Logger_Log_35.htm</div></div></div></div></a></div></div><p>第一引数にラッパークラスの型を渡します。これにより、呼び出し元のメソッドを本来の意図した場所に訂正できます。 スタックトレースを辿っていき、第一引数に渡したクラスの直前の箇所を呼び出し元として判定しているのでしょう。 使い方は下記のようになります。 [code lang=”csharp”] public sealed class TestService {<br>#region フィールド<br>private readonly ILogService _LogService;<br>#endregion<br>#region コンストラクタ<br>public TestService(ILogFactoryService logFactoryService) { this._LogService = logFactoryService.Create(“MainLogger”); }<br>#endregion<br>#region メソッド<br>public void Test() { this._LogService.Info(“Test start”); }<br>#endregion<br>} [/code] ログを出力したいクラスのコンストラクタでILogFactoryService.Createメソッドを呼び出し、ILogServiceを生成します。 実際には内部でNLogのロガーが生成されていますが、それらを隠蔽しています。</p><h4 id="log4net"><a href="#log4net" class="headerlink" title="log4net"></a>log4net</h4><p>同じように、Logメソッドでラッパーを指定します。 詳細は下記を参照。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://logging.apache.org/log4net/release/sdk/html/M_log4net_Repository_Hierarchy_Logger_Log_2.htm" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=logging.apache.org"></img><div class="hbc-site-name">logging.apache.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Logger.Log Method (Type, Level, Object, Exception)</div><div class="hbc-url">http://logging.apache.org/log4net/release/sdk/html/M_log4net_Repository_Hierarchy_Logger_Log_2.htm</div></div></div></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> Logging </category>
          
          <category> logging </category>
          
          <category> log4net </category>
          
          <category> NLog </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで画像処理を試してみる OpenCVSharp編 第5回</title>
      <link href="/2017/01/18/1753/"/>
      <url>/2017/01/18/1753/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-rQ">前回</a>は3.Xへの更新について説明を行いました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>現状の.NETのUIといえば、UWPがメインに据えられ(Microsoft的な意味で)、WPFが微妙な立ち位置になり、WinFormsがレガシーとなっていますが、UI以外の面では System.Drawing 名前空間は、GDIという太古からのレガシーを受け継いでいたため、WPFでは互換性維持程度のAPIサポートしかなくなりました。 でも、いつ解放されるかわからない <strong>System.Windows.Media.Imaging.BitmapSource</strong> よりも、<strong>System.IDisposable</strong> を実装している <strong>System.Drawing.Bitmap</strong> のが、メモリ管理という点では管理しやすいのは事実です。 なので、Bitmapを使っている既存ライブラリを活用するため、BitmapSourceから、あるいはその逆変換を行う必要は結構あると思います。 そういう事情を反映してか、OpenCVSharpも便利な拡張メソッド <strong>BitmapSource OpenCvSharp.Extensions.ToBitmapSource</strong> を提供しています。 これはBitmapをBitmapSourceに変換する拡張メソッドですが、BitmapSourceに変換したいだけなら、ちょっと一手間加えるだけで、速度面で改善を加えることができます。 それは下記のソースになります。 [code lang=”csharp”] [System.Security.SuppressUnmanagedCodeSecurity] [DllImport(“gdi32.dll”, EntryPoint = “DeleteObject”)] [return: MarshalAs(UnmanagedType.Bool)] private static extern bool DeleteObject([In] IntPtr hObject);<br>private static BitmapSource ToBetterBitmapSource(Bitmap source) { var handle = source.GetHbitmap(); try { return Imaging.CreateBitmapSourceFromHBitmap( handle, IntPtr.Zero, Int32Rect.Empty, BitmapSizeOptions.FromEmptyOptions()); } finally { DeleteObject(handle); } } [/code] これを使って、OpenCVと比較しました。 以下サンプルソースです。 </p><p>[code lang=”csharp”] using System; using System.Collections.Generic; using System.Diagnostics; using System.Drawing; using System.Drawing.Imaging; using System.Linq; using System.Runtime.InteropServices; using System.Text; using System.Threading.Tasks; using System.Windows; using System.Windows.Interop; using System.Windows.Media.Imaging; using OpenCvSharp.Extensions;<br>namespace OpenCV4 {<br>class Program {<br>static void Main(string[] args) { const int width = 600; const int height = 400; const int repeat = 10000;<br>BitmapSource bitmapSource;<br>var sp = new Stopwatch(); sp.Start(); #if TRUE using (var bitmap = new Bitmap(width, height, PixelFormat.Format32bppArgb)) { Enumerable.Repeat(0, repeat).ToList().ForEach(i =&gt; { bitmapSource = bitmap.ToBitmapSource(); Console.WriteLine($”{bitmapSource}”); }); } #else using (var bitmap = new Bitmap(width, height, PixelFormat.Format32bppArgb)) { Enumerable.Repeat(0, repeat).ToList().ForEach(i =&gt; { bitmapSource = ToNativeBitmapSource(bitmap); Console.WriteLine($”{bitmapSource}”); }); } #endif sp.Stop(); Console.WriteLine($”Total: {sp.ElapsedMilliseconds} ms. Average: {sp.ElapsedMilliseconds/repeat} ms”); }<br>[System.Security.SuppressUnmanagedCodeSecurity] [DllImport(“gdi32.dll”, EntryPoint = “DeleteObject”)] [return: MarshalAs(UnmanagedType.Bool)] private static extern bool DeleteObject([In] IntPtr hObject);<br>private static BitmapSource ToNativeBitmapSource(Bitmap source) { var handle = source.GetHbitmap(); try { // フリーズされていない return Imaging.CreateBitmapSourceFromHBitmap( handle, IntPtr.Zero, Int32Rect.Empty, BitmapSizeOptions.FromEmptyOptions()); } finally { DeleteObject(handle); } }<br>}<br>} [/code] 600x400の32bit画像を10000回BitmapSourceに変換するだけです。 以下テスト結果です。 OpenCVSharp: Total: 55023 ms. Average: 5.5 ms better: Total: 16843 ms. Average: 1.6 ms 結果は圧勝です。 BitmapSourceにして、<strong>System.Windows.Controls.Image</strong> に表示したいだけなら、断然後者です。</p><h1 id="性能差の原因は"><a href="#性能差の原因は" class="headerlink" title="性能差の原因は?"></a>性能差の原因は?</h1><p>OpenCVSharpの<a href="https://github.com/shimat/opencvsharp/blob/master/src/OpenCvSharp.Extensions/BitmapSourceConverter.cs">ToBitmapSourceのソース</a>を見ればわかりますが、けっこう色々やっています。 [code lang=”csharp”] public static BitmapSource ToBitmapSource(this Bitmap src) { if (src == null) throw new ArgumentNullException(nameof(src));<br>if (Application.Current?.Dispatcher == null) { using (var memoryStream = new MemoryStream()) { src.Save(memoryStream, ImageFormat.Png); return CreateBitmapSourceFromBitmap(memoryStream); } }<br>try { using (var memoryStream = new MemoryStream()) { // You need to specify the image format to fill the stream. // I’m assuming it is PNG src.Save(memoryStream, ImageFormat.Png); memoryStream.Seek(0, SeekOrigin.Begin);<br>// Make sure to create the bitmap in the UI thread if (IsInvokeRequired()) return (BitmapSource)Application.Current.Dispatcher.Invoke( new Func&lt;Stream, BitmapSource&gt;(CreateBitmapSourceFromBitmap), DispatcherPriority.Normal, memoryStream);<br>return CreateBitmapSourceFromBitmap(memoryStream); } } catch (Exception) { return null; } }<br>private static BitmapSource CreateBitmapSourceFromBitmap(Stream stream) { var bitmapDecoder = BitmapDecoder.Create( stream, BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.OnLoad);<br>// This will disconnect the stream from the image completely… var writable = new WriteableBitmap(bitmapDecoder.Frames.Single()); writable.Freeze();<br>return writable; } [/code] ざっくりと説明すると、BitmapをMemoryStreamにSaveし、MemoryStreamからBitmapSourceを生成しています。 MemoryStreamへ保存している時点で全バイトデータのコピーが走るでしょうし、WritableBitmapSourceを作成するときも、MemoryStreamからメモリデータの転送が実行されるわけです。 そりゃ時間がかかるでしょう。CPUのキャッシュに乗る量なら良いですが、画像データのメモリコピーは(CPUからすれば)遅いです。 <strong>CreateBitmapSourceFromHBitmap</strong> もメモリのコピーはあるはずでしょう。 また、ToBitmapSourceは戻ってくるBitmapSourceが最初からFreezeされています。 なので、編集したい場合は使えないです。 こうすると、ToBitmapSourceを使うメリットが無いですねぇ..</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>性能が出ないとき、全てを疑うのは時間の無駄ですが、一番ボトルネックになりそう、っていう勘どころをつかめると楽ですね。 今回はそれが理由でパフォーマンスを調査したのが始まりでした。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/OpenCV4">https://github.com/takuya-takeuchi/Demo/tree/OpenCV4</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> OpenCV </category>
          
          <category> .NETで画像処理を試してみる OpenCVSharp編 </category>
          
          <category> OpenCvSharp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WPF メモ その3 VisualStateManagerとBehaviorの位置関係に注意</title>
      <link href="/2017/01/14/1748/"/>
      <url>/2017/01/14/1748/</url>
      
        <content type="html"><![CDATA[<h1 id="What-does-it-mean"><a href="#What-does-it-mean" class="headerlink" title="What does it mean?"></a>What does it mean?</h1><p>MVVMの場合、コードビハインドにロジックを書くことを厭い、Behaviorを使って、UIとロジックの分離を試みることも多いでしょう。 Behaviorの場合、<strong>System.Windows.Interactivity.Behavior</strong> を継承し、型パラメータは <strong>System.Windows.DependencyObject</strong> の派生型である <strong>System.Windows.FrameworkElement</strong> を指定することがほとんどです。少なくとも私は。 そのため、任意のプロパティのコールバックイベントで、引数に渡ってくる DependencyObject の AssociatedObject プロパティから、コールバックの呼び出し元を取り出します。 すなわち、<strong>Behaviorを追加した箇所</strong> の FrameworkElement です。 その後、<strong>System.Windows.VisualStateManager.GoToElementState</strong> メソッドで状態名を指定してUIの状態を変化させます。 ここまでは普通です。</p><h1 id="GoToElementState-does-Not-work"><a href="#GoToElementState-does-Not-work" class="headerlink" title="GoToElementState does Not work!!!"></a>GoToElementState does Not work!!!</h1><p>ところが、GoToElementStateがfalseを返すことがあります。 例外を返してくれるか、エラーコードが返るなら良いのですが、bool値を返されても原因がわかりません。 そもそも<a href="https://msdn.microsoft.com/ja-jp/library/system.windows.visualstatemanager.gotoelementstate(v=vs.110).aspx">MSDNのGoToElementStateの説明</a>でも</p><blockquote><p>true コントロールが正常に新しい状態に遷移した場合それ以外の場合、 falseです。</p></blockquote><p>という有様。不親切すぎる。</p><h1 id="VisualStateはありますか"><a href="#VisualStateはありますか" class="headerlink" title="VisualStateはありますか?"></a>VisualStateはありますか?</h1><p>ここで原因ですが、GoToElementStateの第一引数は、FrameworkElementです。つまり、状態を遷移させる対象となる要素になります。 失敗していたのは、VisualStateを定義していない位置にBehaviorを定義していたからです。 以下サンプルソースです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/develop/WPF3" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/develop/WPF3</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>[code lang=”xaml”] <Window x:Class="WPF3.Views.MainView" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:behaviors="clr-namespace:WPF3.Behaviors" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" Title="MainView" Width="525" Height="350" DataContext="{Binding Source={StaticResource Locator}, Path=Main}" mc:Ignorable="d"> &lt;i:Interaction.Behaviors&gt; &lt;behaviors:BooleanVisualStateBehavior x:Name=”State1Change” FalseState=”False1” State=”{Binding State1}” TrueState=”True1” /&gt; &lt;/i:Interaction.Behaviors&gt; <Grid><br>&lt;i:Interaction.Behaviors&gt; &lt;behaviors:BooleanVisualStateBehavior x:Name=”State2Change” FalseState=”False2” State=”{Binding State2}” TrueState=”True2” /&gt; &lt;/i:Interaction.Behaviors&gt;<br>&lt;Grid.ColumnDefinitions&gt; <ColumnDefinition Width="\*" /> <ColumnDefinition Width="Auto" /> &lt;/Grid.ColumnDefinitions&gt;<br><Rectangle x:Name="\_Rectangle" Margin="10" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Fill="Black" /><br><StackPanel Grid.Column="1" Margin="10"> <CheckBox Margin="0 5 0 0" Content="Switch State1" IsChecked="{Binding State1}" /> <CheckBox Margin="0 5 0 0" Content="Switch State2 (Fail)" IsChecked="{Binding State2}" /> </StackPanel> </Grid><br>&lt;VisualStateManager.VisualStateGroups&gt; <VisualStateGroup x:Name="State1"> <VisualState x:Name="True1"> <Storyboard> <ObjectAnimationUsingKeyFrames Storyboard.TargetName="\_Rectangle" Storyboard.TargetProperty="Fill"> <DiscreteObjectKeyFrame KeyTime="00:00:00"> &lt;DiscreteObjectKeyFrame.Value&gt; <SolidColorBrush>Red</SolidColorBrush> &lt;/DiscreteObjectKeyFrame.Value&gt; </DiscreteObjectKeyFrame> </ObjectAnimationUsingKeyFrames> </Storyboard> </VisualState> <VisualState x:Name="False1"> <Storyboard> <ObjectAnimationUsingKeyFrames Storyboard.TargetName="\_Rectangle" Storyboard.TargetProperty="Fill"> <DiscreteObjectKeyFrame KeyTime="00:00:00"> &lt;DiscreteObjectKeyFrame.Value&gt; <SolidColorBrush>Blue</SolidColorBrush> &lt;/DiscreteObjectKeyFrame.Value&gt; </DiscreteObjectKeyFrame> </ObjectAnimationUsingKeyFrames> </Storyboard> </VisualState> </VisualStateGroup> <VisualStateGroup x:Name="State2"> <VisualState x:Name="True2"> <Storyboard> <ObjectAnimationUsingKeyFrames Storyboard.TargetName="\_Rectangle" Storyboard.TargetProperty="Fill"> <DiscreteObjectKeyFrame KeyTime="00:00:00"> &lt;DiscreteObjectKeyFrame.Value&gt; <SolidColorBrush>DarkRed</SolidColorBrush> &lt;/DiscreteObjectKeyFrame.Value&gt; </DiscreteObjectKeyFrame> </ObjectAnimationUsingKeyFrames> </Storyboard> </VisualState> <VisualState x:Name="False2"> <Storyboard> <ObjectAnimationUsingKeyFrames Storyboard.TargetName="\_Rectangle" Storyboard.TargetProperty="Fill"> <DiscreteObjectKeyFrame KeyTime="00:00:00"> &lt;DiscreteObjectKeyFrame.Value&gt; <SolidColorBrush>DarkBlue</SolidColorBrush> &lt;/DiscreteObjectKeyFrame.Value&gt; </DiscreteObjectKeyFrame> </ObjectAnimationUsingKeyFrames> </Storyboard> </VisualState> </VisualStateGroup> &lt;/VisualStateManager.VisualStateGroups&gt; </Window> [/code] [code lang=”csharp”] using System.Windows; using System.Windows.Interactivity;<br>namespace WPF3.Behaviors {<br>public sealed class BooleanVisualStateBehavior : Behavior<FrameworkElement> {<br>public static readonly DependencyProperty StateProperty = DependencyProperty.RegisterAttached( “State”, typeof(bool), typeof(BooleanVisualStateBehavior), new PropertyMetadata(false, PropertyChangedCallback));<br>private static void PropertyChangedCallback(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var visualStateSettingBehavior = dependencyObject as BooleanVisualStateBehavior; if (visualStateSettingBehavior == null) { return; }<br>var state = visualStateSettingBehavior.State ? visualStateSettingBehavior.TrueState : visualStateSettingBehavior.FalseState; bool result; var frameworkElement = visualStateSettingBehavior.AssociatedObject; result = VisualStateManager.GoToElementState(frameworkElement, state, true); }<br>public bool State { get { return (bool)this.GetValue(StateProperty); } set { this.SetValue(StateProperty, value); } }<br>public string TrueState { get; set; }<br>public string FalseState { get; set; }<br>}<br>} [/code] BooleanVisualStateBehaviorは、依存関係プロパティであるStateをトリガーにして、TrueStateとFalseStateに指定した状態名への遷移を試みるBehaviorです。 このBehaviorがWindowとGridの直下に存在します。 これが問題で、Behaviorで渡ってくるFrameworkElementがWindowとGridになります。 つまり、WindowとGridの直下にあるVisualStateを操作しようにも、Gridの下にはVisualStateが定義されていないから何も起きないわけです。 ですので解決策は、 <strong>1. 2つめのBooleanVisualStateBehaviorであるState2Changeを1つめのBooleanVisualStateBehaviorであるState1Changeと同じ位置に持ってくる。</strong> つまり [code lang=”xaml”] &lt;i:Interaction.Behaviors&gt; &lt;behaviors:BooleanVisualStateBehavior x:Name=”State1Change” FalseState=”False1” State=”{Binding State1}” TrueState=”True1” /&gt; &lt;behaviors:BooleanVisualStateBehavior x:Name=”State2Change” FalseState=”False2” State=”{Binding State2}” TrueState=”True2” /&gt; &lt;/i:Interaction.Behaviors&gt; [/code] します。 または、 <strong>2. 2つめのVisualStateGroupであるState2をGridの下に移動する</strong> になります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>原因としては、非常に陳腐ですが、メソッドが動かない理由がわかりづらいため、解決に少し時間を取られました。 VisualStateは便利ですが、XAMLでの定義が間違ったりすると例外を投げるくせに、遷移で失敗しても例外を投げないなど、統一感が無くて困ります。 まぁ、一番悪いのは自分ですがね。なんで、Behaviorをルール要素では無く、ネストした要素の下に書いたんですかねぇ。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/WPF3">https://github.com/takuya-takeuchi/Demo/tree/WPF3</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その29 &#39;PropertyArrayStart&#39; のタグは、テンプレート セクションでサポートされていません。</title>
      <link href="/2017/01/12/1743/"/>
      <url>/2017/01/12/1743/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>タイトルが意味不明ですが、現象としては、DataTemplateで2次元配列の依存関係プロパティにBindingしてビルドしたら発生したエラー。 どうもこのエラー、2017年1月現在、日本語圏で誰一人として遭遇している人がいない模様。 <strong>PropertyArrayStart</strong> というワードを日本語検索しても件数0。 ちなみに、英語だと <strong>Tags of type ‘PropertyArrayStart’ are not supported in template sections</strong> になります。</p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>Stackoverflowで同じ問題に遭遇した人がいました。 凄いね、Stackoverflow! </p><p>解決策としては、IListに変更すれば、最小のコード変更で解決できるよ、とのこと。 でも、2次元としてデータを扱いたいため、どこでデータの区切りがあるかわからないので、この手法は不可。 なので、ラッパークラスを作って回避。 幅と高さを別にBindingして、IListを渡しても良いのですが、どのBindingが先に実行されるかわからないのと、一つのプロパティで解決したいのでこうなりました。 余談ですが、この問題、Microsoft Connect にあがっていましたが、最終的に<strong>修正しない</strong>になりました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://connect.microsoft.com/VisualStudio/feedback/details/1029028/error-when-trying-to-set-a-dependencyproperty-whose-propertytype-is-an-array-within-a-datatemplate" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=connect.microsoft.com"></img><div class="hbc-site-name">connect.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">Microsoft Connect is Retired - Collaborate</div><div class="hbc-url">https://connect.microsoft.com/VisualStudio/feedback/details/1029028/error-when-trying-to-set-a-dependencyproperty-whose-propertytype-is-an-array-within-a-datatemplate</div><div class="hbc-description">Users get redirected to this page when they try to access Microsoft Connect.</div></div></div></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WPF メモ その2 グリッドを自前で描画する</title>
      <link href="/2017/01/04/1730/"/>
      <url>/2017/01/04/1730/</url>
      
        <content type="html"><![CDATA[<h1 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h1><p>カスタムコントロールの練習のためです。 ちょっと開発中のアプリで自前で可変サイズのグリッドが必要になったのですが、XamlでGridをゴリゴリ用意するなら、カスタムコントロールのがパフォーマンスは良いだろう、という判断です。 WinFormsの時は、<strong>OnPaint</strong> を駆使して、<strong>ListView</strong>, <strong>TextBox</strong>, <strong>ComboBox</strong> をカスタマイズしていました。 Win32APIと(隠蔽されていたとはいえ)密接に関わっているため、Windowsの深い知識が必要でしたが、楽しくもありました。 あれはあれで、Windows Developerとしての腕の見せ所でしたでしょう。</p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>今回の仕様は UIからグリッドのサイズを変更できる UIから線のサイズを変更できる の2点です。 なので、MVVMを使っていきます。 サンプルソースは下記になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/WPF1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="OnRender"><a href="#OnRender" class="headerlink" title="OnRender"></a>OnRender</h1><p><strong>WinForms</strong>では Control.OnPaint メソッドをオーバーライドすることで、コントロールに独自の描画を実施することができます。 が、WPFの場合はControlTemplateがあるので、そういうことはしないでしょう。 では、どういうときに自前で描画するか、というと、パフォーマンスの追求ではないでしょうか? 例えば、数百数千の円を表示するようなグラフのようなコントロールの場合、<strong>Ellipse</strong> を大量に配置するのはものすごく重くなります。 Shapeオブジェクトは重いのです。ましてや、そのような用途の場合、全オブジェクトに依存関係があることは当然でしょう。さらに重いこと受けあいです。</p><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://iyemon018.hatenablog.com/entry/2016/03/04/150330" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=iyemon018.hatenablog.com"></img><div class="hbc-site-name">やる気駆動型エンジニアの備忘録</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/6653458415121142499/10328537792365730292/1457071781"></img></div><div class="hbc-text"><div class="hbc-title">WPFパフォーマンス改善その１． 初期表示（描画）速度の改善策 - やる気駆動型エンジニアの備忘録</div><div class="hbc-url">http://iyemon018.hatenablog.com/entry/2016/03/04/150330</div><div class="hbc-description">初期表示（描画）速度の改善策 ここでは初期表示、つまり画面をインスタンス化してから描画されるまでの時間を短縮するための改善策や 画面の再描画処理時間の短縮方法を記述します。</div></div></div></div></a></div></div><p>ですので、そもそもレイアウト処理が発生しない自前描画が最速になることは当然です。 無論、描画する必要の無い場所は描画しない、というのが原則ですが。 脇道にそれましたが、WPFの場合、WinFormsのOnPaintと対となるのは、<strong>System.Windows.UIElement.OnRender</strong> メソッドになります。 メソッドの名前も意味からして似ていますが、引数も似たようなものです。 引数の <strong>System.Windows.Media.DrawingContext</strong> は描画系のメソッドを持っています。WinFormsの <strong>PaintEventArgs.Graphics</strong> と同じです。 なので、このメソッドで描画すれば、そのままコントロールに独自描画できます。簡単!! 仕事で、大量の円や自由曲線、矩形を縦横数千ピクセルの画像上にWinFormsで描画してきた経験から、これをWPFでUIElementで実現しようとしたら死ぬ、というのはすぐにわかります。 というか、アメリカの子会社がUWPですが、これをやってました。無論、お察しのパフォーマンスでした。 特殊なOnPaintをふんだんに駆使したコントロールを移植する場合は、WPFでも自前で描画した方が楽なのかもしれません。</p><h1 id="コード解説"><a href="#コード解説" class="headerlink" title="コード解説"></a>コード解説</h1><p>カスタムコントロールはプロジェクトに新しい項目の追加から、<strong>カスタムコントロール (WPF)</strong> を追加するだけです。<br><a href="../../../../public/2017/01/952286bb082dc0e216487c8e304e9bad.png"><img src="../../../../public/2017/01/952286bb082dc0e216487c8e304e9bad.png"></a> サンプルソースのGridControlの中身です。 まずは依存関係です。 [code lang=”csharp”] public static readonly DependencyProperty CellStatesProperty = DependencyProperty.Register( “CellStates”, typeof(bool[,]), typeof(Control), new FrameworkPropertyMetadata( null, FrameworkPropertyMetadataOptions.AffectsRender, PropertyChangedCallback))<br>;<br>public bool[,] CellStates { get { return (bool[,])GetValue(CellStatesProperty); } set { SetValue(CellStatesProperty, value); } }<br>public static readonly DependencyProperty BorderSizeProperty = DependencyProperty.Register( “BorderSize”, typeof(int), typeof(Control), new FrameworkPropertyMetadata( 1, FrameworkPropertyMetadataOptions.AffectsRender, PropertyChangedCallback));<br>public int BorderSize { get { return (int)GetValue(BorderSizeProperty); } set { SetValue(BorderSizeProperty, value); } } [/code] <strong>CellStates</strong> が bool の2次元配列ですが、これは自分の本来の目的のためなので、特に意味はありません。 必要なのは任意のグリッドを表現しているだけです。 <strong>BorderSize</strong> はグリッドの線の幅です。Controlには <strong>BorderThickness プロパティ</strong>がありますが、これは使いません。 次は、OnRenderの描画処理です。 [code lang=”csharp”] protected override void OnRender(DrawingContext drawingContext) { base.OnRender(drawingContext);<br>var state = this.CellStates; if (state == null) return;<br>// 縦横の次元数 var v = state.GetLength(0); var h = state.GetLength(1);<br>if (v == 0 || h == 0) return;<br>// アンチエイリアスによって線によってサイズが変わるのを防ぐ this.VisualEdgeMode = EdgeMode.Unspecified;<br>var width = this.ActualWidth; var height = this.ActualHeight; var borderSize = this.BorderSize;<br>// 横、縦線の本数 var hBorderCount = v + 1; var vBorderCount = h + 1;<br>// 各セルの幅、高さ var hSize = (width - (vBorderCount * borderSize)) / h; var vSize = (height - (hBorderCount * borderSize)) / v;<br>// 線のブラシ var linePen = new Pen(Brushes.Black, borderSize);<br>// ペンの中心だけずらす var borderGap = borderSize / 2d;<br>// 線を描画 (外枠以外) hSize += borderSize; // 横方向の座標移動量 vSize += borderSize; // 縦方向の座標移動量<br>var vEnd = height - vSize; var hEnd = width - hSize;<br>for (var y = vSize + borderGap; y &lt; vEnd; y += vSize) { for (var x = hSize + borderGap; x &lt; hEnd; x += hSize) { // 縦方向 drawingContext.DrawLine( linePen, new Point(x, 0), new Point(x, height - borderSize)); }<br>// 横方向 drawingContext.DrawLine( linePen, new Point(0, y), new Point(width - borderSize, y)); }<br>// 外枠 drawingContext.DrawRectangle( null, linePen, new Rect(borderGap, borderGap, width - borderSize, height - borderSize)); } [/code] Xamlはこんな感じです。 [code lang=”xaml”] <Grid> &lt;Grid.ColumnDefinitions&gt; <ColumnDefinition Width="\*" /> <ColumnDefinition Width="Auto" /> &lt;/Grid.ColumnDefinitions&gt;<br><Border Grid.Column="0" BorderBrush="Red" BorderThickness="30" VerticalAlignment="Center" HorizontalAlignment="Center"> &lt;controls:GridControl Width=”300” Height=”300” BorderSize=”{Binding BorderSize, Mode=OneWay}” CellStates=”{Binding CellStates, Mode=OneWay}” /&gt; </Border> [/code] カスタムのGridコントロールの外側に赤い枠があります。 これはカスタムコントロールが正しい位置に描画されているか、というチェックに使います。 ソース中のコメントが割と丁寧なので説明は不要ですが、ポイントは <strong>borderGap</strong> 変数です。 これがないと描画したとき結果がおかしくなります。ためしに、この変数に0を設定して実行して見てください。<br><a href="../../../../public/2017/01/0df97c28803d922368c52bad22a5471f.png"><img src="../../../../public/2017/01/0df97c28803d922368c52bad22a5471f.png"></a> GridControlの外に設置した <strong>Border</strong> を浸食しています。 左上の0,0から描画したのにこうなるわけは、コメントにあるとおり、Penで描画する際、指定した座標はペンの幅のどこに来るか、ということを考えればわかると思います。 幅が太い場合は顕著ですが、幅の中心が、指定した位置に当たるので、ペン幅の半分だけはみ出る、という訳です。 正しく実行するとこうなります。 <a href="../../../../public/2017/01/a66da886a2427931cfa2179f424076a8.png"><img src="../../../../public/2017/01/a66da886a2427931cfa2179f424076a8.png"></a></p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/WPF1">https://github.com/takuya-takeuchi/Demo/tree/master/WPF1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その28 カスタムコントロール (WPF) を追加できない</title>
      <link href="/2017/01/03/1740/"/>
      <url>/2017/01/03/1740/</url>
      
        <content type="html"><![CDATA[<h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>既存のクラスライブラリにカスタムコントロール (WPF) テンプレートを追加しようと思ったのですが、そもそもテンプレートが表示されない問題に遭遇。<br><a href="../../../../public/2017/01/457c4255c5961da540e5c699f389332a.png"><img src="../../../../public/2017/01/457c4255c5961da540e5c699f389332a.png"></a></p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>Stackoverflowで同じ問題に遭遇した人がいました。 </p><p>プロジェクトファイルを編集しろ、ということでした。 プロジェクトファイルに [code lang=”xaml”] <ProjectTypeGuids>{60dc8134-eba5-43b8-bcc9-bb4bc16c2548};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids> [/code] 下記の一文を追加しろとのこと。 追加する場所は、FileAlignment 付近で良いです。下記一例。 [code lang=”xaml”] <PropertyGroup> <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration> <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform> <ProjectGuid>{6BE5C18C-A305-4CAC-8130-AAD1A3C48BD2}</ProjectGuid> <OutputType>WinExe</OutputType> <AppDesignerFolder>Properties</AppDesignerFolder> <RootNamespace>CAMUI</RootNamespace> <AssemblyName>CAMUI</AssemblyName> <TargetFrameworkVersion>v4.6</TargetFrameworkVersion> <TargetPlatformVersion>8.1</TargetPlatformVersion> <FileAlignment>512</FileAlignment> <ProjectTypeGuids>{60dc8134-eba5-43b8-bcc9-bb4bc16c2548};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids> <WarningLevel>4</WarningLevel> <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects> <NuGetPackageImportStamp> </NuGetPackageImportStamp> <SolutionDir Condition="$(SolutionDir) == '' Or $(SolutionDir) == '\*Undefined\*'">..\</SolutionDir> <RestorePackages>true</RestorePackages> </PropertyGroup> [/code] 追加した後、ソリューションを読み込み直すと無事テンプレートが表示されます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで画像処理を試してみる OpenCVSharp編 第4回</title>
      <link href="/2017/01/02/1726/"/>
      <url>/2017/01/02/1726/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-cb">前回</a>はカメラの説明を行いました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>相当久しぶりですが… 今回は、<strong>OpenCVSharp 2.X</strong> から <strong>3.1</strong> に変更した話です。 <strong>OpenCV</strong> は2017年1月現在 2.4 と 3.1 が存在しています。 それに伴い OpenCVSharp も2つのバージョンが存在します。 ところがメジャーバージョンアップに伴い、大幅にAPIが変更されました。 このあたりの説明は OpenCVSharp の作者である Schima様の下記の記事を参考にしてください(作者様のページに全てが書いてあるからこの記事不要)。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://schima.hatenablog.com/entry/2015/08/17/203901" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=schima.hatenablog.com"></img><div class="hbc-site-name">schima.hatenablog.com </div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/11696248318758502585/8454420450105952512/1442323652"></img></div><div class="hbc-text"><div class="hbc-title">OpenCvSharpをつかう　その23 (OpenCV 3.0対応) - schima.hatenablog.com </div><div class="hbc-url">http://schima.hatenablog.com/entry/2015/08/17/203901</div><div class="hbc-description">またまただいぶ間隔が空いてしまいすみません・・・ 前回の記事（http://schima.hatenablog.com/entry/2014/09/08/220420）で罵詈雑言を浴びせたOpenCV3.0にOpenCvSharpをひとまず対応させました。 NuGet Galle…</div></div></div></div></a></div></div><h1 id="1-IplImage-の廃止"><a href="#1-IplImage-の廃止" class="headerlink" title="1. IplImage の廃止"></a>1. IplImage の廃止</h1><p>大きな変更点ですが、今までAPIに画像を渡すとき、入力画像の型が <strong>IplImage</strong> だったので、 [code lang=”csharp”] var bitmap = new System.Drawing.Bitmap(100, 100); var image = bitmap.ToIplImage(); [/code] とかしてましたが、これは消えました。 OpenCV 3.0からは <strong>Mat</strong> が推奨らしく、OpenCVSharp もそれにならい、こうなります。 [code lang=”csharp”] var bitmap = new System.Drawing.Bitmap(100, 100); var mat = bitmap.ToMat(); [/code] 簡単ですね。 ただ、それに伴い、APIの型や名前空間が大幅に変わっているので、そのあたり合わせて変更します。 ハフ変換、モルフォロジー変換など変更は多岐にわたります。というか全部変わっています。</p><h1 id="2-CvCapture-の廃止"><a href="#2-CvCapture-の廃止" class="headerlink" title="2. CvCapture の廃止"></a>2. CvCapture の廃止</h1><p>これが一番痛かったです。 <strong>CvCapture</strong> はコンストラクタにカメラインデックス(Int32)、動画又は画像ファイルへのフルパス(String)を入力できましたが、この型の代わりに新しく登場したのは、<strong>VideoCapture</strong>。 そうこの型。<strong>画像ファイルが扱えません。</strong> 従来はこの型一つで画像と動画を区別することなく処理しましたがそれができません。また、フレームデータへのアクセスAPIが <strong>IplImage QueryFrame()</strong> から <strong>Mat RetrieveMat()</strong> に変わっています。 画像ファイルを読み込みたい場合は、<strong>Mat OpenCVSharp.Cv2.ImRead(string)</strong> でデータを取得できます。 ですが、面倒なのは、RetrieveMat の戻りは解放してはいけないが、ImRead の戻りは解放しなくてはならない点。 従来の CvCapture なら、戻りの IplImage は解放しないで、呼び出しのAPIを備えた CvCapture を破棄していましたが、それができません。 ここは注意が必要です。 利用した Mat の破棄を複数の箇所で実施しており、その先で読み込み元が画像なのかカメラまたは動画で区別するのが面倒なので、どうせ書き換えるなら、ということで私はラッパーを作りました。 [code lang=”csharp”] class MatWrapper : IDisposable {<br>#region フィールド<br>private readonly bool _CanDispose;<br>private readonly Mat _Mat;<br>#endregion<br>#region コンストラクタ<br>public MatWrapper(Mat mat, bool canDispose) { this._Mat = mat; this._CanDispose = canDispose; }<br>#endregion<br>#region プロパティ<br>public Mat Mat { get { return this._Mat; } }<br>#endregion<br>#region IDisposable メンバ<br>/// <summary> /// <see cref="System.IDisposable.Dispose"/> メソッドが呼ばれたかどうかを示す値を表します。 /// </summary> private bool _Disposed;<br>/// <summary> /// <see cref="MatWrapper"/> によって使用されているすべてのリソースを解放します。 /// </summary> public void Dispose() { GC.SuppressFinalize(this); this.Dispose(true); }<br>/// <summary> /// <see cref="MatWrapper"/> によって使用されているすべてのリソースを解放します。 /// </summary> /// <param name="disposing">Dispose メソッドが呼ばれたかどうかを示す値。</param> private void Dispose(bool disposing) { if (this._Disposed) { return; }<br>this._Disposed = true;<br>if (disposing) { // マネージリソースの解放処理 if (this._CanDispose) { this._Mat?.Dispose(); } } }<br>#endregion<br>} [/code] ImRead または RetrieveMat の戻りの Mat をコンストラクタに渡し、ソースが画像なら破棄可能として true を渡します。 これにより、このラッパークラスを破棄する際に、自動で内部の Mat を破棄するかどうかを判断します。</p><h1 id="3-Native-Dll-が配置されない"><a href="#3-Native-Dll-が配置されない" class="headerlink" title="3. Native Dll が配置されない"></a>3. Native Dll が配置されない</h1><p>OpenCVSharpをNugetから追加した際、NativeDllを含むパッケージをインストールし、ビルドしたにもかかわらずビルド出力先のディレクトリにNativeDllがコピーされず、動画ファイルの読み込みに失敗していました。 <strong>私はこれに数時間悩んでいました。</strong> 確認しましたが、OpenCVSharp 2.X でもビルドした際、関連するNativeDllが自動でコピーされて<strong>いませんでした</strong>。 なので手動でコピーする必要がありそうです。 Dllはソリューションフォルダと同じディレクトリから、<strong>packages\OpenCvSharp3-AnyCPU.3.1.0.20161105\NativeDlls\x64</strong> という感じです。 というか、コピーしなくても動いていたのは、おそらくOpenCVをインストールして、パスが通っていたからでしょう。 なので、開発環境で動いて、本番環境で動かずに泣くことにならないようテスト環境の構築はきちんと行いましょう。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>早めに <strong>OpenCVSharp3</strong> への移行をお勧めします。ただし、一部APIが削除されていたりと、機能面で互換性が無くなっているところがあるので、そこは要注意です。 ですが、今後の新機能は3.0に追加されていくと思うので、その対応のためにも3.0への移行は必須です。 ただ、OpenCVSharpそのものが対応しないとダメですが….</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> OpenCV </category>
          
          <category> .NETで画像処理を試してみる OpenCVSharp編 </category>
          
          <category> OpenCvSharp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その26 特定の色相を選択して抜き出す</title>
      <link href="/2016/12/31/1718/"/>
      <url>/2016/12/31/1718/</url>
      
        <content type="html"><![CDATA[<h1 id="HSVを使って特定の色だけ残す"><a href="#HSVを使って特定の色だけ残す" class="headerlink" title="HSVを使って特定の色だけ残す"></a>HSVを使って特定の色だけ残す</h1><p><a href="http://wp.me/p7138e-rC">前回</a>、RGBと違ってRGBは色相によって同じような色を選択できることを説明しました。 これを用いて、実際に画像から特定の色だけを残してみます。 処理としては単純で、入力画像の各画素をRGBからHSVに変換し、指定した条件に合致していたら、その画素を残し、それ以外なら任意の色で塗りつぶします。 下記のサンプルでは、byte配列上の画素をHSVに変換し、最小、最大の色相、彩度、明度を指定し、その範囲チェックをしています。 また今回は白で塗りつぶしを実施しています。 [code lang=”csharp”] private void UpdateImage() { unsafe { fixed (byte* pSrc = &amp;this._ImageBuffer[0]) fixed (byte* pDst = &amp;this._FilteredImageBuffer[0]) { var ps = pSrc; var pd = pDst;<br>var stride = this._Stride; var width = this._Width; var height = this._Height; var channel = this._Channel; var dpiX = this._OriginalSource.DpiX; var dpiY = this._OriginalSource.DpiY; var offset = stride / channel - width;<br>var maxHue = this._MaxHue; var minHue = this._MinHue; var maxSaturation = this._MaxSaturation; var minSaturation = this._MinSaturation; var maxValue = this._MaxValue; var minValue = this._MinValue;<br>float h, s, v; byte back = 255; for (var y = 0; y &lt; height; y++) { for (var x = 0; x &lt; width; x++, pd += channel, ps += channel) { FromRgb(ps[2], ps[1], ps[0], out h, out s, out v); if (minHue &lt;= h &amp;&amp; h &lt;= maxHue &amp;&amp; minSaturation &lt;= s &amp;&amp; s &lt;= maxSaturation &amp;&amp; minValue &lt;= v &amp;&amp; v &lt;= maxValue) { pd[2] = ps[2]; pd[1] = ps[1]; pd[0] = ps[0]; } else { // 白にする pd[2] = back; pd[1] = back; pd[0] = back; } }<br>pd += offset; ps += offset; }<br>var bitmap = BitmapSource.Create( width, height, dpiX, dpiY, this._PixelFormat, null, this._FilteredImageBuffer, stride); bitmap.Freeze(); this.FilteredSource = bitmap; } } } [/code] 上記のサンプルを使ったのが下記のサンプルです。 サンプルに使った画像は <a href="http://www.publicdomainpictures.net/view-image.php?image=39414&picture=&jazyk=JP">Public Domain Pictures.net</a> から利用させていただきました。</p><p><a href="../../../../public/2016/12/89cdc33a6d22c04e13944f94062dc9b9.png"><img src="../../../../public/2016/12/89cdc33a6d22c04e13944f94062dc9b9.png"></a></p><p>上のサンプルでは色相の10-60はオレンジと黄色を表しており、明度と彩度は明るく、純度の高い色を選択しています。 詳しい色相の説明は下記のページがわかりやすいです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.peko-step.com/html/hsv.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.peko-step.com"></img><div class="hbc-site-name">PEKO STEP</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://www.peko-step.com/image/pspogp.gif"></img></div><div class="hbc-text"><div class="hbc-title">HSV色空間とは</div><div class="hbc-url">http://www.peko-step.com/html/hsv.html</div><div class="hbc-description">色の表現方法のひとつである「HSV色空間(HSBとも呼ばれます)」の解説。使用する上での利点や各要素の意味など。</div></div></div></div></a></div></div><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Image3">https://github.com/takuya-takeuchi/Demo/tree/master/Image3</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> 画像処理 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その25 RGBからHSVへの変換パフォーマンス</title>
      <link href="/2016/12/28/1712/"/>
      <url>/2016/12/28/1712/</url>
      
        <content type="html"><![CDATA[<h1 id="RGBからHSVを取得する"><a href="#RGBからHSVを取得する" class="headerlink" title="RGBからHSVを取得する"></a>RGBからHSVを取得する</h1><p>通常、.NETで扱える色の形式はRGBです。赤、緑、青から成る光の三原色です。 基本の基本ですが、これはこれで不便なところがあります。 例えば、RGB(255,0,0)とRGB(200,0,0)では同じ赤ですが、後者のが暗いです。 では、同じような色であった場合に、どちらが暗いか、といった場合に赤、緑、青の各要素を調べることで判断できるでしょうか? 当然できません。 なぜなら、赤、緑、青の複数の色からなる色の場合、この方法ではどちらが暗いかを判断することはできないからです。 そこで、RGBを色相 (Hue)、彩度 (Saturation)、明度 (Value) の3つの成分からなる色空間に変換することで、同じような色であっても明るさを数値で比較することができます。 詳しい詳細は Wikipedia を見て、と成りますが、この変換を C# で実行してみます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://ja.wikipedia.org/wiki/HSV%E8%89%B2%E7%A9%BA%E9%96%93" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ja.wikipedia.org"></img><div class="hbc-site-name">ja.wikipedia.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://upload.wikimedia.org/wikipedia/commons/2/21/Hsv_sample.png"></img></div><div class="hbc-text"><div class="hbc-title">HSV色空間 - Wikipedia</div><div class="hbc-url">https://ja.wikipedia.org/wiki/HSV%E8%89%B2%E7%A9%BA%E9%96%93</div></div></div></div></a></div></div><p>下はRGBの16777216色を全てHSVに変換し、その速度を表示するサンプルです。 [code lang=”csharp”] using System; using System.Diagnostics;<br>namespace Image2 { class Program { static void Main(string[] args) { float h, s, v; var sw = new Stopwatch();<br>sw.Start(); for (var r = 0; r &lt;= 255; r++) for (var g = 0; g &lt;= 255; g++) for (var b = 0; b &lt;= 255; b++) FromRgb((byte)r, (byte)g, (byte)b, out h, out s, out v);<br>sw.Stop(); Console.WriteLine($”{sw.ElapsedMilliseconds} ms”); }<br>private static void FromRgb(byte r, byte g, byte b, out float h, out float s, out float v) { var max = Math.Max(r, Math.Max(g, b)); var min = Math.Min(r, Math.Min(g, b));<br>var brightness = max / 255f; float hue, saturation; if (Math.Abs(max - min) &lt; float.Epsilon) { hue = 0f; saturation = 0f; } else { float c = max - min; if (Math.Abs(max - r) &lt; float.Epsilon) hue = (g - b) / c; else if (Math.Abs(max - g) &lt; float.Epsilon) hue = (b - r) / c + 2f; else hue = (r - g) / c + 4f;<br>hue *= 60f; if (hue &lt; 0f) hue += 360f;<br>saturation = c / max; }<br>h = hue; s = saturation; v = brightness; }<br>} } [/code]</p><h4 id="32bit-vs-64bit"><a href="#32bit-vs-64bit" class="headerlink" title="32bit vs 64bit"></a>32bit vs 64bit</h4><p>サンプル自体は、何の変哲も無いのですが、テスト中面白いことに気づきました。 プラットフォームターゲットを x86 と x64 に変更し、ビルド実行すると性能に大きな差が発生しました。 [code lang=”batch”] D:\Works\Demo\Image2\Image2\bin\Release&gt;Image2.exe 357 ms<br>D:\Works\Demo\Image2\Image2\bin\Release&gt;Image2.exe 3590 ms [/code] 前者が x64、後者が x86 でビルドした結果です。 なお環境は <strong>Intel Core i7-2600 3.40GHz</strong> です。 実際には、ある程度大きなサイズの画像の、全画素を変換したとしたら、1/8くらいにはなるでしょう。 この差は非常に大きいです。今日日、32bitの環境なんて考えたくもないですが、これだけ性能に差があるなら、機材の選定を担当する人間への説得する材料としては十分でしょう。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Image2">https://github.com/takuya-takeuchi/Demo/tree/master/Image2</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> 画像処理 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その24 Norton Internet SecurityにDebugビルドの自作アプリがウイルス扱いされたので文句を言ってみた</title>
      <link href="/2016/11/13/1690/"/>
      <url>/2016/11/13/1690/</url>
      
        <content type="html"><![CDATA[<h1 id="デバッグできない"><a href="#デバッグできない" class="headerlink" title="デバッグできない"></a>デバッグできない</h1><p>RedArmoryの開発中ですが、掲題の通り、Debug版をビルドした瞬間に、<strong>Norton Internet Security (以下NIS)</strong> の自動保護機能が作動してobj\Debug内のバイナリが削除されてしまい、デバッグができなくなりました。</p><p><a href="../../../../public/2016/11/img_582834f38368b.png"><img src="../../../../public/2016/11/img_582834f38368b.png"></a></p><p>仕事しましたよ(ｷﾘｯ)</p><p>Release版だと無事なので良いのですが、何だか釈然としませんので、Nortonに文句を言ってみました。</p><h1 id="誤検出の申請をしてみる"><a href="#誤検出の申請をしてみる" class="headerlink" title="誤検出の申請をしてみる"></a>誤検出の申請をしてみる</h1><p>ググってみると、日本のコミュニティが見つかりますが、案内されたページは英語の模様。 何のための日本法人なのか… まず<a href="https://submit.symantec.com/false_positive/">Report a Suspected Erroneous Detection (False Positive)</a>にアクセスします。</p><h2 id="いつ発生"><a href="#いつ発生" class="headerlink" title="いつ発生?"></a>いつ発生?</h2><p>最初のページです。 報告する現象がいつかを選択します。<br><a href="../../../../public/2016/11/screencapture-submit-symantec-false_positive-1479025972298.png"><img src="../../../../public/2016/11/screencapture-submit-symantec-false_positive-1479025972298-1024x531.png"></a><br> 上から、</p><p>A1 - When downloading or uploading a file</p><p>ファイルのダウンロードまたはアップロード中</p><p>A2 - While using an application</p><p>アプリケーションの使用中</p><p>A3 - When installing an application</p><p>アプリケーションのインストール中</p><p>A4 - When browsing the web</p><p>Webの閲覧中</p><p>A5 - During a scheduled scan, or during a scan I requested</p><p>スケジュールされたスキャンの間、または自分で要求したスキャンの間</p><p>A6 - When sending or receiving email</p><p>メールの送信中または受信中</p><p>A7 - While writing or reading files to/from a storage device</p><p>ストレージデバイスへ/からファイルを書き込み/読み込みしたとき</p><p>A8 - Don’t know, am unsure, or the options provided do not apply</p><p>わからない、不確か、または選べる選択肢がない</p><p>今回は、Visual Studio がファイルを書き込んでいるときなので、A7を選択しました。 選択したらNextを押します。</p><h2 id="どの製品で発生"><a href="#どの製品で発生" class="headerlink" title="どの製品で発生?"></a>どの製品で発生?</h2><p>どのNorton製品を使っているかを選択します。 <strong>View screenshot</strong> があるので、それを見て自身の使用製品を判断することもできます。 私はNISでしたので、B5を選択しました。 選択したらNextを押します。<br><a href="../../../../public/2016/11/screencapture-submit-symantec-false_positive-1479026062556.png"><img src="../../../../public/2016/11/screencapture-submit-symantec-false_positive-1479026062556-1024x531.png"></a></p><h2 id="どういう仕組みで発生"><a href="#どういう仕組みで発生" class="headerlink" title="どういう仕組みで発生?"></a>どういう仕組みで発生?</h2><p>どういう方法で検出されたのかを選択します。 上から、</p><p>C1 - Download/File Insight (Reputation Based Detection) e.g. WS.Reputation.1, Suspicious.Insight, WS.Malware.* – View screenshot</p><p>ダウンロード/ファイルインサイト (レピュテーションベースの検出)。例えば、WS. Reputation.1、Suspicious.Insight、WS.Malware.*</p><p>C2 - SONAR (Behavioral Heuristics Detection) e.g. SONAR.Heuristic, Bloodhound.SONAR.* – View screenshot</p><p>SONAR (振る舞いヒューリスティック検出)。例えば、SONAR ヒューリスティック、Bloodhound.SONAR</p><p>C3 - Auto-Protect (File Based Detection) e.g. Trojan.*, Trojan.ADH, Suspicious.Cloud.*, Downloader, Hacktool, Suspicious.* – View screenshot</p><p>自動保護 (ファイルベースの検出)。例えば、Trojan.*、Trojan.ADH,、Suspicious.Cloud.*、ダウンローダー。ハックツール、Suspicious.*</p><p>C5 - IPS (Network Intrusion Detection, Vantage) e.g. “Web Attack”, “Malicious Site: Malicious Web site, Domain or URL” – View screenshot</p><p>侵入防御システム (ネットワーク侵入検知)。例えば、Web Attack、Malicious Site: Malicious Web site, Domain or URL</p><p>C7 - SafeWeb (Phishing URLs, Malicious Web Pages) – View screenshot</p><p>セーフWeb (フィッシングURL、悪意のあるWebページ)</p><p>C11 - Don’t know, am unsure, or the options provided do not apply</p><p>わからない、不確か、または選べる選択肢がない</p><p>Nortonの場合、File Insight、自動保護、SONAR等検出の方法は多岐にわたります。 <strong>View screenshot</strong> があるので、それを見て自身の判断することもできます。 私の場合は、自動保護だったので、C3を選択しました。<br><a href="../../../../public/2016/11/screencapture-submit-symantec-false_positive-1479026074226.png"><img src="../../../../public/2016/11/screencapture-submit-symantec-false_positive-1479026074226-1024x531.png"></a></p><h2 id="詳細な情報は"><a href="#詳細な情報は" class="headerlink" title="詳細な情報は?"></a>詳細な情報は?</h2><p>最後のページです。<br><a href="../../../../public/2016/11/screencapture-submit-symantec-false_positive-standard-1479026885289.png"><img src="../../../../public/2016/11/screencapture-submit-symantec-false_positive-standard-1479026885289-1024x614.png"></a></p><p><strong>Step1</strong>で、検出したファイルを提出します。Submission Typeを <strong>Upload File</strong> を選択。 大抵、自動保護を一時的に無効にしているはずなので、先に記入を済ませてから、ファイルを選択すると良いでしょう。 でないと、記入中にファイルを消されます。 <strong>Step2</strong>では、検出した情報についての記述です。 下記の項目は、Nortonの活動記録の画面を見て入力してください。</p><p>Name of the software being detected:</p><p>検出されたソフトウェアの名前</p><p>Name of detection given by Symantec product:</p><p>Symantec製品によって検出された名前</p><p>しかし、次の項目が少しわかりにくいです。</p><p>Important: File quarantine, product clipboard information or additional details: • If the information is more than 20000 characters, please create a log file and send that along with the file submission.</p><p>重要: ファイル検疫、製品クリップボード情報または追加情報。もし、20000字以上の情報ならば、ログファイルと付随ファイルを提出してください。</p><p>説明の下に <strong>Instructions</strong> リンクがあるでのクリックすると、下記の内容が記されたポップアップが表示されます。</p><p><strong>Symantec Endpoint Protection Users</strong> Simply click on View Quarantine and provide the “Original Location” listed for the quarantined file(s). <strong>Norton Internet Security/AntiVirus/360 Users</strong> From Advanced view, select History and use “Quarantine” filter. Click on the activity, then “More Details” and “Copy to Clipboard”. Now you can simply paste the content here.</p><p>これに従うと、製品クリップボード情報が入手できます。 まず、<strong>セキュリティ履歴</strong>から、状態が<strong>検疫済み</strong>になっている、項目を選択します。<br><a href="../../../../public/2016/11/21799ec8d6b890308231f080ae32fa72.png"><img src="../../../../public/2016/11/21799ec8d6b890308231f080ae32fa72.png"></a></p><p>次に、<strong>その他のオプション</strong>をクリックします。 右下に<strong>クリップボードにコピー</strong>とあるのでクリックします。<br><a href="../../../../public/2016/11/91c21ea074713f91a284fa81e9f78f40.png"><img src="../../../../public/2016/11/91c21ea074713f91a284fa81e9f78f40.png"></a></p><p>コピーされた内容を先ほどのテキスト入力エリアに貼り付けます。 内容は、検出されたウイルス名等ですが、ファイルのフルパスなどがあるのでご注意を。 <strong>Step3</strong>では、報告者である自分の情報を書きます。名前とメールアドレスになります。 3つめの項目の <strong>Are you the creator or distributor of the software in question?</strong> は、<strong>あなたは質問のソフトウェアの作者か配布者ですか?</strong> という意味です。私はファイルの作成者なので Yes を選択しました。 最後の<strong>Step4</strong>では、最終確認です。最近おなじみの<strong>CAPTCHA</strong>です。 CAPTCHAを入力する前に、チェックボックスにチェックをつける必要があります。 <strong>Please provide as much information as possible. Submissions with insufficient detail will be rejected.</strong> は、<strong>可能な限り詳しい情報を提供してください。不十分な情報と一緒に提出されたものは拒絶されます。</strong>とありますです。特に脅し文句ではないのでご安心を。 AnwserにCAPTCHAを入力してSubmitで報告です。お疲れ様です。</p><h2 id="結果"><a href="#結果" class="headerlink" title="結果"></a>結果</h2><p>は、まだです。どうも結果は返ってこないご様子。 何かありましたら、報告いたします。 とりあえずは、Nortonのスキャン対象からパスを除外する方法で対処します。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> アンチウイルス誤検出 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その23 GDBでデバッグしてみる</title>
      <link href="/2016/11/08/1687/"/>
      <url>/2016/11/08/1687/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux辛い"><a href="#Linux辛い" class="headerlink" title="Linux辛い"></a>Linux辛い</h1><p>自分用メモ。 gdbを使ってデバッグまたはコアダンプを解析する方法。</p><h1 id="下準備"><a href="#下準備" class="headerlink" title="下準備"></a>下準備</h1><p>Linuxではコアダンプの出力が無効になっているようなので有効にします。 [code lang=”sh”] # ulimit -c unlimited [/code] <strong>unlimited</strong>出力サイズを無制限にするとのこと。 サイズを制限しなくてはならないような巨大プログラムや貧弱マシンでなければ無制限一択。</p><h1 id="デバッグ"><a href="#デバッグ" class="headerlink" title="デバッグ"></a>デバッグ</h1><p>簡単。 [code lang=”sh”] # gdb<br>…<br># (gdb) run [/code] gdbにプログラムのパスを渡し、<strong>run</strong> で実行するだけです。</p><h1 id="ダンプの解析"><a href="#ダンプの解析" class="headerlink" title="ダンプの解析"></a>ダンプの解析</h1><p>ulimitでコアダンプを有効化にしていると、カレントディレクトリにダンプファイルが出力されるはず。 これをgdbで解析するには [code lang=”sh”] # gdb &lt;ダンプのパス&gt;<br>…<br># (gdb) [/code] はい、これでダンプを解析できます。 あとは、<strong>bt (backtrace)**、</strong>info threads**等でゴリゴリ解析してください。 時間ができたら、コマンドをまとめたいです。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> GDB </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その22 git pull したときにエディタを表示されないようにする</title>
      <link href="/2016/10/15/1682/"/>
      <url>/2016/10/15/1682/</url>
      
        <content type="html"><![CDATA[<h1 id="CUI辛いです"><a href="#CUI辛いです" class="headerlink" title="CUI辛いです"></a>CUI辛いです</h1><p>自分用メモ。 会社で、Linux環境で開発をしています。 しかしながら、メールとかを使用するマシンはWindows上にあり、開発マシンは共有です。なので、メール見るマシンの前で開発したいわけです。 でも、VNCはレスポンスが悪くてとてもじゃないけど使えません (同じネットワークにあるのにも関わらず!!)。 なので、Visual Studio Codeでコーディングし、WinSCPで転送、SSHでログインしてビルド、そしてgit、という非常に面倒な開発プロセス使うわけですが、Visual Studio や TortoiseGit になれていると、コミットするにも一苦労。 更にエラーメッセージも英語で辛い。 そんな中、<strong>git pull</strong> したときに何故かエディタが立ち上がりました。 [code lang=”sh”] # Please enter a commit message to explain why this merge is necessary, # especially if it merges an updated upstream into a topic branch. # # Lines starting with ‘#’ will be ignored, and an empty message aborts # the commit. [/code] トピックブランチにアップストリームのブランチをマージする場合にコメントが必要ってことらしいですが、ブランチの扱いもおぼつかないのに、こんなこと言われても困ります。 空のメッセージはコミットをアボートしますってありますし。 なので、ググったら、 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://snickerjp.blogspot.jp/2015/04/git-pull-no-edit.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=snickerjp.blogspot.jp"></img><div class="hbc-site-name">元うなぎ屋</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="//1.bp.blogspot.com/-FjfKOBOdj1w/VSO-4uz4xkI/AAAAAAAB84E/GlAA9xJDKyE/w1200-h630-p-k-no-nu/1428423174_git-branch-256.png"></img></div><div class="hbc-text"><div class="hbc-title">「git pull」した時に出る、commitエディタを表示しないようにする</div><div class="hbc-url">http://snickerjp.blogspot.jp/2015/04/git-pull-no-edit.html</div><div class="hbc-description">なのまるです～git の自動化を行っているとおかしなことが起きて困ったので、対処法メモです！もくじgitを使ったスクリプトを実行したときに発生した問題中では、[git pull] をしているわけですが、    Merge branch &#39;master&#39; of …</div></div></div></div></a></div></div><p>同じ現象に遭遇している方が。 [code lang=”sh”] # git pull –no-edit [/code] すれば、エディタが起動しない、とのこと。 助かりました。</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その21 Red Hat Enterprise Linux 7.2のポートを開放する</title>
      <link href="/2016/10/02/1677/"/>
      <url>/2016/10/02/1677/</url>
      
        <content type="html"><![CDATA[<h1 id="TeamViewerのためにローカルポートを開く"><a href="#TeamViewerのためにローカルポートを開く" class="headerlink" title="TeamViewerのためにローカルポートを開く"></a>TeamViewerのためにローカルポートを開く</h1><p>なんでこんなことしたいかっていうと、TeamViewerを使ってローカルのWindowsから接続するんですが、いちいちインターネットにアクセスするのはレスポンスの面からも良くないしセキュリティ的にどうなの？っていうところです。 で、TeamViewerをLAN内からのアクセスだけ有効にすると、アクセスできなくなります。 当然インターネットを有効にしているときは、TeamViewerの仕組み上受信側のポートは無関係になりますが、LAN内からのアクセスだけを有効にすると、今度は受信側のポートが有効になりポートの制限が発生します。 なので、ポートを開放します。 TCPの5938を解放します。 <strong>参考:</strong> <a href="https://www.teamviewer.com/ja/help/334-which-ports-are-used-by-teamviewer.aspx">Which ports are used by TeamViewer?</a></p><p>まず、<strong>アプリケーション =&gt; 諸ツール =&gt; ファイアウォール</strong> を選択します。<br><a href="../../../../public/2016/10/img_57eff8857cacf.png"><img src="../../../../public/2016/10/img_57eff8857cacf.png"></a> &lt; p style=”margin-top: 40px;”&gt; 次に、左上の <strong>設定</strong> を <strong>永続</strong> に変更します。 こうしないと再起動時に設定が戻ってしまいます。 次に<strong>ゾーン</strong>から <strong>public</strong> を選択し、<strong>ポート</strong> タブに移動します。 そして、<strong>追加 (A)<br>** ボタンを押下し、</strong>tcp 5938** を追加します。 これでLAN内からのみの接続を許容するTeamViewerが有効になります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Windows10 ではファイアウォールを変更しなくてもLAN接続のみの設定が有効だったのですが…</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> TeamViewer </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その20 アセンブリ内のxamlリソースからDataTemplateを読み込む</title>
      <link href="/2016/09/03/1669/"/>
      <url>/2016/09/03/1669/</url>
      
        <content type="html"><![CDATA[<h1 id="Url指定が鬼門"><a href="#Url指定が鬼門" class="headerlink" title="Url指定が鬼門"></a>Url指定が鬼門</h1><p><strong>DataTemplate</strong> はxaml内に定義して、<strong>DataTemplateSelector</strong> で読み込んだりすることが定石ですが、アセンブリ内のxamlファイルからResourceDictionaryを生成して、動的にDataTemplateを作成することもできます。 通常、実行ファイル内のリソースにアクセスする場合は、下記のようになります。 [code lang=”csharp”] var uri = new Uri(“pack://application:,,,/Resources/DataTemplateResources.xaml”, UriKind.Relative); var info = Application.GetResourceStream(uri); var reader = new XamlReader(); if (info != null) { Dictionary = reader.LoadAsync(info.Stream) as ResourceDictionary; } [/code] 実行ファイルではなく、dllに定義してあるリソースにアクセスする場合は、 [code lang=”csharp”] var uri = new Uri(“ABC.DEF.GHI;component/Resources/DataTemplateResources.xaml”, UriKind.Relative); var info = Application.GetResourceStream(uri); var reader = new XamlReader(); if (info != null) { Dictionary = reader.LoadAsync(info.Stream) as ResourceDictionary; } [/code] みたいになります。 どちらも、プロジェクトファイル直下にResoucesフォルダがあり、その直下にDataTemplateResources.xamlが存在するという形式です。 ABC.DEF.GHIはdllのファイル名です。拡張子であるdllは除去します。 xamlの中身は、 [code lang=”xaml”] <ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"> <DataTemplate x:Key="Test1"> <TextBlock Text="{TemplateBinding Content}"/> </DataTemplate><br><DataTemplate x:Key="Test2"> <Button Content="{TemplateBinding Content}"/> </DataTemplate> </ResourceDictionary> [/code] とします。 プログラムからのアクセスは [code lang=”csharp”] Dictionary?[“Test1”] as DataTemplate [/code] だけです。 この戻りをContentTemplateSelector等に設定するか、DataTemplateSelectorの戻り値に設定すれば動的にDataTemplateを使うことができます。 ここまでは普通の内容です。</p><h1 id="LoadAsyncメソッドが例外を投げる"><a href="#LoadAsyncメソッドが例外を投げる" class="headerlink" title="LoadAsyncメソッドが例外を投げる"></a>LoadAsyncメソッドが例外を投げる</h1><p>Uriの生成、Application.GetResourceStreamの呼び出しに成功し問題は無いように見えます。 しかし、何故か奇妙な例外を投げます。</p><h3 id="インデックス-30-にあるバイト-FF-を指定されたコード-ページから-Unicode-へ変換できません。"><a href="#インデックス-30-にあるバイト-FF-を指定されたコード-ページから-Unicode-へ変換できません。" class="headerlink" title="インデックス 30 にあるバイト [FF] を指定されたコード ページから Unicode へ変換できません。"></a>インデックス 30 にあるバイト [FF] を指定されたコード ページから Unicode へ変換できません。</h3><p>さっぱり意味がわかりません。 しかし、Unicodeという言葉に違和感を覚えました。 エディタでエンコードを確認すると、BOMの表示が… BOMを外して、再度読み込むと例外を投げることなく読み込むことができました。</p><h1 id="アクセス修飾子にも注意"><a href="#アクセス修飾子にも注意" class="headerlink" title="アクセス修飾子にも注意"></a>アクセス修飾子にも注意</h1><p>DataTemplate内で定義したコントロールのアクセス修飾子にも注意する必要があります。 いくら、xamlが定義してあるアセンブリと同一のアセンブリに定義してあるコントロールだからといっても、そのコントロールの生成自体は、実行ファイルから生成が実行されるわけで。 つまり、DataTemplate内で使用されているコントロールは実行ファイルからアクセスできるようになっている、つまりpublicでないと下記のような例外を投げます。 <strong>System.Xaml.XamlObjectWriterException 不明な型 ‘{clr-namespace:ABC.DEF.GHI}CustomControl’ を作成できません。</strong></p><h1 id="XAML内の名前空間にも注意"><a href="#XAML内の名前空間にも注意" class="headerlink" title="XAML内の名前空間にも注意"></a>XAML内の名前空間にも注意</h1><p>DataTemplate内で定義した全ての要素の名前空間にも注意。 前段のアクセス修飾子での指摘の通り、要素の作成の基準はアプリが基準となるので、名前空間だけではアクセスできません。 ですので、DataTemplate内で、DataTemplateが存在するアセンブリ内の要素であったとしても、独自要素の名前空間の宣言は下記のように行う必要があります。 [code lang=”xaml”] xmlns:visualizer=”clr-namespace:ABC.DEF.GHI.CustomControl;assembly=ABC.DEF.GHI”&gt; [/code] この場合は、アクセス修飾子での指摘と全く同じ例外を投げます。 確かに、意味合いとしては存在しない、あるいは見えないクラスにアクセスしようとしているのだから、言いたいことはわかりますが….</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>リソースは、リソース自身が、どのように見られるか、という意識付けをしないと、読み込むことすらできないことがわかりました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その19 Red Hat Enterprise Linux 7.2にTeamViewerをインストールする</title>
      <link href="/2016/08/30/1660/"/>
      <url>/2016/08/30/1660/</url>
      
        <content type="html"><![CDATA[<h1 id="デスクトップ共有が動かない"><a href="#デスクトップ共有が動かない" class="headerlink" title="デスクトップ共有が動かない"></a>デスクトップ共有が動かない</h1><p>デスクトップ共有がRHELに付属しているのですが、これが動きません。 多分、私の使い方が間違っているのでしょうが、いい加減キーボードを行ったり来たりするのは嫌なので、<strong>TeamViewer</strong>を使ってさくっとつなげます。</p><h1 id="TeamViewerも動かない"><a href="#TeamViewerも動かない" class="headerlink" title="TeamViewerも動かない?"></a>TeamViewerも動かない?</h1><p><a href="https://www.teamviewer.com/ja/download/linux/">公式ページ</a>からダウンロードします。 幸いなことにRHELはサポート対象となっており、すぐに使えるようです。<br><a href="../../../../public/2016/08/img_57c58877c1e67.png"><img src="../../../../public/2016/08/img_57c58877c1e67.png"></a></p><p>Firefoxでダウンロード後、rpmパッケージを開きます。 ダイアログが出現し、インストールの確認を要求されますので、<strong>インストール</strong>を押下します。<br><a href="../../../../public/2016/08/img_57c588f57de2d.png"><img src="../../../../public/2016/08/img_57c588f57de2d.png"></a></p><p>プラグインみたいな…</p><p>が、失敗します。<br><a href="../../../../public/2016/08/img_57c58924c8d82.png"><img src="../../../../public/2016/08/img_57c58924c8d82.png"></a></p><p>(´・ω・`) ｼｮﾎﾞｰﾝ</p><p>何度やっても変わらないので、端末を開いて<strong>rpm -ivh &lt;パッケージファイル名&gt;**で直接インストールします。パッケージはダウンロードフォルダに落ちているはずです。 ちなみに、ファイルエクスプローラー上で右クリックし</strong>端末の中に開く**を選ぶと、そこがカレントディレクトリになって端末が開きます。便利だね！ [code lang=”sh”] [takuya@takuya-redhat ダウンロード]$ rpm -ivh teamviewer_11.0.57095.i686.rpm 警告: teamviewer_11.0.57095.i686.rpm: ヘッダー V4 DSA/SHA1 Signature、鍵 ID 72db573c: NOKEY エラー: 依存性の欠如: libSM.so.6 は teamviewer-11.0.57095-0.i686 に必要とされています libXdamage.so.1 は teamviewer-11.0.57095-0.i686 に必要とされています libXext.so.6 は teamviewer-11.0.57095-0.i686 に必要とされています libXfixes.so.3 は teamviewer-11.0.57095-0.i686 に必要とされています libXinerama.so.1 は teamviewer-11.0.57095-0.i686 に必要とされています libXrandr.so.2 は teamviewer-11.0.57095-0.i686 に必要とされています libXrender.so.1 は teamviewer-11.0.57095-0.i686 に必要とされています libXtst.so.6 は teamviewer-11.0.57095-0.i686 に必要とされています libasound.so.2 は teamviewer-11.0.57095-0.i686 に必要とされています libc.so.6(GLIBC_2.4) は teamviewer-11.0.57095-0.i686 に必要とされています libdbus-1.so.3 は teamviewer-11.0.57095-0.i686 に必要とされています libfontconfig.so.1 は teamviewer-11.0.57095-0.i686 に必要とされています libfreetype.so.6 は teamviewer-11.0.57095-0.i686 に必要とされています libgcc_s.so.1 は teamviewer-11.0.57095-0.i686 に必要とされています libjpeg.so.62 は teamviewer-11.0.57095-0.i686 に必要とされています libpng12.so.0 は teamviewer-11.0.57095-0.i686 に必要とされています libz.so.1 は teamviewer-11.0.57095-0.i686 に必要とされています [takuya@takuya-redhat ダウンロード]$ [/code] どうも依存関係の解決に失敗している模様。Ubuntuならapt-getなんですが。</p><h1 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h1><p>yumが必要のようです。 rpmは依存関係を解決してくれませんが、yumは依存関係も解決してくれるという優れもの。 ただ、前回話したように、RHELのサブスクリプションがないとyumは使えないので注意です。 先ほどのrpmパッケージをyumで指定してインストールします。 なお<strong>yum install</strong>は管理者権限が必要なので、sudoを付与します。 [code lang=”sh”] [takuya@takuya-redhat ダウンロード]$ sudo yum install teamviewer_11.0.57095.i686.rpm 読み込んだプラグイン:langpacks, product-id, search-disabled-repos, subscription-manager teamviewer_11.0.57095.i686.rpm を調べています: teamviewer-11.0.57095-0.i686 teamviewer_11.0.57095.i686.rpm をインストール済みとして設定しています 依存性の解決をしています –&gt; トランザクションの確認を実行しています。 —&gt; パッケージ teamviewer.i686 0:11.0.57095-0 を インストール –&gt; 依存性の処理をしています: libSM.so.6 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libXdamage.so.1 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libXext.so.6 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libXfixes.so.3 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libXinerama.so.1 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libXrandr.so.2 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libXrender.so.1 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libXtst.so.6 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libasound.so.2 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libc.so.6(GLIBC_2.4) のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libdbus-1.so.3 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libfontconfig.so.1 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libfreetype.so.6 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libgcc_s.so.1 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libjpeg.so.62 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libpng12.so.0 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; 依存性の処理をしています: libz.so.1 のパッケージ: teamviewer-11.0.57095-0.i686 –&gt; トランザクションの確認を実行しています。<br>(省略)<br>検証中 : util-linux-2.23.2-26.el7.x86_64 46/46<br>インストール: teamviewer.i686 0:11.0.57095-0<br>依存性関連をインストールしました: alsa-lib.i686 0:1.0.28-2.el7 dbus-libs.i686 1:1.6.12-14.el7_2 expat.i686 0:2.1.0-8.el7 fontconfig.i686 0:2.10.95-7.el7 freetype.i686 0:2.4.11-11.el7 glibc.i686 0:2.17-106.el7_2.8 libICE.i686 0:1.0.9-2.el7 libSM.i686 0:1.2.2-2.el7 libX11.i686 0:1.6.3-2.el7 libXau.i686 0:1.0.8-2.1.el7 libXdamage.i686 0:1.1.4-4.1.el7 libXext.i686 0:1.3.3-3.el7 libXfixes.i686 0:5.0.1-2.1.el7 libXi.i686 0:1.7.4-2.el7 libXinerama.i686 0:1.1.3-2.1.el7 libXrandr.i686 0:1.4.2-2.el7 libXrender.i686 0:0.9.8-2.1.el7 libXtst.i686 0:1.2.2-2.1.el7 libgcc.i686 0:4.8.5-4.el7 libjpeg-turbo.i686 0:1.2.90-5.el7 libpng12.i686 0:1.2.50-7.el7_2 libuuid.i686 0:2.23.2-26.el7_2.3 libxcb.i686 0:1.11-4.el7 nss-softokn-freebl.i686 0:3.16.2.3-14.2.el7_2 zlib.i686 0:1.2.7-15.el7<br>依存性を更新しました: dbus.x86_64 1:1.6.12-14.el7_2 dbus-libs.x86_64 1:1.6.12-14.el7_2 dbus-x11.x86_64 1:1.6.12-14.el7_2 glibc.x86_64 0:2.17-106.el7_2.8 glibc-common.x86_64 0:2.17-106.el7_2.8 libblkid.x86_64 0:2.23.2-26.el7_2.3 libmount.x86_64 0:2.23.2-26.el7_2.3 libuuid.x86_64 0:2.23.2-26.el7_2.3 nss-softokn-freebl.x86_64 0:3.16.2.3-14.2.el7_2 util-linux.x86_64 0:2.23.2-26.el7_2.3<br>完了しました! [/code] つらつら、と依存関係を解決し、インストールを完了してくれます。 完了後、端末でteamviewerと入力することで、TeamViewerが起動します。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>コマンド覚えるのがしんどいです。Ubuntuのapt-getすら忘れそうなのに…</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> %e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%87%e3%82%b9%e3%82%af%e3%83%88%e3%83%83%e3%83%97 </category>
          
          <category> TeamViewer </category>
          
          <category> リモートデスクトップ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その18 Intel NUC DN2820FYKHにRed Hat Enterprise Linux 7.2をインストールする</title>
      <link href="/2016/08/30/1641/"/>
      <url>/2016/08/30/1641/</url>
      
        <content type="html"><![CDATA[<h1 id="OSを変えて再挑戦"><a href="#OSを変えて再挑戦" class="headerlink" title="OSを変えて再挑戦"></a>OSを変えて再挑戦</h1><p><a href="http://wp.me/p7138e-qe">前回</a>はFedora 24のインストールに失敗しました。 Fedora 23に挑戦してもよいのですが、Red Hat Enterprise Linuxが開発目的なら無料で使えるようになったことを知ったので、それを試すことにしました。 まずは下記のページに移動します。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://developers.redhat.com/products/rhel/download/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=developers.redhat.com"></img><div class="hbc-site-name">Red Hat Developer</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://developers.redhat.com/themes/custom/rhdp2/images/metatags/metatag-image-global.png"></img></div><div class="hbc-text"><div class="hbc-title">Red Hat Enterprise Linux | Red Hat Developer</div><div class="hbc-url">http://developers.redhat.com/products/rhel/download/</div><div class="hbc-description">A stable, proven foundation that’s versatile enough for rolling out new applications, virtualizing environments, and creating a secure hybri…</div></div></div></div></a></div></div><p>入手には無料のユーザ登録が必要なのでページ上部の<strong>REGISTER</strong>から登録を。 登録後、トップページを開き。<br><a href="../../../../public/2016/08/img_57c43028774c3.png"><img src="../../../../public/2016/08/img_57c43028774c3.png"></a></p><p>ちょっと派手なページ</p><p><strong>TECHNOLOGIES</strong>から<strong>Red Hat Enterprise Linux</strong>を選択。<br><a href="../../../../public/2016/08/img_57c4301030437.png"><img src="../../../../public/2016/08/img_57c4301030437.png"></a></p><p>GET STARTEDをクリック。<br><a href="../../../../public/2016/08/img_57c4304033eab.png"><img src="../../../../public/2016/08/img_57c4304033eab.png"></a></p><p>最後に、**Download the Red Hat Enterprise Linux Server DVD .iso file.**をクリックしてisoファイルをダウンロードします。4GB近くあるので待機。 バージョンは7.2でした。なお64bit版しかない模様。<br><a href="../../../../public/2016/08/img_57c4307e584c1.png"><img src="../../../../public/2016/08/img_57c4307e584c1.png"></a></p><h1 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h1><p>の前に、USBメモリにISOを展開しますが、前回使った、Universal USB Installerの一覧にRedhatは存在しない模様。 ところが、Red Hatの公式で、USBインストーラの作成方法を公開していました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/sect-making-usb-media.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=access.redhat.com"></img><div class="hbc-site-name">Red Hat Customer Portal</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://access.redhat.com/webassets/avalon/g/shadowman-200.png"></img></div><div class="hbc-text"><div class="hbc-title">3.2. USB インストールメディアの作成 Red Hat Enterprise Linux 7 | Red Hat Customer Portal</div><div class="hbc-url">https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/sect-making-usb-media.html</div><div class="hbc-description">The Red Hat Customer Portal delivers the knowledge, expertise, and guidance available through your Red Hat subscription.</div></div></div></div></a></div></div><p>手順は上に従うだけです。 USBインストーラ作成ツールのためだけに、インストーラが走るのは気に入りませんが…終わったら消します。はい。 作成が完了したら、再びUSBメモリをNUCに差し込み起動します。 しばらくすれば、<strong>Install Red Hat Enterprise Linux 7.2</strong>という文字列が出てくるので選択してEnterを押します。 そのあとは、基本画面に従えばインストールは簡単に進みます。 パーティションはデフォルトで、ユーザは別に作らなくてもいいかと。 ただし、構成はサーバー (GUI使用)でインストールします。でないとGUIがないのかも(未確認)。 ウィザードに従って、インストールが完了すると再起動します。 再起動後、コンソールで下記のような画面になります。 [code lang=”sh”] Initial setup of Red Hat Enterprise Linux Server Linux 7.2 (Maipo) 1) [!] License information 2) [x] User creation (License not accepted) (No user will be created) Please make your choice from above [‘q’ to quit | ‘c’ to continue | ‘r’ to refresh]: [/code] 非常にわかりにくいですが、ライセンスの許諾を求められているので、1を入力してEnter。 さらに次の画面に遷移します。 [code lang=”sh”] License Information  </p><ol><li>Read the License Agreement<br>[ ] 2) I accept the licnese agreement.<br>Please make your choice from above [‘q’ to quit | ‘c’ to continue | ‘r’ to refresh]: [/code] 1を押下してライセンスを読んだ後、2、Enterと押下 して x マークをつけてから、c、Enterと押下してライセンスの許諾に同意します。 そして、最初の画面に戻り、<strong>license not accepted</strong>が<strong>license accepterd</strong>に変わるので、 c、Enterと押下して確定します。 そして、待ち望んだRed Hatのデスクトップが起動します。デフォルトのGNOMEの洗練されたデザインが出迎えてくれます。 ネットワークの設定は、画面左上の<strong>アプリケーション</strong>の<strong>システムツール-&gt;設定-&gt;ネットワーク</strong>から設定できます。Windowsのネットワーク設定が使用できれば楽勝です。</li></ol><h1 id="サブスクリプションの登録"><a href="#サブスクリプションの登録" class="headerlink" title="サブスクリプションの登録"></a>サブスクリプションの登録</h1><p>これをやらないと何もできないようです。 どうもRHELは、サブスクリプションを登録することで、各種パッケージの追加を行うyumのリポジトリを使用できるようになる模様。 このままでは、依存解決とかが非常に面倒です。 なので、登録を実施します。 アプリケーションの<strong>システムツール-&gt;Red Hat サブスクリプションマネージャー</strong>を起動します。 root認証後、下記のダイアログが表示されます。 まず<strong>登録</strong>を押下します。<br><a href="../../../../public/2016/08/img_57c5840d5afee.png"><img src="../../../../public/2016/08/img_57c5840d5afee.png"></a></p><p>rootが必要</p><p><strong>次へ</strong>を押下します。<br><a href="../../../../public/2016/08/img_57c5841bd5ca2.png"><img src="../../../../public/2016/08/img_57c5841bd5ca2.png"></a></p><p>RHELをダウンロードするときに作成したアカウント情報で認証します。<br><a href="../../../../public/2016/08/img_57c58426a7227.png"><img src="../../../../public/2016/08/img_57c58426a7227.png"></a></p><p><strong>割り当て</strong>を押下します。<br><a href="../../../../public/2016/08/img_57c5842e0c9c4.png"><img src="../../../../public/2016/08/img_57c5842e0c9c4.png"></a></p><p>無事に認証されました。<br><a href="../../../../public/2016/08/img_57c5843a71758.png"><img src="../../../../public/2016/08/img_57c5843a71758.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Linuxは面倒ですね。でもデスクトップが洗練されているRHELは結構とっつきやすいです。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Red Hat Enterprise Linux </category>
          
          <category> Intel </category>
          
          <category> intel </category>
          
          <category> NUC </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その17 Intel NUC DN2820FYKHにFedora 24をインストールする (失敗編)</title>
      <link href="/2016/08/29/1626/"/>
      <url>/2016/08/29/1626/</url>
      
        <content type="html"><![CDATA[<h1 id="USBメモリからインストール"><a href="#USBメモリからインストール" class="headerlink" title="USBメモリからインストール"></a>USBメモリからインストール</h1><p><strong>DN2820FYKH</strong>にFedora 24をインストールします。BIOSは0052です。 Web上ではLinuxのインストールに色々罠が転がっている、とのことですが… NUCには光学ドライブがないので、USBメモリからインストールします。 ブータブルUSBメモリをFedoraのLiveCDから作成します。 <a href="http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/">Universal USB Installer</a>から最新版を入手します。 2016年8月末の時点で最新版は1.9.6.6です。 ダウンロードして起動すると、インストーラではなく、すぐに実行されます。<br><a href="../../../../public/2016/08/img_57c3184c90b29.png"><img src="../../../../public/2016/08/img_57c3184c90b29.png"></a></p><p>利用規約の同意</p><p>利用規約に同意したら、Fedora Live Desktopを選択し、FedoraのLive CDのisoファイルを指定します。 最後に、USBメモリを指定します。<br><a href="../../../../public/2016/08/img_57c31856b4188.png"><img src="../../../../public/2016/08/img_57c31856b4188.png"></a></p><p>Fedoraを Live Desktopを指定</p><p>警告が出ますが、展開先のUSBメモリさえ間違っていなければ特に気にしなくていいです。 当然、USBメモリは初期化されます。<br><a href="../../../../public/2016/08/img_57c3186a37179.png"><img src="../../../../public/2016/08/img_57c3186a37179.png"></a></p><p>警告</p><p><a href="../../../../public/2016/08/img_57c3186fe98ea.png"><img src="../../../../public/2016/08/img_57c3186fe98ea.png"></a> <a href="../../../../public/2016/08/img_57c31876cd3e0.png"><img src="../../../../public/2016/08/img_57c31876cd3e0.png"></a></p><p>7zipで展開される模様</p><p><a href="../../../../public/2016/08/img_57c3187e3bbb7.png"><img src="../../../../public/2016/08/img_57c3187e3bbb7.png"></a></p><p>完了</p><p><a href="../../../../public/2016/08/img_57c31883f0e2f.png"><img src="../../../../public/2016/08/img_57c31883f0e2f.png"></a></p><p>およそ1.5GB消費</p><h1 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h1><p>USBメモリを差して、NUCを起動します。 通常は何もしなくても、ブートが始まります。適宜BIOSからブートシーケンスをいじくるなりして対応します。 起動後、<strong>Start Fedora-Workstation-Live 24</strong>を選択して、Fedoraが立ち上がるのを待機します。</p><p>が、ダメ。 何度やっても、<strong>Entering emergency mode. Exit the shell to continue.**というエラーで起動できません。 Fedoraは</strong>Red Hat Enterprise Linux**の新しい技術の実験場のような役割らしいので、ハードが対応していない可能性があります。 なので、Fedora 24はあきらめます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>BIOSのアップデートに続き、OSのインストールもこける。大丈夫か？</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> Intel </category>
          
          <category> Fedora </category>
          
          <category> intel </category>
          
          <category> NUC </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その16 Intel NUC DN2820FYKHのBIOS更新</title>
      <link href="/2016/08/29/1620/"/>
      <url>/2016/08/29/1620/</url>
      
        <content type="html"><![CDATA[<h1 id="BIOSの入手"><a href="#BIOSの入手" class="headerlink" title="BIOSの入手"></a>BIOSの入手</h1><p><strong>DN2820FYKH</strong>をヤフオクで、メモリ、HDD付き、送料込みで15Kで入手したので。 最新のBIOSにしないとOSのインストールすらできないという話なので、2016年8月現在で最新のBIOSは0053になります。 Intelの<a href="https://downloadcenter.intel.com/">Download Center</a>より、型番のDN2820FYKHで検索をかけます。<br><a href="../../../../public/2016/08/img_57c3159fb1865.png"><img src="../../../../public/2016/08/img_57c3159fb1865.png"></a></p><p><a href="../../../../public/2016/08/img_57c315eb78095.png"><img src="../../../../public/2016/08/img_57c315eb78095.png"></a></p><p><a href="../../../../public/2016/08/img_57c315fe93237.png"><img src="../../../../public/2016/08/img_57c315fe93237.png"></a></p><p>ダウンロードしたファイル<strong>FY0053.BIO</strong>はUSBメモリにコピーします。</p><h1 id="BIOSの更新"><a href="#BIOSの更新" class="headerlink" title="BIOSの更新"></a>BIOSの更新</h1><p>NUC電源投入後、F2を押下しBIOSに入ります。 その後F7を押下し、ダイアログに対してNoと返します。 これによりファイルからBIOSを選択してアップデートできます。 後は自動でBIOSの更新が始まります。 めでたしめでたし。</p><p>ではありませんでした。 何度やっても、**Technical information: (0x800000000000000E, 0)**というエラーを出して失敗します。 幸い、BIOSが壊れることはありませんでしたが、結局原因もわからずBIOSの更新をあきらめました。 ただ、最初から入っていたBIOSが0052とひとつ前で比較的新しかったのが幸いでした。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>不吉なNUCデビューになりました。</p>]]></content>
      
      
      <categories>
          
          <category> Intel </category>
          
          <category> intel </category>
          
          <category> NUC </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その15 OpenCVで機械学習をする際の注意 その2</title>
      <link href="/2016/08/26/1618/"/>
      <url>/2016/08/26/1618/</url>
      
        <content type="html"><![CDATA[<h1 id="本当に情報が少ないので"><a href="#本当に情報が少ないので" class="headerlink" title="本当に情報が少ないので"></a>本当に情報が少ないので</h1><p><strong>opencv_traincascade.exe</strong>で学習を進める際、またも意味がわかりにくいエラーがたくさん出ます。</p><h1 id="Train-dataset-for-temp-stage-can-not-be-filled-Branch-training-terminated"><a href="#Train-dataset-for-temp-stage-can-not-be-filled-Branch-training-terminated" class="headerlink" title="Train dataset for temp stage can not be filled. Branch training terminated."></a>Train dataset for temp stage can not be filled. Branch training terminated.</h1><p>直訳すれば、<strong>「一時的なステージに対する訓練データセットを完成できませんでした。枝分かれしたトレーニングは中断しました。」</strong>になりますが、抽象的過ぎて意味がわかりません。 このエラーはいろいろな時にでます。 私の場合、不正解画像リストを指定したが、リスト内のパスが全部間違っていて画像を一切読み込むことができない時、<strong>「Cascade classifier can’t be trained. Check the used training parameters.」</strong>というメッセージとともに、このエラーが発生しました。 このケースの場合、学習ステージ0で即座に失敗します。 ところが、不正解画像が正解画像に比べて極端に少なかったりすると、ステージの途中でエラーになって終了します。 数時間かけた学習が無に帰す瞬間です。 [code lang=”batch”] END&gt; Training until now has taken 0 days 3 hours 54 minutes 53 seconds.<br>===== TRAINING 9-stage ===== &lt;BEGIN POS count : consumed 3600 : 3648 NEG count : acceptanceRatio 254 : 6.50276e-006 Precalculation time: 5.756 +—-+———+———+ | N | HR | FA | +—-+———+———+ | 1| 0.998889| 0.279528| +—-+———+———+ END&gt; Training until now has taken 0 days 9 hours 57 minutes 22 seconds.<br>===== TRAINING 10-stage ===== &lt;BEGIN POS count : consumed 3600 : 3652 Train dataset for temp stage can not be filled. Branch training terminated. [/code] また、上のケースの場合、acceptanseRatio末尾の数字が浮動小数点のような状態になっています。 こうなっている場合は、過学習に陥っている可能性があるとのこと。 もっと、わかりやすいエラーを出して欲しいです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>OpenCVの解説書籍を読もうと思いましたが、O’Reillyの<strong>詳解 OpenCV</strong>はかなり古くなってしました。しかし、2016年11月に最新バージョン3に対応した版が発売されるようです。英語ですが。機械学習部分だけでも読めないでしょうかね？</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> OpenCV </category>
          
          <category> 機械学習 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その14 OpenCVで機械学習をする際の注意</title>
      <link href="/2016/08/25/1607/"/>
      <url>/2016/08/25/1607/</url>
      
        <content type="html"><![CDATA[<h1 id="情報が少ないので"><a href="#情報が少ないので" class="headerlink" title="情報が少ないので"></a>情報が少ないので</h1><p>OpenCV付属のツールで、機械学習に必要なベクトルデータ (ディープラーニングで言う学習データ？と私は思っています)を作る<strong>opencv_createsamples.exe</strong>を使う際の注意。 学習対象となる画像を用意し、リストファイルに記載することで、画像からベクトルデータを作成します。 が、このリストを作る際にはまったのでメモ。</p><ul><li>リストファイルのパス区切り文字列は / でも \ でもOK</li><li>絶対パスでもOK</li><li>ただし、絶対パスでも相対パスでも空白がパスに入るとダメ。例えダブルクォーテーションで囲ってもダメ。ダブルクォーテーションで囲むと、空白の有無に関係なくエラーになる</li><li>サンプル数や座標の区切りの空白の数は1でも2でもOK</li><li>エンコードに注意。Shift-Jis、UTF8でもいいが、BOMありはアウト</li></ul><p>また、関連ツールに<strong>opencv_traincascade.exe</strong>があります。 これは、<strong>opencv_createsamples.exe</strong>で作ったベクトルデータと、背景画像のリストを入力して学習済みモデルを生成するためのツールです。 このツールも少し注意です。</p><ul><li>リストファイルのパス区切り文字列は / でも \ でもOK</li><li>絶対パスでもOK</li><li>ただし、絶対パスでも相対パスでも空白がパスに入るとダメ。例えダブルクォーテーションで囲ってもダメ。ダブルクォーテーションで囲むと、空白の有無に関係なくエラーになる</li><li>エンコードに注意。Shift-Jis、UTF8でもいいが、BOMありはアウト</li></ul><p>ここは、前段と同じです。 他には、<strong>opencv_traincascade.exe</strong>でベクトルデータを作成する際、次元数を <strong>-h 48 -w 48</strong> のように、縦横で指定しますが、この時の入力と同じ引数を<strong>opencv_traincascade.exe</strong>に渡します、 さもなくば、 [code lang=”batch”] &lt;BEGIN OpenCV Error: Assertion failed (_img.rows * _img.cols == vecSize) in CvCascadeIm ageReader::PosReader::get, file C:\builds\2_4_PackSlave-win64-vc12-shared\opencv \apps\traincascade\imagestorage.cpp, line 157 [/code] みたいなエラーがでます、 ようするに、ベクトルデータの次元数と背景画像データをベクトルデータにする際の次元数が違いますよ、ってことです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>正直、ファイルリストだけでここまではまるとは思ってもみませんでした。 何度Linux版を使おうか、と諦めかけたことか。</p>]]></content>
      
      
      <categories>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> OpenCV </category>
          
          <category> 機械学習 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでIBM Bluemixを試してみる 第4回 -失敗編-</title>
      <link href="/2016/08/24/1583/"/>
      <url>/2016/08/24/1583/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-pp">前回</a>はBluemix上の.NET Coreを更新するべく作業しました(途中)。</p><a id="more"></a><h1 id="Bluemix-CLI"><a href="#Bluemix-CLI" class="headerlink" title="Bluemix CLI"></a>Bluemix CLI</h1><p>前回は、Bluemix CLIのインストーラを入手しました。 これをインストールします。<br><a href="../../../../public/2016/08/img_57adc69b6ec13.png"><img src="../../../../public/2016/08/img_57adc69b6ec13.png"></a></p><p><a href="../../../../public/2016/08/img_57adc6a030fda.png"><img src="../../../../public/2016/08/img_57adc6a030fda.png"></a></p><p><a href="../../../../public/2016/08/img_57adc6a3edf45.png"><img src="../../../../public/2016/08/img_57adc6a3edf45.png"></a></p><p>インストール先の指定すらない….</p><p><a href="../../../../public/2016/08/img_57adc6a8d1a24.png"><img src="../../../../public/2016/08/img_57adc6a8d1a24.png"></a></p><p><a href="../../../../public/2016/08/img_57adc6b7b2257.png"><img src="../../../../public/2016/08/img_57adc6b7b2257.png"></a></p><p><a href="../../../../public/2016/08/img_57adc6bc7a797.png"><img src="../../../../public/2016/08/img_57adc6bc7a797.png"></a></p><p>はいはい、再起動再起動</p><h1 id="buildpack更新"><a href="#buildpack更新" class="headerlink" title="buildpack更新"></a>buildpack更新</h1><p>注:この先の処理を実施するとBluemixのアプリの環境が壊れます。 ダッシュボードのCF CLIの説明から、Bluemixへの接続がわかりましたので、CF CLIによるbuildpackの更新は下記の流れになります。 管理者権限でコマンドプロンプトを立ち上げ、gitでクローンしたアプリのディレクトリに移動します。 次に下記のコマンドをメモ帳にでも張り付けて、コマンドプロンプトに張り付けます。 (当然文字列は各自環境に応じて置換すること) [code lang=”batch”] bluemix api <a href="https://api.au-syd.bluemix.net/">https://api.au-syd.bluemix.net</a> bluemix login -u &lt;Bluemix ユーザーID&gt; -o &lt;組織の名前&gt; -s &lt;スペースの名前&gt; &lt;Bluemixのパスワード&gt; cf push &lt;アプリの名前&gt; -b <a href="https://github.com/cloudfoundry-community/dotnet-core-buildpack.git">https://github.com/cloudfoundry-community/dotnet-core-buildpack.git</a> [/code] これにより、対話をすることなくbuildpackの更新が始まります。 &lt; p style=”margin-top: 400px;”&gt; が、失敗します。 正確には、buildpackの更新はうまくいっている感じです。 [code lang=”batch”] D:\Works\OpenSource\IBM Bluemix\TRY-BLUEMIX-TEST1&gt;bluemix api <a href="https://api.au-syd.bluemix.net/">https://api.au-syd.bluemix.net</a> ‘cf api <a href="https://api.au-syd.bluemix.net&/#39;">https://api.au-syd.bluemix.net&#39;</a> を起動しています…<br>Setting api endpoint to <a href="https://api.au-syd.bluemix.net/">https://api.au-syd.bluemix.net</a>… OK<br>API endpoint: <a href="https://api.au-syd.bluemix.net/">https://api.au-syd.bluemix.net</a> (API version: 2.54.0) User: <a href="mailto:&#104;&#111;&#103;&#x65;&#x68;&#x6f;&#103;&#x65;&#x40;&#104;&#x6f;&#103;&#101;&#46;&#x63;&#x6f;&#109;">&#104;&#111;&#103;&#x65;&#x68;&#x6f;&#103;&#x65;&#x40;&#104;&#x6f;&#103;&#101;&#46;&#x63;&#x6f;&#109;</a> Org: TRY-BLUEMIX Space: SPACE1<br>D:\Works\OpenSource\IBM Bluemix\TRY-BLUEMIX-TEST1&gt;bluemix login -u <a href="mailto:&#x68;&#111;&#103;&#101;&#104;&#x6f;&#x67;&#x65;&#x40;&#104;&#111;&#x67;&#101;&#x2e;&#x63;&#x6f;&#x6d;">&#x68;&#111;&#103;&#101;&#104;&#x6f;&#x67;&#x65;&#x40;&#104;&#111;&#x67;&#101;&#x2e;&#x63;&#x6f;&#x6d;</a> -o TRY-BLUEMIX -s SPACE1 ‘cf login -u <a href="mailto:&#x68;&#x6f;&#103;&#101;&#104;&#x6f;&#103;&#101;&#x40;&#x68;&#x6f;&#x67;&#101;&#x2e;&#x63;&#111;&#109;">&#x68;&#x6f;&#103;&#101;&#104;&#x6f;&#103;&#101;&#x40;&#x68;&#x6f;&#x67;&#101;&#x2e;&#x63;&#111;&#109;</a> -o TRY-BLUEMIX -s SPACE1’ を起動しています…<br>API endpoint: <a href="https://api.au-syd.bluemix.net/">https://api.au-syd.bluemix.net</a><br>Password&gt; Authenticating… OK<br>Targeted org TRY-BLUEMIX<br>Targeted space SPACE1<br>API endpoint: <a href="https://api.au-syd.bluemix.net/">https://api.au-syd.bluemix.net</a> (API version: 2.54.0) User: <a href="mailto:&#104;&#111;&#x67;&#x65;&#x68;&#x6f;&#103;&#x65;&#64;&#x68;&#111;&#x67;&#x65;&#x2e;&#x63;&#111;&#x6d;">&#104;&#111;&#x67;&#x65;&#x68;&#x6f;&#103;&#x65;&#64;&#x68;&#111;&#x67;&#x65;&#x2e;&#x63;&#111;&#x6d;</a> Org: TRY-BLUEMIX Space: SPACE1<br>D:\Works\OpenSource\IBM Bluemix\TRY-BLUEMIX-TEST1&gt;cf push TRY-BLUEMIX-TEST1 -b <a href="https://github.com/cloudfoundry-community/dotnet-core-buildpack.git">https://github.com/cloudfoundry-community/dotnet-core-buildpack.git</a> Using manifest file D:\Works\OpenSource\IBM Bluemix\TRY-BLUEMIX-TEST1\manifest.yml<br>Updating app TRY-BLUEMIX-TEST1 in org TRY-BLUEMIX / space SPACE1 as <a href="mailto:&#104;&#x6f;&#103;&#x65;&#x68;&#x6f;&#103;&#x65;&#64;&#104;&#x6f;&#x67;&#101;&#x2e;&#x63;&#x6f;&#x6d;">&#104;&#x6f;&#103;&#x65;&#x68;&#x6f;&#103;&#x65;&#64;&#104;&#x6f;&#x67;&#101;&#x2e;&#x63;&#x6f;&#x6d;</a>… OK<br>Using route try-bluemix-test1.au-syd.mybluemix.net Uploading TRY-BLUEMIX-TEST1… Uploading app files from: D:\Works\OpenSource\IBM Bluemix\TRY-BLUEMIX-TEST1 Uploading 33K, 17 files Done uploading OK<br>Stopping app TRY-BLUEMIX-TEST1 in org TRY-BLUEMIX / space SPACE1 as <a href="mailto:&#104;&#111;&#x67;&#x65;&#104;&#111;&#103;&#101;&#64;&#x68;&#111;&#103;&#101;&#46;&#x63;&#x6f;&#x6d;">&#104;&#111;&#x67;&#x65;&#104;&#111;&#103;&#101;&#64;&#x68;&#111;&#103;&#101;&#46;&#x63;&#x6f;&#x6d;</a>… OK<br>Starting app TRY-BLUEMIX-TEST1 in org TRY-BLUEMIX / space SPACE1 as <a href="mailto:&#104;&#x6f;&#x67;&#x65;&#x68;&#x6f;&#103;&#x65;&#64;&#x68;&#x6f;&#x67;&#101;&#x2e;&#x63;&#x6f;&#109;">&#104;&#x6f;&#x67;&#x65;&#x68;&#x6f;&#103;&#x65;&#64;&#x68;&#x6f;&#x67;&#101;&#x2e;&#x63;&#x6f;&#109;</a>… —–&gt; Downloaded app package (24K) —–&gt; Downloaded app buildpack cache (138M)<br>Cloning into ‘/tmp/buildpacks/dotnet-core-buildpack’…<br>Submodule ‘compile-extensions’ (<a href="https://github.com/cloudfoundry-incubator/compile-extensions.git">https://github.com/cloudfoundry-incubator/compile-extensions.git</a>) registered for path ‘compile-extensions’ Cloning into ‘compile-extensions’… Submodule path ‘compile-extensions’: checked out ‘211c02226a2612c8a3b724ebb0983c88b8c95e75’ ASP.NET Core buildpack version: 0.9.0 ASP.NET Core buildpack starting compile —–&gt; Restoring files from buildpack cache Copied 37 files from /tmp/cache/libunwind to /tmp/staged/app Copied 199 files from /tmp/cache/.dotnet to /tmp/staged/app Copied 8120 files from /tmp/cache/.nuget to /tmp/staged/app OK —–&gt; Extracting libunwind libunwind version: 1.1 <a href="https://github.com/cloudfoundry-community/dotnet-core-buildpack/releases/download/v0.7/libunwind-cflinuxfs2-1.1.tar.gz">https://github.com/cloudfoundry-community/dotnet-core-buildpack/releases/download/v0.7/libunwind-cflinuxfs2-1.1.tar.gz</a> OK —–&gt; Installing Dotnet CLI dotnet version: 1.0.0-preview2-003121 <a href="https://go.microsoft.com/fwlink/?LinkID=809129">https://go.microsoft.com/fwlink/?LinkID=809129</a> OK —–&gt; Restoring dependencies with Dotnet CLI Welcome to .NET Core! ——————— Learn more about .NET Core @ <a href="https://aka.ms/dotnet-docs">https://aka.ms/dotnet-docs</a>. Use dotnet –help to see available commands or go to <a href="https://aka.ms/dotnet-cli-docs">https://aka.ms/dotnet-cli-docs</a>. Telemetry ————– The .NET Core tools collect usage data in order to improve your experience. The data is anonymous and does not include commandline arguments. The data is collected by Microsoft and shared with the community. You can opt out of telemetry by setting a DOTNET_CLI_TELEMETRY_OPTOUT environment variable to 1 using your favorite shell. You can read more about .NET Core tools telemetry @ <a href="https://aka.ms/dotnet-cli-telemetry">https://aka.ms/dotnet-cli-telemetry</a>. Configuring… ——————- A command is running to initially populate your local package cache, to improve restore speed and enable offline access. This command will take up to a minute to complete and will only happen once. Decompressing 100% 3819 ms Expanding 100% 6266 ms log : Restoring packages for /tmp/staged/app/src/dotnetstarter/project.json… log : Writing lock file to disk. Path: /tmp/staged/app/src/dotnetstarter/project.lock.json log : src/dotnetstarter/project.json log : Restore completed in 2969ms. OK —–&gt; Saving to buildpack cache Copied 1 files from /tmp/staged/app/libunwind to /tmp/cache Copied 203 files from /tmp/staged/app/.dotnet to /tmp/cache Copied 7552 files from /tmp/staged/app/.nuget to /tmp/cache OK ASP.NET Core buildpack is done creating the droplet —–&gt; Uploading droplet (292M)<br>0 of 1 instances running, 1 starting 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 down 0 of 1 instances running, 1 down 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 down 0 of 1 instances running, 1 down 0 of 1 instances running, 1 down 0 of 1 instances running, 1 down 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 starting 0 of 1 instances running, 1 down 0 of 1 instances running, 1 down Could not fetch instance count: Server error, status code: 400, error code: 170002, message: App has not finished staging Could not fetch instance count: Server error, status code: 400, error code: 170002, message: App has not finished staging Could not fetch instance count: Server error, status code: 400, error code: 170002, message: App has not finished staging Could not fetch instance count: Server error, status code: 400, error code: 170002, message: App has not finished staging Could not fetch instance count: Server error, status code: 400, error code: 170002, message: App has not finished staging [/code] Installing Dotnet CLI dotnet version: 1.0.0-preview2-003121とあり、OKと言っているので、更新は成功したのでしょう。 でも、その後アプリを再起動しても起動に失敗しています。 ダッシュボードを見ると、<br><a href="../../../../public/2016/08/img_57ade144b39bd.png"><img src="../../../../public/2016/08/img_57ade144b39bd.png"></a></p><p>一瞬Sad Macに見えた</p><p>となって、ASP.NET Coreの名前が消えてしまいました。 どうも環境を壊してしまった模様。 とりあえず、bluemixの環境を変えるのではなく、ローカルを合わせるという方針で開発をしていこうと思います。 (そもそもWindows 7上で開発する意味もあまりない気がしますが….)</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>非常に残念な結果になりました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでIBM Bluemixを試してみる </category>
          
          <category> paas </category>
          
          <category> IBM Bluemix </category>
          
          <category> PaaS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その13 CodeLensを無効にする</title>
      <link href="/2016/08/21/1603/"/>
      <url>/2016/08/21/1603/</url>
      
        <content type="html"><![CDATA[<h1 id="正直邪魔"><a href="#正直邪魔" class="headerlink" title="正直邪魔"></a>正直邪魔</h1><p>Visual Studioには<strong>CodeLens</strong>と呼ばれる、ソースコード上で、変更履歴を確認できる機能があります。 当初、この機能は Visual Studio 2013 Ultimateから導入され、2015では Professional からも利用できるようになりました。 最初は、すげー、って思ったんですけどね。いや、いい機能だとは思います。 が、この機能が有効だと、ソースコードをぱっと見たとき、1行空行があるのかどうか誤認することが多くなり、空行を重視する私のスタイルにおいて邪魔以外の何者でもありません。 なので、これを無効にしたのでメモ。 方法は、オプション画面の下記設定から。<br><a href="../../../../public/2016/08/img_57b8a4e313b42.png"><img src="../../../../public/2016/08/img_57b8a4e313b42.png"></a></p><p>オプション画面</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>正直、履歴の検索ってそこまでしないんですよね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでIBM Bluemixを試してみる 第3回</title>
      <link href="/2016/08/17/1575/"/>
      <url>/2016/08/17/1575/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-oX">前回</a>はアプリを動かしましたが、コミットによって動かなくなりました。</p><a id="more"></a><h1 id="問題の切り分け"><a href="#問題の切り分け" class="headerlink" title="問題の切り分け"></a>問題の切り分け</h1><p>前回は、index.htmlとglobal.jsonを書き換えました。 index.htmlはHello Worldという文字列を変更しただけなので、これが動かなくなった原因とは思えません。 となると、global.jsonに対して適用した、.NET Core SDKの変更が問題に見えます。 というわけで、global.jsonの変更だけを元に戻してコミット、プッシュし、再度Bluemix上のアプリを確認します。<br><a href="../../../../public/2016/08/img_57adb7afab4e6.png"><img src="../../../../public/2016/08/img_57adb7afab4e6.png"></a></p><p>It works!!</p><p>問題ないです。 これで、問題が.NET Core SDKのバージョンが問題になっていることは確定です。</p><h1 id="NET-Coreの変更"><a href="#NET-Coreの変更" class="headerlink" title=".NET Coreの変更"></a>.NET Coreの変更</h1><p>.NET Core SDKを1.0.0-preview1-002702から1.0.0-preview2-003121に変更したことが問題なのはわかりました。 実行環境に、1.0.0-preview2-003121がインストールされていないのが問題ならば選択肢は2つです。</p><ul><li>ローカル環境の.NET Core SDKのバージョンをBluemixに合わせる</li><li>Bluemixの.NET Core SDKのバージョンをローカル環境に合わせる</li></ul><p>が、前者はありえません。 .NET Core SDKの最新版が出るたびに、指をくわえて待つというのはあまりにもチキンです。 なので、ここはBluemixの環境を変更します。 Google先生に聞いてみても、芳しい結果が得られませんでしたが、公式ドキュメントの<a href="https://console.ng.bluemix.net/docs/whatsnew/index.html">What’s new in Bluemix</a>に気になる記述が。</p><blockquote><p>Upgrade to the ASP.NET Core buildpack New as of: 12 July 2016 This buildpack makes the .NET Core V1.0 and .NET Core SDK V1.0 Preview 2 available in Bluemix. Existing RC2 apps will continue to work with this buildpack as long as you specify the correct SDK version in your global.json file.</p></blockquote><p>buildpackなるものが.NET Core V1.0とPreview2で利用可能になった、と言っています。 でも、<strong>1.0.0-preview2-003121</strong>にしたのに動かないじゃん….</p><h1 id="What-is-buildpack"><a href="#What-is-buildpack" class="headerlink" title="What is buildpack?"></a>What is buildpack?</h1><p>buildpackとは、<a href="http://ipcrm.hatenablog.com/entry/2014/04/27/212642">まいち様</a>によれば、</p><blockquote><p>実行環境を構築するときの振る舞いを指定するもの。</p></blockquote><p>とあります。 Cloud Foundryの公式ドキュメントで<a href="http://docs.cloudfoundry.org/buildpacks/">buildpackの説明</a>を見ると</p><blockquote><p>Buildpacks provide framework and runtime support for your applications. Buildpacks typically examine user-provided artifacts to determine what dependencies to download and how to configure applications to communicate with bound services.</p></blockquote><p>Buildpackはアプリケーションのためのフレームワークと実行環境のサポートを提供します。通常、Buildpackは、ダウンロードのための何に依存しているかを決定するため、境界のサービス群とやりとりするためにアプリケーションをどのように設定するか、ユーザーが提供するアーティファクト(訳注:おそらく開発者が作成したアプリや成果物全般)を調査します。 とのこと。一言で言うなら、ランタイムと私は理解しました。 なので、このbuildpackを更新すれば動く、と考えました。 公式でPreview2のbuildpackが利用可能になった、というのはbuildpackが登場しただけで、アプリの実行環境のbuildpackは最新ではないよ、ということなのでしょう。</p><h1 id="buildpackを更新"><a href="#buildpackを更新" class="headerlink" title="buildpackを更新"></a>buildpackを更新</h1><p>.NET Coreのbuildpackはgithubで開発されていました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/cloudfoundry-community/dotnet-core-buildpack" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars3.githubusercontent.com/u/621746?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">cloudfoundry/dotnet-core-buildpack</div><div class="hbc-url">https://github.com/cloudfoundry-community/dotnet-core-buildpack</div><div class="hbc-description">Cloud Foundry buildpack for .NET Core on Linux. Contribute to cloudfoundry/dotnet-core-buildpack development by creating an account on GitHu…</div></div></div></div></a></div></div><p>README.mdに使い方(Usage)が書いてあります。 [code lang=”batch”] cf push my_app -b <a href="https://github.com/cloudfoundry-community/dotnet-core-buildpack.git">https://github.com/cloudfoundry-community/dotnet-core-buildpack.git</a> [/code] どうみても、<strong>cf</strong>って以前書いたCloud Foundry コマンドラインインターフェース (以下 <strong>CF CLI</strong>)です。 これを使えば、最新のbuildpackをgithubから引っ張ってきて更新してくれそうです。 なので、まずGithubからCF CLIをダウンロードします。これも前回書いたようにGithubにあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/cloudfoundry/cli" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars3.githubusercontent.com/u/621746?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">cloudfoundry/cli</div><div class="hbc-url">https://github.com/cloudfoundry/cli</div><div class="hbc-description">The official command line client for Cloud Foundry - cloudfoundry/cli</div></div></div></div></a></div></div><p>zipとインストーラがありますが、インストーラをお勧めします。 インストールはインストール先を指定するだけなので、省略。 インストール完了後、cfコマンドへのパスが通ります。 前述のcf.exeによるbuildpackの更新方法 [code lang=”batch”] cf push &lt;自分のアプリ&gt; -b <a href="https://github.com/cloudfoundry-community/dotnet-core-buildpack.git">https://github.com/cloudfoundry-community/dotnet-core-buildpack.git</a> [/code] を見ると、**&lt;自分のアプリ&gt;**が何を指すのかわかりません。 gitでクローンしたローカルフォルダなのか、Bluemix上のアプリのurlなのか。 なので、CF CLIを使った開発を見てみます。ダッシュボード上の「コーディングの開始」をクリックします。<br><a href="../../../../public/2016/08/img_57adc23ec7de3.png"><img src="../../../../public/2016/08/img_57adc23ec7de3.png"></a></p><p>遷移先で、CF CLIの使い方が書いてあります。<br><a href="../../../../public/2016/08/img_57adc32f02da6.png"><img src="../../../../public/2016/08/img_57adc32f02da6.png"></a></p><p>CF CLIの他に<strong>Bluemix CLI</strong>なるものが必要な様子。</p><blockquote><p>Bluemix CLI は、コマンド・ライン・インターフェースを介して、Bluemix 内のアプリケーション、仮想サーバー、コンテナー、およびその他のコンポーネントと対話するための一元化された手法を提供します。 また、特定の計算タイプと対話するときにも、Cloud Foundry、Docker、および OpenStack コミュニティーからコマンド・ライン・ツールを利用します。 Bluemix CLI は、これらのコミュニティー・ツールが使用されている場合の環境設定の操作に役立ちます。</p></blockquote><p>なので、上記のコミュニティツール、この場合CF CLIがBluemixと対話するために必要な環境設定のサポートが必要なのでしょう。認証情報とか。 このツールをダウンロードします。インストーラしかないです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>長くなったので次回。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでIBM Bluemixを試してみる </category>
          
          <category> paas </category>
          
          <category> IBM Bluemix </category>
          
          <category> PaaS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでIBM Bluemixを試してみる 第2回</title>
      <link href="/2016/08/17/1547/"/>
      <url>/2016/08/17/1547/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-oA">前回</a>はアプリの下地を作りました。</p><a id="more"></a><h1 id="開発の方法"><a href="#開発の方法" class="headerlink" title="開発の方法"></a>開発の方法</h1><p>Bluemixでの開発は下記の2つが提供されています。</p><ul><li>CF コマンド・ライン・インターフェース</li><li>GIT</li></ul><h3 id="CF-コマンド・ライン・インターフェース"><a href="#CF-コマンド・ライン・インターフェース" class="headerlink" title="CF コマンド・ライン・インターフェース"></a>CF コマンド・ライン・インターフェース</h3><p>Cloud Foundry コマンド・ライン・インターフェースの略のようです。 どうも、Githubで開発されているツールの模様。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/cloudfoundry/cli/releases" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars3.githubusercontent.com/u/621746?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">Releases · cloudfoundry/cli</div><div class="hbc-url">https://github.com/cloudfoundry/cli/releases</div><div class="hbc-description">The official command line client for Cloud Foundry - cloudfoundry/cli</div></div></div></div></a></div></div><p>Cloud Foundryは、オープンソースのPaaSソフトウェアとのこと。詳しくは<a href="https://ja.wikipedia.org/wiki/Cloud_Foundry">Wiki</a>で。 ローカルでこのツールを使って、編集したコードをアップし、デプロイする模様。</p><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><p>Gitを使って開発をします。 説明を見ると、Web上のエディターで編集し、開発を進めていくスタイルのように見えます。 でも、せっかくASP.NETを選択したので、Visual Studioを使いローカルで開発したいです。Visual StudioならGitも統合されているので。</p><h1 id="Gitを使う"><a href="#Gitを使う" class="headerlink" title="Gitを使う"></a>Gitを使う</h1><p>というわけでGitを使うための設定です。</p><ol><li>ダッシュボードに移動し、アプリケーション一覧から、前回作成したアプリをクリックします。</li></ol><p><a href="../../../../public/2016/08/img_57acad12960fa.png"><img src="../../../../public/2016/08/img_57acad12960fa.png"></a></p><ol><li>画面右側にある「GITの追加」をクリックします (ここではタイミング的に表示されていませんが..)</li></ol><p><a href="../../../../public/2016/08/img_57acadbc8829b.png"><img src="../../../../public/2016/08/img_57acadbc8829b.png"></a></p><ol><li>Gitリポジトリーを作成します。ここの名前はユニークである必要があります。また、この名前はgitリポジトリのurlに当然使われます。例えば、<a href="https://hub.jazz.net/git/">https://hub.jazz.net/git/</a>&lt;ここの名前&gt;/&lt;アプリの名前&gt;</li></ol><p><a href="../../../../public/2016/08/img_57acade764c0e.png"><img src="../../../../public/2016/08/img_57acade764c0e.png"></a></p><p>ご利用条件への同意のチェックは必須</p><ol><li>作成された?</li></ol><p><a href="../../../../public/2016/08/img_57acae7baa93a.png"><img src="../../../../public/2016/08/img_57acae7baa93a.png"></a></p><p>OK?</p><ol><li>無慈悲なエラー</li></ol><p><a href="../../../../public/2016/08/img_57acaead37d44.png"><img src="../../../../public/2016/08/img_57acaead37d44.png"></a></p><p>どういうことだってばよ…</p><ol><li>元の画面に戻ったので、もう一度「GITの追加」をクリック。チェックは外して「続行」をクリックしました。</li></ol><p><a href="../../../../public/2016/08/img_57acaee99034e.png"><img src="../../../../public/2016/08/img_57acaee99034e.png"></a></p><p>チェックの意味はわかりません</p><ol><li>今度は成功</li></ol><p><a href="../../../../public/2016/08/img_57acaf27ab8cf.png"><img src="../../../../public/2016/08/img_57acaf27ab8cf.png"></a></p><p>本当に大丈夫?</p><ol><li>右上にGitリポジトリのurlが追加されたました</li></ol><p><a href="../../../../public/2016/08/img_57acafc0580e0.png"><img src="../../../../public/2016/08/img_57acafc0580e0.png"></a></p><p>できたー</p><h1 id="Visual-Studioで編集する"><a href="#Visual-Studioで編集する" class="headerlink" title="Visual Studioで編集する"></a>Visual Studioで編集する</h1><p>Gitリポジトリができたので、ローカルにクローンして、コードを編集してみます。 クローンする際、認証を求められますが、当然これはIBW BluemixのユーザーIDとパスワードです。 クローンすると、下記のような構成でクローンが完了します。<br><a href="../../../../public/2016/08/img_57acb1f86ffad.png"><img src="../../../../public/2016/08/img_57acb1f86ffad.png"></a></p><p><strong>dotnetstarter.sln</strong>というのがあるので、ダブルクリックして、Visual Studioを起動してみましょう。 が、なんか警告が….<br><a href="../../../../public/2016/08/img_57acb3f147341.png"><img src="../../../../public/2016/08/img_57acb3f147341.png"></a></p><p>ふむふむ。SDKが必要なのね。じゃぁ「はい」。<br><a href="../../../../public/2016/08/img_57acb429e75cd.png"><img src="../../../../public/2016/08/img_57acb429e75cd.png"></a></p><p>またエラーだってばよ</p><p>どうしろと。 わからないので、Google先生に聞いてみる。 <strong>dnx-clr-win-x86.1.0.0-preview1-002702</strong>がキーワードだが、日本語で検索にヒットしない….. ということで、英語に変えたら、Stackoverflowで解決策が。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://stackoverflow.com/questions/37931631/dnx-sdk-version-dnx-clr-win-x86-1-0-0-preview1-002702-failed-to-install" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=stackoverflow.com"></img><div class="hbc-site-name">Stack Overflow</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded"></img></div><div class="hbc-text"><div class="hbc-title">DNX SDK version &#39;dnx-clr-win-x86.1.0.0-preview1-002702&#39; failed to install</div><div class="hbc-url">http://stackoverflow.com/questions/37931631/dnx-sdk-version-dnx-clr-win-x86-1-0-0-preview1-002702-failed-to-install</div><div class="hbc-description">When I tried to open a .Net core RC2 migrated project in my local, i get the following error message ---------------------------Microsoft…</div></div></div></div></a></div></div><p>曰く</p><blockquote><p>This error is message usually an indicator that a previous installation (.NET Core rc1 or some of the rc2 nightlies) of .NET Core Tooling/Framework wasn’t uninstalled. To validate it, go to the “Control Panel” &gt; “Programs and features” and search for “.NET Core” or “Microsoft .NET Core” and uninstall any previous version. Then install the correct .NET Core runtime and tooling version for RC2 and it should work.</p></blockquote><p>とのこと。 つまり、.NET Coreの古いバージョンが入ってるから、コントロールパネルの<strong>プログラムと機能</strong>で、**.NET Core<strong>または</strong>Microsoft .NET Core**を探して、アンインストール。その後、正しいバージョンをインストールすれば動く、とのこと。 が、そんなアイテムは見つからない。 もう少し調べると、tnakamura様が<a href="http://tnakamura.hatenablog.com/entry/2015/07/26/build-an-aspnet5-project-on-windows7">Visual Studio 2015 の ASP.NET 5 プロジェクトを Windows7 でビルドするには PowerShell 3.0 以上が必要だった</a>というそのものズバリな記事を公開していました。 記事に従って、関連コンポーネントをインストールし、Windows再起動後、ソリューションを開き直すと、無事に最初のダイアログが表示された後、Visual Studioが開き</p><p>ませんでした。 まだ何かが足りないので、調べていくと、そもそも.NET coreがインストールされていないのでは？ということに気づき、<a href="https://go.microsoft.com/fwlink/?LinkId=817245">.NET Core Tooling Preview 2 for Visual Studio 2015</a>をインストールしました。 インストール後、再起動して、再度Visual Studioを開くと、先ほどのダイアログは表示されず<br><a href="../../../../public/2016/08/img_57acf2bad3182.png"><img src="../../../../public/2016/08/img_57acf2bad3182.png"></a></p><p>すこし違うエラー</p><p>というダイアログが。 内容は、.NET Core SDK version 1.0.0-preview1-002702がインストールされていないか、C:\Program Files\dotnetの配下に見つからない、という内容です。 また、global.jsonに記載された.NET Core SDKをインストールするか、global.jsonの記載内容を更新するべき、とも書いてあります。 インストールは済んだはずなので、global.jsonの内容を書き換えます。 [code lang=”js”] { “projects”: [ “src” ], “sdk”: { “version”: “1.0.0-preview1-002702” } } [/code] を [code lang=”js”] { “projects”: [ “src” ], “sdk”: { “version”: “1.0.0-preview2-003121” } } [/code] にします。versionの文字列は、コマンドプロンプトから [code lang=”batch”] dotnet –version [/code] と入力することで、 [code lang=”batch”] C:\dotnet –version 1.0.0-preview2-003121 [/code] のような文字列を取得できるので、それをそのまま貼り付けるだけです。 これで、エラーがなくなりビルドが通ります。</p><h1 id="コミットしてみる"><a href="#コミットしてみる" class="headerlink" title="コミットしてみる"></a>コミットしてみる</h1><p>とりあえず、Blumix側でアプリを動かしてみます。 ダッシュボード上で「経路」と記されているurlをクリックすると、Webページが開きます。<br><a href="../../../../public/2016/08/img_57acf6711621e.png"><img src="../../../../public/2016/08/img_57acf6711621e.png"></a></p><p>Hello World</p><p>これを少し書き換えます。 index.htmlの「Hello World」を「こんにちわ」に変更して、コミット、プッシュを行います。 その後、Bluemixのダッシュボードを見ると、アプリが自動的にデプロイを開始し、再起動し始めました。 しかしながら、アプリが停止しました。<br><a href="../../../../public/2016/08/img_57acf7db18541.png"><img src="../../../../public/2016/08/img_57acf7db18541.png"></a></p><p>ソースの変更点は、index.htmlとproject.jsonだけです。 メッセージを日本語に変えたくらいで落ちるとは思えないので、.NET Core SDKのバージョンがまずいように見えます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>動く段階まで来ましたが、ソースの変更で動かなくなりました。次回修正。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでIBM Bluemixを試してみる </category>
          
          <category> paas </category>
          
          <category> IBM Bluemix </category>
          
          <category> PaaS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでIBM Bluemixを試してみる 第1回</title>
      <link href="/2016/08/15/1524/"/>
      <url>/2016/08/15/1524/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-oo">前回</a>はアカウントを作りました。</p><a id="more"></a><h1 id="お金の心配"><a href="#お金の心配" class="headerlink" title="お金の心配"></a>お金の心配</h1><p>無料で利用できると言っても、それは一定の制限の中です。 IBW Bluemixの場合、2016年8月の時点で、<a href="http://www.ibm.com/developerworks/jp/bluemix/credit.html">http://www.ibm.com/developerworks/jp/bluemix/credit.html</a> によれば、以下の条件なら無料で利用できます。</p><blockquote><p>ランタイムは、IBM 提供のランタイムごとに 1ヶ月 375GB 時間まで無料。 たとえば 512MB の Java アプリ 1 インスタンスを 1ヶ月使用すると、0.5GB x 31日 x 24時間 = 372GB 時間となり、無料枠の範囲内で使用できます。 (IBM以外が提供するランタイムの場合、全ランタイムのGB時間の合計で 375GB 時間まで無料）</p></blockquote><p>とりあえず、お勉強程度なら、そんなメモリを大量に必要とするアプリでもなければ、無料で遊べますよ、ってことです。 流石、IBM、太っ腹です。</p><h1 id="初期設定"><a href="#初期設定" class="headerlink" title="初期設定"></a>初期設定</h1><p>前回ログインした直後に初期設定を促されたので、それを済ませましょう。 1. 組織の作成。組織名は入力必須。組織名は世界中で一つだけの模様。<br><a href="../../../../public/2016/08/img_57ac984c2b60b.png"><img src="../../../../public/2016/08/img_57ac984c2b60b.png"></a></p><p>シドニー、英国、米国南部しかないです</p><p>2. スペースの作成。特に名前は気にする必要はなさそう。<br><a href="../../../../public/2016/08/img_57ac990fec035.png"><img src="../../../../public/2016/08/img_57ac990fec035.png"></a></p><p>名前は適当</p><p>3. 準備完了<br><a href="../../../../public/2016/08/img_57ac998b964f4.png"><img src="../../../../public/2016/08/img_57ac998b964f4.png"></a></p><p>YES!!</p><h1 id="アプリの用意"><a href="#アプリの用意" class="headerlink" title="アプリの用意"></a>アプリの用意</h1><p>初期設定が終わったので、次はアプリの用意をします。 1. 新しくアプリを作成します。「アプリの作成」をクリック<br><a href="../../../../public/2016/08/img_57ac9aaa536a9.png"><img src="../../../../public/2016/08/img_57ac9aaa536a9.png"></a></p><p>「アプリの作成」をクリック</p><p>2. 「WEB」をクリック<br><a href="../../../../public/2016/08/img_57ac9b885bb75.png"><img src="../../../../public/2016/08/img_57ac9b885bb75.png"></a></p><p>「WEB」をクリック</p><p>3. 「ASP.NET Core」をクリックし、続行をクリック<br><a href="../../../../public/2016/08/img_57ac9bcfded10.png"><img src="../../../../public/2016/08/img_57ac9bcfded10.png"></a></p><p>「ASP.NET Core」をクリック</p><p>4. お好みのアプリ名を入力し、「完了」をクリック。ただし、ここも世界中で唯一のアプリ名である必要があります。<br><a href="../../../../public/2016/08/img_57ac9c00b39a1.png"><img src="../../../../public/2016/08/img_57ac9c00b39a1.png"></a></p><p>アプリ名を入力</p><p>5．ありがちなアプリ名を入力した場合<br><a href="../../../../public/2016/08/img_57ac9cfc76569.png"><img src="../../../../public/2016/08/img_57ac9cfc76569.png"></a></p><p>エラーの意味がわかりにくすぎます</p><p>6. 作成に成功した後、Bluemix側で作業中になります。1分くらいがかかります。<br><a href="../../../../public/2016/08/img_57ac9d4daef84.png"><img src="../../../../public/2016/08/img_57ac9d4daef84.png"></a></p><p>ステージング中</p><p>7. 「アプリは実行中」に変化しました。<br><a href="../../../../public/2016/08/img_57ac9dad94b73.png"><img src="../../../../public/2016/08/img_57ac9dad94b73.png"></a></p><p>完了</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>アプリの下地ができあがりました。次こそコーディングを….</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでIBM Bluemixを試してみる </category>
          
          <category> paas </category>
          
          <category> IBM Bluemix </category>
          
          <category> PaaS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでIBM Bluemixを試してみる 第0回</title>
      <link href="/2016/08/14/1512/"/>
      <url>/2016/08/14/1512/</url>
      
        <content type="html"><![CDATA[<p>Big Blueですね。</p><a id="more"></a><h1 id="なんでIBM-Bluemix"><a href="#なんでIBM-Bluemix" class="headerlink" title="なんでIBM Bluemix?"></a>なんでIBM Bluemix?</h1><p>急にWebアプリケーションが作ってみたくなったからです。 ただ、Webアプリを作る、ってなるとサーバー用意したり、ドメインがー、とか色々面倒なので、クラウドに任せようとなりました。 ならどうして<strong>Microsoft Azure</strong>ではないのか？というと、Azureの記事は腐るほどあって、IBW Bluemixはあまり情報が無いから、面白そうかな、って思っただけです。 ちなみに、Bluemixを検討する前はHerokuを考えていましたが、無料だと18時間連続稼働、30分放置でスリープとか、何だか残念だったからです。 ここは、Big Blue*こと、超大企業IBM様のお力を見せてもらおうか、というところです。 <strong>*コンピュータ会社IBMの愛称。同社のロゴが青であり、世界最大のコンピュータ関連企業であることから。</strong></p><h1 id="What’t-is-IBM-Bluemix"><a href="#What’t-is-IBM-Bluemix" class="headerlink" title="What’t is IBM Bluemix?"></a>What’t is IBM Bluemix?</h1><h1 id="アカウント作成"><a href="#アカウント作成" class="headerlink" title="アカウント作成"></a>アカウント作成</h1><p>何はともあれ、アカウントがないと話になりません。 1. まずは <a href="https://console.ng.bluemix.net/">https://console.ng.bluemix.net/</a> へ移動<br><a href="../../../../public/2016/08/img_57ac91500f0e4.png"><img src="../../../../public/2016/08/img_57ac91500f0e4.png"></a></p><p>トップページで、「無料で開始」をクリック</p><p>2. 登録情報を入力。名前は漢字でなくてもOKでした。<br><a href="../../../../public/2016/08/img_57ac91babce19.png"><img src="../../../../public/2016/08/img_57ac91babce19.png"></a></p><p>無料期間中はクレジットカードは不要なので安心</p><p>3. 完了後、確認メールが飛びますので、メールボックスを確認しましょう<br><a href="../../../../public/2016/08/img_57ac91faa0ced.png"><img src="../../../../public/2016/08/img_57ac91faa0ced.png"></a></p><p>メールをチェック</p><p>4. ちなみにメールはこんな感じ<br><a href="../../../../public/2016/08/img_57ac92772f861.png"><img src="../../../../public/2016/08/img_57ac92772f861.png"></a></p><p>メールをチェック</p><p>5. 確認できたら、ログインします。<a href="https://new-console.ng.bluemix.net/">https://new-console.ng.bluemix.net/</a> へ移動<br><a href="../../../../public/2016/08/img_57ac931640224.png"><img src="../../../../public/2016/08/img_57ac931640224.png"></a></p><p>ログインメニューをクリック</p><p>6. メールアドレスとパスワードを入力してログイン<br><a href="../../../../public/2016/08/img_57ac937b021cf.png"><img src="../../../../public/2016/08/img_57ac937b021cf.png"></a></p><p>IBMidはメールアドレスです。というか「IBMid」って見た目が…</p><p>7. ログイン完了しましたね？<br><a href="../../../../public/2016/08/img_57ac943e41981.png"><img src="../../../../public/2016/08/img_57ac943e41981.png"></a></p><p>おめでとうございます</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>アカウントだけ作りました。ASP.NETが使えると言うことなので、それを動かしてみたいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでIBM Bluemixを試してみる </category>
          
          <category> paas </category>
          
          <category> IBM Bluemix </category>
          
          <category> PaaS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その12 VisualStateManagerでPath.Dataを変更する</title>
      <link href="/2016/08/13/1599/"/>
      <url>/2016/08/13/1599/</url>
      
        <content type="html"><![CDATA[<h1 id="Path-Dataを直接変更"><a href="#Path-Dataを直接変更" class="headerlink" title="Path.Dataを直接変更"></a>Path.Dataを直接変更</h1><p>掲題の通りですが、VisualStateManagerでボタンのアイコンを変えようと下記のように指定すると例外を投げて落ちます。 アイコンの変更をしたいからと、ボタンの表示を切り替えてアイコンを変更するような逃げようとした時、ぶつかった問題です。 [code lang=”xaml”] <VisualState x:Name="Movie"> <Storyboard> <ObjectAnimationUsingKeyFrames Storyboard.TargetName="\_MovieFileOpenButtonIcon" Storyboard.TargetProperty="Data"> <DiscreteObjectKeyFrame KeyTime="00:00:00" Value="M7.9999993,48 L7.9999993,56.75 16.499999,56.75 16.499999,48 z M7.9999993,31.5 L7.9999993,41.25 16.499999,41.25 16.499999,31.5 z M7.9999993,15.25 L7.9999993,24.75 16.499999,24.75 16.499999,15.25 z M56.999999,0.5 L64.499999,0.5 64.499999,72 56.999999,72 z M0.5,0.5 L7.9999993,0.5 7.9999993,8.5 16.499999,8.5 16.499999,0.5 47.249999,0.5 47.249999,8.5 56.249999,8.5 56.249999,15.25 47.249999,15.25 47.249999,24.75 56.249999,24.75 56.249999,31.5 47.249999,31.5 47.249999,41.25 56.249999,41.25 56.249999,48 47.249999,48 47.249999,56.75 56.249999,56.75 56.249999,63.5 47.249999,63.5 47.249999,72 16.499999,72 &#10;16.499999,63.5 7.9999993,63.5 7.9999993,72 0.5,72 z" /> </ObjectAnimationUsingKeyFrames> </Storyboard> </VisualState> [/code] 正直、上の方がストレートなのですが、文字列を適切に変換するように指示がないので落ちるから仕方ありません。 正しくは、 [code lang=”xaml”] <VisualState x:Name="Movie"> <Storyboard> <ObjectAnimationUsingKeyFrames Storyboard.TargetName="\_MovieFileOpenButtonIcon" Storyboard.TargetProperty="Data"> <DiscreteObjectKeyFrame KeyTime="00:00:00"> &lt;DiscreteObjectKeyFrame.Value&gt; <Geometry>M7.9999993,48 L7.9999993,56.75 16.499999,56.75 16.499999,48 z M7.9999993,31.5 L7.9999993,41.25 16.499999,41.25 16.499999,31.5 z M7.9999993,15.25 L7.9999993,24.75 16.499999,24.75 16.499999,15.25 z M56.999999,0.5 L64.499999,0.5 64.499999,72 56.999999,72 z M0.5,0.5 L7.9999993,0.5 7.9999993,8.5 16.499999,8.5 16.499999,0.5 47.249999,0.5 47.249999,8.5 56.249999,8.5 56.249999,15.25 47.249999,15.25 47.249999,24.75 56.249999,24.75 56.249999,31.5 47.249999,31.5 47.249999,41.25 56.249999,41.25 56.249999,48 47.249999,48 47.249999,56.75 56.249999,56.75 56.249999,63.5 47.249999,63.5 47.249999,72 16.499999,72 &#10;16.499999,63.5 7.9999993,63.5 7.9999993,72 0.5,72 z</Geometry> &lt;/DiscreteObjectKeyFrame.Value&gt; </DiscreteObjectKeyFrame> </ObjectAnimationUsingKeyFrames> </Storyboard> </VisualState> [/code] になります。 このとき、<strong>KeyTime</strong>の指定を忘れるとアイコンの変更にタイムラグが発生します。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>VisualStateなんて、そんな頻繁に使わないから忘れます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その11 GPUのメモリ使用量を可視化する</title>
      <link href="/2016/08/13/1597/"/>
      <url>/2016/08/13/1597/</url>
      
        <content type="html"><![CDATA[<p>GeForce GTX 1080が欲しいです。</p><a id="more"></a><h1 id="Caffeでどのくらいメモリを使っているのか？"><a href="#Caffeでどのくらいメモリを使っているのか？" class="headerlink" title="Caffeでどのくらいメモリを使っているのか？"></a>Caffeでどのくらいメモリを使っているのか？</h1><p>ことの発端は、Caffeで学習開始時にCPUのメモリが足りなくて落ちてしまったこと。 個人的に、Caffeのログを見る限りそこまで大量のメモリを使っていない、と思っていたのですが、この際メモリの使用量を可視化してみることに。 GPUの状態は、<strong>C:\Program Files\NVIDIA Corporation\NVSMI\nvidia-smi.exe</strong>を実行するとわかります。 [code lang=”batch”] C:\WINDOWS\system32&gt;”C:\Program Files\NVIDIA Corporation\NVSMI\nvidia-smi.exe” Thu Aug 11 20:41:43 2016 +—————————————————————————–+ | NVIDIA-SMI 368.39 Driver Version: 368.39 | |——————————-+———————-+———————-+ | GPU Name TCC/WDDM | Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 GeForce GTX 750 Ti WDDM | 0000:01:00.0 Off | N/A | | 53% 80C P0 27W / 38W | 1472MiB / 2048MiB | 90% Default | +——————————-+———————-+———————-+<br>+—————————————————————————–+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | 0 624 C+G Insufficient Permissions N/A | | 0 652 C+G Insufficient Permissions N/A | | 0 680 C+G Insufficient Permissions N/A | | 0 768 C+G Insufficient Permissions N/A | | 0 1132 C+G Insufficient Permissions N/A | | 0 2244 C+G Insufficient Permissions N/A | | 0 5828 C+G …indows.Cortana_cw5n1h2txyewy\SearchUI.exe N/A | | 0 6376 C+G C:\Windows\explorer.exe N/A | | 0 7108 C+G …ost_cw5n1h2txyewy\ShellExperienceHost.exe N/A | | 0 8308 C …crosoft\caffe\Build\x64\Release\caffe.exe N/A | +—————————————————————————–+ [/code] ちなみに引数で <strong>-l</strong>または <strong>--loop</strong> を付与すると、一定間隔で上記の出力を繰り返しで出力します。単位は秒。 なので、 [code lang=”batch”] C:\WINDOWS\system32&gt;”C:\Program Files\NVIDIA Corporation\NVSMI\nvidia-smi.exe” -l 5 [/code] [code lang=”batch”] C:\WINDOWS\system32&gt;”C:\Program Files\NVIDIA Corporation\NVSMI\nvidia-smi.exe” –loop=5 [/code] みたいな。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>本当はGUIでグラフ表示的な感じで見たい。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Caffe </category>
          
          <category> gpupu </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その10 .NET 4.6.2 を使用可能にする</title>
      <link href="/2016/08/11/1495/"/>
      <url>/2016/08/11/1495/</url>
      
        <content type="html"><![CDATA[<p>米国時間2016年8月2日に.NET 4.6.2がリリースされました。</p><a id="more"></a><h1 id="Visual-Studioでターゲットフレームワークに4-6-2がない"><a href="#Visual-Studioでターゲットフレームワークに4-6-2がない" class="headerlink" title="Visual Studioでターゲットフレームワークに4.6.2がない"></a>Visual Studioでターゲットフレームワークに4.6.2がない</h1><p>.NET 4.6.2をインストールしただけでは使えません。 下記のページを参考にすると、追加コンポーネントが必要になることがわかります。 </p><p><strong>.NET Framework 4.6.2 Developer Pack</strong>をクリックし、下記の2つをダウンロードします。<br><a href="../../../../public/2016/08/f27d922fa4a010c05df8bf4a8ff0d69e.png"><img src="../../../../public/2016/08/f27d922fa4a010c05df8bf4a8ff0d69e-1024x796.png"></a></p><p>Targeting .NET Platforms</p><p>NDP462-DevPack-KB3151934-ENU.exe</p><p>NDP462-DevPack-KB3151934-JPN.exe</p><p>ダウンロードして、インストール後、何も言われませんが、再起動しましょう。 再起動せずに、Visual Studioを起動したら、フリーズしましたので。 再起動後、Visual Studioを立ち上げて、新しいプロジェクトまたは対象のフレームワークの選択箇所に、.NET Framework 4.6.2が出現しています。 これをインストールするだけで、Visual Studio 2013と2015の両方に対応します。<br><a href="../../../../public/2016/08/2f63bfacaad8b8dde480e5529597eb23.png"><img src="../../../../public/2016/08/2f63bfacaad8b8dde480e5529597eb23.png"></a></p><p>選択可能一覧に登場</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Visual Studio 2015の登場が、4.6.2より後ならこんな手間はなかったんでしょうね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その9 260文字を超えるパスを有効にする</title>
      <link href="/2016/08/11/1502/"/>
      <url>/2016/08/11/1502/</url>
      
        <content type="html"><![CDATA[<p>Windows 10 Anniversary Updateが出ましたね。 2018/04/05 更新 Creators Updateから挙動が変わっています。詳細は、<a href="https://taktak.jp/2018/04/05/2835">開発メモ その104 260文字を超えるパスを有効にする 追試験</a>を参考にしてください。</p><a id="more"></a><h1 id="MAXPATHの制限がなくなります"><a href="#MAXPATHの制限がなくなります" class="headerlink" title="MAXPATHの制限がなくなります"></a>MAXPATHの制限がなくなります</h1><p>制限付きですが、忌まわしきファイルパス長の制限がなくなります。 .NETからのアクセスの制限をなくすなら、.NET 4.6.2をインストール、app.configを編集し、かつローカルグループポリシーを修正する必要があります。 app.configに下記のような記述を追加します。 [code lang=”xhtml”] <?xml version="1.0" encoding="utf-8"?> <configuration> <runtime> <AppContextSwitchOverrides value="Switch.System.IO.UseLegacyPathHandling=false;Switch.System.IO.BlockLongPaths=false" /> </runtime> </configuration> [/code] また、ローカルグループポリシーで下記の項目を有効にします。変更後再起動します。 <strong>ローカル コンピューター ポリシー -&gt; コンピューターの構成 -&gt; 管理用テンプレート -&gt; システム -&gt; ファイルシステム -&gt; Win32 の長いパスを有効にする</strong><br><a href="../../../../public/2016/08/f274ede454f65defa9b974f6b8221239.png"><img src="../../../../public/2016/08/f274ede454f65defa9b974f6b8221239-1024x565.png"></a></p><p>Win32 の長いパスを有効にする</p><p>説明を見ると、</p><blockquote><p>Win32 の長いパスを有効にすると、明示された win32 アプリケーションと Windows ストア アプリケーションが、ノードあたり通常 260 文字の制限を超えるパスにアクセスできるようになります。この設定を有効にすると、プロセス内で長いパスにアクセスできるようになります。</p></blockquote><p>とありますが、.NETも安心して有効にできます。 Windows上の.NETアプリはWin32のラッパーですからね。 ポイントは、<strong>明示された</strong>です。 この明示が前段のapp.configへの追記になります。 これを有効にしないと、app.configに追記しても動きません。</p><h1 id="設定が効いてない？"><a href="#設定が効いてない？" class="headerlink" title="設定が効いてない？"></a>設定が効いてない？</h1><p>ここまでを確認するために、下記のサンプルを置きました。 今回のソースです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Memo9" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Memo9</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>簡単なサンプルで [code lang=”csharp”] using System; using System.IO; using System.Linq;<br>namespace net462manifest { class Program { static void Main(string[] args) { var random = new Random(); var length = 200; var str = string.Join(“”, Enumerable.Range(0, length).Select(s =&gt; random.Next(0, 9).ToString())); var path = Path.Combine(“B:\\“, str); path = Path.Combine(path, str);<br>try { Directory.CreateDirectory(path); Console.WriteLine($”{path} is created.”); } catch (Exception ex) { Console.WriteLine(ex.GetType().Name); Console.WriteLine(ex.Message); } } } } [/code] という感じです。名前空間が違うだけでサンプル全て、B:\&lt;200文字のフォルダ名&gt;\&lt;200文字のフォルダ名&gt;なフォルダを作成するだけです。 これを、.NET 4.6.1と4.6.2をターゲットでビルドし、app.configの有無で、Windows 10 + .NET 4.6.2で動かしてみました。 が、不思議な結果になりました。 .NET 4.6.1 + app.configなしの環境<strong>「だけ」</strong>で、 [code lang=”batch”] 指定されたパス、ファイル名、またはその両方が長すぎます。完全限定型名は 260 文字未満で指定し、ディレクトリ名は 248 未満で指定してください。 [/code] という例外を投げました。 理想では、「.NET 4.6.2 + app.configあり」の環境だけで実行できるつもりでした。 少なくとも、app.configがないとダメ、という感じだと思いましたが、この結果は不思議です。 ローカルグループポリシーの有効前後で結果が変化し、最終的にこうなりました。 [table id=24 /] 調べてみると、下記のMSDN Blogに記事がありました。 </p><blockquote><p>If you target 4.6.2 this isn’t necessary, but if you want to enable the behavior for existing code, here is config file snippet you need to use.</p></blockquote><p>つまり、4.6.2なら特別な設定は不要で、既存のコードで有効にしたいなら、configファイルが必要だよ、ってことらしいです。 グループポリシーで設定有効後、4.6.2で常に動いたのはそういうことのようです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>4.6.2以降はグループポリシー以外は特に気にすることはない模様。 ただ、実運用において、客先でこの設定をバッチか何かで有効にすることはできるのだろうか？無理な気がする。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Memo9">https://github.com/takuya-takeuchi/Demo/tree/master/Memo9</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その8 gitでフォーク元のリポジトリの変更を追跡する</title>
      <link href="/2016/08/10/1491/"/>
      <url>/2016/08/10/1491/</url>
      
        <content type="html"><![CDATA[<p>忘れずにメモ。</p><a id="more"></a><h1 id="フォークした後、フォーク元に対する変更はどうなるの？"><a href="#フォークした後、フォーク元に対する変更はどうなるの？" class="headerlink" title="フォークした後、フォーク元に対する変更はどうなるの？"></a>フォークした後、フォーク元に対する変更はどうなるの？</h1><p>Subversion的には、ブランチを切ってしまうと、そのブランチに対するリビジョンをマージするという形でローカルに反映します。 gitで、これをやる場合、少し面倒。というかTortoiseGitで対応していないのかしら？ まず、フォークしたリポジトリに対するローカルリポジトリのあるフォルダ (.gitというフォルダがある場所) に移動。 コマンドプロンプトから下記のコマンドを叩きます。 [code lang=”batch”] git remote add <name> [/code] nameは何でもいいです。 例えば、Microsoft/Caffeをフォーク先のリポジトリPrivate/Caffeに対して、フォーク元 (つまり Microsoft/Caffe) に対する変更を追跡させたいなら [code lang=”batch”] git remote add upstream <a href="https://github.com/Microsoft/caffe.git">https://github.com/Microsoft/caffe.git</a> [/code] となる。 ようするに、これにより、ローカルのリポジトリはフォーク先リモートリポジトリ (Private/Caffe) とのみ関係があった状態に対して、新しくフォーク元のリポジトリをリモートブランチとして追加したわけです。 で、フォーク元のリポジトリに対する変更をプルする場合は、 [code lang=”batch”] git fetch <name> git merge <name>/master [/code] で大丈夫なはず。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>gitが便利なのはわかるんですが、概念がかなり複雑なんですよね。TortoiseGitのおかげである程度複雑さはカバーされていますが。 別のGUIクライアントを使います？え、Source Tree?知らないなぁ。</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> TortoiseGit </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その7 CMakeでOpenCVを指定する方法</title>
      <link href="/2016/08/01/1487/"/>
      <url>/2016/08/01/1487/</url>
      
        <content type="html"><![CDATA[<p>C/C++は面倒。</p><a id="more"></a><h1 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h1><p>CMakeって有名ですけど、.NETで生きてきた私にとって、「makeの親戚？」という程度の(間違った)認識だったので、いざ使えと言われ、ビクビクしながら使っていると案の定、エラーの文字列で「ムキー」ってなるわけで。 OpenCVを使ったサンプルプログラムとかって、よくCMakeで使えるようになっているけど、いつも忘れるのが、OpenCVのパス設定方法。 だからメモ。 <strong>CMakeList.txt</strong>のあるフォルダをc<strong>make-gui.exe</strong>で開き、ビルドに必要なバイナリデータの出力先を設定。 その後、Configureを押下すると、<strong>OpenCV_DIR-NOTFOUND</strong>って出るときがあります。 こういうのは、大抵<strong>OpenCVConfig.cmake</strong>がソースフォルダなどにないパターン。 なので、このOpenCVConfig.cmakeが存在するパスを指定します。 <img src="../../../../public/2016/08/img_579f35ced29c1.png"></p><p>通常、OpenCVをインストールしている場合は、 <code>C:\Program Files\OpenCV\2.4.11\build\OpenCVConfig.cmake C:\Program Files\OpenCV\3.0.0\build\OpenCVConfig.cmake</code> のように、buildフォルダの下に存在します。 なので、上の場合は、<strong>C:\Program Files\OpenCV\2.4.11\build\</strong>をCMakeのOpenCV_DIR-NOTFOUNDに設定して、再度ConfiguraまたはGenerateを押下すれば、ビルドに必要なファイル群が無事に出力されます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>C/C++を本職にしている人たちって、「言わなくてもわかるよね?」的なことをわざわざ言ったり、書いたりしないので、答えを見つけるのに苦労します。 いや自分の経験が浅いのが悪いんですけど。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> マルチメディア </category>
          
          <category> CMake </category>
          
          <category> OpenCV </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング Caffe for Windows その4 DIGITS</title>
      <link href="/2016/07/31/1466/"/>
      <url>/2016/07/31/1466/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ny">前回</a>はcuDNN 5.0を導入してみました。</p><a id="more"></a><h1 id="What-is-DIGITS"><a href="#What-is-DIGITS" class="headerlink" title="What is DIGITS?"></a>What is DIGITS?</h1><p><strong>DIGITS</strong>はNVIDIAが提供している、Caffeを利用した深層学習モデルの訓練のためのWebアプリです。 DIGITSは <strong>the Deep Learning GPU Training System</strong> の略とのこと。 Githubで開発が進められています。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/NVIDIA/DIGITS" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/1728152?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">NVIDIA/DIGITS</div><div class="hbc-url">https://github.com/NVIDIA/DIGITS</div><div class="hbc-description">Deep Learning GPU Training System. Contribute to NVIDIA/DIGITS development by creating an account on GitHub.</div></div></div></div></a></div></div><p>これまで、CaffeがLinux環境での動作が前提でしたが、MicrosoftがCaffeのWindows版を提供し始めたことで風向きが変わりました。 前から、リッチなGUIで深層学習をしてみたくても、Windows環境は遅れていたため、涙をのんでいたのですが、そんな日々は終わりました。 <img src="../../../../public/2016/07/img_579b5b28588a2.png"></p><p>そんなDIGITSをWindowsに導入してみます。 ちなみに、DIGITS公式でもWindows版のCaffeに言及していますが、あっちがサポートしているのは、</p><h1 id="本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。"><a href="#本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。" class="headerlink" title="本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。"></a>本家BVLCのWindows版Caffeであって、MicrosoftのWindows版Caffeではありません。</h1><p>なので、今回は相当イレギュラーです。 といっても、イレギュラーなのは、少しだけですが。</p><h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><p>基本は、公式の<a href="https://github.com/NVIDIA/DIGITS/blob/master/docs/BuildDigitsWindows.md">Windows向けdocs</a>に従います。 必要なものは下記の5つ。</p><p>Python2</p><p>CUDA 7.5</p><p>CuDNN 5.1</p><p>Caffe</p><p>Graphviz</p><p>Caffe for Windowsを導入しているなら、Miniconda2、CUDA、CuDNNが入っているので大丈夫でしょう。 バージョンが違うなら追加でインストールするだけです。 ちなみに、前回はCuDNNの5.0をインストールしましたが、DIGITSは5.1を要求します。 5.1は2016年7月末現在、RC (リリース候補版)です。 しかし、Microsoft版のCaffeを使ってると、別に5.0でもDIGITSは動きます。 (起動までは問題ないです。)</p><h1 id="Python2"><a href="#Python2" class="headerlink" title="Python2"></a>Python2</h1><p>Pythonそのものはもう入っていますが、いくつかの依存モジュールが必要です。 ですが、ここで注意するのは、ファイルからのモジュールの入手が必要になることです。 docsでは、下記のモジュールを<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Unofficial Windows Binaries for Python Extension Packages</a>からインストールするよう指示されます。 pythonが複数存在する場合、インストールしたい対象のpython.exeをフルパスで指定しましょう。 上述のurlからローカルにダウンロードしてインストールしてください。Python2.7なのでCP27の入っているパッケージが対象です。 管理者権限でインストールしましょう。念のため。 [code lang=”batch”] python -m pip install cython python -m pip install numpy-1.11.1+mkl-cp27-cp27m-win_amd64.whl python -m pip install scipy-0.18.0-cp27-cp27m-win_amd64.whl python -m pip install matplotlib-1.5.2-cp27-cp27m-win_amd64.whl python -m pip install scikit_image-0.12.3-cp27-cp27m-win_amd64.whl python -m pip install h5py-2.6.0-cp27-cp27m-win_amd64.whl [/code]</p><h1 id="CUDA-7-5"><a href="#CUDA-7-5" class="headerlink" title="CUDA 7.5"></a>CUDA 7.5</h1><p>もうインストール済みなので省略。</p><h1 id="CuDNN-5-1"><a href="#CuDNN-5-1" class="headerlink" title="CuDNN 5.1"></a>CuDNN 5.1</h1><p>例のごとくダウンロードします。 <strong>CommonSettings.props</strong>のPythonのサポートを有効にした後、<a href="http://wp.me/p7138e-ny">前回</a>を参考に、5.1をダウンロードし、その展開先をCommonSettings.propsに設定します。</p><h1 id="Caffe"><a href="#Caffe" class="headerlink" title="Caffe"></a>Caffe</h1><p>ビルド自体はこれまでの記事を参考にすれば問題ないはずです。 今回は、ビルド前に、<strong>caffe\windows\caffe\caffe.vcxproj</strong>をテキストエディタで開き、58行目付近の [code lang=”xhtml”] <PostBuildEvent> <Command>“$(ScriptsDir)\FixGFlagsNaming.cmd” “$(OutDir)” $(Configuration)</Command> </PostBuildEvent> [/code] を下記のように変更します。 [code lang=”xhtml”] <PostBuildEvent> <Command>“$(ScriptsDir)\FixGFlagsNaming.cmd” “$(OutDir)” $(Configuration)</Command> </PostBuildEvent> <ClCompile> <PreprocessorDefinitions>NDEBUG;%(PreprocessorDefinitions);CAFFE_VERSION=1.0.0-rc3</PreprocessorDefinitions> </ClCompile> [/code] これで下準備は終わりです。</p><h3 id="これが最重要です。"><a href="#これが最重要です。" class="headerlink" title="これが最重要です。"></a>これが最重要です。</h3><p>そして、Caffeのビルドを成功させます。 ビルド完了後、<strong>\Build\x64\Release\pycaffe\caffe</strong> を <strong>\lib\site-packages</strong> にコピーします。 シンボリックリンクでもかまいません。 最後に、**&lt;caffe_root&gt;\Build\x64\Release<strong>を</strong>環境変数PATH**に追加します。 (追加しなくても、問題ないですが….)</p><h1 id="Graphviz"><a href="#Graphviz" class="headerlink" title="Graphviz"></a>Graphviz</h1><p><strong>Graphviz</strong>はグラフを描画するモジュールです。 下記公式サイトより、Windows版のパッケージを入手します </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://www.graphviz.org/Download.php" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.graphviz.org"></img><div class="hbc-site-name">www.graphviz.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Redirecting…</div><div class="hbc-url">http://www.graphviz.org/Download.php</div></div></div></div></a></div></div><p>zipとmsi形式がありますが、お好きな方で。 zipで展開する場合は、<strong>環境変数PATH</strong>に <strong>&lt;Graphvizのインストール先&gt;\bin</strong> を追加します。 例えば、c:\graphviz-2.38に展開したなら、<strong>c:\graphviz-2.38\bin</strong> となるようにします。 msi版は知りません。</p><h1 id="DIGITS"><a href="#DIGITS" class="headerlink" title="DIGITS"></a>DIGITS</h1><p>ようやく本体です。 まず、公式githubよりクローンを実行し、フォルダに含まれる<strong>requirements.txt</strong>を編集します。 [code] Pillow&gt;=2.3.0,&lt;=3.1.2 numpy&gt;=1.8.1,&lt;=1.11.0 scipy&gt;=0.13.3,&lt;=0.17.0 protobuf&gt;=2.5.0,&lt;=2.6.1 six&gt;=1.5.2,&lt;=1.10.0 requests&gt;=2.2.1,&lt;=2.9.1 gevent&gt;=1.0,&lt;=1.0.2 Flask==0.10.1 Flask-WTF==0.11,&lt;=0.12 wtforms&gt;=2.0,&lt;=2.1 Flask-SocketIO==0.6.0 gunicorn==17.5 setuptools&gt;=3.3,&lt;=20.7.0 lmdb==0.87 h5py&gt;=2.2.1,&lt;=2.6.0 pydot==1.0.28 [/code] を [code] protobuf&gt;=2.5.0,&lt;=2.6.1 six&gt;=1.5.2,&lt;=1.10.0 requests&gt;=2.2.1,&lt;=2.9.1 gevent&gt;=1.0,&lt;=1.0.2 Flask==0.10.1 Flask-WTF==0.11,&lt;=0.12 wtforms&gt;=2.0,&lt;=2.1 Flask-SocketIO==0.6.0 gunicorn==17.5 setuptools&gt;=3.3,&lt;=20.7.0 lmdb==0.87 h5py&gt;=2.2.1,&lt;=2.6.0 pydot==1.0.28 [/code] に変更します。つまり先頭3行を除去します。 これは、後述のPILが動かなくなるなど、弊害があるようです。 次に、このファイルを利用して、下記のコマンドから依存モジュールのインストールを実行します。 当然管理者権限。gevent-1.1.2-cp27-cp27m-win_amd64.whlは前述のページから入手しておきます。 gevent-1.1.2-cp27-cp27m-win_amd64.whlは、<strong>この時に実行してください。</strong> [code lang=”batch”] python -m pip install -r requirements.txt python -m pip install gevent-1.1.2-cp27-cp27m-win_amd64.whl python -m pip install pyreadline [/code]</p><h1 id="DIGITSを実行"><a href="#DIGITSを実行" class="headerlink" title="DIGITSを実行"></a>DIGITSを実行</h1><p>DIGITSフォルダで下記のコマンドを実行します。 ここでもpython.exeはフルパスで指定することをおすすめします。 [code lang=”batch”] python digits-devserver [/code] もし、Caffeのビルド後、*<em>&lt;caffe_root&gt;\Build\x64\Release<strong>を</strong>環境変数PATH**に追加していないなら、下記のコマンドになります。 [code lang=”batch”] set PATH=%PATH%;&lt;caffe_root&gt;\Build\x64\Release python digits-devserver [/code] 実行後、下記のエラーが出る場合があります。 [code lang=”batch”] Traceback (most recent call last): File “digits-devserver”, line 31, in <module> from digits import config File “d:\Works\Lib\NVIDIA\DIGITS\digits\config\__init__.py”, line 7, in <module> from .current_config import config_value File “d:\Works\Lib\NVIDIA\DIGITS\digits\config\current_config.py”, line 4, in <module> from .caffe_option import CaffeOption File “d:\Works\Lib\NVIDIA\DIGITS\digits\config\caffe_option.py”, line 14, in <module> from digits.utils import parse_version File “d:\Works\Lib\NVIDIA\DIGITS\digits\utils\__init__.py”, line 158, in <module> from . import constants, image, time_filters, errors, forms, routing, auth File “d:\Works\Lib\NVIDIA\DIGITS\digits\utils\image.py”, line 15, in <module> import PIL.Image ImportError: No module named PIL.Image [/code] この場合は、PILが存在しないと言われているので、追加でインストールします。また先述のサイトから、モジュールをダウンロードしてきて下記のコマンドでインストールします。 [code lang=”batch”] python -m pip install Pillow-3.3.0-cp27-cp27m-win_amd64.whl [/code] 再度実行すればエラーが出ないはずです。 また、下記のメッセージが出る時があります。 [code lang=”batch”] Traceback (most recent call last): Default value for caffe_root “” invalid: Your Caffe does not have version info. Please upgrade it. ==================================== Caffe ===================================== Where is caffe installed?<br>Suggested values: (P\</em>) [PATH/PYTHONPATH] &gt;&gt; [/code] これは、Caffe.exeにバージョン情報が含まれていないため発生します。 ですので、caffeのビルド時に、プロジェクトファイルの編集を正しくできたかを確認してください。 ファイルのプロパティからはバージョン情報は確認できません。 成功すると [code lang=”batch”] Default value for torch_root “” invalid: torch binary not found in PATH Couldn’t import dot_parser, loading of dot files will not be possible. 2016-07-30 01:20:08 [INFO ] Loaded 0 jobs.<br>| \_ _/ __|_ _|_ _/ __| | |) | | (_ || | | | \__ \ |___/___\___|___| |_| |___/ 4.1-dev<br>* Running on <a href="http://0.0.0.0:5000/">http://0.0.0.0:5000/</a> [/code] と表示されます。 <strong><a href="http://localhost:5000/">http://localhost:5000</a></strong>でアクセスしてみると、動いていることが確認できます。 <img src="../../../../public/2016/07/img_579b8386b167f.png"></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>非公式ではありますが、Microsoft製CaffeでDIGITSを動かすことができました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Windows </category>
          
          <category> オープンソース </category>
          
          <category> Caffe </category>
          
          <category> ディープラーニング </category>
          
          <category> DIGITS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング Caffe for Windows その3 cuDNN 5.0対応</title>
      <link href="/2016/07/30/1460/"/>
      <url>/2016/07/30/1460/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-io">前回</a>は指紋の紋様を分類してみました。</p><a id="more"></a><h1 id="cuDNN"><a href="#cuDNN" class="headerlink" title="cuDNN"></a>cuDNN</h1><p>最近、Caffe for Microsoftが更新され、本家のBVLC/Caffeと同期がとられました。結構重要な更新があるのですが、cuDNN 5.0に対応しました。 対応方法は <strong>CommonSettings.props</strong> を少し書き換えるだけですが、パフォーマンスの向上が望めるので積極的に利用しましょう。 ダウンロード方法は以前と変わりません。 利用するCUDAによっては、cuDNN 5.0は利用できません。 <img src="../../../../public/2016/07/img_579b4e27d1a4e.png"> 現時点で、cuDNN 5.0は CUDA 7.5以降限定のようです。 Windowsには、Windows 7とWindows 10向けのパッケージが用意されていますので、適切なものをダウンロードしてください。 なおダウンロードしたcuDNNを展開する際、フォルダ構成が <code>XXXX/cuda/bin XXXX/cuda/include XXXX/cuda/lib</code> になるようにしてください。</p><h3 id="ビルド"><a href="#ビルド" class="headerlink" title="ビルド"></a>ビルド</h3><p>CommonSettings.propsのCuDNNPathをcuDNN 5.0の配置フォルダに変更するだけです。 前述の場合、XXXXまでをフルパスで指定します。 以上で完了です。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>実際、職場でビルドしたバイナリを使用した場合、4.0と比べて10%ほどパフォーマンスが向上していました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Windows </category>
          
          <category> オープンソース </category>
          
          <category> Caffe </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その6 gitでローカルにリモートリポジトリを作る</title>
      <link href="/2016/07/29/1448/"/>
      <url>/2016/07/29/1448/</url>
      
        <content type="html"><![CDATA[<p>よくあると思うけど、ようやく方法がわかったのでメモ。</p><a id="more"></a><h1 id="まずローカルリポジトリ"><a href="#まずローカルリポジトリ" class="headerlink" title="まずローカルリポジトリ"></a>まずローカルリポジトリ</h1><p><strong>TortoiseGit</strong> が楽なので、それを使ってメモ。 最初にgitで管理したいフォルダを作成します。 そのフォルダを開いて、右クリックから、<strong>Git ここにリポジトリを作成(Y)…</strong> を選択。 <img src="../../../../public/2016/07/img_579b4013c04f1.png"> 次のダイアログで <strong>Bare を生成(作業ディレクトリーを作りません)</strong> をチェック<strong>しない</strong>で、OKを押します。 <img src="../../../../public/2016/07/img_579b40564b989.png"> 最後に、このフォルダをコミットします。 この状態では、全てのファイルがバージョン管理下のファイルではないため、必要なファイルを選択してコミットします。 これでローカルリポジトリが完成します。 <img src="../../../../public/2016/07/img_579b408bf33a9.png"></p><h1 id="リモートリポジトリ"><a href="#リモートリポジトリ" class="headerlink" title="リモートリポジトリ"></a>リモートリポジトリ</h1><p>次にリモートリポジトリを作ります。 まず、リモートリポジトリとなるフォルダを配置する場所を決めます。 その場所でTortoiseGitの右クリックから、<strong>Git クローン(複製)…</strong> を選択。 <img src="../../../../public/2016/07/img_579b41e009326.png"> 次のダイアログで、先ほど作成したローカルリポジトリをクローン元に指定、リモートリポジトリのパスを指定します。 gitのマナーとして、リモートリポジトリの末尾は <strong>.git</strong> をつけるのが良いようです。 <img src="../../../../public/2016/07/img_579b424501df3.png"> この際、<strong>Bareリポジトリにクローン</strong>にチェックをいれるのを忘れないでください。 これによってリモートリポジトリができます。</p><h1 id="リモートリポジトリとつなげる"><a href="#リモートリポジトリとつなげる" class="headerlink" title="リモートリポジトリとつなげる"></a>リモートリポジトリとつなげる</h1><p>この状態では、ローカルリポジトリとリモートリポジトリに関連がありません。 まず、ローカルリポジトリを右クリックし、<strong>TortoiseGit -&gt; プッシュ</strong> と選択します。 <img src="../../../../public/2016/07/img_579b435e39a61.png"> この時は、リモートと関連がないため、<strong>宛先</strong>が空になっています。 <img src="../../../../public/2016/07/img_579b437512f5d.png"> これを設定するために<strong>管理(G)**をクリックします。 <img src="../../../../public/2016/07/img_579b43cc1e319.png"> 表示されるダイアログにリモートの</strong>名前 (ここでは origin としています)<strong>、</strong>URL** を指定します。 URLは先ほど .git と末尾に作成したフォルダをフルパスで指定します。 その他はデフォルトでOKです。 入力後、<strong>新規に追加/保存(A)**をクリックし、OKでダイアログを閉じます。 ダイアログが閉じると、宛先の</strong>リモート<strong>というコンボボックスに先ほど作成した **origin</strong>が設定されるので、それを確認し、OKを押してプッシュします。 以上で終了です。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>様々な事情でgitサーバーを用意できないことはあるので、ローカルにリモートリポジトリを作り、そこで作業をすることで、変わらないgitライフを送れます。 分散開発ではないですが、自由にコミットできて、履歴管理ができると言うことは非常に楽です。</p>]]></content>
      
      
      <categories>
          
          <category> バージョン管理システム </category>
          
          <category> git </category>
          
          <category> TortoiseGit </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その5 Update for Microsoft Visual Studio 2015 Update 3 (KB3165756)</title>
      <link href="/2016/07/16/1441/"/>
      <url>/2016/07/16/1441/</url>
      
        <content type="html"><![CDATA[<p>もうちょっと更新ペースをあげないと。</p><a id="more"></a><h1 id="パッチが出た！！"><a href="#パッチが出た！！" class="headerlink" title="パッチが出た！！"></a>パッチが出た！！</h1><p>2016/6/27にVisual Studio 2015 Update3がリリースされました。 が、その直後、問題が見つかりパッチがリリースされましたが、日本語の情報が何故かありません。 私自身は、アメリカのグループ会社のSkypeチャットで知らされた次第です。 ただ、最近のWebインストーラなら既にこの修正が適用されている可能性はありますが、初日にインストールしたなら確実に含まれていないと思われます。 詳細は下記になります。 </p><h1 id="日本語訳"><a href="#日本語訳" class="headerlink" title="日本語訳"></a>日本語訳</h1><h2 id="Bugs-that-are-fixed-in-version-14-0-25422-01-released-on-07-12-2016"><a href="#Bugs-that-are-fixed-in-version-14-0-25422-01-released-on-07-12-2016" class="headerlink" title="Bugs that are fixed in version 14.0.25422.01, released on 07/12/2016"></a>Bugs that are fixed in version 14.0.25422.01, released on 07/12/2016</h2><p><strong>Issue 1</strong> Visual Studio may leak memory when you use the editor light bulb to apply code actions to a C# or Visual Basic file. C#またはVisual Basicファイルに対して、エディターの電球マークを使用してコードアクションを使用すると、メモリリークを引き起こす可能性があります <strong>Issue 2</strong> Some large C# and Visual Basic projects that contain thousands of source files may experience memory and performance degradation because compilation symbols are unnecessarily realized. コンパイル シンボルが不必要に認識されることで、いくつかの、数千のソースファイルを含む巨大なC#またはVisual Basicプロジェクトがメモリリークとパフォーマンスの低下を引き起こす可能性があります <strong>Issue 3</strong> Shared projects may report an error after they are unloaded and reloaded if some of their source files are open. いくつかのソースファイルが開かれている場合、Sharedプロジェクトをアンロードし、再度ロードした後、Sharedプロジェクトがエラーを報告する可能性があります <strong>Issue 4</strong> Visual Studio may crash and cause a stack overflow exception when it generates IntelliSense for some C# files that contain nested generic types. ネストされたジェネリック型を含むC#ソースファイルに対して生成するIntelliSenseを生成するとき、Visual Studioがクラッシュし、StackOverflow例外を投げる可能性があります <strong>Issue 5</strong> In ASP.NET cshtml files, committing code completion after you type the full snippet may cause incorrect snippets to be added to the source file. ASP.NETのcshtmlファイルにおいて、完全なスニペットを入力した後のコード補間のコミットが間違ったスニペットをソースファイルに追加する可能性があります <strong>Issue 6</strong> This fix addresses a memory leak in the StandardCollector.Service.exe process. You commonly encounter this leak when you debug managed code on Windows 7 that has Visual Studio 2015 Update 3 installed. この修正はStandardCollector.Service.exeプロセス内のメモリリークに取り組みます。一般的に、Visual Studio 2015 Update3がインストールされたWindows7上で、マネージドコードをデバッグする際にメモリリークに遭遇します。 <strong>Issue 7</strong> When you debug JavaScript files by using certain module configurations, the debugger might not load the correct source maps. This causes the program to crash. There is no known workaround for this bug other than to apply this KB3165756 update. JavaScriptファイルをあるモジュール設定でデバッグするとき、デバッガーが正しいそースマップをロードしない可能性があります。これはプログラムのクラッシュを引き起こします。このバグに対して、本KB3165756アップデートを適用する以外に、既知の回避方法はありません。 <strong>Issue 8</strong> When you edit TypeScript build properties, the ourDir option does not save the changes that you made. After you make changes, the build properties page displays the previous state of outDir. As a workaround, you can add a tsconfig.json file that has the desired properties that match the current property configuration. Alternatively, you can manually edit the project file. TypeScriptビルド設定を編集しているときに、outDirオプションが変更を保存しません。変更後、ビルドプロパティページはoutDirの以前の状態を表示します。回避方法として、現在のプロパティ設定に一致する希望のプロパティを持つtsconfig.jsonをファイルを追加することができます。</p><h2 id="Bugs-that-are-fixed-in-version-14-0-25421-03-released-on-06-27-2016"><a href="#Bugs-that-are-fixed-in-version-14-0-25421-03-released-on-06-27-2016" class="headerlink" title="Bugs that are fixed in version 14.0.25421.03, released on 06/27/2016"></a>Bugs that are fixed in version 14.0.25421.03, released on 06/27/2016</h2><p><strong>Issue 1</strong> Visual Studio may crash when you close the Visual Studio IDE while C# and Visual Basic background operations are ongoing. C#またはVisual Basicのオペレーションがバックグラウンドで進行中にVisual Studio IDEを閉じることでVisual Studioがクラッシュすること可能性があります。 <strong>Issue 2</strong> Visual Studio may crash if you update a solution while the C# or Visual Basic build is completing and reporting diagnostics. C#またはVisual Basicのビルドが完了し、診断を報告している間に、ソリューションを更新すると、Visual Studioがクラッシュすること可能性があります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>07/12/2016リリースのIssue2, Issue4, Issue 6もやばいですが、06/27/2016の修正は全部緊急ですね。速くパッチを適用することをおすすめします。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ブート情報編集&amp;起動OS選択再起動ツールの公開</title>
      <link href="/2016/07/07/1435/"/>
      <url>/2016/07/07/1435/</url>
      
        <content type="html"><![CDATA[<p>オープンソースで公開します。詳細は <a href="https://taktak.jp/wordpress/apps/">APPS</a> または <a href="https://github.com/takuya-takeuchi/NextBootOSSelector">GitHub</a> をご覧ください。</p>]]></content>
      
      
      <categories>
          
          <category> ソフトウェア紹介 </category>
          
          <category> 自作ソフトウェア </category>
          
          <category> オープンソース </category>
          
          <category> Next Boot OS Selector </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その4 AppVeyorの &#39;Unable to locate&#39; エラーに対応する</title>
      <link href="/2016/07/07/1432/"/>
      <url>/2016/07/07/1432/</url>
      
        <content type="html"><![CDATA[<p>またも久しぶりの更新です。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>GithubでOSSを開発しており、AppVeyorでCIしていますが、自宅PCでビルドは通るのに、AppVeyorでビルドが失敗する事例が発生。 単純にソースの記述ではないようで、少し時間をロスしたのでメモ。 問題は、 [code] C:\projects\nextbootosselector\source\.nuget\NuGet.targets(83,9): error : Unable to locate ‘C:\projects\nextbootosselector\source\.nuget\NuGet.exe’ [C:\projects\nextbootosselector\source\NextBootOSSelector\NextBootOSSelector.csproj] [/code] というエラーログ。 Nuget.extを見つけることができませんでした、というエラー。 AppVeyorの設定でNugetの更新を実施するようスクリプトを組むだけではダメなようです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p><strong>.nuget/NuGet.targets</strong> をテキストファイルで開き、 [code lang=”xml”] <DownloadNuGetExe Condition=" '$(DownloadNuGetExe)' == '' ">false</DownloadNuGetExe> [/code] を [code lang=”xml”] <DownloadNuGetExe Condition=" '$(DownloadNuGetExe)' == '' ">true</DownloadNuGetExe> [/code] に修正します。 これでAppVeyorでエラーがなくなります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p><a href="http://stackoverflow.com/">Stackoverflow</a>さん、いつもありがとうございます。</p>]]></content>
      
      
      <categories>
          
          <category> CI </category>
          
          <category> オープンソース </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング Caffe for Windows その2 指紋紋様分類</title>
      <link href="/2016/06/23/1140/"/>
      <url>/2016/06/23/1140/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-m8">前回</a>は環境を構築してみました、</p><a id="more"></a><h1 id="指紋"><a href="#指紋" class="headerlink" title="指紋"></a>指紋</h1><p>指紋といえば、ごく一部の人間を覗いて全ての人間が手にもっている隆線によって形成される紋様です。 指紋を持っていない人間もごく一部に存在しますが… <strong>iPhone</strong>の<strong>TouchID</strong>で急激に認知度が向上した気がします。 特に日本では、指紋の採取というのは、人権団体とかの声とかプライバシー云々でいまいち悪のレッテルを貼られている感が否めません。 さて、指紋は古くから使われており、個人を識別する徴として、日本では拇印としてよく知られています。 個人を識別するだけなら、指紋以外に、虹彩、静脈、顔が有名です。 他にも掌紋、足紋もあります。</p><h3 id="生体認証"><a href="#生体認証" class="headerlink" title="生体認証"></a>生体認証</h3><p>この手の生物に備わる生体の特徴に基づいた認証を<strong>生体認証 (Biometrics)</strong> と呼びます。 指掌紋技術では、たくさんの企業が競争していますが、<strong>3M Cogent (アメリカ)**、</strong>Morpho (フランス)<strong>、</strong>NEC (日本)<strong>が三強です。 ここでいう三強とは、司法機関、入国管理など、大規模システムでの納入実績が大きい企業を指します。 (例えば、ロサンゼルス国際空港では、Morphoの指紋採取機器が入国管理ゲートにありますし、成田空港にはNECの指紋採取機器があります。) iPhoneの場合、</strong>Apple<strong>は</strong>AuthenTec社**を買収して、TouchIDを開発したようですが、これは指紋を読み取る機器の買収がメインだったと思われます。 指紋の採取の場合、光学センサーで読み取るのが主流ですが、AuthenTec社の場合は周波数で読み取るセンサーだったようで、それがiPhoneでの採用に繋がったのでしょう。 ですので、三強にAppleがない、というのは別に悪意があるわけではなく、この三強は、大規模システム、たとえば、数千万の指紋データから瞬時に個人を特定するなどの総合的な技術を持っています。TouchIDの場合、iPhoneに含まれる指紋データは一人のデータでかつ最大10本の指データです。大して大規模システムでは、入力指紋、つまり識別したい指紋1に対して候補となる指紋データは数千万にも上ることもあります。 事実、アメリカ国立標準技術研究所 (National Institute of Standards and Technology, NIST) の指掌紋技術コンテストでは、計測する内容にもよりますが、上位はこの三強が常です。 <a href="http://jpn.nec.com/press/201408/20140821_02.html">NEC、米国国立標準技術研究所(NIST)の指紋認証技術のベンチマークテストにおいて第1位の評価を獲得</a> <a href="http://www.morpho.com/en/media/20141119_morpho-places-first-nist-2014-minex-fingerprint-benchmark">Morpho places first in NIST 2014 MINEX fingerprint benchmark</a> さらに、犯罪現場に残った指紋、いわゆる遺留指紋とデータベースに載っている人間から直接採取した指紋 (押捺指紋) との照合、また他の犯罪現場で採取した別の遺留指紋との照合など、指紋照合と言ってもいろんなパターンがあるわけです。 特に遺留指紋は現場に指全体がきれいに残っているなんてあまりなくて、別の指紋と重なっている、一部しか残っていないとかよくある話です。 これらの問題を解決する技術をトータルで持っているのが上位三強です。 とはいっても、ニッチな技術で攻めるのは間違っていなくて、AuthenTec社はそれが幸いしてAppleに評価してもらえたわけです。</p><h3 id="特徴データ"><a href="#特徴データ" class="headerlink" title="特徴データ"></a>特徴データ</h3><p>さて、指紋、掌紋、足紋でも、他でもそうですが、採取した生体情報から、その生体情報を特徴付ける情報のみを抽出してデータ化します。 これを特徴データと呼んでいますが、指紋の場合、そのなかに特徴点 (Minutia) と呼ばれるものがあります。 特徴点が12個一致すれば、照合上、同一指紋とみなすことができます。 また、指紋においては、隆線 (芯線:Skeleton)も大事なデータですが、指紋の紋様自体も重要です。</p><h3 id="紋様"><a href="#紋様" class="headerlink" title="紋様"></a>紋様</h3><p>紋様には様々な種類がありますが、人種によって、紋様毎の発現率が異なります。下記はその一例です。実際はもっと種類があります。 [table id=23 /]<br><a href="../../../../public/2016/04/Patterns.png"><img src="../../../../public/2016/04/Patterns-1024x229.png"></a></p><p>紋様の一例</p><p>前置きが長くなりましたが、これらの紋様をディープラーニングで分類してみましょう。</p><h1 id="準備1"><a href="#準備1" class="headerlink" title="準備1"></a>準備1</h1><p>今回、DeepLearningのために、<strong>GeForce GTX 750 Ti</strong>を入手しました。 というわけで、Caffeのビルド設定を変更します。 Pythonは有効にし、<strong>CpuOnlyBuild</strong>をfalse、<strong>UseCuDNN</strong>をtrueにします。 特に重要なのが、<strong>CudaArchitecture</strong>です。 GTX 750 TiのCompute Capabilityは5.0なので、<strong>compute_50,sm_50</strong>を設定します。 以上で、ソリューションをリビルドします。</p><h1 id="準備2"><a href="#準備2" class="headerlink" title="準備2"></a>準備2</h1><p>次にデータですが、NISTが指紋データを教師情報と一緒に公開しています。 こんなの日本じゃありえません。素晴らしい。 下記からダウンロードできます。ただし、接続の調子が悪いのかタイムアウトすることが多々あります。 <a href="http://www.nist.gov/srd/nistsd4.cfm">Special Database 4 - NIST 8-bit Gray Scale Images of Fingerprint Image Groups.</a> <a href="http://www.nist.gov/srd/nistsd9.cfm">Special Database 9 - NIST 8-bit Gray Scale Images of Mated Fingerprint Card Pairs.</a> <a href="http://www.nist.gov/srd/nistsd14.cfm">NIST Mated Fingerprint Card Pairs 2. Has 2,700 ten-print card pairs of rolled fingerprints (no plain impressions).</a> 今回は、Special Database4を使います。4,9,14は無料ですが、他は有料だったりします。</p><p>入手したファイルを解凍すると、下記のような構成になっています。 <code>NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_0 NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_1 NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_2 NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_3 NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_4 NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_5 NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_6 NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_7</code> 各フォルダ内にpngとtxtファイルが500個ずつ含まれています。 学習にはfigs_0からfigs_6の3500枚の画像を使います。テストにはfigs_7を使います。 さて、データを見ていると指紋画像のサイズが512x512であることに気がつくと思います。 指紋認証の世界では512x512の500ppi (pixel per inch) が常識です。1000ppiもあります。 txtには、性別、紋様種別が含まれています。 このデータ群の紋様種別は、Whorls、Arch、Loops、Tented Arch、Right Loopの5種です。 これらを使って、画像のデータベース作成、学習、テスト、分類を実行します。 これら一連の流れを自動化したバッチを用意しました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><p>これらを、png_txtフォルダ直下に展開し、下記の2点を修正します。</p><h2 id="0-SetEnv-bat"><a href="#0-SetEnv-bat" class="headerlink" title="0.SetEnv.bat"></a>0.SetEnv.bat</h2><p><strong>CAFFE_ROOT</strong>、<strong>MINICONDA</strong>、<strong>ROOTFOLDER</strong>を環境に応じて変更します。</p><h2 id="io-py"><a href="#io-py" class="headerlink" title="io.py"></a>io.py</h2><p>今回の実験では、入力画像を8bitにして扱うことでメモリ消費量を削減しているのですが、PythonのCaffeモジュールが8bit画像として、画像を入力できないため、ネットワークと入力データの整合性がとれません。 そのため、<strong>7.Classify.bat</strong>を使うときだけ、**&lt;Miniconda2_root&gt;\Lib\site-packages\caffe\io.py**を修正します。 &lt; pre class=”lang:python decode:true “ &gt;def load_image(filename, color=True):[/code] を &lt; pre class=”lang:python decode:true “ &gt;def load_image(filename, color=False):[/code] と直します。 これで準備完了です。</p><h1 id="実験"><a href="#実験" class="headerlink" title="実験"></a>実験</h1><p>バッチを1から順に実行します。GPUを使えるなら、 <strong>1.CreateListFile.ps1 2.CreateDatabase.bat 3.MeanDatabase.bat 4.Train_GPU.bat 7.Classify.bat</strong> とコマンドプロンプトまたはPowerShellで順番に実行します。 ただし、<strong>7.Classify.bat</strong>は引数に画像ファイルを指定します。 例えば、 [code lang=”cmd”] 7.Classify.bat “D:\Works\NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_7\f1752_04.png” [/code] のような感じです。 <strong>4.Train_GPU.bat</strong>を実行することで、学習とテストを同時に実行します。 その結果、精度を表すAccuracyが10%弱が、最終的に約80%まで向上していることがわかります。3500回の学習で10分くらいでした。 [code lang=”cmd”] I0623 00:35:05.288350 6908 solver.cpp:337] Iteration 0, Testing net (#0) I0623 00:35:07.777075 6908 blocking_queue.cpp:50] Data layer prefetch queue empty I0623 00:35:09.379405 6908 solver.cpp:404] Test net output #0: accuracy = 0.148 I0623 00:35:09.382393 6908 solver.cpp:404] Test net output #1: loss = 1.61361 (* 1 = 1.61361 loss) [/code] が [code lang=”cmd”] I0623 00:49:38.984040 6908 solver.cpp:317] Iteration 3500, loss = 0.304031 I0623 00:49:38.986039 6908 solver.cpp:337] Iteration 3500, Testing net (#0) I0623 00:49:42.858041 6908 solver.cpp:404] Test net output #0: accuracy = 0.788 I0623 00:49:42.860039 6908 solver.cpp:404] Test net output #1: loss = 0.465629 (* 1 = 0.465629 loss) I0623 00:49:42.864039 6908 solver.cpp:322] Optimization Done. I0623 00:49:42.869042 6908 caffe.cpp:223] Optimization Done. [/code] になります。 しかし、これでは、本当に正しく学習できるいるのかいまいちわからないため、<strong>7.Classify.bat</strong>に学習に使った画像以外 (今回はfigs_7) から一枚を選んで、引数として渡して実行します。 結果として、f1751_08.pngの場合、 [code lang=”cmd”] Loading file: D:\Works\NISTSpecialDatabase4GrayScaleImagesofFIGS\sd04\png_txt\figs_7\f1751_08.png Classifying 1 inputs. Done in 0.22 s. Saving results into output.npy #1 | 3 T | 84.0% #2 | 2 R | 11.8% #3 | 0 A | 2.1% [/code] T (Tented Arch) が一番高い確率を出力してます。画像に対応するテキストファイル Gender: M Class: T History: f1751_08.pct TA a2618.pct と見比べると、一致していることがわかります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>DeepLearningのネタは結構転がっていますが、指紋を使った実験はweb上では無いと思います。 既に論文でDeepLearningでの紋様分類は存在しましたが、外国の論文でした。 日本語としての記事としてはなかなかレアではないでしょうか？</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1">https://github.com/takuya-takeuchi/Demo/tree/master/Caffe1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Windows </category>
          
          <category> オープンソース </category>
          
          <category> Caffe </category>
          
          <category> ディープラーニング </category>
          
          <category> 指掌紋 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その3 pipでインストールする先のPython.exeを指定する</title>
      <link href="/2016/06/22/1414/"/>
      <url>/2016/06/22/1414/</url>
      
        <content type="html"><![CDATA[<p>久しぶりの更新です。ちゃんと自分の知識をアウトプットしないとダメですね。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>WindowsでCaffeの環境を作っていて、<strong>pip</strong> を使って、Pythonに必要なモジュールを入れたはずが、何度やってもモジュールが認識されないことがありました。 どうも複数のPython (私の場合、<strong>Python 2.7</strong> と <strong>Miniconda2</strong>) が同一システムに含まれていたため、コマンドプロンプトでパスの通っている <strong>Python.exe</strong> が自分の意図したほうでなかったのが原因でした。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>割と単純で、pipでモジュールをインストールする先のPython.exeを指定し、下記のように起動します。 [code lang=”batch”] &lt;インストール先のPython.exeのフルパス&gt; -m pip install &lt;モジュール名&gt; [/code] これで、pipでインストール先を切り替えることができます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>複数のPythonを入れるのは良くないのかもしれませんね。今後、こういう意図しない動きをする可能性があるので要注意です。</p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その2 利用可能なWMIの名前空間一覧を確認する</title>
      <link href="/2016/05/30/1401/"/>
      <url>/2016/05/30/1401/</url>
      
        <content type="html"><![CDATA[<p>WMI (Windows Management Instrumentation) って面倒だよね。便利だとは思いますが。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>ちょっと気になる機能をC#から操作したいと思って、色々頑張っているんですが、WMIを使おうと思ってげんなりしています。 WMIで使うクラスの一覧はPowerShellから [code lang=”ps”] (Get-WmiObject -class meta_class).Name | sort [/code] ってやれば出てくるらしいんだけど、何故だかお目当てのものが出てこない。 さてどうしたものか、と思ってみると、WMIの名前空間の一覧を見る方法があるらしい。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p><strong>[コンピュータの管理]</strong> -&gt; <strong>[WMI コントロール]</strong> -&gt; **[プロパティ]**と進むと、確認できるのとのこと。 <a href="../../../../public/2016/05/1-10.png"><img src="../../../../public/2016/05/1-10.png" alt="コンピュータの管理"></a></p><p>コンピュータの管理</p><p><a href="../../../../public/2016/05/2-8.png"><img src="../../../../public/2016/05/2-8.png" alt="WMI コントロールのプロパティ"></a></p><p>WMI コントロールの右クリックメニューから”プロパティ”を選択</p><p><a href="../../../../public/2016/05/3-6.png"><img src="../../../../public/2016/05/3-6.png" alt="プロパティの詳細設定"></a></p><p>プロパティの詳細設定</p><p>ここで変更をクリック。 <a href="../../../../public/2016/05/4-4.png"><img src="../../../../public/2016/05/4-4.png" alt="名前空間のブラウザ"></a></p><p>名前空間のブラウザ</p><p>とりあえず、欲しい名前空間のものが存在することはわかった。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>PowerShellのスクリプトに最初から出てくればいいんですけどねぇ。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Windows </category>
          
          <category> Windows Management Instrumentation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング Caffe for Windows その1 環境構築</title>
      <link href="/2016/05/28/1372/"/>
      <url>/2016/05/28/1372/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-d2">結構前</a>にUbuntuにCaffeをインストールしました。</p><a id="more"></a><h1 id="Windows版がある"><a href="#Windows版がある" class="headerlink" title="Windows版がある!!"></a>Windows版がある!!</h1><p>会社でWindows上で動作するDeepLearning環境はないか？という質問を受けて、調べることになりました。 その過程でCaffeがWindowsで動作するように、<strong>Microsoft</strong>がgithubで開発を行っていることを知りました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/Microsoft/caffe" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/6154722?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">microsoft/caffe</div><div class="hbc-url">https://github.com/Microsoft/caffe</div><div class="hbc-description">Caffe on both Linux and Windows. Contribute to microsoft/caffe development by creating an account on GitHub.</div></div></div></div></a></div></div><p>CNTKがあるのに、Caffe?って思いましたが、Windowsシステムに開発者を集めるための一環としては、既にDeepLearningの世界ではそれなりの地位があるCaffeを使えるようにすることは非常に意義があるでしょう。 Windows向けのCaffeは個人デベロッパーがWindows向けにCaffeｗフォークして開発していました。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/niuzhiheng/caffe" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars2.githubusercontent.com/u/1098101?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">niuzhiheng/caffe</div><div class="hbc-url">https://github.com/niuzhiheng/caffe</div><div class="hbc-description">Caffe. Contribute to niuzhiheng/caffe development by creating an account on GitHub.</div></div></div></div></a></div></div><p>個人ではなく、巨大組織が開発にコミットするのは非常に心強いです。 (上述の個人フォークは一年前に開発が止まっています。)</p><h1 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h1><p>マニュアルがあるので、それを見ながらインストールしていきます。 トップページにあります。 <a href="http://wp.me/p7138e-dD">CNTKのインストール</a>といくつかかぶっていますのでサクサク行きましょう。</p><h1 id="ソースコード"><a href="#ソースコード" class="headerlink" title="ソースコード"></a>ソースコード</h1><p>Githubからクローンします。 コマンドでもいいですし、TortoiseGitやSourceTreeのようなGUIクライアントでも良いです。</p><h1 id="設定ファイルの準備"><a href="#設定ファイルの準備" class="headerlink" title="設定ファイルの準備"></a>設定ファイルの準備</h1><p>ビルドに必要な設定ファイルです。 クローンしたフォルダを **&lt;caffe_root&gt;**として、下記のコマンドを実行します。 [code lang=”cmd”] copy &lt;caffe_root&gt;\windows\CommonSettings.props.example caffe_path&gt;\windows\CommonSettings.props [/code]</p><h1 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h1><p>7.5をインストールします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://developer.nvidia.com/cuda-toolkit" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=developer.nvidia.com"></img><div class="hbc-site-name">NVIDIA Developer</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">CUDA Toolkit</div><div class="hbc-url">https://developer.nvidia.com/cuda-toolkit</div><div class="hbc-description">CUDA Toolkit Develop, Optimize and Deploy GPU-Accelerated Apps The NVIDIA® CUDA® Toolkit provides a development environment for creating hig…</div></div></div></div></a></div></div><p>環境に応じたインストーラをダウンロードしてください。</p><h1 id="NVIDIA-CUDA-Deep-Neural-Network-library-cuDNN"><a href="#NVIDIA-CUDA-Deep-Neural-Network-library-cuDNN" class="headerlink" title="NVIDIA CUDA Deep Neural Network library (cuDNN)"></a>NVIDIA CUDA Deep Neural Network library (cuDNN)</h1><p><strong>cuDNN v3</strong>または<strong>cuDNN v4</strong>をインストールします。 ダウンロードのために、事前に登録しておく必要があります。登録はすぐにできるわけではないので、余裕を持って行っておきましょう。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://developer.nvidia.com/cudnn" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=developer.nvidia.com"></img><div class="hbc-site-name">NVIDIA Developer</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">NVIDIA cuDNN</div><div class="hbc-url">https://developer.nvidia.com/cudnn</div><div class="hbc-description">NVIDIA cuDNN The NVIDIA CUDA® Deep Neural Network library (cuDNN) is a GPU-accelerated library of primitives for deep neural networks. cuDNN…</div></div></div></div></a></div></div><p>CUDAインストール後、<strong>環境変数CUDA_PATH</strong>が設定されますが、そこにcuDNNをコピーします。 または、<strong>CommonSettings.props</strong>の24行目にある<strong>CuDnnPath ノード</strong>にcuDNNへのパスを追記します。 展開したzipの構成が、<strong>D:\Works\Lib\NVIDIA\cudnn-4.0\cuda\bin</strong>のようになっているなら、下記のようになります。 <code>D:\Works\Lib\NVIDIA\cudnn-4.0</code> また、cuDNNを無効にすることもできます。CommonSettings.props内の<strong>UseCuDNN ノード</strong>のtrueをfalseに変更します。 下記のようになります。 [code lang=”xhtml”] <UseCuDNN>false</UseCuDNN> [/code]</p><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p>まず、Caffe Python ラッパーをビルドするために、CommonSettings.props内の<strong>PythonSupportノード</strong>のfalseをtrueに変更します。 下記のようになります。 [code lang=”xhtml”] <PythonSupport>true</PythonSupport> [/code] 次に、Miniconda 2.7をインストールします。64-bitと32-bitがあるので、適切なインストーラを実行してください。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://conda.pydata.org/miniconda.html" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=conda.pydata.org"></img><div class="hbc-site-name">conda.pydata.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Miniconda — Conda   documentation</div><div class="hbc-url">http://conda.pydata.org/miniconda.html</div></div></div></div></a></div></div><p><a href="../../../../public/2016/05/1-8.png"><img src="../../../../public/2016/05/1-8.png" alt="インストーラ初期画面"></a></p><p>インストーラ初期画面</p><p><a href="../../../../public/2016/05/2-7.png"><img src="../../../../public/2016/05/2-7.png" alt="ライセンス"></a></p><p>ライセンス</p><p><a href="../../../../public/2016/05/3-5.png"><img src="../../../../public/2016/05/3-5.png" alt="インストール先"></a></p><p>インストール先</p><p>マニュアルにはAll Userと書いてありますが、特に気にする必要はないでしょう。 <a href="../../../../public/2016/05/4-3.png"><img src="../../../../public/2016/05/4-3.png" alt="インストール先ディレクトリ指定"></a></p><p>インストール先ディレクトリ指定</p><p>お好みの場所に。 <a href="../../../../public/2016/05/5-1.png"><img src="../../../../public/2016/05/5-1.png" alt="オプション"></a></p><p>オプション</p><p>環境変数への追加は必須なので、最初のオプションはチェックします。 2つめのオプションはなくても良いです。 <a href="../../../../public/2016/05/6-2.png"><img src="../../../../public/2016/05/6-2.png" alt="インストール中"></a></p><p>インストール中</p><p><a href="../../../../public/2016/05/7-2.png"><img src="../../../../public/2016/05/7-2.png" alt="インストール完了"></a> <a href="../../../../public/2016/05/8-2.png"><img src="../../../../public/2016/05/8-2.png" alt="インストール完了"></a></p><p>インストール完了</p><p>インストール完了後、Minicondaへのパスが<strong>環境変数PATH</strong>に追加されます。 さらに、Pythonのインストールディレクトリを<strong>PythonDirノード</strong>に記述します。 これはgithubのマニュアルにも書いていないので注意です。デフォルトで<strong>C:\Miniconda2</strong>になっているので、そこにインストールしたなら気にする必要はありません。 [code lang=”xhtml”] <PythonDir>C:\Program Files\Miniconda2\</PythonDir> [/code] 最後に、管理者権限で実行したコマンドプロンプトから下記のコマンドを実行します。 [code lang=”cmd”] conda install –yes numpy scipy matplotlib scikit-image pip pip install protobuf [/code] 必要なパッケージのダウンロードとインストールが実行されます。 少し時間がかかりますが、コーヒーでも飲んで待ちましょう。 最後に、Pythonを使って後述のビルドを実行した後、使用するために、下記のどちらかを実行します。</p><p>PythonPath環境変数に<strong>\Build\x64\Release\pycaffe</strong>へのパスを通す</p><p><strong>\Build\x64\Release\pycaffe\caffe</strong>を<strong>\lib\site-packages</strong>にコピー</p><p>個人的には、後者がおすすめです。環境変数を汚したくないので。 シンボリックリンクでも貼って、常にsite-packagesがcaffeフォルダを参照するようにしましょう。 コマンドは下記です。 [code lang=”cmd”] mklink \lib\site-packages\caffe \Build\x64\Release\pycaffe\caffe /D [/code]</p><h1 id="MATLAB"><a href="#MATLAB" class="headerlink" title="MATLAB"></a>MATLAB</h1><p>MATLABを私は持っていませんので、マニュアルの説明だけです。 Caffe MATLAB ラッパーをビルドするために、CommonSettings.props内の<strong>MatlabSupportノード</strong>のfalseをtrueに変更します。 下記のようになります。 [code lang=”xhtml”] <MatlabSupport>true</MatlabSupport> [/code] さらに、MATLABのインストールディレクトリを<strong>MatlabDirノード</strong>に記述します。 [code lang=”xhtml”] <MatlabDir>C:\Program Files\MATLAB\R2014b</MatlabDir> [/code] 最後に、MATLABを使って後述のビルドを実行した後、使用するために、</p><p>MATLABの検索パスに生成したmatcaffeフォルダーを追加</p><p><strong>\Build\x64\Release</strong>をパスに通す</p><p>を実行します。</p><h1 id="ビルド"><a href="#ビルド" class="headerlink" title="ビルド"></a>ビルド</h1><p>Visual Studio 2013でビルドします。 <strong>\windows\Caffe.sln</strong>を開いてビルドしましょう。 もしくは、下記のコマンドをコマンドプロンプトから実行することで、Visual Studioを立ち上げることなくビルドできます。 [code lang=”cmd”] cd \windows\Caffe.sln “C:\Program Files (x86)\MSBuild\12.0\Bin\amd64\MSBuild.exe” /p:Configuration=Release /p:Platform=”x64” Caffe.sln /t:clean /verbosity:quiet /nologo “C:\Program Files (x86)\MSBuild\12.0\Bin\amd64\MSBuild.exe” /p:Configuration=Release /p:Platform=”x64” Caffe.sln /t:rebuild /verbosity:quiet /nologo &gt; Build.log [/code] かなり時間がかかります。 ビルド完了後、<strong>\Build\x64\Release</strong>に<strong>caffe.exe</strong>が生成されています。 ビルド終了後も生成されていない場合は、Build.logを確認して、エラーに対処してください。 ちなみに、caffeには様々な依存ライブラリ (boost、glog、hdf5、LevelDB、OpenCV等) がありますが、それらの依存関係はNuGetで解決しています。</p><h1 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h1><p>環境構築が終わりましたので、次回はモデルを使用して、学習をしてみたいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> Windows </category>
          
          <category> オープンソース </category>
          
          <category> Caffe </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>開発メモ その1 Visual Studio 2013が起動しない</title>
      <link href="/2016/05/27/1386/"/>
      <url>/2016/05/27/1386/</url>
      
        <content type="html"><![CDATA[<p>最近開発環境が壊れてきたのか、またまた問題がでてきました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Visual Studio 2013起動中 <a href="../../../../public/2016/05/1-9.png"><img src="../../../../public/2016/05/1-9.png" alt="&#39;Microsoft.VisualStudio.Shell.Connected.ConnectedUser.ConnectedUserPackage&#39; パッケージは正しく読み込まれませんでした"></a></p><p>‘Microsoft.VisualStudio.Shell.Connected.ConnectedUser.ConnectedUserPackage’ パッケージは正しく読み込まれませんでした</p><p>というメッセージが。しかもOKボタンでも閉じても、別のパッケージがないというメッセージが次から次へと。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://social.msdn.microsoft.com/Forums/sqlserver/en-US/d068f530-f4ac-4ce5-bdfe-dcbfe5bf6e5c/visual-studio-2013-provider-package-failed-to-load?forum=visualstudiogeneral" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=social.msdn.microsoft.com"></img><div class="hbc-site-name">social.msdn.microsoft.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">    visual studio 2013 provider package failed to load</div><div class="hbc-url">https://social.msdn.microsoft.com/Forums/sqlserver/en-US/d068f530-f4ac-4ce5-bdfe-dcbfe5bf6e5c/visual-studio-2013-provider-package-failed-to-load?forum=visualstudiogeneral</div></div></div></div></a></div></div><p>にて解決策が。 <strong>%USERPROFILE%\AppData\Local\Microsoft\VisualStudio\12.0\ComponentModelCache</strong>を削除してから起動すると、直るとのこと。 事実、その通りにしたら無事に起動しました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>原因は不明。大量の拡張機能等がインストールされたりすると発生する予感。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Red Armory 1.1.0.0 公開</title>
      <link href="/2016/05/22/1369/"/>
      <url>/2016/05/22/1369/</url>
      
        <content type="html"><![CDATA[<p>機能追加とバグ修正を実施。詳細は <a href="https://taktak.jp/wordpress/apps/">APPS</a> または <a href="https://github.com/takuya-takeuchi/RedArmory">GitHub</a> をご覧ください。</p>]]></content>
      
      
      <categories>
          
          <category> ソフトウェア紹介 </category>
          
          <category> 自作ソフトウェア </category>
          
          <category> Red Armory </category>
          
          <category> オープンソース </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Statck を3.2.2-0に更新した</title>
      <link href="/2016/05/19/1363/"/>
      <url>/2016/05/19/1363/</url>
      
        <content type="html"><![CDATA[<p>会社のPCが一日三回くらいBSOD(死のブルースクリーン)に陥るので、初期化を実施しました。この際、3.2.0-0を現時点の最新版に更新。</p><a id="more"></a><h1 id="やっぱり一筋縄ではいかない"><a href="#やっぱり一筋縄ではいかない" class="headerlink" title="やっぱり一筋縄ではいかない"></a>やっぱり一筋縄ではいかない</h1><p>自作のRedArmoryがあるので、データベースやプラグインの退避と復元は良いのですが、マイグレーションは相変わらず面倒。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/RedArmory" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/RedArmory</div><div class="hbc-url">https://github.com/takuya-takeuchi/RedArmory</div><div class="hbc-description">Backup and Restore tool for Bitnami Redmine Stack. Contribute to takuya-takeuchi/RedArmory development by creating an account on GitHub.</div></div></div></div></a></div></div><p>マイグレーションもバッチを組んでいるので、そこまで苦ではないのですが、はまるところには本当にはまります。</p><h1 id="git-cloneが動かない"><a href="#git-cloneが動かない" class="headerlink" title="git cloneが動かない"></a>git cloneが動かない</h1><p>会社のPCには知識DBとしてredmine_knowledgebaseを使っています。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/alexbevi/redmine_knowledgebase" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/135803?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">alexbevi/redmine_knowledgebase</div><div class="hbc-url">https://github.com/alexbevi/redmine_knowledgebase</div><div class="hbc-description">A knowledgebase plugin for Redmine. Contribute to alexbevi/redmine_knowledgebase development by creating an account on GitHub.</div></div></div></div></a></div></div><p>ですが、このソフトもそれなりに導入に際してトラブルが多いです。 もちろん、トラブルを乗り越える価値は絶対にあります。 久しぶりにPCを初期化して0から環境を構築したので、すんなりマイグレーションできなかったわけです。 で、何が問題かというと、<strong>bundle install</strong>で依存gemを自動で持ってくるようにしたのですが、これが失敗するんです。 まず、redmine_knowledgebaseのgemspecはredmine_acts_as_taggable_onというgemを持ってこようとします。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/alexbevi/redmine_acts_as_taggable_on" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/135803?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">alexbevi/redmine_acts_as_taggable_on</div><div class="hbc-url">https://github.com/alexbevi/redmine_acts_as_taggable_on</div><div class="hbc-description">A gem which allows multiple Redmine plugins to use acts_as_taggable_on without stepping on each others&#39; toes. - alexbevi/redmine_acts_as_tag…</div></div></div></div></a></div></div><p>この際、gitを使ってCloneするのですが、**git://**というプロトコルで通信するため、会社の通信環境では通らないわけです。 しかもporxyのおまけ付き。これは別にいいです。 下記のコマンドでgitプロトコルを強制的にhttpsアクセスに切り替えています。 [code lang=”sh”] git config –global url.”https://“.insteadOf git:// [/code] また、下記のコマンドでproxyを有効にします。 [code lang=”sh”] git config –global http.proxy <a href="http://proxy.example.com:8080/">http://proxy.example.com:8080</a> [/code] ここまでこれば普通に動くはずなんです。 が、動かない。bundle installでredmine_acts_as_taggable_onを持ってくるのに失敗する。 エラーの出力も、具体的なエラーを出さない。</p><h1 id="dllが古い"><a href="#dllが古い" class="headerlink" title="dllが古い"></a>dllが古い</h1><p>さて、悩むこと2時間。 何が原因だったのか、というと思い出しました。 原因は、OpenSSLまわりのdllが古いことでした。libeay32が古いせいか、git-remot-https.exeがコールしようとしているAPIが存在しないため、cloneに失敗していたようです。 <strong>プロシージャ エントリ ポイント XXXXXXX がダイナミック リンク ライブラリ LIBEAY32.dll から見つかりませんでした。</strong>ってやつです。 どうしてこうなるのかわかりませんが、なるものは仕方ないですので、対応策です。 ただ、これは応急処置というか、システムの依存関係を壊すかもしれないので注意です。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://indy.fulgan.com/SSL/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=indy.fulgan.com"></img><div class="hbc-site-name">indy.fulgan.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">Index of /SSL</div><div class="hbc-url">http://indy.fulgan.com/SSL/</div></div></div></div></a></div></div><p>上記ページから、環境に合わせたzipをダウンロードしてきてください。最新版です。 Windowsの32bitなら、<strong>openssl-1.0.2h-i386-win32.zip</strong>、64bitなら<strong>openssl-1.0.2h-x64_86-win64.zip</strong>です。 これを解凍して、systemフォルダに突っ込みますが、32bit環境なら、<strong>C:\Windows\System32</strong>、64bit環境なら<strong>C:\Windows\SysWOW64</strong>にコピーしてください。64bit環境は32bit版もインストールしておいた方が良いかもしれません。 これで、bundle installのgit cloneが成功し、関連するgemを全部引っ張ってきてredmine_knowledgebaseのインストールに成功します。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その20 PCLでもNative Embeddingしてみる</title>
      <link href="/2016/05/18/1355/"/>
      <url>/2016/05/18/1355/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-jL">前回</a>はデバイス固有の電話機能を使ってみました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Xamarin.Formsの2.2から各OS固有のコントロール (Native Control)をSharedプロジェクトから生成して、ContentView.ContentやLayout.Childrenに埋め込むことができるようになりました。 このあたりの説明は、P3PPP様の下記の記事が参考になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://ticktack.hatenablog.jp/entry/2016/04/30/143738" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=ticktack.hatenablog.jp"></img><div class="hbc-site-name">ぴーさんログ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/11696248318758645812/6653812171393728820/1461994658"></img></div><div class="hbc-text"><div class="hbc-title">【Xamarin.Forms 2.2】Embedded Platform-Specific Controls in Xamarin.Forms - ぴーさんログ</div><div class="hbc-url">http://ticktack.hatenablog.jp/entry/2016/04/30/143738</div><div class="hbc-description">Xamarin.Forms 2.2から Layout.Children や ContentView.Content に各プラットフォームのネイティブコントロールを埋め込めるようになり、Evolve 2016のキーノートでも紹介されました。 このフィーチャーを使うとCustomRe…</div></div></div></div></a></div></div><p>で、ポイントは、Sharedプロジェクトで**#ifディレクティブ**で分岐するとかする必要があるとのこと。 でも、思うわけですよ。C++ならともかく、モダンなC#でそんなことしたくないわけですよ。 ディレクティブだらけのソースなんか保守性低下するのは目に見えていますから。 で、思いました。 PCLから、Native Controlを使えないか？って。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>仕組みは単純で、前回話したDependencyServiceを上手く使うだけです。 各プロジェクトでNative Controlを生成して、それをPCL側で使用するだけです。 ただし、当然Native Controlは、そのままでは、Xamarin.FormsのUIに追加できません。 <a href="https://developer.xamarin.com/api/type/Xamarin.Forms.View/">Xamarin.Forms.View</a>に変換する必要があります。 この変換は拡張メソッドの<strong>Xamarin.Forms.Platform.iOS.LayoutExtensions.ToView</strong>、<strong>Xamarin.Forms.Platform.Android.LayoutExtensions.ToView</strong>、<strong>Xamarin.Forms.Platform.UWP.LayoutExtensions.ToView</strong>を使用して、Native ControlをViewに変換します。 今回のソースは下記になります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable9" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable9</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h4 id="PCL"><a href="#PCL" class="headerlink" title="PCL"></a>PCL</h4><p>最初にPCLの説明をします。</p><h4 id="Serviceのinterface"><a href="#Serviceのinterface" class="headerlink" title="Serviceのinterface"></a>Serviceのinterface</h4><p>3つのデバイスのNative Controlを生成するためのinterfaceである<strong>INativeControlService</strong>を定義します。 <strong>INativeControlService.cs</strong> [code lang=”csharp”] namespace Xamarin.Forms.Portable9.Services { public interface INativeControlService {<br>View Create();<br>}<br>} [/code] 各プロジェクトはPCLを参照しているので、このinterfaceを実装して各固有機能へのアクセスを提供します。</p><h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>Viewです。 今回はソースから追加するので、 <strong>MainPage.xaml</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <ContentPage xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" x:Class="Xamarin.Forms.Portable9.Views.MainPage"> </ContentPage> [/code] Contentを空にしました。 このMainPageの生成は、PCLのApp.csで実施します。 <strong>App.cs</strong> [code lang=”csharp”] using Xamarin.Forms.Portable9.Services; using Xamarin.Forms.Portable9.Views;<br>namespace Xamarin.Forms.Portable9 { public class App : Application { public App() { var service = DependencyService.Get(); var view = service.Create() as View; view.HorizontalOptions = LayoutOptions.Center; view.VerticalOptions = LayoutOptions.Center;<br>// The root page of your application MainPage = new MainPage { Content = view }; }<br>protected override void OnStart() { // Handle when your app starts }<br>protected override void OnSleep() { // Handle when your app sleeps }<br>protected override void OnResume() { // Handle when your app resumes } } } [/code]</p><h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p>PCLで定義したインターフェースを実装します。 <strong>NativeControlService.cs</strong> [code lang=”csharp”] using UIKit; using Xamarin.Forms.Platform.iOS; using Xamarin.Forms.Portable9.iOS.Services; using Xamarin.Forms.Portable9.Services;<br>[assembly: Xamarin.Forms.Dependency(typeof(NativeControlService))] namespace Xamarin.Forms.Portable9.iOS.Services { public sealed class NativeControlService : INativeControlService {<br>public View Create() { var label = new UILabel { MinimumFontSize = 14f, Lines = 0, LineBreakMode = UILineBreakMode.WordWrap, Text = “iOS”, };<br>return label.ToView(); }<br>}<br>} [/code]</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p><strong>NativeControlService.cs</strong> [code lang=”csharp”] using Android.Widget; using Xamarin.Forms.Platform.Android; using Xamarin.Forms.Portable9.Droid.Services; using Xamarin.Forms.Portable9.Services;<br>[assembly: Xamarin.Forms.Dependency(typeof(NativeControlService))] namespace Xamarin.Forms.Portable9.Droid.Services { public sealed class NativeControlService : INativeControlService { public View Create() { var view = new TextView(Forms.Context) { Text = “Android”, TextSize = 14, };<br>return view.ToView(); }<br>}<br>} [/code]</p><h4 id="UWP"><a href="#UWP" class="headerlink" title="UWP"></a>UWP</h4><p><strong>NativeControlService.cs</strong> [code lang=”csharp”] using Windows.UI.Xaml.Controls; using Xamarin.Forms.Platform.UWP; using Xamarin.Forms.Portable9.Services; using Xamarin.Forms.Portable9.UWP.Services;<br>[assembly: Xamarin.Forms.Dependency(typeof(NativeControlService))] namespace Xamarin.Forms.Portable9.UWP.Services { public sealed class NativeControlService : INativeControlService {<br>public View Create() { var label = new TextBlock { Text = “UWP”, };<br>return label.ToView(); }<br>}<br>} [/code]</p><h1 id="実行してみる"><a href="#実行してみる" class="headerlink" title="実行してみる"></a>実行してみる</h1><h4 id="iOS-1"><a href="#iOS-1" class="headerlink" title="iOS"></a>iOS</h4><p><a href="../../../../public/2016/05/1-7.png"><img src="../../../../public/2016/05/1-7-196x300.png" alt="UILabel"></a></p><p>UILabel</p><h4 id="Android-1"><a href="#Android-1" class="headerlink" title="Android"></a>Android</h4><p><a href="../../../../public/2016/05/2-6.png"><img src="../../../../public/2016/05/2-6-167x300.png" alt="TextView"></a></p><p>TextView</p><h4 id="UWP-1"><a href="#UWP-1" class="headerlink" title="UWP"></a>UWP</h4><p>**Layout cycle detected. Layout could not complete.**という例外を投げたため実行できませんでした。何故だ…. <a href="../../../../public/2016/05/3-4.png"><img src="../../../../public/2016/05/3-4-1024x245.png" alt="無慈悲な例外"></a></p><p>無慈悲な例外</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Sharedプロジェクトでしか使えない、というのはディレクティブの関係なので、固有のUI生成を各プロジェクトに任せてしまえば、どうとでもなります。 XAMLで使えるように工夫次第でできるはずです。 ContentViewの派生クラスのコンストラクタでDependencyService経由で生成したNative Controlをラップすれば、それをXAMLから使うことができるでしょう。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable9">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable9</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その19 デバイス固有機能の電話を使ってみる</title>
      <link href="/2016/05/07/1225/"/>
      <url>/2016/05/07/1225/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-lA">前回</a>はXamarin.Forms.Themesをレビューしました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Xamarinにおいて、UIはXamarin.FormsをSharedまたはPCLプロジェクトに定義することで共通化を図っています。 しかしながら、デバイス固有の機能、例えば電話、カメラ、ファイル選択、指紋認証などは共通化されていません。 そのために、Xamarinでは<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.DependencyService/">Xamarin.Forms.DependencyService</a>クラスを利用して、共通コードからデバイス固有の機能にアクセスします。 <a href="https://developer.xamarin.com/guides/xamarin-forms/dependency-service/introduction/">Introduction to DependencyService</a>に詳しく書いてありますが、ポイントは各プロジェクト (iOS、Android、UWP、Windows Phone)で同じinterfaceを実装し、その実装をDependencyServiceクラス経由で取得し、呼び出しているだけです。要するに、<strong>Dependency Injection (依存性の注入)</strong> です。 <a href="../../../../public/2016/05/overview_diagram.png"><img src="../../../../public/2016/05/overview_diagram-1024x562.png" alt="概要"></a></p><p>概要図 (<a href="https://developer.xamarin.com/guides/xamarin-forms/dependency-service/introduction/%E3%82%88%E3%82%8A%E5%BC%95%E7%94%A8">https://developer.xamarin.com/guides/xamarin-forms/dependency-service/introduction/より引用</a>)</p><p>今回は電話を使ってみようと思います。 今回のソースです。 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable6">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable6</a> ただし、iOS Simluatorは電話のテストをサポートしていません。何故でしょう？</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>オープンソースでデバイス固有の機能をライブラリとして提供しているパッケージがあります。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.nuget.org/packages/XLabs.Forms/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.nuget.org"></img><div class="hbc-site-name">www.nuget.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://api.nuget.org/v3-flatcontainer/xlabs.forms/2.0.5782/icon"></img></div><div class="hbc-text"><div class="hbc-title">XLabs.Forms 2.0.5782</div><div class="hbc-url">https://www.nuget.org/packages/XLabs.Forms/</div><div class="hbc-description">XLabs.Forms is a open source project that aims to provide a powerfull and cross platform set of controls tailored to work with Xamarin Forms…</div></div></div></div></a></div></div> <div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/XLabs/Xamarin-Forms-Labs" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars1.githubusercontent.com/u/7787062?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">XLabs/Xamarin-Forms-Labs</div><div class="hbc-url">https://github.com/XLabs/Xamarin-Forms-Labs</div><div class="hbc-description">Xamarin Forms Labs is a open source project that aims to provide a powerful and cross platform set of controls and helpers tailored to work …</div></div></div></div></a></div></div> Xamarin.Forms用の、クロスプラットフォーム向けに個別対応されたコントロール群とヘルパーのライブラリとのこと。 ですが、UWPの対応が良くない、というか大量にコメントアウトしてあって、どうも一時対応を休止しているような感じです。 また、最新版のソースだと、iOSのビルドに問題があるため、Androidしか使えない状態なので、自分で実装します。<h4 id="PCL"><a href="#PCL" class="headerlink" title="PCL"></a>PCL</h4><p>最初にPCLの説明をします。</p><h4 id="Serviceのinterface"><a href="#Serviceのinterface" class="headerlink" title="Serviceのinterface"></a>Serviceのinterface</h4><p>3つのデバイスの固有機能にアクセスするためのinterfaceである<strong>IPhoneService</strong>を定義します。 <strong>IPhoneService.cs</strong> [code lang=”csharp”] namespace Xamarin.Forms.Portable6.Services { public interface IPhoneService {<br>void ShowUI(string dialNumber, string displayName);<br>} } [/code] 各プロジェクトはPCLを参照しているので、このinterfaceを実装して各固有機能へのアクセスを提供します。</p><h4 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h4><p>次に、ViewModelを作ります。 簡単に、電話番号の入力フィールドと通話ボタンを押下した際のコマンドを提供します。 ただし、通話と言うよりも、通話のためのUIを呼ぶだけです。 <strong>PhonePageViewModel.cs</strong> [code lang=”csharp”] using System.Windows.Input; using Microsoft.Practices.Prism.Mvvm; using Xamarin.Forms.Portable6.Services;<br>namespace Xamarin.Forms.Portable6.ViewModels { public class PhonePageViewModel : BindableBase {<br>private readonly IPhoneService _PhoneService;<br>public PhonePageViewModel() { _PhoneService = DependencyService.Get(); }<br>private string _Number; public string Number { get { return this._Number; } set { this.SetProperty(ref this._Number, value); } }<br>private string _DisplayName; public string DisplayName { get { return this._DisplayName; } set { this.SetProperty(ref this._DisplayName, value); } }<br>private ICommand _CallCommand; public ICommand CallCommand { get { return _CallCommand ?? new Microsoft.Practices.Prism.Commands.DelegateCommand( () =&gt; { this._PhoneService.ShowUI(this.Number, this.DisplayName); }, () =&gt; true); } }<br>}<br>} [/code] DependencyService.GetメソッドでIPhoneServicdインターフェースを実装したクラスのインスタンスを取得しています。 インスタンスの登録は、各プロジェクトのスタートアップコードで実行します。 他に特筆するべきことは無いはずです。</p><h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>最後にViewです。 Xamarin.Formsではテキスト入力フィールドは<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.Editor/">Editor</a>です。 ちょっとすぐには思いつかない名前でした。 <strong>PhonePage.xaml</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <ContentPage x:Class="Xamarin.Forms.Portable6.Views.PhonePage" xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:viewModels="clr-namespace:Xamarin.Forms.Portable6.ViewModels;assembly=Xamarin.Forms.Portable6"> &lt;ContentPage.BindingContext&gt; &lt;viewModels:PhonePageViewModel /&gt; &lt;/ContentPage.BindingContext&gt; <StackLayout HorizontalOptions="Center" VerticalOptions="Center"> <Editor HeightRequest="50" Text="{Binding Number}" WidthRequest="200" /> <Button Command="{Binding CallCommand}" Text="Call" /> </StackLayout> </ContentPage> [/code] 以上です。 App.csはこのViewをインスタンス化するだけです。</p><h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p>いよいよ固有デバイス機能の実装です。 前述の通り、PCLで定義したインターフェースを実装します。 <strong>PhoneService.cs</strong> [code lang=”csharp”] using Foundation; using CoreTelephony; using Foundation; using UIKit; using Xamarin.Forms.Portable6.iOS.Services; using Xamarin.Forms.Portable6.Services;<br>[assembly: Xamarin.Forms.Dependency(typeof(PhoneService))] namespace Xamarin.Forms.Portable6.iOS.Services { public sealed class PhoneService : IPhoneService { public void ShowUI(string dialNumber, string displayName) { var ctTelephonyNetworkInfo = new CTTelephonyNetworkInfo(); var carrier = ctTelephonyNetworkInfo.SubscriberCellularProvider; if (carrier?.IsoCountryCode == null) { return; }<br>var nsUrl = new NSUrl(new System.Uri($”tel:{dialNumber}”).AbsoluteUri); var result = UIApplication.SharedApplication.OpenUrl(nsUrl); } }<br>} [/code] iOSの固有APIはここでは無視しますが、重要なのは名前空間の上にある<strong>assembly属性</strong>です。 ここで、依存性のあるクラスを登録します。つまり、<strong>PhoneSerivceクラス</strong>を登録するので、前述の<strong>PhonePageViewModelクラス</strong>で<strong>IPhoneSerivceインターフェース</strong>を実装したクラスのインスタンスを取得できるわけです。 ただ、個人的には、Prismのように動的に登録できたりしないのか、という疑問が残ります。 この記述だと、デバイスのバージョンに応じて実装クラスを変更するようなことができません。</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p>Androidです。 <strong>PhoneService.cs</strong> [code lang=”csharp”] using Android.Content; using System.Linq; using Android.Content; using Android.Net; using Android.Telephony; using Xamarin.Forms.Portable6.Droid.Services; using Xamarin.Forms.Portable6.Services;<br>[assembly: Xamarin.Forms.Dependency(typeof(PhoneService))] namespace Xamarin.Forms.Portable6.Droid.Services { public sealed class PhoneService : IPhoneService { public void ShowUI(string dialNumber, string displayName) { var number = PhoneNumberUtils.FormatNumber(dialNumber.Trim(),”JP” ); var intent = new Intent(Intent.ActionDial, Uri.Parse(“tel:” + number)); if (!IsIntentAvailable(intent)) { return; }<br>intent.SetFlags(ActivityFlags.NewTask); Android.App.Application.Context.StartActivity(intent); }<br>public static bool IsIntentAvailable(Intent intent) { var context = Forms.Context; var packageManager = context.PackageManager;<br>var list = packageManager.QueryIntentServices(intent, 0) .Union(packageManager.QueryIntentActivities(intent, 0));<br>if (list.Any()) return true;<br>var manager = TelephonyManager.FromContext(context); return manager.PhoneType != PhoneType.None; } }<br>} [/code] これも同じですね。ちょっとAndroidは面倒です。 iOSもそうですが、url形式で機能の呼び出しを制御しているのは正直あまり好きではないです… 今回のコードで、プロジェクトのプロパティから、<strong>Required permissions</strong>にて、<strong>CALL_PHONE</strong>にチェックを入れる必要は無いです。 <strong>Intent.ActionCall</strong>の場合はチェックが必要です。 今回、Androidは残念ながらテストできませんでした。PhoneTypeが常にNoneのため、StartActivityまで到達しませんでした。 強制的に呼び出しても例外を出して落ちます。何故だ。</p><h4 id="UWP"><a href="#UWP" class="headerlink" title="UWP"></a>UWP</h4><p>UWPもといWindows Mobile 10です。 <strong>PhoneService.cs</strong> [code lang=”csharp”] using Xamarin.Forms.Portable6.Services; using Xamarin.Forms.Portable6.UWP.Services;<br>[assembly: Xamarin.Forms.Dependency(typeof(PhoneService))] namespace Xamarin.Forms.Portable6.UWP.Services {<br>public sealed class PhoneService : IPhoneService { public void ShowUI(string dialNumber, string displayName) { Windows.ApplicationModel.Calls.PhoneCallManager.ShowPhoneCallUI(dialNumber, displayName ?? “Test Person”); } }<br>} [/code] 他と違ってシンプルです。</p><h1 id="実行してみる"><a href="#実行してみる" class="headerlink" title="実行してみる"></a>実行してみる</h1><h4 id="iOS-1"><a href="#iOS-1" class="headerlink" title="iOS"></a>iOS</h4><p><a href="../../../../public/2016/05/i1.png"><img src="../../../../public/2016/05/i1-197x300.png" alt="起動直後"></a></p><p>起動直後</p><h4 id="Android-1"><a href="#Android-1" class="headerlink" title="Android"></a>Android</h4><p><a href="../../../../public/2016/05/a1.png"><img src="../../../../public/2016/05/a1-170x300.png" alt="起動直後"></a></p><p>起動直後</p><h4 id="UWP-1"><a href="#UWP-1" class="headerlink" title="UWP"></a>UWP</h4><p>[wc_row][wc_column size=”one-third” position=”first”] <a href="../../../../public/2016/05/w1.png"><img src="../../../../public/2016/05/w1-156x300.png" alt="起動直後"></a></p><p>起動直後</p><p>[/wc_column][wc_column size=”one-third”] <a href="../../../../public/2016/05/w2.png"><img src="../../../../public/2016/05/w2-156x300.png" alt="Callボタン押下後"></a></p><p>Callボタン押下後</p><p>[/wc_column][wc_column size=”one-third” position=”last”] <a href="../../../../public/2016/05/w3.png"><img src="../../../../public/2016/05/w3-156x300.png" alt="Call!!"></a></p><p>Call!!</p><p>[/wc_column][/wc_row]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>全ての機能をテストしたかったのですが、まさかAndroidまで動かないとは… やはり実機が必要ですね…でもiPhoneは実機へのデプロイはお金が必要ですし…わざわざAndroidを買うのも…</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable6">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable6</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その18 Xamarin.Forms.ThemesをPrism.Unity.Formsと併用する場合の注意</title>
      <link href="/2016/05/06/1338/"/>
      <url>/2016/05/06/1338/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-l1">前回</a>はNavigationPageとTabbedPageの組み合わせ問題を解決しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><h3 id="お詫び"><a href="#お詫び" class="headerlink" title="お詫び"></a>お詫び</h3><p>Xamarin.Formsヒトバシラー様より、UWPが動かない原因を指摘していただきました。 謹んで記事を訂正させていただきます。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://twitter.com/ticktackmobile" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=twitter.com"></img><div class="hbc-site-name">Twitter</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img></img></div><div class="hbc-text"><div class="hbc-title">undefined</div><div class="hbc-url">https://twitter.com/ticktackmobile</div></div></div></div></a></div></div><p>Evolve 2016でXamarin.FormsにTheme機能を追加することが発表されましたが、そのマイルストーン？として日本時間5/5の夜にXamarin.Forms.ThemesのNuGetパッケージが公開されました。 まだ、NuGetのページもありませんが、Nuget PackageManagerから入手可能です。 <strong>2016/05/06 1:57 訂正</strong> </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://www.nuget.org/packages/Xamarin.Forms.Theme.Base/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=www.nuget.org"></img><div class="hbc-site-name">www.nuget.org</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://api.nuget.org/v3-flatcontainer/xamarin.forms.theme.base/1.0.0.43-pre1/icon"></img></div><div class="hbc-text"><div class="hbc-title">Xamarin.Forms.Theme.Base 1.0.0.43-pre1</div><div class="hbc-url">https://www.nuget.org/packages/Xamarin.Forms.Theme.Base/</div><div class="hbc-description">Build native UIs for iOS, Android, and Windows Phone from a single, shared C# codebase</div></div></div></div></a></div></div><p>通常、サンプルプロジェクトを使えば簡単に適用できて、「すげーー」って言えるのですが、そこはXamarinというか、他のライブラリとの動作は未検証でした。 <strong>(ちなみに、サンプルで対象なのは、AndroidとiOSのみです。UWP、Windows 8.1、Windows Phone 8は影も形もありません)</strong> で、<strong>Prism.Unity.Forms</strong>のUnityBootstrapperクラスを使って構築した場合、気をつけないとThemeが適用されないどころか、<strong>起動すらしなくなります</strong>。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h4 id="NuGet"><a href="#NuGet" class="headerlink" title="NuGet"></a>NuGet</h4><p>まずは、普通にNuGetでXamarin.Forms.Themesをgetしましょう。現在ThemeはDarkとLightの2つです。 PCLへの適用です。プレリリースを対象にしてください。</p><p><a href="../../../../public/2016/05/1-6.png"><img src="../../../../public/2016/05/1-6-300x178.png" alt="NuGet"></a></p><p>NuGet</p><p>LightとDarkを両方追加する必要は無いです。お好みで。</p><h4 id="App-xaml"><a href="#App-xaml" class="headerlink" title="App.xaml"></a>App.xaml</h4><p>まず、プロジェクトにApp.xamlを追加します。 続いて下記のような記述をコピーします。 [code lang=”xaml”] <Application xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:light="clr-namespace:Xamarin.Forms.Themes;assembly=Xamarin.Forms.Theme.Light" xmlns:dark="clr-namespace:Xamarin.Forms.Themes;assembly=Xamarin.Forms.Theme.Dark" x:Class="ThemesDemo.App"> &lt;Application.Resources&gt; <!--<ResourceDictionary MergedWith="light:LightThemeResources" />--> <ResourceDictionary MergedWith="dark:DarkThemeResources" /> &lt;/Application.Resources&gt; </Application> [/code] 上記は、 </p><p>からの抜粋です。 注意するのは、<strong>x:Class</strong>の指定です。ここは、PCLのApp.csと同じになるよう修正してください。 Application.Resources内部は、NuGetで適用した、または使用した方を残してください。 補足ですが、App.xamlのカスタムツールとビルドアクションはそのままで結構です。 また、カスタムツールが<strong>MSBuild:UpdateDesignTimeXaml</strong>、ビルドアクションが<strong>埋め込みリソース</strong>です。 ビルドアクションがPageだと動きません、というかビルドが通りません。</p><h4 id="App-cs"><a href="#App-cs" class="headerlink" title="App.cs"></a>App.cs</h4><p>この時点で、App.xamlとApp.csが結びつきましたが、このままではビルドが通りません。 修正は簡単です。 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span><br></pre></td></tr></table></figure><p>partial属性を付与するだけです。 ちなみに、App.csをApp.xaml.csにする必要はないです。サンプルはそうですか不要です。</p><h4 id="おまじない"><a href="#おまじない" class="headerlink" title="おまじない"></a>おまじない</h4><p>公式ページにもありましたが、必要なアセンブリがロードされないことがあるようです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://developer.xamarin.com/guides/xamarin-forms/themes/#loadtheme" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=developer.xamarin.com"></img><div class="hbc-site-name">developer.xamarin.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">Theming a Xamarin.Forms Application - Xamarin</div><div class="hbc-url">https://developer.xamarin.com/guides/xamarin-forms/themes/#loadtheme</div><div class="hbc-description">Xamarin.Forms applications support theming by creating a ResourceDictionary for each theme, and then loading the resources with the DynamicR…</div></div></div></div></a></div></div><p>Android、iOSごとに対応があります。 必要に応じて適用をお願いします。</p><h4 id="App-cs-Prism-Forms-Unity使う人向け"><a href="#App-cs-Prism-Forms-Unity使う人向け" class="headerlink" title="App.cs (Prism.Forms.Unity使う人向け)"></a>App.cs (Prism.Forms.Unity使う人向け)</h4><p>この時点で、無事にThemeが適用されるはずですが、Prism.Unity.Forms使いはそうも行きません。 App.csにさらに修正が必要です。 通常、Appコンストラクタ内で、UnityBootstrapperの派生クラスのインスタンスの生成、およびRunメソッドのコールをしていますが、このままでは、Themeが適用されません。 だいたい、下記のような感じだと思います。 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bootstrapper = <span class="keyword">new</span> Bootstrapper();</span><br><span class="line">    bootstrapper.Run(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>これを、 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">App</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bootstrapper = <span class="keyword">new</span> Bootstrapper();</span><br><span class="line">    bootstrapper.Run(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.InitializeComponent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>に修正してください。 InitializeComponentが先に来ると、フリーズします。具体的には、CreateMainPageメソッドでMainPageのResolveで止まります。 このあたり、ひょっとしたら今後の更新で対応されるかもしれませんが、今はこれで動くはずです。</p><h1 id="実行してみる"><a href="#実行してみる" class="headerlink" title="実行してみる"></a>実行してみる</h1><h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p><a href="../../../../public/2016/05/2-5.png"><img src="../../../../public/2016/05/2-5-195x300.png" alt="サンプル"></a></p><p>サンプル</p><p>一部Themeが適用されていないような気がしますが、別途修正が必要？</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p><a href="../../../../public/2016/05/3-3.png"><img src="../../../../public/2016/05/3-3-165x300.png" alt="サンプル"></a></p><p>サンプル</p><h4 id="UWP"><a href="#UWP" class="headerlink" title="UWP"></a>UWP</h4><p>Prism.Unity.Forms環境下では実行できませんでした。というか動かなくなります。もっと検証が必要かも。 簡単なサンプルを作って、UWPを動かしましたがダメです。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Xamarin.Forms.Xaml.XamlParseException: Position 19:16. No Property of name StyleClass found</span><br><span class="line">   at Xamarin.Forms.Xaml.ApplyPropertiesVisitor.SetPropertyValue(Object xamlelement, XmlName propertyName, Object value, BindableObject rootElement, INode node, HydratationContext context, IXmlLineInfo lineInfo)</span><br><span class="line">   at Xamarin.Forms.Xaml.ApplyPropertiesVisitor.Visit(ValueNode node, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.ValueNode.Accept(IXamlNodeVisitor visitor, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.Eleme</span><br><span class="line">   at Xamarin.Forms.Xaml.ApplyPropertiesVisitor.SetPropertyValue(Object xamlelement, XmlName propertyName, Object value, BindableObject rootElement, INode node, HydratationContext context, IXmlLineInfo lineInfo)</span><br><span class="line">   at Xamarin.Forms.Xaml.ApplyPropertiesVisitor.Visit(ValueNode node, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.ValueNode.Accept(IXamlNodeVisitor visitor, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.ElementNode.Accept(IXamlNodeVisitor visitor, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.ElementNode.Accept(IXamlNodeVisitor visitor, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.ElementNode.Accept(IXamlNodeVisitor visitor, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.RootNode.Accept(IXamlNodeVisitor visitor, INode parentNode)</span><br><span class="line">   at Xamarin.Forms.Xaml.XamlLoader.Load(BindableObject view, String xaml)</span><br><span class="line">   at Xamarin.Forms.Xaml.XamlLoader.Load(BindableObject view, Type callingType)</span><br><span class="line">   at Xamarin.Forms.Xaml.Extensions.LoadFromXaml[TView](TView view, Type callingType)</span><br><span class="line">   at XFApp1.BasicPage.InitializeComponent()</span><br><span class="line">   at XFApp1.BasicPage..ctor()</span><br><span class="line">   at XFApp1.App..ctor()</span><br><span class="line">   at XFApp1.UWP.MainPage..ctor()</span><br><span class="line">   at XFApp1.UWP.XFApp1_UWP_XamlTypeInfo.XamlTypeInfoProvider.Activate_4_MainPage()</span><br><span class="line">   at XFApp1.UWP.XFApp1_UWP_XamlTypeInfo.XamlUserType.ActivateInstance()</span><br></pre></td></tr></table></figure><p>こんな感じのメッセージとスタックトレースを吐いて落ちます。 StyleClassが無い、という例外です。PCLに存在していても、実行するプラットフォームに突入した時点で存在しない？ 哀れUWP…. なので、簡単なサンプルを作りました。 UWPプロジェクトは以下のApp.xaml内部のRequestedThemeを削除して、Xamarin.Forms.Theme.Lightを適用した結果がこちら。</p><p><a href="../../../../public/2016/05/w1-3.png"><img src="../../../../public/2016/05/w1-3-180x300.png" alt="サンプル"></a></p><p>サンプル</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>早速、レビューしましたが、プレリリースだけあって、不安定極まりないです。 UWPが見捨てられたのは、どういうわけなのか….時間が無かっただけ、と思いたい。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その17 TabbedPageとNavigationPageの組み合わせ</title>
      <link href="/2016/05/05/1303/"/>
      <url>/2016/05/05/1303/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-jP">前回</a>はAndroidのUnzipped Failedを解決しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>以前、TabbedPageについて記事を書きましたが、もう一つ重要なNavigationPageを組み合わせて見ます。 ただ、NavigationPageとTabbedPageを組み合わす際、NavigationPageの子要素として、TabbedPageを加えるのはよくないとのこと。 三日月 ふゆの氏の記事。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://mikazuki.hatenablog.jp/entry/2015/11/10/012403" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=mikazuki.hatenablog.jp"></img><div class="hbc-site-name">みかづきメモ</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://ogimage.blog.st-hatena.com/8454420450093774953/6653458415127539795/1447147507"></img></div><div class="hbc-text"><div class="hbc-title">Xamarin.Forms で TabbedPage の子に NavigationPage を追加してみる - みかづきメモ</div><div class="hbc-url">http://mikazuki.hatenablog.jp/entry/2015/11/10/012403</div><div class="hbc-description">Xamarin.Forms(XAML) を使って、 NavigationPage + TabbedPage を作ってみます。 Twitter for iPhone や TweetBot みたいな感じの UI ですね。 ただ、 NavigationPage |- TabbedPag…</div></div></div></div></a></div></div> 元ネタ。 <p>これを踏まえ、TabbedPageの下に、NavigationPage、NavigationPageの下に2つのContentPageというシンプルな実装を試しました。 ContentPageの最初でNextボタンがあり、それを押下すると、次のページにNavigationされる、というものです。 また、それぞれのPageにViewModelが紐付きます。つまり、4つのViewと4つのViewModelです。 そこまで大それたものではないはずです。 その実現のために、Webの各所を見ていきました。 下記は主に参考にさせていただいた記事です。 かずき氏の記事。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://blog.okazuki.jp/entry/2016/04/24/094141" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=blog.okazuki.jp"></img><div class="hbc-site-name">かずきのBlog@hatena</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/o/okazuki/20160423/20160423193303.png"></img></div><div class="hbc-text"><div class="hbc-title">Xamarin.Forms + Prism.Formsで画面遷移DeepDive - かずきのBlog@hatena</div><div class="hbc-url">http://blog.okazuki.jp/entry/2016/04/24/094141</div><div class="hbc-description">Prism.Formsは、地味にネストした画面遷移みたいなのをサポートしています。 画面遷移のINavigationService#Navigateメソッドに渡すURLに&quot;/HogePage/FugaPage/BarPage?id=10&quot;みたいに/で区切ってページ指定が出来ます。…</div></div></div></div></a></div></div> Prismの開発者の一人Brian Lagunas氏の記事。 <div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="http://brianlagunas.com/prism-for-xamarin-forms-6-2-0-preview/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=brianlagunas.com"></img><div class="hbc-site-name">Brian Lagunas</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://brianlagunas.com/wp-content/uploads/2015/12/Prism-Logo-Graphic.jpg"></img></div><div class="hbc-text"><div class="hbc-title">Prism for Xamarin.Forms 6.2.0 Preview - Brian Lagunas</div><div class="hbc-url">http://brianlagunas.com/prism-for-xamarin-forms-6-2-0-preview/</div><div class="hbc-description">Learn what&#39;s new in Prism for Xamarin.Forms 6.2.0 Preview. Check out the all new navigation service features such as URI support and deep li…</div></div></div></div></a></div></div><p>で、いろいろ試行錯誤しましたが、実現できませんでした。 ページが遷移しない、クラッシュする、タブが出ないetcです。</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>逃げ口上ではないですが、注意事項です。</p><p><strong>Prism.Forms 6.1.0-pre4</strong></p><p><strong>Prism.Unity.Forms 6.2.0-pre4</strong></p><p><strong>Xamarin.Forms 2.2.0.31</strong></p><p>の環境の話です。 特に、Prism.Forms、Prism.Unity.Formsはプリリリース版なので、正式版では私が遭遇した問題は治っている可能性があります。 多分私の手法は間違っているだろうし、MVVMの観点からもよくないような気がします。 正しいやり方があると思いますが、動く方法が見つかったので、私は良しとしました。 動かないプロダクトよりも動くプロダクトのが何百倍も価値があります。</p><h3 id="UnityApplicationは使わない"><a href="#UnityApplicationは使わない" class="headerlink" title="UnityApplicationは使わない"></a>UnityApplicationは使わない</h3><p>まず、<strong>Prism.Unity.UnityApplication</strong>を継承して、Appを実装しますが、この方法は使いません。 なぜかというと、<strong>OnInitialized</strong>をオーバーライドし、NavigationSerice.Navigateメソッドで一番最初に表示するページを指示するのですが、TabbedPageを指示するとクラッシュします。ContentPageである、NavigationPageの子要素ならOKですが、そうすると、TabbedPageとNavigationPageが見えなくなります。 ですので、Obsoleteではありますが、<strong>Prism.Unity.UnityBootstrapper</strong>を継承したクラスを作成し、そのクラスのRunメソッドにAppクラスのインスタンスを渡す方法をとります。 これならば、<strong>CreateMainPage</strong>をオーバーライドする際に、TabbedPageを指定することができます。</p><h3 id="NavigationServiceは使わない"><a href="#NavigationServiceは使わない" class="headerlink" title="NavigationServiceは使わない"></a>NavigationServiceは使わない</h3><p>NavigationServiceのインスタンスには、明示的に指定しない限り、<strong>Prism.Unity.Navigation.UnityPageNavigationService</strong>が使われますが、無視します。 このクラスを使えば、本来はNavigationする際の、履歴を管理して、Backしたりできるはずなのですが、私にはどうやってもそれができませんでした。 ソースを見ると、UnityPageNavigationServiceのコンストラクタに、UnityContainerを渡しているのですが、途中でページの履歴の基準がMainPageになってしまっており、これによりNavigationがうまくいかなくなっているように見えます。ページは遷移するのですが、左上に本来は表示されるであろう直前のページへの遷移ボタンが表示されません。 以上を踏まえ今回のソースです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable8" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable8</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h3 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h3><p>まず、ViewModelはすべて引数をとりません。またViewModelとViewの紐付けは<strong>ViewModelLocator.AutowireViewModel</strong>で実現しています。 TabbedPageとNavigationViewに対応するViewModelは空なので無視します。 <strong>FirstPageViewModel.cs</strong> [code lang=”csharp”] using Prism.Commands; using Prism.Common; using Prism.Mvvm; using Xamarin.Forms.Portable8.Views;<br>namespace Xamarin.Forms.Portable8.ViewModels { public sealed class FirstPageViewModel : BindableBase, IPageAware {<br>public Page Page { get; set; }<br>private DelegateCommand _NextCommand; public DelegateCommand NextCommand { get { if (this._NextCommand == null) { this._NextCommand = new DelegateCommand(() =&gt; { this.Page.Navigation.PushAsync(new NextPage()); }); }<br>return this._NextCommand; } } } } [/code] <strong>NextPageViewModel.cs</strong> [code lang=”csharp”] using Prism.Commands; using Prism.Common; using Prism.Mvvm;<br>namespace Xamarin.Forms.Portable8.ViewModels { public sealed class NextPageViewModel : BindableBase, IPageAware { public Page Page { get; set; }<br>private DelegateCommand _BackCommand; public DelegateCommand BackCommand { get { if (this._BackCommand == null) { this._BackCommand = new DelegateCommand(() =&gt; { this.Page.Navigation.PopAsync(); }); }<br>return this._BackCommand; } }<br>} } [/code] ポイントは<strong>Prism.Common.IPageAware</strong>の実装です。単純にPageプロパティを持つだけですが。 これによって、PageのNavigationプロパティにViewModelからアクセスできるようになり、PopAsyncとPushAsyncを呼び出せるようになります。 これでページの遷移が可能になります。</p><h3 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h3><p>正直、BindingContextを見て、挙動を変える方法はあまり好きではないですし、コードビハインドをいじるのも嫌なんですが… <strong>FirstPage.xaml.cs</strong> [code lang=”csharp”] using Prism.Common;<br>namespace Xamarin.Forms.Portable8.Views { public partial class FirstPage : ContentPage { public FirstPage() { // BindingContext is updated before InitializeComponent this.BindingContextChanged += (sender, args) =&gt; { var pageAware = this.BindingContext as IPageAware; if (pageAware != null) { pageAware.Page = this; } };<br>InitializeComponent(); } } } [/code] NextPage.xaml.csも同じような感じです。 BindingContextChangeをサブスクライブして、BindingContextがIPageAwareを実装していたら、Pageプロパティに自分自身を設定します。 コメントにもありますが、なぜかInitializeComponentより前で、BindingContextが設定されていたので、苦肉の策でInitializeComponentの前でサブスクライブしてます。 Xamlですが、Main、つまりアプリ全体を表現する要のXamlだけ記載しておきます。他は単純なので… <strong>MainPage.xaml</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <TabbedPage x:Class="Xamarin.Forms.Portable8.Views.MainPage" xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:mvvm="clr-namespace:Prism.Mvvm;assembly=Prism.Forms" xmlns:views="clr-namespace:Xamarin.Forms.Portable8.Views;assembly=Xamarin.Forms.Portable8" mvvm:ViewModelLocator.AutowireViewModel="True"><br>&lt;TabbedPage.Padding&gt; <OnPlatform x:TypeArguments="Thickness" Android="0" WinPhone="0" iOS="0, 20, 0, 0" /> &lt;/TabbedPage.Padding&gt;<br>&lt;TabbedPage.Children&gt; &lt;views:NavigationPage Title=”Tab1”&gt; &lt;x:Arguments&gt; &lt;views:FirstPage /&gt; </x:Arguments> </views:NavigationPage> &lt;views:NavigationPage Title=”Tab2”&gt; &lt;x:Arguments&gt; &lt;views:FirstPage /&gt; </x:Arguments> </views:NavigationPage> &lt;views:NavigationPage Title=”Tab3”&gt; &lt;x:Arguments&gt; &lt;views:FirstPage /&gt; </x:Arguments> </views:NavigationPage> &lt;/TabbedPage.Children&gt; </TabbedPage> [/code]</p><h3 id="Startup"><a href="#Startup" class="headerlink" title="Startup"></a>Startup</h3><p>最後に、スタートアップ周りのコードです。 冒頭のObsolete等はここです。 <strong>App.cs</strong> [code lang=”csharp”] namespace Xamarin.Forms.Portable8 { public class App : Application { public App() { var bootstrapper = new Bootstrapper(); bootstrapper.Run(this); }<br>protected override void OnStart() { // Handle when your app starts }<br>protected override void OnSleep() { // Handle when your app sleeps }<br>protected override void OnResume() { // Handle when your app resumes } } } [/code] <strong>Bootstrapper.cs</strong> [code lang=”csharp”] using System; using Microsoft.Practices.Unity; using Prism.Unity; using Xamarin.Forms.Portable8.ViewModels; using Xamarin.Forms.Portable8.Views;<br>namespace Xamarin.Forms.Portable8 { public sealed class Bootstrapper : UnityBootstrapper { [Obsolete] protected override Xamarin.Forms.Page CreateMainPage() { return this.Container.Resolve(); }<br>protected override void RegisterTypes() { // ViewModels this.Container.RegisterType(); this.Container.RegisterType(); this.Container.RegisterType(); this.Container.RegisterType();<br>// Views // Maybe, the following codes are meaningless because NavigationSerivce is not used. //this.Container.RegisterType(); //this.Container.RegisterType(); //this.Container.RegisterType(); //this.Container.RegisterType();<br>//this.Container.RegisterTypeForNavigation(); //this.Container.RegisterTypeForNavigation(); //this.Container.RegisterTypeForNavigation(); }<br>protected override void OnInitialized() { // I guess it is meaningless. //this.NavigationService.Navigate(“/NavigationPage/MainPage”); } } } [/code] コメントアウトした箇所は実行に影響がないので削除しました。</p><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><p>動かしてみました。</p><h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p>[wc_row][wc_column size=”one-third” position=”first”] <a href="../../../../public/2016/05/i1-3.png"><img src="../../../../public/2016/05/i1-3-197x300.png" alt="Tab1のFirst page"></a></p><p>Tab1のFirst page</p><p>[/wc_column][wc_column size=”one-third”]<br><a href="../../../../public/2016/05/i2-2.png"><img src="../../../../public/2016/05/i2-2-197x300.png"></a></p><p>Tab1のNext page</p><p>[/wc_column][wc_column size=”one-third” position=”last”]<br><a href="../../../../public/2016/05/i3-1.png"><img src="../../../../public/2016/05/i3-1-197x300.png"></a></p><p>Tab2のFirst page</p><p>[/wc_column][/wc_row]</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p>[wc_row][wc_column size=”one-third” position=”first”] <a href="../../../../public/2016/05/3127e02ff1511185286456bc80f806f4.png"><img src="../../../../public/2016/05/3127e02ff1511185286456bc80f806f4-168x300.png" alt="Tab1のFirst page"></a></p><p>Tab1のFirst page</p><p>[/wc_column][wc_column size=”one-third”] <a href="../../../../public/2016/05/35a40365117b2d31c2681e1878827c73.png"><img src="../../../../public/2016/05/35a40365117b2d31c2681e1878827c73-168x300.png" alt="Tab1のNext page"></a></p><p>Tab1のNext page</p><p>[/wc_column][wc_column size=”one-third” position=”last”] <a href="../../../../public/2016/05/2e052e332b7c66d373ed4a52f1bee2b7.png"><img src="../../../../public/2016/05/2e052e332b7c66d373ed4a52f1bee2b7-168x300.png" alt="Tab2のFirst page"></a></p><p>Tab2のFirst page</p><p>[/wc_column][/wc_row]</p><h4 id="UWP"><a href="#UWP" class="headerlink" title="UWP"></a>UWP</h4><p>[wc_row][wc_column size=”one-third” position=”first”]<br><a href="../../../../public/2016/05/w1-2.png"><img src="../../../../public/2016/05/w1-2-157x300.png"></a></p><p>Tab1のFirst page</p><p>[/wc_column][wc_column size=”one-third”] <a href="../../../../public/2016/05/w2-2.png"><img src="../../../../public/2016/05/w2-2-157x300.png" alt="Tab1のNext page"></a></p><p>Tab1のNext page</p><p>[/wc_column][wc_column size=”one-third” position=”last”] <a href="../../../../public/2016/05/w3-1.png"><img src="../../../../public/2016/05/w3-1-157x300.png" alt="Tab2のFirst page"></a></p><p>Tab2のFirst page</p><p>[/wc_column][/wc_row] きちんとタブごとに遷移している状態を覚えています。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>かなり苦労しましたが、やりきった感じでいっぱいです。 間違っているようなやり方ですが、動けばいい、という方はいると思うので、だれかの役に立つでしょう。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable8">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable8</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その16 Unzipping failed</title>
      <link href="/2016/05/05/1229/"/>
      <url>/2016/05/05/1229/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-jG">前回</a>はUWPでビルドができない問題を解決しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Xamarinの不安定さは何度も言及していますが、こうも問題に何度も遭遇すると悲しくなります。 今回は、Androidのビルドが通らなくなりました。直前の手順もうろ覚えなのですが… <a href="../../../../public/2016/05/1-4.png"><img src="../../../../public/2016/05/1-4-1024x437.png" alt="Unzipped failed"></a></p><p>Unzipped failed?</p><p>エラーは、 <code>Unzipping failed. Please download https://dl-ssl.google.com/android/repository/android_m2repository_r22.zip and extract it to the C:\Users\XXXXXX\AppData\Local\Xamarin\Android.Support.v4\23.0.1.3\content directory.</code> 訳:zipの回答に失敗しました。<a href="https://dl-ssl.google.com/android/repository/android/_m2repository/_r22.zip%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%80%81%E3%81%9D%E3%82%8C%E3%82%92C://Users//XXXXXX//AppData//Local//Xamarin//Android.Support.v4//23.0.1.3//content%E3%81%AB%E5%B1%95%E9%96%8B%E3%81%97%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84%E3%80%82">https://dl-ssl.google.com/android/repository/android\_m2repository\_r22.zipをダウンロードし、それをC:\\Users\\XXXXXX\\AppData\\Local\\Xamarin\\Android.Support.v4\\23.0.1.3\\contentに展開してください。</a></p><p>とあります。 たしかに、そのフォルダにcontentフォルダはありませんでした。 <a href="../../../../public/2016/05/2-3.png"><img src="../../../../public/2016/05/2-3-1024x190.png" alt="からっぽ"></a></p><p>からっぽ</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>指示に従うと、落としてきた<strong>android_m2repository_r22.zip</strong>は135MBもあります。 これが4G回線とかで作業中に発生したらと思うのちょっとゾッとします。 続いて、これを解凍します。 解凍すると、<strong>m2repository</strong>というフォルダが出てくるので、これを先ほどの指示に従い、contentフォルダを作成し、その下にm2repositoryフォルダをコピーします。 結果としては、</p><p>C:\Users\XXXXXX\AppData\Local\Xamarin\Android.Support.Design</p><p>C:\Users\XXXXXX\AppData\Local\Xamarin\Android.Support.v4</p><p>C:\Users\XXXXXX\AppData\Local\Xamarin\Android.Support.v7.AppCompat</p><p>C:\Users\XXXXXX\AppData\Local\Xamarin\Android.Support.v7.CardView</p><p>C:\Users\XXXXXX\AppData\Local\Xamarin\Android.Support.v7.MediaRouter</p><p>C:\Users\XXXXXX\AppData\Local\Xamarin\Android.Support.v7.RecyclerView</p><p>の6カ所に同じような処置を実行しました。 これによりビルドが通るようになりました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>英語はきちんと読みましょう、ということですね。 別に英語読むのは苦ではないですが、どうしても日本語と比べると時間あたりで理解する文字数が減るので面倒に感じるんですよね…</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その15 UWPがビルドできないのを修正する</title>
      <link href="/2016/05/04/1220/"/>
      <url>/2016/05/04/1220/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-kx">前回</a>はWCFの簡単なサンプルをテストしました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>UWPをビルドしようとしても、何故かビルドエラーが出ます。 どうも、クラス名が衝突しており、意図したクラスが使われないことが原因のようです。<br><a href="../../../../public/2016/05/1-3.png"><img src="../../../../public/2016/05/1-3-1024x279.png"></a></p><p>エラーの山</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>解決方法はシンプル。 下記は修正前の<strong>App.xaml.cs</strong>です。 [code lang=”csharp”] using System; using System.Collections.Generic; using System.IO; using System.Linq; using System.Runtime.InteropServices.WindowsRuntime; using Windows.ApplicationModel; using Windows.ApplicationModel.Activation; using Windows.Foundation; using Windows.Foundation.Collections; using Windows.UI.Xaml; using Windows.UI.Xaml.Controls; using Windows.UI.Xaml.Controls.Primitives; using Windows.UI.Xaml.Data; using Windows.UI.Xaml.Input; using Windows.UI.Xaml.Media; using Windows.UI.Xaml.Navigation;<br>namespace Xamarin.Forms.Portable5.UWP { /// <summary> /// Provides application-specific behavior to supplement the default Application class. /// </summary> sealed partial class App : Application { /// <summary> /// Initializes the singleton application object. This is the first line of authored code /// executed, and as such is the logical equivalent of main() or WinMain(). /// </summary> public App() { this.InitializeComponent(); this.Suspending += OnSuspending; }<br>/// <summary> /// Invoked when the application is launched normally by the end user. Other entry points /// will be used such as when the application is launched to open a specific file. /// </summary> /// <param name="e">Details about the launch request and process.</param> protected override void OnLaunched(LaunchActivatedEventArgs e) {<br>#if DEBUG if (System.Diagnostics.Debugger.IsAttached) { this.DebugSettings.EnableFrameRateCounter = true; } #endif<br>Frame rootFrame = Window.Current.Content as Frame;<br>// Do not repeat app initialization when the Window already has content, // just ensure that the window is active if (rootFrame == null) { // Create a Frame to act as the navigation context and navigate to the first page rootFrame = new Frame();<br>rootFrame.NavigationFailed += OnNavigationFailed;<br>Xamarin.Forms.Forms.Init(e); [/code] これを下記のように修正します。 [code lang=”csharp”] sealed partial class App : Windows.UI.Xaml.Application { [/code] [code lang=”csharp”] #if DEBUG if (System.Diagnostics.Debugger.IsAttached) { this.DebugSettings.EnableFrameRateCounter = true; } #endif<br>Windows.UI.Xaml.Controls.Frame rootFrame = Window.Current.Content as Windows.UI.Xaml.Controls.Frame; [/code] [code lang=”csharp”] if (rootFrame == null) { // Create a Frame to act as the navigation context and navigate to the first page rootFrame = new Windows.UI.Xaml.Controls.Frame(); [/code] <strong>Windows.UI.Xaml.Application</strong>を<strong>Xamarin.Forms.Application</strong>、<strong>Windows.UI.Xaml.Controls.Frame</strong>を<strong>Xamarin.Forms.Frame</strong>と判断しているのが原因でした。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Windows7、Windows10と2つの環境で発生しています。私だけの環境だとは思えないのですが…</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その14 WCFサービスの実行</title>
      <link href="/2016/05/03/1273/"/>
      <url>/2016/05/03/1273/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-iZ">前回</a>はXamarin Android Playerをインストールしました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>モバイルであっても、利用する場所が野外であるとは限らなくて、社内や自宅などのLANであることも多々あります。 そのような、利用者が不特定多数ではない、利用者数が予測しやすい規模のWebサービスの場合、大規模なサーバーどころか、小さなクライアントサーバー型アプリでサーバー側を非サーバーOS上に構築したサーバーアプリで賄うこともあるでしょう。 そういうシチュエーションならWCFは簡単に構築できますし、うってつけです。 でも、XamarinでWCFがどうするのでしょうか？特にPCLの制約などで面倒な感じがします。 そのあたりのことが下記のドキュメントにまとめられています。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://developer.xamarin.com/guides/cross-platform/application_fundamentals/web_services/walkthrough_working_with_WCF/" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=developer.xamarin.com"></img><div class="hbc-site-name">developer.xamarin.com</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png"></img></div><div class="hbc-text"><div class="hbc-title">Consume a Windows Communication Foundation (WCF) Web Service - Xamarin</div><div class="hbc-url">https://developer.xamarin.com/guides/cross-platform/application_fundamentals/web_services/walkthrough_working_with_WCF/</div><div class="hbc-description">This article demonstrates how to consume an WCF Simple Object Access Protocol (SOAP) service from a Xamarin.Forms application.</div></div></div></div></a></div></div><p>しかし、この記事は、PCLは使っておらず、iOS、Androidのプロジェクトに対してWCFのクライアントを追加しています。 これではコードの共通化の意味がありません。 なので、これを解決します。 今回のソースです。 </p><div class="blog-card"><div class="hbc-link-wrap"><a class="hbc-link" href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable7" target="_blank" rel="nofollow"><div class="hbc-card"><div class="hbc-info"><img class="hbc-favicon" src="http://www.google.com/s2/favicons?domain=github.com"></img><div class="hbc-site-name">GitHub</div></div><div class="hbc-contents"><div class="hbc-thumbnail"><img src="https://avatars0.githubusercontent.com/u/6241854?s=400&v=4"></img></div><div class="hbc-text"><div class="hbc-title">takuya-takeuchi/Demo</div><div class="hbc-url">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable7</div><div class="hbc-description">Sample source code for Demonstration, Experiment and Test - takuya-takeuchi/Demo</div></div></div></div></a></div></div><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><h4 id="下準備"><a href="#下準備" class="headerlink" title="下準備"></a>下準備</h4><p>まず、いつものように、XamarinのBlankアプリをPCLで作成します。 その後、<strong>Windows 8.1</strong>、<strong>Windows Phone 8.1</strong>向けのプロジェクトを除去します。 今回、PCLにWCFクライアントを実装する場合、Windows Phone 8.1は使えません。 次に、<strong>ソリューションのNugetパッケージの管理</strong>を開き、<strong>Xamarin.Formsを全てのプロジェクトからアンインストール</strong>します。 <a href="../../../../public/2016/05/1-5.png"><img src="../../../../public/2016/05/1-5-300x156.png" alt="Xamarin.Formsのアンインストール"></a></p><p>Xamarin.Formsのアンインストール</p><p>場合によっては、再起動を求められますので、ここで再起動します。 続いて、PCLのプロジェクトのプロパティから、ライブラリのタブのターゲットを設定する個所から<strong>変更ボタン</strong>を押下します。 <a href="../../../../public/2016/05/2-4.png"><img src="../../../../public/2016/05/2-4-300x208.png" alt="ターゲットの変更"></a></p><p>ターゲットの変更</p><p>そして、<strong>ターゲットの変更ダイアログ</strong>からWindows Phone 8.1のチェックを外します。 <a href="../../../../public/2016/05/3-2.png"><img src="../../../../public/2016/05/3-2-300x295.png" alt="Windows Phone 8.1は外す"></a></p><p>Windows Phone 8.1は外す</p><p>Windows 8をWindows 10にしても変更できないのでそのままでOKです。 最後に、再び<strong>ソリューションのNugetパッケージの管理</strong>を開き、<strong>Xamarin.Formsを全てのプロジェクトにインストール</strong>します。 場合によっては、また再起動を求められますので、ここで再起動します。</p><h4 id="WCFサービスの追加"><a href="#WCFサービスの追加" class="headerlink" title="WCFサービスの追加"></a>WCFサービスの追加</h4><p>特にWCFサービスの制限はないです。 ここでは、Xamarin.WcfというWPFプロジェクトを追加します。 また、WCFとDataContractを使用するために、<strong>System.Runtime.Serialization</strong>と<strong>System.ServiceModel</strong>を参照に追加します。 さらに、MVVMのために、Nugetで<strong>Prism.Wpf</strong>、<strong>Prism.Mvvm</strong>、<strong>Prism.Unity</strong>を追加しています。 下記に、サービスの定義とconfigを記載します。 <strong>MessageService.cs</strong> [code lang=”csharp”] using System; using System.Runtime.Serialization; using System.ServiceModel;<br>namespace Xamarin.Wcf.Services {<br>[System.ServiceModel.ServiceContract] public interface IMessageService {<br>event EventHandler ReceivedImage;<br>[System.ServiceModel.OperationContract] void SendCameraUmage(MessageDto message);<br>}<br>[ServiceBehavior(InstanceContextMode = InstanceContextMode.Single)] public sealed class MessageService : IMessageService {<br>public event EventHandler ReceivedImage;<br>public void SendCameraUmage(MessageDto message) { this.ReceivedImage?.Invoke(this, message); }<br>}<br>[DataContract(Name = “messageDto”)] public sealed class MessageDto {<br>public MessageDto(string sender, string message) { this.Sender = sender; this.Message = message; }<br>[DataMember(Name = “sender”)] public string Sender { get; set; }<br>[DataMember(Name = “message”)] public string Message { get; set; } }<br>} [/code] <strong>App.config</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <configuration> <startup> <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.6" /> </startup> &lt;system.serviceModel&gt; <client /> <behaviors> <serviceBehaviors> <behavior name="BasicConfiguration"> <serviceMetadata httpGetEnabled="true" httpGetUrl="http://localhost:8080/Xamarin.Wcf/MessageService/mex" /> </behavior> </serviceBehaviors> </behaviors> <bindings> <basicHttpBinding> <binding name="BasicHttpBinding" /> </basicHttpBinding> </bindings> <services> <service behaviorConfiguration="BasicConfiguration" name="Xamarin.Wcf.Services.MessageService"> <endpoint address="http://localhost:8080/CameraViewer/MessageService" binding="basicHttpBinding" bindingConfiguration="BasicHttpBinding" contract="Xamarin.Wcf.Services.IMessageService" /> </service> </services> &lt;/system.serviceModel&gt; </configuration> [/code] 他にViewを定義していますが、ここでは重要ではないので無視します。詳しくはソースを参照してください。</p><h4 id="WCFサービスのProxyクラスの生成"><a href="#WCFサービスのProxyクラスの生成" class="headerlink" title="WCFサービスのProxyクラスの生成"></a>WCFサービスのProxyクラスの生成</h4><p>前項で作成したWCFサービスを実行します。実行する際、管理者権限で実行しないと例外を投げて落ちます。 無事に実行し、Webブラウザから <strong><a href="http://localhost:8080/Xamarin.Wcf/MessageService/mex">http://localhost:8080/Xamarin.Wcf/MessageService/mex</a></strong> にアクセスします。 無事にアクセスできれば、下記のようにwsdlの定義が表示されるはずです。 <a href="../../../../public/2016/05/4-2.png"><img src="../../../../public/2016/05/4-2-300x187.png" alt="WSDLの公開"></a></p><p>WSDLの公開</p><p>表示を確認後、コマンドプロンプトを起動します。 カレントディレクトリはどこでも良いですが、ファイルが2つ出力されるので、わかりやすい場所に移動してください。 移動後、下記のコマンドを実行します。 <code>&quot;C:\Program Files (x86)\Microsoft SDKs\Silverlight\v5.0\Tools\SlSvcUtil.exe&quot; http://localhost:8080/Xamarin.Wcf/MessageService/mex</code> 実行が成功すれば、カレントディレクトリに<strong>MessageService.cs</strong>と<strong>ServiceReferences.ClientConfig</strong>が出力されます。 生成後、csファイルをPCLプロジェクトに追加します。ClientConfigは無くてもよいです。 ここで注意ですが、生成する際に使用するプログラムは、<strong>SvcUtil.exe</strong>ではなく、<strong>SlSvcUtil.exe</strong>を使ってください。 SvcUtil.exeでも生成には成功しますが、生成されるクラス群に<strong>System.Runtime.Serialization.IExtensibleDataObject</strong>等が使用されますが、このクラスは、PCLでWindows Phone 8.1が含まれていると使用できません。 そのため、最初の下準備でWindows Phone 8.1を除外したわけです。</p><h4 id="Service-Clientを呼び出す"><a href="#Service-Clientを呼び出す" class="headerlink" title="Service Clientを呼び出す"></a>Service Clientを呼び出す</h4><p>残念ながら、configファイルを配置して、自動的にBindingを行うようなことはできません。 ですので、コードからBindingを行います。 下記はService Client生成処理の抜粋ですが、意図はつかめると思います。 [code lang=”csharp”] private void UpdateServiceClient() { if (this._MessageServiceClient != null) { return; }<br>var binding = new BasicHttpBinding() { Name = “basicHttpBinding”, MaxReceivedMessageSize = 67108864, };<br>var timeout = new TimeSpan(0, 1, 0); binding.SendTimeout = timeout; binding.OpenTimeout = timeout; binding.ReceiveTimeout = timeout; this._MessageServiceClient = new MessageServiceClient( binding, new EndpointAddress($”http://{this.IpAddress}:8080/Xamarin.Wcf/MessageService”)); } [/code] IPAddressだけは、外部から設定できるようにしてあります。 これによって、各端末で設定として保存した値をもとにクライアントを構築できます。 応用すれば、ポート番号、タイムアウト値等も可変にできます。 最後に、WCFの呼び出し処理の抜粋です。 [code lang=”csharp”] public ICommand SendCommand { get { if (this._SendCommand == null) { this._SendCommand = new DelegateCommand( () =&gt; { this.UpdateServiceClient();<br>var message = new messageDto(); message.message = this._Message; message.sender = ServiceManager.Sender; this._MessageServiceClient.SendMessageAsync(message); }, () =&gt; { return !string.IsNullOrWhiteSpace(this.IpAddress); }); }<br>return this._SendCommand; } } [/code] 非常にシンプルです。 ServiceManager.Senderは各プロジェクトのスタートアップコードでiOS、Android、UWPという文字列を設定して、それを参照しているだけです。 つまり、どの端末からメッセージが飛んできたのかを判断するためだけの識別です。</p><h4 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h4><p>では、実際にテストしてみましょう。 注意ですが、WCFサービスアプリを起動する端末のポート8080は解放しておいてください。面倒ならファイアーウォールを一時的に無効にしてもよいです。</p><h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p>[wc_row][wc_column size=”one-half” position=”first”] <a href="../../../../public/2016/05/i1-1.png"><img src="../../../../public/2016/05/i1-1-199x300.png" alt="メッセージ送信"></a></p><p>メッセージ送信</p><p>[/wc_column][wc_column size=”one-half” position=”last”] <a href="../../../../public/2016/05/i2.png"><img src="../../../../public/2016/05/i2-300x200.png" alt="メッセージ受信"></a></p><p>メッセージ受信</p><p>[/wc_column][/wc_row]</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p>[wc_row][wc_column size=”one-half” position=”first”] <a href="../../../../public/2016/05/a1-1.png"><img src="../../../../public/2016/05/a1-1-168x300.png" alt="メッセージ送信"></a></p><p>メッセージ送信</p><p>[/wc_column][wc_column size=”one-half” position=”last”] <a href="../../../../public/2016/05/a2.png"><img src="../../../../public/2016/05/a2-300x200.png" alt="メッセージ受信"></a></p><p>メッセージ受信</p><p>[/wc_column][/wc_row]</p><h4 id="UWP"><a href="#UWP" class="headerlink" title="UWP"></a>UWP</h4><p>[wc_row][wc_column size=”one-half” position=”first”] <a href="../../../../public/2016/05/w1-1.png"><img src="../../../../public/2016/05/w1-1-184x300.png" alt="メッセージ送信"></a></p><p>メッセージ送信</p><p>[/wc_column][wc_column size=”one-half” position=”last”] <a href="../../../../public/2016/05/w2-1.png"><img src="../../../../public/2016/05/w2-1-300x200.png" alt="メッセージ受信"></a></p><p>メッセージ受信</p><p>[/wc_column][/wc_row]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>非常に簡単にクライアントサーバー型のアプリが完成しました。 一度プロジェクトを作っておけば、今後はこれをベースに拡張できそうです。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable7">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable7</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その13 Xamarin Android Playerをインストールする</title>
      <link href="/2016/05/02/1177/"/>
      <url>/2016/05/02/1177/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-jz">前回</a>はAndroid Emulatorが表示されないことがある問題を解決しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>が、Emulatorが動かないときがあります。 Emulatorは起動するけど、いつまでたってもデプロイしたアプリが表示されず、ずっとロック画面とか。 前回も最後に話しましたが、Xamarin.AndroidのデバッグはXamarin Android Playerなるものでやるのが良いらしいです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p><a href="https://www.xamarin.com/android-player">Simulate Android apps with the Xamarin Android Player - Xamarin</a>からWindows用のインストーラをダウンロードして起動します。 画面の中央やや下です。 <a href="../../../../public/2016/05/1-1.png"><img src="../../../../public/2016/05/1-1-547x1024.png" alt="インストーラの取得"></a></p><p>インストーラの入手</p><p><a href="https://developer.xamarin.com/guides/android/getting_started/installation/android-player/">Xamarin Android Player Installation - Xamarin</a>によれば、Hyper-Vを無効化しないと最大のパフォーマンスを得られない、と記述があります。 まぁWindows7にインストールするので別に私は構いません。 ダウンロードしたインストーラを起動してインストールを始めます。 <a href="../../../../public/2016/05/2-1.png"><img src="../../../../public/2016/05/2-1.png" alt="セットアップ画面"></a></p><p>セットアップ画面</p><p>ライセンス許諾に了解して開始。 <a href="../../../../public/2016/05/3-1.png"><img src="../../../../public/2016/05/3-1.png" alt="セットアップ開始"></a></p><p>セットアップ開始</p><p>すると始まる<strong>VirtualBox</strong>のインストーラ。 <a href="../../../../public/2016/05/4-1.png"><img src="../../../../public/2016/05/4-1.png" alt="VirtualBoxのセットアップ"></a></p><p>VirtualBoxのセットアップ</p><p>インストール先はご自由に。 <a href="../../../../public/2016/05/5.png"><img src="../../../../public/2016/05/5.png" alt="VirtualBoxのインストール先"></a></p><p>VirtualBoxのインストール先</p><p><a href="../../../../public/2016/05/6-1.png"><img src="../../../../public/2016/05/6-1.png" alt="VirtualBoxのインストールオプション"></a></p><p>VirtualBoxのインストールオプション</p><p>赤字の警告。何かファイルをダウンロードしていたりするなら、それが終わるのを待ちましょう。 <a href="../../../../public/2016/05/7-1.png"><img src="../../../../public/2016/05/7-1.png" alt="警告"></a></p><p>インストール中、ネットワーク接続が一時的に切れる、という警告</p><p><a href="../../../../public/2016/05/8-1.png"><img src="../../../../public/2016/05/8-1.png" alt="Are you ready?"></a></p><p>Are you ready?</p><p>インストール開始。 <a href="../../../../public/2016/05/9-1.png"><img src="../../../../public/2016/05/9-1.png" alt="VirtualBoxインストール中"></a></p><p>VirtualBoxインストール中</p><p>デバイスドライバのインストール。 <strong>Oracle</strong>を信用して、許可してあげましょう。常に許可するかどうかは任意です。 <a href="../../../../public/2016/05/10-1.png"><img src="../../../../public/2016/05/10-1.png" alt="デバイスドライバのインストール許可1"></a></p><p>デバイスドライバのインストール許可1</p><p><a href="../../../../public/2016/05/11-1.png"><img src="../../../../public/2016/05/11-1.png" alt="デバイスドライバのインストール許可2"></a></p><p>デバイスドライバのインストール許可2</p><p>終わった。 <a href="../../../../public/2016/05/12-1.png"><img src="../../../../public/2016/05/12-1.png" alt="VirtualBoxインストール完了"></a></p><p>VirtualBoxインストール完了</p><p>と思いきや。 <a href="../../../../public/2016/05/13.png"><img src="../../../../public/2016/05/13.png" alt="デバイスドライバのインストール許可3"></a></p><p>デバイスドライバのインストール許可3</p><p>ここからが本番。 <a href="../../../../public/2016/05/14.png"><img src="../../../../public/2016/05/14.png" alt="Xamarin Android Playerのセットアップ"></a></p><p>Xamarin Android Playerのセットアップ</p><p>はいはい。 <a href="../../../../public/2016/05/15.png"><img src="../../../../public/2016/05/15.png" alt="Xamarin Android Playerのライセンス許諾"></a></p><p>Xamarin Android Playerのライセンス許諾</p><p>ご自由に。 <a href="../../../../public/2016/05/16.png"><img src="../../../../public/2016/05/16.png" alt="Xamarin Android Playerのインストールオプション"></a></p><p>Xamarin Android Playerのインストールオプション</p><p><a href="../../../../public/2016/05/17.png"><img src="../../../../public/2016/05/17.png" alt="インストール準備OK?"></a></p><p>覚悟はいいか？</p><p>開始。 <a href="../../../../public/2016/05/18.png"><img src="../../../../public/2016/05/18.png" alt="Xamarin Android Playerのインストール中"></a></p><p>Xamarin Android Playerのインストール中</p><p>終了。 <a href="../../../../public/2016/05/19.png"><img src="../../../../public/2016/05/19.png" alt="Xamarin Android Playerのインストール終了"></a></p><p>Xamarin Android Playerのインストール終了</p><p>全部完了 <a href="../../../../public/2016/05/20.png"><img src="../../../../public/2016/05/20.png" alt="完全終了"></a></p><p>完全終了</p><p>とありあえず起動する。 <a href="../../../../public/2016/05/21.png"><img src="../../../../public/2016/05/21.png" alt="起動しない"></a></p><p>え？</p><p><strong>(ﾟДﾟ)ﾊｧ?</strong></p><p>本当に意味不明。いやいや、今インストールしたでしょ？ というわけでGoogle先生。 同じ現象の人、いました。 <a href="https://forums.xamarin.com/discussion/47551/after-fresh-install-on-windows-10-it-says-unable-to-find-virtualbox#latest">After fresh install on Windows 10, it says “Unable to find Virtualbox”</a> 曰く、<strong>環境変数 VBOX_MSI_INSTALL_PATH</strong>の末尾にバックスラッシュがあるとダメだよ、とのこと。 環境変数変更後、再起動。 無事に起動しました。 <a href="../../../../public/2016/05/22.png"><img src="../../../../public/2016/05/22-1024x618.png" alt="対応するエミュレーター一覧"></a></p><p>対応するエミュレーター一覧</p><p>ダウンロードボタンを押下して、ダウンロード開始。 <a href="../../../../public/2016/05/23.png"><img src="../../../../public/2016/05/23.png" alt="デバイス名を指定"></a></p><p>デバイス名を指定</p><p>完了後、デバイス名を指定。デフォルトで問題ないでしょう。 <a href="../../../../public/2016/05/25.png"><img src="../../../../public/2016/05/25.png" alt="デバイスの詳細"></a></p><p>デバイスの詳細</p><p>とりあえず、全部ダウンロードして、Visual Studioを開き、Androidプロジェクトをスタートアップに選択。デバイス一覧を見ると、 <a href="../../../../public/2016/05/26.png"><img src="../../../../public/2016/05/26.png" alt="デバイスが増えた"></a></p><p>増えてる！</p><p>正確には、Xamarin Android Playerがインストールされて、既存のエミュレータと置き換わった、という感じです。 試しに、前回さんざんな目に遭ったAPI23である、**Nexus 7 (Marshmallow) (Android 6.0 - API 23)**を試してみます。 <a href="../../../../public/2016/05/27.png"><img src="../../../../public/2016/05/27.png" alt="エミュレーター起動中"></a></p><p>お？</p><p>特にXamarin Android Playerから予め起動しておく必要は無い模様。 <a href="../../../../public/2016/05/28.png"><img src="../../../../public/2016/05/28.png" alt="待機しますか？"></a></p><p>また待機しますか….</p><p><a href="../../../../public/2016/05/29.png"><img src="../../../../public/2016/05/29.png" alt="きれいな壁紙"></a></p><p>きれいな壁紙</p><p>でも、また反応がない。 って、デバッグが切れてる(#^ω^)ﾋﾞｷﾋﾞｷ でも、再度デバッグしても、うんともすんとも言わない。Visual Studioのステータスバーはオレンジ色なのでデバッグは維持されています。 何気なく、エミュレーターのロック画面を上にスワイプしてみると。 <a href="../../../../public/2016/05/30.png"><img src="../../../../public/2016/05/30.png" alt="デバッグ開始"></a></p><p>デバッグ開始</p><p>きたー。 ちょっと画面の解像度が高すぎて？文字が小さいけど、まぁいいでしょう。 でも、最大化すると画面が真っ暗になります。 ちょっとまだ不安定な感じはします。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>少なくとも、初期状態よりは大分良くなった気がします。 けれど、まだまだ改善の余地があると思います。 私のWindowsとの相性が悪いのかも入れませんが…</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その12 新規作成直後のプロジェクトでAndroidエミュが一覧に表示されない</title>
      <link href="/2016/05/01/1213/"/>
      <url>/2016/05/01/1213/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ix">前回</a>はAndroid Emulatorが動かない問題を解決しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>時折、何かの拍子で、Visual Studioのビルドターゲット一覧 (プロジェクト名.iOSとかプロジェクト.Droidとか並んでいるコンボボックス)の右側のアタッチ先の一覧に存在するはずのAndroidエミューレーターが表示されないことがあります。 <a href="../../../../public/2016/05/1-2.png"><img src="../../../../public/2016/05/1-2.png" alt="表示されないエミュレーター"></a></p><p>そして誰もいなくなった…</p><p>どうも、VisualStudioを起動してから、最初のXamarinプロジェクトを作成した直後の状態だとこの状態に陥るようです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>解決方法はシンプル。 この状態に陥った後、ソリューションを閉じて、再度ソリューションを開き直すだけです。 <a href="../../../../public/2016/05/2-2.png"><img src="../../../../public/2016/05/2-2.png" alt="表示されたエミュレーター"></a></p><p>帰ってきた</p><p>問題が起きるのは、Visual Studioを起動してから、最初に「新規作成」したXamarinプロジェクトだけです。 Visual Studio起動直後に、既存のソリューションを開いた場合は、この現象は発生しません。 Windows7とWindows10の両方で確認しました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>各所で言われていますが、まだまだXamarinは荒削りですね。機能が一通りそろったら、パフォーマンスの向上とバグの修正に注力して、安定化を図ったもらいたいです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その11 Android Emulatorが動かない</title>
      <link href="/2016/05/01/1149/"/>
      <url>/2016/05/01/1149/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-iz">前回</a>はPCLのビルドが通らない問題を解決しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>これまで、iOSでデバッグしてみましたが、Android Emulatorを使ってみようとして、動かないので放置してきましたが、解決に向けて腰を上げました。 まず、問題としてiOSのようにエミュレータが表示されていないのが問題と思いました。 <a href="../../../../public/2016/05/1.png"><img src="../../../../public/2016/05/1.png" alt="エミューレーターがない"></a></p><p>エミューレーターがない</p><p>なので、これを追加します。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>Visual Studioのツールバーの<strong>Android SDK Manager</strong>を起動します。 <a href="../../../../public/2016/05/4.png"><img src="../../../../public/2016/05/4.png" alt="Android SDK Managerの起動"></a></p><p>Android SDK Managerの起動ボタン</p><p>もしくは、スタートメニューから <strong>[Xamarin]</strong> -&gt; <strong>[Platform Tools]</strong> -&gt; **[Android SDK Manager]**と選んでも良いです。 個人的にはvisual Studioを落としておいて、後述の方法で起動した方が良いと思います。 起動すると下記のような画面になります。 <a href="../../../../public/2016/05/2.png"><img src="../../../../public/2016/05/2-1024x467.png" alt="Android SDK Manager"></a></p><p>Android SDK Manager</p><p>右下にアップデートがあることを示すボタンがあるので押下します。 <a href="../../../../public/2016/05/3.png"><img src="../../../../public/2016/05/3.png" alt="ライセンス条件の了承確認"></a></p><p>ライセンス条件の了承確認</p><p>了承して進めていきます。 <a href="../../../../public/2016/05/6.png"><img src="../../../../public/2016/05/6.png" alt="エラー"></a></p><p>無慈悲なエラー</p><p>途中、インストール先のフォルダを移動できない、というエラーメッセージが表示されました。 別のアプリがフォルダをロックしているのでしょう。 Visual Studioを終了させて、スタートメニューから起動する方法でやり直したら私は上手くいきました。最悪再起動してやり直すことも必要かもしれません。 インストールが終わったら、Visual Studioを起動or再起動してみるとエミュレータが追加されます。 <a href="../../../../public/2016/05/7.png"><img src="../../../../public/2016/05/7.png" alt="エミュレータの追加"></a></p><p>エミュレータの追加</p><p>これから、デバッグして起動することでエミュレーターが起動します。 <strong>Xamarin_Android_API_23</strong>ってやつを選びました。最新みたいだし。</p><p>がとてつもなく、遅い。冗談抜きで5分以上待たされる。 <a href="../../../../public/2016/05/8.png"><img src="../../../../public/2016/05/8.png" alt="起動中のスプラッシュスクリーン"></a></p><p>起動中のスプラッシュスクリーン</p><p>この画面の後、真っ黒な画面で待たされる。 <a href="../../../../public/2016/05/9.png"><img src="../../../../public/2016/05/9.png" alt="真っ黒"></a></p><p>真っ黒</p><p>少し変化したが、さらに待たされる。 <a href="../../../../public/2016/05/10.png"><img src="../../../../public/2016/05/10.png" alt="Welcome"></a></p><p>何か出た</p><p>ふと気づくと、Visual Studioとエミューレーターの接続が切れているのか、ビルドのキャンセルボタンが押せなくなっている。 イラッ、としつつ再度デバッグする。 さらに待たされて、ようやく起動した。 <a href="../../../../public/2016/05/11.png"><img src="../../../../public/2016/05/11.png" alt="起動完了"></a></p><p>ようやく出た</p><p>画面ちっさいし… 推測するに、何もエミュレータが起動していない状態からデバッグしようとするとタイムアウトしてしまうのでは？ ただ、それでも遅いときは遅いし、デバッグできないときがある。 ためしに、エミュレータを変えてみる。 **7” KitKat（4.4）XXXHDPI Phone(Android 4.4 - API 19)**ってやつ。</p><p>超速い (前のと比べて。別にiOS Simulatorよりも速い、というわけでもない)。<br><a href="../../../../public/2016/05/12.png"><img src="../../../../public/2016/05/12.png"></a></p><p>しかも何かかっこいいし。 <a href="https://twitter.com/nuits_jp/status/726445129058275328">nuits.jpさんによれば</a>Viaual Studio Emulator for Androidなるものらしい。 なるほど、最新が良いとは限らない訳ね。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Androidのデバッグは、iOSのデバッグよりも面倒でした。 どうも、Xamarin Android Playerなるものがあるらしいので、それを使いたいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その10 PCLのビルドが通らない</title>
      <link href="/2016/04/30/1151/"/>
      <url>/2016/04/30/1151/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-i7">前回</a>はTabbedPageを使って、可変タブを表現してみました。</p><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>以前、ビルドしたときPCLのプロジェクトが下記のエラーを出力していました。 <a href="../../../../public/2016/04/1-13.png"><img src="../../../../public/2016/04/1-13-1024x175.png" alt="エラーメッセージ"></a></p><p>ビルド アクション ‘Page’ は、プロジェクトのターゲットの特定の組み合わせでサポートされていません。</p><p>これはどういうことでしょう？</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>エラーの起きているファイルはxamlファイルでした。 ビルドアクションを見ると、 <a href="../../../../public/2016/04/2-11.png"><img src="../../../../public/2016/04/2-11.png" alt="エラーが起きるプロパティ"></a></p><p>ビルド アクション ‘Page’</p><p>ビルドアクションが<strong>Page</strong>になっているのが原因でしょう。 でも何に直すべきなのでしょうか？ なので、試しに新規プロジェクトを別に作ってみて、xamlのプロパティを確認してみます。 <a href="../../../../public/2016/04/3-9.png"><img src="../../../../public/2016/04/3-9.png" alt="エラーが起きないプロパティ"></a></p><p>ビルド アクション ‘埋め込みリソース’</p><p>ビルドアクションは<strong>埋め込みリソース</strong>になっています。 では、ビルドが通らないプロジェクトでプロパティを<strong>埋め込みリソース</strong>に変更して再ビルドをしてみます。 <a href="../../../../public/2016/04/4-6.png"><img src="../../../../public/2016/04/4-6.png" alt="ビルド成功"></a></p><p>ビルド成功</p><p>ビルドが上手くいきました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>どうして、ビルドアクションがこうなっていたかはわかりませんが、問題が解決しました。 でも、これって別にXamarinの問題ではないような…</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その9 DataTemplateSelector+ViewModelで動的に可変タブを表現</title>
      <link href="/2016/04/27/1123/"/>
      <url>/2016/04/27/1123/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-i2">前回</a>はTabbedPageを使ってみました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>ListView等でデータを表現しようとすると、データの種別に応じて、微妙に表現を変えたりしたいときがあります。 自分としてよくあるのが、パラメータを入力するUIを作る際、設定ファイルなどから読み込んで動的に生成したViewModelに応じて、入力UIを変更する、ということです。 この手の表現はWPFの<strong>System.Windows.Controls.DataTemplateSelector</strong>やUWPの<strong>Windows.UI.Xaml.Controls.DataTemplateSelector</strong>を使います。 では、Xamarin.Formsにあるの？というとどうも2.1で追加されたよう。 詳しくはXamarinの中の人Nish Anil氏の<a href="https://blog.xamarin.com/customizing-list-view-cells-xamarin-forms-datatemplateselector/">Customizing ListView Cells with Xamarin.Forms’ DataTemplateSelector</a>を参考。 が、私の環境で表示されない。 <a href="https://developer.xamarin.com/api/type/Xamarin.Forms.DataTemplateSelector/">Xamarin.Forms.DataTemplateSelector</a>というクラスが存在するのは間違いないのに… と、NuGet管理画面を見たら… <a href="../../../../public/2016/04/1-12.png"><img src="../../../../public/2016/04/1-12-1024x384.png" alt="NuGetパッケージマネージャー"></a></p><p>古い….</p><p>今回のサンプルソースは <a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable4">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable4</a>です。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>まず、NuGetパッケージマネージャーからXamarin.Formsを最新版に更新します。2016/04/26時点で最新版は2.1.0.6526です。 PCLとiOSプロジェクト(必要ならAndroid等も)で更新する必要があります。片方だけだと実行時にエラーが起きてクラッシュします。 これでDataTemplateSelectorが有効になりました。 今回は、TabbedPageの各子要素のPageインスタンスにバインディングされたViewModelをDataTemplateSelectorを使って変化させます。 これによって、TabbedPageのタブをViewModelの状態によって可変にしつつ、ViewModelに応じてタブの内容も変化させることが可能になります。 が、注意しなくてはならないのは、DataTemplateSelectorにDataTypeプロパティが存在しないため、Xamlで生成する際、インテリセンスが効かないため、実行時にバインディングされていないのことに気づかない可能性があります。 また、注意事項として、先のNish Anil氏曰く</p><blockquote><p>When using DataTemplateSelectors, it’s important to keep in mind the following limitations: No more than 20 templates per ListView on Android. The DataTemplateSelector subclass MUST return the same template for the same data if queried multiple times. The DataTemplateSelector must not return another DataTemplateSelector. The DataTemplateSelector must not return new instances of a DataTemplate on each call, instead the same instance must be returned. Failure to do so will effectively disable virtualization and lead to a memory leak.</p></blockquote><p>訳：DataTemplateSelectorsを使うとき、</p><ol><li>Androidでは、1つのListViewにテンプレートは20個まで</li><li>DataTemplateSelectorのサブクラスは、もし複数回要求されるなら、同一のデータに対して同一のテンプレートを<strong>必ず</strong>返す。</li><li>DataTemplateSelectorは別のDataTemplateSelectorを<strong>返してはならない</strong></li><li>DataTemplateSelectorは呼び出しのたびにDataTemplateの新しいインスタンスを<strong>返してはならない</strong>、代わりに同一のインスタンスを<strong>必ず</strong>返すこと。そうしないと、効果的な仮想化は無効化されメモリリークを引き起こす</li></ol><p>と指摘しています。 まぁ、20個もテンプレートを使うことはないと思いますが、DataTemplateSelectorから別のDataTemplateSelectorを返すな、というのはネストするな、ということでしょうか？ これはたまにやることがあるので注意しなければ。 というわけで実装サンプル。 まずはDataTemplateSelector。 <strong>TabbedPageDataTemplateSelector.cs</strong> [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Xamarin.Forms.Portable4.ViewModels;<br>namespace Xamarin.Forms.Portable4.Controls { public sealed class TabbedPageDataTemplateSelector : DataTemplateSelector {<br>public TabbedPageDataTemplateSelector() {<br>}<br>public DataTemplate TabbedPage1 { get; set; }<br>public DataTemplate TabbedPage2 { get; set; }<br>protected override DataTemplate OnSelectTemplate(object item, BindableObject container) { var viewModel = item as TabbedPageViewModel; if (viewModel == null) return null;<br>return viewModel is TabbedPage1ViewModel ? this.TabbedPage1 : viewModel is TabbedPage2ViewModel ? this.TabbedPage2 : null; } } } [/code] 次は、エントリポイントとなるメインのビューであるMainPageView。 ここで全てのViewを、DataTemplateを使って定義しています。 ItemsSourceとItemTemplateはおなじみ、という感じですね。 <strong>MainPageView.xaml</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <TabbedPage x:Class="Xamarin.Forms.Portable4.Views.MainPageView" xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:controls="clr-namespace:Xamarin.Forms.Portable4.Controls;assembly=Xamarin.Forms.Portable4" xmlns:viewModels="clr-namespace:Xamarin.Forms.Portable4.ViewModels;assembly=Xamarin.Forms.Portable4" ItemsSource="{Binding TabbedPages}"><br>&lt;TabbedPage.BindingContext&gt; &lt;viewModels:MainPageViewModel /&gt; &lt;/TabbedPage.BindingContext&gt;<br>&lt;TabbedPage.ItemTemplate&gt; <a href="controls:TabbedPageDataTemplateSelector">controls:TabbedPageDataTemplateSelector</a> <a href="controls:TabbedPageDataTemplateSelector.TabbedPage1">controls:TabbedPageDataTemplateSelector.TabbedPage1</a> <DataTemplate> <ContentPage Title="1"> <Label Text="{Binding Title}" TextColor="Red" VerticalOptions="Center" HorizontalOptions="Center"/> </ContentPage> </DataTemplate> &lt;/controls:TabbedPageDataTemplateSelector.TabbedPage1&gt; <a href="controls:TabbedPageDataTemplateSelector.TabbedPage2">controls:TabbedPageDataTemplateSelector.TabbedPage2</a> <DataTemplate> <ContentPage Title="2"> <Label Text="{Binding Title}" TextColor="Blue" VerticalOptions="Center" HorizontalOptions="Center"/> </ContentPage> </DataTemplate> &lt;/controls:TabbedPageDataTemplateSelector.TabbedPage2&gt; </controls:TabbedPageDataTemplateSelector> &lt;/TabbedPage.ItemTemplate&gt;<br></TabbedPage> [/code] MainViewのViewModelです。 この中でタブに対応するViewModelのコレクションを定義しています。 これによりタブの個数を可変にしています。 <strong>MainPageView.cs</strong> [code lang=”csharp”] using System.Collections.ObjectModel; using Microsoft.Practices.Prism.Mvvm;<br>namespace Xamarin.Forms.Portable4.ViewModels { public sealed class MainPageViewModel : BindableBase { public MainPageViewModel() { var tabbedPageViewModels = new TabbedPageViewModel[] { new TabbedPage1ViewModel(), new TabbedPage2ViewModel(), };<br>this.TabbedPages = new ObservableCollection(tabbedPageViewModels); }<br>private ObservableCollection _TabbedPages;<br>public ObservableCollection TabbedPages { get { return this._TabbedPages; } protected set { this.SetProperty(ref this._TabbedPages, value); } }<br>}<br>} [/code] 最後にタブのViewModelです。 TabbedPageViewModelを派生して、派生クラス毎にTitleプロパティを変更しています。 タブが複数ある場合は、往々にして、個々のタブは似た構成になることが多いので、抽象クラスで共通な振る舞いを定義するのはよくあると思います。 <strong>TabbedPageViewModel.cs</strong> [code lang=”csharp”] using Microsoft.Practices.Prism.Mvvm;<br>namespace Xamarin.Forms.Portable4.ViewModels { public abstract class TabbedPageViewModel : BindableBase {<br>private string _Title;<br>public string Title { get { return this._Title; } protected set { this.SetProperty(ref this._Title, value); } }<br>}<br>public sealed class TabbedPage1ViewModel : TabbedPageViewModel {<br>public TabbedPage1ViewModel() { this.Title = “TabbedPage1”; }<br>} public sealed class TabbedPage2ViewModel : TabbedPageViewModel { public TabbedPage2ViewModel() { this.Title = “TabbedPage2”; }<br>}<br>} [/code] 実行すると下記のようになります。 <a href="../../../../public/2016/04/2-10.png"><img src="../../../../public/2016/04/2-10-1024x819.png" alt="タブ1"></a> </p><p>タブ1</p><p><a href="../../../../public/2016/04/3-8.png"><img src="../../../../public/2016/04/3-8-1024x819.png" alt="タブ2"></a></p><p>タブ2</p><p>DataTemplateがあるかないかでは、表現の幅に大きな違いが出るので、非常にうれしい実装です。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>DataTypeがなかったり、少し制限がありますが、DataTemplateSelectorが遜色ない機能を持っていることがわかりました。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable4">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable4</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その8 TabbedPageを使ってみる</title>
      <link href="/2016/04/26/1118/"/>
      <url>/2016/04/26/1118/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-hZ">前回</a>はTimerを使ってみました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>アプリを作る上で設定画面などを用意する上でタブは欠かせないです。UWPならPivotですね。 Xamarinでは<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.TabbedPage/">Xamarin.Forms.TabbedPage</a>が該当しますが、WPFのTabControlやUWPのPivotと異なり、それ自体がPageの要素になります。 つまりTabControlやPivotと異なり、他の要素の子として追加できないようです。</p><blockquote><p>MultiPage`1 that displays an array of tabs across the top of the screen, each of which loads content onto the screen.</p></blockquote><p>訳:スクリーンのトップを横断するタブの配列を表示するMultiPage`1で、スクリーンに各ページがコンテンツをロードします。</p><p>とあります。 TabbedPageは<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.MultiPage%601/">MultiPage</a>の派生で、子要素は説明にあるとおり、Pageの派生クラスのみ追加できるようです。ですので、ContentPageやTabbedPageを追加できます。 注意事項として、</p><blockquote><p>The user interface of a tabbed page consists of a list of tabs and a larger detail area. On iOS, the list of tabs appears at the bottom of the screen, and the detail area is above. On Android and Windows phones, the tabs appear across the top of the screen. The user can scroll the collection of tabs that are across the top of the screen if that collection is too large to fit on one screen.</p></blockquote><p>訳:Tabbedページのユーザーインターフェイスはタブリストとより大きな詳細エリアから構成されます。iOSにおいては、スクリーンの下部にタブのリストが表示され、その上部に詳細エリアが表示されます。AndroidとWindows Phoneでは、タブはスクリーン上部に位置します。ユーザは、タブのコレクションがスクリーンにフィットするより大きい場合は、スクリーン上部に位置するタブのコレクションをスクロールできます。</p><p>つまり、タブの位置は変更できないようです。 とりあえずつかってみないことにはわかりません。 前回のストップウォッチにタブを加えてみます。 ソースは <a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable3">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable3</a>です。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>特に難しいこともないのですが、Macでデバッグする際、Dockが邪魔をしてタブのテキストが見えなくなって、どうしてテキストが表示されないのか10分くらい悩みました。 画面の関係上、iPhone Simulatorが画面を大きく占める場合は、Dockを自動で隠す設定にした方が無難かもしれません。 まずはエントリポイントとなるメインのビューであるMainPageView。 <strong>MainPageView.xaml</strong> [code lang=”xhtml”] <?xml version="1.0" encoding="utf-8" ?> <TabbedPage x:Class="Xamarin.Forms.Portable3.Views.MainPageView" xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:pages="clr-namespace:Xamarin.Forms.Portable3.Views.Pages;assembly=Xamarin.Forms.Portable3"><br>&lt;TabbedPage.Children&gt; &lt;pages:StopwatchPageView Title=”Stopwatch” /&gt; <ContentPage Title="Timer" /> <TabbedPage Title="Many"> &lt;TabbedPage.Children&gt; <ContentPage Title="Test1"/> <ContentPage Title="Test2"/> <ContentPage Title="Test3"/> &lt;/TabbedPage.Children&gt; </TabbedPage> &lt;/TabbedPage.Children&gt; </TabbedPage> [/code] <strong>MainPageView.cs</strong> [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks;<br>using Xamarin.Forms;<br>namespace Xamarin.Forms.Portable3.Views { public partial class MainPageView : TabbedPage { public MainPageView() { InitializeComponent(); } } } [/code] 注意するのは、ContentPageではなく、TabbedPageの派生クラスに変化したことです。 それ以外は、TabbedPageの子要素として、Pageの派生クラスを追加するだけです。 StopwatchPageViewは前回MainPage.xamlにあった内容を移動しただけです。タブの内容を別のビューとして切り出しただけです。 また、Childrenの三つめにTabbedPgaeを加えてタブを入れ子にしています。 実行すると下記のようになります。 <a href="../../../../public/2016/04/1-11.png"><img src="../../../../public/2016/04/1-11-1024x819.png" alt="タブ"></a></p><p>タブがページ下部に….</p><p><a href="../../../../public/2016/04/2-9.png"><img src="../../../../public/2016/04/2-9-1024x819.png" alt="入れ子"></a></p><p>入れ子にもできます</p><p>このあたりも簡単ですね。 本当はViewModelsからDataTemplateSeclectorを使ってViewを切り替えたかったのですが、まだ未調査でした。 次回できたらいいなと思います。(<em>´ω｀</em>)ﾎｯｺﾘ</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>タブがあるかどうかでアプリがぐっと実用的になると思います。 特に設定画面などはタブのページで用意するのはテンプレと言ってもいいですし。 個人的には、タブは上にあった方が良いんですが、これはカスタマイズできるんでしょうか？</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable3">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable3</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その7 Timerを使ってみる</title>
      <link href="/2016/04/24/1115/"/>
      <url>/2016/04/24/1115/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-hP">前回</a>はMVVMを使ってみました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Xamlを使ってみたので、色々簡単にできると思います。 なので、Timerを使ってストップウォッチを作ってみました。 ソースは <a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable2">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable2</a>です。 この手の話題は<strong>エクセルソフトの田淵様</strong>の<a href="http://ytabuchi.hatenablog.com/entry/2015/12/20/012007">JXUGC #9 Xamarin.Forms Mvvm 実装方法 Teachathon を開催しました</a>で実施済みですが、あえて自分でやってみます。 課題はTimerをどうするか、ですが普通にXamarinのページに<a href="https://developer.xamarin.com/api/member/Xamarin.Forms.Device.StartTimer/p/System.TimeSpan/System.Func%7BSystem.Boolean%7D/">Xamarin.Forms.Device.StartTimer</a>がありました。 けど、WinFormsやWPFでお世話になったSystem.Timers.Timerとかと違います。 インスタンスを作ってそこで管理するのではなく、Staticメソッドにコールバックを渡して、指定した間隔で処理をするようです。 タイマーを停止する方法は</p><blockquote><p>While the callback returns true, the timer will keep recurring.</p></blockquote><p>訳:コールバックがtrueを返す間は、タイマーは繰り返し発生し続けます。</p><p>とあるので、第二引数のコールバックで不要になったらfalseを返せば良いだけのようです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>Timerさえわかれば、あとはちょいちょい、って感じかと思ったそうでもありませんでした。 Xamlで作れるし、WPF、UWPとクラスが似ているので直感的に作れますが、細かいところが違います。 まず、WidthやHeightがReadOnlyなので、要素をおおまかなおおきさにして配置するのが面倒です。 あと、Xamlのインテリセンスが少し残念です。プロパティ要素構文でインテリセンスの推測が効かないので、最初は焦りました。 最もきついのは、Xaml構文でエラーになってもビルドが通ることです。 最初、間違えてResoueceプロパティの子要素に、下記のようにリソース要素を追加していました。 [code lang=”xaml”] &lt;ContentPage.Resources&gt; &lt;converters:BooleanInvertConverter x:Key=”BooleanInvertConverter” /&gt; &lt;/ContentPage.Resources&gt; [/code] でも、これでビルドが通って、長い時間かけて起動したiPhone Simulatorで実行時エラー、となると悲しいです。 正しくは当然下記のよう。 [code lang=”xaml”] &lt;ContentPage.Resources&gt; <ResourceDictionary> &lt;converters:BooleanInvertConverter x:Key=”BooleanInvertConverter” /&gt; </ResourceDictionary> &lt;/ContentPage.Resources&gt; [/code] これは改善して欲しいです。 辛いのはこれくらいですが、あとは普通です。WPFやUWPがきちんと使えればどうとでもなります。 VisiblityプロパティがIsVisibleでbool型なのはWinFormsを思い出して、(<em>´ω｀</em>)ﾎｯｺﾘしました。 最終的に、 <strong>MainPage.xaml</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <ContentPage x:Class="Xamarin.Forms.Portable2.Views.MainPage" xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:converters="clr-namespace:Xamarin.Forms.Portable2.Converters;assembly=Xamarin.Forms.Portable2" xmlns:viewModels="clr-namespace:Xamarin.Forms.Portable2.ViewModels;assembly=Xamarin.Forms.Portable2"> &lt;ContentPage.BindingContext&gt; &lt;viewModels:MainPageViewModel /&gt; &lt;/ContentPage.BindingContext&gt;<br>&lt;ContentPage.Resources&gt; <ResourceDictionary> &lt;converters:BooleanInvertConverter x:Key=”BooleanInvertConverter” /&gt; <Style x:Key="LabelStyle" TargetType="Label"> <Setter Property="FontSize" Value="48" /> <Setter Property="HorizontalOptions" Value="Center" /> <Setter Property="VerticalOptions" Value="Center" /> </Style> </ResourceDictionary> &lt;/ContentPage.Resources&gt;<br><Grid VerticalOptions="Center"> &lt;Grid.ColumnDefinitions&gt; <ColumnDefinition Width="\*"/> <ColumnDefinition Width="2\*"/> <ColumnDefinition Width="10"/> <ColumnDefinition Width="2\*"/> <ColumnDefinition Width="10"/> <ColumnDefinition Width="2\*"/> <ColumnDefinition Width="\*"/> &lt;/Grid.ColumnDefinitions&gt; &lt;Grid.RowDefinitions&gt; <RowDefinition /> <RowDefinition /> &lt;/Grid.RowDefinitions&gt; <Label Grid.Row="0" Grid.Column="1" Style="{StaticResource LabelStyle}" Text="{Binding Minute}" /> <Label Grid.Row="0" Grid.Column="2" Style="{StaticResource LabelStyle}" Text=":" /> <Label Grid.Row="0" Grid.Column="3" Style="{StaticResource LabelStyle}" Text="{Binding Second}" /> <Label Grid.Row="0" Grid.Column="4" Style="{StaticResource LabelStyle}" Text="." /> <Label Grid.Row="0" Grid.Column="5" Style="{StaticResource LabelStyle}" Text="{Binding Millisecond}" /> <Button Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="5" Command="{Binding StartCommand}" HorizontalOptions="Center" IsVisible="{Binding IsRunning, Converter={StaticResource BooleanInvertConverter}}" Text="Start" VerticalOptions="Center" /> <Button Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="5" Command="{Binding StopCommand}" HorizontalOptions="Center" IsVisible="{Binding IsRunning}" Text="Stop" VerticalOptions="Center" /> </Grid> </ContentPage> [/code] <strong>MainPageViewModel.cs</strong> [code lang=”csharp”] using System; using System.Windows.Input; using Microsoft.Practices.Prism.Mvvm;<br>namespace Xamarin.Forms.Portable2.ViewModels { public sealed class MainPageViewModel : BindableBase {<br>public MainPageViewModel() { this.IsRunning = false; this.TimeSpan = new TimeSpan(0, 0, 0, 0, 0); }<br>private TimeSpan _TimeSpan;<br>public TimeSpan TimeSpan { get { return this._TimeSpan; } private set {<br>this.Minute = this.TimeSpan.Minutes.ToString(“00”); this.Second = this.TimeSpan.Seconds.ToString(“00”);<br>var ms = this.TimeSpan.Milliseconds / 10; this.Millisecond = ms.ToString(“00”); this.SetProperty(ref this._TimeSpan, value); } }<br>private string _Minute;<br>public string Minute { get { return this._Minute; } private set { this.SetProperty(ref this._Minute, value); } }<br>private string _Second;<br>public string Second { get { return this._Second; } private set { this.SetProperty(ref this._Second, value); } }<br>private string _Millisecond;<br>public string Millisecond { get { return this._Millisecond; } private set { this.SetProperty(ref this._Millisecond, value); } }<br>private bool _IsRunning = false;<br>public bool IsRunning { get { return this._IsRunning; } private set { this.SetProperty(ref this._IsRunning, value); } }<br>private ICommand _StartCommand;<br>public ICommand StartCommand { get { if (this._StartCommand == null) { this._StartCommand = new Command(() =&gt; { this.IsRunning = true;<br>Device.StartTimer(new TimeSpan(0, 0, 0, 0, 10), () =&gt; { this.TimeSpan = this.TimeSpan.Add(new TimeSpan(0, 0, 0, 0, 10)); return this.IsRunning; }); }); }<br>return this._StartCommand; } }<br>private ICommand _StopCommand;<br>public ICommand StopCommand { get { if (this._StopCommand == null) { this._StopCommand = new Command(() =&gt; { this.IsRunning = false; }); }<br>return this._StopCommand; } }<br>}<br>} [/code] になりました、 BooleanInvertConverterとかは省略します。簡単すぎますので。 出来上がった結果がこれ。 <a href="../../../../public/2016/04/1-10.png"><img src="../../../../public/2016/04/1-10-1024x819.png" alt="どこかでみたようなストップウォッチ"></a></p><p>シンプルなストップウォッチ…</p><p>Startを押せば、Stopボタンに変わり、経過時間が変化します。 が、このストップウォッチ問題があって、非常に精度が悪いです。10ms間隔がまずいのか非常に遅い。 ひょっとしたらTimerは別のAPIがあるのかもしれません。 ネイティブのAPIを直接呼ぶ方がよいか？</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>実用度と精度はともかくアプリと呼べるアプリを作ってみました。 XAMLでの開発経験があるならこれほど取っつきやすいものはないと思います。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable2">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable2</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その6 ViewをMVVMで分離してみる</title>
      <link href="/2016/04/23/1105/"/>
      <url>/2016/04/23/1105/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-hC">前回</a>はテンプレートのせいでビルドできない問題を解消しました。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Xamarin.Formsで<strong>Blank App (Portable)**でプロジェクトを作ります。 なんかGoogle先生で聞くと、PCLの方が良いよ？的な話を聞くので従います。 サンプルソースは <a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable1">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable1</a>。 で、PCLプロジェクトに　**App.cs</strong> ってあります。これがエントリポイントでしょう。 ソースを見ると、 [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Text;<br>using Xamarin.Forms;<br>namespace Xamarin.Forms.Portable1 { public class App : Application { public App() { // The root page of your application MainPage = new ContentPage { Content = new StackLayout { VerticalOptions = LayoutOptions.Center, Children = { new Label { XAlign = TextAlignment.Center, Text = “Welcome to Xamarin Forms!” } } } }; }<br>protected override void OnStart() { // Handle when your app starts }<br>protected override void OnSleep() { // Handle when your app sleeps }<br>protected override void OnResume() { // Handle when your app resumes } } } [/code] ってあります。さっするにコードからUIを構築しているものと思われます。 でも、分離コードどころか、今日日こんなソースプロジェクトで使っていたら絶対に「うわぁ」って言われます。 いや会社のWinFormsのプロジェクトは諸般の事情でこうなってますけど。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>とりあえず、分離します。 どうもXAMLが使えるようです。 なので、PCLにXAMLを追加します。Viewsフォルダを作ってそこにViewとなるPageとかを追加します。 <a href="../../../../public/2016/04/1-9.png"><img src="../../../../public/2016/04/1-9.png" alt="新しい項目の追加"></a></p><p>3つあって迷う…</p><p>で、<strong>Forms ContentPage</strong>、<strong>Forms ContentView</strong>、<strong>Forms Xaml Page</strong>ってあります。 <a href="https://developer.xamarin.com/api/type/Xamarin.Forms.ContentPage/">ContentPage</a></p><blockquote><p>A Page that displays a single view.</p></blockquote><p>訳:単一のビューを表示するページです</p><p><a href="https://developer.xamarin.com/api/type/Xamarin.Forms.ContentView/">ContentView</a>は、</p><blockquote><p>An element that contains a single child element.</p></blockquote><p>訳:単一の子要素を含む要素です</p><p><a href="https://developer.xamarin.com/api/type/Xamarin.Forms.Page/">Page</a>は、</p><blockquote><p>A VisualElement that occupies the entire screen.</p></blockquote><p>訳:スクリーン全体を占有するVisualElementです</p><p>とのこと。それぞれ試しに作ってみると、 [table id=22 /] となります。 <strong>ContentPage</strong> [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Reflection.Emit; using System.Text;<br>using Xamarin.Forms;<br>namespace Xamarin.Forms.Portable1.Views { public class MainPage : ContentPage { public MainPage() { Content = new StackLayout { Children = { new Label { Text = “Hello ContentPage” } } }; } } } [/code] <strong>ContentView</strong> [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Reflection.Emit; using System.Text;<br>using Xamarin.Forms;<br>namespace Xamarin.Forms.Portable1.Views { public class MainContentView : ContentView { public MainContentView() { Content = new Label { Text = “Hello ContentView” }; } } } [/code] <strong>Xaml Page (cs)</strong> [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks;<br>using Xamarin.Forms;<br>namespace Xamarin.Forms.Portable1.Views { public partial class Page : ContentPage { public Page() { InitializeComponent(); } } } [/code] <strong>Xaml Page (xaml)</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <ContentPage xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" x:Class="Xamarin.Forms.Portable1.Views.Page"> <Label Text="{Binding MainText}" VerticalOptions="Center" HorizontalOptions="Center" /> </ContentPage> [/code] 目的を達成するには、Xaml Pageが正しいようです。 でも、Xamlを見るとBindingとかあります。DataContextを適用可能なのでしょう。 Prism.Mvvmが使えるようですので、NuGetで追加します。 ViewModelsフォルダを追加して、ViewModelを追加します。 <strong>MainPageViewModel</strong> [code lang=”csharp”] using Microsoft.Practices.Prism.Mvvm;<br>namespace Xamarin.Forms.Portable1.ViewModels { public sealed class MainPageViewModel : BindableBase {<br>public MainPageViewModel() { this.MainText = “Hello world from MVVM!!”; }<br>private string _MainText;<br>public string MainText { get { return this._MainText; } set { this._MainText = value; this.SetProperty(ref this._MainText, value); } } } } [/code] これをViewにバインディングします。 <strong>MainPage.xaml</strong> [code lang=”xaml”] <?xml version="1.0" encoding="utf-8" ?> <ContentPage x:Class="Xamarin.Forms.Portable1.Views.MainPage" xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:viewModels="clr-namespace:Xamarin.Forms.Portable1.ViewModels;assembly=Xamarin.Forms.Portable1"> &lt;ContentPage.BindingContext&gt; &lt;viewModels:MainPageViewModel /&gt; &lt;/ContentPage.BindingContext&gt; <Label HorizontalOptions="Center" Text="{Binding MainText}" VerticalOptions="Center" /> </ContentPage> [/code] <strong>DataContext</strong>ではなく、<strong>BindingContext</strong>というのがミソです。 最後にエントリポイントである、App.csを変更します。 <strong>App.cs</strong> [code lang=”csharp”] using System; using System.Collections.Generic; using System.Linq; using System.Text;<br>using Xamarin.Forms; using Xamarin.Forms.Portable1.Views;<br>namespace Xamarin.Forms.Portable1 { public class App : Application { public App() { // The root page of your application MainPage = new MainPage(); }<br>protected override void OnStart() { // Handle when your app starts }<br>protected override void OnSleep() { // Handle when your app sleeps }<br>protected override void OnResume() { // Handle when your app resumes } } } [/code] で、iPhone Simulatorでデバッグ実行です。 <a href="../../../../public/2016/04/2-8.png"><img src="../../../../public/2016/04/2-8-1024x819.png" alt="デバッグ結果"></a></p><p>Hello MVVM!!!</p><p>iOS側のプロジェクトは一切いじっていません。 素晴らしい(<em>´ω｀</em>)</p><p>Android?Windows Phone?次回やります(多分)</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>MVVMを使って、それらしいプロジェクトを使ってみました。今のところ各デバイス固有のプロジェクトの意味が見えてきませんが。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable1">https://github.com/takuya-takeuchi/Demo/tree/master/Xamarin.Forms.Portable1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その5 Xamarin.FormsでiOSがビルドできない</title>
      <link href="/2016/04/17/1092/"/>
      <url>/2016/04/17/1092/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ht">前回</a>からXamarin.Formsを開始しました</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Xamarin.Formsで**Blank App (Shared)**でプロジェクトを作ります。 とりあえず、iOSのプロジェクトをiPhone Simiulatorでビルドでしてみます。 ですが、エラーが出ます。 <a href="../../../../public/2016/04/1-8.png"><img src="../../../../public/2016/04/1-8.png" alt="Error"></a></p><p>またエラーだお(´;ω;`)ﾌﾞﾜｯ</p><p>System.IO.FileNotFoundException: /Users/XXXXXXX/Library/Caches/Xamarin/mtbs/builds/XamarinFormsShared1iOS/814c4b85c884d27f60de3287985dd749/obj/iPhoneSimulator/Debug/optimized/Default-568h@2x.png does not exist といっています。 これは、iOSアプリのスプラッシュスクリーン画像が存在しないことを意味しています。 ですが、iOSプロジェクトのリソースフォルダ <strong>App1\App1\App1.iOS\Resources</strong> をみると、 <a href="../../../../public/2016/04/2-7.png"><img src="../../../../public/2016/04/2-7.png" alt="Resourceフォルダ"></a></p><p>アイコン画像が壊れています</p><p>新規で作成したプロジェクトであるにもかかわらず画像が壊れています。 というか真っ黒な画像?</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>どうも新規作成した際に画像が壊れてしまったようです。 その証拠にXamarin.Formsの**Blank App (Shared)**プロジェクトテンプレートファイルを解凍してみると、やはり画像は健在です。 <a href="../../../../public/2016/04/3-7.png"><img src="../../../../public/2016/04/3-7.png" alt="Templateの画像"></a></p><p>Xamarinの画像がたくさん</p><p>テンプレートは下記のファイルになります。</p><p><strong>C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\Extensions\Xamarin\Xamarin\4.0.3.214\T\PT\Cross-Platform\Xamarin.Forms.PCL.zip C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\Extensions\Xamarin\Xamarin\4.0.3.214\T\PT\Cross-Platform\Xamarin.Forms.SAP.zip</strong></p><p>ですので、ここから画像をコピーしてResouceフォルダに上書きして画像を復元します。 その後、リビルドしてからデバッグ実行します。 <a href="../../../../public/2016/04/4-5.png"><img src="../../../../public/2016/04/4-5-1024x819.png" alt="起動画像"></a></p><p>Xamarinロゴの起動画面</p><p><a href="../../../../public/2016/04/5-4.png"><img src="../../../../public/2016/04/5-4-1024x819.png" alt="Welcome"></a></p><p>Welcome to Xamarin Forms!</p><p>無事に起動できました(*´ω｀*)</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Googleで検索しても同じ症状の人が見つかりませんでした。私だけなのですか？Windows7で実行しているのがまずいのでしょうか？</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その4 Xamarin.FormsでHello worldする前に</title>
      <link href="/2016/04/17/1083/"/>
      <url>/2016/04/17/1083/</url>
      
        <content type="html"><![CDATA[<p>Xamarin.iOSはやめて素直にXamarin.Formsを始めました。決して情報が少ないからとか流行に乗り遅れたくない、とかじゃないです。</p><a id="more"></a><h1 id="Memo"><a href="#Memo" class="headerlink" title="Memo"></a>Memo</h1><p>新規でプロジェクトを作ります。<br><a href="../../../../public/2016/04/1-7.png"><img src="../../../../public/2016/04/1-7.png"></a></p><p>Shared?Portable?</p><p><strong>Xamarin.Forms</strong>という<strong>Blank App</strong>が2つあります。 種類の説明をみると、 <strong>Blank App (Xamarin.Forms Portable)</strong></p><blockquote><p>A multiproject template for building apps with Xamarin.Fomrs, sharing code using a portable class library. On Visual Studio 2010, the Portable Class Library Tools are required.</p></blockquote><p>Xamarin.Formsを使用してアプリを構築するマルチプロジェクトのテンプレートで、ポータブル クラス ライブラリを使ってコードを共有します。Visual Studio 2010で、ポータブル クラス ライブラリツールが必要です。<br><a href="../../../../public/2016/04/2-6.png"><img src="../../../../public/2016/04/2-6-1024x618.png"></a></p><p>Blank App (Xamarin.Forms Portable) の構成</p><p><strong>Blank App (Xamarin.Forms Shared)</strong></p><blockquote><p>A multiproject template for building apps with Xamarin.Fomrs, sharing code using a shared assets project. Requires Visual Studio 2013 Update2 or greater.</p></blockquote><p>Xamarin.Formsを使用してアプリを構築するマルチプロジェクトのテンプレートで、共有アセットを使ってコードを共有します。Visual Studio 2013　Update2またはそれ以降が必要です。<br><a href="../../../../public/2016/04/3-6.png"><img src="../../../../public/2016/04/3-6-1024x618.png"></a></p><p>Blank App (Xamarin.Forms Shared) の構成</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>どちらを使うかは好みですが、新しい感じがするSharedの方が良さそうです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その3 またデバッグできない</title>
      <link href="/2016/04/17/1066/"/>
      <url>/2016/04/17/1066/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-h1">前回</a>、No valid iOS code signing keys found in keychain.なるエラーがでましたが…</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>とりあえず、Storyboardにボタンを追加して、イベントも追加してダイアログでHello, world!!ってやるサンプルを作りました。 で、それをiPhone Simulatorでデバッグしようと思いましたが。 けどまた無慈悲なエラーが。 <a href="../../../../public/2016/04/1-6.png"><img src="../../../../public/2016/04/1-6-1024x129.png" alt="Error"></a></p><p>This version of Xamarin.iOS requires the iOS 9.3 SDK (shipped with Xcode 7.3) when the managed linker is disabled. Either upgrade Xcode, or enable the managed linker. Xamarin.iOS1</p><p>また、不思議なエラーです。 字面を見るならMac側にエラーがある感じです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>Xcodeと言っているので、まずはXcodeが7.3なのかどうかを確認します。 Xcodeを起動したところ、</p><p><a href="../../../../public/2016/04/2-5.png"><img src="../../../../public/2016/04/2-5.png" alt="Verifying XCode.app"></a></p><p>“Xcode.app”を検証中</p><p>終わらない検証中。 かなり時間がかかりましたが、終わった後ライセンス許諾書の画面。どうも初回起動の模様。 <a href="../../../../public/2016/04/3-5.png"><img src="../../../../public/2016/04/3-5.png" alt="License"></a></p><p>ラインセンス許諾</p><p><a href="../../../../public/2016/04/4-4.png"><img src="../../../../public/2016/04/4-4.png" alt="License"></a></p><p>admin権限の確認</p><p><a href="../../../../public/2016/04/5-3.png"><img src="../../../../public/2016/04/5-3.png" alt="Install Component"></a></p><p>インストール中</p><p><a href="../../../../public/2016/04/6-2.png"><img src="../../../../public/2016/04/6-2.png" alt="Start Screen"></a></p><p>バージョンが7.2….</p><p>7.3ではないようなので、App StoreからXcodeをアップデートしました。 アップデートは以前チェックしていたんですが、手動じゃないとダメなのか？ <a href="../../../../public/2016/04/7-2.png"><img src="../../../../public/2016/04/7-2.png" alt="Update"></a></p><p>アップデート中</p><p><strong>4.87GB…(‘A`)</strong></p><p>インストール後、無事にビルドが通り、iPhone Simulatorが起動するようになりました。 <a href="../../../../public/2016/04/8-2.png"><img src="../../../../public/2016/04/8-2-1024x819.png" alt="iPhone Simulator"></a></p><p>無事に起動しました</p><p>でも… <a href="../../../../public/2016/04/9-2.png"><img src="../../../../public/2016/04/9-2-1024x634.png" alt="例外"></a></p><p>例外だと…</p><p>なんぞこれ…</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Xcodeのバージョンは常に意識する必要があるようです。 Visual Studio側で起動するiPhone SimulatorのiOSのバージョンとMac側のXcodeが対応しているiOSのバージョンを一致させましょう。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UWPメモ その5 UWP/WPFで画像オブジェクトに対する解放処理は不要なのか</title>
      <link href="/2016/04/12/1028/"/>
      <url>/2016/04/12/1028/</url>
      
        <content type="html"><![CDATA[<p>会社で使う学習資料の更新が終わりました。毎回PowerPointのスライド20枚とサンプルプログラム1,2個つけたのが、今日の時点で13個。頑張ったものです。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>WinFormsだと、画像オブジェクト、例えば<strong>System.Drawing.Bitmap</strong>は不要になったら、nullで参照を削除する前に、Disposeメソッドを呼び出す必要があります。 これは内部で保持している、GDIによるアンマネージドデータを破棄するために他なりません。 対して、GDIを使っていないWPF/UWPはどうなのでしょう？ 無限ループで<strong>System.Windows.Media.Imaging.WriteableBitmap</strong>を生成するプログラムを組んでチェックしましたが、private working setが増えていたことから、アンマネージドでどこかにデータを確保しているのは間違いありませんでした。 でも、IDiposableインターフェイスは実装していません。 本当に参照が全部消えれば破棄されるの？ 不安はぬぐい去れません。 五年前、入社二年目の私はインド人が手を入れた.NETをプログラムの修正を任されました。当時.NETを扱える人間が私しかいなかったためです。 で、そのソース、画像データを大量に扱う代物で、一切解放処理が書いてありませんでした。 当然しばらくするとメモリ不足で落ちました。4000x4000とか巨大なビットマップを扱うものですから… トルコまで行って対応したのはいい思い出です(白目)</p><h1 id="Inspection"><a href="#Inspection" class="headerlink" title="Inspection"></a>Inspection</h1><p>簡単なサンプルプログラムをWPF/UWPそれぞれ用意しました。 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/UWP4">https://github.com/takuya-takeuchi/Demo/tree/master/UWP4</a> UWP側のViewModelだけ記載します。 [code lang=”csharp”] using System; using System.Collections.Generic; using Windows.UI.Xaml.Media.Imaging; using Prism.Commands; using Prism.Windows.Mvvm; using Shared.Services; using Shared.ViewModels;<br>namespace UWP4.ViewModels { public sealed class MainPageViewModel : ViewModelBase, IMainPageViewModel {<br>private readonly List<WriteableBitmap> _WriteableBitmaps = new List<WriteableBitmap>();<br>private readonly IDispatcherService _DispatcherService;<br>public MainPageViewModel(IDispatcherService dispatcherService) { this._DispatcherService = dispatcherService; this.Width = 2000; this.Height = 2000; this.Count = 10; }<br>private int _Count; public int Count { get { return this._Count; } set { this.SetProperty(ref this._Count, value); } }<br>private int _Width; public int Width { get { return this._Width; } set { this.SetProperty(ref this._Width, value); } }<br>private int _Height; public int Height { get { return this._Height; } set { this.SetProperty(ref this._Height, value); } }<br>private bool _Freeze; public bool Freeze { get { return this._Freeze; } set { this.SetProperty(ref this._Freeze, value); } }<br>private DelegateCommand _StartCommand; public DelegateCommand StartCommand { get { if (this._StartCommand == null) { this._StartCommand = new DelegateCommand( () =&gt; { var width = this.Width; var height = this.Height; var count = this.Count; for (var i = 0; i &lt; count; i++) this._WriteableBitmaps.Add(new WriteableBitmap(width, height)); }); }<br>return this._StartCommand; } }<br>private DelegateCommand _ClearCommand; public DelegateCommand ClearCommand { get { if (this._ClearCommand == null) { this._ClearCommand = new DelegateCommand( () =&gt; { this._WriteableBitmaps.Clear(); }); }<br>return this._ClearCommand; } }<br>private DelegateCommand _GCCommand; public DelegateCommand GCCommand { get { if (this._GCCommand == null) { this._GCCommand = new DelegateCommand(GC.Collect); }<br>return this._GCCommand; } }<br>}<br>} [/code] Startボタンを押下すると、TextBoxで指定した、Width、HeightとCountで指定しただけのWriteableBitmapを生成して、System.Collections.Generic.Listに格納していきます。 Clearボタンを押下すると、List.Clearを呼びリストを空にします。 この時点で参照が全て消えるので、GCが動けばメモリが解放されるはずです。 一応明示的にGCを呼ぶためのGCボタンを用意しました。 また、WPFのWriteableBitmapはSystem.Windows.Freezableクラスの派生形であるため、Freezeメソッドをコールした場合、そうでない場合、挙動がどう変化するのかを確認します。</p><h3 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h3><p>計測は、<strong>dotMemory</strong>を使います。 まずUWPです。 起動直後、Start直後、Clear直後、GC直後の4段階でSnapshotを採取します。<br><a href="../../../../public/2016/04/1-4.png"><img src="../../../../public/2016/04/1-4-1024x620.png"></a></p><p>次に、Start直後とClear直後で比較をとります。 Listに含まれるWriteableBitmapのインスタンスが削除されていることがわかりますが、この時点ではメモリ量は変化しません。 最後の、GC直後の段階でメモリ使用量が大幅に減っているのがわかります。<br><a href="../../../../public/2016/04/2-3.png"><img src="../../../../public/2016/04/2-3-1024x620.png"></a></p><p>同じようにWPFでもテストします。最初はFreezeしない状態で4つのSnapshotを採取します。<br><a href="../../../../public/2016/04/3-3.png"><img src="../../../../public/2016/04/3-3-1024x620.png"></a></p><p>最後に、起動直後にFreezeのフラグを有効にして、WriteableBitmap生成直後にFreezeする処理を追加したパターンで4つのSnapshotを採取します。<br><a href="../../../../public/2016/04/4-3.png"><img src="../../../../public/2016/04/4-3-1024x620.png"></a></p><p>Freezeの有無でメモリ使用量に変化があります。Freezeすると確保するメモリ量が60%位になりました。 Freeze状態にすると変更できなくなるため、データ内容を変更するために用意したバッファなどがなくなるのでしょうか？ どちらにしても変更が不要なら、不要になった時点で即座にFreezeした方が良さそうです。 UWPも219.67MB-66.69MB=152.98MB WPFも230.71MB-77.42MB=153.29MB となり、 2000_2000_4(ARGB?)*10/1024/1024=152MB というデータ量に近似します。 メモリリークは発生していないと言えそうです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>WinFormsと異なり、画像データのメモリリークは起きないことが証明されました。 ただ、WinFormsとは違って、GCが発生しないとメモリが解放されないのはどうも… 明示的にGCを呼ぶのはWinFormsの時の経験から言って避けたいところです。明示的に呼んでフリーズしてそのまま何もできなくなってしまったことがあったので。 なにはともあれ、不安は消えました。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/UWP4">https://github.com/takuya-takeuchi/Demo/tree/master/UWP4</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Universal Windows Platform </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その2 No valid iOS code signing keys found in keychainを解決</title>
      <link href="/2016/04/10/1055/"/>
      <url>/2016/04/10/1055/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-g5">前回</a>、No valid iOS code signing keys found in keychain.なるエラーがでましたが…</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>何でデバッグできないの？って悩みました。 確かにApple Developper Programの更新が途絶したのはわかっていますが、デバッグできない理由にはならないです。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p><a href="../../../../public/2016/04/2-4.png"><img src="../../../../public/2016/04/2-4.png" alt="Build設定"></a></p><p>を <a href="../../../../public/2016/04/1-5.png"><img src="../../../../public/2016/04/1-5.png" alt="Build設定"></a></p><p>にする。 簡単でしょ(白目)？ ちゃんとMacでデバッグできます。 なんで気づかなかったのか…<br><a href="../../../../public/2016/04/3-4.png"><img src="../../../../public/2016/04/3-4-1024x819.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>デフォルトのビルド設定の対象がiPhoneなのが悪いんです….</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarinメモ その1 リスタート</title>
      <link href="/2016/04/09/997/"/>
      <url>/2016/04/09/997/</url>
      
        <content type="html"><![CDATA[<p>1,2年前にせっかく購入したXamarinを無駄にした私ですが何か？</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>無料になったので気軽になりましたね(白目) で、<strong>Visual Studio 2015 Professional</strong>は持っているので、Update2にすれば簡単に使えるの？と思ったけどそうではなかったのでメモ。 既存ユーザで私みたいなお金をどぶにした人はいないので、きっと情報が少ないのでしょう。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>インストール手順を書いていきます。基本一本道ですが。</p><h3 id="Update2"><a href="#Update2" class="headerlink" title="Update2"></a>Update2</h3><p>まず、<strong>Visual Studio 2015 Update2</strong> を適用しておきます。これ必要なのか？念には念を、というやつです。</p><h3 id="Xamarin-for-Visual-Studio"><a href="#Xamarin-for-Visual-Studio" class="headerlink" title="Xamarin for Visual Studio"></a>Xamarin for Visual Studio</h3><p>次に、<a href="https://www.xamarin.com/download">https://www.xamarin.com/download</a> から、<strong>Xamarin for Visual Studio</strong>インストーラを入手できます。 会社名とかは個人なので適当に。 <a href="../../../../public/2016/04/1-3.png"><img src="../../../../public/2016/04/1-3-1024x553.png" alt="Download Visual Studio"></a></p><p>インストーラを実行します。管理者権限で実行しましょう。 <a href="../../../../public/2016/04/2-2.png"><img src="../../../../public/2016/04/2-2-300x252.png" alt="Xamarin for Visual Studio"></a></p><p>起動してからContinueボタン押下してから、凄い時間がかかりました。バックグラウンドで動いているのは確認したんですが。 <a href="../../../../public/2016/04/3-2.png"><img src="../../../../public/2016/04/3-2-300x281.png" alt="Xamarin for Visual Studio"></a></p><p><a href="../../../../public/2016/04/4-2.png"><img src="../../../../public/2016/04/4-2-300x281.png" alt="Xamarin for Visual Studio"></a></p><p><strong>I agree to license terms</strong> にチェック。 <a href="../../../../public/2016/04/5-2.png"><img src="../../../../public/2016/04/5-2-300x281.png" alt="Xamarin for Visual Studio"></a></p><p>Android SDK のインストール先に問題がなければNext。 <a href="../../../../public/2016/04/6-1.png"><img src="../../../../public/2016/04/6-1-300x281.png" alt="Xamarin for Visual Studio"></a></p><p>Visual Studioが起動していることを検知して、落とすことを推奨しています。やだこの子賢い。 <a href="../../../../public/2016/04/7-1.png"><img src="../../../../public/2016/04/7-1-300x281.png" alt="Xamarin for Visual Studio"></a></p><p>次へ。 <a href="../../../../public/2016/04/8-1.png"><img src="../../../../public/2016/04/8-1-300x281.png" alt="Xamarin for Visual Studio"></a></p><p>インストール中。 <a href="../../../../public/2016/04/9-1.png"><img src="../../../../public/2016/04/9-1-300x91.png" alt="Xamarin for Visual Studio"></a></p><p>何か別ウィンドウが起動しています。 <a href="../../../../public/2016/04/10-1.png"><img src="../../../../public/2016/04/10-1-300x281.png" alt="Xamarin for Visual Studio"></a></p><p>I’m ready!!</p><h3 id="Check-it-out"><a href="#Check-it-out" class="headerlink" title="Check it out!!"></a>Check it out!!</h3><p>インストールが完了したので、Visual Studioの新規プロジェクトを確認してみます。 <strong>Cross-Platform</strong> というのが増えています。 <a href="../../../../public/2016/04/11-1.png"><img src="../../../../public/2016/04/11-1-300x207.png" alt="Visual Studio"></a></p><p>とりあえず、**Single View App (iOS)**を選択。 <a href="../../../../public/2016/04/12-1.png"><img src="../../../../public/2016/04/12-1-300x207.png" alt="Visual Studio"></a></p><p>かっこいい画面でお出迎え。 <a href="../../../../public/2016/04/13-1.png"><img src="../../../../public/2016/04/13-1-300x181.png" alt="Visual Studio"></a></p><p>お、Macとの接続を実施するウィザードが。 これは<strong>ツール</strong>-&gt;<strong>iOS</strong>-&gt;<strong>Xamarin Mac Agent</strong>から起動できる模様。 <a href="../../../../public/2016/04/14-1.png"><img src="../../../../public/2016/04/14-1-300x254.png" alt="Xamarin Mac Agent"></a></p><p>Macのリモートログイン機能を有効にしてください、と。 <a href="../../../../public/2016/04/15-1.png"><img src="../../../../public/2016/04/15-1-300x254.png" alt="Xamarin Mac Agent"></a></p><p><a href="../../../../public/2016/04/16-1.png"><img src="../../../../public/2016/04/16-1-300x254.png" alt="Xamarin Mac Agent"></a></p><p>接続するユーザを限定してね、と。 <a href="../../../../public/2016/04/17-1.png"><img src="../../../../public/2016/04/17-1-300x254.png" alt="Xamarin Mac Agent"></a></p><p>OKしてみると、接続失敗。今Macが更新中でしたので。そもそも設定していません。 <a href="../../../../public/2016/04/18-1.png"><img src="../../../../public/2016/04/18-1-300x275.png" alt="Xamarin Mac Agent"></a></p><p>Mac側もXamarin Installerをダウンロードしてきてインストールします。 このあたりは、ちょまど様の<a href="https://chomado.com/note/tech/install-xamarin/">Mac に Xamarin 使ってみた！インストール〜実行まで【完全無料】</a>をどうぞ。 (VNC経由のためスクリーンショットがとれないため…) 次に、Mac側の<strong>システム環境設定</strong>から<strong>共有</strong>を選択します。で、リモートログインというのが、左側にあるのでチェックして有効にします。 あとは必要なユーザに許可を出して終了です。 で、Visual Studioから再度Xamarin Mac Agentを起動すると、すぐにMacを検出してくれます。以前のXamarinより精度がいいです。 <a href="../../../../public/2016/04/19-1.png"><img src="../../../../public/2016/04/19-1-300x275.png" alt="Xamarin Mac Agent"></a></p><p>Connetボタンを押下して、Macのユーザ名とパスワードを入力。 <a href="../../../../public/2016/04/20-1.png"><img src="../../../../public/2016/04/20-1-300x179.png" alt="Xamarin Mac Agent"></a></p><p>しばらくすると、ダイアログが消えます。 すると、Visual Studioのツールバーに接続が完了したことを通知するアイコンが表示されます。 <a href="../../../../public/2016/04/21.png"><img src="../../../../public/2016/04/21.png" alt="Visual Studio"></a></p><p>F5でビルド+デバッグか、と思ったら無反応。 ビルドはShift+F6とのこと。 まずはビルドだけ実行。 が、失敗。 <strong>No valid iOS code signing keys found in keychain. You need to request a codesigning certificate from <a href="https://developer.apple.com/">https://developer.apple.com</a>.</strong> 訳：有効なiOSのコードサインキーがキーチェーンにないよ。<a href="https://developer.apple.comからコードサイニング証明書を要求する必要があるよ./">https://developer.apple.comからコードサイニング証明書を要求する必要があるよ。</a> <a href="../../../../public/2016/04/22.png"><img src="../../../../public/2016/04/22-1024x183.png" alt="Visual Studio"></a></p><p>うーん、以前はできたのに。 実機に対して実行になってるのかと思って、おもむろに先の接続完了アイコンの右側にある<strong>Show iOS Simulator</strong>ボタンを押下してみる。 が、Mac側でエラー。 <a href="../../../../public/2016/04/23.png"><img src="../../../../public/2016/04/23.png" alt="Mac Error"></a></p><p>PC設定のカルマ様の<a href="http://pc-karuma.net/download-app-security/">Mac - ダウンロードしたアプリケーションの実行許可</a>にて対応策が。 とりあえず、<strong>システム環境設定</strong>-&gt;<strong>セキュリティとプライバシー</strong>-&gt;<strong>一般</strong>-&gt;<strong>鍵ロック解除</strong>-&gt;<strong>すべてのアプリケーションを許可</strong>に変更して再度実行。 <a href="../../../../public/2016/04/24.png"><img src="../../../../public/2016/04/24.png" alt="Mac Error"></a></p><p>また警告が出たので開くで続行。</p><p>ようやく出たー。 Safariアイコンが出るまでが遅かったけど。 <a href="../../../../public/2016/04/25.png"><img src="../../../../public/2016/04/25-1024x820.png" alt="iOS Simulator"></a></p><p>環境構築はこれで完了?</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>とても長かったですが、一歩前進ですかね。私としてはStoryboardがVisual Studioで使えるようになり簡単にデザインできるのを楽しみにしているわけです。 Xamarin.Formsだとまた何か違うのでしょうけど。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UWPメモ その4 バックグラウンドスレッドでのDependencyObject作成はメモリーリークするのか</title>
      <link href="/2016/04/08/988/"/>
      <url>/2016/04/08/988/</url>
      
        <content type="html"><![CDATA[<p>UWPでカメラやおよそ一般人が使うとは思えない機器から入力された画像データを画面にプレビューして処理するアプリを仕事で作っています。海外の子会社が作っているプロダクトですが。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>ぐらばく様の<a href="http://grabacr.net/archives/1851">バックグラウンド スレッドで UI 要素を作るとメモリリークする (WPF)</a> @karno様の<a href="http://b.starwing.net/?p=142">バックグラウンドスレッドでUI要素を作るともっと問題は深刻かもしれない。(WPF)</a> で話題になっている案件ですが、UWPでもこの手の問題は起きるのでしょうか？ 結論から言うと問題は起きないと思います。 というのも、UWPにおいてバックグランドスレッドにて<strong>DependencyObject</strong>を作成することはできません。すべて<strong>Dispatcher</strong>を経由する必要があります。 例えば、 [code lang=”csharp”] await Task.Run(()=&gt;new WriteableBitmap(200, 200, 96, 96, PixelFormats.Bgr32, null)); [/code] みたいにしようならば、 <a href="../../../../public/2016/04/1-1.png"><img src="../../../../public/2016/04/1-1-300x56.png" alt="例外"></a></p><p>こうなります。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>きちんとDispatcherを経由しましょうってことですね。 ちなみに、ViewModelとかまでDispatcherをもってくるのではなく、DispatcherServiceを用意して、Dispatcherを抽象化するべきです。 例えば、 <strong>WPF向け</strong> [code lang=”csharp”] using System; using System.Threading; using System.Threading.Tasks; using System.Windows.Threading; using Shared.Services;<br>namespace WPF3.Services { public sealed class DispatcherService : IDispatcherService { private readonly Dispatcher _Dispatcher;<br>public DispatcherService(Dispatcher dispatcher) { this._Dispatcher = dispatcher; }<br>public async Task SafeAction(Action action) { if (!this._Dispatcher.CheckAccess()) await this._Dispatcher.InvokeAsync(action); else action.Invoke(); }<br>}<br>} [/code] <strong>UWP (Desktop)向け</strong> [code lang=”csharp”] namespace UWP3.Services { public sealed class DispatcherService : IDispatcherService { private readonly CoreDispatcher _Dispatcher;<br>public DispatcherService(CoreDispatcher dispatcher) { this._Dispatcher = dispatcher; }<br>public async Task SafeAction(Action action) { if (!this._Dispatcher.HasThreadAccess) await this._Dispatcher.RunAsync(CoreDispatcherPriority.Normal, action.Invoke); else action.Invoke(); }<br>}<br>} [/code] で<strong>Prism</strong>の<strong>UnityContainer</strong>あたりでDIを使って切り替えることができます。 こんな感じ。 [code lang=”csharp”] protected override Task OnInitializeAsync(IActivatedEventArgs args) { var dispatcher = Window.Current.Dispatcher;<br>var unityContainer = new UnityContainer(); unityContainer.RegisterInstance(new DispatcherService(dispatcher)); unityContainer.RegisterInstance(new MainPageViewModel(unityContainer.Resolve()));<br>Container = unityContainer;<br>return base.OnInitializeAsync(args); } [/code]</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>そもそもバックグランドで生成できないようにする、というアプローチは安全かもしれませんね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UWPメモ その3 ネイティブオブジェクトをデバッグする</title>
      <link href="/2016/04/07/980/"/>
      <url>/2016/04/07/980/</url>
      
        <content type="html"><![CDATA[<p>UWPで時折 (割と頻繁にクラッシュするともいう) 発生するクラッシュ時のメッセージについて</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>アタッチしてデバッグしている際、クイックウォッチやウォッチウィンドウで変数を眺めると、Native Viewというのがありますが、デフォルトの設定では表示できません。 下記のようなやつです (英語版の環境ですが…)。 <a href="../../../../public/2016/04/Error.png"><img src="../../../../public/2016/04/Error-300x100.png" alt="クイック ウォッチ1"></a></p><p>最初は、オプションメニューのデバッグに関連する設定があるかと思いましたがそうではありませんでした。 これの対応策をメモとして残します。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>設定は、<strong>プロジェクトプロパティ</strong>の<strong>デバッグタブ</strong>の<strong>デバッグーの種類</strong>から<strong>マネージのみ</strong>になっている設定を<strong>ネイティブのみ</strong>または<strong>混合 (マネージとネイティブ)</strong> に変更します。 <strong>アプリケーション プロセス</strong>と<strong>バックグラウンド タスク プロセス</strong>の違いですが、バックグラウンド タスク プロセスは、Windows ストア Phone アプリのみとのこと。 なので、アプリケーション プロセス側だけ有効にしておけば大抵は事足りるかと。 <a href="../../../../public/2016/04/Error3.png"><img src="../../../../public/2016/04/Error3-300x150.png" alt="デバッグ設定"></a></p><p>設定完了後、再度例外に遭遇した際、前述のウィンドウが下記のように変化します。 <a href="../../../../public/2016/04/Error2.png"><img src="../../../../public/2016/04/Error2-300x73.png" alt="クイック ウォッチ2"></a></p><p>すばらしい。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>枯れた技術でないため、デバッグの定石や手順が見つかりにくいUWPですが、明示的に設定をしないといけないなら、エラーの説明に、「こうすれば詳細を見れるよ？」みたいなメッセージを含めてくれればいいのに、と思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで顔認識を試してみる Microsoft Cognitive Services Face編 第1回</title>
      <link href="/2016/04/03/957/"/>
      <url>/2016/04/03/957/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-f1">前回</a>は環境構築をしました。</p><a id="more"></a><h1 id="Samle"><a href="#Samle" class="headerlink" title="Samle"></a>Samle</h1><p>Cognitive Servicesを使うにあたりサンプルが<a href="https://github.com/Microsoft/ProjectOxford-ClientSDK">Github</a>で提供されています。 <a href="https://www.codeplex.com/">Codeplex</a>？何ですか？それ？ <a href="https://github.com/Microsoft/ProjectOxford-ClientSDK/tree/master/Face">Face</a>はAndroid、Python、Windows、iOSの4環境が用意されています。 WindowsはWPFです。 <strong>UWP</strong>をプッシュしていたのにWPFとは…. iOSは<strong>Xcode</strong>でした。Xamarinではないのかよ…. <a href="https://github.com/Microsoft/ProjectOxford-ClientSDK/tree/master/Face/Windows/ClientLibrary">ClientLibrary</a>があるので覗いてみると、どうやら既存のNugetで配布されている<a href="https://www.nuget.org/packages/Microsoft.ProjectOxford.Face/">Microsoft Project Oxford Face API</a>を参照している模様。 単純にRESTで要求しているだけのよう。 また、<a href="https://github.com/Microsoft/ProjectOxford-ClientSDK/blob/master/Face/Windows/SampleScreenshots/SampleRunning.png">サンプル画像</a>を見ると、<strong>Detection</strong>、<strong>Find Similar</strong>、<strong>Grouping</strong>、<strong>Identification</strong>、<strong>Verification</strong>のサンプルがあるようです。 Identification、Verificationということは特徴抽出したデータが存在して、それをファイルにできる？ と思ったらそうではなく、Verificationは、登録した顔データをGuidで管理して、2つの顔が同一人物かどうかの判定し、Identificationはグループ群に指定したGuidの顔を探すだけのようです。 うーん、残念。</p><h1 id="Try"><a href="#Try" class="headerlink" title="Try"></a>Try</h1><p>WPFのサンプルをビルドして起動します。 <a href="../../../../public/2016/04/1-2.png"><img src="../../../../public/2016/04/1-2-1024x614.png" alt="スクリーンショット"></a></p><p>起動すると、<strong>Subscription Key</strong>の入力を求められますが、これは前回取得した<a href="https://www.microsoft.com/cognitive-services/en-US/subscriptions">Microsoft Cognitive Services</a>のFaceにおける<strong>Key1</strong>または<strong>Key2</strong>になります。Showでキーをコピーして、TextBoxに貼り付けします。 <a href="../../../../public/2016/04/2-1.png"><img src="../../../../public/2016/04/2-1-1024x540.png" alt="スクリーンショット"></a></p><p>そしてSave Keyボタンを押下します。 ハードディスクにキーが保存されたことが通知されます。 保存先は<strong>System.IO.IsolatedStorage.IsolatedStorageFile</strong>を使っており分離ストレージ内でした。 <a href="../../../../public/2016/04/3-1.png"><img src="../../../../public/2016/04/3-1-300x180.png" alt="スクリーンショット"></a></p><p>その後、Face Detectionを選択しページを切り替えます。 Choose Imageとあるので、画像を選択します。 今回はLive情報マガジン ライブフリーク様より、<a href="http://ticketcamp.net/live-blog/spitz-movie/">スピッツの画像</a>をお借りしました。 私は小学生からのスピッツの大ファンなので。ええ。 <a href="../../../../public/2016/04/4-1.png"><img src="../../../../public/2016/04/4-1-1024x614.png" alt="スクリーンショット"></a></p><p>きちんと、マサムネ、テツヤ、タムタムを認識し、テツヤがサングラスをつけていることも認識しています。 あと、検出した画像の表情も認識しています。以前話題になった。Emotion APIですね。 崎ちゃんは画像が小さすぎたのか検出できませんでした。 なお、年齢推測は全部だめです。2016年4月現在全員48歳なので、18-20ずれています。日本人は若く見えるからダメなのかな？ まぁ、この画像がいつ撮影されたのかがわかりませんが。 別の写真だと… <a href="../../../../public/2016/04/5-1.png"><img src="../../../../public/2016/04/5-1-1024x614.png" alt="スクリーンショット"></a></p><p>マサムネ33歳、テツヤ33歳、タムタム31歳、崎ちゃん40歳。 この画像は公式ファンクラブの壁紙なので割と最近のはず。でも最大17歳の差….</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>ソースを見ましたが使い方は凄い簡単でした。 [code lang=”csharp”] using (var fileStream = File.OpenRead(SelectedFile)) { try { MainWindow mainWindow = Window.GetWindow(this) as MainWindow; string subscriptionKey = mainWindow._scenariosControl.SubscriptionKey;<br>var faceServiceClient = new FaceServiceClient(subscriptionKey); Contract.Face[] faces = await faceServiceClient.DetectAsync(fileStream, false, true, new FaceAttributeType[] { FaceAttributeType.Gender, FaceAttributeType.Age, FaceAttributeType.Smile, FaceAttributeType.Glasses }); [/code] 画像ファイルの<strong>FileStream</strong>を渡してあげるだけのお手軽さです。 なんということでしょう。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>素晴らしいAPIがこんなにも簡単に使えるとは本当に素晴らしいです。Microsoft!!</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> サービス紹介 </category>
          
          <category> 画像処理 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> Azure </category>
          
          <category> Cognitive Services </category>
          
          <category> .NETで顔認識を試してみる </category>
          
          <category> 顔認識 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WPF メモ その1 起動時にアプリがクラッシュする</title>
      <link href="/2016/04/03/974/"/>
      <url>/2016/04/03/974/</url>
      
        <content type="html"><![CDATA[<p>最近開発環境が壊れてきたのか、色々問題がでてきました。買い換えるか初期化して環境を構築し直すか検討している最中の話。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>Windows10だとクラッシュすることなく動くのに、Windows7だと動かない。 でも、VisualStudioからデバッグ起動するとWindows7でも動くという不思議な問題。 例外として下記のメッセージをスローしていました。 [code] System.Windows.Markup.XamlParseException: ‘System.Windows.Window’ のタイプ初期化子が例外をスローしました。 —&gt; System.TypeInitializationException: ‘System.Windows.FrameworkElement’ のタイプ初期化子が例外をスローしました。 —&gt; System.TypeInitializationException: ‘System.Windows.Documents.TextElement’ のタイプ初期化子が例外をスローしました。 —&gt; System.TypeInitializationException: ‘MS.Internal.FontCache.Util’ のタイプ初期化子が例外をスローしました。 —&gt; System.UriFormatException: 無効な URI: URI の形式を決定できませんでした。 場所 System.Uri.CreateThis(String uri, Boolean dontEscape, UriKind uriKind) 場所 System.Uri..ctor(String uriString, UriKind uriKind) 場所 MS.Internal.FontCache.Util..cctor() — 内部例外スタック トレースの終わり — 場所 MS.Internal.FontCache.Util.get_Dpi() 場所 System.Windows.SystemFonts.ConvertFontHeight(Int32 height) 場所 System.Windows.Documents.TextElement..cctor() — 内部例外スタック トレースの終わり — 場所 System.Windows.FrameworkElement..cctor() — 内部例外スタック トレースの終わり — 場所 System.Windows.Window..cctor() — 内部例外スタック トレースの終わり — 場所 System.Windows.Markup.WpfXamlLoader.Load(XamlReader xamlReader, IXamlObjectWriterFactory writerFactory, Boolean skipJournaledProperties, Object rootObject, XamlObjectWriterSettings settings, Uri baseUri) 場所 System.Windows.Markup.WpfXamlLoader.LoadBaml(XamlReader xamlReader, Boolean skipJournaledProperties, Object rootObject, XamlAccessLevel accessLevel, Uri baseUri) 場所 System.Windows.Markup.XamlReader.LoadBaml(Stream stream, ParserContext parserContext, Object parent, Boolean closeStream) 場所 System.Windows.Application.LoadBamlStreamWithSyncInfo(Stream stream, ParserContext pc) 場所 System.Windows.Application.LoadComponent(Uri resourceLocator, Boolean bSkipJournaledProperties) 場所 System.Windows.Application.DoStartup() 場所 System.Windows.Application.&lt;.ctor&gt;b__1_0(Object unused) 場所 System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Int32 numArgs) 場所 System.Windows.Threading.ExceptionWrapper.TryCatchWhen(Object source, Delegate callback, Object args, Int32 numArgs, Delegate catchHandler) 場所 System.Windows.Threading.DispatcherOperation.InvokeImpl() 場所 System.Windows.Threading.DispatcherOperation.InvokeInSecurityContext(Object state) 場所 MS.Internal.CulturePreservingExecutionContext.CallbackWrapper(Object obj) 場所 System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx) 場所 System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx) 場所 System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state) 場所 MS.Internal.CulturePreservingExecutionContext.Run(CulturePreservingExecutionContext executionContext, ContextCallback callback, Object state) 場所 System.Windows.Threading.DispatcherOperation.Invoke() 場所 System.Windows.Threading.Dispatcher.ProcessQueue() 場所 System.Windows.Threading.Dispatcher.WndProcHook(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean&amp; handled) 場所 MS.Win32.HwndWrapper.WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean&amp; handled) 場所 MS.Win32.HwndSubclass.DispatcherCallbackOperation(Object o) 場所 System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Int32 numArgs) 場所 System.Windows.Threading.ExceptionWrapper.TryCatchWhen(Object source, Delegate callback, Object args, Int32 numArgs, Delegate catchHandler) 場所 System.Windows.Threading.Dispatcher.LegacyInvokeImpl(DispatcherPriority priority, TimeSpan timeout, Delegate method, Object args, Int32 numArgs) 場所 MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam) 場所 MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG&amp; msg) 場所 System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame) 場所 System.Windows.Threading.Dispatcher.PushFrame(DispatcherFrame frame) 場所 System.Windows.Application.RunDispatcher(Object ignore) 場所 System.Windows.Application.RunInternal(Window window) 場所 System.Windows.Application.Run(Window window) 場所 System.Windows.Application.Run() 場所 Harvester.WPF.App.Main() 場所 D:\Works\OpenSource\Harvester\Harvester.WPF\obj\Debug\App.g.cs:行 0 [/code]</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p><strong>FontCache</strong>という単語が怪しいのでこれをキーにして検索しました。 そしたら見つかったのが下記のページ。 <a href="http://stackoverflow.com/questions/10094197/wpf-window-throws-typeinitializationexception-at-start-up/10094280#10094280">WPF window throws TypeInitializationException at start up</a> <a href="https://connect.microsoft.com/VisualStudio/feedback/details/618027/uriformatexception-thrown-by-ms-internal-fontcache-util">UriFormatException thrown by MS.Internal.FontCache.Util</a> 要するに、<strong>環境変数windir</strong>がないんじゃね？というもの 事実、環境変数がなくなっていました。／(^o^)＼ﾅﾝﾃｺｯﾀｲ というか、<strong>環境変数PATH</strong>が異常に短い。そういえば、最近setxコマンド使用直後、setxコマンドが使えなくなる現象があったが、これが原因か。 色々調べると環境変数PATHが長すぎるのでは？という話がちらほら。 何かの拍子に、環境変数全体がカットされたのが原因なのだろう。 再起動したら直った。 うーん。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>原因は判明しました。が、その原因を引き起こすトリガーが不明。 もう少し状況を注視します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで顔認識を試してみる Microsoft Cognitive Services Face編 第0回</title>
      <link href="/2016/04/02/931/"/>
      <url>/2016/04/02/931/</url>
      
        <content type="html"><![CDATA[<p><strong>Build 2016</strong>お疲れ様でした。<strong>Xamarin</strong> 無償化など非常に大きな内容が多数ありました。</p><a id="more"></a><h1 id="Microsoft-Cognitive-Servicesとは"><a href="#Microsoft-Cognitive-Servicesとは" class="headerlink" title="Microsoft Cognitive Servicesとは?"></a>Microsoft Cognitive Servicesとは?</h1><p>今回のBuildでの発表に**<a href="https://www.microsoft.com/cognitive-services/">Microsoft Cognitive Services</a>**がありました。 要するに、視覚、聴覚、声といった、人間の自然なコミュニケーション手段による操作を可能にするインテリジェントな22個のAPI群とのこと。 で、個人的に顔認識が一番目を引きました。仕事柄、画像認識や生体認証は一番身近ですので。 調べてみると、Azure上でのサービスとして展開されているようです。ライブラリが提供されるような形ではないのがちょっと残念でした。 私はAzureを使ったことがないので、環境構築も踏まえて勉強していきます。</p><h1 id="環境構築"><a href="#環境構築" class="headerlink" title="環境構築"></a>環境構築</h1><p>Microsoftアカウントはあるものとします。またサインしておきます。 <a href="https://www.microsoft.com/cognitive-services/">Microsoft Cognitive Services</a>に移動します。 <a href="../../../../public/2016/04/1.png"><img src="../../../../public/2016/04/1-1024x540.png" alt="スクリーンショット"></a></p><p><strong>Let’s go</strong>で移動します。 必要なAPIにチェックを入れて、<strong>I agree to the Microsoft Cognitive Services Terms and Mircorosft Privacy Statement</strong> にチェック。そして、<strong>Subscribe</strong>をクリック。 <strong>Contact me with promotional offers and updates about Microsoft Cognitive Services</strong> はチェックは任意です。 <a href="../../../../public/2016/04/2.png"><img src="../../../../public/2016/04/2-1024x540.png" alt="スクリーンショット"></a></p><p><a href="../../../../public/2016/04/3.png"><img src="../../../../public/2016/04/3-1024x540.png" alt="スクリーンショット"></a></p><p>必要なAPIのSubscribeを確認したら<strong>Buy On AzureでAzure</strong>のポータルサイトに移動します。 <a href="../../../../public/2016/04/4.png"><img src="../../../../public/2016/04/4-1024x540.png" alt="スクリーンショット"></a></p><p>移動後、サブスクリプションが存在しない場合は下記の画面になります。 サインアップをクリックします。 <a href="../../../../public/2016/04/5.png"><img src="../../../../public/2016/04/5-1024x540.png" alt="スクリーンショット"></a></p><p>プランを選択します。無料試用版もあるので、それを選択するか、<a href="https://www.visualstudio.com/en-us/products/visual-studio-dev-essentials-vs.aspx">Visual Studio Dev Essentials</a>による25ドルの無料クレジットもあります。 <a href="../../../../public/2016/04/6.png"><img src="../../../../public/2016/04/6-1024x540.png" alt="スクリーンショット"></a></p><p>必要な情報を入力します。 電話の確認も本人確認ですが、これはボットによる悪質な登録を除外する意味もあるでしょう。 また、無料試用版でもクレジットカードが必須です。あくまで本人確認のためです。 <a href="../../../../public/2016/04/7.png"><img src="../../../../public/2016/04/7-1024x540.png" alt="スクリーンショット"></a></p><p>サインアップ完了後、準備が始まります。画面中央のムービーでも見ていてください。 <a href="../../../../public/2016/04/8.png"><img src="../../../../public/2016/04/8-1024x540.png" alt="スクリーンショット"></a></p><p>準備完了。<strong>サービスの管理を開始する</strong>でポータルに戻ります。 しばらくすると、メールで<strong>Azure サブスクリプションの準備が整いました</strong>という件名のメールが来ます。 なお私の場合、一度ポータルをログアウトしました。でないとサブスクリプションが表示されませんでしたので… <a href="../../../../public/2016/04/9.png"><img src="../../../../public/2016/04/9-1024x540.png" alt="スクリーンショット"></a></p><p>ダッシュボードです。 <a href="../../../../public/2016/04/10.png"><img src="../../../../public/2016/04/10-1024x540.png" alt="スクリーンショット"></a></p><p><strong>リソースグループ</strong>をクリックし、<strong>追加ボタン</strong>をクリック。 <a href="../../../../public/2016/04/11.png"><img src="../../../../public/2016/04/11-1024x540.png" alt="スクリーンショット"></a></p><p><strong>Cognitive Services APIs</strong>と入力します。最初の数文字入力で候補が出ます。 <a href="../../../../public/2016/04/12.png"><img src="../../../../public/2016/04/12-1024x540.png" alt="スクリーンショット"></a></p><p><a href="../../../../public/2016/04/13.png"><img src="../../../../public/2016/04/13-1024x540.png" alt="スクリーンショット"></a></p><p>選択し、作成をクリック。 <a href="../../../../public/2016/04/14.png"><img src="../../../../public/2016/04/14-1024x540.png" alt="スクリーンショット"></a></p><p><strong>Account name</strong>は任意の名前です。 <strong>API type</strong>は<strong>Face API</strong>を選択します。 <strong>サブスクリプション</strong>は先ほど作成したサブスクリプションを選択します。 <strong>Resource group</strong>は既存のがなければ新規で作成します。 <strong>場所</strong>は<strong>米国西部</strong>しか選択できませんでした。 <a href="../../../../public/2016/04/15.png"><img src="../../../../public/2016/04/15-1024x540.png" alt="スクリーンショット"></a></p><p><strong>Pricing tier</strong>は<strong>F0 Free</strong>を選択。 20コール/分、30000コール/月の制限ですが、十分でしょう。 <a href="../../../../public/2016/04/16.png"><img src="../../../../public/2016/04/16-1024x540.png" alt="スクリーンショット"></a></p><p><strong>Legal terms</strong>に<strong>I Agree</strong>で同意します。 最後に<strong>作成ボタン</strong>をクリック。 <a href="../../../../public/2016/04/17.png"><img src="../../../../public/2016/04/16-1024x540.png" alt="スクリーンショット"></a></p><p>作成が完了しました。 <a href="../../../../public/2016/04/18.png"><img src="../../../../public/2016/04/16-1024x540.png" alt="スクリーンショット"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>環境の構築が完了しました。 次回は実際にAPIを叩いて顔認識を行います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> サービス紹介 </category>
          
          <category> 画像処理 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> Azure </category>
          
          <category> Cognitive Services </category>
          
          <category> .NETで顔認識を試してみる </category>
          
          <category> 顔認識 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UWP メモ その2 HubSectionが思い通りに行かないので可変Gridで対応</title>
      <link href="/2016/04/02/919/"/>
      <url>/2016/04/02/919/</url>
      
        <content type="html"><![CDATA[<p>UWP、面倒です。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>Hub</strong> というのがあります。 よくModernスタイルを紹介するときにグループ毎にタイルを並べて画面全体をスクロールできるやつ。そのグループが<strong>HubSection</strong>。 で、そのHunSectionですが、<strong>StackPanel</strong>を中に入れて<strong>Orientation</strong>を<strong>Horizontal</strong>にしても、中の子要素が横に並んでくれません。 HubSection自体の<strong>Width</strong>を未指定だろうが、明示的に指定しようが縦になってしまいます。 理由はよくわかりませんでした。 とにかく、仕様として</p><ol><li>グループ単位で可変数の子要素を横に並べる</li><li>グループ内ではスクロールバーは出さない</li></ol><p>を満たす必要がありました。</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>解決策として、<strong>Grid</strong>を可変の子要素に対応させました。 といってもGridを継承するのではなく、UserControl上いGridを載せて、それを依存関係プロパティから操作する感じですが。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>ソースは下記です。 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/UWP1">https://github.com/takuya-takeuchi/Demo/tree/master/UWP1</a> まず、可変対応のGrid。 [code lang=”csharp”] using System.Collections; using System.Collections.Generic; using Windows.UI.Xaml; using Windows.UI.Xaml.Controls;<br>// The User Control item template is documented at <a href="http://go.microsoft.com/fwlink/?LinkId=234236">http://go.microsoft.com/fwlink/?LinkId=234236</a><br>namespace UWP2 { public sealed partial class VariableGrid : UserControl {<br>#region イベント #endregion<br>#region フィールド #endregion<br>#region コンストラクタ public VariableGrid() { this.InitializeComponent(); }<br>#endregion<br>#region プロパティ<br>public static readonly DependencyProperty GridLengthProperty = DependencyProperty.Register( “GridLength”, typeof(double), typeof(VariableGrid), new PropertyMetadata(default(double), GridLengthChanged));<br>public double GridLength { get { return (double)GetValue(GridLengthProperty); } set { SetValue(GridLengthProperty, value); } } private static void GridLengthChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>public static readonly DependencyProperty ItemsSourceProperty = DependencyProperty.Register( “ItemsSource”, typeof(object), typeof(VariableGrid), new PropertyMetadata(default(object), ItemsSourceChanged));<br>public object ItemsSource { get { return (object)GetValue(ItemsSourceProperty); } set { SetValue(ItemsSourceProperty, value); } }<br>private static void ItemsSourceChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>public static readonly DependencyProperty ItemTemplateProperty = DependencyProperty.Register( “ItemTemplate”, typeof(DataTemplate), typeof(VariableGrid), new PropertyMetadata(default(DataTemplate), ItemTemplateChanged));<br>public DataTemplate ItemTemplate { get { return (DataTemplate)GetValue(ItemTemplateProperty); } set { SetValue(ItemTemplateProperty, value); } }<br>private static void ItemTemplateChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>public static readonly DependencyProperty OrientationProperty = DependencyProperty.Register( “Orientation”, typeof(Orientation), typeof(VariableGrid), new PropertyMetadata(default(Orientation), OrientationChanged));<br>public Orientation Orientation { get { return (Orientation)GetValue(OrientationProperty); } set { SetValue(OrientationProperty, value); } }<br>private static void OrientationChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs dependencyPropertyChangedEventArgs) { var control = dependencyObject as VariableGrid; control?.Update(); }<br>#endregion<br>#region メソッド<br>#region プライベート<br>private void Update() { var grid = this._Grid;<br>grid.Children.Clear(); grid.RowDefinitions.Clear(); grid.ColumnDefinitions.Clear();<br>var items = this.ItemsSource as IEnumerable; if (items == null) return;<br>var itemTemplate = this.ItemTemplate; if (itemTemplate == null) return;<br>var rowColumn = 0; var gridLength = this.GridLength;<br>var children = new List<FrameworkElement>(); var orientation = this.Orientation; switch (orientation) { case Orientation.Vertical: foreach (var dataContext in items) { var child = itemTemplate.LoadContent() as FrameworkElement; if (child == null) continue;<br>child.DataContext = dataContext;<br>grid.RowDefinitions.Add(new RowDefinition { Height = new GridLength(gridLength) }); Grid.SetRow(child, rowColumn++);<br>children.Add(child); } break; case Orientation.Horizontal: foreach (var dataContext in items) { var child = itemTemplate.LoadContent() as FrameworkElement; if (child == null) continue;<br>child.DataContext = dataContext;<br>grid.ColumnDefinitions.Add(new ColumnDefinition { Width = new GridLength(gridLength) }); Grid.SetColumn(child, rowColumn++);<br>children.Add(child); } break; }<br>children.ForEach(grid.Children.Add); }<br>#endregion<br>#endregion } } [/code] <strong>GridLength</strong>で一つのセルの幅または高さを指定 <strong>Orientation</strong>でGridが並ぶ方向を指定 <strong>ItemsSource</strong>で並べたいオブジェクトのコレクションを指定 <strong>ItemTemplate</strong>で並べたオブジェクトの見た目のテンプレートを指定 というだけです。 使い方は下記。 [code lang=”xaml”] <Hub> <HubSection Header="1st"> <DataTemplate> &lt;local:VariableGrid GridLength=”400” ItemTemplate=”{StaticResource ItemTemplate}” ItemsSource=”{Binding Images}” Orientation=”Horizontal” /&gt; </DataTemplate> </HubSection> <HubSection Header="2nd"> <DataTemplate> &lt;local:VariableGrid GridLength=”400” ItemTemplate=”{StaticResource ItemTemplate}” ItemsSource=”{Binding Images}” Orientation=”Horizontal” /&gt; </DataTemplate> </HubSection> </Hub> [/code] これを使うとこんな感じになります。<br><a href="../../../../public/2016/04/3aae3db9c67f2d9cbe0292d83ce248f9.png"><img src="../../../../public/2016/04/3aae3db9c67f2d9cbe0292d83ce248f9-1024x626.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まだどういうクラスがあって、適切な使い方が見えてこないので、こんなことしてますが、本当は正しいやり方があるような気がします。 面倒だなぁ</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/UWP1">https://github.com/takuya-takeuchi/Demo/tree/master/UWP1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UWP メモ その1 EventTriggerBehaviorの制約</title>
      <link href="/2016/03/26/806/"/>
      <url>/2016/03/26/806/</url>
      
        <content type="html"><![CDATA[<p>仕事で <strong>UWP</strong> のソフトを開発しています。そもそも <strong>WPF</strong> もそこまで経験ないのに、UWPとか無茶ぶりです。 UWP、というか <strong>WinRT</strong> 使っているとWPFでできたことができないことが多々あります。</p><a id="more"></a><h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p><strong>EventTriggerAction</strong> というのがあります。 XAML側で <strong>ViewModel</strong> で定義されたメソッドをイベントと結び付けたりできます。 で、何が問題、というか結び付ける対象となるイベントに制限があります。 どうも、ルーティングイベント以外を対象にすると、下記のメッセージを含む例外を投げて実行時にクラッシュします。 <strong>System.InvalidOperationException: Adding or removing event handlers dynamically is not supported on WinRT events. at System.Reflection.EventInfo.AddEventHandler(Object target, Delegate handler)</strong> この現象、WPFでは発生しません。</p><h1 id="Debugだけ？"><a href="#Debugだけ？" class="headerlink" title="Debugだけ？"></a>Debugだけ？</h1><p>ところが、不思議なことにReleaseビルドで実行すると、クラッシュはおろか、正しく動作します。 概要は下記のソースをみるとわかるかと。 スクロールバーを動かすと画面下部のTextBlockに乱数の値が表示されます。 <strong>ViewModel (ポータブル クラス ライブラリ)</strong> [code lang=”csharp”] using Microsoft.Practices.Prism.Mvvm;<br>namespace Shared.ViewModels {<br>public sealed class MainWindowViewModel : BindableBase {<br>private string _Text1;<br>public string Text1 { get { return this._Text1; } set { SetProperty(ref this._Text1, value); } }<br>private string _Text2;<br>public string Text2 { get { return this._Text2; } set { SetProperty(ref this._Text2, value); } }<br>public void OnScrollChanged() { var random = new System.Random(); this.Text1 = random.Next(0, 10000).ToString(); this.Text2 = random.Next(0, 10000).ToString(); }<br>}<br>} [/code] <strong>MainWindow.xaml (UWP)</strong> [code lang=”xaml”] <Page x:Class="UWP.MainPage" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:viewModels="using:Shared.ViewModels" xmlns:interactivity="using:Microsoft.Xaml.Interactivity" xmlns:core="using:Microsoft.Xaml.Interactions.Core" mc:Ignorable="d"><br>&lt;Page.DataContext&gt; &lt;viewModels:MainWindowViewModel /&gt; &lt;/Page.DataContext&gt;<br><Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"> &lt;Grid.RowDefinitions&gt; <RowDefinition Height="\*" /> <RowDefinition Height="30" /> <RowDefinition Height="30" /> &lt;/Grid.RowDefinitions&gt; <ScrollViewer x:Name="\_ScrollViewer" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"> <a href="interactivity:Interaction.Behaviors">interactivity:Interaction.Behaviors</a> &lt;core:EventTriggerBehavior EventName=”ViewChanged” SourceObject=”{Binding ElementName=_ScrollViewer}”&gt; &lt;core:CallMethodAction MethodName=”OnScrollChanged” TargetObject=”{Binding}”/&gt; </core:EventTriggerBehavior> &lt;/interactivity:Interaction.Behaviors&gt;<br><Image Source="ms-appx:///Assets/kyoto.jpg" Stretch="None" /> </ScrollViewer> <TextBlock Grid.Row="1" Text="{Binding Text1}" /> <TextBlock Grid.Row="2" Text="{Binding Text2}" /> </Grid> </Page> [/code] <strong>MainWindow.xaml (WPF)</strong> [code lang=”xaml”] <Window x:Class="WPF.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions" xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:viewModels1="clr-namespace:Shared.ViewModels;assembly=Shared" Title="MainWindow" Width="525" Height="350" mc:Ignorable="d"><br>&lt;Window.DataContext&gt; &lt;viewModels1:MainWindowViewModel /&gt; &lt;/Window.DataContext&gt;<br><Grid> &lt;Grid.RowDefinitions&gt; <RowDefinition /> <RowDefinition Height="30" /> <RowDefinition Height="30" /> &lt;/Grid.RowDefinitions&gt; <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"> &lt;i:Interaction.Triggers&gt; &lt;i:EventTrigger EventName=”ScrollChanged”&gt; &lt;ei:CallMethodAction MethodName=”OnScrollChanged” TargetObject=”{Binding}” /&gt; </i:EventTrigger> &lt;/i:Interaction.Triggers&gt; <Image Source="Images/kyoto.jpg" Stretch="None" /> </ScrollViewer> <TextBlock Grid.Row="1" Text="{Binding Text1}" /> <TextBlock Grid.Row="2" Text="{Binding Text2}" /> </Grid> </Window> [/code] <strong>実行画面 (UWP Release Build)</strong> <a href="../../../../public/2016/03/2016-03-26-14.28.51.png"><img src="../../../../public/2016/03/2016-03-26-14.28.51.png" alt="Release ビルド実行画面"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>原因は不明です。 仕方がないので、仕事ではコードビハインドにイベントハンドラを記述しています。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/UWP1">https://github.com/takuya-takeuchi/Demo/tree/master/UWP1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Universal Windows Platform </category>
          
          <category> WinRT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでOneDriveを試してみる 第1回</title>
      <link href="/2016/03/21/597/"/>
      <url>/2016/03/21/597/</url>
      
        <content type="html"><![CDATA[<p><strong><a href="https://products.office.com/ja-jp/office-365-solo">Microsoft Office 365 Solo</a></strong> を契約してるので、1TBの <strong>OneDrive</strong> クラウドストレージの使用権を保持しています。</p><a id="more"></a><p>ということでまた新しい企画。というか <strong>.NETでOneDriveを～</strong> って普通じゃん。 でも、一応私の中のプライベートプロジェクトとしては、色々関連性があるんですね。 そのために、軽く調べているんですが….あまり情報がありません。</p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>私見ですが、Microsoftのストレージ戦略は安定していない印象です。 私は、<strong>Windows Live Folder</strong>と呼ばれていたストレージサービスを使っていたことがありますが、かなりサービスが変わっています。 <a href="http://jz5.jp/2014/02/20/onedrive-history/">jz5.jp様</a> がOneDriveに至るまでの素晴らしい概要図を提供されていますので、参考に。 で、安定していないので、開発者としては注力しづらいんですよね。 当時、SkyDriveのAPIが公開されたときは、開発者が自由にアクセスして自由にファイルを保存できるアプリを作れる、って興奮しましたが、何だか中途半端な感じだったのを覚えています。 例えば、拡張子の制限とか、REST APIとかで、面倒な感じでした。 で、時は移ろい、商標問題とかWindows 8とかで、ブランドを一新したのは記憶に新しいでしょう。 (つい最近、無制限のストレージ仕様を撤回して、顰蹙を買った世間を驚かせたのも。私はそこまで影響はなかったですが。) そんなOndDriveはGitHubでSDKを公開しています。 ここで面白いのは、C#だけでなく、iPhone,Android,Python向けのSDKも同時に公開している点です。 CEOにSatya Nadellaが就任してから、オープンソース戦略を恐ろしいほどの積極さで進めているMicrosoftですが、SDKを自社のエコシステム以外でも使える形で提供しているのは、単にソフトを売る戦略からサービスを使ってもらう戦略に注力し、そのためには開発者の力を使って広くMicrosoftのサービスを知ってもらうほうが得策だと考えたのでしょう。 話がずれましたが、SDKは<a href="https://dev.onedrive.com/sdks.htm">ここ</a>からプラットフォームに応じたGitHubのページに飛べます。</p><h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>C#向けとあって、非常に高いレベルで洗練されたSDKになっています。 従来のSkyDrive APIでREST APIを組み立てていたのが嘘みたいです。 <a href="https://github.com/onedrive/onedrive-sdk-csharp">GitHubのページ</a>の</p><blockquote><p>var drive = await oneDriveClient .Drive .Request() .GetAsync();</p></blockquote><p>を見れば、そのシンプルなAPIがよくわかります。 C#の <strong>async/await構文</strong> も相まって、非同期処理もシンプルにかけます。 では、最初は認証処理から。WPFで作ります。WinFormsは疲れました。 この手のサービスは認証が全てです。その都度認証キーを送るのか、Cookieにトークンを保持して、その手の処理を意識させないのか、等色々あると思いますが。 OndDrive SDKはOAuthを採用したようです。OAuthについては<a href="https://ja.wikipedia.org/wiki/OAuth">Wikipedia</a>を見てね。説明できないから。 今回のサンプルは、<a href="https://github.com/takuya-takeuchi/Demo/tree/master/OnDrive1">ここ</a>にあります。</p><h3 id="1-開発準備"><a href="#1-開発準備" class="headerlink" title="1. 開発準備"></a>1. 開発準備</h3><p>最新のリリースを落としてきます。執筆時点では1.1.20です。対象は.NET 4.5.1以上かつWindows 8.1以上です。 中身の <strong>OneDriveSdk.sln</strong> を Windows7 で開こうとすると、Windows 8.1以上が必要なプロジェクト云々のエラーが出ますし、ビルドはできますが、実行時に、<strong>TargetInvocationException</strong> を吐いて落ちます。 続いて、Nugetパッケージの復元を実行します。OneDriveSDKプロジェクトは <strong>ポータブルクラスライブラリ (PCL)</strong> で作られおり、Nugetパッケージの <strong>Newtonsoft.Json</strong> を使っていますので、これを復元します。 (別のプロジェクトは、<strong>Microsoft.IdentityModel.Clients.ActiveDirectory</strong> とかを使用していますが。同時に復元されます。) 復元完了後、OneDriveSDKプロジェクトをビルドします。ビルド完了後、<strong>OneDriveSdk\bin</strong> 直下の Debug か Release フォルダにOneDriveSdk.dll、Newtonsoft.Json.dllが出力されているので、これを回収しておきます。 次に、SDKを使用するためにアプリケーションの登録を行います。 Twitterとかのクライアントと同じように、サービスを使用するアプリケーションを識別するための情報を取得します。 <a href="http://go.microsoft.com/fwlink/p/?LinkId=193157">Microsoft account Developer Center</a> から登録します。 Microsoft アカウントでログインしてください。 ログイン後、マイアプリケーションの作成、とでるので画面の指示に従ってください。 完了後、<strong>クライアント ID</strong>と<strong>クライアント シークレット</strong> が手に入ります。 これで準備完了です。</p><h3 id="2-実装"><a href="#2-実装" class="headerlink" title="2. 実装"></a>2. 実装</h3><p>認証機能を実装します。 WPFなので、MVVMのサポートライブラリがないと、つらたん、なので<strong>MVVM Light Toolkit</strong>をNugetで参照します。別に<strong>Livet</strong>とかでもいいですよ？この辺はご自由に。 認証時、OneDriveへのサインインが行われるのですが、これは単純にWebBrowserにページを表示させているだけです。 なので、任意のUserControlやWindowに表示させることも可能ですが、WPFでMVVMを意識して実装するとNavigatedイベントとかが超絶面倒なので、認証ダイアログはGitHubのWinFroms実装にある <code>https://github.com/OneDrive/onedrive-sdk-csharp/tree/master/src/OneDriveSdk.WindowsForms/Web</code> をコピーしてきました。 そして実装したのが下記のコードです。 [code lang=”csharp”] private async void ExecuteSingIn() { if (this._OneDriveClient == null) { this._OneDriveClient = OneDriveClient.GetMicrosoftAccountClient( ClientId, ReturnUrl, Scopes, webAuthenticationUi: new FormsWebAuthenticationUi()); }<br>try { if (!this._OneDriveClient.IsAuthenticated) { await this._OneDriveClient.AuthenticateAsync(); }<br>if (this._OneDriveClient.IsAuthenticated) { MessageBox.Show( “Authentication was successful”, “Authentication was successful”, MessageBoxButton.OK); } } catch (OneDriveException exception) { if (!exception.IsMatch(OneDriveErrorCode.AuthenticationCancelled.ToString())) { if (exception.IsMatch(OneDriveErrorCode.AuthenticationFailure.ToString())) { MessageBox.Show( “Authentication failed”, “Authentication failed”, MessageBoxButton.OK);<br>var httpProvider = this._OneDriveClient.HttpProvider as HttpProvider; if (httpProvider != null) { httpProvider.Dispose(); }<br>this._OneDriveClient = null; } else { throw; } } } } [/code] 冒頭の <strong>OneDriveClient.GetMicrosoftAccountClient</strong> で認証の準備を行っています。 最後の引数 <strong>FormsWebAuthenticationUi</strong> は、<strong>Microsoft.OneDrive.Sdk.IWebAuthenticationUi</strong> を実装しており、唯一のメソッド、<strong>Task&lt;Collections.Generic.IDictionary&lt;string, string&gt;&gt; AuthenticateAsync(Uri requestUri, Uri callbackUri)</strong> 内で認証ダイアログを表示させるUI要素を用意しています。 その後、クライアントで認証済みかどうかを判定して、<strong>AuthenticateAsync</strong> メソッドで実際に認証処理を始めます。 <strong>注意</strong> サンプルの <strong>OneDrive1.ViewModels.MainViewModel.ClientId</strong> は空文字になっているので、自身で取得したクライアントIDを設定しください。</p><h3 id="3-実行結果"><a href="#3-実行結果" class="headerlink" title="3. 実行結果"></a>3. 実行結果</h3><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/OnDrive1">サンプルソース</a>を実行した結果は、下記のようになります。 (1) 初期画面 <a href="../../../../public/2015/12/StartWindow.png"><img src="../../../../public/2015/12/StartWindow.png" alt="StartWindow"></a></p><p>(2) アクセス許可画面 <a href="../../../../public/2015/12/AccessAllow.png"><img src="../../../../public/2015/12/AccessAllow.png" alt="AccessAllow"></a></p><p>(3) サインイン画面 <a href="../../../../public/2015/12/Singin.png"><img src="../../../../public/2015/12/Singin.png" alt="Singin"></a></p><p>(4) 認証結果 <a href="../../../../public/2015/12/Result.png"><img src="../../../../public/2015/12/Result.png" alt="Result"></a></p><p>認証処理自体は非常に簡単です (認証画面の用意だけは面倒かもしれませんが…)。 次回はOneDrive内部を閲覧してみたいと思います。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/OneDrive1">https://github.com/takuya-takeuchi/Demo/tree/master/OneDrive1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> OneDrive </category>
          
          <category> .NETでOneDriveを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでディープラーニングを試してみる CNTK編 第1回</title>
      <link href="/2016/03/19/897/"/>
      <url>/2016/03/19/897/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-el">前回</a>は評価データをExcelで可視化しました。今回は.NETから使ってみます。</p><a id="more"></a><h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>CNTKのソースコード自体、現在進行形で進化しています。入手できるバイナリも現時点 (2016/03/18) でも動作しません。 実行は最新ソースを取得してビルドする必要があります。 また、設定ファイルやソースコードもトライアンドエラーで試した結果です。</p><h1 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h1><p>対象データは、MNISTとします。 ネットワークモデルは、<strong>Examples\Image\MNIST</strong> にあります。 ただし、データそのものは、含まれていません。 <a href="http://yann.lecun.com/exdb/mnist/">THE MNIST DATABASE</a> から入手できるのですが、ここから入手しても、CNTKが読み込める形式にはなっていません。 <strong>Examples\Image\MNIST\AdditionalFiles</strong> に、データの入手、変換を行うPython のスクリプトが入っているのですが、Python環境がないと使えません。 ですので、後述のサンプルプログラムにデータを含めておきました。 data\mnist.zip になります。これを解凍してできる、<strong>Train-28x28.txt</strong>、<strong>Test-28x28.txt</strong> を <strong>Examples\Image\MNIST\Data</strong> にコピーします。 次に設定ファイルを変更します。 <strong>Examples\Image\MNIST\Config\01_OneHidden.cntk</strong> を開いて、 [code] deviceId = 0 imageLayout = “cudnn” [/code] を [code] deviceId = -1 imageLayout = “legacy” [/code] に変更します。 [code] # stderr = “$OutputDir$/01_OneHidden_out” [/code] を [code] stderr = “$OutputDir$/01_OneHidden_out” [/code] に変更して学習途中のログを生成することもおすすめしておきます。 以上で準備が完了です。</p><h2 id="ビルド"><a href="#ビルド" class="headerlink" title="ビルド"></a>ビルド</h2><p>最新ソースを取得してビルドします。 個人的には、GPUを使わない方が良いと思います。 ただし、3/18の時点では、<a href="http://wp.me/p7138e-ew">ディープラーニング CNTK 雑談1 動かない api-ms-win-core-path-l1-1-0.dll がない</a> で報告したバグが直っていないので、Windows7で動かすなら、記事を参考にソースを修正してからビルドしてください。</p><h2 id="学習"><a href="#学習" class="headerlink" title="学習"></a>学習</h2><p>ビルド完了後、出来上がるパスをメモします。CNTK.slnがあるディレクトリから見て、<strong>x64\Release_CpuOnly</strong> または <strong>x64\Release_CpuOnly</strong> になると思います。 コマンドプロンプトを開いて、CNTK.slnがあるディレクトリにカレントディレクトリを移動します。 そして、次のコマンドを実行します。 [code lang=”dos”] set PATH=”%CD%\x64\Release_CpuOnly”;%PATH% set CURRENT=%CD% rmdir “Examples\Image\MNIST\Output” /s /q cd “Examples\Image\MNIST\Config” CNTK configFile=01_OneHidden.cntk deviceId=-1 cd %CURRENT% [/code] これでしばらくすると、<strong>Examples\Image\MNIST\Output\Models</strong> に学習済みのモデルファイルが出来上がっているはずです。 ログは、<strong>Examples\Image\MNIST\Output\01_OneHidden_out_MNISTtrain_MNISTtest.log</strong> になります。 さらっとながめてみますと、 [code] Allocating matrices for forward and/or backward propagation. UCIFastReader: Starting at epoch 0, counting lines to determine record count… 10000 records found. starting epoch 0 at record count 0, and file position 0 already there from last epoch RandomOrdering: 1989 retries for 10000 elements (19.9%) to ensure window condition RandomOrdering: recached sequence for seed 0: 2334, 3830, … Minibatch[1-500]: SamplesSeen = 8000 err: ErrorPrediction/Sample = 0.024125 ce: CrossEntropyWithSoftmax/Sample = 0.076922514 Minibatch[501-625]: SamplesSeen = 2000 err: ErrorPrediction/Sample = 0.0155 ce: CrossEntropyWithSoftmax/Sample = 0.060455356 Final Results: Minibatch[1-625]: SamplesSeen = 10000 err: ErrorPrediction/Sample = 0.0224 ce: CrossEntropyWithSoftmax/Sample = 0.073629082 Perplexity = 1.0764075<br>Action “test” complete.<br>COMPLETED [/code] とあり、エラー率2.24%と出ています。まずまずです。</p><h2 id="NETからテスト"><a href="#NETからテスト" class="headerlink" title=".NETからテスト"></a>.NETからテスト</h2><p>テスト自体は、既にログを見るとおりわかっているのですが、これを.NETから可視化します。 実は、.NETのラッパーライブラリ自体は既にサンプル付きでCNTKに含まれています。 <a href="https://github.com/Microsoft/CNTK/tree/master/Source/Extensibility">https://github.com/Microsoft/CNTK/tree/master/Source/Extensibility</a> がそれです。 ソースである、<a href="https://github.com/Microsoft/CNTK/blob/master/Source/Extensibility/CSEvalClient/Program.cs">Program.cs</a>を見ると非常に簡単であることがわかります。 [code lang=”csharp”] using (var model = new IEvaluateModelManagedF()) { // Initialize model evaluator string config = GetFileContents(Path.Combine(Environment.CurrentDirectory, @”..\Config\01_OneHidden.cntk”)); model.Init(config);<br>// Load model string modelFilePath = Path.Combine(Environment.CurrentDirectory, @”..\Output\Models\01_OneHidden”); model.CreateNetwork(string.Format(“deviceId=-1\nmodelPath=\“{0}\“”, modelFilePath));<br>// Generate random input values in the appropriate structure and size var inputs = GetDictionary(“features”, 28*28, 255);<br>// We can call the evaluate method and get back the results (single layer)… outputs = model.Evaluate(inputs, “ol.z”, 10); } [/code] です。 Init関数には、設定ファイルのパスを、CreateNetworkには、コマンドプロンプトで渡す記述を渡すだけです。 ただし、わかりにくいのが、<strong>inputs</strong> と <strong>outputs</strong> です。 inputsは、<strong>System.Collections.Generic.Dictionary&lt;string, System.Collections.Generic.List<float>&gt;</strong> ですが、GetDictionaryで得られる戻り値は、*<em>“features”** というキー、長さ28_28の**System.Collections.Generic.List<float>**の値のペアが一つです。 値の中身は0-255の値がランダムに入っています。 MNISTは28_28なのでそういう条件なのです。 \</em>.cntkにも784という数字が書いてありましたが、まさしくこれです。 <strong>outputs</strong> は、<strong>System.Collections.Generic.List<float></strong> です。 今回は長さ10で、添え字0-9が、MNISTで認識する0-9の数値にそのまま対応しています。 また、各要素の値は、入力データが、添え字に対応する数字のどれに対応するか、という確率を返します。 では、**”features”** と <strong>“ol.z”</strong> は何を意味するのでしょうか？ これは、入力データと出力データを識別するキーになります。 ディープラーニングでは、各レイヤー毎に複数の入出力を持つことが可能です。その入出力を識別するためのキーになります。 <a href="http://caffe.berkeleyvision.org/">Caffe</a> でいう、Bottom (入力)、Top (出力)になります。 では、この定義はどこにあるのか、というと <strong>Examples\Image\MNIST\Config\01_OneHidden.ndl</strong> を見るとわかります。 [code] FeatureNodes = (features) LabelNodes = (labels) CriterionNodes = (ce) EvalNodes = (err) OutputNodes = (ol) [/code] という記述がまさにそれです。 ただし、<strong>ol</strong> だけは、**”.z”** を付与しないと、実行時にエラーを投げてしまいますので、そうしています。 さて、実行するとわかりますが、戻ってくる値には、負数が含まれており、全部の数値を合計しても確率を表すと思われる、1または100になりません。 これは、後述のサンプルソースで含まれるSoftmaxメソッドで確率に変換すること目的を達成できます。 ディープラーニングでは、出力層で得られた結果をSoftmaxで確率に変換することで識別を行います。 説明は<a href="https://en.wikipedia.org/wiki/Softmax_function">Softmax_function</a> でわかりますが、簡単にソースで示すと、 [code lang=”csharp”] private IList<double> Softmax(IList<float> outputs) { var results = new double[outputs.Count];<br>var total = 0d; for (int index = 0, length = results.Length; index &lt; length; index++) { results[index] = Math.Exp(outputs[index]); total += results[index]; }<br>for (int index = 0, length = results.Length; index &lt; length; index++) { results[index] /= total; }<br>return results; } [/code] になります。簡単ですね。</p><h1 id="テストする"><a href="#テストする" class="headerlink" title="テストする"></a>テストする</h1><p>が、先のサンプルは、入力データがランダムな値で全くもって意味がありません。 ですので、MNISTの画像を使って実際にテストしてみたいと思います。 入力画像は28*28の8bit画像です。 これをGUIで実行するのが、 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/CNTK6">https://github.com/takuya-takeuchi/Demo/tree/master/CNTK6</a> になります。 ビルドする際は、<strong>CNTK6\assemblies\CNTK</strong> というフォルダを作って、そこに EvalWrapper.dll をコピーしてください。 また、実行する際は、CNTKで出力される全てのバイナリを実行フォルダにコピーしてください。 実行すると、こんな感じです。 <a href="../../../../public/2016/03/8902e16d1b34c914ec3b34aca8ce52d0.png"><img src="../../../../public/2016/03/8902e16d1b34c914ec3b34aca8ce52d0.png" alt="サンプルアプリ"></a></p><p>下のリストビューに確率がでており、この画像だと6である可能性が一番高いことを示唆しています。 入力画像は8、24、32bitに対応しており、それぞれバイナリに変換します。 ですので、MNIST以外にも使えます。<strong>CIFAR-100</strong> でも利用できます。 (CIFAR-100で最初はテストしていましたが、結果がいまいちなので、MNISTにしまいた。)</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>ついに.NET から利用できるようになりました。 これで利用までの敷居がぐっと下がったような気がします。 アプリへの組み込みも他のディープラーニングのフレームワークに比べて楽になります。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CNTK6/source/CNTK6">https://github.com/takuya-takeuchi/Demo/tree/master/CNTK6/source/CNTK6</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> オープンソース </category>
          
          <category> gpupu </category>
          
          <category> CNTK </category>
          
          <category> .NETでディープラーニングを試してみる </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング CNTK 雑談1 動かない api-ms-win-core-path-l1-1-0.dll がない</title>
      <link href="/2016/03/13/900/"/>
      <url>/2016/03/13/900/</url>
      
        <content type="html"><![CDATA[<p>最新ソース (2016/03/13) を取得したら動かなかったのでその対応。</p><a id="more"></a><h1 id="エラー"><a href="#エラー" class="headerlink" title="エラー"></a>エラー</h1><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p><a href="../../../../public/2016/03/218a3bf5e8a9cba7ec685c06d174ad66.png"><img src="../../../../public/2016/03/218a3bf5e8a9cba7ec685c06d174ad66.png" alt="Missing api-ms-win-core-path-l1-1-0.dll"></a></p><p>DLLがないとのこと。 つい最近まではそんなことなかったのに。</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>調べました。 どうも <strong>api-ms-win-core-path-l1-1-0.dll</strong> は Windows8 のみのdllのよう。 <a href="https://msdn.microsoft.com/ja-jp/library/windows/desktop/dn505783(v=vs.85).aspx">Windows 8 API Sets</a> にありました。 今回は、PathCchRemoveFileSpec関数を使う修正が入ったため、Windows7で動作しなくなったようです。</p><h2 id="修正"><a href="#修正" class="headerlink" title="修正"></a>修正</h2><p>公式の対応を待つべきですが、暫定修正。 <strong>Source/Common/File.cpp</strong> の [code lang=”cpp”] #include #pragma comment(lib, “Pathcch.lib”) #endif [/code] を [code lang=”cpp”] #include &lt;Shlwapi.h&gt; #pragma comment(lib, “Shlwapi.lib”) #endif [/code] に。 [code lang=”cpp”] auto hr = PathCchRemoveFileSpec(&amp;path[0], path.size()); [/code] を [code lang=”cpp”] auto hr = PathRemoveFileSpec(&amp;path[0]); [/code] に。 この2つの修正でエラーが出なくなります。 ただし、修正後の関数は <strong>deprecated</strong> ですし、バッファーオーバーランの危険があります。 あくまで暫定的な修正です。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p><a href="https://github.com/Microsoft/CNTK/issues/224">Issue #224</a> で問題が上がってましたので、コメントしておきました。 公式が直してくれることを期待。 <strong>2016.03.26追記</strong> 私の修正が、<a href="https://github.com/Microsoft/CNTK/pull/237">PullRequest #237</a> としてマージされたため、現在は発生しません。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> gpupu </category>
          
          <category> CNTK </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでGPUPUを試してみる CUDA編 第3回</title>
      <link href="/2016/03/12/740/"/>
      <url>/2016/03/12/740/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-bR">前回</a>はCUDAの性能を改善しましたが、今一歩及ばずというところです。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>ところで、これまで.NETが一度も出てきていないのにこのタイトルは詐欺なんじゃないですかねぇ(震え声)</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="Tread-thread-Thread"><a href="#Tread-thread-Thread" class="headerlink" title="Tread!thread!!Thread!!!"></a>Tread!thread!!Thread!!!</h2><p>前回はスレッドを使って大幅に性能を改善しました。 が、それでもCPUが純粋にシーケンシャルで処理する方が速かったです。 CUDAに対する理解が全く足りていないのでもう少し調べてみます。 前回登場した、<strong>CUDA_C_Programming_Guide.pdf</strong> で、スレッドに関する記述を見てみます。</p><blockquote><p>2.2. Thread Hierarchy For convenience, threadIdx is a 3-component vector, so that threads can be identified using a one-dimensional, two-dimensional, or three-dimensional thread index, forming a one-dimensional, two-dimensional, or three-dimensional block of threads, called a thread block. This provides a natural way to invoke computation across the elements in a domain such as a vector, matrix, or volume.</p></blockquote><p><code>訳: 2.2. スレッドの階層 便利なことに、threadIdxは3成分のベクトルであり、つまりスレッドは1次元、2次元、3次元のスレッドインデックス、で識別することができ、スレッドブロックと呼ばれる1次元、2次元、3次元のスレッドのブロックを形作る。これは、ベクトル、行列、ボリューム (訳注：ここでいうベクトルは、力学のベクトルではなく、配列のような1次元データで、行列は2次元、ボリュームは3次元という意味) のようなドメイン内の要素を横断する計算を実行するための自然な方法を提供する。</code> といっています。 ブロックという単語が出てきました、これは前回でも出てきましたが、流しました。 要するに、スレッドはブロックという単位になっていることです。</p><blockquote><p>The index of a thread and its thread ID relate to each other in a straightforward way: For a one-dimensional block, they are the same; for a two-dimensional block of size $$(D_x, D_y)$$ ,the thread ID of a thread of index $$(x, y)$$ is $$(x + y, D_x)$$; for a three-dimensional block of size $$(D_x, D_y, D_x)$$, the thread ID of a thread of index $$(x, y, x)$$ is $$(x + y D_x + z D_x D_y)$$.</p></blockquote><p><code>訳: スレッドのインデックスとそのスレッドIDは素直なやり方で互いに関連している。1次元のブロックではそれらは同一であり、2次元のブロックのサイズ (Dx, Dy)、スレッドのインデックス (x, y) のスレッドIDは (x + y, Dx); 3次元のブロックのサイズ (Dx, Dy, Dx)、スレッドのインデックス (x, y, z) のスレッドIDは (x + y Dx + z Dx Dy)である。</code> つまるところ、各ブロックにスレッドが存在するっていってます。</p><blockquote><p>There is a limit to the number of threads per block, since all threads of a block are expected to reside on the same processor core and must share the limited memory resources of that core. On current GPUs, a thread block may contain up to 1024 threads. However, a kernel can be executed by multiple equally-shaped thread blocks, so that the total number of threads is equal to the number of threads per block times the number of blocks. Blocks are organized into a one-dimensional, two-dimensional, or three-dimensional grid of thread blocks as illustrated by Figure 6. The number of thread blocks in a grid is usually dictated by the size of the data being processed or the number of processors in the system, which it can greatly exceed. <a href="../../../../public/2015/12/Figure6.png"><img src="../../../../public/2015/12/Figure6-300x254.png" alt="Figure6"></a></p></blockquote><p><code>訳: 1ブロック毎のスレッド数には制限があり、一つのブロックの全スレッドは、プロセッサーコアから予測でき、コアの制限されたメモリリソースを共有しなくてはならない。現在のGPUにて、スレッドブロックは1024スレッドまで内包するかもしれない。しかし、カーネルは複数の同一形状のスレッドブロックで実行され、ゆえにスレッドの合計数はブロックの個数と1ブロックあたりのスレッドの個数の積になる。 ブロックは、Figure 6で図示された、スレッドブロックの1次元、2次元、3次元のグリッドを形作る。1つのグリッド内におけるスレッドブロックの数は通常、処理されるデータのサイズまたはシステムのプロセッサー数から規定される。(訳注：最後のwhichはどこにかかっているのかわかりませんでしたので、最後のwhich以降は無視します)</code></p><p><strong>スレッドの合計数はブロックの個数と1ブロックあたりのスレッドの個数の積</strong></p><p>なんか凄いこと書いてあります。 ってか、前回書いた記事で1ブロックあたり最大512スレッド、って書きましたけど、あれは間違い？ 当時のCUDA搭載GPUの最大値なのか？ とりあえず、自分のGPU性能を詳しく知りたい。 <a href="http://www.gdep.jp/page/view/250">第3回　CUDA4.0のインストール</a>によれば、<strong>deviceQuery.exe</strong> というプログラムが性能を詳しく教えてくれるとのこと。 これはCUDA Toolkitインストール時にコピーされており、デフォルトは。<strong>C:\ProgramData\NVIDIA Corporation\CUDA Samples\v7.5\1_Utilities\deviceQuery</strong> に入っていると。 とりあえず、自分でビルドして実行 <a href="../../../../public/2015/12/deviceQuery.png"><img src="../../../../public/2015/12/deviceQuery-204x300.png" alt="deviceQuery"></a></p><p>結果として、1プロセッサーあたり1536スレッド、1ブロックあたり最大1024スレッド起動できることがわかりました。最大1536スレッドでしょぼくない？と思ったら、上に <strong>(4) Multiprocessors</strong> ってあるので、全部で1536*4=6144スレッドってこと？ とりあえず可能な限りスレッドを活用するべくコードを修正。 また、スレッド数を活用できるようなカーネルに内容を変更します。 サンプルコードはページの末尾を参照。 変更点は</p><ul><li>ベクトルの和の計算を行列乗算の計算に変更。1000x1000の行列なので$$1000^3$$ の計算</li><li>スレッド数指定</li></ul><p>[code lang=”cpp”] const int SIZE = 32; const int MATRIX_SIZE = 1000;<br>cudaError_t addWithCuda(float *c, const float *a, const float *b);<br>__global__ void addKernel(float *c, const float *a, const float *b) { int row = blockIdx.y * blockDim.y + threadIdx.y; int col = blockIdx.x * blockDim.x + threadIdx.x;<br>if (row &lt; MATRIX_SIZE &amp;&amp; col &lt; MATRIX_SIZE) { auto v = 0.f; for (auto x = 0; x &lt; MATRIX_SIZE; x++) { v += a[row * MATRIX_SIZE + x] * b[x * MATRIX_SIZE + col]; }<br>c[row * MATRIX_SIZE + col] = v; } } [/code] こんな感じ。 ホスト側は省略。 結果は [code lang=”sh”] threadsPerBlock.X =32, threadsPerBlock.y = 32 numBlocks.X =32, numBlocks.y = 32 CUDA is time = {117} No CUDA is time = {7076} [/code] やりました。60倍のパフォーマンスをたたき出しています。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>そもそもの原因として、CUDAの得意領域に持ち込んでいなかったのが問題でした。 如何にスレッドを有効活用するか、というところに主眼をおいて実装を進める必要があります。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CUDA3">https://github.com/takuya-takeuchi/Demo/tree/master/CUDA3</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> gpupu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング CNTK その5 評価の可視化</title>
      <link href="/2016/03/06/889/"/>
      <url>/2016/03/06/889/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ee">前回</a>は自分でデータの学習 (train) と評価 (test) を実行しました。今回は結果を検証してみます。</p><a id="more"></a><h1 id="可視化"><a href="#可視化" class="headerlink" title="可視化"></a>可視化</h1><h2 id="write"><a href="#write" class="headerlink" title="write"></a>write</h2><p><a href="http://wp.me/p7138e-dY">前々回</a>の設定説明の際、CNTKが対応しているタスクまたはアクションに、ノードをファイルへ書き出す write があることを説明しました。 これを使ってテスト結果を可視化します。</p><h2 id="設定ファイルの追加"><a href="#設定ファイルの追加" class="headerlink" title="設定ファイルの追加"></a>設定ファイルの追加</h2><p>既存の設定ファイルに追加する形でも良いですが、そうすると、学習、テストのたびにファイル書き出しが実行されてしまいます。 別に大した負荷でもないですが、あえて別にします。 まず、前回使った <strong>01_Conv.cntk</strong> をコピーして、<strong>02_Eval.cntk</strong> とでも名前を変えます。 次に、<strong>Test</strong> コマンド全体をコピーして、<strong>Eval</strong> コマンドに名前を変えます。名前は任意です。 そして、<strong>Train</strong> コマンド、<strong>Test</strong> コマンド全体を削除します。 これで残るのはEvalコマンドだけになります。 次は、<strong>command=Train:Test</strong> となっている個所を、<strong>command=Eval</strong> に変更します。 そして、Evalコマンド内の <strong>action</strong> を <strong>write</strong> に変更します。 最後に、actionと同じ位置に <strong>outputPath = “$OutputDir$/Eval.txt”</strong> と追加します。 これがないと <strong>write command: You must specify either ‘writer’or ‘outputPath’</strong> というエラーを吐きますので。</p><h1 id="検証"><a href="#検証" class="headerlink" title="検証"></a>検証</h1><p>前回と同じディレクトリ <strong>(Examples\Image\Miscellaneous\CIFAR-100)</strong> から、下記のコマンドをたたきます。 コマンドプロンプトを再起動していないのでしたら、最初の一行目は無視できます。 前回TrainとTestを実行済みで <strong>Output</strong> フォルダに <strong>Models</strong> が出力されているものとします。 [code lang=”dos”] set PATH=”..\..\..\..\Release”;%PATH% cntk configFile=02_Eval.cntk deviceId=0 [/code] これで、Outputフォルダ直下に <strong>01_Conv_Eval.log</strong> と <strong>Eval.txt.OutputNodes.z</strong> が出力されます。 前者は、*.cntkファイルで指定した stderr で指定したファイル名のポストフィックスに実行したコマンド名を付与したファイルです。 今回はcommandでEvalを実行したのでこうなりました。これがあれば、コマンドプロンプトでわざわざリダイレクトする必要はありません。 後者は、今回の目的である可視化された評価結果です。outputPathで指定したものです。 内容は、与えられた入力が、各出力 (つまり100個の出口) で評価された場合、どの程度、その出口に近いか、つまり今回であれば、そのラベルに近いかを数値で表します。 数値が大きいほど、そのラベルである確率が高いです。いわゆる確信度です。 下記はExcelで集計した結果です。Eval.txt.OutputNodes.zが半角スペースで区切られているので、これをタブに変換してからExcelに張り付けています。 <a href="../../../../public/2016/02/result.png"><img src="../../../../public/2016/02/result-1024x618.png" alt="評価結果"></a></p><p>前回のエラー率と同じ数値が出ています。 集計は、横軸からラベル番号 (0-99) を算出するために、最大値を <strong>MATCH 関数の結果 - 1</strong> を使って探してラベル番号を計算しています。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>評価もできるようになりました。 できれば、次は .NET から利用したりしたいです。 例えば、一枚の画像を指定して与えると、それの評価を出してくれる、みたいなやつ。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> gpupu </category>
          
          <category> CNTK </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング CNTK その4 自分で学習</title>
      <link href="/2016/03/03/882/"/>
      <url>/2016/03/03/882/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-dY">前回</a>は軽くCNTKの設定の仕方について説明しました。今回は自分で学習させてみます。</p><a id="more"></a><h1 id="データの準備"><a href="#データの準備" class="headerlink" title="データの準備"></a>データの準備</h1><h2 id="CIFAR-100"><a href="#CIFAR-100" class="headerlink" title="CIFAR-100"></a>CIFAR-100</h2><p>CIFAR-100というデータを用意します。 データは<a href="https://www.cs.toronto.edu/~kriz/cifar.html">ここ</a>から入手できます。 ページ下の <strong>CIFAR-100 binary version (suitable for C programs)</strong> からダウンロードできます。 このデータを用意したのはCaffeを説明した際に少しだけ名前が出てきた <strong>ALXENET</strong> の考案者である <strong>Alex Krizhevsky氏</strong> です。感謝です。 CIFAR-10やMNISTをテストしているブログは多いですが、CIFAR-100をテストしている人は少ないので、これを選びました。 また、CNTKにもCIFAR-10しかないので、これを選んだのが理由です。 まずは、ダウンロードしたデータから教師データを作成します。</p><h2 id="教師データ作成-画像編"><a href="#教師データ作成-画像編" class="headerlink" title="教師データ作成 画像編"></a>教師データ作成 画像編</h2><p>結論から言いますと、ダウンロードしたデータはそのままでは使うことができません。 CIFAR-100のデータも画像そのもの、というわけではありません。 まず教師データである画像データは test.binとtrain.binにバイナリで含まれています。 binデータは [code] &lt;1 x coarse label&gt;&lt;1 x fine label&gt;&lt;3072 x pixel&gt; … &lt;1 x coarse label&gt;&lt;1 x fine label&gt;&lt;3072 x pixel&gt; [/code] という順でバイナリに含まれています。 つまり1ファイル3074バイトです。 coarse labelは、雑なラベル付けで、「魚」、「昆虫」とかいう大雑把なラベルです。 fine labelは、もっと詳細なラベル付けで、「鮫」、「蝶」とかいう具体的なラベルです。 0から始まる整数値でそれぞれ、coarse_label_names.txt、fine_label_names.txtの先頭の行番号-1と対応します。 ここで注意するのが、画像領域の3072バイトが、先頭1024バイトに赤、次の1024バイトに緑、残りに青の画素が含まれています。 これをBGRの順で1ピクセルずつ格納しなおす必要があります。 つまり [code lang=”csharp”] // dst は出力先のビットマップ領域 // src は入力元の3072バイト領域 for (var index = 0; index &lt; 1024; index++) { dst[index * 3 + 2] = src[1024 * 0 + index]; dst[index * 3 + 1] = src[1024 * 1 + index]; dst[index * 3 + 0] = src[1024 * 2 + index]; } [/code] こういう感じです。 これに直してビットマップで出力すると、Windowsで表示できます。 例えば、test.binの最初のデータは [code] 10 49 199 196… [/code] となっています。これを画像にすると、large_natural_outdoor_scenes(10+1=11行目)のmountain(49+1=50行目)なので、 <a href="../../../../public/2016/02/moutain.png"><img src="../../../../public/2016/02/moutain.png" alt="山"></a></p><p>になります (実際は32x32ですが、8倍に拡大してあります)。 では、画像には変換できましたが、これをCNTKが理解できる形式にする必要があります。 前回の章で説明した<strong>Reader Block</strong>で指定できる形式ですので、<strong>UCIFastReader</strong>で読み込める形式です。 これは、CSVと同じで、タブでバイトを1つずつ区切ります。一つの画像が終わったら改行します。 注意するのは改行コードですが、CR+LFにします。 左から順に、coarse label、fine label、1画素目の青、1画素目の緑、1画素目の赤、2画素目の青とつなげていきます。 ですので、下記のようになります [code] 10\t49\t249\t215… [/code] 以上の変換を自動で実行するプログラムを作りました。 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/CNTK4">https://github.com/takuya-takeuchi/Demo/tree/master/CNTK4</a> coarse_label_names.txt、fine_label_names.txt、test.bin、train.binと同一のフォルダで <strong>CNTK4.exe</strong> を、実行すると、下記のファイルとフォルダを出力します。</p><ul><li>test.txt : テスト用のデータ</li><li>train.txt : 学習用のデータ</li><li>test : テスト用の画像データをラベルごとにフォルダわけしてBmpにしたもの</li><li>train : 学習用の画像データをラベルごとにフォルダわけしてBmpにしたもの</li><li>train_Label.txt : 学習用データのラベルのリスト</li><li>test_Label.txt : テスト用データのラベルのリスト</li></ul><h2 id="教師データ作成-ラベル編"><a href="#教師データ作成-ラベル編" class="headerlink" title="教師データ作成 ラベル編"></a>教師データ作成 ラベル編</h2><p>次はラベルです。 CNTKはラベルを文字として受けるとことができません。 ですので、fine_label_names.txt等をそのままラベルとして使うことができません。 今回はfine_label_names.txtをラベルとして使いますので、このファイルを上書きするか別のファイルに0から99の値を1行ごとに改行したテキストファイルを作成します。 改行コードですが、CR+LFにします。 [code] 0 1 2 3 4 5 6 7 8 .. [/code] こんな感じです。</p><h2 id="設定ファイルデータ作成"><a href="#設定ファイルデータ作成" class="headerlink" title="設定ファイルデータ作成"></a>設定ファイルデータ作成</h2><p>流石に設定ファイルは1から作るのは厳しいので、<strong>\CNTK\Examples\Image\Miscellaneous\CIFAR-10</strong> を改造します。CIFAR-10フォルダから下記のファイルをコピーして、どこか別のフォルダに移動します。 <strong>01_Conv.cntk 01_Convolution.ndl Macros.ndl</strong> ここでは、<strong>\CNTK\Examples\Image\Miscellaneous\CIFAR-100</strong>にコピーしました。 まず、01_Conv.cntkを修正します。</p><ol><li>Train.reader.features.start、Test.reader.features.startを <strong>2</strong> に修正</li><li>Train.reader.labels.start、Test.reader.labels.startを <strong>1</strong> に修正</li><li>Train.reader.labels.labelDim、Test.reader.labels.labelDimを <strong>100</strong> に修正</li><li>Train.reader.labels.labelMappingFile、Test.reader.labels.labelMappingFileを <strong>$DataDir$/fine_label_names.txt</strong> に修正</li></ol><p>Train.reader.labels.start値は、それぞれ、test.txt、train.txtの各行の左から何列目かを表しています。0基準で、今回はfine_labelを使うので、1になったというわけです。 Train.reader.features.start値も同様です。 labelDimはラベルの個数です。fine_labelは100個のラベルですので、100と入力します。 labelMappingFileは先ほど、0-99を入力したファイルを指定します。中止するのは、フルパスで入力してもよいですが、今回は、すべてのファイルが同一ディレクトリにある前提ですので、上のように直します。 次は、01_Convolution.ndlです。</p><ol><li>ndlMnistMacros.LabelDimを <strong>100</strong> に修正</li></ol><p>これだけです。 以上で終了です。 Macros.ndlは修正しませんが、ないと動かないと思います。</p><h1 id="学習！"><a href="#学習！" class="headerlink" title="学習！"></a>学習！</h1><p><strong>CNTK\Examples\Image\Miscellaneous\CIFAR-100</strong>フォルダに、教師データ作成の段で出力されたファイルと修正したラベルファイルをコピーします。 現時点で、 <strong>01_Conv.cntk 01_Convolution.ndl fine_label_names.txt Macros.ndl test.txt train.txt</strong> が存在します。 いよいよ実行します。 コマンドプロンプトで、CNTK.slnのあるディレクトリから [code lang=”dos”] set PATH=”%CD%\Release”;%PATH% cd Examples\Image\Miscellaneous\CIFAR-100 CNTK configFile=01_Conv.cntk deviceId=0 1&gt; out.txt 2&gt;&amp;1 [/code] のようにたたきます。 しばらく待つと <strong>CNTK\Examples\Image\Miscellaneous\CIFAR-100\Output\01_Conv_Train_Test.log</strong> に結果が出力されます。 エラーがなければ末尾に <strong>COMPLETED</strong> と表示されます。 GPUを指定しましたが、私の環境で9分強かかりました。 また、学習済みモデルが <strong>CNTK\Examples\Image\Miscellaneous\CIFAR-100\Output\Models</strong> に結果が出力されます。</p><h1 id="ところがどっこい"><a href="#ところがどっこい" class="headerlink" title="ところがどっこい"></a>ところがどっこい</h1><h2 id="エラー-0"><a href="#エラー-0" class="headerlink" title="エラー 0"></a>エラー 0</h2><p>出力のログを見ると、末尾にエラー率等の情報が出ます。 ですが、なぜか0。 [code lang=”dos”] Minibatch[1-500]: Samples Seen = 8000 err: ErrorPrediction/Sample = 0 ce: CrossEntropyWithSoftmax/Sample = 0 Minibatch[501-625]: Samples Seen = 2000 err: ErrorPrediction/Sample = 0 ce: CrossEntropyWithSoftmax/Sample = 0 Final Results: Minibatch[1-625]: Samples Seen = 10000 err: ErrorPrediction/Sample = 0 ce: CrossEntropyWithSoftmax/Sample = 0 Perplexity = 1 COMPLETED [/code] どう考えてもありえません。 100%の認識率などあり得ません。 なので、ネットワーク設定がおかしいのか？と思いいろいろ見直しました。 それでもわからない。 結論から言えば、GitHubでコンパイル済みのバイナリを使ったらうまくいきました。 下記はその結果です。 [code lang=”dos”] Allocating matrices for forward and/or backward propagation. UCIFastReader: Starting at epoch 0, counting lines to determine record count… 10000 records found. starting epoch 0 at record count 0, and file position 0 already there from last epoch RandomOrdering: 1989 retries for 10000 elements (19.9%) to ensure window condition RandomOrdering: recached sequence for seed 0: 2334, 3830, … Minibatch[1-500]: Samples Seen = 8000 Err: ErrorPrediction/Sample = 0.58 CE: CrossEntropyWithSoftmax/Sample = 2.2598516 Minibatch[501-625]: Samples Seen = 2000 Err: ErrorPrediction/Sample = 0.5805 CE: CrossEntropyWithSoftmax/Sample = 2.2639628 Final Results: Minibatch[1-625]: Samples Seen = 10000 Err: ErrorPrediction/Sample = 0.5801 CE: CrossEntropyWithSoftmax/Sample = 2.2606739 Perplexity = 9.5895492 COMPLETED [/code] エラー率58%。よくないですが、まぁこんなものでしょう。 なぜこうなったし。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>ついに自分で学習できました。 が、ビルドしたものがおかしいという悲劇。CUDA 7.5をつかったのがダメだったのか？ 次回はお待ちかねの評価を実施します。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CNTK4">https://github.com/takuya-takeuchi/Demo/tree/master/CNTK4</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> gpupu </category>
          
          <category> CNTK </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング CNTK その3 説明</title>
      <link href="/2016/02/29/866/"/>
      <url>/2016/02/29/866/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-dT">前回</a>はCNTK付属のサンプルを使って、テストをしてみました。今回は、CNTKを自分で使うための説明です。基本公式ページの訳ですが、日本語に直したほうがわかりやすいので。</p><a id="more"></a><h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><h2 id="前書き"><a href="#前書き" class="headerlink" title="前書き"></a>前書き</h2><p>このページは <a href="https://github.com/Microsoft/CNTK/wiki/CNTK-usage-overview">CNTK usage overview</a> を訳しただけのページです。 ですので、訳がおかしかったり間違いがあるかもしれません。 それによって生じた損害は私は負えません。あしからず。</p><h2 id="CNTK-usage-overview-CNTK-使い方-概要"><a href="#CNTK-usage-overview-CNTK-使い方-概要" class="headerlink" title="CNTK usage overview (CNTK 使い方 概要)"></a>CNTK usage overview (CNTK 使い方 概要)</h2><blockquote><p>To use CNTK you need to either download the executable binaries or download the source code and compile it on your machine (details). There are three main tasks (or actions) that are supported by CNTK:</p><ul><li><strong>Train</strong> - Define a network and train it to produce a trained model using training data</li><li><strong>Evaluate</strong> - Test a trained model to assess its performance using test data</li><li><strong>Deploy</strong> - Use a trained model, e.g. in your own solution, to classify new instances</li></ul><p>A brief overview for each of these tasks is given below and pointers to a more detailed description are provided. In addition there are other tasks that CNTK supports such as <strong>edit</strong> existing models and <strong>write</strong> node outputs to a file. A description of these is provided in the Advanced Topics section on the Top-level commands page.</p></blockquote><h4 id="訳："><a href="#訳：" class="headerlink" title="訳："></a>訳：</h4><p>CNTKを使うためには、実行可能バイナリのダウンロードまたはソースコードのダウンロードとマシン上でのコンパイルが必要である。CNTKは3つの主要なタスク (またはアクション) をサポートしている。</p><ul><li><strong>学習</strong> - ネットワークの定義、そして教師データを用いて学習済みモデルを生成するための学習</li><li><strong>評価</strong> - テストデータ用いて性能を査定するために学習済みモデルをテストすること</li><li><strong>デプロイ</strong> - 学習済みモデルを使用すること。例えば、自身のソリューションにおいて、新しいインスタンスを分類すること</li></ul><p>各タスクの詳しい概要については下記に示してあり、より詳細な説明がポインタ (訳注：おそらくリンク) で提供している。それに加えて、CNTKは既存のモデルの<strong>編集</strong>とノードをファイルへ出力する<strong>書き出し</strong>をサポートしている。これらの詳細はトップレベルコマンドページの高度なトピックスで提供している。</p><h2 id="Training-a-model-using-CNTK-CNTKでモデルの学習"><a href="#Training-a-model-using-CNTK-CNTKでモデルの学習" class="headerlink" title="Training a model using CNTK (CNTKでモデルの学習)"></a>Training a model using CNTK (CNTKでモデルの学習)</h2><blockquote><p>In the following we use the CNTK configuration and results from the MNIST example, in particular the configuration ‘01_OneHidden.cntk’ (see Image/MNIST and 01_OneHidden.cntk for full details). To train a model using CNTK you need to provide a configuration file as the first argument when calling the CNTK executable, cntk configFile=01_OneHidden.cntk in our example (see also Config file overview for more details on config files). The following snippet provides an overview of the config file contents that are relevant for training. [code] ModelDir = “$OutputDir$/Models” deviceId = 0 command = MNISTtrain<br>modelPath = “$ModelDir$/01_OneHidden”<br>MNISTtrain = [ action = “train”<br>NDLNetworkBuilder = [ networkDescription = “$ConfigDir$/01_OneHidden.ndl” ]<br>SGD = [ … ]<br>reader = [ readerType = “UCIFastReader” file = “$DataDir$/Train-28x28.txt” … ] ] [/code] The above code snippet defines a command called MNISTtrain with action = “train”. Other supported actions are for example test or write. The deviceId parameter specifies whether to use CPU or GPU. When set to auto CNTK picks the best available device. Set it to -1 to use the CPU or to a value &gt;=0 to use a specific GPU. The modelPath defines where to store the intermediate and final trained models. In this example it uses the ModelDir variable defined at the beginning of the configuration file. The three main configuration blocks for training define the network itself and the parameters for the training algorithm and the data reader.</p><ul><li>Network builder - here you define the topology and the details of the network such as the size and number of layers and the type of nodes. You can use the Simple Network Builder or the NDL Network Builder. Please refer to the corresponding Wiki pages for details.</li><li>SGD - this block lets you parameterize the training algorithm (stochastic gradient descent). Options include using momentum, adaptive learning rate, adaptive minibatch size or parallel training. See SGD block for more details.</li><li>reader - the reader block defines which reader to use and where the corresponding input files are. CNTK provides several data readers for different formats and tasks (see Reader block).</li></ul><p>Finally, the line command = “MNISTtrain” specifies which of the defined tasks to execute. To execute several tasks consecutively, e.g. training and evaluation, simply add more tasks to the command separated by a colon: command = “MNISTtrain:MNISTtest”</p></blockquote><h4 id="訳：-1"><a href="#訳：-1" class="headerlink" title="訳："></a>訳：</h4><p>下記に、CNTKで使用する設定とMNIST (訳注：Mixed National Institute of Standards and Technology、つまりアメリカ国立標準技術研究所がミックスしたもの) のサンプルの結果、特に 01_OneHidden.cntk (詳細は<a href="https://github.com/Microsoft/CNTK/blob/master/Examples/Image/MNIST/README.md">Image/MNIST</a> と <a href="https://github.com/Microsoft/CNTK/blob/master/Examples/Image/MNIST/Config/01_OneHidden.cntk">01_OneHidden.cntk</a> を) を示す。 CNTKでモデルを学習するために、CNTK実行ファイルを呼び出すとき;cntk configFile=01_OneHidden.cntk に渡した第一引数である設定ファイルを渡す必要がある。下記のスニペットで、トレーニングための正しい設定ファイルの内容の概要を示す。 (訳注：ここのコードは原文にあるので省略) 上のコードスニペットは action = “train” を備えた MNISTTrain と呼ばれるコマンドを定義している。ほかのコマンド、例えば test または write もサポートしています。 deviceId パラメータはCPUまたはGPUを使うかどうかを指定します。auto をセットした時は CNTK が利用可能な最適なデバイスを採用します。-1 をセットすると、CPU を使用し、0 以上の値を設定することで GPU を使います。modelPath は中間、最終学習済みモデルの保存先を定義します。サンプルでは、設定ファイルの先頭で定義されている ModelDir 変数を使っています。 学習のための主な3つの設定ブロックは、ネットワークの定義、学習アルゴリズムのためのパラメータとデータリーダーを定義します。</p><ul><li>ネットワークビルダー - ここは、トポロジーと、サイズやレイヤーの枚数のようなネットワークの詳細と、ノードの種別を定義します。<a href="https://github.com/Microsoft/CNTK/wiki/Simple-Network-Builder">Simple Network Builder</a> または <a href="https://github.com/Microsoft/CNTK/wiki/NDL-Network-Builder">NDL Network Builder</a> を使うことができます。詳細は対応する Wiki ページを。</li><li>SGD - このブロックは学習アルゴリズム (stochastic gradient descent : 確率的勾配降下法) をパラメータ化させます。オプションはモメンタム、適応的学習率、適応的ミニバッチサイズ、または並列学習です。詳細は <a href="https://github.com/Microsoft/CNTK/wiki/SGD-block">SGD bock</a> を。</li><li>リーダー - リーダーブロックは、どのリーダーを使用するか、対応する入力ファイルがどこにあるかを定義します。CNTKは、異なるフォーマットとタスクのために、いくつかのデータリーダーを提供しています。(詳細は <a href="https://github.com/Microsoft/CNTK/wiki/Reader-block">Reader block</a>).</li></ul><p>最後に、command = “MNISTtrain” 行は、実行する定義済みのタスクを指定します。連続していくつかのテスクを実行するためには、例えば、学習と評価の場合、単純に以降のタスクを “;” で区切って、コマンドに追加します。command = “MNISTtrain:MNISTtest”。</p><h2 id="Evaluating-a-trained-model-学習済みモデルの評価"><a href="#Evaluating-a-trained-model-学習済みモデルの評価" class="headerlink" title="Evaluating a trained model (学習済みモデルの評価)"></a>Evaluating a trained model (学習済みモデルの評価)</h2><blockquote><p>To evaluate a trained model you can use the eval or test command (see also Train, Test, Eval for full details). The corresponding configuration in the MNIST 01_OneHidden.cntk example looks as follows. [code] MNISTtest = [ action = “test” minibatchSize = 16<br>reader = [ readerType = “UCIFastReader” file = “$DataDir$/Test-28x28.txt” … ] ] [/code] The MNISTtest block uses action = “test”. For the test action you need to define a model that should be used for testing using the modelPath parameter. In this example the modelPath is not defined inside the MNISTtest block but on the top level (see training part above) and is used by both the train and test actions. Inside the reader block you specify the data file that should be used for testing, Test-28x28.txt in the example. Finally, you have to set command = MNISTtest and run cntk configFile=01_OneHidden.cntk to execute the testing. The result on the command line is: [code lang=”sh”] Final Results: Minibatch[1-625]: Samples Seen = 10000 err: ErrorPrediction/Sample = 0.0239 ce: CrossEntropyWithSoftmax/Sample = 0.076812531 Perplexity = 1.0798396 COMPLETED [/code]</p></blockquote><h4 id="訳：-2"><a href="#訳：-2" class="headerlink" title="訳："></a>訳：</h4><p>学習済みモデルを評価するために、evalまたはtestコマンドを使うことができます。(詳細は <a href="https://github.com/Microsoft/CNTK/wiki/Train%2C-Test%2C-Eval">Train, Test, Eval</a>)。下記のMNIST <a href="https://github.com/Microsoft/CNTK/blob/master/Examples/Image/MNIST/Config/01_OneHidden.cntk">01_OneHidden.cntk</a> サンプル内の対応する設定を見ます。 (訳注：ここのコードは原文にあるので省略) MNISTtest ブロックでは、action = “test” を使います。test アクションでは、modelPath パラメータを使ってテストのために使用するモデルを定義する必要があります。このサンプルで、modelPath はMNISTTest ブロック内ではなくトップレベルで定義され (Training a model using CNTK を見てください)、trainとtestコマンドの両方が使用されています。readerブロック内では、テストに使用されるデータファイル;サンプルではTest-28x28.txt、を指定します。最後に、command = MNISTtestの設定と、テストを実行するために cntk configFile=01_OneHidden.cntk を走らせなくてはなりません。コマンドラインの結果は (訳注：ここのコードは原文にあるので省略)</p><h2 id="Using-a-trained-model-in-your-own-solution-学習済みモデルの評価"><a href="#Using-a-trained-model-in-your-own-solution-学習済みモデルの評価" class="headerlink" title="Using a trained model in your own solution (学習済みモデルの評価)"></a>Using a trained model in your own solution (学習済みモデルの評価)</h2><blockquote><p>To use a trained CNTK model in your own solution you can either use the EvalDll from C++ or wrap the EvalDll to call it from other languages. An example for a .NET wrapper and a C# client is provided in Source/Extensibility/CSEvalClient. The example shows how to use the trained MNIST 01_OneHidden model to classify an image. The following code snippet is taken from Program.cs in Source/Extensibility/CSEvalClient. [code lang=”csharp”] … Dictionary&lt;string, List<float>&gt; outputs;<br>using (var model = new IEvaluateModelManagedF()) { // Initialize model evaluator string config = GetConfig(); model.Init(config);<br>// Load model string modelFilePath = Path.Combine(Environment.CurrentDirectory, @”..\Output\Models\01_OneHidden”); model.LoadModel(modelFilePath);<br>// Generate random input values in the appropriate structure and size var inputs = GetDictionary(“features”, 28*28, 255);<br>// We can call the evaluate method and get back the results (single layer)… // List<float> outputList = model.Evaluate(inputs, “ol.z”, 10);<br>// … or we can preallocate the structure and pass it in (multiple output layers) outputs = GetDictionary(“ol.z”, 10, 1); model.Evaluate(inputs, outputs); } … [/code] See Program.cs for full details. If you get an exception Cannot move externally owned matrices to the preferred device. please specify deviceId=-1 in the config file.</p></blockquote><h4 id="訳：-3"><a href="#訳：-3" class="headerlink" title="訳："></a>訳：</h4><p>学習済みのCNTKモデルをソリューションで使用するために、C++から <a href="https://github.com/Microsoft/CNTK/tree/master/Source/EvalDll">EvalDll</a>、または 他の言語から呼び出すためにEvalDll をラップしたものを使うことができます。サンプルのために、.NETラッパーとC#クライアントが <a href="https://github.com/Microsoft/CNTK/tree/master/Source/Extensibility/CSEvalClient">Source/Extensibility/CSEvalClient</a> で提供されています。サンプルでは、学習済みのMNIST 01_OneHidden モデルを画像の分類のためにどのように使うかを示してします。下記のコードスニペットは <a href="https://github.com/Microsoft/CNTK/tree/master/Source/Extensibility/CSEvalClient">Source/Extensibility/CSEvalClient</a> 内の、Program.cs です。 (訳注：ここのコードは原文にあるので省略) 詳細は、<a href="https://github.com/Microsoft/CNTK/blob/master/Source/Extensibility/CSEvalClient/Program.cs">Program.cs</a> を。もし、Cannot move externally owned matrices to the preferred device (訳注 : 訳は「優先デバイスに所有権のある行列を外部に移動することはできません」ですが、CNTKの内部例外は日本語にならないので、このままにしました) という例外を受け取った場合は、deviceID=-1 を設定ファイルで指定してください。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>訳のレベルが低すぎるのはご愛嬌。 .NETのラッパーがサンプルで提供されていることが発覚しました。 これは面白くなってきました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> gpupu </category>
          
          <category> CNTK </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング CNTK その2 テスト</title>
      <link href="/2016/02/27/861/"/>
      <url>/2016/02/27/861/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-dD">前回</a>はCNTKをソースコードからビルドしました。今回は実際にテストしてみます。</p><a id="more"></a><h1 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h1><h2 id="まず実行"><a href="#まず実行" class="headerlink" title="まず実行"></a>まず実行</h2><p>Microsoftが動作検証用にサンプルをCNTKに置いてくれていますので既にクローン済みです。 サンプルは <strong>CNTK/Examples/Other/Simple2d/</strong> になります。 [code lang=”sh”] <a href="https://github.com/Microsoft/CNTK/tree/master/Examples/Other/Simple2d">https://github.com/Microsoft/CNTK/tree/master/Examples/Other/Simple2d</a> [/code] このサンプルについて、</p><blockquote><p>This example trains a simple network and can be directed to use either CPU or GPU, which helps quickly ensure that CNTK is functioning properly.</p></blockquote><p>[code] 訳：このサンプルは単純なネットワークの学習、並びにCPUとGPUのどちらを使うかを指示しCNTKが正しく動作することを簡単にチェックします。 [/code] とあります。検証用ですね、まさに。 次にCNTKのフォルダに移動します。<strong>CNTK.sln</strong> が存在するディレクトリです。 その後、次のコマンドをたたくと、テストが実行されます。 [code lang=”sh”] set PATH=”%CD%\Release”;%PATH% cd Examples\Other\Simple2d\Data cntk configFile=../Config/Simple.cntk [/code] 実行後、エラーがなければ <strong>COMPLETED</strong> の文字が出るはずです。 <a href="../../../../public/2016/02/test-1.png"><img src="../../../../public/2016/02/test-1-300x218.png" alt="テスト"></a></p><p>学習が完了したので、次にもう一度学習をしたい場合は、学習済みのモデル、つまり今回の出力を削除する必要があります。 [code lang=”sh”] del ..\Output\Models\*.* [/code]</p><h2 id="GPUを使う"><a href="#GPUを使う" class="headerlink" title="GPUを使う"></a>GPUを使う</h2><p>今度GPUを使ってみます。前段では使っていなかったようで、GPUを使うように指示したビルドでも、明示的に指示する必要があるようです。 まずは、出力を削除してください。 次に下記のコマンドをたたきます。 [code lang=”sh”] cntk configFile=../Config/Simple.cntk deviceId=auto 1&gt; out.txt 2&gt;&amp;1 [/code] するとOut.txtに出力結果がリダイレクトされるので中を確認します。 テキスト中に [code] SimpleNetworkBuilder Using GPU 0 [/code] というのがあるはずです。ただし、0の部分は環境依存です。 通常この部分は</p><ul><li>-1 : CPUを使用。デフォルト値</li><li>0以上 : GPUを使用。deviceIdに対応した値で例えば deviceId=0ならGPU 0 を示すとのこと。複数台のGPUを搭載している場合でしょう。</li><li>auto : GPUを自動選択</li></ul><p>ということです。 私の環境なら、 [code lang=”sh”] cntk configFile=../Config/Simple.cntk deviceId=0 1&gt; out.txt 2&gt;&amp;1 [/code] は、先のコマンドと同一の結果を出します。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>無事に動いていることが確認できました。 折角Windowsで動かしたのだから、自分でネットワークを構築したりして学習させてみたいです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> gpupu </category>
          
          <category> CNTK </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング CNTK その1 環境構築</title>
      <link href="/2016/02/27/845/"/>
      <url>/2016/02/27/845/</url>
      
        <content type="html"><![CDATA[<p>前回はUbuntuからディープラーニングのフレームワークの一つである <strong>Caffe</strong> をインストールしてテストしました。でもやっぱりWindowsで実行したいよね、ということで別のフレームワークを導入します。 別にLinuxが面倒だから、という理由ではないです。ﾎﾝﾄｳﾀﾞﾖ。</p><a id="more"></a><h1 id="CNTK"><a href="#CNTK" class="headerlink" title="CNTK"></a>CNTK</h1><p>Microsoftが公開した、オープンソースで開発が進んでいるディープラーニングのフレームワークです。 <strong>CNTK</strong> は、公式によれば、<strong>Computational Network Toolkit</strong>とのこと。 公式ページは<a href="https://github.com/Microsoft/CNTK">Github</a>です。</p><h1 id="環境構築"><a href="#環境構築" class="headerlink" title="環境構築"></a>環境構築</h1><h2 id="ソースコード"><a href="#ソースコード" class="headerlink" title="ソースコード"></a>ソースコード</h2><p>流石Microsoft、というかバイナリ版も用意していますが、ここはソースコードからビルドします。 公式ページに<a href="https://github.com/Microsoft/CNTK/wiki/Setup-CNTK-on-Windows">説明</a>がすべて書かれています。が英語。いや、別に大した英語でもないのでビビる必要はないです。 ただ、注意として、<strong>64bitOS限定</strong>です。 まずはGitクライアントを使ってCloneします。 私は <strong>TortoiseGit</strong> を使ってCloneしましたが、お好みでどうぞ。 コマンドなら [code lang=”dos”] git clone <a href="https://github.com/Microsoft/CNTK">https://github.com/Microsoft/CNTK</a> [/code] です。好きなディレクトリでどうぞ。</p><h2 id="Visual-Studio-2013"><a href="#Visual-Studio-2013" class="headerlink" title="Visual Studio 2013"></a>Visual Studio 2013</h2><p>バージョン指定があるようです。 Visual Studio 2013 Update 5またはそれ以降、とあります。 Update5以降を指すようですが、現時点ではありません。</p><h2 id="CUDA-7-0"><a href="#CUDA-7-0" class="headerlink" title="CUDA 7.0"></a>CUDA 7.0</h2><p><a href="https://developer.nvidia.com/cuda-toolkit-70">NVidiaのサイト</a>から <strong>CUDA 7.0</strong> をダウンロードします。 インストールは簡単ですので割愛します。 CUDA 7.5でしたら<a href="http://wp.me/p7138e-bv">以前の記事</a>にインストール手順があります。 インストール完了後 <strong>CUDA_PATH=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.0 CUDA_PATH_V7_0=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.0</strong> が環境変数に追加されたことを確認。 インストール先に応じて変わりますのでご注意。 CUDA 7.5でも動く、みたいなことがIssueにあがっています。 7.5をすでにインストールしているので、それを利用します。</p><h2 id="NVidia-CUB"><a href="#NVidia-CUB" class="headerlink" title="NVidia CUB"></a>NVidia CUB</h2><p>NVIDIAによれば、CUBは <strong>CUDA UnBound</strong> とのこと。</p><blockquote><p>CUB provides state-of-the-art, reusable software components for every layer of the CUDA programming model:</p></blockquote><p>[code] 訳:CUBは最新式で、再利用可能なソフトウェアコンポーネントをCUDAプログラミングモデルのすべてのレイヤーに提供します。 [/code] とあります。 最新版は1.5.1ですが、説明ページは1.4.1を案内していますので従います。 <a href="https://github.com/NVlabs/cub/archive/1.4.1.zip">ここ</a>からです。 入手後、任意のフォルダに展開してパスを通します。 展開したフォルダに移動して、下記のコマンドを実行すればパスが通ります。 [code lang=”dos”] setx CUB_PATH “%CD%” [/code] 下記のような感じになればOK。 [code] CUB_PATH=c:\src\cub-1.4.1 [/code]</p><h2 id="NVIDIA-CUDA-Deep-Neural-Network-library-cuDNN"><a href="#NVIDIA-CUDA-Deep-Neural-Network-library-cuDNN" class="headerlink" title="NVIDIA CUDA Deep Neural Network library (cuDNN)"></a>NVIDIA CUDA Deep Neural Network library (cuDNN)</h2><p>これもバージョン指定があります。 <a href="http://developer.download.nvidia.com/compute/redist/cudnn/v4/cudnn-7.0-win-x64-v4.0-rc.zip">ここ</a>から入手。 先ほどと同じく、入手後、任意のフォルダに展開してパスを通します。 展開したフォルダに移動して、下記のコマンドを実行すればパスが通ります。 [code lang=”dos”] setx CUDNN_PATH “%CD%” [/code] 下記のような感じになればOK。 [code] CUDNN_PATH=C:\NVIDIA\cudnn-4.0\cuda [/code]</p><h2 id="Boost"><a href="#Boost" class="headerlink" title="Boost"></a>Boost</h2><p>説明不要の有名ライブラリ群。 ですが、CNTKはユニットテストに使っている模様。 またバージョン指定で、1.59が必要で, <strong>Visual Studio 12 (2013)</strong> でビルドされたバイナリが必要になります。 <a href="http://sourceforge.net/projects/boost/files/boost-binaries/1.59.0/boost_1_59_0-msvc-12.0-64.exe/download">Sourceforge</a>から入手。 入手後、インストールを実行します。 インストール先のフォルダに移動して、下記のコマンドを実行すればパスが通ります。 [code lang=”dos”] setx BOOST_INCLUDE_PATH “%CD%” setx BOOST_LIB_PATH “%CD%\lib64-msvc-12.0” [/code] 下記のような感じになればOK。 [code] BOOST_INCLUDE_PATH=c:\local\boost_1_59_0 BOOST_LIB_PATH=c:\local\boost_1_59_0\lib64-msvc-12.0 [/code]</p><h2 id="ACML-またはMKL"><a href="#ACML-またはMKL" class="headerlink" title="ACML (またはMKL)"></a>ACML (またはMKL)</h2><p><strong>AMD Core Math Library</strong>です。 対して MKL は Intelの <strong>Math Kernel Library</strong> です。 Caffe 環境構築の際、BLAS (線形代数ライブラリ) を入手する際のオプションでした。MKLは有償なので、ACMLを使います。 ACMLは<a href="http://developer.amd.com/tools/cpu-development/amd-core-math-library-acml/acml-downloads-resources/">AMD website</a>から入手します。 たくさんありますが、利用するのは <strong>acml5.3.1-ifort64.exe</strong> のようなファイルです。 なので、<strong>Inter Fortran</strong> というのを使います。5.3.1以降を使います。 今回は6.1.0を使います。 先ほどと同じく、入手後、任意のフォルダに展開してパスを通します。 展開したフォルダに移動して、下記のコマンドを実行すればパスが通ります。 [code lang=”dos”] setx ACML_PATH “%CD%/ifort64_mp” [/code] 下記のような感じになればOK。 [code] ACML_PATH=C:\AMD\acml5.3.1\ifort64_mp [/code]</p><h2 id="Microsoft-MPI"><a href="#Microsoft-MPI" class="headerlink" title="Microsoft MPI"></a>Microsoft MPI</h2><p>MPI は <strong>Message Passing Interface</strong> とのこと。 バージョン7以降が必要。 <a href="https://msdn.microsoft.com/en-us/library/bb524831(v=vs.85).aspx">Microsoft Developer Network</a>から入手。 SDKとランタイムが必要です。それぞれインストーラは、<strong>msmpisdk.msi</strong>、<strong>MSMpiSetup.exe</strong> になります。 インストールは簡単なので割愛。</p><h2 id="OpenCV"><a href="#OpenCV" class="headerlink" title="OpenCV"></a>OpenCV</h2><p>こちらも説明不要なコンピュータビジョン向けライブラリ。 バージョン3.0.0が必要。 <a href="http://opencv.org/downloads.html">ここ</a>から入手。 インストール後、環境変数 <strong>OPENCV_PATH</strong> を設定します。 OpenCVのbuildフォルダにパスを通します。buildフォルダに移動して、下記のコマンドを実行すればパスが通ります。 [code lang=”dos”] setx OPENCV_PATH “%CD%” [/code] 下記のような感じになればOK。 [code] OPENCV_PATH=C:\src\opencv\build [/code]</p><h2 id="ビルド-事前準備"><a href="#ビルド-事前準備" class="headerlink" title="ビルド (事前準備)"></a>ビルド (事前準備)</h2><p>CUDA 7.0をインストールしている場合は、ここはスキップです。 CUDA 7.5を利用する場合は、プロジェクトファイルに記載してある各種参照を7.5用に書き換える必要があります。 書き換え対象は、</p><ul><li>Source\ActionsLib\ActionsLib.vcxproj</li><li>Source\CNTK\CNTK.vcxproj</li><li>Source\ComputationNetworkLib\ComputationNetworkLib.vcxproj</li><li>Source\EvalDll\EvalDll.vcxproj</li><li>Source\Math\Math.vcxproj</li><li>Source\Math\MathCUDA.vcxproj</li><li>Source\SGDLib\SGDLib.vcxproj</li><li>Tests\UnitTests\MathPerformanceTests\MathPerformanceTests.vcxproj</li><li>Tests\UnitTests\MathTests\MathTests.vcxproj</li></ul><p>になり、 <strong>cu***64_70.dll</strong> <strong>CUDA 7.0.props</strong> <strong>CUDA_PATH_V7_0</strong> という単語を書き換えます。 Grepで、 <strong>7.0</strong> を <strong>7.5</strong> <strong>_70</strong> を <strong>_75</strong> <strong>_V7_0</strong> を <strong>_V7_5</strong> に置換すればOKです。</p><h2 id="ビルド"><a href="#ビルド" class="headerlink" title="ビルド"></a>ビルド</h2><p><strong>CNTK.sln</strong> を Visual Studio 2013 で開きます。 ソリューション構成は <strong>Debug</strong>、<strong>Debug_CpuOnly</strong>、<strong>Release</strong>、<strong>Release_CpuOnly</strong> の4つです。 お好みの構成でビルドしてください。 ですが、ビルドに失敗します。 下記は<strong>Release_CpuOnly</strong>でビルドした際のスクリーンショットです。 <a href="../../../../public/2016/02/1-6.png"><img src="../../../../public/2016/02/1-6-300x63.png" alt="ビルドエラー"></a></p><p>とあります。Shift-Jisが不味いのでUTF-8に変換します。 ですので、面倒ですが、下記のファイルのエンコードをUTF8に変換します。</p><ul><li>C:\Program Files (x86)\Microsoft SDKs\MPI\Include\mpi.h</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\Include\CUDA_runtime.h</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\Include\CUDA_runtime_api.h</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\Include\device_double_functions.h</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\Include\device_functions.h</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\Include\device_functions_decls.h</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\Include\math_functions.h</li><li>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v7.5\Include\sm_20_intrinsics.h</li><li>CNTK\Source\Common\Include\Config.h</li><li>opencv\build\Include\opencv2\core\mat.hpp</li><li>opencv\build\Include\opencv2\core\persistence.hpp</li><li>opencv\build\Include\opencv2\core\utility.hpp</li></ul><p><strong>メニュー</strong>→<strong>ファイル</strong>→<strong>名前をつけて保存</strong>で<strong>上書き保存のメニュー</strong>から<strong>エンコード付きで保存</strong>を選択します。 <a href="../../../../public/2016/02/2.png"><img src="../../../../public/2016/02/2-300x187.png" alt="エンコード修正"></a></p><p><strong>Unicode (UTF-8 シグネチャ付き) - コードページ 65001</strong> で保存してください。 これでビルドが通りますが、GPUを使用するほうは、かなり時間がかかります。 コーヒーでも飲んでてください。 私の環境だと9分かかりました。 また、出力ファイルをRAMディスクに対比しているのですが、2GB以上途中ファイルとバイナリファイルを生成しますので、RAMディスクを活用している方は、空き容量には注意してください。 エラーなく終わると、<strong>CNTK\x64\Release\CNTK.exe</strong> が生成されます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Caffe以上に面倒な構築手順でした。 次回は実際に使えたらな、と思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> gpupu </category>
          
          <category> CNTK </category>
          
          <category> ディープラーニング </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング Caffe その2 テスト</title>
      <link href="/2016/02/21/832/"/>
      <url>/2016/02/21/832/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-d2">前回</a>はHyper-V上に作成したUbuntu上にcaffeをインストールしました。今回は実際に使ってみます。</p><a id="more"></a><h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>caffeは大まかに下記の手順で実施します。</p><ol><li>データセットの用意</li><li>データの格納</li><li>パラメータの調整</li><li>学習</li><li>評価</li></ol><p>今回は、学習が完了した状態で、評価を行います。<br>ちなみに、データセットとは、<strong>学習(訓練)用</strong>、<strong>評価用</strong>の2種から構成されるデータ群です。<br>通常、学習する際に使用したデータを、検証用に使うことはできません。<br>学生のテストで試験範囲発表で問題そのものが公開されるわけではないのと同じです。学生を「テスト」する意味がないですから。</p><p>また、今回のテストはあらかじめ用意されているものを使います。<br>ネット上で解説されているものと同じですが、他と違うのは、きちんと説明を加えます。<br>何をしているのかよくわからないし、「おまじない」的な説明は極力避けます。</p><h1 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h1><h2 id="モデルの取得"><a href="#モデルの取得" class="headerlink" title="モデルの取得"></a>モデルの取得</h2><p>モデルとは、どういう手順、経路、方法でデータの学習を行うかを定義した多層ニューラルネットワークを指す。<br>モデルは、<strong>Caffe Model Zoo</strong>というCaffeの学習済モデルを公開したWikiがあり、そこで有力なモデルが公開されている。</p><p>下記のコマンドを実行します。caffeのフォルダは前回と同様であるものとします。<br>必要に応じてsudoするなりします。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/caffe/</span><br><span class="line">python scripts/download_model_binary.py models/bvlc_reference_caffenet</span><br></pre></td></tr></table></figure><p>実行したスクリプトは大量のデータ (233MB) をダウンロードしますので時間がかかります。</p><h2 id="関連データの取得"><a href="#関連データの取得" class="headerlink" title="関連データの取得"></a>関連データの取得</h2><p>ilsvrc12の学習、評価に用いられる画像ファイル名の一覧、ラベル一覧などをダウンロードします。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/caffe/data/ilsvrc12/</span><br><span class="line">chmod u+x get_ilsvrc_aux.sh</span><br><span class="line">./get_ilsvrc_aux.sh</span><br></pre></td></tr></table></figure><h2 id="画像データの取得"><a href="#画像データの取得" class="headerlink" title="画像データの取得"></a>画像データの取得</h2><p>検証に用いる画像のデータセット<a href="http://www.vision.caltech.edu/Image_Datasets/Caltech101/">Caltech 101</a>をダウンロードします。<br>ダウンロード先は任意です。<br>126MBあるので、これも時間がかかります。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/caffe/</span><br><span class="line">mkdir dataset</span><br><span class="line"><span class="built_in">cd</span> dataset</span><br><span class="line">mkdir caltech101</span><br><span class="line">wget http://www.vision.caltech.edu/Image_Datasets/Caltech101/101_ObjectCategories.tar.gz</span><br><span class="line">tar xf 101_ObjectCategories.tar.gz</span><br></pre></td></tr></table></figure><p>これで準備完了です。</p><h1 id="検証"><a href="#検証" class="headerlink" title="検証"></a>検証</h1><h2 id="分類"><a href="#分類" class="headerlink" title="分類"></a>分類</h2><p>実際に画像を入力して分類してみます。<br>前提として、pycaffeをコンパイル済みであるものとします。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/caffe/python</span><br><span class="line">python classify.py --raw_scale 255 /usr/<span class="built_in">local</span>/caffe/dataset/caltech101/101_ObjectCategories/airplanes/image_0001.jpg /usr/<span class="built_in">local</span>/caffe/dataset/caltech101/result.npy</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/caffe/dataset/caltech101/</span><br></pre></td></tr></table></figure><p><strong>classify.py</strong> によれば、 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">classify.py is an out-of-the-box image classifer callable from the command line.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">By default it configures and runs the Caffe reference ImageNet model.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> caffe</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    pycaffe_dir = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    <span class="comment"># Required arguments: input and output files.</span></span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;input_file&quot;</span>,</span><br><span class="line">        help=<span class="string">&quot;Input image, directory, or npy.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;output_file&quot;</span>,</span><br><span class="line">        help=<span class="string">&quot;Output npy filename.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># Optional arguments.</span></span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--model_def&quot;</span>,</span><br><span class="line">        default=os.path.join(pycaffe_dir,</span><br><span class="line">                <span class="string">&quot;../models/bvlc_reference_caffenet/deploy.prototxt&quot;</span>),</span><br><span class="line">        help=<span class="string">&quot;Model definition file.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--pretrained_model&quot;</span>,</span><br><span class="line">        default=os.path.join(pycaffe_dir,</span><br><span class="line">                <span class="string">&quot;../models/bvlc_reference_caffenet/bvlc_reference_caffenet.caffemodel&quot;</span>),</span><br><span class="line">        help=<span class="string">&quot;Trained model weights file.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--gpu&quot;</span>,</span><br><span class="line">        action=<span class="string">&#x27;store_true&#x27;</span>,</span><br><span class="line">        help=<span class="string">&quot;Switch for gpu computation.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--center_only&quot;</span>,</span><br><span class="line">        action=<span class="string">&#x27;store_true&#x27;</span>,</span><br><span class="line">        help=<span class="string">&quot;Switch for prediction from center crop alone instead of &quot;</span> +</span><br><span class="line">             <span class="string">&quot;averaging predictions across crops (default).&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--images_dim&quot;</span>,</span><br><span class="line">        default=<span class="string">&#x27;256,256&#x27;</span>,</span><br><span class="line">        help=<span class="string">&quot;Canonical &#x27;height,width&#x27; dimensions of input images.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--mean_file&quot;</span>,</span><br><span class="line">        default=os.path.join(pycaffe_dir,</span><br><span class="line">                             <span class="string">&#x27;caffe/imagenet/ilsvrc_2012_mean.npy&#x27;</span>),</span><br><span class="line">        help=<span class="string">&quot;Data set image mean of [Channels x Height x Width] dimensions &quot;</span> +</span><br><span class="line">             <span class="string">&quot;(numpy array). Set to &#x27;&#x27; for no mean subtraction.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--input_scale&quot;</span>,</span><br><span class="line">        type=float,</span><br><span class="line">        help=<span class="string">&quot;Multiply input features by this scale to finish preprocessing.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--raw_scale&quot;</span>,</span><br><span class="line">        type=float,</span><br><span class="line">        default=<span class="number">255.0</span>,</span><br><span class="line">        help=<span class="string">&quot;Multiply raw input by this scale before preprocessing.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--channel_swap&quot;</span>,</span><br><span class="line">        default=<span class="string">&#x27;2,1,0&#x27;</span>,</span><br><span class="line">        help=<span class="string">&quot;Order to permute input channels. The default converts &quot;</span> +</span><br><span class="line">             <span class="string">&quot;RGB -&gt; BGR since BGR is the Caffe default by way of OpenCV.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--ext&quot;</span>,</span><br><span class="line">        default=<span class="string">&#x27;jpg&#x27;</span>,</span><br><span class="line">        help=<span class="string">&quot;Image file extension to take as input when a directory &quot;</span> +</span><br><span class="line">             <span class="string">&quot;is given as the input file.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    image_dims = [int(s) <span class="keyword">for</span> s <span class="keyword">in</span> args.images_dim.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    mean, channel_swap = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> args.mean_file:</span><br><span class="line">        mean = np.load(args.mean_file)</span><br><span class="line">    <span class="keyword">if</span> args.channel_swap:</span><br><span class="line">        channel_swap = [int(s) <span class="keyword">for</span> s <span class="keyword">in</span> args.channel_swap.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args.gpu:</span><br><span class="line">        caffe.set_mode_gpu()</span><br><span class="line">        print(<span class="string">&quot;GPU mode&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        caffe.set_mode_cpu()</span><br><span class="line">        print(<span class="string">&quot;CPU mode&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Make classifier.</span></span><br><span class="line">    classifier = caffe.Classifier(args.model_def, args.pretrained_model,</span><br><span class="line">            image_dims=image_dims, mean=mean,</span><br><span class="line">            input_scale=args.input_scale, raw_scale=args.raw_scale,</span><br><span class="line">            channel_swap=channel_swap)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load numpy array (.npy), directory glob (*.jpg), or image file.</span></span><br><span class="line">    args.input_file = os.path.expanduser(args.input_file)</span><br><span class="line">    <span class="keyword">if</span> args.input_file.endswith(<span class="string">&#x27;npy&#x27;</span>):</span><br><span class="line">        print(<span class="string">&quot;Loading file: %s&quot;</span> % args.input_file)</span><br><span class="line">        inputs = np.load(args.input_file)</span><br><span class="line">    <span class="keyword">elif</span> os.path.isdir(args.input_file):</span><br><span class="line">        print(<span class="string">&quot;Loading folder: %s&quot;</span> % args.input_file)</span><br><span class="line">        inputs =[caffe.io.load_image(im_f)</span><br><span class="line">                 <span class="keyword">for</span> im_f <span class="keyword">in</span> glob.glob(args.input_file + <span class="string">&#x27;/*.&#x27;</span> + args.ext)]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Loading file: %s&quot;</span> % args.input_file)</span><br><span class="line">        inputs = [caffe.io.load_image(args.input_file)]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;Classifying %d inputs.&quot;</span> % len(inputs))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Classify.</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    predictions = classifier.predict(inputs, <span class="keyword">not</span> args.center_only)</span><br><span class="line">    print(<span class="string">&quot;Done in %.2f s.&quot;</span> % (time.time() - start))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Save</span></span><br><span class="line">    print(<span class="string">&quot;Saving results into %s&quot;</span> % args.output_file)</span><br><span class="line">    np.save(args.output_file, predictions)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure><p>とあります。<br>入力と出力は必須なので、最後の2つが入力画像と出力になります。<br>出力はnumpy標準のファイル形式です。<br><strong>--raw_scale 255</strong> は、前処理の前にこのスケール値だけ乗算するとあります。<br><a href="http://iwaki2009.blogspot.jp/2014/12/caffeimagenet.html">OpenCV 備忘録</a> によれば、入力値[0:1]をImageNetモデルの[0:255]に変更するとのこと。<br>実行後、うまくいって結果を確認、できません。<br>無慈悲なエラーが出ます。<br><a href="../../../../public/2016/02/1-4.png"><img src="../../../../public/2016/02/1-4-300x225.png" alt="無慈悲なエラー"></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">File <span class="string">&quot;classify.py&quot;</span>, line 138, <span class="keyword">in</span> </span><br><span class="line">    main(sys.argv)</span><br><span class="line">  File <span class="string">&quot;classify.py&quot;</span>, line 110, <span class="keyword">in</span> main</span><br><span class="line">    channel_swap=channel_swap)</span><br><span class="line">  File <span class="string">&quot;/usr/local/caffe/python/caffe/classifier.py&quot;</span>, line 34, <span class="keyword">in</span> __init__</span><br><span class="line">    self.transformer.set_mean(in_, mean)</span><br><span class="line">  File <span class="string">&quot;/usr/local/caffe/python/caffe/io.py&quot;</span>, line 258, <span class="keyword">in</span> set_mean</span><br><span class="line">    raise ValueError(<span class="string">&#x27;Mean shape incompatible with input shape.&#x27;</span>)</span><br></pre></td></tr></table></figure><p>イラっとしますが、解析すると、**/usr/local/caffe/python/caffe/io.py** の258行目が例外を投げているように見えます。<br>Google先生に聞いてみると<a href="http://qiita.com/Bonnnou_108/items/41e6dadeff1310b4eb5d">OSX10.10でCaffeをインストール、リファレンスモデルで画像を分類</a>にて回答が。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ms != self.inputs[in_][<span class="number">1</span>:]:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Mean shape incompatible with input shape.&#x27;</span>)</span><br></pre></td></tr></table></figure><p>を </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ms != self.inputs[in_][<span class="number">1</span>:]:</span><br><span class="line">    print(self.inputs[in_])</span><br><span class="line">    in_shape = self.inputs[in_][<span class="number">1</span>:]</span><br><span class="line">    m_min, m_max = mean.min(), mean.max()</span><br><span class="line">    normal_mean = (mean - m_min) / (m_max - m_min)</span><br><span class="line">    mean = resize_image(normal_mean.transpose((<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>)),in_shape[<span class="number">1</span>:]).transpose((<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>)) * (m_max - m_min) + m_min</span><br><span class="line">    <span class="comment">#raise ValueError(&#x27;Mean shape incompatible with input shape.&#x27;)</span></span><br></pre></td></tr></table></figure><p>に直せばよいとのこと。<br>修正後、再度実行すると、result.npyが出力されたことを示すメッセージが。</p><h2 id="結果"><a href="#結果" class="headerlink" title="結果"></a>結果</h2><p>うきうきしながら、result.npyを開くと。<br>開けません。というかバイナリファイルなのか読めません。<br>これを人間の目でわかる結果に直す必要があります。<br><a href="http://techblog.yahoo.co.jp/programming/caffe-intro/">Caffeで手軽に画像分類</a>にて、この結果を人間の目でわかる結果に直すスクリプトを公開してくださっています。感謝です。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/caffe/python</span><br><span class="line">gedit show_result.py</span><br></pre></td></tr></table></figure><p>エディタを開いて下記のスクリプトを保存します。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys, numpy</span><br><span class="line"></span><br><span class="line">categories = numpy.loadtxt(sys.argv[<span class="number">1</span>], str, delimiter=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line">scores = numpy.load(sys.argv[<span class="number">2</span>])</span><br><span class="line">top_k = <span class="number">3</span></span><br><span class="line">prediction = zip(scores[<span class="number">0</span>].tolist(), categories)</span><br><span class="line">prediction.sort(cmp=<span class="keyword">lambda</span> x, y: cmp(x[<span class="number">0</span>], y[<span class="number">0</span>]), reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> rank, (score, name) <span class="keyword">in</span> enumerate(prediction[:top_k], start=<span class="number">1</span>):</span><br><span class="line">    print(<span class="string">&#x27;#%d | %s | %4.1f%%&#x27;</span> % (rank, name, score * <span class="number">100</span>))</span><br></pre></td></tr></table></figure><p>保存後。、 </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/caffe/python</span><br><span class="line">python show_result.py ../data/ilsvrc12/synset_words.txt /usr/<span class="built_in">local</span>/caffe/dataset/caltech101/result.npy</span><br><span class="line"><span class="comment">#1 | n04552348 warplane, military plane | 84.8%</span></span><br><span class="line"><span class="comment">#2 | n04008634 projectile, missile |  5.5%</span></span><br><span class="line"><span class="comment">#3 | n02690373 airliner |  5.1%</span></span><br></pre></td></tr></table></figure><p>という結果が出力されます。<br><a href="../../../../public/2016/02/1-5.png"><img src="../../../../public/2016/02/1-5-300x225.png" alt="入力画像"></a></p><p>入力画像 <strong>/usr/local/caffe/dataset/caltech101/101_ObjectCategories/airplanes/image_0001.jpg</strong> が戦闘機である確率が84.8%だと判断されました。<br>素晴らしい。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>長かったですが、きちんとcaffeが動作する様を確認できました。<br>次回はモデルを構築できたらな、と思います。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> Caffe </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ディープラーニング Caffe その1 環境構築</title>
      <link href="/2016/02/20/808/"/>
      <url>/2016/02/20/808/</url>
      
        <content type="html"><![CDATA[<p><strong>codecademy</strong> でのPythonの学習が完了し、そのことを会社で伝えたら、ディープラーニングの <strong>Caffe</strong> を使ったプロジェクトに参加させられることになりました。 どうしてこうなった。</p><a id="more"></a><h1 id="Caffe"><a href="#Caffe" class="headerlink" title="Caffe"></a>Caffe</h1><p>更新 (2017/04/23) <a href="http://wp.me/p7138e-yE">ディープラーニング Caffe その3 環境構築 with GPU</a>にて、GeForce GTX 750 Tiを使った環境構築方法をについて説明しています。 オープンソースで開発が進んでいるディープラーニングのフレームワークです。 非常に強力ですが、環境構築が手間だと専らの話。 Windows版なんかあるはずがありません。 (<a href="https://github.com/niuzhiheng/caffe">非公式のWindows版</a>が公式で紹介されています。)</p><h1 id="環境構築"><a href="#環境構築" class="headerlink" title="環境構築"></a>環境構築</h1><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><p>というわけで、会社と同じ環境である <strong>Ubuntu 14.0.4 LTS Desktop 64bit</strong> をHyper-Vに用意しました。 インストールは特に問題ないです。GUIですし、選択肢も少なく優秀です。 <a href="../../../../public/2016/02/1.png"><img src="../../../../public/2016/02/1-300x225.png" alt="デスクトップ画面"></a></p><p>Hyper-Vマシン前で作業するのは面倒なので、VNC経由で使えるようにします。 ここでかなり手間取りました。</p><h2 id="VNCの許可"><a href="#VNCの許可" class="headerlink" title="VNCの許可"></a>VNCの許可</h2><ol><li>ターミナルから下記のコマンドで <strong>dconf-editor</strong> をインストールします</li></ol><p>[code lang=”sh”] sudo apt-get install dconf-tools [/code]</p><ol><li>メニューから dconf-editor を呼び出します。</li></ol><p><a href="../../../../public/2016/02/1-2.png"><img src="../../../../public/2016/02/1-2-300x225.png" alt="dconf-editor"></a></p><ol><li>左のノードから <strong>org &gt; gnome &gt; desktop &gt; remote-access</strong> と進めます。<strong>enabled</strong> にチェック、<strong>require-encryption</strong> のチェックを外します。。</li></ol><p><a href="../../../../public/2016/02/1-3.png"><img src="../../../../public/2016/02/1-3-300x225.png" alt="dconf-editor2"></a></p><ol><li><p>メニューから <strong>Desktop Sharing</strong> を呼び出します。検索語は <strong>Vino</strong> です。</p></li><li><p><strong>You must confirm each access to this machine</strong> を外します。オプションで <strong>Show Notification Area Icon</strong> を <strong>Always</strong> に変更します。</p></li></ol><p>以上でVNCを利用できるようになります。 VHDのデータをこの時点で対比しておくと、環境をリセットしたいとき楽です。 Hyper-Vのチェックポイント機能がありますが、VHD一つ保存しておくだけで複製も楽ですので、私はこっちのが好みです。</p><h2 id="Caffeの導入"><a href="#Caffeの導入" class="headerlink" title="Caffeの導入"></a>Caffeの導入</h2><p><a href="http://caffe.berkeleyvision.org/installation.html">公式サイトの導入指示</a> では、 <strong>必須の依存ライブラリ</strong></p><ul><li>CUDA (GPUモードで使う場合)<ul><li>バージョン7以降の最新バージョン推奨。ただし、6系も良し。</li><li>5.5と5.0は互換性はあるが、レガシーです</li></ul></li><li>ATLAS、MKLまたはOpenBLAS</li><li>Boost (1.55以降)</li><li>protobuf</li><li>glog</li><li>gflags</li><li>hdf5</li></ul><p><strong>オプションの依存ライブラリ</strong></p><ul><li>OpenCV (3.0を含む2.4以降の)</li><li>lmdb</li><li>leveldb (snappyが必要)</li><li>cuDNN</li></ul><p><strong>Pycaffe と Matcaffe のインターフェース利用に必要なもの</strong></p><ul><li>Python Caffe<ul><li>Python (2.7または3.3以降)</li><li>numpy (1.7以降)</li><li>boost.python</li><li>lmdb</li></ul></li><li>MATLAB Caffe<ul><li>MATLAB (mexコンパイラ付き)</li></ul></li></ul><p>とのことなので指示に従いますが、実際作業中はオプションのものが必要になったりしました。 GPUは使わないので、CUDAは無視します。 <strong>1. ATLAS</strong> [code lang=”sh”] sudo apt-get install libatlas-base-dev [/code] <strong>2. Boost</strong> [code lang=”sh”] sudo apt-get install libboost-all-dev [/code] <strong>3. protobuf</strong> [code lang=”sh”] sudo apt-get install libprotobuf-dev [/code] <strong>4. glog</strong> [code lang=”sh”] sudo apt-get install libgoogle-glog-dev [/code] <strong>5. gflags</strong> [code lang=”sh”] sudo apt-get install libgflags-dev [/code] <strong>6. hdf5</strong> [code lang=”sh”] sudo apt-get install libhdf5-serial-dev [/code] <strong>7. git</strong> [code lang=”sh”] sudo apt-get install git [/code] <strong>8. g++ 4.6</strong> [code lang=”sh”] sudo apt-get install g++-4.6 [/code] <strong>9. protobuf-compiler</strong> [code lang=”sh”] sudo apt-get install protobuf-compiler [/code] <strong>10. OpenCV</strong> [code lang=”sh”] sudo apt-get install libopencv-dev [/code] <strong>11. leveldb</strong> [code lang=”sh”] sudo apt-get install libleveldb-dev [/code] <strong>12. lmdb</strong> [code lang=”sh”] sudo apt-get install liblmdb-dev [/code] <strong>13. snappy</strong> [code lang=”sh”] sudo apt-get install libsnappy-dev [/code] <strong>14. caffe本体のダウンロード</strong> gitのクローン先はどこでもいいです。 [code lang=”sh”] cd /usr/local/ git clone <a href="https://github.com/BVLC/caffe.git">https://github.com/BVLC/caffe.git</a> [/code] <strong>15. caffe本体のコンパイル準備</strong> [code lang=”sh”] cd caffe cp Makefile.config.example Makefile.config sudo gedit Makefile.config [/code] 下記のコメント行を有効化 [code lang=”makefile”] # CPU_ONLY := 1 [/code] 下記のコメント行の直下に追加 [code lang=”makefile”] # CUSTOM_CXX := g++ CUSTOM_CXX := g++-4.6 [/code] 下記の行をコメントアウト [code lang=”makefile”] CUDA_DIR := /usr/local/cuda [/code] 下記のコメント行を有効化 [code lang=”makefile”] # CUDA_DIR := /usr [/code] <strong>16. caffe本体のコンパイル</strong> [code lang=”sh”] make make test make runtest [/code] エラーが出ずに終了すれば構築は完了です。</p><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>Pythonから使いたい場合は、もうひとがんばりです。 <strong>1. Python</strong> [code lang=”sh”] sudo apt-get install python-dev [/code] <strong>2. pip</strong> [code lang=”sh”] sudo apt-get install python-pip [/code] <strong>3. numpy</strong> [code lang=”sh”] sudo apt-get install python-numpy [/code] <strong>4. skimage</strong> [code lang=”sh”] sudo apt-get install python-skimage [/code] <strong>5. 依存パッケージのダウンロード</strong> [code lang=”sh”] cd /usr/local/caffe/python for req in $(cat requirements.txt); do sudo pip install $req; done [/code] <strong>6. pycaffeのコンパイル</strong> [code lang=”sh”] cd /usr/local/caffe/ make pycaffe [/code] <strong>7. 環境変数の設定</strong> [code lang=”sh”] sudo gedit ~/.bashrc [/code] 最終行に [code lang=”sh”] export PYTHONPATH=/usr/local/caffe/python/:$PYTHONPATH [/code] を追加します [code lang=”sh”] source ~/.bashrc [/code] <strong>7. importのテスト</strong> [code lang=”sh”] python import caffe [/code] ここで、 libdc1394 error: Failed to initialize libdc1394 と表示されますが、これ以外のエラーがなければ問題ないようです。 <a href="http://stackoverflow.com/questions/12689304/ctypes-error-libdc1394-error-failed-to-initialize-libdc1394">stackoverflow</a> で、この問題の簡単な解決策が提示されていました。 [code lang=”sh”] sudo ln /dev/null /dev/raw1394 [/code] でエラーが消えるようです。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>不慣れなLinuxで時間がかかりましたが、これで環境の構築は完了です。 次回は実際に使えたらな、と思います。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> linux </category>
          
          <category> %e3%83%87%e3%82%a3%e3%83%bc%e3%83%97%e3%83%a9%e3%83%bc%e3%83%8b%e3%83%b3%e3%82%b0 </category>
          
          <category> オープンソース </category>
          
          <category> Caffe </category>
          
          <category> Ubuntu </category>
          
          <category> ディープラーニング </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでGPUPUを試してみる CUDA編 第2回</title>
      <link href="/2016/02/16/735/"/>
      <url>/2016/02/16/735/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-bI">前回</a>はCUDAの性能がとんでもなく悪かったです。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>明らかに悪い、とは思っていたけどここまで悪いとは思っていませんでした。 いや本当。 今回は、CUDAの仕組みから。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="CUDAってどうやって動いている？"><a href="#CUDAってどうやって動いている？" class="headerlink" title="CUDAってどうやって動いている？"></a>CUDAってどうやって動いている？</h2><p>今さらですが。 CUDAはGPUを使って計算します。 が、ここで理解してほしいのは、そういう計算処理は本来、CPUがやることで、GPUに計算させているのはあくまでおまけ。 で、当然ながら、現在のPCの仕組み上、GPUとCPUには扱いに大きな差があります。 まず、CPUとメモリの間はレジスタとキャッシュ (1次とか2次とか)が備わっています。 これによりデータやプログラムが可能な限り再利用され、データの移動が最小限になります。 が、GPUとCPU側のメモリの間にそんなものはありません。 たしかに、GPUにはメモリが乗っていますけど、そこにプログラムが使っているデータはありません。 そもそもメモリ (要するにDRAM) はCPUの側に比べれば格段に遅い。 なので、プログラムからGPUに処理を任せるときは、データとプログラムを渡す必要があります。 これ大事。 で、先に話したように、GPUとプログラムの距離は非常に遠い、つまり遅いです。 そもそもDRAMの演算装置間の転送速度は遅いのに、CPU側のメモリとGPUではさらに遅い。 以上を踏まえると、<strong>命令やデータをCPU側メモリからGPUに何度も転送するのは最悪</strong>、ということです。 で、ここまで書いてあれですが、きちんと用語があって、CPU側のメモリ、とかいう表現はしません。</p><p>Term</p><p>Meaning</p><p>ホスト</p><p>呼び出し側。CPU・プログラムと思ってくれれば。</p><p>デバイス</p><p>GPU側</p><p>カーネル</p><p>デバイス上で実行される処理。ホスト上のソースコードに書かれたデバイス用の処理</p><p>と定義されています。 もう一度言いますと、<strong>ホストとデバイス間のカーネルやデータの転送は最小限にする</strong>、ってことです。</p><h2 id="CUDAの真の実力"><a href="#CUDAの真の実力" class="headerlink" title="CUDAの真の実力"></a>CUDAの真の実力</h2><p>前段を踏まえて前回のプログラムの問題点を検証します。 まずデバイス側のカーネルは [code lang=”cpp”] __global__ void addKernel(int *c, const int *a, const int *b) { int i = threadIdx.x; c[i] = a[i] + b[i]; } [/code] になります。 CUDAプログラミングにおいて、関数がホスト側、デバイス側で実行されるかどうかの識別は下記の3つの関数修飾子で区別します。 <strong>__global__</strong> デバイス側で実行される、ホスト側から呼び出される関数であることを示します。戻り値は必ずvoidです。 <strong>__device__</strong> デバイス側で実行され、デバイス側から呼び出される関数であることを示します。要するに、デバイス側のprivateな関数。 <strong>__host__</strong> ホスト側で実行され、ホスト側から呼び出される関数であることを示します。要するに、ホスト側のprivateな関数。</p><p>それで、上の <strong>addKernel 関数</strong> は、<strong>global</strong>なので、デバイス側で実行され、ホスト側でコールされます。 この関数は、別に定義された <strong>cudaError_t addWithCuda(int *, const int *, const int *, unsigned int) 関数</strong> で呼ばれます。 前のコードでは、この addWithCuda 関数を10000回呼び出していました。すなわち10000回、カーネルとデータをデバイス間に転送していたことになります。 それは遅いに決まっています。 理想的なのは、デバイス側で10000回処理が実行されることです。</p><p>×　デバイス側に処理を10000回依頼する ○　デバイス側で処理を10000回実行する</p><p>ということです。 以上を踏まえコードを修正します。 サンプルコードはページの末尾を参照。 変更点は</p><ul><li>ループ回数を10000から100000000回に変更</li><li>addKernel 関数内でループを回すように変更</li><li>デバイス側の計測は addWithCuda 関数内で実行するよう変更</li><li>変数a,b,cはconstを外して、可変長に変更</li></ul><p>これだと、ループ回数は配列長*ループ回数なので、5億回になります。 これを実行させます。 [code lang=”sh”] CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {5556} No CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {0} [/code] 一気に改善しています。ですが、まだダメです。 というか、CPUが速すぎる気がします。 そこで、デバイス側をコメントアウトして、ホスト側だけの計測をしました。 その結果、ループ回数10億、配列長50で8000-9000msという結果が出ました。 少なくとも、計測処理は正しいことがわかりました。常に0になるとか、そういうのはない。 なので、ループ回数を1億にして、配列長50なら800-900msになるはず。 ループ回数が変化なし、配列長が10倍なら、CUDAはおよそ55000msになるはず。</p><h2 id="GPUの特性"><a href="#GPUの特性" class="headerlink" title="GPUの特性"></a>GPUの特性</h2><p>はい。 結果はそうなりませんでした。 [code lang=”sh”] CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {5555} No CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {856} [/code] CPUの計算量推定は正しかったのですが、GPUはそうなりませんでした。 結論を言えば、並列化が関係してます。 <strong>addKernel 関数</strong> をみると、<strong>threadIdx</strong> なるオブジェクトがいます。 [code lang=”cpp”] __global__ void addKernel(int *c, const int *a, const int *b, const int loop) { int i = threadIdx.x; for (unsigned int t = 0; t &lt; loop; ++t) { c[i] = a[i] + b[i]; } } [/code] これなんでしょう。 これ、<strong>NVIDIA GPU Computing Toolkit\CUDA\v7.5\include\device_launch_parameters.h</strong> に定義されています。 字面からみればスレッドIDです。 <strong>CUDA_C_Programming_Guide.pdf</strong> がありますのでそれを見ます。</p><blockquote><p>B.4.4. threadIdx This variable is of type uint3 (see char, short, int, long, longlong, float, double ) and contains the thread index within the block.</p></blockquote><p>[code] 訳: B.4.4. threadIdx この変数はuint3 (char, short, int, long, longlong, float, double) 型であり、ブロック内のスレッドインデックスです。 [/code] とあります。 字面の通りということでしょう。 だとするならば、CUDAはスレッド処理を実行しているはずです。ゆえに、CPUのような計算量推測ができなかったのでしょう。 では、どこでスレッドの起動を指定しているのか、というと [code lang=”cpp”] // Launch a kernel on the GPU with one thread for each element. addKernel &lt;&lt; &lt;1, size &gt;&gt; &gt;(dev_c, dev_a, dev_b, g_loop); [/code] の <strong>&lt;1, size &gt;</strong> とのこと。 これは、1ブロックにつき最大sizeスレッドで関数を実行せよ、という意味らしい。 <a href="http://www.gdep.jp/page/view/253">第6回　CUDAプログラミングモデル①</a>によれば、指定できるスレッド数は512が限界とのこと。 なので、現在sizeは配列長さと等しい。 つまり、配列の 1 要素に対して、1スレッドで動作するため、配列長さを10倍にしても、処理時間が変化しなかったのである。 ともすれば、GPUはCPUのスピードにはかなわないが、大量のスレッドでその分作業をこなすことで、高速化を図るしか道がないことになる。 なので、CPUは単純に配列長に比例し、GPUは配列長の影響を受けないので、配列帳が7-8倍になれば、ホストとデバイスの処理結果が近似または逆転するはずである。 試しに配列長を400にしてみた。 (倍数+1しないと一致しないはず) [code lang=”sh”] CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {5778} No CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {5295} [/code] 思い切って512にしてみる。 [code lang=”sh”] CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {7489} No CUDA is {1,2,3,4,5} + {10,20,30,40,50} = {11,22,33,44,55} time = {6686} [/code] 追いつかない…</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>なんで、CUDAがとてつもなく遅かったのかは原因がつかめました。 が、期待した速度が出ていないこともまた事実。 次回は、もう少し原因を探っていきたいです。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CUDA2">https://github.com/takuya-takeuchi/Demo/tree/master/CUDA2</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> gpupu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでGPUPUを試してみる CUDA編 第1回</title>
      <link href="/2016/02/14/726/"/>
      <url>/2016/02/14/726/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-bv">前回</a>は環境構築をしました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>ちょっと余所事を。 どうして.NETでGPUPUをやるかというと、WPFやWinFormsでUIは簡単に作れるからというのがあります。 別に、C++でもできなくはないでしょうが、やっぱり自分の実力も考えるとそれが妥当です。 .NETを使っていてよく言われるのが、</p><p><strong>パフォーマンスがねぇ…</strong></p><p>というセリフ。 そこは否定しません。NGENで最適化しようが、ポインタをフル活用しようが、どうやったって、ハードに近い部分を触れるC、C++に勝てるはずがありません。 でも開発効率はC#のが断然高いです。 どっちが優れている、というつもりもないです。 言いたいのは、どっちもいいとこどりをしたいんです。 C#側からは、時間のかかる処理はC++に任せたい C++側からは、リッチなUIをC#に任せたい というWin&amp;Winな関係を作りたいんです。 正直、このご時世に頑なにMFCを使う理由がわからないんですよ。 デモアプリであっても。 もうちょっと見た目にも気を使ってほしいなあ。って。 といったところです。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="CUDAことはじめ"><a href="#CUDAことはじめ" class="headerlink" title="CUDAことはじめ"></a>CUDAことはじめ</h2><p>インストールが完了し、<strong>Visual Studio</strong> から <strong>新しいプロジェクト</strong>、<strong>インストール済み</strong>を選ぶと、<strong>NVIDIA</strong> とその下に <strong>CUDA X.X</strong> が追加されています。 (2010、2012、2013のみ。2015と2008は対象外でした。)<br><a href="../../../../public/2015/12/47e4add7ca4d3d0c818cbd5c4234bce9.png"><img src="../../../../public/2015/12/47e4add7ca4d3d0c818cbd5c4234bce9.png"></a></p><p>これを選択してプロジェクトを作成すると、C++のプロジェクトができ、<strong>kernel.cu</strong> というコードが表示されます。 これはサンプルのプログラムです。 まずはビルドしてみます。 バッチビルドを開くと、<strong>Win32</strong>、<strong>x64</strong> が対象になっています。 すべて選択してビルドしてみます。 警告がたくさん出ますが、一応ビルドが通ります。 実行すると<br><a href="../../../../public/2015/12/d69cf8eb94018b4b7da48a12673d4e69.png"><img src="../../../../public/2015/12/d69cf8eb94018b4b7da48a12673d4e69.png"></a></p><p>となります。 単純に、同一長のint配列の同一のindexの値同士の和を計算するプログラムです。 無事にCUDAが動いていることが確認できました。</p><h2 id="CUDAの実力"><a href="#CUDAの実力" class="headerlink" title="CUDAの実力"></a>CUDAの実力</h2><p>でも、これだとCUDAがすごいのかがよくわかりません。 私の開発機、</p><ul><li>Intel Core i7-2600 3.40GHz</li><li>Windows 7 Ultimate SP1 64bit</li><li>16.0GB</li></ul><p>なので、最新とは言えないですが、今でもバリバリ現役です。 なので、CPUのがひょっとしたらすごいかもしれません。 なので、試してみることにしました。 サンプルの計算を10000回繰り返して、経過した時間をCUDAと非CUDA、つまりC++の普通の実装で勝負させます。 私のC++のソースが酷いのは、<strong>お察しください</strong>。 どうでもいいけど、<strong>ReSharper C++</strong> すごいよーー！！ちゃんとインクルードが足りないと指摘してくれるよ！！しかも <strong>C++11</strong>。 こんな感じ <script src="https://gist.github.com/takuya-takeuchi/75c48bd9fb4a08a157d503269648b0b1.js"></script> 結果は、 <script src="https://gist.github.com/takuya-takeuchi/5cb192f5a3addd1da1223c21299f0c46.js"></script></p><p><strong>CUDA惨敗</strong></p><p>はぁ！？</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まぁ明らかに演出な結果ですが、ここまでひどいとは思いませんでした。 当初はループ回数10000000回でしたけど、全く終わらなかったくらいですからwww 次回は原因の究明と解決を。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/CUDA1">https://github.com/takuya-takeuchi/Demo/tree/master/CUDA1</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> gpupu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでGPUPUを試してみる CUDA編 第0回</title>
      <link href="/2016/02/11/713/"/>
      <url>/2016/02/11/713/</url>
      
        <content type="html"><![CDATA[<p>とりあえず環境構築だけ。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>GPUPU</strong>とは、<a href="https://ja.wikipedia.org/wiki/GPGPU">Wiki先生</a>によれば、</p><blockquote><p>GPGPU（General-purpose computing on graphics processing units; GPUによる汎目的計算）とは、GPUの演算資源を画像処理以外の目的に応用する技術のことである。</p></blockquote><p>だそうな。 その一技術として各社からいろんなものが出ています。</p><ul><li>CUDA</li><li>AMD Accelerated Parallel Processing</li><li>OpenCL</li></ul><p><strong>CUDA</strong> Compute Unified Device Architecture。通称CUDA。 <strong>nVidia</strong> から発表。 <strong>AMD Accelerated Parallel Processing</strong> <strong>AMD</strong> に買収された <strong>ATI</strong> の <strong>ATI Stream</strong> の新しい名前。 <strong>OpenCL</strong> 並列コンピューティングのオープンな仕様。その一部としてGPUPUが使える。</p><p>といったところです。 で、今回はCUDAを導入していきます。 個人的に一番勢いがある、と思っているからです。 ATI?なんか死にそう 資料も豊富で、<strong>C++/CLI</strong> を介して.NETで使うことも可能なので、CUDAを選びました。 いや、ATIもOpenCLもきっとそうなんでしょうけど。 何よりも、私のマシンに入っているのがnVidiaというのもあります。 ちなみに、<strong>NVIDIA GeForce GTX 550 Ti</strong> です。 <a href="https://developer.nvidia.com/cuda-gpus">CUDA GPUs</a> というページで、GeForce のCUDA対応状況を見れますが、<strong>2.1</strong>。という数値。 これ、最低は <strong>2.0</strong> ですね。 この数値は性能を表しているわけではないですが、ちょっと悲しい。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p><a href="https://developer.nvidia.com/cuda-downloads">ここから</a>開発に必要な <strong>CUDA Toolkit</strong> をダウンロード。 執筆時点では7.5が最新です。 インストールは下記のような感じ。<br><a href="../../../../public/2015/12/debf3ad758ebe289fd1d138471a7f7ce.png"><img src="../../../../public/2015/12/debf3ad758ebe289fd1d138471a7f7ce.png"></a></p><p><a href="../../../../public/2015/12/eacfc9071588c201fa2ef12fcd02775a.png"><img src="../../../../public/2015/12/eacfc9071588c201fa2ef12fcd02775a.png"></a></p><p><a href="../../../../public/2015/12/147e994a32c35e14a311a37ee5bda5fb.png"><img src="../../../../public/2015/12/147e994a32c35e14a311a37ee5bda5fb.png"></a></p><p><a href="../../../../public/2015/12/0298d98a3d4673b0a3eaf9d21e754239.png"><img src="../../../../public/2015/12/0298d98a3d4673b0a3eaf9d21e754239.png"></a></p><p><a href="../../../../public/2015/12/695a64e2d8d85e1e3333eb6e3e02ccc2.png"><img src="../../../../public/2015/12/695a64e2d8d85e1e3333eb6e3e02ccc2.png"></a></p><p><a href="../../../../public/2015/12/41b65959c271aa2a56191ce926da9568.png"><img src="../../../../public/2015/12/41b65959c271aa2a56191ce926da9568.png"></a></p><p><a href="../../../../public/2015/12/04bce5395336e24b405ec5a033ab970e.png"><img src="../../../../public/2015/12/04bce5395336e24b405ec5a033ab970e.png"></a></p><p>ひたすら、次へで進めていくだけの作業です。 途中でディスプレイドライバーのインストール許可を求められますが、OKを。<br><a href="../../../../public/2015/12/e685bbd8500c2b1b04e73e693366ff92.png"><img src="../../../../public/2015/12/e685bbd8500c2b1b04e73e693366ff92.png"></a></p><p>Visual Studio に Nsight Visual Studio Edtion なるものが追加されたようだ。 <a href="http://www.nvidia.co.jp/object/nsight-jp.html">NVIDIA Nsight</a>によればデバッグ支援ツールのよう。<br><a href="../../../../public/2015/12/9b90ad2cc94cbb5acb50a0c3b3df9dae.png"><img src="../../../../public/2015/12/9b90ad2cc94cbb5acb50a0c3b3df9dae.png"></a></p><p>インストール終了。</p><h2 id="環境チェック"><a href="#環境チェック" class="headerlink" title="環境チェック"></a>環境チェック</h2><p>きちんとインストールできたかを確認します。 コマンドプロンプトから下記のコマンドをたたいて結果を確認。 [code lang=”sh”] $ nvcc -V nvcc: NVIDIA (R) Cuda compiler driver Copyright (c) 2005-2015 NVIDIA Corporation Built on Tue_Aug_11_14:49:10_CDT_2015 Cuda compilation tools, release 7.5, V7.5.17 [/code] きちんとインストールされていれば、環境変数が正しく設定されて、バージョン情報が見えます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回はインストールまで。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> gpupu </category>
          
          <category> CUDA </category>
          
          <category> GPUPU </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 最終回</title>
      <link href="/2016/01/09/705/"/>
      <url>/2016/01/09/705/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-bd">前回</a>はインデックスの作成を行い、パフォーマンスの改善を達成しました。今回はデータベースのメンテナンスを実施したいと思います。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>長期にわたってデータベースを利用していると、色々問題が発生してきます。 不要なインデックス、ログ、ジャーナルファイル、未使用領域の削除等。 そういう無駄をそぎ落とし、使い始めた頃の輝きを取り戻すためにメンテナンスが必要です。 NoSQLに限らずRDBMSでも当然の機能です。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="Compact"><a href="#Compact" class="headerlink" title="Compact"></a>Compact</h2><p><a href="https://docs.mongodb.org/manual/reference/command/compact/">compact</a>によれば、</p><blockquote><p>Rewrites and defragments all data and indexes in a collection. On WiredTiger databases, this command will release unneeded disk space to the operating system.</p></blockquote><p><code>訳: コレクション内のすべてのデータ、インデックスの書き直しとデフラグを実行します。WiredTigerデータベースにおいて、このコマンドはオペレーティングシステムへ不要なディスク領域を変換します。</code> と言っています。 最後の一文が魅力的です。 ちょっと補足ですが、<strong>WiredTiger</strong> とは、MongoDBで採用しているストレージモデルです。 MongoDBでは下記の3モデルを利用可能です。</p><ul><li><strong>MMAPv1 Storage Engine</strong></li><li><strong>WiredTiger Storage Engine</strong></li><li><strong>In-Memory Storage Engine</strong></li></ul><p><strong>MMAPv1 Storage Engine</strong> MongoDB 3.2までは既定のストレージエンジンだったモデルです。 <strong>WiredTiger Storage Engine</strong> MongoDB 3.0から採用された新ストレージエンジン。64bitで利用可能です。 マルチバージョン同時事実行コントロールを採用。オペレーション実行時、WiredTigerはデータのその時点でのスナップショットをトランザクションに提供します。スナップショットはインメモリーデータの一貫したビューを表します。 <strong>In-Memory Storage Engine</strong> MongoDB Enterprise 3.2から始まった、64bitビルドで利用可能な。ベータテストを目的としたエンジンです。いくつかのメタデータを除き。インメモリストレージエンジンはディスク上にデータを維持せず、ディスクI/Oを避けるため、データベースオペレーションの予測可能な待ち時間を許容します。 実際にCompactコマンドを実行します。 対象はコレクションです。 現在私の環境には、5つのデータベースにそれぞれ1つのコレクションが存在します。 それらすべてにCompactコマンドを実施します。 コマンドの実行は下記になります。</p><blockquote><p><strong>WARNING</strong> Always have an up-to-date backup before performing server maintenance such as the compact operation.</p></blockquote><p><code>訳: **警告** compactオペレーションのようなサーバメンテナンスを実行する前に、常に最新のバックアップを取得してください</code> [code lang=”sh”] $ mongo –port 27017 &gt; use admin switched to db admin &gt; db.auth(“admin”,”password”) 1 &gt; use hogehoge &gt; db.runCommand ( { compact: ‘foo’}) { “ok” : 1 } [/code] データベースの修正が必要なので、admin権限で一度認証を通すためにadminデータベースにつないで認証します。 その後、対象のデータベースにつないでコレクション名を指定してコマンドを発行します。 私の環境だとすぐに結果が返ってきました。 下記は実行前後のデータベースの情報をmongo-expressで確認した結果です。 [table id=20 /] 変化した個所が1箇所しかないですし、微々たる変化です。 ストレージフォルダのサイズも <strong>19.5 GB (20,976,769,972 バイト)</strong> から <strong>19.5 GB (20,976,930,330 バイト)</strong> になって、むしろ増えています。 Insert,Select,インデックスの設定くらいしかしていないと、変化しないのでしょうね。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>かなり端折ったところもありますが、これで一区切りつけます。 自分としては、Insert,Select.Dropができればそれでよいデータベースが欲しく、SQLとか面倒だと思って、NoSQLの検討を始めた次第でしたが、思った以上にボリュームの多い内容になりました。 結論としては、MongoDBは、私には向かないかなぁ、って思いました。 MongoDBの採用するドキュメント型の仕組みは、キーと値がセットになっているがゆえに、型がわからないと復元もままならないご様子。 そこまで厳密な型付けは求めていません。 とはいうものの、拡張していくことを考えると、これはこれで問題ないのでしょうけど。 また、Node.jsに踏み込むとは、始めた時は全く考えていませんでした。 こういう思わぬ驚きがあるのが、テクノロジーの世界なんですね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> オープンソース </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> JavaScript </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> mongodb </category>
          
          <category> NoSQL </category>
          
          <category> mongo-express </category>
          
          <category> javascript </category>
          
          <category> Node.js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows 10 Mobile Insider Preview に遅まきながら参加</title>
      <link href="/2016/01/06/774/"/>
      <url>/2016/01/06/774/</url>
      
        <content type="html"><![CDATA[<p>1年前のアメリカ出張の際に <strong>Amazon.com</strong> で注文した <strong>Lumia635</strong> を Windows 10 Mobile Insider Preview にアップデートしました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>手順は、アプリをダウンロードしてきて、そこから Insider Preview の Fast Ring 参加を設定することで設定から更新プログラム、すなわち Window 10 Mobileを適用できるという仕組みです。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="更新-更新-更新"><a href="#更新-更新-更新" class="headerlink" title="更新!更新!!更新!!!"></a>更新!更新!!更新!!!</h2><p>1. 端末のブラウザから<a href="http://windows.microsoft.com/ja-jp/windows/preview-download-phone">ダウンロードページ</a>にアクセスしアプリを入手 2. アプリを起動する<br><a href="../../../../public/2016/01/1.png"><img src="../../../../public/2016/01/1-180x300.png"></a></p><p><a href="../../../../public/2016/01/2.png"><img src="../../../../public/2016/01/2-180x300.png"></a></p><p>3. 設定から更新画面に移動して、更新プログラムの確認とインストールを実行<br><a href="../../../../public/2016/01/3.png"><img src="../../../../public/2016/01/3-180x300.png"></a></p><p><a href="../../../../public/2016/01/4.png"><img src="../../../../public/2016/01/4-180x300.png"></a></p><p><a href="../../../../public/2016/01/5.png"><img src="../../../../public/2016/01/5-180x300.png"></a></p><p><a href="../../../../public/2016/01/6.png"><img src="../../../../public/2016/01/6-180x300.png"></a></p><p><a href="../../../../public/2016/01/7.png"><img src="../../../../public/2016/01/7-180x300.png"></a></p><p><a href="../../../../public/2016/01/8.png"><img src="../../../../public/2016/01/8-180x300.png"></a></p><p><a href="../../../../public/2016/01/10.png"><img src="../../../../public/2016/01/10-180x300.png"></a></p><p>4. この時点では、8.1になっただけでした。<br><a href="../../../../public/2016/01/9.png"><img src="../../../../public/2016/01/9-180x300.png"></a></p><p>5. Cortana が追加されました。<br><a href="../../../../public/2016/01/11.png"><img src="../../../../public/2016/01/11-180x300.png"></a></p><p>6. 何回か設定-&gt;更新プログラムを繰り返してアップデートするとようやく完成。<br><a href="../../../../public/2016/01/12.png"><img src="../../../../public/2016/01/12-180x300.png"></a></p><p><a href="../../../../public/2016/01/13.png"><img src="../../../../public/2016/01/13-180x300.png"></a></p><p>やったね。 アップデート直後はなぜかスクリーンショットの作成に失敗する旨のメッセージが出て、スクリーンショットがとれませんでしたが、再起動とか何回かしているとできるようになります。</p><h2 id="フォトが使いにくい"><a href="#フォトが使いにくい" class="headerlink" title="フォトが使いにくい"></a>フォトが使いにくい</h2><p>アップデート前はどうだったかはわかりませんが、<strong>OneDrive</strong> へのアップロードの際、写真を複数選択してShareしてもアップロードされるのは先頭のアイテムのみでした。 これ、バグでしょ？Connectに報告するか？</p><p><strong>2016/01/08 更新</strong></p><p>最新版のOneDriveアプリ(17.6.1)に更新したら直りました。 OneDriveはOSアップデートで更新されなかったのね…</p><p><strong>2016/01/07 更新</strong></p><p><a href="http://answers.microsoft.com/en-us/insider/forum/insider_wintp-insider_files/can-not-upload-multiple-photo-files-to-onedrive/92e4a55e-9e5b-460d-97e4-c7b1d0a60e1c?tm=1452093058005">Microsoft Community</a> に投稿しました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>時間はかかりますが、アップデート終了です。 しょぼい端末なので、気持ちもっさりですが… まもなく正式公開ですが、一足早くWindows Mobile 10を体験したい方はどうぞ。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Windows Phone </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 第7回</title>
      <link href="/2016/01/06/695/"/>
      <url>/2016/01/06/695/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-b8">前回</a>はデータの読み込みのパフォーマンス測定を実施しました。今回はインデックスの作成を行い、読み込み性能の改善を行いたいと思います。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回は、結果も課程も散々でした。 環境は前回と同じです。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="インデックスの設定"><a href="#インデックスの設定" class="headerlink" title="インデックスの設定"></a>インデックスの設定</h2><p><a href="https://docs.mongodb.org/getting-started/csharp/indexes/">Indexes with C# Driver</a>によれば、</p><blockquote><p>Indexes can support the efficient execution of queries. MongoDB automatically creates an index on the _id field upon the creation of a collection.</p></blockquote><p><code>訳: インデックスは効率的なクエリの実行をサポートすることができます。MongoDBは自動的に _id フィールド上にコレクション作成時にインデックスを作成します。</code> と言っています。 既にインデックスが張られているといっています。 といっても、_idフィールドなので、これまでの検索には影響しないと思います。 追加で設定する場合は、</p><blockquote><p>var keys = Builders.IndexKeys.Ascending().Ascending(); await collection.Indexes.CreateOneAsync(keys);</p></blockquote><p>と、するようです。 というわけで、前回の3種のオブジェクトの <strong>No プロパティ</strong> に昇順のインデックスを設定してみます。 こんな感じです。 [code lang=”csharp”] private static void SetSmallIndex(MongoClient mongoClient) { Console.WriteLine(“SetSmallIndex”);<br>var database = mongoClient.GetDatabase(DatabaseName); var collection = database.GetCollection<SmallObjectData>(CollectionName);<br>var keys = Builders<SmallObjectData>.IndexKeys.Ascending(“No”); collection.Indexes.CreateOne(keys); } [/code]</p><h2 id="インデックスの設定後"><a href="#インデックスの設定後" class="headerlink" title="インデックスの設定後"></a>インデックスの設定後</h2><p>割と時間がかかりました。1,000,000件も登録されていればそうでしょう。 <a href="../../../../public/2015/12/Index.png"><img src="../../../../public/2015/12/Index.png" alt="Index"></a></p><p>mongo-expressで確認すると、<strong>Indexes #</strong> が 2 になっています。 そして、前回と同じように、検索を実行します。検索結果の個数は10になります。 その結果が下記になります。 [table id=18 /] 劇的に改善しました。370倍です。Largeに至っては計測できるようにさえなりました。 Smallが悪化してますが、誤差でしょう。多分。 実行後、<strong>mongod.exe</strong> のメモリ量は大きく増えていません。</p><h2 id="検索結果の個数は影響するか？"><a href="#検索結果の個数は影響するか？" class="headerlink" title="検索結果の個数は影響するか？"></a>検索結果の個数は影響するか？</h2><p>前回、メモリ確保が原因なのか、途中で例外を投げて落ちました。 今回は、検索結果の個数が1,000,000から10になるようにしてあります。 では、これを変化させたら、検索速度はどう変化するでしょうか？ 1,000,000件のデータを対象に、検索結果の個数が増えていった場合のパフォーマンスを下記に記載します。 [table id=19 /] 増えていくごとに悪化していく傾向です。 ただし、劇的に悪化しているのは、初回のクエリだけ100秒とかで、それ以降はキャッシュが聞いています。それでも、後半は <strong>2,000 ms</strong> とかかかっていますが。 それでも、インデックスを設定する前と比べたら、劇的すぎる改善です。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>バイナリファイルを扱う際は、必ずインデックスを設定し、検索のパフォーマンスを向上させるのと、検索途中の結果でOutOfMemoryExceptionを発生させないようにする必要があります。 必要なら複数のインデックスを設定して、結果が少なくなるようするべきです。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p>テストに使った最終的なコードは下記になります。 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB7">https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB7</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> オープンソース </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> JavaScript </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> mongodb </category>
          
          <category> NoSQL </category>
          
          <category> mongo-express </category>
          
          <category> javascript </category>
          
          <category> Node.js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 第6回</title>
      <link href="/2016/01/05/690/"/>
      <url>/2016/01/05/690/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-aY">前回</a>はデータの書き込みのパフォーマンス測定を実施しました。今回はデータの読み込みのパフォーマンス測定を行いたいと思います。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>結果はともかく、測定の課程は散々でした。 <strong>InsertOne</strong> してもメモリが解放されないのもあれですが。 環境は前回と同じです。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="Read-Small-Objects"><a href="#Read-Small-Objects" class="headerlink" title="Read Small Objects"></a>Read Small Objects</h2><p>まず、下記のオブジェクトを1,000,000個書き込みます。 データベースは、<strong>SmallObjectData</strong>、コレクション名は、<strong>SmallObjectData</strong> です。 [code lang=”csharp”] public sealed class SmallObjectData {<br>public ObjectId Id { get; set; }<br>public int No { set; get; }<br>public DateTime Established { get; set; }<br>} [/code] <strong>No プロパティ</strong>には 0 から 999,999 が入ります。 そのあと、<strong>No プロパティ</strong>を 100000 で剰余した余りが0のものだけを Select します。 下記のようなコードになります。 [code lang=”csharp”] var collection = database.GetCollection<SmallObjectData>(CollectionName); var list = collection.FindSync(data =&gt; data.No % 100000 == 0).ToList(); [/code] ToList メソッドをコールしているのは、この時点で検索結果を確定して、オブジェクトを取得するためです。 IEnumerable の場合、実際に使用するまでは、評価はされないので。 試行回数は3回で、平均値をとっています。 が、どうも最初だけ遅くて、あとはキャッシュが効いている感じがします。 なので、10回の試行で平均値をとります。 平均は<strong>420.8 ms</strong> でした。</p><h2 id="Read-Large-Objects"><a href="#Read-Large-Objects" class="headerlink" title="Read Large Objects"></a>Read Large Objects</h2><p>まず、下記のオブジェクトを1,000,000個書き込みます。 データベースは、<strong>LargeObjectData</strong>、コレクション名は、<strong>LargeObjectData</strong> です。 [code lang=”csharp”] public sealed class LargeObjectData {<br>public ObjectId Id { get; set; }<br>public int No { set; get; }<br>public byte[] DataBytes { set; get; }<br>public DateTime Established { get; set; }<br>} [/code] <strong>No プロパティ</strong>には 0 から 999,999 が入ります。 そのあと、<strong>No プロパティ</strong>を 100000 で剰余した余りが0のものだけを Select します。 Select コードは前段と同じです。</p><h5 id="が、結論から言うと、計測できませんでした。"><a href="#が、結論から言うと、計測できませんでした。" class="headerlink" title="が、結論から言うと、計測できませんでした。"></a><strong>が、結論から言うと、計測できませんでした。</strong></h5><p>剰余する数を増やそうが減らそうがとにかく、<strong>mongod.exe</strong> が <strong>OutOfMemoryException</strong> でこけます。 Selectする段階で、途中結果を解放していないのかしりませんが、メモリが急激に増えていって、こけます。 例外は、 [code] ハンドルされていない例外: System.FormatException: An error occurred while deserializing the DataBytes property of class MongoDB7.Program+MiddleObjectData: 種類 ‘System.OutOfMemoryException’ の例外がスローされました。 —&gt; System.OutOfMemoryException: 種類 ‘System.OutOfMemoryException’ の例外がスローされました。 場所 MongoDB.Bson.IO.BsonStreamExtensions.ReadBytes(BsonStream stream, Int32 count) 場所 MongoDB.Bson.IO.BsonBinaryReader.ReadBytes() 場所 MongoDB.Bson.Serialization.Serializers.ByteArraySerializer.DeserializeValue(BsonDeserializationContext context, BsonDeserializationArgs args) 場所 MongoDB.Bson.Serialization.Serializers.SealedClassSerializerBase`1.Deserialize(BsonDeserializationContext context, BsonDeserializationArgs args) 場所 MongoDB.Bson.Serialization.Serializers.SerializerBase`1.MongoDB.Bson.Serialization.IBsonSerializer.Deserialize(BsonDeserializationContext context, BsonDeserializationArgs args) 場所 MongoDB.Bson.Serialization.IBsonSerializerExtensions.Deserialize(IBsonSerializer serializer, BsonDeserializationContext context) 場所 MongoDB.Bson.Serialization.BsonClassMapSerializer`1.DeserializeMemberValue(BsonDeserializationContext context, BsonMemberMap memberMap) — 内部例外スタック トレースの終わり — 場所 MongoDB.Bson.Serialization.BsonClassMapSerializer`1.DeserializeMemberValue(BsonDeserializationContext context, BsonMemberMap memberMap) 場所 MongoDB.Bson.Serialization.BsonClassMapSerializer`1.DeserializeClass(BsonDeserializationContext context) 場所 MongoDB.Bson.Serialization.BsonClassMapSerializer`1.Deserialize(BsonDeserializationContext context, BsonDeserializationArgs args) 場所 MongoDB.Bson.Serialization.IBsonSerializerExtensions.Deserialize[TValue](IBsonSerializer`1 serializer, BsonDeserializationContext context) 場所 MongoDB.Driver.Core.Operations.CursorBatchDeserializationHelper.DeserializeBatch[TDocument](RawBsonArray batch, IBsonSerializer`1 documentSerializer, MessageEncoderSettings messageEncoderSettings) 場所 MongoDB.Driver.Core.Operations.AsyncCursor`1.CreateCursorBatch(BsonDocument result) 場所 MongoDB.Driver.Core.Operations.AsyncCursor`1.ExecuteGetMoreCommand(IChannelHandle channel, CancellationToken cancellationToken) 場所 MongoDB.Driver.Core.Operations.AsyncCursor`1.GetNextBatch(CancellationToken cancellationToken) 場所 MongoDB.Driver.Core.Operations.AsyncCursor`1.MoveNext(CancellationToken cancellationToken) 場所 MongoDB.Driver.IAsyncCursorExtensions.ToList[TDocument](IAsyncCursor`1 source, CancellationToken cancellationToken) 場所 MongoDB.Driver.IAsyncCursorSourceExtensions.ToList[TDocument](IAsyncCursorSource`1 source, CancellationToken cancellationToken) [/code] とでます。 <strong>ReadBytes</strong> とあるので、mongod.exe からの結果の受け渡しか何かのためのバッファを作成するために、マネージドにメモリを作った際、LOHがたくさんあって、メモリが確保できずに例外発生、というように見えます。</p><h2 id="Read-Middle-Objects"><a href="#Read-Middle-Objects" class="headerlink" title="Read Middle Objects"></a>Read Middle Objects</h2><p>とにかくオブジェクトサイズを減らしてみます。 <strong>GC</strong> が苦手とする <strong>85,000</strong> が問題としか思えませんので、オブジェクト全体が 85,000 バイトを超えないようにします。 前段のオブジェクト同じですが、<strong>DataBytes</strong> の長さを <strong>80,000</strong> にします。 [code lang=”csharp”] public sealed class MiddleObjectData {<br>public ObjectId Id { get; set; }<br>public int No { set; get; }<br>public byte[] DataBytes { set; get; }<br>public DateTime Established { get; set; }<br>} [/code] これを1,000,000 個追加すると、下記の結果になりました。 Data Size 80.1 gb Storage Size 4.12 gb Avg Obj Size # 80.1 kb Objects # 1000000 これで一つのオブジェクトの復元で <strong>85,000 バイトを超えない</strong>ので、 <strong>LOH</strong> にならず、GC の影響を避けることができます。 これでこれまでと同じようにselectしてみます。 今度は成功しました。が、べらぼうに遅いです。 でも、オブジェクトサイズによって、何かしら致命的な影響があるように見えます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>3種のオブジェクトを検索した結果は下記になります。 [table id=17 /] .NETのGCの影響をもろに受けているとしか思えない感じです。 次回はインデックスを使って、検索速度の改善を試みたいと思います。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p>テストに使った最終的なコードは下記になります。 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB6">https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB7</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> オープンソース </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> JavaScript </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> mongodb </category>
          
          <category> NoSQL </category>
          
          <category> mongo-express </category>
          
          <category> javascript </category>
          
          <category> Node.js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 第5回</title>
      <link href="/2016/01/04/680/"/>
      <url>/2016/01/04/680/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ar">前回</a>は脇道にそれてパスワードの設定を実施しました。今回はデータの書き込みのパフォーマンス測定を行いたいと思います。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>NpSQLの売りはデータの読み書きです。RDBMSが持つ柔軟な集計や検索をある程度犠牲にして得た特徴ですが、どの程度凄いのでしょうか。 大量のデータの読み書きのパフォーマンスを計測してみます。 環境は OS:Windows 10 Pro 64bit CPU：Intel Core i3-4130 3.40GHz メモリ：16GB HDD：WesternDigital WD10EACS-22D6B0</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="Write-Small-Objects"><a href="#Write-Small-Objects" class="headerlink" title="Write Small Objects"></a>Write Small Objects</h2><p>下記のオブジェクトを1,000,000個書き込みます。 試行回数は3回で、平均値をとっています。 [code lang=”csharp”] public sealed class Data {<br>public ObjectId Id { get; set; }<br>public int No { set; get; }<br>public DateTime Established { get; set; }<br>} [/code] MongoDB上では、書き込みの結果、下記の数値が得られました。 Data Size 51.0 mb Storage Size 14.4 mb Avg Obj Size # 51.0 bytes Objects # 1000000 [table id=15 /] OneとManyは、Insertに使うメソッドの違いです。単一のオブジェクトの挿入かIEnumrableの挿入かの違いです。 差はないも同然でしたが。 一応書き込みは0.1-0.2ms/個のようです。これは速いのか？</p><h2 id="Write-Large-Objects"><a href="#Write-Large-Objects" class="headerlink" title="Write Large Objects"></a>Write Large Objects</h2><p>次は下記のオブジェクトを1,000,000個書き込みます。 [code lang=”csharp”] public sealed class LargeData {<br>public ObjectId Id { get; set; }<br>public byte[] DataBytes { set; get; }<br>public DateTime Established { get; set; }<br>} [/code] 試行回数は3回で、平均値をとっています。 byte[]のサイズは100,000です。少なくともGCが苦手とする85,000よりは大きくしました。 ですが、残念なことに、書き込み終わる前に <strong>OutOfMemoryException</strong> でサンプルプログラムが落ちました。 落ちた直後のデータベースは Data Size 100 gb Storage Size 8.22 gb Avg Obj Size # 100 kb Objects # 1000000 となっていました。 (まぁこれは、InsertOneによる結果ですが) <a href="../../../../public/2015/12/TaskManager.png"><img src="../../../../public/2015/12/TaskManager.png" alt="TaskManager"></a></p><p>恐ろしいマネージャー。 <a href="../../../../public/2015/12/Storage.png"><img src="../../../../public/2015/12/Storage.png" alt="Storage"></a></p><p>恐ろしいストレージ。 計測できないので、1桁落として、100,000個にします。 あと、データベースを一度全てリセットします。 が、これも落ちる。ちなみに落ちるのは、InsertMany メソッド。 ちょっとあれなので計算しました。 <strong>100,000(個)*100(kb)=9765MB</strong> とすると、半分ならギリギリ大丈夫？ …ダメでした。25,000でようやくOKでしたが、それでもメモリは5GB近く確保したままでした。 でも、InsertOneなら1,000,000個挿入しても、7GBまで保持しました。なんで？ このテスト、すっごいHDDに負荷かかる(白目) ずっとHDD、100%なんだぜ？ [table id=16 /] 参考値ですが、オブジェクト数とスピードは比例に近い感じですね。 あと、0.81ms/個のようです。こちらは単純にオブジェクトサイズには比例しないようですが。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>予想以上に苦労しました。 まさかOutOfMemoryExpcetionで躓くとは予想外でした。 パフォーマンスとしては、あまり良いとも悪いとも言えないです。 どこかでRDMBSで似たデータ構造の比較試験がないでしょうか？ 次は読み込みのパフォーマンス試験を予定です。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p>テストに使った最終的なコードは下記になります。 <a href="https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB5">https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB5</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> オープンソース </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> JavaScript </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> mongodb </category>
          
          <category> NoSQL </category>
          
          <category> mongo-express </category>
          
          <category> javascript </category>
          
          <category> Node.js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DynDNS の設定方法変更</title>
      <link href="/2016/01/03/771/"/>
      <url>/2016/01/03/771/</url>
      
        <content type="html"><![CDATA[<p><strong>buffalo</strong> のルータ <strong>WZR-1750DHP2</strong> で <strong>DDNS</strong> を使ってリモートアクセスを実現しているのですが、いつの間にか設定方法が変わっていたのでメモ。</p><a id="more"></a><p>以前は、ユーザ名とパスワードを設定することで同期を実現していたのですが、いつの間にかこの同期が失敗していることに気づきました。 そこで、DynDNSのページを見ていると見慣れない項目が。 <a href="../../../../public/2016/01/dyndns.png"><img src="../../../../public/2016/01/dyndns-300x118.png" alt="dyndns"></a></p><p><strong>Updater Client Key?</strong></p><blockquote><p>An updater client key can be used to authenticate an updater client with Dyn in place of a password. This provides additional security as the key cannot be used to manage your account on Dyn.com. This can be used in the official client from the ‘Resources’ section of the Dyn website, or in a hardware based client such as in many routers with DDNS support.</p></blockquote><p><code>訳: 更新クライアントキーは、パスワードに変わって、Dynが更新クライアントを認証するために使用されます。これは、Dyn.comのアカウントを管理するのに利用できないキーを追加のセキュリティとして提供します。これは、Dyn Webサイトのセクション Resource から公式クライアント、またはDDNSをサポートしている多数のルータのようなハードウェアベースで利用できます。</code> ってあります。 いつから、こんなのになってのさ。 というわけで、パスワードに入力する文字列をこのキーに変更すると無事に同期されるようになりました。</p>]]></content>
      
      
      <categories>
          
          <category> 雑記 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>codecademy 始めました</title>
      <link href="/2016/01/03/765/"/>
      <url>/2016/01/03/765/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.codecademy.com/">codecademy</a> という海外のプログラミング学習サイトで <strong>Python</strong> の学習を始めました。</p><a id="more"></a><p><strong>C#</strong> は十分使える (<strong>async/await</strong>、<strong>式木</strong> とかは超苦手) ので、第二言語として何か使えないかなぁ、って思って<strong>Python</strong> にしました。 一応Javaは使えるのですが、いかんせん <strong>Java5</strong> の知識。 読み書きにはさほど困らない程度ですが… <strong>Ruby</strong> にしようかなぁ、って思ったけど思った以上にWindowsで普及率が低い感じに見えるので断念。 <strong>RubyMine</strong> が使えるから、一応できなくはないのですが… 数ヶ月でものにできればいいなぁ。 最近はDeepLeaningとかなんだかんだでPythonを見かけることが多いので。 会社でもPythonを使ったプロジェクトが出たので、ソースを読めた方が良いでしょう、という目論見も。 とはいえ、今日日一個言語を覚えれば、読むだけなら何とかなると思います。</p><p><strong>あ、関数型は無理。</strong></p>]]></content>
      
      
      <categories>
          
          <category> %e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e8%a8%80%e8%aa%9e </category>
          
          <category> Python </category>
          
          <category> サービス紹介 </category>
          
          <category> プログラミング言語 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 第4回</title>
      <link href="/2016/01/03/665/"/>
      <url>/2016/01/03/665/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ar">前回</a>はデータを確認してみました。今回は少しわき道にそれてパスワードを設定します。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回まで、無防備状態でデータベースにアクセスしたり、サーバー走らせたりと、やりたい放題でした。<br>さすがにそれは不味い、ということでMongoDBとmongo-expressにパスワードを設定します。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="mongo-express"><a href="#mongo-express" class="headerlink" title="mongo-express"></a>mongo-express</h2><p>早急にこっちをどうにかします。サーバーの脆弱性、とかいうお寒い状態は嫌なので。<br><a href="https://github.com/andzdroid/mongo-express">公式ページ</a>によればパスワードは <strong>config.js</strong> を修正する、って書いてあります。</p><blockquote><p>ME_CONFIG_BASICAUTH_USERNAME ME_CONFIG_BASICAUTH_PASSWORD</p></blockquote><p>この2つのようです。<br>書きえて、mongo-expressを再起動します。<br>どうも、ローカルでインストールした場合、<strong>node app</strong> で動いているコマンドプロンプトを終了または <strong>Ctrl + C</strong> で落とせば終了するようです。<br>で、書き換えて再起動すると、ちゃんと変わっていることが確認できました。</p><h2 id="BASIC-認証ってださいよねー"><a href="#BASIC-認証ってださいよねー" class="headerlink" title="BASIC 認証ってださいよねー"></a>BASIC 認証ってださいよねー</h2><p>その名の通り。<br>というか1Passwordが使えないから面倒。<br>で、もう一度調べてみると。</p><blockquote><p>mongo-express login name. Sending an empty string will disable basic authentication.</p></blockquote><p><code>訳: mongo-expreessのログイン名。空文字列を送ると、BASIC認証を無効化。</code> という記述を発見。<br>ん？でもこれだと、ユーザー名はどうなるの？と思ったが試してみることに。<br>あれ？BASIC認証のまま。<br>というか、ユーザ名が空文字でパスワードが変わらないだけじゃん。<br>どうも、BASIC認証を無効にして、別の認証にするわけではなく、そもそも認証があるかどうかしかないようだ。<br>でも空文字にしても設定が有効じゃん。<br>試行錯誤した結果 [code lang=”diff”] - useBasicAuth: process.env.ME_CONFIG_BASICAUTH_USERNAME !== ‘’, + useBasicAuth: process.env.ME_CONFIG_BASICAUTH_USERNAME || false, </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">にすると、認証そのものがなくなり、さらなる無防備状態になるようだ。 </span><br><span class="line">もうこれでいいような。</span><br><span class="line"></span><br><span class="line">## MongoDB</span><br><span class="line"></span><br><span class="line">今度はこっちにパスワードを設定する。 </span><br><span class="line">mongo-expressからはそういうことはできないご様子。 </span><br><span class="line">ただ、さっきの **config.js** に \[code lang&#x3D;&quot;js&quot;\] &#x2F;&#x2F; &gt;&gt;&gt;&gt; If you are using an admin mongodb account, or no admin account exists, fill out section below &#x2F;&#x2F; &gt;&gt;&gt;&gt; Using an admin account allows you to view and edit all databases, and view stats </span><br></pre></td></tr></table></figure><p>という記述があるのを発見。<br>MongoDBにはAdminユーザがあるってこと？と思いぐぐる。<br><a href="https://docs.mongodb.org/v3.0/tutorial/enable-authentication/">Enable Client Access Control</a>によると、</p><blockquote><p>Considerations With access control enabled, ensure you have a user with userAdmin or userAdminAnyDatabase role in the admin database. You can create users before enabling access control or you can create users after enabling access control. If you enable access control before creating any user, MongoDB provides a localhost exception which allows you to create a user administrator in the admin database. Once created, authenticate as the user administrator to create additional users as needed.</p></blockquote><p><code>訳: 検討 アクセス制御を有効にすると、(あなたが)userAdminまたはuserAdminAnyDataaseロールを保持しているかどうかをadminデータベースで確認します。  (あなたが)アクセス制御を有効にする前にユーザーを作成することもできますし、アクセス制御を有効にした後でもユーザを作成することができます。もし、ユーザを作成する前にアクセス制御を有効にすると、MongoDBは、adminデータベース内にadministratorユーザを作成することを許可するlocalhost例外を提供します。一度作成すると、必要に応じて追加ユーザを作成するのにadministratorユーザとして認証します。</code> </p><p>とあるので、アクセス制御さえ有効にしてしまえば、外部からアクセスされる心配はないってことでは？ 少なくとも、外部からMongoDBにつなぐことは今のところないし。</p><p>でも一応管理者ユーザを作っておきます。</p><p>まずは、アクセス制御を有効にします。<br>現在はサービスとして有効にしているので、サービス起動時に読み込んでいる設定ファイルに必要な設定を書き込みます。<br>私の場合は、<strong>D:\MongoDB\mongd.cfg</strong> になります。<br><a href="https://docs.mongodb.org/manual/reference/configuration-options/#security-options">Configuration File Options</a> によれば、</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">security:</span></span><br><span class="line">   <span class="attr">authorization:</span> <span class="string">&lt;string&gt;</span> </span><br></pre></td></tr></table></figure><p>とある。<br>既定は <strong>disabled</strong> なので <strong>enabled</strong> で追加してみる。<br>次はユーザを追加する。 </p><p>まずはデータベースに接続します。ポート番号とは既定のままとします。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd c:\\Program Files\\MongoDB\\Server\\3.2\\bin mongo --port 27017 </span><br></pre></td></tr></table></figure><p>次にユーザを追加します。 </p><p>ユーザ名とパスワードは適宜変更を。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> use admin &gt; db.createUser( &#123; user: <span class="string">&quot;admin&quot;</span>, <span class="built_in">pwd</span>: <span class="string">&quot;password&quot;</span>, roles: \[ &#123; role: <span class="string">&quot;root&quot;</span>, db: <span class="string">&quot;admin&quot;</span> &#125; \] &#125;) </span></span><br></pre></td></tr></table></figure><p>上は、role に <strong>root</strong> を指定しています。<br>公式は <strong>userAdminAnyDatabase</strong> を使え、って言ってますが、それだと、mongo-expressが動きません。<br>これで <strong>3時間くらい</strong> 無駄にしました。 </p><p>入力が終わると、 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Successfully added user: &#123;</span><br><span class="line">        &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">        &quot;roles&quot; : [</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;role&quot; : &quot;root&quot;,</span><br><span class="line">                        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">                &#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>と出力されれば成功です。これでadminデータベースにadminユーザが追加されました。<br>一度exitで終了します。 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span> </span></span><br></pre></td></tr></table></figure><p>サービスを再起動します。<br>もう一度データベースに接続し、 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> use admin &gt; show users </span></span><br></pre></td></tr></table></figure><p>とすると </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-12-30T00:17:41.833+0900 E QUERY \[thread1\] Error: not authorized on admin to execute command &#123; usersInfo: 1.0 &#125; : </span><br></pre></td></tr></table></figure><p>と返ってきて認証エラーでユーザ一覧が表示できないことがわかります。<br>再度exitで終了しますが、今度は、 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo --port 27017 -u &quot;admin&quot; -p &quot;password&quot; --authenticationDatabase &quot;admin&quot; </span><br></pre></td></tr></table></figure><p>でログインし、adminデータベースにつないで、show usersします。<br>今度は、 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> show users &#123; <span class="string">&quot;\_id&quot;</span> : <span class="string">&quot;admin.admin&quot;</span>, <span class="string">&quot;user&quot;</span> : <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;db&quot;</span> : <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;roles&quot;</span> : \[ &#123; <span class="string">&quot;role&quot;</span> : <span class="string">&quot;root&quot;</span>, <span class="string">&quot;db&quot;</span> : <span class="string">&quot;admin&quot;</span> &#125; \] &#125; </span></span><br></pre></td></tr></table></figure><p>となり、認証機能が働いていることがわかります。</p><h2 id="mongo-expressのadmin対応"><a href="#mongo-expressのadmin対応" class="headerlink" title="mongo-expressのadmin対応"></a>mongo-expressのadmin対応</h2><p>もう一度、config.jsを開き、 </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//set admin to true if you want to turn on admin features</span><br><span class="line">//if admin is true, the auth list below will be ignored</span><br><span class="line">//if admin is true, you will need to enter an admin username/password below (if it is needed)</span><br><span class="line"><span class="attribute">admin</span>: false, </span><br></pre></td></tr></table></figure><p>を </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//set admin to true if you want to turn on admin features</span><br><span class="line">//if admin is true, the auth list below will be ignored</span><br><span class="line">//if admin is true, you will need to enter an admin username/password below (if it is needed)</span><br><span class="line"><span class="attribute">admin</span>: true, </span><br></pre></td></tr></table></figure><p>に修正。 </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//leave username and password empty if no admin account exists</span><br><span class="line"> <span class="attribute">adminUsername</span>: process.env.ME\_CONFIG\_MONGODB\_ADMINUSERNAME || &#x27;&#x27;, adminPassword: process.env.ME\_CONFIG\_MONGODB\_ADMINPASSWORD || &#x27;&#x27;, </span><br></pre></td></tr></table></figure><p>を </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//leave username and password empty if no admin account exists</span><br><span class="line"><span class="attribute">adminUsername</span>: process.env.ME\_CONFIG\_MONGODB\_ADMINUSERNAME || &#x27;admin&#x27;, adminPassword: process.env.ME\_CONFIG\_MONGODB\_ADMINPASSWORD || &#x27;password&#x27;, </span><br></pre></td></tr></table></figure><p>に修正。<br>ユーザ名とパスワードは適宜変更を。<br>これでmongo-expressが動きます。</p><h2 id="プログラムからもデータベースを操作"><a href="#プログラムからもデータベースを操作" class="headerlink" title="プログラムからもデータベースを操作"></a>プログラムからもデータベースを操作</h2><p>以前のプログラムで、TestConnect メソッドを呼ぶと、ListDatabases メソッドをコールした時点で下記の例外が発生します。 </p><p><code>型 &#39;MongoDB.Driver.MongoCommandException&#39; のハンドルされていない例外が MongoDB.Driver.Core.dll で発生しました 追加情報:Command listDatabases failed: not authorized on admin to execute command &#123; listDatabases: 1 &#125;.</code> </p><p>認証情報が足りないためなので、接続文字列を下記のように修正します。<br>修正後のソースは<a href="https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB4">こちら</a>。 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">string</span> UserName = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">string</span> Password = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> mongoClient = <span class="keyword">new</span> MongoClient(<span class="keyword">string</span>.Format(<span class="string">&quot;mongodb://&#123;0&#125;:&#123;1&#125;@localhost&quot;</span>, UserName, Password));</span><br><span class="line"></span><br><span class="line">    ・・TestConnect(mongoClient);</span><br><span class="line"></span><br><span class="line">    InsertData(mongoClient);</span><br><span class="line">    TestConnect(mongoClient);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Please enter any key...&quot;</span>);</span><br><span class="line">    Console.ReadKey();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ユーザ名とパスワードは適宜変更を。<br>これで新しいデータベースも追加できるようになりました。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>公式の罠にはまりましたが、何とかなりました。<br>詳しい原因はできたら次回以降に説明できればな、と思います。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB4">https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB4</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> JavaScript </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> mongodb </category>
          
          <category> NoSQL </category>
          
          <category> mongo-express </category>
          
          <category> javascript </category>
          
          <category> Node.js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 第3回</title>
      <link href="/2016/01/02/647/"/>
      <url>/2016/01/02/647/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-aj">前回</a>はデータを追加してみました。今回はデータを確認したいと思います。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>RDBMSとは勝手が違うのがNoSQLですが、思った以上にやっかいです。既存の概念が通じません。 というか、データを見たいのに、未だに追加したデータのフィールド名すら見れません。なので、可視化ツールを導入したいと思います。 公式ページ<a href="https://docs.mongodb.org/ecosystem/tools/administration-interfaces/">Admin UIs</a>によると、たくさんツールがあります。 <strong>mongo-express</strong> ってのがかっこいいですのでこれにします。 <strong>MongoHub</strong> が一番いいのですが、MacOX用…インストール先がWindows10なので…いちいちMacにつなげなおしたり、リモートで入りなおすのも面倒だし。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p><a href="https://www.npmjs.com/package/mongo-express">公式サイト</a> によると、 [code lang=”dos”] npm install mongo-express [/code] または [code lang=”dos”] npm install -g mongo-express [/code] でインストールできるって言っています。</p><p><strong>(-ω- ?) npm って何？Linux?</strong></p><p>調べました。 hashrock様の<a href="http://qiita.com/hashrock/items/15f4a4961183cfbb2658">フロントエンド開発の３ステップ（npmことはじめ）</a> によれば、</p><blockquote><p>npm installは、npmリポジトリからライブラリをダウンロードしてくるコマンドです。</p></blockquote><p>とあります。Nugetみたいなもんか。 というか、<strong>Node.js</strong> ってことはJavaScript。そんな環境ない、と思いました。そもそもJavaScriptなんて、ちょっとしか触ったことないです。 でも、ひらめいた。そういや<strong>Visual Studio 2015</strong>インストールするとき、そんなのあった気が。 <a href="../../../../public/2015/12/nodejs.png"><img src="../../../../public/2015/12/nodejs.png" alt="nodejs"></a></p><p><strong>おるでーーー^o^</strong> 素敵やん。 もうちょい調べたところ。npm使うと、グローバルとローカルでパッケージを分けることができるよう。 unageanu様の<a href="http://unageanu.hatenablog.com/entry/20150308/1425779692">npmの基本的な使い方まとめ</a>によれば、</p><blockquote><ul><li><strong>ローカルインストール</strong><ul><li>開発中のアプリが依存するライブラリをインストールする場合に利用します。</li><li>インストールしたモジュールは、プロジェクト内のみで使えます。<ul><li>同じマシンで開発している他のプロジェクトからは使えないので、それぞれで別のバージョンを使用したりできます。</li><li>モジュールは、/node_modules にインストールされます。</li></ul></li></ul></li><li><strong>グローバルインストール</strong><ul><li>grunt のような、マシン全体で共有できる<a href="http://d.hatena.ne.jp/keyword/%A5%C4%A1%BC%A5%EB">ツール</a>やライブラリをインストールする場合はこちら。</li><li>インストールしたモジュールは、マシン全体で共有されます。<ul><li>試した環境では、 –prefix=/usr/local を指定して<a href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>しているので、モジュールは/usr/local/lib/node_modules/ にインストールされました。</li><li><a href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3">パーミッション</a>に注意。EACCES エラーが起きる場合は、<a href="https://docs.npmjs.com/getting-started/fixing-npm-permissions">パーミッションか、インストール先を変更</a>します。</li></ul></li></ul></li></ul></blockquote><p>とのこと。今回はローカルかな。 管理者権限でコマンドプロンプトたちあげて、 [code lang=”dos”] cd c:\Program Files\MongoDB npm install mongo-express [/code] できたー！、というのは嘘。 エラーいっぱい出た。 [code lang=”shell”] npm WARN peerDependencies The peer dependency kerberos@~0.0 included from mongodb-core will no npm WARN peerDependencies longer be automatically installed to fulfill the peerDependency npm WARN peerDependencies in npm 3+. Your application will need to depend on it explicitly. / &gt; <a href="mailto:&#107;&#101;&#114;&#98;&#101;&#x72;&#111;&#115;&#x40;&#x30;&#x2e;&#x30;&#x2e;&#49;&#55;">&#107;&#101;&#114;&#98;&#101;&#x72;&#111;&#115;&#x40;&#x30;&#x2e;&#x30;&#x2e;&#49;&#55;</a> install C:\Program Files\MongoDB\node_modules\mongo-express\node_modules\mongodb\node_modules\kerberos &gt; (node-gyp rebuild) || (exit 0)<br>C:\Program Files\MongoDB\node_modules\mongo-express\node_modules\mongodb\node_modules\kerberos&gt;if not defined npm_config_node_gyp (node “C:\Program Files (x86)\nodejs\node_modules\npm\bin\node-gyp-bin\\..\..\node_modules\node-gyp\bin\node-gyp.js” rebuild ) else (rebuild) gyp ERR! configure error gyp ERR! stack Error: Can’t find Python executable “python”, you can set the PYTHON env variable. gyp ERR! stack at failNoPython (C:\Program Files (x86)\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:103:14) gyp ERR! stack at C:\Program Files (x86)\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:64:11 gyp ERR! stack at FSReqWrap.oncomplete (evalmachine.<anonymous>:95:15) gyp ERR! System Windows_NT 6.3.9600 gyp ERR! command “node” “C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js” “rebuild” gyp ERR! cwd C:\Program Files\MongoDB\node_modules\mongo-express\node_modules\mongodb\node_modules\kerberos gyp ERR! node -v v0.12.2 gyp ERR! node-gyp -v v1.0.3 gyp ERR! not ok <a href="mailto:&#x6d;&#111;&#x6e;&#x67;&#x6f;&#x2d;&#101;&#x78;&#x70;&#x72;&#101;&#x73;&#115;&#x40;&#48;&#x2e;&#x32;&#56;&#x2e;&#x38;">&#x6d;&#111;&#x6e;&#x67;&#x6f;&#x2d;&#101;&#x78;&#x70;&#x72;&#101;&#x73;&#115;&#x40;&#48;&#x2e;&#x32;&#56;&#x2e;&#x38;</a> node_modules\mongo-express ├── <a href="mailto:&#98;&#97;&#x73;&#105;&#99;&#45;&#97;&#117;&#x74;&#x68;&#x2d;&#x63;&#x6f;&#x6e;&#110;&#x65;&#99;&#116;&#64;&#x31;&#x2e;&#x30;&#46;&#48;">&#98;&#97;&#x73;&#105;&#99;&#45;&#97;&#117;&#x74;&#x68;&#x2d;&#x63;&#x6f;&#x6e;&#110;&#x65;&#99;&#116;&#64;&#x31;&#x2e;&#x30;&#46;&#48;</a> ├── <a href="mailto:&#x61;&#115;&#121;&#110;&#99;&#x40;&#49;&#46;&#x34;&#x2e;&#50;">&#x61;&#115;&#121;&#110;&#99;&#x40;&#49;&#46;&#x34;&#x2e;&#50;</a> ├── <a href="mailto:&#x63;&#111;&#110;&#115;&#111;&#108;&#x69;&#100;&#x61;&#116;&#101;&#64;&#x30;&#x2e;&#x31;&#50;&#46;&#x31;">&#x63;&#111;&#110;&#115;&#111;&#108;&#x69;&#100;&#x61;&#116;&#101;&#64;&#x30;&#x2e;&#x31;&#50;&#46;&#x31;</a> ├── <a href="mailto:&#x75;&#x6e;&#x64;&#x65;&#x72;&#115;&#99;&#x6f;&#114;&#x65;&#64;&#49;&#x2e;&#56;&#46;&#51;">&#x75;&#x6e;&#x64;&#x65;&#x72;&#115;&#99;&#x6f;&#114;&#x65;&#64;&#49;&#x2e;&#56;&#46;&#51;</a> ├── <a href="mailto:&#x63;&#x6f;&#111;&#x6b;&#105;&#101;&#45;&#112;&#x61;&#x72;&#x73;&#x65;&#x72;&#64;&#x31;&#x2e;&#x34;&#46;&#48;">&#x63;&#x6f;&#111;&#x6b;&#105;&#101;&#45;&#112;&#x61;&#x72;&#x73;&#x65;&#x72;&#64;&#x31;&#x2e;&#x34;&#46;&#48;</a> (<a href="mailto:&#99;&#x6f;&#111;&#x6b;&#105;&#101;&#x2d;&#115;&#x69;&#103;&#110;&#97;&#116;&#x75;&#114;&#x65;&#x40;&#49;&#46;&#48;&#x2e;&#54;">&#99;&#x6f;&#111;&#x6b;&#105;&#101;&#x2d;&#115;&#x69;&#103;&#110;&#97;&#116;&#x75;&#114;&#x65;&#x40;&#49;&#46;&#48;&#x2e;&#54;</a>, <a href="mailto:&#99;&#x6f;&#111;&#x6b;&#x69;&#x65;&#x40;&#x30;&#x2e;&#50;&#x2e;&#x32;">&#99;&#x6f;&#111;&#x6b;&#x69;&#x65;&#x40;&#x30;&#x2e;&#50;&#x2e;&#x32;</a>) ├── <a href="mailto:&#99;&#111;&#x6d;&#109;&#97;&#110;&#x64;&#x65;&#x72;&#x40;&#50;&#46;&#57;&#46;&#x30;">&#99;&#111;&#x6d;&#109;&#97;&#110;&#x64;&#x65;&#x72;&#x40;&#50;&#46;&#57;&#46;&#x30;</a> (<a href="mailto:&#x67;&#x72;&#x61;&#99;&#101;&#102;&#x75;&#108;&#x2d;&#x72;&#x65;&#97;&#x64;&#x6c;&#x69;&#x6e;&#107;&#64;&#49;&#x2e;&#x30;&#x2e;&#x31;">&#x67;&#x72;&#x61;&#99;&#101;&#102;&#x75;&#108;&#x2d;&#x72;&#x65;&#97;&#x64;&#x6c;&#x69;&#x6e;&#107;&#64;&#49;&#x2e;&#x30;&#x2e;&#x31;</a>) ├── <a href="mailto:&#x73;&#101;&#114;&#x76;&#101;&#x2d;&#102;&#97;&#x76;&#x69;&#x63;&#x6f;&#x6e;&#x40;&#x32;&#46;&#51;&#x2e;&#48;">&#x73;&#101;&#114;&#x76;&#101;&#x2d;&#102;&#97;&#x76;&#x69;&#x63;&#x6f;&#x6e;&#x40;&#x32;&#46;&#51;&#x2e;&#48;</a> (<a href="mailto:&#102;&#x72;&#x65;&#x73;&#104;&#x40;&#x30;&#46;&#51;&#46;&#x30;">&#102;&#x72;&#x65;&#x73;&#104;&#x40;&#x30;&#46;&#51;&#46;&#x30;</a>, <a href="mailto:&#x6d;&#x73;&#x40;&#x30;&#46;&#x37;&#46;&#49;">&#x6d;&#x73;&#x40;&#x30;&#46;&#x37;&#46;&#49;</a>, <a href="mailto:&#x65;&#x74;&#x61;&#x67;&#64;&#49;&#x2e;&#55;&#46;&#x30;">&#x65;&#x74;&#x61;&#x67;&#64;&#49;&#x2e;&#55;&#46;&#x30;</a>, <a href="mailto:&#x70;&#97;&#x72;&#115;&#101;&#x75;&#x72;&#x6c;&#64;&#x31;&#x2e;&#51;&#46;&#x30;">&#x70;&#97;&#x72;&#115;&#101;&#x75;&#x72;&#x6c;&#64;&#x31;&#x2e;&#51;&#46;&#x30;</a>) ├── <a href="mailto:&#109;&#x6f;&#114;&#103;&#97;&#110;&#x40;&#49;&#46;&#x36;&#46;&#x31;">&#109;&#x6f;&#114;&#103;&#97;&#110;&#x40;&#49;&#46;&#x36;&#46;&#x31;</a> (<a href="mailto:&#x6f;&#110;&#45;&#104;&#101;&#x61;&#x64;&#x65;&#114;&#x73;&#x40;&#49;&#x2e;&#x30;&#46;&#x31;">&#x6f;&#110;&#45;&#104;&#101;&#x61;&#x64;&#x65;&#114;&#x73;&#x40;&#49;&#x2e;&#x30;&#46;&#x31;</a>, <a href="mailto:&#x62;&#x61;&#115;&#105;&#99;&#45;&#x61;&#x75;&#116;&#x68;&#x40;&#x31;&#x2e;&#48;&#x2e;&#51;">&#x62;&#x61;&#115;&#105;&#99;&#45;&#x61;&#x75;&#116;&#x68;&#x40;&#x31;&#x2e;&#48;&#x2e;&#51;</a>, <a href="mailto:&#x64;&#x65;&#112;&#x64;&#64;&#x31;&#x2e;&#48;&#46;&#x31;">&#x64;&#x65;&#112;&#x64;&#64;&#x31;&#x2e;&#48;&#46;&#x31;</a>, <a href="mailto:&#100;&#x65;&#98;&#117;&#x67;&#64;&#50;&#46;&#50;&#46;&#x30;">&#100;&#x65;&#98;&#117;&#x67;&#64;&#50;&#46;&#50;&#46;&#x30;</a>, <a href="mailto:&#x6f;&#x6e;&#x2d;&#x66;&#x69;&#x6e;&#105;&#115;&#x68;&#101;&#x64;&#64;&#50;&#46;&#x33;&#46;&#x30;">&#x6f;&#x6e;&#x2d;&#x66;&#x69;&#x6e;&#105;&#115;&#x68;&#101;&#x64;&#64;&#50;&#46;&#x33;&#46;&#x30;</a>) ├── <a href="mailto:&#109;&#101;&#116;&#104;&#x6f;&#x64;&#x2d;&#111;&#x76;&#101;&#x72;&#x72;&#x69;&#x64;&#x65;&#64;&#x32;&#46;&#51;&#46;&#53;">&#109;&#101;&#116;&#104;&#x6f;&#x64;&#x2d;&#111;&#x76;&#101;&#x72;&#x72;&#x69;&#x64;&#x65;&#64;&#x32;&#46;&#51;&#46;&#53;</a> (<a href="mailto:&#x6d;&#101;&#116;&#104;&#111;&#100;&#x73;&#x40;&#49;&#x2e;&#49;&#x2e;&#49;">&#x6d;&#101;&#116;&#104;&#111;&#100;&#x73;&#x40;&#49;&#x2e;&#49;&#x2e;&#49;</a>, <a href="mailto:&#x76;&#97;&#x72;&#x79;&#64;&#49;&#46;&#48;&#46;&#x31;">&#x76;&#97;&#x72;&#x79;&#64;&#49;&#46;&#48;&#46;&#x31;</a>, <a href="mailto:&#112;&#97;&#x72;&#115;&#101;&#117;&#x72;&#x6c;&#x40;&#x31;&#x2e;&#51;&#46;&#x30;">&#112;&#97;&#x72;&#115;&#101;&#117;&#x72;&#x6c;&#x40;&#x31;&#x2e;&#51;&#46;&#x30;</a>, <a href="mailto:&#100;&#x65;&#x62;&#x75;&#103;&#64;&#x32;&#46;&#x32;&#46;&#48;">&#100;&#x65;&#x62;&#x75;&#103;&#64;&#x32;&#46;&#x32;&#46;&#48;</a>) ├── <a href="mailto:&#x65;&#x78;&#x70;&#x72;&#101;&#x73;&#115;&#45;&#115;&#101;&#x73;&#x73;&#105;&#111;&#110;&#x40;&#x31;&#46;&#x31;&#x31;&#x2e;&#51;">&#x65;&#x78;&#x70;&#x72;&#101;&#x73;&#115;&#45;&#115;&#101;&#x73;&#x73;&#105;&#111;&#110;&#x40;&#x31;&#46;&#x31;&#x31;&#x2e;&#51;</a> (<a href="mailto:&#x63;&#111;&#x6f;&#107;&#x69;&#101;&#45;&#115;&#x69;&#103;&#x6e;&#97;&#116;&#x75;&#114;&#x65;&#64;&#49;&#x2e;&#48;&#46;&#54;">&#x63;&#111;&#x6f;&#107;&#x69;&#101;&#45;&#115;&#x69;&#103;&#x6e;&#97;&#116;&#x75;&#114;&#x65;&#64;&#49;&#x2e;&#48;&#46;&#54;</a>, <a href="mailto:&#111;&#x6e;&#x2d;&#104;&#101;&#97;&#100;&#101;&#x72;&#115;&#64;&#49;&#x2e;&#x30;&#x2e;&#49;">&#111;&#x6e;&#x2d;&#104;&#101;&#97;&#100;&#101;&#x72;&#115;&#64;&#49;&#x2e;&#x30;&#x2e;&#49;</a>, <a href="mailto:&#x63;&#111;&#x6f;&#107;&#105;&#101;&#x40;&#x30;&#46;&#49;&#46;&#x33;">&#x63;&#111;&#x6f;&#107;&#105;&#101;&#x40;&#x30;&#46;&#49;&#46;&#x33;</a>, <a href="mailto:&#x75;&#x74;&#x69;&#108;&#115;&#45;&#x6d;&#101;&#x72;&#x67;&#101;&#x40;&#49;&#46;&#x30;&#x2e;&#48;">&#x75;&#x74;&#x69;&#108;&#115;&#45;&#x6d;&#101;&#x72;&#x67;&#101;&#x40;&#49;&#46;&#x30;&#x2e;&#48;</a>, <a href="mailto:&#112;&#x61;&#x72;&#115;&#x65;&#x75;&#x72;&#108;&#x40;&#49;&#46;&#51;&#46;&#x30;">&#112;&#x61;&#x72;&#115;&#x65;&#x75;&#x72;&#108;&#x40;&#49;&#46;&#51;&#46;&#x30;</a>, <a href="mailto:&#100;&#101;&#x70;&#100;&#64;&#x31;&#46;&#x30;&#x2e;&#x31;">&#100;&#101;&#x70;&#100;&#64;&#x31;&#46;&#x30;&#x2e;&#x31;</a>, <a href="mailto:&#x63;&#114;&#99;&#x40;&#51;&#46;&#51;&#x2e;&#x30;">&#x63;&#114;&#99;&#x40;&#51;&#46;&#51;&#x2e;&#x30;</a>, <a href="mailto:&#x64;&#x65;&#x62;&#117;&#x67;&#64;&#x32;&#46;&#x32;&#46;&#48;">&#x64;&#x65;&#x62;&#117;&#x67;&#64;&#x32;&#46;&#x32;&#46;&#48;</a>, <a href="mailto:&#x75;&#105;&#x64;&#x2d;&#x73;&#x61;&#x66;&#x65;&#64;&#x32;&#x2e;&#48;&#46;&#48;">&#x75;&#105;&#x64;&#x2d;&#x73;&#x61;&#x66;&#x65;&#64;&#x32;&#x2e;&#48;&#46;&#48;</a>) ├── <a href="mailto:&#x65;&#114;&#114;&#x6f;&#114;&#104;&#97;&#x6e;&#x64;&#x6c;&#101;&#x72;&#64;&#49;&#x2e;&#52;&#46;&#x32;">&#x65;&#114;&#114;&#x6f;&#114;&#104;&#97;&#x6e;&#x64;&#x6c;&#101;&#x72;&#64;&#49;&#x2e;&#52;&#46;&#x32;</a> (<a href="mailto:&#101;&#115;&#99;&#97;&#x70;&#101;&#x2d;&#x68;&#116;&#109;&#x6c;&#64;&#49;&#46;&#48;&#46;&#50;">&#101;&#115;&#99;&#97;&#x70;&#101;&#x2d;&#x68;&#116;&#109;&#x6c;&#64;&#49;&#46;&#48;&#46;&#50;</a>, <a href="mailto:&#97;&#x63;&#99;&#101;&#x70;&#x74;&#x73;&#x40;&#x31;&#x2e;&#x32;&#x2e;&#x31;&#x33;">&#97;&#x63;&#99;&#101;&#x70;&#x74;&#x73;&#x40;&#x31;&#x2e;&#x32;&#x2e;&#x31;&#x33;</a>) ├── <a href="mailto:&#98;&#x6f;&#x64;&#121;&#x2d;&#112;&#x61;&#x72;&#115;&#101;&#x72;&#64;&#x31;&#46;&#x31;&#52;&#x2e;&#x30;">&#98;&#x6f;&#x64;&#121;&#x2d;&#112;&#x61;&#x72;&#115;&#101;&#x72;&#64;&#x31;&#46;&#x31;&#52;&#x2e;&#x30;</a> (<a href="mailto:&#x62;&#x79;&#116;&#101;&#115;&#x40;&#50;&#46;&#x31;&#x2e;&#x30;">&#x62;&#x79;&#116;&#101;&#115;&#x40;&#50;&#46;&#x31;&#x2e;&#x30;</a>, <a href="mailto:&#99;&#x6f;&#x6e;&#x74;&#x65;&#110;&#x74;&#x2d;&#x74;&#x79;&#x70;&#x65;&#64;&#49;&#46;&#x30;&#46;&#49;">&#99;&#x6f;&#x6e;&#x74;&#x65;&#110;&#x74;&#x2d;&#x74;&#x79;&#x70;&#x65;&#64;&#49;&#46;&#x30;&#46;&#49;</a>, <a href="mailto:&#x64;&#101;&#x70;&#100;&#x40;&#x31;&#46;&#49;&#46;&#x30;">&#x64;&#101;&#x70;&#100;&#x40;&#x31;&#46;&#49;&#46;&#x30;</a>, <a href="mailto:&#x6f;&#x6e;&#45;&#102;&#x69;&#x6e;&#x69;&#115;&#104;&#101;&#100;&#64;&#50;&#46;&#x33;&#x2e;&#x30;">&#x6f;&#x6e;&#45;&#102;&#x69;&#x6e;&#x69;&#115;&#104;&#101;&#100;&#64;&#50;&#46;&#x33;&#x2e;&#x30;</a>, <a href="mailto:&#100;&#x65;&#98;&#x75;&#x67;&#64;&#50;&#46;&#x32;&#46;&#48;">&#100;&#x65;&#98;&#x75;&#x67;&#64;&#50;&#46;&#x32;&#46;&#48;</a>, <a href="mailto:&#104;&#x74;&#x74;&#x70;&#45;&#x65;&#114;&#x72;&#x6f;&#x72;&#x73;&#64;&#49;&#x2e;&#x33;&#x2e;&#x31;">&#104;&#x74;&#x74;&#x70;&#45;&#x65;&#114;&#x72;&#x6f;&#x72;&#x73;&#64;&#49;&#x2e;&#x33;&#x2e;&#x31;</a>, <a href="mailto:&#113;&#x73;&#64;&#x35;&#x2e;&#x31;&#46;&#48;">&#113;&#x73;&#64;&#x35;&#x2e;&#x31;&#46;&#48;</a>, <a href="mailto:&#105;&#x63;&#x6f;&#x6e;&#x76;&#x2d;&#x6c;&#105;&#116;&#101;&#64;&#x30;&#46;&#52;&#x2e;&#x31;&#x31;">&#105;&#x63;&#x6f;&#x6e;&#x76;&#x2d;&#x6c;&#105;&#116;&#101;&#64;&#x30;&#46;&#52;&#x2e;&#x31;&#x31;</a>, <a href="mailto:&#116;&#121;&#x70;&#x65;&#45;&#105;&#x73;&#x40;&#49;&#x2e;&#54;&#x2e;&#49;&#48;">&#116;&#121;&#x70;&#x65;&#45;&#105;&#x73;&#x40;&#49;&#x2e;&#54;&#x2e;&#49;&#48;</a>, <a href="mailto:&#x72;&#97;&#x77;&#45;&#x62;&#111;&#x64;&#x79;&#x40;&#50;&#46;&#49;&#x2e;&#53;">&#x72;&#97;&#x77;&#45;&#x62;&#111;&#x64;&#x79;&#x40;&#50;&#46;&#49;&#x2e;&#53;</a>) ├── <a href="mailto:&#101;&#120;&#x70;&#114;&#101;&#115;&#x73;&#x40;&#x34;&#x2e;&#x31;&#x33;&#x2e;&#51;">&#101;&#120;&#x70;&#114;&#101;&#115;&#x73;&#x40;&#x34;&#x2e;&#x31;&#x33;&#x2e;&#51;</a> (<a href="mailto:&#101;&#x73;&#x63;&#x61;&#x70;&#101;&#x2d;&#x68;&#116;&#109;&#108;&#64;&#49;&#46;&#x30;&#x2e;&#x32;">&#101;&#x73;&#x63;&#x61;&#x70;&#101;&#x2d;&#x68;&#116;&#109;&#108;&#64;&#49;&#46;&#x30;&#x2e;&#x32;</a>, <a href="mailto:&#99;&#111;&#111;&#107;&#x69;&#x65;&#64;&#48;&#x2e;&#x31;&#x2e;&#x33;">&#99;&#111;&#111;&#107;&#x69;&#x65;&#64;&#48;&#x2e;&#x31;&#x2e;&#x33;</a>, <a href="mailto:&#x6d;&#101;&#114;&#103;&#x65;&#x2d;&#x64;&#101;&#115;&#99;&#114;&#105;&#112;&#116;&#x6f;&#x72;&#115;&#x40;&#49;&#46;&#x30;&#x2e;&#x30;">&#x6d;&#101;&#114;&#103;&#x65;&#x2d;&#x64;&#101;&#115;&#99;&#114;&#105;&#112;&#116;&#x6f;&#x72;&#115;&#x40;&#49;&#46;&#x30;&#x2e;&#x30;</a>, <a href="mailto:&#109;&#101;&#x74;&#x68;&#111;&#x64;&#115;&#x40;&#x31;&#46;&#49;&#x2e;&#49;">&#109;&#101;&#x74;&#x68;&#111;&#x64;&#115;&#x40;&#x31;&#46;&#49;&#x2e;&#49;</a>, <a href="mailto:&#x75;&#116;&#105;&#108;&#x73;&#x2d;&#109;&#101;&#x72;&#103;&#101;&#64;&#x31;&#46;&#48;&#x2e;&#48;">&#x75;&#116;&#105;&#108;&#x73;&#x2d;&#109;&#101;&#x72;&#103;&#101;&#64;&#x31;&#46;&#48;&#x2e;&#48;</a>, <a href="mailto:&#99;&#x6f;&#x6f;&#107;&#105;&#101;&#45;&#115;&#105;&#x67;&#110;&#x61;&#x74;&#117;&#114;&#x65;&#64;&#x31;&#x2e;&#x30;&#x2e;&#54;">&#99;&#x6f;&#x6f;&#107;&#105;&#101;&#45;&#115;&#105;&#x67;&#110;&#x61;&#x74;&#117;&#114;&#x65;&#64;&#x31;&#x2e;&#x30;&#x2e;&#54;</a>, <a href="mailto:&#97;&#x72;&#x72;&#x61;&#121;&#x2d;&#x66;&#108;&#97;&#116;&#116;&#101;&#x6e;&#64;&#x31;&#46;&#49;&#46;&#49;">&#97;&#x72;&#x72;&#x61;&#121;&#x2d;&#x66;&#108;&#97;&#116;&#116;&#101;&#x6e;&#64;&#x31;&#46;&#49;&#46;&#49;</a>, <a href="mailto:&#x66;&#x72;&#x65;&#x73;&#104;&#x40;&#x30;&#x2e;&#x33;&#46;&#48;">&#x66;&#x72;&#x65;&#x73;&#104;&#x40;&#x30;&#x2e;&#x33;&#46;&#48;</a>, <a href="mailto:&#x76;&#97;&#x72;&#x79;&#x40;&#49;&#x2e;&#48;&#46;&#49;">&#x76;&#97;&#x72;&#x79;&#x40;&#49;&#x2e;&#48;&#46;&#49;</a>, <a href="mailto:&#101;&#116;&#97;&#x67;&#64;&#49;&#46;&#x37;&#46;&#48;">&#101;&#116;&#97;&#x67;&#64;&#49;&#46;&#x37;&#46;&#48;</a>, <a href="mailto:&#99;&#x6f;&#x6e;&#116;&#x65;&#x6e;&#116;&#x2d;&#x74;&#121;&#x70;&#101;&#64;&#x31;&#x2e;&#48;&#x2e;&#49;">&#99;&#x6f;&#x6e;&#116;&#x65;&#x6e;&#116;&#x2d;&#x74;&#121;&#x70;&#101;&#64;&#x31;&#x2e;&#48;&#x2e;&#49;</a>, <a href="mailto:&#114;&#x61;&#110;&#103;&#x65;&#x2d;&#x70;&#97;&#114;&#115;&#x65;&#114;&#64;&#x31;&#x2e;&#x30;&#x2e;&#51;">&#114;&#x61;&#110;&#103;&#x65;&#x2d;&#x70;&#97;&#114;&#115;&#x65;&#114;&#64;&#x31;&#x2e;&#x30;&#x2e;&#51;</a>, <a href="mailto:&#112;&#x61;&#114;&#115;&#x65;&#117;&#114;&#108;&#x40;&#49;&#x2e;&#x33;&#46;&#48;">&#112;&#x61;&#114;&#115;&#x65;&#117;&#114;&#108;&#x40;&#49;&#x2e;&#x33;&#46;&#48;</a>, <a href="mailto:&#x70;&#x61;&#116;&#x68;&#x2d;&#116;&#x6f;&#x2d;&#x72;&#101;&#x67;&#101;&#x78;&#112;&#64;&#x30;&#46;&#x31;&#x2e;&#55;">&#x70;&#x61;&#116;&#x68;&#x2d;&#116;&#x6f;&#x2d;&#x72;&#101;&#x67;&#101;&#x78;&#112;&#64;&#x30;&#46;&#x31;&#x2e;&#55;</a>, <a href="mailto:&#115;&#x65;&#x72;&#118;&#x65;&#45;&#115;&#116;&#x61;&#116;&#105;&#99;&#x40;&#49;&#46;&#x31;&#48;&#46;&#48;">&#115;&#x65;&#x72;&#118;&#x65;&#45;&#115;&#116;&#x61;&#116;&#105;&#99;&#x40;&#49;&#46;&#x31;&#48;&#46;&#48;</a>, <a href="mailto:&#99;&#x6f;&#110;&#116;&#101;&#110;&#116;&#x2d;&#x64;&#x69;&#115;&#x70;&#x6f;&#115;&#105;&#116;&#105;&#x6f;&#110;&#64;&#48;&#x2e;&#53;&#46;&#48;">&#99;&#x6f;&#110;&#116;&#101;&#110;&#116;&#x2d;&#x64;&#x69;&#115;&#x70;&#x6f;&#115;&#105;&#116;&#105;&#x6f;&#110;&#64;&#48;&#x2e;&#53;&#46;&#48;</a>, <a href="mailto:&#100;&#101;&#x70;&#100;&#x40;&#x31;&#46;&#x30;&#x2e;&#49;">&#100;&#101;&#x70;&#100;&#x40;&#x31;&#46;&#x30;&#x2e;&#49;</a>, <a href="mailto:&#111;&#x6e;&#45;&#102;&#x69;&#110;&#x69;&#115;&#x68;&#x65;&#x64;&#64;&#50;&#46;&#x33;&#x2e;&#x30;">&#111;&#x6e;&#45;&#102;&#x69;&#110;&#x69;&#115;&#x68;&#x65;&#x64;&#64;&#50;&#46;&#x33;&#x2e;&#x30;</a>, <a href="mailto:&#102;&#105;&#110;&#x61;&#108;&#x68;&#97;&#110;&#x64;&#108;&#101;&#114;&#x40;&#48;&#46;&#52;&#x2e;&#48;">&#102;&#105;&#110;&#x61;&#108;&#x68;&#97;&#110;&#x64;&#108;&#101;&#114;&#x40;&#48;&#46;&#52;&#x2e;&#48;</a>, <a href="mailto:&#x64;&#101;&#x62;&#117;&#x67;&#x40;&#x32;&#x2e;&#x32;&#x2e;&#48;">&#x64;&#101;&#x62;&#117;&#x67;&#x40;&#x32;&#x2e;&#x32;&#x2e;&#48;</a>, <a href="mailto:&#x71;&#x73;&#x40;&#52;&#46;&#x30;&#46;&#48;">&#x71;&#x73;&#x40;&#52;&#46;&#x30;&#46;&#48;</a>, <a href="mailto:&#112;&#x72;&#111;&#120;&#121;&#x2d;&#97;&#x64;&#x64;&#x72;&#64;&#49;&#46;&#48;&#x2e;&#49;&#x30;">&#112;&#x72;&#111;&#120;&#121;&#x2d;&#97;&#x64;&#x64;&#x72;&#64;&#49;&#46;&#48;&#x2e;&#49;&#x30;</a>, <a href="mailto:&#116;&#x79;&#112;&#101;&#45;&#105;&#115;&#x40;&#49;&#46;&#x36;&#x2e;&#49;&#48;">&#116;&#x79;&#112;&#101;&#45;&#105;&#115;&#x40;&#49;&#46;&#x36;&#x2e;&#49;&#48;</a>, <a href="mailto:&#x61;&#99;&#x63;&#x65;&#112;&#116;&#x73;&#x40;&#x31;&#x2e;&#x32;&#46;&#49;&#x33;">&#x61;&#99;&#x63;&#x65;&#112;&#116;&#x73;&#x40;&#x31;&#x2e;&#x32;&#46;&#49;&#x33;</a>, <a href="mailto:&#x73;&#x65;&#x6e;&#100;&#64;&#x30;&#x2e;&#x31;&#x33;&#x2e;&#x30;">&#x73;&#x65;&#x6e;&#100;&#64;&#x30;&#x2e;&#x31;&#x33;&#x2e;&#x30;</a>) ├── <a href="mailto:&#x73;&#119;&#x69;&#x67;&#64;&#49;&#46;&#x34;&#46;&#x32;">&#x73;&#119;&#x69;&#x67;&#64;&#49;&#46;&#x34;&#46;&#x32;</a> (<a href="mailto:&#111;&#112;&#x74;&#105;&#x6d;&#105;&#115;&#x74;&#x40;&#x30;&#x2e;&#54;&#46;&#49;">&#111;&#112;&#x74;&#105;&#x6d;&#105;&#115;&#x74;&#x40;&#x30;&#x2e;&#54;&#46;&#49;</a>, <a href="mailto:&#x75;&#103;&#x6c;&#105;&#102;&#x79;&#45;&#106;&#115;&#x40;&#x32;&#x2e;&#x34;&#46;&#x32;&#52;">&#x75;&#103;&#x6c;&#105;&#102;&#x79;&#45;&#106;&#115;&#x40;&#x32;&#x2e;&#x34;&#46;&#x32;&#52;</a>) ├── <a href="mailto:&#x6d;&#111;&#x6e;&#x67;&#111;&#100;&#98;&#x40;&#50;&#x2e;&#49;&#x2e;&#x32;">&#x6d;&#111;&#x6e;&#x67;&#111;&#100;&#98;&#x40;&#50;&#x2e;&#49;&#x2e;&#x32;</a> (<a href="mailto:&#x65;&#115;&#x36;&#x2d;&#112;&#114;&#x6f;&#x6d;&#x69;&#x73;&#101;&#x40;&#51;&#46;&#48;&#46;&#x32;">&#x65;&#115;&#x36;&#x2d;&#112;&#114;&#x6f;&#x6d;&#x69;&#x73;&#101;&#x40;&#51;&#46;&#48;&#46;&#x32;</a>, <a href="mailto:&#x72;&#x65;&#97;&#x64;&#97;&#98;&#x6c;&#x65;&#x2d;&#115;&#116;&#114;&#x65;&#97;&#109;&#64;&#49;&#x2e;&#x30;&#x2e;&#x33;&#49;">&#x72;&#x65;&#97;&#x64;&#97;&#98;&#x6c;&#x65;&#x2d;&#115;&#116;&#114;&#x65;&#97;&#109;&#64;&#49;&#x2e;&#x30;&#x2e;&#x33;&#49;</a>, <a href="mailto:&#107;&#101;&#114;&#98;&#101;&#x72;&#x6f;&#x73;&#64;&#x30;&#46;&#48;&#x2e;&#49;&#x37;">&#107;&#101;&#114;&#98;&#101;&#x72;&#x6f;&#x73;&#64;&#x30;&#46;&#48;&#x2e;&#49;&#x37;</a>, <a href="mailto:&#x6d;&#x6f;&#x6e;&#103;&#x6f;&#x64;&#x62;&#45;&#99;&#x6f;&#114;&#x65;&#x40;&#49;&#46;&#x32;&#x2e;&#51;&#48;">&#x6d;&#x6f;&#x6e;&#103;&#x6f;&#x64;&#x62;&#45;&#99;&#x6f;&#114;&#x65;&#x40;&#49;&#46;&#x32;&#x2e;&#51;&#48;</a>) └── <a href="mailto:&#99;&#x6c;&#x69;&#45;&#99;&#x6f;&#108;&#x6f;&#114;&#x40;&#x31;&#46;&#x31;&#x2e;&#48;">&#99;&#x6c;&#x69;&#45;&#99;&#x6f;&#108;&#x6f;&#114;&#x40;&#x31;&#46;&#x31;&#x2e;&#48;</a> (<a href="mailto:&#97;&#x6e;&#115;&#105;&#x2d;&#114;&#x65;&#x67;&#x65;&#x78;&#x40;&#50;&#x2e;&#x30;&#46;&#48;">&#97;&#x6e;&#115;&#105;&#x2d;&#114;&#x65;&#x67;&#x65;&#x78;&#x40;&#50;&#x2e;&#x30;&#46;&#48;</a>, <a href="mailto:&#x64;&#64;&#x30;&#x2e;&#49;&#x2e;&#49;">&#x64;&#64;&#x30;&#x2e;&#49;&#x2e;&#49;</a>, <a href="mailto:&#101;&#x73;&#x36;&#x2d;&#105;&#x74;&#101;&#x72;&#x61;&#116;&#x6f;&#x72;&#64;&#x32;&#46;&#x30;&#46;&#48;">&#101;&#x73;&#x36;&#x2d;&#105;&#x74;&#101;&#x72;&#x61;&#116;&#x6f;&#x72;&#64;&#x32;&#46;&#x30;&#46;&#48;</a>, <a href="mailto:&#x74;&#105;&#109;&#101;&#x72;&#115;&#45;&#x65;&#120;&#116;&#x40;&#48;&#x2e;&#49;&#46;&#x30;">&#x74;&#105;&#109;&#101;&#x72;&#115;&#45;&#x65;&#120;&#116;&#x40;&#48;&#x2e;&#49;&#46;&#x30;</a>, <a href="mailto:&#109;&#101;&#109;&#x6f;&#x69;&#x7a;&#x65;&#x65;&#x40;&#48;&#x2e;&#x33;&#x2e;&#x39;">&#109;&#101;&#109;&#x6f;&#x69;&#x7a;&#x65;&#x65;&#x40;&#48;&#x2e;&#x33;&#x2e;&#x39;</a>, <a href="mailto:&#101;&#x73;&#x35;&#45;&#101;&#120;&#116;&#x40;&#48;&#46;&#49;&#48;&#x2e;&#x31;&#x31;">&#101;&#x73;&#x35;&#45;&#101;&#120;&#116;&#x40;&#48;&#46;&#49;&#48;&#x2e;&#x31;&#x31;</a>) [/code] <strong>Python</strong> がいるのか。コマンドプロンプトで <strong>Python –version</strong> っていっても出ないから入ってないのだろう。 <strong>3.5.1</strong> を<a href="https://www.python.org/downloads/">公式ページ</a>からダウンロードしてくる。 インストール後、一度コマンドプロンプトを再起動 (環境変数の反映) して、一度、 [code lang=”shell”] npm -r mongo-express [/code] で削除してから、もう一度実行してみる。 でもだめー。 どうも、<strong>gyp</strong> とかいうのが、2.5.0以上3.0未満でないとダメって言ってる。面倒な。3.5.1 を削除、<strong>2.7.11</strong> をダウンロードして再インストールする。 あ、パスは手動で通すのね、2.7の場合。 次はワーニングとか出たけど、通った。 で、次は設定がいるのね。<a href="https://github.com/andzdroid/mongo-express">公式ページ</a>に</p><blockquote><p>To configure: Copy YOUR_PATH/node_modules/mongo-express/config.default.js into a new file called YOUR_PATH/node_modules/mongo-express/config.js.</p></blockquote><p>[code] 訳: YOUR_PATH/node_modules/mongo-express/config.default.jsをYOUR_PATH/node_modules/mongo-express/config.jsという名前でコピーしろ [/code] とあるので、従う。 実行は、</p><blockquote><p>cd YOUR_PATH/node_modules/mongo-express/ &amp;&amp; node app.js</p></blockquote><p>とあるので試してみる。たぶん、この&amp;&amp;は間違いだろうと思うが。 実行すると、ファイヤーウォールの警告が出るので、適宜許可。 [code lang=”shell”] c:\Program Files\MongoDB\node_modules\mongo-express&gt;node app.js basicAuth credentials are “admin:pass”, it is recommended you change this in your config.js! Mongo Express server listening on port 8081 at 0.0.0.0 Database connected Admin Database connected [/code] どうやら、8081ポートで動いているよう。アクセスしてみる。 <a href="../../../../public/2015/12/edge.png"><img src="../../../../public/2015/12/edge.png" alt="認証"></a></p><p>認証画面が出るので、先の警告の通りデフォルトのユーザ名とパスを入れてみる。 無事に認証が通り、ページが表示されました。OK。 <a href="../../../../public/2015/12/express.png"><img src="../../../../public/2015/12/express-1024x701.png" alt="mongo express"></a></p><h2 id="データを確認"><a href="#データを確認" class="headerlink" title="データを確認"></a>データを確認</h2><p>ようやくインストールが終わりました。パスワード設定とかは次回に…. 画面左の <strong>View Database</strong> でデータベースが見れるよう。 次のデータベース名が出るのでそこをクリック。 すると、よくわからない記号の羅列がでてくるので、そこをクリックすると、見えました。 <a href="../../../../public/2015/12/result.png"><img src="../../../../public/2015/12/result-1024x701.png" alt="中身の確認"></a></p><p>よしよし。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>よーやくデータが見えるようになりました。 けど、mongo expressは使いやすい感じです。 また、思わぬところでnpmを使うことになり、少しレベルアップした感じです。 次は、パスワードの設定を。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> JavaScript </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> mongodb </category>
          
          <category> NoSQL </category>
          
          <category> mongo-express </category>
          
          <category> javascript </category>
          
          <category> Node.js </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで画像処理を試してみる OpenCVSharp編 第3回</title>
      <link href="/2016/01/01/755/"/>
      <url>/2016/01/01/755/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-9X">前回</a>は顔認識における前処理の説明を行いました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>前回、さりげなく、というかさらっとカメラを使っていたので、カメラの使い方を説明します。 <strong>OpenCVSharp</strong> はカメラも簡単に使えます。 複数のカメラを接続して切り替えることも可能です。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="ソースコード"><a href="#ソースコード" class="headerlink" title="ソースコード"></a>ソースコード</h2><p>説明するよりソースコードを見た方が早いです。 サンプルソースは末尾にあります。 [code lang=”csharp”] public class MainViewModel : ViewModelBase {<br>#region フィールド<br>private IDisposable _CaptureHandler;<br>private CvCapture _CvCapture;<br>#endregion<br>#region コンストラクタ<br>public MainViewModel() { this.CameraIndex = 0; }<br>#endregion<br>#region プロパティ<br>private BitmapSource _CameraImage;<br>public BitmapSource CameraImage { get { return this._CameraImage; } set { this._CameraImage = value; this.RaisePropertyChanged(); } }<br>private int _CameraIndex;<br>public int CameraIndex { get { return this._CameraIndex; } set { this._CameraIndex = value; this.RaisePropertyChanged();<br>this.ExecuteStart(); } }<br>#endregion<br>#region メソッド<br>#region ヘルパーメソッド<br>private CvCapture CreateCvCapture() { CvCapture cvCapture = null;<br>try { cvCapture = new CvCapture(this.CameraIndex); } catch (Exception) { // ignore }<br>return cvCapture; }<br>private void ExecuteStart() { this.ExecuteStop();<br>this._CvCapture = this.CreateCvCapture(); if (this._CvCapture == null) { return; }<br>var ms = 60; this._CaptureHandler = Observable.Interval(TimeSpan.FromMilliseconds(ms), DispatcherScheduler.Current) .Select(_ =&gt; { if (this._CvCapture == null) { return null; }<br>return Cv.QueryFrame(this._CvCapture); }) .Where(frame =&gt; frame != null) .Subscribe(frame =&gt; { var writeableBitmap = frame.ToWriteableBitmap(); frame.Dispose(); this.CameraImage = writeableBitmap; }); }<br>private void ExecuteStop() { if (this._CvCapture != null) { this._CvCapture.Dispose(); this._CvCapture = null; }<br>if (this._CaptureHandler != null) { this._CaptureHandler.Dispose(); this._CaptureHandler = null; } }<br>#endregion<br>#endregion<br>} [/code] <strong>CameraImage プロパティ</strong></p><p>XAMLのViewとバインディングされており、ここが変化するとカメラ映像が行進されます。</p><p><strong>CameraIndex プロパティ</strong></p><p>XAMLのViewとバインディングされており、ここが変化するとカメラが切り替わります。 基本は0以上の整数値です。 カメラに対応していない数値が設定されると、 <strong>CvCapture</strong> のコンストラクタで例外を投げて、その後の処理でカメラの処理が自動で停止します。</p><p><strong>ExecuteStart メソッド</strong></p><p>CameraIndex プロパティの変更で呼ばれます。 まずは既存のカメラを停止させます。 次に、<strong>Reactive Extensions</strong> の <strong>System.Reactive.Linq.Observable.Interval メソッド</strong> を使い指定した間隔でカメラ映像の取得を試みます。 <strong>OpenCVSharp.Cv.QueryFrame メソッド</strong>に作成した CvCapture のインスタンスを渡すことで、<strong>OpenCVSharp.IplImage オブジェクト</strong>を返します。 あとは、次々の発生する IplImage を Where でフィルタして、<strong>CameraImage プロパティ</strong>設定します。</p><p><strong>Reactive Extensions</strong> 利用のアイデアはkattoshi様の<a href="http://qiita.com/kattoshi/items/d65c231865fbfddf82fa">Rx と OpenCVSharp を使用して 簡単にカメラキャプチャアプリを作成する</a> を参考にさせていただきました。 ありがとうございます。</p><p>重要なのは2つ。</p><p>まず、Interval メソッドの最後の引数は現在のスレッドの <strong>System.Windows.Threading.Dispatcher</strong> を渡します。 これにより、Viewに対する更新が自動的にバックグランドで実行されます。</p><p>次に、Subscribe メソッドの戻りをクラスメンバーに保持しておくことです。 この戻りは <strong>System.IDisposable インターフェイス</strong>です。 これを破棄することで、Interval メソッドによるイベントの発生が停止します。</p><p><strong>ExecuteStop メソッド</strong></p><p>CvCapture オブジェクトとSubscribe メソッドの戻りを破棄し、カメラを停止させます。</p><h2 id="動作イメージ"><a href="#動作イメージ" class="headerlink" title="動作イメージ"></a>動作イメージ</h2><p><a href="../../../../public/2016/01/Sample.png"><img src="../../../../public/2016/01/Sample.png"></a></p><p>サンプルには、<a href="http://www.mvvmlight.net/">MVVM Light Toolkit</a>、<a href="http://mahapps.com/">MahApps.Metro</a> を使っています。 味気ないデフォルトウィンドウ以外を使うだけで、なんかかっこよく見えます。 これ大事。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>OpenCVSharpを使えば、カメラも簡単に使えます。やったね。本当に。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/OpenCV3">https://github.com/takuya-takeuchi/Demo/tree/master/OpenCV3</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> OpenCV </category>
          
          <category> .NETで画像処理を試してみる OpenCVSharp編 </category>
          
          <category> OpenCvSharp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 第2回</title>
      <link href="/2016/01/01/639/"/>
      <url>/2016/01/01/639/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-ad">前回</a>はインストールしました。今回は実際にデータを追加します。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>MongoDB は親切にも<a href="https://docs.mongodb.org/ecosystem/drivers/">接続のためのドライバ</a>を用意してくれてます。しかも.NET用かつNuget経由で。素晴らしい。 恐ろしいことに、C、C++、C#、Java、Node.js、Perl、PHP、Python、Motor、Ruby、Scala用のドライバがオープンソースで用意してあります。 MongodDBおそろしい子！ 今回もきちんと公式ページを見てやります。ちゃんと英文訳します。参考にしてください。 …ちゃんと英語ドキュメント見ないと勉強になりませんから(白目)</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="開発環境構築"><a href="#開発環境構築" class="headerlink" title="開発環境構築"></a>開発環境構築</h2><p>何はともあれ、Nugetです。 Nugetでインストールは、GUIでもできますが、GUIだとMongoDBが2つ出てきます。片方は古いMongoDBのドライバです。 <a href="../../../../public/2015/12/nuget.png"><img src="../../../../public/2015/12/nuget.png" alt="nuget"></a></p><p>コンソールで [code] Install-Package MongoDB.Driver [/code] とやると確実です。 ちなみに、前回は最新版のMongoDB (執筆時点で3.2.0)をインストールし、今回はドライバのバージョンが2.2ですが、ちゃんと繋がるの？という方、<a href="https://docs.mongodb.org/ecosystem/drivers/csharp/">C# and .NET MongoDB Driver</a> にて互換性について説明があります。 2.2は <strong>MongoDB 2.4</strong>、<strong>MongoDB 2.6</strong>、<strong>MongoDB 3.0</strong>、<strong>MongoDB 3.2</strong> に繋がります。うん安心。 ただし、.NETの互換性が非常にタイトです。 2.0(ドキュメントには2.2とは書いてない)は.NET 4.5とMono 3.xでしか動きません。 逆に1.10は.NET 3.5以降をサポートしています。しかも <strong>Mono 2.10</strong>、<strong>Mono 3.x</strong> も。 また、MongoDBは、Visual Studio は2010、2012でビルドして、テストしたようです。2015でも、いけるよね？</p><h2 id="接続実験"><a href="#接続実験" class="headerlink" title="接続実験"></a>接続実験</h2><p>公式ページ<a href="https://docs.mongodb.org/ecosystem/tutorial/authenticate-with-csharp-driver/">Authenticate to MongoDB with the C# Driver</a>に説明があります。ちなみに、1.8以降のみの説明です。 のっけから意味のわからないことが書いてあります。<strong>Internal Authentication</strong>と<strong>External Authentication</strong>とあります。 <strong>Internal Authentication</strong></p><blockquote><p>Internal authentication refers to accounts stored inside MongoDB. Currently, the only way to authenticate against internal accounts is to use the MongoDB Challenge Response mechanism, or MONGODB-CR. This is the default mechanism.</p></blockquote><p>[code] 訳:Internal authenticationは、内部のMongoDBに保存されているアカウントを参照します。現在、内部アカウントに対する認証する唯一の方法は、MogoDB Challenge Response メカニズム、または MONGODB-CR を使うことです。これは既定のメカニズムです。 [/code] <strong>External Authentication</strong></p><blockquote><p>External authentication refers to credentials validated outside of MongoDB. The external authentication provider currently used is Kerberos. To authenticate to a MongoDB cluster using Kerberos, you must specify the GSSAPI mechanism and a user name. On Windows, it is also possible to provide the password. Fundamentally, the process for connecting with Kerberos is the same for Windows and Linux systems; however, Linux systems require the use of kinit to acquire the security credentials whereas Windows systems perform this action transparently using SSPI based on the account running the current process when a password is not used.</p></blockquote><p>[code] 訳:External authenticationは、外部のMongoDB検証された資格情報を参照します。外部認証プロバイダーは現在Kerberosが使用されます。Kerberosを使用したMongoDBクラスターへ認証するために、GSSAPIメカニズムとユーザ名を必ず使用します。Windowsでは、パスワードを提供することも可能です。 基本的には、Kerberosによる接続プロセスは、WindowsとLinuxでのそれと同一です。しかし、Linuxではセキュリティ認証を得るためにkinitの使用を、一方でWindowsでは、パスワードを利用しないとき、現在のプロセスを実行しているアカウントに基づくSSPIを利用した透過的なアクションを実行します。 [/code] とあります。External authenticationのWindowsに対する最後の説明は意味不明ですが、要するに、サービスとして動いているローカルのMongoDBへのアクセスは、Internal、といことでしょう。きっと。Kerberosなんて言われても困ります。 で、Internalにのみ目を向けると、サンプルコードがあります。</p><blockquote><p>var credential = MongoCredential.CreateMongoCRCredential(“test”, “user1”, “password1”); var settings = new MongoClientSettings { Credentials = new[] { credential } }; var mongoClient = new MongoClient(settings);</p></blockquote><p>または、</p><blockquote><p>var connectionString = “mongodb://user1:password1@localhost/test”; var mongoClient = new MongoClient(connectionString);</p></blockquote><p>はぁ？パスワード？と思ったあなた。ご安心を、パスワードはなくても接続できます。 前回は設定していませんしね(白目) [code lang=”csharp”] var mongoClient= new MongoClient(“mongodb://localhost”); [/code] これでOKです。 まずは前回設定したサービスを起動します。 で、起動後、下記のプログラムを実行します。 [code lang=”csharp”] using System; using MongoDB.Driver;<br>namespace MongoDB2 { class Program { static void Main(string[] args) { var mongoClient = new MongoClient(“mongodb://localhost”); foreach (var document in mongoClient.ListDatabases().ToList()) { Console.WriteLine(“Document:{0}”, document); foreach (var name in document.Names) { Console.WriteLine(“Name:{0}”, name); } }<br>Console.ReadKey(); } } } [/code] 実行後、コマンドプロンプトに [code lang=”json”] Document:{ “name” : “local”, “sizeOnDisk” : 65536.0, “empty” : false } Name:name Name:sizeOnDisk Name:empty [/code] と表示されるはずです。 データベースとかを既に追加していたら違う結果になると思いますが。 サービスが起動していないと、 <a href="../../../../public/2015/12/exception.png"><img src="../../../../public/2015/12/exception.png" alt="タイムアウト"></a></p><p>って出ます。内容を見る限りタイムアウトは30秒のようです。 とりあえず接続試験はOKです。</p><h2 id="データベースって何？"><a href="#データベースって何？" class="headerlink" title="データベースって何？"></a>データベースって何？</h2><p>先のコードで、 [code lang=”csharp”] foreach (var document in mongoClient.ListDatabases().ToList()) [/code] って書きました。 <strong>ListDatabases</strong> ってあるのに変数名がdocumentとか、センスないの？馬鹿なの？って思った人いるかもしれませんが、これは <strong>ListDatabases</strong> メソッドの戻りが、<strong>MongoDB.Driver.IAsyncCursor&lt;MongoDB.Bson.BsonDocument&gt;</strong> だからです。 Bsonって何？というと、Wiki先生は<a href="https://ja.wikipedia.org/wiki/BSON">こう仰っています</a>。</p><blockquote><p>BSONは主にMongoDBのデータストレージ及びネットワーク転送フォーマットとして利用されている、データ交換フォーマットである。 単純なデータ構造や連想配列（MongoDBではオブジェクトまたはドキュメントと表す）を示すバイナリ構造であり、 名称はJSON由来であり”バイナリ型JSON”の略語である。</p></blockquote><p>よーするにMongoDB用のデータ構造でJsonのバイナリ版だと。 で、BsonDocumentって何？って調べても、<strong>Represents a BSON document.</strong> としか書いてない。 これがデータベース？と思いきや、<strong>MongoClient.GetDatabase</strong> メソッドというのがあって、これの戻り値は <strong>MongoDB.Driver.IMongoDatabase</strong> となっていて、データベースは存在するよう。 じゃぁ、さっきのListDatabases メソッドはっていうと、<strong>Lists the databases on the server.</strong> って言っている。 これはAPIとしてどうなの？という感じがしないでもない。 MongoClient クラスには、DropDatabaseはあるから、作成はあっても良さそうな気がする。</p><h2 id="データベースを作る"><a href="#データベースを作る" class="headerlink" title="データベースを作る"></a>データベースを作る</h2><p>先の ListDatabases メソッドで戻ってきた BsonDocument はきっと初期状態で入っている、管理用のデータベースの中身、と仮定します。 なので、データベースを作れば結果が変わる、と信じてデータベースを作ってみます。 が、そんなAPIがない、というのは前章のとおり。 というわけでGoogle先生に聞いてみた。 公式にもない、というか見つからなかったが、<a href="http://putridparrot.com/blog/creating-a-simple-database-in-mongodb-with-c/">Creating a simple database in MongoDB with C#</a> によると、</p><blockquote><p>The line server.GetDatabase(“MyDatabase”) will get the database (if it exists) but also create a database if it doesn’t exist. Note: if you are creating a database using GetDatabase it will not exist until you actually store data in it.</p></blockquote><p>[code] 訳: server.GetDatabase(“MyDatabase”) の行はデータベース (存在すれば) を取得しますが、存在しなければデータベースを作ったりもします。<br>ノート:GetDatabaseでデータベースを作ったとしても、データを突っ込むまでは、データベースは存在しません。 [/code] って言ってます。 必要になるまでテーブルは要らない、ってことですか。</p><h2 id="データを追加する"><a href="#データを追加する" class="headerlink" title="データを追加する"></a>データを追加する</h2><p>データベース「だけ」を作る方法はないので、データを設定してみます。 さっきのページに、親切にも同じようなことが書いてあります。</p><blockquote><p>Like the creating of the database, if no employees currently exist we still get a collection object which we can then save data to.</p></blockquote><p>[code] 訳: データベースの作成のように、もしemployeesがそのときに存在しなければ、データを保存することのできるコレクションオブジェクトを取得します。 [/code] とある。サンプルを見ると、</p><blockquote><p>public class Person { public ObjectId Id { get; set; } public string FirstName { get; set; } public string LastName { get; set; } public int Age { get; set; } } MongoClient client = new MongoClient(); MongoServer server = client.GetServer(); MongoDatabase db = server.GetDatabase(“MyDatabase”); MongoCollection collection = db.GetCollection(“employees”); Person p = new Person { Id = ObjectId.GenerateNewId(), FirstName = “Bob”, LastName = “Baker”, Age = 36 } collection.Save(p);</p></blockquote><p>とあるので、コレクションも必要になるまで反映されない、ってことですか。 というか、データベースの配下にコレクションなのね。そーいう構造ですか。 で、作ったサンプルは<a href="https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB2">こちら</a>。 [code lang=”default”] class Program { static void Main(string[] args) { var mongoClient = new MongoClient(“mongodb://localhost”); //TestConnect(mongoClient);<br>InsertData(mongoClient); TestConnect(mongoClient);<br>Console.WriteLine(“Please enter any key…”); Console.ReadKey(); }<br>private static void InsertData(MongoClient mongoClient) { Console.WriteLine(“InsertData”);<br>var database = mongoClient.GetDatabase(“Database1”);<br>var c1 = new Company { Id = ObjectId.GenerateNewId(), Name = “Microsoft”, Established = new DateTime(1975, 4, 4) };<br>var c2 = new Company { Id = ObjectId.GenerateNewId(), Name = “Apple”, Established = new DateTime(1976, 4, 1) };<br>var collection = database.GetCollection<Company>(“Companies”); collection.InsertOne(c1); collection.InsertOne(c2);<br>var findFluent = collection.Find(FilterDefinition<Company>.Empty); var count = findFluent.Count(); Console.WriteLine(“Count:{0}”, count); }<br>public sealed class Company {<br>public ObjectId Id { get; set; }<br>public string Name { set; get; }<br>public DateTime Established { get; set; }<br>}<br>private static void TestConnect(MongoClient mongoClient) { Console.WriteLine(“TestConnect”);<br>foreach (var document in mongoClient.ListDatabases().ToList()) { Console.WriteLine(“\tDocument:{0}”, document);<br>foreach (var name in document.Names) { Console.WriteLine(“\t\tName:{0}”, name); } } }<br>} [/code] データの検索は、<strong>Find</strong> メソッドが使えることがわかりました。 で、先のBlogのページで使っていた <strong>Save</strong> メソッドはレガシーのAPI用だったようで、今は <strong>InserOne</strong> メソッドのでした。 <strong>ObjectId</strong> とかわかりませんし、シリアライズできないオブジェクトはどうなるの？とか色々ありますがまずはこれだけ。 実行結果はこんな感じ。 [code lang=”json”] InsertData Count:2 TestConnect Document:{ “name” : “Database1”, “sizeOnDisk” : 8192.0, “empty” : false } Name:name Name:sizeOnDisk Name:empty Document:{ “name” : “local”, “sizeOnDisk” : 65536.0, “empty” : false } Name:name Name:sizeOnDisk Name:empty Please enter any key… [/code] ドキュメントが増えただけ？</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まだまだ、わからないことだらけです。手軽な感じはしますが、ちょっともやもやします。 人によっては、もっとシンプルな <strong>KVS (Key-Valueストア)</strong> な <strong>Redis</strong> とかのいいのでしょうか？Redisよく知らないけど。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB2">https://github.com/takuya-takeuchi/Demo/tree/master/MongoDB2</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> NoSQL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでNoSQLを試してみる MongoDB編 第1回</title>
      <link href="/2015/12/30/633/"/>
      <url>/2015/12/30/633/</url>
      
        <content type="html"><![CDATA[<p>冬休みというのは暇ですね。こーいうときに新しい技術に触るのが正しい技術者でしょう。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>NoSQL</strong> の説明は、<a href="https://ja.wikipedia.org/wiki/NoSQL">Wikipedia</a>によると、</p><blockquote><p>NoSQL系データベース管理システムには、データの格納および取得が高度に最適化されているものが多い。その最適化のために機能性を最小限にしているものもある。「値」およびそれを取得するための「キー」だけを格納できるKey-Value型データベースは、その最たる例である。</p></blockquote><p>とあります。 ぶっちゃけると、高速性、を目的としていると私は理解します。あと柔軟。 <strong>RDBMS</strong> は使いにくいとは言いませんが、テーブル間の制約やデータ整合性に重きを置いているためパフォーマンスが出にくいのでしょう。 そこまで複雑なデータベースを必要としないなら、NoSQL で十分です。 NoSQL は色々ありますが、</p><ul><li><a href="https://www.mongodb.org/">MongoDB</a></li><li><a href="http://cassandra.apache.org/">Apache Cassandra</a></li><li><a href="http://hbase.apache.org/">Apache HBase</a></li><li><a href="http://fallabs.com/kyotocabinet/">Kyoto Cabinet</a></li><li><a href="http://okuyama-project.com/ja/index.html">okuyama</a></li><li><a href="https://github.com/google/leveldb">LevelDB</a></li><li><a href="https://github.com/hibari/hibari">Hibari</a></li></ul><p>といったところでしょう。もっとあります。詳しくはWikiで。 今回はMongoDBを使ってみます。</p><h2 id="MongoDBの特徴"><a href="#MongoDBの特徴" class="headerlink" title="MongoDBの特徴"></a>MongoDBの特徴</h2><p>MongoDBはサービスとして動作し、そこに対して各種要求を行うタイプです。 <strong>MySQL</strong> とかと同じです。<strong>SQLite</strong> みたいな、データベースがファイルとして一つあって、それで完結するタイプではありません。 またライセンス形態が独特です。<strong>Affero General Public License (以下AGPL)</strong> です。</p><ul><li>コピーレフト (GPLと同じ)</li><li>サービスとして動作している、AGPL のソフトウェアに接続しているソフトウェアにもソースコードの公開が義務づけられている</li></ul><p>がざっくりとした特徴です。 ですが、開発元がクライアントからの接続のためのドライバ (ソフトウェア) を公開しているので、それを経由すれば問題ない、という感じです。(2次感染はしない、という見解) でも、Free Software Foundation は公式見解を出していません。 これについて、詳しいのは <a href="http://test.mongodb.jp/mongo/licence">http://test.mongodb.jp/mongo/licence</a> です。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><h2 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h2><p>何はともあれ、インストールです。 MongoDB は<a href="https://www.mongodb.org/downloads">ここ</a>からダウンロードできます。</p><ul><li>Windows 64-bit 2008R2+</li><li>Windows 64-bit 2008R2+ legacy</li><li>Windows 64-bit legacy</li><li>Windows 32-bit</li></ul><p>がありますが、一番上だけ、msi形式のみ。他はzipもあります。 ここは一番上にします。 他を選ぶと但し書きが出ます。 <strong>Windows 64-bit 2008R2+ legacy</strong></p><blockquote><p>This distribution does not include SSL encryption.</p></blockquote><p>訳: このディストリビューション (頒布物) は SSL 暗号化 を含んでいません。 <strong>Windows 64-bit legacy</strong></p><blockquote><p>The 64-bit legacy build does not include SSL encryption and lacks newer features of Windows that enhance performance. Use this build for Windows Server 2003, 2008, or Windows Vista</p></blockquote><p>訳: 64bitのレガシービルドは SSL 暗号化 を含んでいません。そして、パフォーマンスの改善するWindowsのより新しい機能もありません。Windows Server 2003、2008、Windows Vistaでこのビルドを使用します。 <strong>Windows 32-bit</strong></p><blockquote><p>32-bit builds are limited to around 2GB of data. In general you should use the 64 bit builds. See here for more information. 32-bit builds are deprecated as of 3.2, and will no longer be produced for future releases.</p></blockquote><p>訳:32bitのビルドにはデータが2GBまでという制限があります。通常は64bitビルドを使用するべきです。詳しい情報はこちらを。32bitビルドは3.2で廃止予定で、将来のリリースにおいて作成されることはありません。 msiなのでさくっとインストールします。 特に問題なく終わります。 おわらなかったらGoogle先生に助けを求めるか、公式サイトのコミュニティに質問してください。 ちなみに私はWindows10 64bitにインストールしましたが、問題がありませんでした。まる。</p><h2 id="As-a-Service"><a href="#As-a-Service" class="headerlink" title="As a Service"></a>As a Service</h2><p>いちいち、起動するのも面倒なので、サービスとして動かしてみましょう。 各種設定を行います。正直、インストーラで指定できるようにして欲しかった。 <a href="https://docs.mongodb.org/manual/tutorial/install-mongodb-on-windows/">公式ページに説明</a>があります。 全部訳していられないので、一部だけ抜き出して説明します。 <strong>1. 概要</strong> のっけから注意書きです。</p><blockquote><p>IMPORTANT: If you are running any edition of Windows Server 2008 R2 or Windows 7, please install a hotfix to resolve an issue with memory mapped files on Windows.</p></blockquote><p>訳: 重要: もし、Windows Server 2008R2、Windows7 で動かすのだったら、<a href="https://support.microsoft.com/ja-jp/kb/2731284">Hotfix</a>をインストールしてね。 というわけで、必要なら当ててください。私はWindows10なので当ててません。 <strong>2. インストール</strong></p><blockquote><p>You may specify an installation directory if you choose the “Custom” installation option. NOTE: These instructions assume that you have installed MongoDB to C:\mongodb.</p></blockquote><p>訳: “Custom” インストールオプションを選択して、インストール先を指定したかもしれません。 ノート: ここの説明は、インストール先が”C:\mongodb” だと仮定しています。 こんなところにインストールする人いるんでしょうか。Programs Filesの下でいいじゃんと思いますが、きっとパス文字列に空白を含むのがいやなんでしょう。 <a href="https://taktak.jp/2012/10/13/bitnami-redmine-statck-%E3%81%8C%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%AA%E3%81%84-%E3%81%A0%E3%81%A8/">う、頭が…</a> <strong>3. 設定ファイル作成</strong> まず、データベースの保存先とログの出力先フォルダを作ります。 インストール先が、<strong>C:\Program Files\MongoDB\</strong>、保存先はそれぞれ、<strong>D:\MongoDB\Storage\</strong>、<strong>D:\MongoDB\Logs\</strong>だとします。 フォルダは作成済みだとします。 次に、設定ファイルを作ります。<strong>mongod.cfg</strong> とします。UTF8で作っておけば安心かと。<strong>D:\MongoDB\mongod.cfg</strong> とします。 内容は、 [code] systemLog: destination: file path: D:\MongoDB\Logs\mongod.log storage: dbPath: D:\MongoDB\Storage [/code] とします。ログファイル名の部分は自由かな。 詳しい設定は<a href="https://docs.mongodb.org/manual/reference/configuration-options/">Configuration File Options</a>です。 ログのローリングとかできる感じです。 <strong>4. 設定ファイル読み込み</strong></p><blockquote><p>IMPORTANT Run all of the following commands in Command Prompt with “Administrative Privileges”.</p></blockquote><p>訳: 重要: “管理者として実行”を指定してコマンドプロンプトを起動してください なので指示に従ってください。 <strong>補足</strong> 複数のインスタンスでサービスを動かす場合は、この章を飛ばしてください。 MongoDBのインストール先に移動し、次のコマンドをたたきます。 [code lang=”dos”] mongod.exe –config “D:\MongoDB\mongd.cfg” –install [/code] エラーがなければ、すぐに終了します。 <strong>mongod.exe</strong> と <strong>mongo.exe</strong> を間違えないでください。 間違えると、 [code lang=”dos”] Error parsing command line: unrecognised option ‘–config’ try ‘mongo.exe –help’ for more information [/code] って親切に教えてくれます(震え声) これで、MongoDBがサービスとして登録されます。 <strong>5. マルチインスタンスで動かしたいです</strong> という方も安心。</p><blockquote><p>If needed, you can install services for multiple instances of mongod.exe or mongos.exe. Install each service with a unique –serviceName and –serviceDisplayName. Use multiple instances only when sufficient system resources exist and your system design requires it.</p></blockquote><p>訳: 必要なら、mongod.exeまたはmongos.exeの複数インスタンスをサービスとしてインストールできます。各サービスのインストール時に、ユニークな –serviceName と –serviceDisplayName をつけてください。複数のインスタンスは十分な権限とシステムリソースがあるとき、システム設計でそれが必要なときだけ使うことができます。 なので、サービス名を <strong>MongoDB1</strong>、表示名を <strong>MongoDB Main</strong> にしたいなら、 [code lang=”dos”] mongod.exe –config “D:\MongoDB\mongd.cfg” –install –serviceName “MongoDB1” –serviceDisplayName “MongoDB Main” [/code] するとこんなメッセージでます。 [code lang=”dos”] 2015-12-29T17:25:43.489+0900 I CONTROL [main] log file “D:\MongoDB\Logs\mongod.log” exists; moved to “D:\MongoDB\Logs\mongod.log.2015-12-29T08-25-43”. [/code] でこうなります。 <a href="../../../../public/2015/12/service.png"><img src="../../../../public/2015/12/service.png" alt="複数インスタンス"></a></p><p>で、当然ですが、複数のインスタンスを作って、同じ設定ファイルを読み込むとたぶん悲劇でしょう。 特に公式ページに何も書いてありませんでしたが。 以上。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>長くなりましたが、インストールまでは終了です。 次は実際につないでみます。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでNoSQLを試してみる MongoDB編 </category>
          
          <category> nosql </category>
          
          <category> データベース </category>
          
          <category> MongoDB </category>
          
          <category> NoSQL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで画像処理を試してみる OpenCVSharp編 第2回</title>
      <link href="/2015/12/28/617/"/>
      <url>/2015/12/28/617/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-9w">前回</a>は顔認識を行いました。</p><a id="more"></a><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>顔認識を行う際、前処理を行いました。サンプルコードでは、<strong>グレイスケール化</strong>、<strong>縮小</strong>、<strong>ヒストグラムの均一化</strong>が前処理でした。 <strong>グレイスケール化</strong> カラー画像を256階調のグレーな画像に変換します。 通常、RGBの各色 (赤、緑、青)の各輝度を特定の比率で混ぜ合わせ、グレーの256階調に変換します。 変換式は、<strong>ITU-R (国際電気通信連合 無線通信部門)</strong> 勧告の <strong>BT.601</strong> の <strong>0.299 R + 0.587 G + 0.114 B</strong>、<strong>BT.709</strong> の <strong>0.2126 R + 0.7152 G + 0.0722 B</strong>、<strong>SMPTER (米国映画テレビ技術者協会)</strong> が定めた規格 <strong>240M</strong> の <strong>0.212 R + 0.701 G + 0.087 B</strong> 等があります。 <strong>縮小</strong> 画像のサイズを小さくします。 単純に小さくすると言っても、縦横の比率を維持したり、そうでない方法もあります。 重要なのは、縮小の場合、消失する画素の情報をどのように、残される画素に含めるか、つまり補間するかということがあります。 単純なのは、消失する画素は完全に無視する方法です。 このあたりは、<strong>System.Drawing.Drawing2D.InterpolationMode 列挙体</strong> を参考にしてください。 <strong>ヒストグラムの均一化</strong> ヒストグラムの累積 (輝度値0から画素数を累積したもの) のグラフの傾きが一定になるように変換する処理です。コントラストの改善や明るさの偏りを修正することが可能です。 ヒストグラムの説明は省きますが、簡単に言うと、画像全体で0-255の輝度がそれぞれ何回登場するか、というデータと思ってくれれば結構です。 まずはこれらが何を意味するのか、どういう計算になるのかを想像してください。</p><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>本題に入ります。 OpenCV、というよりも世の中にある画像処理ライブラリは、機能毎にメソッドや関数を提供しています。 でないと使い勝手が悪いからです。汎用性を重視しています。 全ての物事において、そうだとは言いませんが、汎用性を重視していると言うことは、性能を犠牲にしていることを意味します。 次の説明は極端ですが、とあるライブラリでこんなメソッドがあるとします。 Bitmap GrayScaleScale(Bitmap, double, double) Bitmap GrayScaleScaleEqulizer(Bitmap, double, double) Bitmap GrayScaleEqulizer(Bitmap) Bitmap ScaleGrayScale(Bitmap, double, double) Bitmap EqulizerGrayScaleScale(Bitmap, double, double) 単純に順番を変えたり、一部を省略しただけですが、字面を見ればなんとなく言いたいことはわかります。 正直、組み合わせ毎にメソッドを用意していたら、とんでもないことになります。こんな仕様を見たら投げたくなります。 ですが、これらは、一回の呼び出しで全てを実行してくれる、という点にメリットがあります。 たかが、コード1行の違い、と思うかもしれませんが、ここで言う、<strong>一回の呼び出しで全てを実行してくれる</strong>は、コーディングの記述量を意味しません。 前にも書いたように、汎用性によって性能を犠牲にしています。つまり汎用性の犠牲は性能の改善に繋がります。 画像処理の世界では、これは非常に重要です。</p><h3 id="実験"><a href="#実験" class="headerlink" title="実験"></a>実験</h3><p>ちょっとサンプルを出します。 800x600の24bit画像があります。 これに、グレイスケール、縮小、ヒストグラムの均一化を順番に行うと、ループ回数はどの程度になるでしょう？縮小率は0.5、縮小方法は <strong>NearestNeighbor</strong> とする。 (注：24bit画像なので、1画素にRGBの3要素にアクセスする、というのは1回にカウントします) 普通に考えると800*600+800*0.5*600*0.5+(800*0.5*600*0.5)*256*2になります。 <strong>グレイスケール化</strong> <strong>800*600</strong> です。 全ての画素に対して処理を行います。 <strong>縮小</strong> <strong>800*0.5*600*0.5</strong> です。 全ての画素に対して処理を実施せず、縮小率0.5なので、2画素に1回画素へのアクセスが発生します。 <strong>ヒストグラムの均一化</strong> <strong>800*600</strong> です。 まず、画像全体のヒストグラムの計算で、<strong>800*0.5*600*0.5</strong> を消費します。 次に、取得したヒストグラムを使って、累積値とその比率を求めます。累積に256、その累積値を使ってヒストグラムの修正に256です。 最後に、画像全体の画素を補正します。 ですので、*<em>(800\</em>0.5*600*0.5)*2+256*2** で <strong>800*600+512</strong> になります。 合計 <strong>800*600*2.5+512</strong> です。 順番に処理を行うだけで、これだけ時間 (ループ処理が発生します) がかかります。 ですが、これを1回でまとめるとどうなるでしょう。 まず、今回は縮小がNearestNeighborなので、欠落する画素は無視できます。 すなわち、グレースケール化の前に縮小を行っても、結果は変わりません。 次に、グレースケール化ですが、縮小の時点で、欠落しない画素はわかりきっているので、この時点でグレースケール化を適用できます。 つまり、縮小とグレースケール化は同一のループで処理できます。800*0.5*600*0.5で済みます。 次はヒストグラムの均一化ですが、ヒストグラムの計算自体は、前のループで同時に計算できます。つまり、画素をグレースケール化できた時点でヒストグラムの計算が可能です。 最後のヒストグラムに基づいた補正自体は、ヒストグラム自体が計算できていないと実行できないため、800*0.5*600*0.5+512必要です。 よって、合計で <strong>800*0.5*600*0.5＋+800*0.5*600*0.5+512</strong> の <strong>800*600+512</strong> です。 ループ内の計算などがあるので、単純に比較はできませんが、ループ回数だけなら、4分の一で済みます。 上記を検証するためにサンプルプログラムを用意しました。 サンプルプログラムは<a href="https://github.com/takuya-takeuchi/Demo/tree/master/OpenCV2">https://github.com/takuya-takeuchi/Demo/tree/master/OpenCV2</a>。 サンプルで使用した画像は</p><blockquote><p><a href="https://commons.wikimedia.org/wiki/File:Landscape/_of/_Shadegan.jpg">https://commons.wikimedia.org/wiki/File:Landscape\_of\_Shadegan.jpg</a></p></blockquote><p>です。 ロジックはグレイスケール化、縮小、ヒストグラムの均一化を実行しますが、</p><ul><li><strong>Sequential</strong> =&gt; 順番に関数を実行。ループは関数毎になる。</li><li><strong>OpenCV</strong> =&gt; 前回の顔認識の前処理と同じ。ただし縮小がNearestNeighbor。</li><li><strong>Optimized</strong> =&gt; 可能な限りループをまとめている方法。</li><li><strong>Optimized (Parallel)</strong> =&gt; Optimized で、かつ　System.Threading.Tasks.Parallel</li><li><strong>Optimized (C++/CLI)</strong> =&gt; Optimized を C++/CLI に移植。</li></ul><p>のパターンで速度を計測しました。</p><h3 id="実験結果"><a href="#実験結果" class="headerlink" title="実験結果"></a>実験結果</h3><p>計測結果は [table id=14 /] となりました。 Seqentialはやはり遅いですね。全体的にOptimizedと比較して、2.0-2.5倍くらいの差です。ループ回数分の差だと言えます。 OpenCVのコアがNativeなので、Optimizedでもパフォーマンスに差が出るのは予想通りですが、それなりに善戦したと思います。 C++/CLIを使えばOpenCVを超えることも十分可能です。まぁそこまでするなら、最初からC++/CLIで全部コーディングするべきだと思いますが。 並列化は今回はあまり意味をなしませんでしたね。もっと大きな画像なら有意な差が出ると思うのですが。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>OpenCVは手軽に結果を確認できるあたりが良いです。 ですが、本気でパフォーマンスを追求するなら、OpenCVではなく、自分でロジックを実装することも必要です。 WPFやUWPでリッチなUIを実装し、高度な画像処理部はOpenCVまたは自分で実装するということになるでしょう。 MFC?知らねぇなぁ。</p><h1 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h1><p><a href="https://github.com/takuya-takeuchi/Demo/tree/master/OpenCV2">https://github.com/takuya-takeuchi/Demo/tree/master/OpenCV2</a></p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> OpenCV </category>
          
          <category> .NETで画像処理を試してみる OpenCVSharp編 </category>
          
          <category> OpenCvSharp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで難読化を試してみる 第6回</title>
      <link href="/2015/12/26/575/"/>
      <url>/2015/12/26/575/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-92">前回</a>の続き。 今回は難読化を有効にした際、Any CPUのアセンブリがx86になる問題の解決策についてです。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>前回は最高レベルの難読化にしたが故に、x86のアセンブリになってしまいました。 難読化レベルがデフォルトでは起こらない問題でしたので、何かしらのオプションが作用しているのは間違いないでしょう。 そこで Babel Obfuscator のヘルプを覗くと下記のような記述が</p><blockquote><p>Obfuscating x64 Assemblies Depending on the target platform, the Visual Studio compiler emits the desired CPU architecture into the PE header. Users of Visual Studio can set the target platform in the build project’s property page. The default platform is “Any CPU” which indicates that the compiled assembly can run on any version of Windows. When a managed executable is loaded, Windows examines the PE header to determine whether the application requires 32-bit or 64-bit CPU architecture to ensure that it matches the computer’s CPU type. Windows ensures the compatibility of 32-bit applications on 64-bit CPUs with a technology called WoW64 (Windows on Windows64) that emulates 32-bit instruction sets on a 64-bit CPU, albeit with a performance loss. When the application architecture is known, Windows loads the framework execution engine Just-In-Time compiler (JIT) specific to the executable target platform (x86, x64, Itanium). On x64 operating systems, the MSIL code of assemblies targeting “Any CPU” platform is validated by the .NET Framework runtime before execution. To protect an assembly from being disassembled by tools like .NET Reflector, Babel can insert into any MSIL method invalid byte codes that do not correspond to any MSIL op-code instruction (–invalidopcodes). The resulting assembly is no longer IL verifiable and Windows can execute it only on a WoW64 subsystem. Suppose that the obfuscated assembly is a DLL referenced by an executable that runs in full 64-bit environment. When the runtime tries to load the DLL obfuscated with invalid op-codes, it checks the CPU JIT requirements, and because they do not match, it throws an InvalidProgramException exception. The only way to generate obfuscated DLLs or executables fully compatible with x64 is to disable the injection of invalid op-codes during obfuscation.</p></blockquote><p>訳) x64アセンブリの難読化 対象のプラットフォームへの依存、Visual Studio コンパイラはPEヘッダーに必要とするCPUアーキテクチャを発行する。Visual Studioのユーザはビルド設定のプロパティページで対象プラットフォームを設定できます。既定のプラットフォームは “Any CPU” で、コンパイルされたアセンブリがどのバージョンのWindowsでも動作できることを示します。(訳注：正しくは、x86, x64のCPUアーキテクチャの違いであって、Windowsのバージョンではない)。マネージドの実行ファイルがロードされるとき、WindowsはPEヘッダーを検証し、アプリケーションが必要とするのが、32bit CPUまたは64bit CPUかどうかを、コンピュータのCPUの種別と一致するかどうかで確認する。Windowsは64bit CPU上で32bit命令セットをエミュレートするWoW64 (Windows on Windows64) と呼ばれるテクノロジーを持つ64bit CPU上での32bitアプリケーションの互換性を保証するが、パフォーマンスの損失を伴う。アプリケーションのアーキテクチャが既知であるとき、Windowsは、実行可能な対象プラットフォーム (x86, x64, Itanium) を指定するための、フレームワーク実行エンジンである Just-In-Time コンパイラ (JIT) をロードします。x64 のOS上で、”Any CPU”プラットフォームを対象としているMSILコードのアセンブリは実行前に.NET Framework ランタイムによって検証されます。 .NET Reflectorのようなツールによる逆アセンブルからアセンブリを保護するために、BabelはいくつかのMSILメソッドの不正なバイトコード-どのMSILの命令コードにも対応しない (–invalidopcodes) -を挿入することができます。その結果のアセンブリは、もはや IL (中間言語) として検証可能ではなく、WindowsはWoW64のサブシステム上でのみでしか実行させることができません。 難読化されたアセンブリが、完全な64bit環境上で実行される実行可能ファイルから参照されることもあるでしょう。ランタイムが不正な命令コードで難読化されたDLLのロードを試みるとき、CPU JIT 要求仕様をチェックし、それらが合致しないが故に、InvalidProgramException例外をスローします。x64と完全な互換性を持つ、難読化されたDLLまたは実行可能ファイルを生成する唯一の手段は、難読化中の不正な命令コードの挿入を無効にすることです。 少し長いですが、要約すると、逆アセンブルを防ぐためのオプション (–invalidopcodes) を使うと、x64上での互換性を維持できなくなるよ、って言ってます。 なので、このオプションを無効にすればAny CPUを維持することができるはずです。 再度ヘルプのオプション説明を見ると、</p><blockquote><p>Use this option to emit invalid MSIL op-codes at the beginning of every method. This will stop reflection tools like .NET Reflector to display IL method disassembly. Warning: This will make your assembly not verifiable. Normally, code that is not verifiable cannot run on x64 Operating Systems. This option should be switched off if the obfuscated assembly targets x64 platforms.</p></blockquote><p>訳) このオプションは不正なMSIL命令コードを全てのメソッドの先頭に挿入するために使用します。これは.NET Reflectorのような中間言語メソッドの逆アセンブルを表示するツールを阻止します。警告：このツールはアセンブルの検証不可にします。 通常、検証できないコードはx64OS上では実行できません。このオプションは難読化されるアセンブリがx64プラットフォームを対象とする場合はオフにするべきです。 とあります。 画面上、該当するオプションは、<strong>Control Flow Obfuscation</strong> の <strong>Emit Invalid Opcodes</strong> になります。 最初の説明を見ると、逆アセンブルを防ぐオプションが悪いので、<strong>Protection &amp; Code Generation</strong> の <strong>Anti Reflection</strong> や　<strong>Prevent ILdasm Disassembly</strong> が悪いように見えますが、<strong>全く無関係</strong>です。 Emit Invalid Opcodesだけ無効にして、再度難読化を実行します。 <a href="../../../../public/2015/12/Emit_Invalid_Opcodes.png"><img src="../../../../public/2015/12/Emit_Invalid_Opcodes-1024x695.png" alt="Emit Invalid Opcodes"></a></p><p>(1) 実行結果の検証 <strong>オプション有効時</strong> <a href="../../../../public/2015/12/Before.png"><img src="../../../../public/2015/12/Before-1024x642.png" alt="Before"></a></p><p><strong>オプション無効時</strong> <a href="../../../../public/2015/12/After.png"><img src="../../../../public/2015/12/After-1024x642.png" alt="After"></a></p><p>dotPeek での結果がAny CPUを表すようになったことがわかります。 最高の難読化レベルでもこのオプションは外しておいた方が無難かもしれません。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>一通り、難読化の処理を見てきましたが、ツールのオプションが豊富で、きちんと使い方を知っておかないと、思わぬ落とし穴にはまります。 国産の難読化ツールもありますが、正直海外製が一歩も二歩もリードしているのが印象でした。 自分は、オープンソースの開発を始めたので、難読化ツールの出番は減りますが、ひょっとしたら会社で使うようなことがあった場合に、この知識は有効になるでしょう。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> 難読化 </category>
          
          <category> .NETで難読化を試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで画像処理を試してみる OpenCVSharp編 第1回</title>
      <link href="/2015/12/26/590/"/>
      <url>/2015/12/26/590/</url>
      
        <content type="html"><![CDATA[<p>難読化の話が一区切りついてすらいないのに新しい記事を書く男の人って…</p><a id="more"></a><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>仕事で画像処理を本格的にやる必要に駆られています。 アフィン変換とか、画像の描画などは普通に業務で使うことが非常に多く、**.NET** の <strong>System.Drawing 名前空間</strong>を使って、そつなくこなすのですが、ことは <strong>C++</strong> となると話は別。 メモリ確保とか色々面倒だし、何よりロジックに注力することよりも、コードを書くことそのものに気をとられてげんなりするわけです。 で、話を戻すと、画像処理のその仕事は C++ を使うのですが、 <strong>OpenCV</strong> を使って、検証して、必要ならば純粋な C++ にポーディングする作業とのこと。 つまり、検証作業をするのに OpenCV で何ができて、何がダメなのかを理解する必要があります。 とはいえ、C++ でごりごりコードを書くのは勘弁願いたいわけです。 なので、OpenCV の勉強は .NET のラッパーライブラリを使って行うことにします。 先人の方々が既に説明されていますが、OpenCV のラッパーライブラリは、調べた限り、5 つあります。</p><h3 id="OpenCvSharp"><a href="#OpenCvSharp" class="headerlink" title="OpenCvSharp"></a>OpenCvSharp</h3><p><a href="http://schima.hatenablog.com/archive/category/OpenCvSharp">作者様サイト</a>。</p><h3 id="Emgu-CV"><a href="#Emgu-CV" class="headerlink" title="Emgu CV"></a>Emgu CV</h3><p><a href="http://www.emgu.com/">公式サイト</a>。</p><h3 id="OpenCV-NET"><a href="#OpenCV-NET" class="headerlink" title="OpenCV.NET"></a>OpenCV.NET</h3><p><a href="https://bitbucket.org/horizongir/opencv.net">公式サイト</a>。</p><h3 id="OpenCVLib"><a href="#OpenCVLib" class="headerlink" title="OpenCVLib"></a>OpenCVLib</h3><p><a href="http://www.geocities.jp/konbiki/tips/opencvdll2/index.html">作者様サイト</a>。</p><h3 id="OpenCV-NET-Wrapper"><a href="#OpenCV-NET-Wrapper" class="headerlink" title="OpenCV .NET Wrapper"></a>OpenCV .NET Wrapper</h3><p><a href="http://sourceforge.net/projects/opencvnet/">公式ページ</a>。 このうち、上2つが一番活発だと思いますが、特に、<strong>OpenCvSharp</strong> は<strong>日本人の方</strong>がリードしているため、非常に安心です。 そのため、これをベースに勉強していきます。</p><h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>OpenCV は非常に多くの画像処理機能が含まれています。フィルター処理、行列演算、ラベリング、物体検出、機械学習、カメラ入力等々。 現在、バージョン3が開発されていますが、2.4系が安定版として、広く利用されています。 事実、OpenCvSharp も2.4系がメインで、3はアルファ版のようです。私も2.4系を使い、最新版は2.4.10 OpenCvSharpの良いところは、<strong>NuGet</strong> 経由でインストールが全て完結する点にあります。 ラッパーdllはもちろん、OpenCVに含まれている、opencv_core2410.dll 等のネイティブdll が <strong>x86</strong> と <strong>x64</strong> の両方が同時にインストールされる親切設計。流石日本製。 ただ、気をつけて欲しいのは、NuGetで検索すると、同じ名前のものがあって、どっちが正しいのかわかりづらい点にあります。 同じ名前のパッケージがNuGetで見つかります。片方は、ネイティブdllがインストールされないため、実行時にエラーが出ます。 …えぇ、私は罠にかかりました。 <a href="../../../../public/2015/12/Nuget.png"><img src="../../../../public/2015/12/Nuget.png" alt="Nugetの罠"></a> &lt; div style=”clear:both;”&gt; インストールするのは、<strong>女性のアイコン (OpenCVの世界でおなじみの Lenna さん)</strong> の描かれたパッケージを選んでください。 長々書きましたが、最初は顔検出が簡単にできることを示します。 [code lang=”csharp”] private readonly CvHaarClassifierCascade _Cascade = CvHaarClassifierCascade.FromFile(@”haarcascade_frontalface_default.xml”);<br>private BitmapSource DetectFace(Bitmap bitmap) { var colors = new[]{ new CvColor(0,0,255) };<br>const int minNeighbors = 2; const int minSize = 50; const int maxSize = 100;<br>using (var img = bitmap.ToIplImage()) using (var smallImg = new IplImage(new CvSize(img.Width, img.Height), BitDepth.U8, 1)) { // Enhancement image to detect face using (var gray = new IplImage(img.Size, BitDepth.U8, 1)) { Cv.CvtColor(img, gray, ColorConversion.BgrToGray); Cv.Resize(gray, smallImg, Interpolation.Linear); Cv.EqualizeHist(smallImg, smallImg); }<br>using (var storage = new CvMemStorage()) { storage.Clear();<br>// Detect face var faces = Cv.HaarDetectObjects( smallImg, this._Cascade, storage, 1.05, minNeighbors, HaarDetectionType.FindBiggestObject, new CvSize(minSize, minSize), new CvSize(maxSize, maxSize));<br>// Draw circle for detected area for (var i = 0; i &lt; faces.Total; i++) { var r = faces[i].Value.Rect;<br>img.SetROI(r); var s = 0.01; img.Scale(img, s, s); img.Scale(img, 1 / s, 1 / s); img.ResetROI();<br>img.Rectangle(r.X, r.Y, r.X + r.Width, r.Y + r.Height, colors[0]); } }<br>return img.ToWriteableBitmap(); } } [/code] 上のコードのメソッドの引数bitmapに人間の顔が写った画像を渡すと顔の部分に青の枠線が描画され、その中身がぼやけさせる結果の画像を返します。 下記にポイントを書きます。</p><h3 id="1-パラメータファイルが使えない"><a href="#1-パラメータファイルが使えない" class="headerlink" title="1. パラメータファイルが使えない"></a>1. パラメータファイルが使えない</h3><p>顔検出は、パラメータファイルを　OpenCV のGitHub から持ってきたのですが、各種のブログサイトにあるように、 <code>https://github.com/Itseez/opencv/blob/master/data/haarcascades/haarcascade_frontalface_default.xml</code> を持ってきて、実行フォルダにコピーしても<strong>動きません</strong>。 こっちではなく、<strong>haarcascades_cuda</strong> というフォルダ内の下記の同名ファイルを使ってください (少なくとも、2.4.10では)。 <code>https://github.com/Itseez/opencv/blob/master/data/haarcascades_cuda/haarcascade_frontalface_default.xml</code></p><h3 id="2-前処理"><a href="#2-前処理" class="headerlink" title="2. 前処理"></a>2. 前処理</h3><p>// Enhancement image to detect face というコメントがありますが、引数に渡した画像のコピー、つまり顔検出させる対象にエフェクトをかけています。 (エンハンス処理と私は好んで言っています) エンハンスをすることによって、顔検出がしやすいようにします。 例えば、全体的に暗い画像を明るくし、コントラストを調整することで、顔などをくっきりさせて検出しやすくします。 こういう前処理は非常に重要です。画像サイズを縮小して、高速化したりすることもあります。</p><h3 id="3-画像中の顔のサイズの調整"><a href="#3-画像中の顔のサイズの調整" class="headerlink" title="3. 画像中の顔のサイズの調整"></a>3. 画像中の顔のサイズの調整</h3><p>顔検出は万能ではありません。 何が言いたいかというと、画像の中の顔のサイズがある程度わかっている必要がある、ということです。 コード中の Cv.HaarDetectObjects メソッドの最後の2つの引数は、推定される顔の最小・最大サイズを指定します。 すなわち、画像中のオブジェクトで、顔と思しきオブジェクトの大きさは、この範囲内に含まれる必要があります。 範囲を広くすると、顔ではないものが検出されて精度が落ちます。 このあたりの挙動は、HaarDetectionType.FindBiggestObject を変えると面白いです。 以上を踏まえて、カメラを使ってリアルタイムに検出した結果がこちら。 (カメラもOpenCVが提供しています。) <a href="../../../../public/2015/12/Sample.png"><img src="../../../../public/2015/12/Sample-1024x683.png" alt="モザイクは必須"></a> &lt; div style=”clear:both;”&gt; 今回はここまで。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> マルチメディア </category>
          
          <category> 画像処理 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> OpenCV </category>
          
          <category> .NETで画像処理を試してみる OpenCVSharp編 </category>
          
          <category> OpenCvSharp </category>
          
          <category> 顔認識 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>x264 を使ってみる</title>
      <link href="/2015/12/26/587/"/>
      <url>/2015/12/26/587/</url>
      
        <content type="html"><![CDATA[<p>カメラを使ったアプリケーションをWPFで作っているのですが、取得した連続画像を動画に変換したいと思いいろいろ試行錯誤しています。</p><a id="more"></a><p><strong>WMV</strong>、<strong>AVI</strong>等様々な形式がありますが、画質やサイズを考えるとやっぱり <strong>H264</strong> が良いのですが、ライセンスやコストを考えると悩みます。 とはいうものの、ライセンスさえ妥協すればH264のデコード・エンコードをサポートしている <strong><a href="http://www.videolan.org/developers/x264.html">x264</a></strong> は良い選択かと。ライセンスは <strong>GPL</strong>。 <strong>Cisco Systems</strong> が提供している <strong><a href="http://www.openh264.org/">OpenH264</a></strong> もありますが、こっちは使い方がよくわかりません。 OpenH264 の GitHub で<a href="https://github.com/cisco/openh264/issues/1260">連続画像の動画変換についての質問</a>がありました。</p><h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h2><blockquote><p>Suppose I have some pictures with similar content, and I want to compress it using h264 format, making it into something similar to a video stream. Also, I want it to be able for me to get every frame’s picture whenever I want to, but after I’ve read through the api, I’m a little bit confused and here are some questions I have: While encoding the pictures, do I just put these pictures into the encoder and let it encode? How do I get the image of any frames? I didn’t find a seek method in the decoder’s api. How should I implement it?</p></blockquote><p>訳) 似た内容のいくつかの画像があんだけど、それをH264形式に圧縮して、ビデオストリームのようなものにしたいんだ。取得できる全てのフレーム画像に対してね。でも、APIドキュメントに目を通した後、ちょっと混乱してしまって、ここで質問をしたい。 画像をエンコードする時、エンコーダに画像を与えて、エンコードさせるのかい？ どうやってフレーム画像を取得するんだい？デコーダのAPIドキュメントには見当たらない。自分で実装するの？</p><h2 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h2><blockquote><p>Currently encoder supports only I420 input. You should change your pictures into this format, and let encoder encode one picture by one. There is not an easy way to get the image of any frame, especially for all P picture coding. It’s not required as a pure enc/dec. I guess you need a player.</p></blockquote><p>訳) 今のところI420形式か入力はできないんだ。画像はそれに変換してくれ。で、エンコーダに画像を一つずつエンコードさせてね。 フレーム画像を取得する簡単な方法はないし、特に、全てのP画像 (訳注:Pの意味が不明。PNGのTypo?)はね。純粋なエンコーダ・デコーダに必要ではないね。 思うに、君には再生ソフトが必要だね。 訳は意訳だけど… ということで、なんかダメな感じがする。 だから、少し調べてx264なら画像を動画に変えることができることがわかったからここにメモしておく・ <strong>ffmpeg</strong> でタイムラプスを作る記事は<a href="http://qiita.com/riocampos/items/2f4fe927b5cf99aff767">riocampos様が書いてます</a>が、ffmpegを使うつもりはないので… x264のバイナリは適宜落としてきてください。 コマンドは、 <code>x264.exe &quot;input_%03d.png&quot; -o output.h264 -q 0 --input-range pc --range pc --muxer mp4</code> こんな感じ。</p><p><strong>“input_%03d.png”</strong> -&gt; input_000.png, input_001.png のような連番画像を入力</p><p><strong>-o output.h264</strong> output.h264という名前で出力</p><p><strong>-q 0</strong> -&gt; 品質。0-69 で指定して、0 はロスレス</p><p><strong>--input-range pc</strong> -&gt; 入力カラー範囲を指定。auto、tv または pc を指定</p><p><strong>--range pc</strong> -&gt; カラー範囲を指定。auto、tv または pc を指定</p><p><strong>--muxer mp4</strong> -&gt; 出力コンテナ形式を指定。auto、raw、mkv、flv または mp4 を指定</p><p>とのこと。 画像は <strong>Jpeg</strong> か <strong>Png</strong> じゃないとだめかも。少なくとも、<strong>Bitmap</strong> はだめでした。 Jpegで試しましたところ、320x180のJpeg画像591枚5.5MBが15.5MB (23秒) になりました。 30fpsに少し足りませんが、まぁ良い塩梅でした。 <strong>補足</strong> 出力コンテナ形式を指定する <strong>--muxer mp4</strong> を追加しました。</p>]]></content>
      
      
      <categories>
          
          <category> ソフトウェア紹介 </category>
          
          <category> マルチメディア </category>
          
          <category> オープンソース </category>
          
          <category> H264 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CI（継続的インテグレーション）の導入</title>
      <link href="/2015/12/20/584/"/>
      <url>/2015/12/20/584/</url>
      
        <content type="html"><![CDATA[<p>Red Armory を <a href="http://www.appveyor.com/">AppVeyor</a> による CI に対応させました。</p><a id="more"></a><p>AppVeyor は、.NET 開発者向けの CI &amp; デプロイツールです。GitHubの公開リポジトリに対してなら無料で利用できます。 CI によって、ビルドが通らないソースがコミットされると、すぐにわかるようになります。 なお、単体テストも自動で実施されますが、Bitnami Redmine Stack に関するテストは自動テストでは難しい、つまり環境依存になってしまうため、自動テストの実施は停止しています。</p>]]></content>
      
      
      <categories>
          
          <category> CI </category>
          
          <category> サービス紹介 </category>
          
          <category> オープンソース </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bitnami Redmine Stack のバックアップ・復元ツールの公開</title>
      <link href="/2015/12/20/582/"/>
      <url>/2015/12/20/582/</url>
      
        <content type="html"><![CDATA[<p>オープンソースで公開します。詳細は <a href="https://taktak.jp/wordpress/apps/">APPS</a> または <a href="https://github.com/takuya-takeuchi/RedArmory">GitHub</a> をご覧ください。</p>]]></content>
      
      
      <categories>
          
          <category> ソフトウェア紹介 </category>
          
          <category> 自作ソフトウェア </category>
          
          <category> Red Armory </category>
          
          <category> オープンソース </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで難読化を試してみる 第5回</title>
      <link href="/2015/12/19/560/"/>
      <url>/2015/12/19/560/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-8F">前回</a>の続き。 今回は<strong>アゼンブリマージ</strong>を使った場合、参照アセンブリ一覧にマージしたはずのアセンブリが残っていた問題の打開について検証します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>前回は、マージではなく埋め込みという方法でアセンブリの結合行いました。マージと結合は違います。ここ重要。 打開策の説明をする前にお知らせ。 今回の説明に <strong>Eazfuscator.NET</strong> は使いません。 それは、Eazfuscator.NET は有償化されたため、無償版はこれ以上サポートされないため、無償版は</p><ul><li>.NET Framework 4.5 はサポートされない</li><li>XAML 難読化の未サポート</li><li>高度な難読化の未サポート</li></ul><p>というのが理由です。 <a href="http://www.gapotchenko.com/eazfuscator.net/purchase">公式サイトの購入ページ</a>には</p><blockquote><p>Eazfuscator.NET established wide user base while being a freely available product. If you are an existing customer of Eazfuscator.NET, the following fair upgrade rules apply: All existing customers will get 30% off People who made donations to Eazfuscator.NET will get 80% off People who made donations larger than $49 will get Single Developer License for free</p></blockquote><p>訳) Eazfuscator.NET は、無償利用のプロダクトであった間に、広くユーザーベースに確立しました。もしあなたが Eazfuscator.NET の既存顧客なら、以下の公正なアップグレードルールを適用します ・全ての既存顧客は30%オフ ・Eazfuscator.NET に寄付した人々は80%オフ ・49ドル以上寄付した人々はシングルユーザライセンスの無償で入手 とあります。 30%オフの権利はあるので、399ドルの30%オフで有償版を入手できますが…. これを機に難読化のソフトを見直しました。 今回選んだのは、<a href="http://babelfor.net/products/obfuscator">Babel Obfuscator</a> です。 以前紹介しましたが、GUIが秀逸です。<a href="https://www.devexpress.com/">DevExpressのコンポーネント</a>を使っているのか、かっこいいインターフェイスです。 ちなみに、私は気に入りましたので、有償版を購入しました。 執筆時点での最新版は 8.3.0.0 です。</p><h2 id="Assembly-Merge"><a href="#Assembly-Merge" class="headerlink" title="Assembly Merge"></a>Assembly Merge</h2><p>実際に使ってみます。 今回のサンプルソースは、**<a href="https://github.com/takuya-takeuchi/Demo/tree/master/Obfuscation5">GitHub</a>** にあります。 前回は、埋め込んだアセンブリに対してまでリフレクションを実行した、つまり既にわかっているアセンブリに対するアセンブリの埋め込みが問題を引き起こしたようです。 なので、今回のサンプルはアセンブリのLoadは実行しません。あくまで、メソッドのリフレクションのみです。 Babel Obfuscator起動後、左側のInputをクリックし、右側にObfuscation5.exeをドラッグアンドドロップします。 次に追加されたObfuscation5.exeの左側にある +マークをクリックし、ノードを展開します。 InputsタブのFileにObfuscation5Lib.dllを追加し、ActionをEmbedに変更します。 そして、左端のチェックボックスにチェックがついていることを確認します。 <a href="../../../../public/2015/12/1-1.png"><img src="../../../../public/2015/12/1-1-300x204.png" alt="難読化準備"></a></p><p>これで準備は完了です。 一応他のSettingsやOptimzationsから難読化レベルや最適化が選択できますが今回は無視します。 (ちなみに、今回は使いませんが、これらの設定によって、アセンブリマージ後、使っていないPublicクラス等を削除して結合後のアセンブリを小さくできます。) 画面上部の再生マークみたいなボタンを押下します。すると、難読化が始まります。 既定では、最初に追加したアセンブリと同一フォルダに <strong>BabelOut</strong> というフォルダが作られ、そこに難読化されたアセンブリが追加されるようです。 (1) 実行結果の検証 <strong>Before</strong> <a href="../../../../public/2015/12/2-1.png"><img src="../../../../public/2015/12/2-1-300x218.png" alt="難読化前"></a></p><p><strong>After</strong> <a href="../../../../public/2015/12/3-1.png"><img src="../../../../public/2015/12/3-1-300x218.png" alt="難読化後"></a></p><p>(2) 逆コンパイラによるソースコード解析 <a href="../../../../public/2015/12/4-1.png"><img src="../../../../public/2015/12/4-1-300x188.png" alt="逆コンパイラによるソースコード"></a></p><p>どうでしょう？ きちんと参照からdllが消えて、アセンブリが埋め込まれているのがわかります。 デフォルトの設定でも、外部アセンブリでも一部はきちんと難読化されています。 ちなみにマージ後は、exe、dll ともに 5kbだったのが、37kbに増えています。 では、全ての設定を有効にして難読化した場合はどうなるでしょうか？ たぶん、一番気になるところでしょう。 SettingでObfuscation Level という右端のスライダーを一番上に。 OptimizationsでOptimizations Level という右端のスライダーを一番上に。 これで難読化を実行します。 <a href="../../../../public/2015/12/5-1.png"><img src="../../../../public/2015/12/5-1-300x188.png" alt="最高レベルで難読化"></a></p><p>が、また参照にdllが復活しています。でも実行は上手くいきます。 ひょっとして、難読化の程度によって、こういう風になるのは仕様なのでしょうか？要調査です。 さらに、何故か難読化後、AnyCPU設定が外れてx86になっていました。これバグ？ さらにさらに、最適化はしたけど、ファイルサイズが74kbまでふくれあがっていました。 おそらく、削除したクラスの数よりも、難読化による弊害のが強く影響してしまったためでしょう。 ちなみに、Babel Obfuscatorは難読化後、どの程度難読化が適用されたのかをグラフで見せてくれます。 <strong>シンボルのリネーム率</strong> <a href="../../../../public/2015/12/6.png"><img src="../../../../public/2015/12/6-300x204.png" alt="シンボルのリネーム率"></a></p><p><strong>シンボルのリネーム率 2</strong> <a href="../../../../public/2015/12/7.png"><img src="../../../../public/2015/12/7-300x204.png" alt="シンボルのリネーム率2"></a></p><p><strong>最適化率</strong> <a href="../../../../public/2015/12/8.png"><img src="../../../../public/2015/12/8-300x204.png" alt="最適化率"></a></p><p><strong>難読化に要した時間</strong> <a href="../../../../public/2015/12/9.png"><img src="../../../../public/2015/12/9-300x204.png" alt="難読化に要した時間"></a></p><p>今回は以上です。次回は…あるのか？</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> 難読化 </category>
          
          <category> .NETで難読化を試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで難読化を試してみる 第4回</title>
      <link href="/2015/12/19/537/"/>
      <url>/2015/12/19/537/</url>
      
        <content type="html"><![CDATA[<p><a href="http://wp.me/p7138e-2f">前回</a>の続き。 ですが、前回は3年前です。 なのに、皆さん難読化に興味があるのか、Blogの人気記事は難読化です。 今回は<strong>リフレクション</strong>と<strong>アゼンブリマージ</strong>を使った場合の難読化について検証します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>前回は、ソースコードの実行結果が、難読化前後で変化しないこと、逆アセンブルした後、人間が容易に理解できるようなソースコードではなくなっていたことを確認しました。 今回は、<strong>リフレクション</strong>と<strong>アゼンブリマージ</strong>がどう変化するのかを実際に見てみます。 サンプルソースは、**<a href="https://github.com/takuya-takeuchi/Demo/tree/master/Obfuscation4">GitHub</a>** に置きました。 前回のように、できあがった exe (今回は <strong>Obfuscation4.exe</strong>) を <strong>Eazfuscator.NET</strong> の右側の緑の領域に、作成したプログラムをドラッグアンドドロップします。</p><h2 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h2><p>(1) 実行結果の検証 <strong>Before</strong> <a href="../../../../public/2015/12/1.png"><img src="../../../../public/2015/12/1-300x218.png" alt="リフレクションの難読化前"></a></p><p><strong>After</strong> <a href="../../../../public/2015/12/2.png"><img src="../../../../public/2015/12/2-300x218.png" alt="リフレクションの難読化後"></a></p><p>(2) 逆コンパイラによるソースコード解析 <a href="../../../../public/2015/12/3.png"><img src="../../../../public/2015/12/3-300x157.png" alt="リフレクションの逆コンパイラ結果"></a></p><p>リフレクションは成功していることがわかります。</p><h2 id="Assembly-Merge"><a href="#Assembly-Merge" class="headerlink" title="Assembly Merge"></a>Assembly Merge</h2><p>ではアセンブリをマージしてみましょう。 次はできあがった exe と dll (<strong>Obfuscation4Lib.dll</strong>) を <strong>Eazfuscator.NET</strong> の右側の緑の領域に、作成したプログラムをドラッグアンドドロップします。 次にexeを実行すると… <a href="../../../../public/2015/12/4.png"><img src="../../../../public/2015/12/4-300x218.png" alt="アセンブリマージの実行結果"></a></p><p>失敗します。 直感的に、複数のアセンブリを複数ドロップすることでマージできそうですが、それでは失敗します。 結論から言うと、Eazfuscator.NET はアセンブリマージの機能は対応していますが、一工夫必要です。 [code lang=”csharp”] using System.Reflection; using System.Runtime.CompilerServices; using System.Runtime.InteropServices;<br>// アセンブリに関する一般情報は以下の属性セットをとおして制御されます。 // アセンブリに関連付けられている情報を変更するには、 // これらの属性値を変更してください。 [assembly: AssemblyTitle(“Obfuscation4”)] [assembly: AssemblyDescription(“”)] [assembly: AssemblyConfiguration(“”)] [assembly: AssemblyCompany(“”)] [assembly: AssemblyProduct(“Obfuscation4”)] [assembly: AssemblyCopyright(“Copyright © 2015”)] [assembly: AssemblyTrademark(“”)] [assembly: AssemblyCulture(“”)]<br>// ComVisible を false に設定すると、その型はこのアセンブリ内で COM コンポーネントから // 参照不可能になります。COM からこのアセンブリ内の型にアクセスする場合は、 // その型の ComVisible 属性を true に設定してください。 [assembly: ComVisible(false)]<br>// 次の GUID は、このプロジェクトが COM に公開される場合の、typelib の ID です [assembly: Guid(“386f10d7-d505-4caf-9d63-98ef058b1088”)]<br>[assembly: Obfuscation(Feature = “merge with Obfuscation4Lib.dll”, Exclude = false)]<br>// アセンブリのバージョン情報は、以下の 4 つの値で構成されています: // // Major Version // Minor Version // Build Number // Revision // // すべての値を指定するか、下のように ‘*‘ を使ってビルドおよびリビジョン番号を // 既定値にすることができます: // [assembly: AssemblyVersion(“1.0.*“)] [assembly: AssemblyVersion(“1.0.0.0”)] [assembly: AssemblyFileVersion(“1.0.0.0”)] [/code] 上記コードの中央下の <strong>[assembly: Obfuscation(Feature = “merge with Obfuscation4Lib.dll”, Exclude = false)]</strong> によってマージするアセンブリを指定できます。 その後、exe だけを再びドラッグアンドドロップして難読化を実行します。 さらに、アセンブリがマージされたことを確認するため、exe だけを別の場所に配置して実行すると上手く<strong>いきません</strong>。 <strong>ハンドルされていない例外: System.IO.FileNotFoundException: ファイルまたはアセンブリ ‘Obfuscation4Lib’、またはその依存関係の 1 つが読み込めませんでした。指定されたファイルが見つかりません。 場所 System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) 場所 System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyNameassemblyRef, Evidence assemblySecurity, RuntimeAssembly reqAssembly, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks) 場所 System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, IntPtr pPrivHostBinder, Boolean forIntrospection) 場所 System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection) 場所 System.Reflection.Assembly.Load(String assemblyString) 場所 .(String[] )</strong> <strong>(゜Д゜) ハア??</strong> という落とし穴があります。 どうも、Mergeには副作用があるようで、難読化等が失敗することがあるようです。 これはヘルプファイルに記載してあります。</p><blockquote><p>Usage of assemblies merging may lead to some side effects which may make obfuscation fail. If such is the case then use the principle of the least common denominator – merge just those assemblies which do not cause obfuscation failure. Assemblies embedding can be used in conjunction or as an alternative to assemblies merging.</p></blockquote><p>訳) アセンブリマージの使用は難読化の失敗させるかもしれない副作用を引き起こすかもしれません。そのようなケースでは、最小公倍数の原理-難読化失敗を引き起こさないアセンブリだけマージします。 アセンブリの埋め込みは結合に使うことができ、またはアセンブリマージの代用にすることができます。 そのため、 <strong>[assembly: Obfuscation(Feature = “merge with Obfuscation4Lib.dll”, Exclude = false)]</strong> を <strong>[assembly: Obfuscation(Feature = “embed Obfuscation4Lib.dll”, Exclude = false)]</strong> に変更します。 その後に、ビルド、exeのドラッグアンドドロップ実行、exeの隔離、実行をすると、今度こそ成功します。 ですが、先ほどと同じように <strong>JetBrains dotPeek</strong> で逆コンパイルして確認すると、参照アセンブリにObfuscation4Lib.dllが含まれたままです。 <a href="../../../../public/2015/12/5.png"><img src="../../../../public/2015/12/5-300x188.png" alt="マージ後の逆コンパイル"></a></p><p>なのに、exeを隔離して実行しても上手くいくのは、単純にdotPeekが上手く処理できていないだけなのでしょうか？ ただ、思うところはあります。 アセンブリをマージしているのに、 <strong>Assembly.Load</strong>でマージ(埋め込み)対象のアセンブリを読み込もうとしているのを認識しているのでしょうか？ 何はともあれ、参照済みのアセンブリをわざわざリフレクションでアセンブリをロードするのはやめた方が良いようです。イレギュラーでしょうし。 理由はこれ以上深く追求できませんしませんが、この問題を克服した結果をお見せします。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> 難読化 </category>
          
          <category> .NETで難読化を試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>サテライトアセンブリが反映されないとき</title>
      <link href="/2015/12/17/533/"/>
      <url>/2015/12/17/533/</url>
      
        <content type="html"><![CDATA[<p><strong>WPF</strong> のプロジェクトで多言語化しているとき、<strong>Resources.xx-XX.resx</strong> みたいなファイルを追加したときの話。</p><a id="more"></a><p>通常は、プロジェクトファイルの下の <strong>Properties</strong> ノードに追加していきますが (直接は追加できないので、一度別ノードに追加してから移動)、その際、下の画像のようにリソースファイル名の名前を間違えると、 [caption id=”attachment_534” align=”alignleft” width=”300”]<a href="../../../../public/2015/12/Resource.png"><img src="../../../../public/2015/12/Resource-300x288.png" alt="Resource.ja-JP.resxは間違い"></a></p><p>Resource.ja-JP.resxは間違い[/caption] </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeCulture</span>(<span class="params"><span class="keyword">string</span> name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Resources.Culture = CultureInfo.GetCultureInfo(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上のソースが無意味になります。 名前はきちんと Resource<strong>s</strong>.ja-JP.resx のようにしましょう。 これに気づかず1時間くらい時間を無駄にしました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Windows Presentation Foundation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack 3.2.0.0 で日本語が選択できない</title>
      <link href="/2015/12/12/526/"/>
      <url>/2015/12/12/526/</url>
      
        <content type="html"><![CDATA[<p>3.2.0.0にアップデートし、プラグインを更新してから何故か日本語が表示できない(´・ω・`) <a href="../../../../public/2015/12/MissingJapanese.png"><img src="../../../../public/2015/12/MissingJapanese-300x239.png" alt="日本語が行方不明"></a></p><p>プラグイン更新前は良かったのに… でも、プラグインを全部空にしたら日本語が選択できるようになった。 マジで意味不明。 一つずつインストールしては、外して、確認を繰り返すと…犯人は</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redmine_comment_only</span><br></pre></td></tr></table></figure><p>でした。 何でさ… プラグインが言語選択に影響するって、どういうことよ…</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack のアップデート 2.5.1-1 to 3.2.0.0</title>
      <link href="/2015/12/12/511/"/>
      <url>/2015/12/12/511/</url>
      
        <content type="html"><![CDATA[<p>またも久しぶりに<strong>BitNami Redmine Stack</strong>を更新しました。 そしてまた、今回も更新に手間取りました(白目)。 苦労話は<a href="http://wp.me/p7138e-7T">前回</a>を参照。</p><a id="more"></a><p>基本のアップデート手順は<a href="http://wp.me/p7138e-7T">以前 (2.0.3-1 to 2.1.0-0)</a>と同じです。</p><p>バックアップ</p><p>BitNami Redmine Stack のアンインストール</p><p>復元</p><p>アップデート</p><p>です。 今は、バックアップとリストアはバッチファイルで自動になっているので、苦労はしませんが、アップデートが面倒です。 いつもGemがないだの、よくわからないエラーが出てしまい、そのたびにGoogle先生に泣きついているのですから… 今回はアップデートに絞って記録をつけます。</p><h3 id="マイグレーション"><a href="#マイグレーション" class="headerlink" title="マイグレーション"></a>マイグレーション</h3><p>バックアップしたSQLとプラグインを復元し終わった後は、マイグレーション作業が必要です。 その前に、プラグインは一度、どこかに退避しておきます。 <strong>スタートメニュー</strong>-&gt;<strong>BitNami Redmine Stack</strong>-&gt;<strong>Use BitNami Redmine Stack</strong> でコマンドプロンプトを起動。 以下のコマンドを順次実行 (カレントディレクトリは私の環境です)。 [code lang=”dos”] C:\BitNami\Redmine&gt;cd apps\redmine\htdocs C:\BitNami\Redmine\apps\redmine\htdocs&gt;bundle exec rake db:migrate RAILS_ENV=production [/code] すると、 [code lang=”dos”] (in C:/BitNami/Redmine/apps/redmine/htdocs) DL is deprecated, please use Fiddle == 20150113194759 CreateEmailAddresses: migrating ============================= – create_table(:email_addresses) rake aborted! StandardError: An error has occurred, all later migrations canceled:<br>Mysql2::Error: Table ‘email_addresses’ already exists: CREATE TABLE `email_addresses` (`id` int(11) auto_increment PRIMARY KEY, `user_id` int(11) NOT NULL, `address` varchar(255) NOT NULL, `is_default` tinyint(1) DEFAULT 0 NOT NULL, `notify` tinyint(1) DEFAULT 1 NOT NULL, `created_on` datetime NOT NULL, `updated_on` datetime NOT NULL) ENGINE=InnoDBC:/BitNami/Redmine/apps/redmine/htdocs/vendor/bundle/ruby/2.0.0/gems/activerecord-4.2.5/lib/active_record/connection_adapters/abstract_mysql_adapter.rb:305:in `query’ C:/BitNami/Redmine/apps/redmine/htdocs/vendor/bundle/ruby/2.0.0/gems/activerecor [/code] という長いエラーが出ます。 ‘email_addresses’というテーブルが既に存在するからテーブル作成できませーん！って怒っています。 コマンドプロンプトから削除してもいいのですが、CUIは嫌いですし、何より視覚的に中に何が入っているかがわかりにくいので、GUIツールを使います。 <strong>MySQL Workbench</strong> というツールが<a href="http://dev.mysql.com/downloads/workbench/">ここ</a>から入手できるので環境に応じてダウンロード。 接続先の情報は、<strong>Redmine\apps\redmine\htdocs\config\database.yml</strong> にあります。 削除は下記のように行います。(削除する前に中身を確認してください。自己責任で。) <a href="../../../../public/2015/12/mysql_droptable-2.png"><img src="../../../../public/2015/12/mysql_droptable-2-300x226.png" alt="テーブルの削除"></a></p><p>削除したら、<strong>bundle exec rake db:migrate RAILS_ENV=production</strong> を再度実行し、類似のエラーが出なくなるまで繰り返します。 最終的に、</p><p>email_addresses</p><p>roles_managed_roles</p><p>imports</p><p>import_items</p><p>custom_field_enumerations</p><p>をドロップしました。 結果も、 [code lang=”dos”] (in C:/BitNami/Redmine/apps/redmine/htdocs) DL is deprecated, please use Fiddle == 20151025072118 CreateCustomFieldEnumerations: migrating ==================== – create_table(:custom_field_enumerations) -&gt; 0.0060s == 20151025072118 CreateCustomFieldEnumerations: migrated (0.0070s) ===========<br>== 20151031095005 AddProjectsDefaultVersionId: migrating ====================== – column_exists?(:projects, :default_version_id, :integer) -&gt; 0.0030s – add_column(:projects, :default_version_id, :integer, {:default=&gt;nil}) -&gt; 0.0130s == 20151031095005 AddProjectsDefaultVersionId: migrated (0.0170s) ============= [/code] のようになりました。</p><h3 id="起動"><a href="#起動" class="headerlink" title="起動"></a>起動</h3><p>サービスを一度全て再起動して、ログイン、チケットの作成、閲覧、削除ができるかをテストします。 <a href="../../../../public/2015/12/redmine320.png"><img src="../../../../public/2015/12/redmine320-300x191.png" alt="アップデート後"></a></p><h3 id="プラグインの更新"><a href="#プラグインの更新" class="headerlink" title="プラグインの更新"></a>プラグインの更新</h3><p>会社で使っている</p><p>redmine_work_time</p><p>redmine_knowledgebase</p><p>が3.2.0で使えなければ話になりません。 というわけでプラグインの更新です。 まず、退避したプラグインを戻し、各プラグインを最新版に更新します。 そして [code lang=”dos”] C:\BitNami\Redmine\apps\redmine\htdocs\plugins&gt;bundle install [/code] を実行して依存関係を解決します。 が、 [code lang=”dos”] You are trying to install in deployment mode after changing your Gemfile. Run `bundle install` elsewhere and add the updated Gemfile.lock to version control.<br>If this is a development machine, remove the Gemfile freeze by running `bundle install –no-deployment`. [/code] なるエラーが出て先に進めない。 調べてみると、解決策が。<a href="http://www.oiax.jp/rails/zakkan/how_to_apply_rails_security_updates.html">Ruby on Rails with OIAX様の記事</a> によれば、</p><blockquote><p>この場合は、.bundle ディレクトリにある config ファイルをVimなどのエディタで開きます。その中に、次のような書かれた箇所がありますので、その行を削除してください。 BUNDLE_FROZEN: “1” そして、もう一度 bundle update rails コマンドを実行してください。</p></blockquote><p>この説明に従った後は、bundle installが成功しますので、プラグインをインストールするべく [code lang=”dos”] C:\BitNami\Redmine\apps\redmine\htdocs\plugins&gt;bundle exec rake redmine:plugins:migrate RAILS_ENV=production [/code] を実行します。その後、問題がなければ、 [code lang=”dos”] C:\BitNami\Redmine\apps\redmine\htdocs\plugins&gt;bundle exec rake tmp:cache:clear C:\BitNami\Redmine\apps\redmine\htdocs\plugins&gt;bundle exec rake tmp:sessions:clear [/code] を実行して、キャッシュとセッションをクリアします。 その後、プラグインが動くかどうかをチェックします。 以上で全ての更新は完了です。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ReSharper Ultimate を All Products Pack に更新しました</title>
      <link href="/2015/12/11/509/"/>
      <url>/2015/12/11/509/</url>
      
        <content type="html"><![CDATA[<p><strong>ReSharper Ultimate</strong> を <strong>IntelliJ IDEA</strong>, <strong>ReSharper</strong>, <strong>ReSharper C++</strong>, <strong>dotTrace</strong>, <strong>dotMemory</strong>, <strong>dotCover</strong>, <strong>AppCode</strong>, <strong>CLion</strong>, <strong>PhpStorm</strong>, <strong>PyCharm</strong>, <strong>RubyMine</strong>, <strong>WebStorm</strong> が全部一緒になった <strong>All Products Pack</strong> に更新しました。</p><a id="more"></a><p>既存の有効なサブスクリプションがあったので <strong>199ドル</strong> で2年分ですよ。 3年目は <strong>149ドル</strong> ですよ。お得です。 個人ライセンスだけど、会社でも使えるので非常に助かります。これがないとストレスがたまります。 ReSharper だけでも試しに使ってみると世界が変わります。いやほんと。</p>]]></content>
      
      
      <categories>
          
          <category> ソフトウェア紹介 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ご無沙汰しておりました</title>
      <link href="/2015/12/06/507/"/>
      <url>/2015/12/06/507/</url>
      
        <content type="html"><![CDATA[<p>久しぶりにBlogを更新しました。2015年度ももう終わりますが、来年も何卒よろしくお願いいたします。</p>]]></content>
      
      
      <categories>
          
          <category> 未分類 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack のアップデート 2.3.0-0 to 2.5.1-1</title>
      <link href="/2014/05/10/489/"/>
      <url>/2014/05/10/489/</url>
      
        <content type="html"><![CDATA[<p>久しぶりに<strong>BitNami Redmine Stack</strong>を更新しました。 が、今回はいつも以上に更新に手間取りました。</p><a id="more"></a><p>基本のアップデート手順は<a href="https://taktak.jp/wordpress/?p=280">前回 (2.0.3-1 to 2.1.0-0)</a>と同じですが、**(8)** の手順は実行しないでください。 つまり (7) まで実行した段階で、次からの手順を実行します。</p><h2 id="1-プラグインの退避"><a href="#1-プラグインの退避" class="headerlink" title="(1) プラグインの退避"></a>(1) プラグインの退避</h2><p><strong>_InstallDir_\apps\redmine\htdocs\plugins</strong> (InstallDirはBitNami Redmine Stackのインストール先) から、プラグインを一度全部別のフォルダに移動します。 私の場合は、</p><p>redmine_logs</p><p>redmine_comment_only</p><p>redmine_knowledgebase</p><p>でした。</p><h2 id="2-データベースのマイグレーション"><a href="#2-データベースのマイグレーション" class="headerlink" title="(2) データベースのマイグレーション"></a>(2) データベースのマイグレーション</h2><p>データベースの更新を実行。<strong>スタートメニュー</strong>-&gt;<strong>BitNami Redmine Stack</strong>-&gt;<strong>Use BitNami Redmine Stack</strong> でコマンドプロンプトを起動。 以下のコマンドを順次実行 (カレントディレクトリは私の環境です)。 [code lang=”dos”] C:\BitNami\Redmine&gt;cd apps\redmine\htdocs C:\BitNami\Redmine\apps\redmine\htdocs&gt;rake db:migrate RAILS_ENV=”production” [/code] すると、 [code lang=”dos”] C:\BitNami\Redmine\apps\redmine\htdocs&gt;bundle exec rake db:migrate RAILS_ENV=”pr oduction” rake aborted! An error has occurred, all later migrations canceled:<br>Mysql2::Error: Table ‘queries_roles’ already exists: CREATE TABLE `queries_roles ` (`query_id` int(11) NOT NULL, `role_id` int(11) NOT NULL) ENGINE=InnoDBC:/BitN ami/Redmine/apps/redmine/htdocs/vendor/bundle/ruby/1.9.1/gems/activerecord-3.2.1 7/lib/active_record/connection_adapters/abstract_mysql_adapter.rb:245:in `query’ [/code] のようなエラーが出ました。 どうも**queries_roles**が既に存在しているとのことなので、このテーブルを削除します。 **※削除前にこのテーブルを削除していいかは確認してください** まず**mysql**に接続します。 データベースのパスワードは**_InstallDir_\apps\redmine\htdocs\config\database.yml**に書かれています。 引き続きコマンドプロンプトに下記のように入力します。 [code lang=”dos”] mysql -u bitnami -p bitnami_redmine Enter password: (ここはdatabase.ymlに記述されているパスワードを入力) drop table queries_roles; exit [/code] これで**queries_roles**が削除されます。 もう一度マイグレーションを試みますが、今度は、 [code lang=”dos”] C:\BitNami\Redmine\apps\redmine\htdocs&gt;bundle exec rake db:migrate RAILS_ENV=”pr oduction” == CreateCustomFieldsRoles: migrating ======================================== – create_table(:custom_fields_roles, {:id=&gt;false}) rake aborted! An error has occurred, all later migrations canceled:<br>Mysql2::Error: Table ‘custom_fields_roles’ already exists: CREATE TABLE `custom_ fields_roles` (`custom_field_id` int(11) NOT NULL, `role_id` int(11) NOT NULL) E NGINE=InnoDBC:/BitNami/Redmine/apps/redmine/htdocs/vendor/bundle/ruby/1.9.1/gems /activerecord-3.2.17/lib/active_record/connection_adapters/abstract_mysql_adapte r.rb:245:in `query’ [/code] と表示され、同じように<strong>custom_fields_roles</strong>が既に存在しているとのことなので、下記のコマンドでこのテーブルを削除します。 <strong>※削除前にこのテーブルを削除していいかは確認してください</strong> [code lang=”dos”] mysql -u bitnami -p bitnami_redmine Enter password: (ここはdatabase.ymlに記述されているパスワードを入力) drop table custom_fields_roles; exit [/code] その後、マイグレーションを実行すると成功します。</p><h2 id="3-プラグインのマイグレーション-その1"><a href="#3-プラグインのマイグレーション-その1" class="headerlink" title="(3) プラグインのマイグレーション その1"></a>(3) プラグインのマイグレーション その1</h2><p>退避したプラグインを<strong>_InstallDir_\apps\redmine\htdocs\plugins</strong>に戻します。 ただし、<strong>redmine_knowledgebase</strong>は削除します。 <strong>※redmine_knowledgebaseを使っていない人は何もしません</strong> 戻した後下記のコマンドでプラグインのマイグレーションを実施します。 [code lang=”dos”] bundle install bundle exec rake redmine:plugins:migrate RAILS_ENV=production bundle exec rake tmp:cache:clear bundle exec rake tmp:sessions:clear [/code] 成功したら、<strong>redmine manager tool</strong> から全てのサービス再起動。 その後、redmineにログインしてエラーが無いことを確認したら、2.5.1-1への更新が完了します。</p><h2 id="4-プラグインのマイグレーション-その2"><a href="#4-プラグインのマイグレーション-その2" class="headerlink" title="(4) プラグインのマイグレーション その2"></a>(4) プラグインのマイグレーション その2</h2><p><strong>redmine_knowledgebase</strong>を使っている方はこの作業が必須になります。 まず、最新のredmine_knowledgebaseを入手します (2014/05/10時点で3.0.4が最新)。 下記のコマンドを入力します。 [code lang=”dos”] C:\BitNami\Redmine&gt;cd apps\redmine\htdocs\plugins C:\BitNami\Redmine&gt;cd apps\redmine\htdocs\plugins&gt;git clone git://github.com/alexbevi/redmine_knowledgebase.git redmine_knowledgebase C:\BitNami\Redmine&gt;cd apps\redmine\htdocs\plugins&gt;bundle install –no-deployment C:\BitNami\Redmine&gt;cd apps\redmine\htdocs\plugins&gt;bundle exec rake redmine:plugins:migrate RAILS_ENV=production [/code] これでエラー無く更新が完了します。 前項と同じくサービスを再起動してログインします。 そこでおかしな事に気づきます。<br><a href="../../../../public/2014/05/redmine.png"><img src="../../../../public/2014/05/redmine-300x199.png"></a></p><p>上部のメニューに<strong>知識DB</strong>の項目がありません。 代わりにプロジェクトのメニューに<strong>ナレッジベース</strong>の文字が追加されています。 <a href="https://github.com/alexbevi/redmine_knowledgebase">公式サイト</a>によると、redmine_knowledgebaseの仕様が変わったようです。</p><blockquote><p>Upon restarting Redmine, the Knowledgebase entry will no longer appear as a :top_menu entry. The knowledgebase is now project-specific, and therefore must be included in at least one project to work properly. If you wish to use it like v2.x, you can make a public project that will only be used to store knowledgebase articles. You will need to go into your database now and change the kb_articles and kb_categories project_id to the project id of the knowledgebase project you just created.</p></blockquote><p>と記載があります。 これは</p><blockquote><p>Redmineを再起動するにあたり、Knowledgebaseの項目がトップメニューの項目に表示されないでしょう。 Knowledgebaseの現在のプロジェクトの仕様により、最低1つの正常に動作しているプロジェクトに含めなくてはなりません。もし、2.X系 (恐らくredmine_knowledgebaseのバージョン)のように使用した場合、記事を保存するためだけのパブリックなプロジェクトを作成します。 kb_articlesとkb_categories内のproject_id列を、作成したプロジェクト (記事を格納するために作成したもの)のproject_idに変更する必要があります。</p></blockquote><p>と訳せます。 纏めれば、従来の記事はRedmine全体のシステムに関連づけられるのではなく、特定のプロジェクトの配下に関連づけられるようになったため、記事を移動する必要があるということです。 そのため、記事を移行させるためのSQLを実行します。</p><h2 id="5-記事の移動"><a href="#5-記事の移動" class="headerlink" title="(5) 記事の移動"></a>(5) 記事の移動</h2><p>まず移動先のプロジェクトを作成します (既存のプロジェクトでも構いません)。 移動先のプロジェクトの<strong>識別子</strong>を確認します。 識別子は<strong>設定</strong>-&gt;<strong>情報</strong>-&gt;<strong>識別子</strong>から確認できます。 次に、下記のように、<strong>mysql</strong>に繋いで、<strong>project_id</strong>を確認します。 [code lang=”dos”] mysql -u bitnami -p bitnami_redmine Enter password: (ここはdatabase.ymlに記述されているパスワードを入力) SELECT id FROM bitnami_redmine.projects WHERE identifier=’識別子’; [/code] すると、 [code lang=”dos”] +—-+ | id | +—-+ | 27 | +—-+ 1 row in set (0.00 sec) [/code] のような感じで、project_idを取得できます。ここでは27とします。 次にこの値で<strong>kb_articles</strong>と<strong>kb_categories</strong>内の<strong>project_id</strong>を更新します。 続けて下記のSQLを実行します。 [code lang=”sql”] UPDATE bitnami_redmine.kb_articles SET project_id=’27’; UPDATE bitnami_redmine.kb_categories SET project_id=’27’; [/code] これで記事の移動は完了しました。 Redmineで移動先のプロジェクトの<strong>ナレッジベース</strong>を確認します。<br><a href="../../../../public/2014/05/redmine1.png"><img src="../../../../public/2014/05/redmine1-300x167.png"></a></p><p>このような感じになると思います。 以上で<strong>redmine_knowledgebase</strong>の更新は完了です。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows Server 2012 R2 #1 -ユーザー インターフェイスが戻せない-</title>
      <link href="/2014/05/09/486/"/>
      <url>/2014/05/09/486/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=456">前回</a>はWindows Server 2012 R2をデュアルブートでインストールしました。 <a href="http://www.microsoft.com/ja-jp/learning/mcp/exam.aspx?cert=1&id=70-410">MCP 70-410 Windows Server 2012 のインストールおよび構成</a>を受験すべくMVA等で勉強を始めたのですが早速はまったので備忘録がてら残しておきます。</p><a id="more"></a><h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>Windows Server 2012 R2には下記の4つのユーザー インターフェイスが用意されています。</p><p>なし</p><p>グラフィカル管理ツールとインフラストラクチャ</p><p>フル インストール オプション</p><p>インストール済みデスクトップ エクスペリエンス機能</p><p>それぞれの違いは<a href="http://technet.microsoft.com/ja-jp/library/hh831786.aspx">Windows Server インストール オプションのリファレンス表</a>を参照してください。 それで、自分はインストール時、<strong>フル インストール オプション</strong>でインストールを実行し、<strong>Server Core インストール オプション</strong> がどのようなものか分かりませんでした。 だから、インストール後変更できると知り、コマンドプロンプトから <code>Powershell Uninstall-WindowsFeature Server-Gui-Shell -remove</code> と叩いて、GUIが消えました。 で、一通り触った飽きた後、「さぁ戻すか」と思って、 <code>Powershell Install-WindowsFeature Server-Gui-Shell</code> とやったが戻らない＼(^o^)／ 黒背景のコマンドプロンプトに赤文字でエラーの旨が表示され恐怖心MAX。 片っ端から調べてみたところ、どうもインストールメディアが必要とのこと。 インストールメディアが無くても出来てる人がネットに居るのは何故？</p><h1 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h1><p>結論から言えば、インストールメディアを挿入した状態で <code>Powershell Install-WindowsFeature Server-Gui-Shell –Restart –Source wim:D:\source\install.wim:4</code> と入力すれば戻ります。 <strong>※D:\source\の部分はインストールメディアのドライブに応じて変更</strong> 初心者にServerOSは厳しい道のりなのか…</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Windows Server </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows 7 &amp; Server 2012 R2 をデュアルブートさせる</title>
      <link href="/2014/05/05/456/"/>
      <url>/2014/05/05/456/</url>
      
        <content type="html"><![CDATA[<p>会社の上期の目標として、ISV資格でサーバー系の資格を取るという、自身のキャリアから外れた目標を立ててしまったため、休みを通して実機環境を作成しました。 (開発系の資格って<strong>MCSD Windows Store Apps</strong>、<strong>MCSD Web Applications</strong>、<strong>MCSD Application Lifecycle Management</strong>、<strong>MCSD SharePoint Applications</strong>になっていてデスクトップどこー？って状況なんですよね…)</p><a id="more"></a><p>それで、家に空きマシンがないので、どうしたものか考えていると、Server 2012は<strong>VHD (Virtual Hard Disk)**からOS起動できるということを思い出したので、せっかくだから試してみることに。 ちなみにデュアルブートは人生初の試み。 **MSDN</strong>からServer 2012 R2のisoをダウンロードしてきて、ふと気づく。 ブランクメディアがないじゃん＼(^o^)／ コンビニ直行か？と思ったが、最近はUSBからインストールできるということで、それを試してみた。</p><h1 id="1-USBブートディスクの作成"><a href="#1-USBブートディスクの作成" class="headerlink" title="1. USBブートディスクの作成"></a>1. USBブートディスクの作成</h1><p>まず、<strong>Windows 7 USB/DVD Download Tool</strong>を<a href="http://images2.store.microsoft.com/prod/clustera/framework/w7udt/1.0/en-us/Windows7-USB-DVD-tool.exe">ここ</a>から入手。 起動すると、画面の指示に従っていくだけ。 <strong>Windows 7</strong>と銘打っていますが、<strong>Windows Server 2012 R2</strong>でも大丈夫です。<br><a href="../../../../public/2014/05/58fc2145d7ef47037a3357abf3dcc1cc.png"><img src="../../../../public/2014/05/58fc2145d7ef47037a3357abf3dcc1cc-300x158.png"></a></p><p>最初は、先ほどダウンロードしてきたisoファイルを指定<br><a href="../../../../public/2014/05/ca99454ba8e23c603d0a3ec4db1640a7.png"><img src="../../../../public/2014/05/ca99454ba8e23c603d0a3ec4db1640a7-300x158.png"></a></p><p>OSのバックアップ先ほど選択したisoを、USBデバイスかDVDメディアのどちらに展開するか。 今回は<strong>USB device</strong><br><a href="../../../../public/2014/05/1bcc71726762fdeaaac160e3a958eec3.png"><img src="../../../../public/2014/05/1bcc71726762fdeaaac160e3a958eec3-300x158.png"></a></p><p>展開先のUSBデバイスを指定。<br><a href="../../../../public/2014/05/eec1504dcb76d26710babaa00788614c.png"><img src="../../../../public/2014/05/eec1504dcb76d26710babaa00788614c-300x93.png"></a></p><p>「続行するには、選択したデバイスを消去する必要があります。デバイスからすべての中身を削除してもいいですか？」という確認。 <strong>Erase USB Device</strong>をクリック<br><a href="../../../../public/2014/05/8e7f8c5c54eebf97eefc9471b0dd644b.png"><img src="../../../../public/2014/05/8e7f8c5c54eebf97eefc9471b0dd644b-300x112.png"></a></p><p>本当に消すよ？いい？っていう優しい最終確認。 もちろん<strong>はい</strong><br><a href="../../../../public/2014/05/1d6a4704ae0937b9103fc551f3e50431.png"><img src="../../../../public/2014/05/1d6a4704ae0937b9103fc551f3e50431-300x158.png"></a></p><p>コピー完了までお待ちください。 終わったら、右上の<strong>×ボタン</strong>で終了</p><h1 id="2-VHDの作成"><a href="#2-VHDの作成" class="headerlink" title="2. VHDの作成"></a>2. VHDの作成</h1><p>次は、OSをインストールする先の箱となるVHDの作成。 管理者でコマンドプロンプトを開きます。<br><a href="../../../../public/2014/05/d27f865484828918fe59340b37fdf439.png"><img src="../../../../public/2014/05/d27f865484828918fe59340b37fdf439-300x218.png"></a></p><p>まず下記のように入力。 [code lang=”dos”] diskpart [/code]<br><a href="../../../../public/2014/05/6a43d188ba13634c7319d2251e203258.png"><img src="../../../../public/2014/05/6a43d188ba13634c7319d2251e203258-300x218.png"></a></p><p>次に下記のように入力。 [code lang=”dos”] create vdisk file=”D:\VHD\WinServer2012R2.vhd” maximum=65536 [/code] <strong>※D:\VHD\WinServer2012R2.vhd</strong>はお好みのパスで。ここはフルパス指定。 <strong>65536</strong>はVHDのサイズ。単位はMBなので、この場合は64GB。 しばらく待っていると終わるので、exitでdiskpartを抜けて、コマンドプロンプトは終了。</p><h1 id="3-インストール"><a href="#3-インストール" class="headerlink" title="3. インストール"></a>3. インストール</h1><p>先ほど作成したUSBをPCに接続して、OSを再起動して、USBからブートします。 BIOSの設定で、そのUSBからブートする指定にすればよいと思います。 これは個人の環境によりけりなので、詳しくはBIOSのマニュアルをチェック。 ブートしたら、<strong>Windowsのインストール場所を選んでください</strong>という画面までインストールを進めてください。<br><a href="../../../../public/2014/05/2014-05-05-15.00.18.jpg"><img src="../../../../public/2014/05/2014-05-05-15.00.18-300x225.jpg"></a></p><p>ここで<strong>Shift+F10キー</strong>を押してコマンドプロンプトを立ち上げてください。<br><a href="../../../../public/2014/05/2014-05-05-15.01.17.jpg"><img src="../../../../public/2014/05/2014-05-05-15.01.17-300x225.jpg"></a></p><p><strong>diskpart</strong>を実行します。 写真にはありませんが、<strong>list volume</strong>で利用できるドライブの一覧が表示されるので、その情報を参考に先のVHDのありかを見つけてください。 (ドライブの場所は変わっているかもしれませんので注意) その後、下記のように入力し、成功したら、exitでコマンドプロンプトを閉じます。 [code lang=”dos”] select vdisk file=”D:\VHD\WinServer2012R2.vhd” attach vdisk [/code]<br><a href="../../../../public/2014/05/2014-05-05-15.01.46.jpg"><img src="../../../../public/2014/05/2014-05-05-15.01.46-300x225.jpg"></a></p><p><strong>最新の情報に更新</strong>を押すと、先のVHDの領域が選択できるので、<strong>新規</strong>、<strong>フォーマット</strong>で利用可能にしてください。 <strong>※&lt;このドライブに Windows をインストールすることはできません/strong&gt;と出てきますが、問題なくインストールできます。</strong> あとは、このまま進めるだけです。 再起動したらBIOS画面が出る前にUSBは抜いておきましょう。そこからまたブートしてしまうので。 あとは、起動時にブートするOSを選択する画面が出るので、<strong>Windows Server 2012 R2</strong>を選んで残りのインストールを完了させれば、デュアルブート環境完成です。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Windows Server </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.iOS at VisualStudio #4 -その他のコントロール その2-</title>
      <link href="/2014/05/04/445/"/>
      <url>/2014/05/04/445/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=431">前回</a>の続き。</p><a id="more"></a><h1 id="Experimentation"><a href="#Experimentation" class="headerlink" title="Experimentation"></a>Experimentation</h1><h2 id="1-UISegmentedControl"><a href="#1-UISegmentedControl" class="headerlink" title="1. UISegmentedControl"></a>1. UISegmentedControl</h2><p>まずは、<strong>MonoTouch.UIKit.UISegmentedControl</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.TabControl**になります。 <script src="https://gist.github.com/takuya-takeuchi/8ac78671d7b01977103ce0451d4addcf.js"></script> ボタンの上にUISegmentedControlが追加されました。 ビルド実行するとこうなります。<br><a href="../../../../public/2014/05/b279f35134b1d30a540cee2b476b1556.png"><img src="../../../../public/2014/05/b279f35134b1d30a540cee2b476b1556-300x240.png"></a> Left,Center,Rightの領域をタップすると、その項目の文字列がアラートビューで表示されます。 <a href="../../../../public/2014/05/4f01bbd84827d41aa328e983a00dbc8b.png"><img src="../../../../public/2014/05/4f01bbd84827d41aa328e983a00dbc8b-300x240.png"></a></p><h2 id="2-UIDatePicker"><a href="#2-UIDatePicker" class="headerlink" title="2. UIDatePicker"></a>2. UIDatePicker</h2><p>次は<strong>MonoTouch.UIKit.UIDatePicker</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.MonthCalendar**です。 ただし、表示スタイルに、下記のモードが用意されています。</p><p>UIDatePickerModeDateAndTime：月日時分</p><p>UIDatePickerModeDate：年月日</p><p>UIDatePickerModeTime：時分</p><p>UIDatePickerModeCountDownTimer:カウントダウン</p><p>サンプルを修正します。 <script src="https://gist.github.com/takuya-takeuchi/ec986daa06d2e5f7fcdd6db39390d30f.js"></script> ビルドして、ボタンを押下すると、日時を選択できます。<br><a href="../../../../public/2014/05/89fe451c288648620239caad769dc78f.png"><img src="../../../../public/2014/05/89fe451c288648620239caad769dc78f-300x240.png"></a> 選択後、Doneボタンを押下すると、選択した日付+現在時刻がアラートビューで表示されます。 <a href="../../../../public/2014/05/5c5231ea8074dbba2660e108357a82ce.png"><img src="../../../../public/2014/05/5c5231ea8074dbba2660e108357a82ce-300x240.png"></a><br> 今回のサンプルはかなり趣が異なっています。 というのも<strong>UIDatePicker</strong>は<strong>MonoTouch.UIKit.UIViewController.View</strong>に表示されるのでは無く、<strong>MonoTouch.UIKit.UIActionSheet</strong>に表示されています。 <strong>UIActionSheet</strong>はアクションシートと呼ばれる、ユーザに選択肢を提示するコントロールです。 ある種の別ウィンドウを作成し、そのウィンドウ内にUIDatePickerとUIButtonを追加しています。</p><h2 id="3-UIStepper"><a href="#3-UIStepper" class="headerlink" title="3. UIStepper"></a>3. UIStepper</h2><p>最後は<strong>MonoTouch.UIKit.UIStepper</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.NumericUpDown**です。 ただし、表示部分は自分で用意する必要があります。 <script src="https://gist.github.com/takuya-takeuchi/e852f8ea7bca9a6b6b94515b7a13f8c0.js"></script> ビルドするとUIStepperが追加されています。<br><a href="../../../../public/2014/05/ea56fd41aafeb354fecde1a439c981a9.png"><img src="../../../../public/2014/05/ea56fd41aafeb354fecde1a439c981a9-300x240.png"></a> +,-をタップすると、左の数値部分が変化します。 <a href="../../../../public/2014/05/f2c577b7d241ff0f7b0017c0a92a9f51.png"><img src="../../../../public/2014/05/f2c577b7d241ff0f7b0017c0a92a9f51-300x240.png"></a> また、タップしたままにすると、数値の変動速度が加速されていきます。 そして、最小値、または最大値に達すると、その側はタップできなくなります。 <a href="../../../../public/2014/05/4d4c019674c6683654befcc36b5dfa5f.png"><img src="../../../../public/2014/05/4d4c019674c6683654befcc36b5dfa5f-300x240.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回は、 <strong>System.Windows.Forms.TabControl</strong>に対応する<strong>MonoTouch.UIKit.UISegmentedControl</strong>。 <strong>System.Windows.Forms.MonthCalendar</strong>に対応する<strong>MonoTouch.UIKit.UIDatePicker</strong>。 <strong>System.Windows.Forms.NumericUpDown</strong>に対応する<strong>MonoTouch.UIKit.UIStepper</strong>。 を使用しました。 今回も、対応する云々というのは私の偏見ですが、どういうものに似ているか、という認識は取っつきにくさを解消するための方便だと思います。 メインとなるコントロールは次で最後になると思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Microsoft Virtual Academy #4 -いまさら聞けない Windows アプリ開発入門 XAML/C# 編-</title>
      <link href="/2014/05/04/441/"/>
      <url>/2014/05/04/441/</url>
      
        <content type="html"><![CDATA[<p>タイトルの講義は<a href="http://www.microsoftvirtualacademy.com/training-courses/windows-app-xamlcs">こちら</a>です。 今回は下記のモジュールを受講しました。</p><p>Windows ストア アプリ開発入門</p><p>Hello World ～ストア アプリ/C# 編～</p><p>アプリ公開までの道のり</p><p>Windows ストア アプリ審査の注意点</p><p>本当に今更聞けないような内容ですが… ざっくりとストアアプリ開発の流れが分かります。 Hello Worldアプリは<strong>TextBlock</strong>を配置しただけのアプリですが… ただ、「誰でも簡単にストアアプリが作れます」というお題目はどうかと思います。 年間で5000円近くの開発ライセンス料を支払う必要がありますし、ストアの審査にも合格する必要があります。 また、従来のデスクトップアプリのように、<a href="http://www.vector.co.jp/">Vector</a>や<a href="http://www.forest.impress.co.jp/">窓の杜</a>のようなソフトウェア紹介サイトを経由できず、個人で気軽にソフトウェアを登録できる時代では無くなった感じがします。 ひとえに、Appleによる<strong>App Store</strong>の成功によって、開発者を特定のプラットフォームに囲い込み、あまつさえソフトウェアの開発に必要以上に資金を必要とするような流れになったのは個人開発者にとっては悲しいばかりです。 逆に、新たなマーケットと見て飛び込むのもありですが、「気軽」という言葉からはほど遠いのが現状だと思います。 そういう意味では企業内で公開できる<strong>サイドローディング</strong>の利用をモチベーションに、ストアアプリ開発のスキルを習得していくべきでは、と個人的に思いました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Microsoft Virtual Academy </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.iOS at VisualStudio #4 -その他のコントロール その1-</title>
      <link href="/2014/05/02/431/"/>
      <url>/2014/05/02/431/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=418">昨日</a>の続き。</p><a id="more"></a><h1 id="Experimentation"><a href="#Experimentation" class="headerlink" title="Experimentation"></a>Experimentation</h1><h2 id="1-UISlider"><a href="#1-UISlider" class="headerlink" title="1. UISlider"></a>1. UISlider</h2><p>まずは、<strong>MonoTouch.UIKit.UISlider</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.TrackBar<strong>になります。 また、UISliderの現在値を表示する</strong>MonoTouch.UIKit.UILabel<strong>も一緒に追加します。 これは</strong>.NET<strong>でいう</strong>System.Windows.Forms.Label**になります。 <script src="https://gist.github.com/takuya-takeuchi/0d9921f4ea7283d1843bbd0a861fb194.js"></script> ボタンの上にUISliderが追加されました。 あと、 ビルド実行するとこうなります。<br><a href="../../../../public/2014/05/94fea354519387cb284042d78a0e56e4.png"><img src="../../../../public/2014/05/94fea354519387cb284042d78a0e56e4-300x240.png"></a> スライダーを動かすと、スライダーの位置に応じてラベルの数値が変化します。 <a href="../../../../public/2014/05/120172322376ff7aa0dd02372c45e181.png"><img src="../../../../public/2014/05/120172322376ff7aa0dd02372c45e181-300x240.png"></a></p><h2 id="2-UIAlertView"><a href="#2-UIAlertView" class="headerlink" title="2. UIAlertView"></a>2. UIAlertView</h2><p>次は<strong>MonoTouch.UIKit.UITextView</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.MessageBox<strong>です。 iOSの世界では</strong>アラートビュー**ですね。 サンプルを修正します。 <script src="https://gist.github.com/takuya-takeuchi/ae8614447d2a479a6c575e9bae2fba7b.js"></script> ビルドして、ボタンを押下すると、スライダーの値をユーザにアラートビューで通知します。<br><a href="../../../../public/2014/05/3db0c9f32315462e7ba3f8603f54aed1.png"><img src="../../../../public/2014/05/3db0c9f32315462e7ba3f8603f54aed1-300x240.png"></a></p><h2 id="3-UISwitch"><a href="#3-UISwitch" class="headerlink" title="3. UISwitch"></a>3. UISwitch</h2><p>最後は<strong>MonoTouch.UIKit.UISwitch</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.CheckBox<strong>です。 iOSの世界では</strong>スイッチコントロール**ですね。 **中間値(Indeterminate)**は対応しているんでしょうか? サンプルを修正します。 <script src="https://gist.github.com/takuya-takeuchi/c9bb856bdca07145fa8647960f2f7f9c.js"></script> ビルドするとスイッチコントロールが追加されています。<br><a href="../../../../public/2014/05/3ce6dae65fed6aa626071f4602b086fb.png"><img src="../../../../public/2014/05/3ce6dae65fed6aa626071f4602b086fb-300x240.png"></a> スイッチを動かすと、ラベルの色が赤に変化します。 <a href="../../../../public/2014/05/e896dd40f038175c1e8e43ffc50b40c6.png"><img src="../../../../public/2014/05/e896dd40f038175c1e8e43ffc50b40c6-300x240.png"></a></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回は、 <strong>System.Windows.Forms.Label</strong>に対応する<strong>MonoTouch.UIKit.UILabel</strong>。 <strong>System.Windows.Forms.TrackBar</strong>に対応する<strong>MonoTouch.UIKit.UISlider</strong>。 <strong>System.Windows.Forms.MessageBox</strong>に対応する<strong>MonoTouch.UIKit.UIAlertView</strong>。 <strong>System.Windows.Forms.CheckBox</strong>に対応する<strong>MonoTouch.UIKit.UISwitch</strong>。 を使用しました。 あくまで、対応するというのは私の偏見ですが、どういうものに似ているか、という認識は取っつきにくさを解消するための方便だと思います。 まだ、紹介していないコントロールは次回に回します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Microsoft Virtual Academy #3 -C# プログラミング ジャンプ スタート (MCP 試験: 70-483)-</title>
      <link href="/2014/05/02/429/"/>
      <url>/2014/05/02/429/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=413">前回</a>の続きです。 タイトルの講義は<a href="http://www.microsoftvirtualacademy.com/Content/ViewContent.aspx?et=4186&m=4178&ct=19780">こちら</a>です。 今回は下記のモジュールを受講しました。</p><p>06 | アセンブリーとWinMDの分割、 診断と器具編成</p><p>07 | ファイルシステムとの相互作用、 ウェブサービスの活用</p><p>08 | オブジェクトとXMLに対するLINQの使用、シリアル化の基礎</p><p>タイトルにはありませんが、<strong>非同期処理(asyncとawait)**についても触れられていました。 まだ仕事でこれをつかったことは無いのですが、使いこなせれば相当便利でしょう。すくなくとも「使える」ぐらいにはならなくてはなりませんが。 **08 | オブジェクトとXMLに対するLINQの使用、シリアル化の基礎</strong>では、<strong>Entity Framework</strong>を使用したデモがありました。 これも使ったこと無いです。今の仕事の案件で使えそうかな、と思いましたが、すでに仕様書ではデータベースを使わないって書いたからもう駄目ですね。 大凡8時間の抗議でしたが、本来これは5日間の講義をオンライン向けに1日に纏めたものですので、かなり端折っていました。 それでも身になる講義でしたし、何より講師の<strong>Jerry</strong>と<strong>Daren</strong>の冗談を交えた掛け合いは非常に面白く、聴講者を退屈させません。 これで字幕の訳さえ良ければ(完璧とは言いません)、というのが唯一の心残りです。 これでこの講義は終了です。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Microsoft Virtual Academy </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.iOS at VisualStudio #3 -基本的なテキスト入力-</title>
      <link href="/2014/05/01/418/"/>
      <url>/2014/05/01/418/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=398">昨日</a>の続き。</p><a id="more"></a><h1 id="Experimentation"><a href="#Experimentation" class="headerlink" title="Experimentation"></a>Experimentation</h1><h2 id="1-UITextBox"><a href="#1-UITextBox" class="headerlink" title="1. UITextBox"></a>1. UITextBox</h2><p>前回はボタンが中央に配置するだけでしたが、今回は<strong>MonoTouch.UIKit.UITextField</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.TextBox<strong>になります。 では前回のサンプルに幾つか手を加えます。 <script src="https://gist.github.com/takuya-takeuchi/130e6c6d28f26747255f61bf814e6d9d.js"></script> ボタンの上にUITextFieldが追加されました。 ビルド実行するとこうなります。<br><a href="../../../../public/2014/05/1eb6d9c767e1236580fc9f3eeb738e40.png"><img src="../../../../public/2014/05/1eb6d9c767e1236580fc9f3eeb738e40-300x240.png"></a> ボタンをクリックすると、ボタンのテキストがUITextFieldにコピーされます。 テキストも手入力できます。 <a href="../../../../public/2014/05/ad1a874400fc5816060e96b0d5940b7d.png"><img src="../../../../public/2014/05/ad1a874400fc5816060e96b0d5940b7d-300x240.png"></a><br> UITextField上でEnterキーを押下すると、</strong>Select | Select All**のお馴染みのポップアップもきちんと表示されます。 ところで、表示されたキーボードはどう非表示にするのでしょうか？</p><h2 id="2-UITextView"><a href="#2-UITextView" class="headerlink" title="2. UITextView"></a>2. UITextView</h2><p>もう少し手を加えます。 次は<strong>MonoTouch.UIKit.UITextView</strong>を追加します。 これは**.NET<strong>でいう</strong>System.Windows.Forms.TextBox<strong>と同じですが、先のUITextBoxとの違いは、複数行入力が可能、読み取り専用にすることが可能という違いがあります。 さっきのサンプルを修正します。 <script src="https://gist.github.com/takuya-takeuchi/87b59df60c7e75e8381ac7950e72ea1f.js"></script> 最上部にUITextViewが追加されました。 複数行テキストを入力できます。<br><a href="../../../../public/2014/05/9a84978e4a7e086362d8a6ebad6cd658.png"><img src="../../../../public/2014/05/9a84978e4a7e086362d8a6ebad6cd658-300x240.png"></a><br> ちなみに、</strong>UITextView.Editable プロパティ<strong>に</strong>false**をセットすることで読み取り専用にできます。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>他にもできることはありますが、簡単にまとめると、 <strong>MonoTouch.UIKit.UITextBox</strong>は単一行の<strong>System.Windows.Forms.TextBox</strong>。 <strong>MonoTouch.UIKit.UITextView</strong>は複数行の<strong>System.Windows.Forms.TextBox</strong>で読み取り専用設定も付与可能。 という感じです。 何はともあれ、どのコントロールがどこにあるか、どういうことが出来るのかは覚えておかないと話になりません。 あと、<strong>UIButton</strong>の表示文字列は<strong>SetTitle メソッド</strong>で設定したから<strong>GetTitle メソッド</strong>で取得可能かと思ったら、<strong>CurrentTitle プロパティ</strong>で取得可能とかわかりにくすぎです。 この設計は<strong>WinForms</strong>から<strong>WPF</strong>へ移行するときの関門に通じるものがあります。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Microsoft Virtual Academy #2 -C# プログラミング ジャンプ スタート (MCP 試験: 70-483)-</title>
      <link href="/2014/04/30/413/"/>
      <url>/2014/04/30/413/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=372">前回</a>の続きです。 タイトルの講義は<a href="http://www.microsoftvirtualacademy.com/Content/ViewContent.aspx?et=4186&m=4178&ct=19780">こちら</a>です。 今回は下記のモジュールを受講しました。</p><p>03 | プログラムの流れををコントロールする; タイプとストリングを操る</p><p>04 | コードの反映と情報、 ガーベッジコレクションを使った作業</p><p>05 | 高度のC#、タイプと値の検証、 暗号化テクニック</p><p>どれもほとんど既存の知識(03はif,else if,elseやfor,foreach等の構文など初歩の内容)ではありますが、復習にはなると思います。 ちなみに、04の<strong>コードの反映と情報</strong>ですが、正しくは、<strong>コードのリフレクションと情報</strong>のはずです。 訳が直訳すぎるんでよね。 文脈の意図を汲まずに訳すから専門用語とかも訳されてしまっています。 例えば、<strong>SetName</strong>というメソッドがデモの中で登場するんですが、これ、字幕だと<strong>セット名</strong>って言ってますからね。 字幕の作成はアウトソーシングしているんのかもしれませんが、開発に一定の理解のあるスタッフが校閲したりしないんでしょうか？ <strong>アルゴリズム</strong>が<strong>アルゴイズム</strong>になっていたり。 それを除けば、<strong>高度のC#、タイプと値の検証、 暗号化テクニック</strong>は素晴らしい内容でした。 <strong>コントラクト</strong>とか、私は知ってはいますが、使ったことがない人間なので、デモの内容は非常にグッときました。 こういう知識の再確認は重要ですよね。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Microsoft Virtual Academy </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Microsoft Virtual Academy #0 -足跡-</title>
      <link href="/2014/04/30/411/"/>
      <url>/2014/04/30/411/</url>
      
        <content type="html"><![CDATA[<p>個人用の<strong>MVA</strong>の受講履歴を記録しておきます。 [table id=11 /]</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Microsoft Virtual Academy </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.iOS at VisualStudio #2 -Hello, World!!-</title>
      <link href="/2014/04/29/398/"/>
      <url>/2014/04/29/398/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=376">昨日</a>の続き。</p><a id="more"></a><h1 id="Experimentation"><a href="#Experimentation" class="headerlink" title="Experimentation"></a>Experimentation</h1><p>サンプルのコードを動かすと、背景白で中央に<strong>Click me</strong>と表示されているボタンがいますが、どこまでがボタンなのかこれでは分かりません。 なので、サンプルを <script src="https://gist.github.com/takuya-takeuchi/b0d5f545e6ad7aca94f9a40775f13614.js"></script><br><a href="../../../../public/2014/04/f5ef1711784b2fccd94d13c3a2e60b6c.png"><img src="../../../../public/2014/04/f5ef1711784b2fccd94d13c3a2e60b6c-300x240.png"></a> <a href="../../../../public/2014/04/667511d2c1bbfacae98efa80c010fa2b.png"><img src="../../../../public/2014/04/667511d2c1bbfacae98efa80c010fa2b-300x240.png"></a> 黒い背景に白いボタンが配置されています。 <strong>Finder &gt; ハードウェア &gt; 時計回りに回転</strong>で回転してもボタンの向きがいじされています。 ボタンの高さだけ維持されて、左右のマージンが固定されて回転しています。 自動でリサイズしているようなので、これをなくしてみようかと。 直感的にこれというコードをコメントアウトします。 <script src="https://gist.github.com/takuya-takeuchi/4ab51b79169b09f28fcfdff2b92bd3e6.js"></script> このコードで時計回りに回転させると、ボタンの座標が維持されて回転したので、画面中央に来なくなりました。 <a href="../../../../public/2014/04/fb0f74049fcda7730d1575c29f13d8cd.png"><img src="../../../../public/2014/04/fb0f74049fcda7730d1575c29f13d8cd-300x240.png"></a> <strong>UIViewAutoresizing.FlexibleWidth</strong>っていうのは、可変で幅を変更する感じですね。 恐らく初期のX座標を維持する形で幅の変更でしょう。 <strong>UIViewAutoresizing.FlexibleTopMargin</strong>、<strong>UIViewAutoresizing.FlexibleBottomMargin</strong>は、上下のマージンを可変にするのでしょう。 だからボタンの高さが変化しなかったのでしょう。 なので、逆に幅を維持して、高さを可変にするなら。 <script src="https://gist.github.com/takuya-takeuchi/dff14c08dd5e10f90cf49a66d2553faa.js"></script> これで結果は… <a href="../../../../public/2014/04/3be33e3d0e43ee963ec5238fafa67ee8.png"><img src="../../../../public/2014/04/3be33e3d0e43ee963ec5238fafa67ee8-300x240.png"></a> (°Д°)ﾊｧ? ボタン黒くなったし。 しかも<strong>Click me</strong>をクリックしても反応しない… どういうこと？ 何回か画面を回転させてると、 <a href="../../../../public/2014/04/af154108fe5c70e272f896944b9fb808.png"><img src="../../../../public/2014/04/af154108fe5c70e272f896944b9fb808-300x240.png"></a><br> ボタンが白くなった。でも、元の向きだし、元のサイズとも変わってしまっている… ボタンのクリックに反応する。 また回転させたけど、また黒いし…</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>よくわからない結果になりましたが、<strong>iOS</strong>は画面の回転を考慮した処理を簡単に追加できるようです。 プロパティ名も**.NET**と似た感じです(全く変わってしまったものもありますけど) 次はボタン以外のコントロールを触ってみたいです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.iOS at VisualStudio #1 -Hello, World!!-</title>
      <link href="/2014/04/29/376/"/>
      <url>/2014/04/29/376/</url>
      
        <content type="html"><![CDATA[<p>トライアル版を放り込んだのが土曜日ですが、色々あって、もう火曜日です。 月曜は9時半まで残業でした。 仕様書書くの面倒です。 愚痴終了。 本題。</p><a id="more"></a><p>タイトル通り、初心に返ってHello,World!!しましょう。 こんなの書いたの何年ぶりかと。 C#に触れたのが大学1年か2年だから？7年振りくらいですね、この気持ち。 さて、とりあえずさくっと、サンプルを作りますか。 <a href="../../../../public/2014/04/1.png"><img src="../../../../public/2014/04/1-300x207.png" alt="1"></a> <strong>Xamarin.iOS</strong>をインストールするとこんな項目が増えています。<strong>iPad</strong>,<strong>iPhone</strong>,<strong>Universal</strong>。 ここはどっちでも動きそうなUniversalにしましょうか。 で、<strong>HelloWorld Application</strong>を選択して作成。 で、しばらくMacと接続してると、準備が終わってソリューションエクスプローラーに出てきます。 <a href="../../../../public/2014/04/2.png"><img src="../../../../public/2014/04/2-240x300.png" alt="2"></a> MyViewController.cs AppDelegate.cs Info.plist Main.cs <strong>Info.plist</strong>って何？ <a href="../../../../public/2014/04/3.png"><img src="../../../../public/2014/04/3-300x181.png" alt="3"></a> って開いたのがこれ。 設定ファイルみたいものね。 ちなみにエクスプローラーから開くと中身はただのxmlでした。 [xml] <?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"> <plist version="1.0"> <dict> <key>UIDeviceFamily</key> <array> <integer>1</integer> <integer>2</integer> </array> <key>UISupportedInterfaceOrientations</key> <array> <string>UIInterfaceOrientationPortrait</string> <string>UIInterfaceOrientationLandscapeLeft</string> <string>UIInterfaceOrientationLandscapeRight</string> </array> <key>UISupportedInterfaceOrientations~ipad</key> <array> <string>UIInterfaceOrientationPortrait</string> <string>UIInterfaceOrientationPortraitUpsideDown</string> <string>UIInterfaceOrientationLandscapeLeft</string> <string>UIInterfaceOrientationLandscapeRight</string> </array> <key>MinimumOSVersion</key> <string>3.2</string> </dict> </plist> [/xml] Xamarinの<a href="http://docs.xamarin.com/guides/cross-platform/getting_started/introducing_xamarin_studio/">ページ</a>によると、</p><blockquote><p>Info.plist In addition to source code editing, the tabbed interface includes support for certain platform specific files. For example, when opening an Info.plist file, which is used by iOS applications to store various configuration data, the following user interface is presented to allow easy editing of the file:</p></blockquote><p><strong>訳</strong> ～略～。例えば、Info.plistを開くと、これは。様々な設定データを保存するためにiOSアプリケーションに使用され、下(※この説明文の下に画像があります)のユーザーインターフェイスはこのファイルを簡単に編集できるのがわかります。 やっぱり設定ファイルですね。 で、とりあえずビルド。 が、動きません。<br><a href="../../../../public/2014/04/4.png"><img src="../../../../public/2014/04/4-300x33.png"></a></p><p>とりあえず、 <strong>Application Name is not set in iOS Application Property Page Identifier is not set in iOS Application Property Page</strong> これは、アプリケーション名がiOSアプリケーションのプロパティページで設定されていません iOSアプリケーションプロパティページで識別子が設定されていません ですんで、<strong>Info.plist</strong>を見ます。 まあそれらしいのがあるけど、何入れるの？ Xamarinの<a href="http://docs.xamarin.com/guides/cross-platform/getting_started/introducing_xamarin_studio/">ページ</a>によると、 <code>Application name: Corpy2 Indentifier:com.zamarin.sample.corpy2 Version:1</code> ってあった。Application nameはわかるけど、IdentifierってJavaの名前空間みたいね。きもちわるいわー。 とりあえず適当に放り込んで… クラッシュした＼(^o^)／ 気持ち新たにもう一回。 あれ？入力しても保存されない？ビルドしても同じエラー。 なんぞ？よーわからんので、プロジェクトファイルのプロパティを見ると…<br><a href="../../../../public/2014/04/5.png"><img src="../../../../public/2014/04/5-300x181.png"></a></p><p>こんなん出ましたけどー。<br><a href="../../../../public/2014/04/6.png"><img src="../../../../public/2014/04/6-300x181.png"></a></p><p>なので、<strong>iOS Application</strong>から、Application name、Indentifier、Versionを放り込んで再度ビルド。 ｷﾀ―――(ﾟ∀ﾟ)―――― !! 嘘です。<br><a href="../../../../public/2014/04/7.png"><img src="../../../../public/2014/04/7-300x41.png"></a> <strong>ERROR: Could not find the selected device Available devices: iPhone (Retina) 7.1 iPad 7.1 iPad (Retina) 7.1 Try to refresh the device list with the Refresh button</strong> ？ 選択したデバイスが見つかりません。利用可能なのは、iPhone (Retina) 7.1,iPad 7.1,iPad (Retina) 7.1。リフレッシュボタンを押してデバイスリストを更新して。 って言われても… ん？ これですか？ <a href="../../../../public/2014/04/8.png"><img src="../../../../public/2014/04/8-300x61.png"></a></p><p>どっちにつなぐの？Windows?Mac? Macにつないでみたら、VisualStudioの表示が変わりました。<br><a href="../../../../public/2014/04/9.png"><img src="../../../../public/2014/04/9-300x69.png"></a></p><p>だめだ、ビルドしても同じエラー。困った。 …ひょっとして、実機は駄目？ というか、<strong>iPhoneSimulator</strong>が無いんですが？<br><a href="../../../../public/2014/04/11.png"><img src="../../../../public/2014/04/11-300x106.png"></a></p><p>…あ、ソリューションプラットフォームから選択ですか？ <strong>iPhone</strong>になっているのを<strong>iPhoneSimulator</strong> これでビルド！！<br><a href="../../../../public/2014/04/101.png"><img src="../../../../public/2014/04/101-300x187.png"></a><br> 動きましたーーーー 1時間くらい経ってようやくここまできました。 実機が駄目だったりしましたが、とりあえず動かすことが出来たので、次はソースを編集してサンプルをいじくり回したいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>キーボード/マウスレスなMac Mini</title>
      <link href="/2014/04/28/368/"/>
      <url>/2014/04/28/368/</url>
      
        <content type="html"><![CDATA[<p><strong>Xamarin.iOS</strong>で遊びたいが為に<strong>Mac Mini</strong>を買いました。 が、ディスプレイは無論、キーボードもマウスも買わず、家にあるあり合わせで間に合わせることになった。 常にリモートから接続するんだけど、起動時に毎回毎回<strong>Bluetooth設定アシスタント</strong>なるシステムアプリがキーボードを探しにいく。 目障りこの上ないので、口を封じることに。 <strong>Appleメニュー</strong>→<strong>システム環境設定</strong>→<strong>Bluetooth</strong>→<strong>詳細設定</strong>から</p><p>起動時にキーボードが検出されない場合はBluetooth設定アシスタントを開く</p><p>起動時にマウスが検出されない場合はBluetooth設定アシスタントを開く</p><p>の2項目のチェックを外すことで解決。</p>]]></content>
      
      
      <categories>
          
          <category> Apple </category>
          
          <category> Mac </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Microsoft Virtual Academy #1 -C# プログラミング ジャンプ スタート (MCP 試験: 70-483)-</title>
      <link href="/2014/04/27/372/"/>
      <url>/2014/04/27/372/</url>
      
        <content type="html"><![CDATA[<p>特に受講する必要があるような講義では無いけど受講しました。 とはいったものの、まだ最初の2セッションだけですが。 タイトルの講義は<a href="http://www.microsoftvirtualacademy.com/Content/ViewContent.aspx?et=4186&m=4178&ct=19780">こちら</a>です。 <strong>What’s MVA?</strong> Microsoft Virtual Academyの略です。オンラインで動画やPDFファイルが公開されていて特定の技術についてのスキル強化できます。自分の好きなときに学習するオンデマンドコースと現実の特定の日時に提供されるライブイベントがあります。 動画が基本英語(だと思います)ですが、字幕があります(全てにある？)。 でも、時折誤字脱字とか訳す必要の無いところを訳していたりするはご愛敬。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> C# </category>
          
          <category> Microsoft Virtual Academy </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xamarin.iOS 始めました</title>
      <link href="/2014/04/27/363/"/>
      <url>/2014/04/27/363/</url>
      
        <content type="html"><![CDATA[<p>1年振りの更新ですが、何とか生きています。 掲題の通り、<strong>Xamarin.iOS</strong> を始めました。 いきなり、<strong>Mac Mini</strong>買ってきて、その日にMSDNサブスクリプション経由で90日間トライアル版をダウンロードしてきました。 で、Windows側、Mac側とインストールを進めていくんですが、ここで少し躓いたのでメモ。</p><ol><li>Mac側でインストーラ**(XamarinInstaller.dmg)<strong>をダウンロードしてきて展開しても中身が空。隠し設定になっていたのか、ターミナルから設定を変えれば中身が見えました。隠しファイルの表示はターミナルで</strong>defaults write com.apple.finder AppleShowAllFiles -boolean true**と入力する。</li><li>Visual Studio側と接続しようと、<strong>Build Host</strong>なるものをMac側で立ち上げようにも見つからない。<strong>Xamarin Studio</strong>を起動して、**Check for Updates..**で更新後、Mac側を再起動したら見つかった。</li></ol><p>とりあえずペアリングに成功。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> Xamarin </category>
          
          <category> C# </category>
          
          <category> Apple </category>
          
          <category> iOS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Redmine 2.3.0 &amp; 2.2.4 リリース</title>
      <link href="/2013/03/20/360/"/>
      <url>/2013/03/20/360/</url>
      
        <content type="html"><![CDATA[<p><a href="http://redmine.jp/">Redmine.jp</a> では、まだ告知されていませんが、<strong>Redmine 2.3.0</strong> が3/19にリリースされました。 当初は2月中リリースでしたが、一度3/10に延期されてから、その後もリリースされず、リリース日が告知されること無く今日まで来ましたが、ようやくリリースされました。 同時に、<strong>2.2.4</strong>もリリースされました。 ロードマップをみても、<strong>2.2.5</strong>が現時点出ないことから、2.2系列はこれが最後のようです。 ちなみに、既に<strong>2.3.1</strong>がロードマップに登場していることから、2.3系列の安定版はまだ先になりそうです。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack で Mercurial を使う</title>
      <link href="/2013/03/02/348/"/>
      <url>/2013/03/02/348/</url>
      
        <content type="html"><![CDATA[<p><strong>BitNami Redmine Stack</strong>の良いところは、既存の環境を壊さずに<strong>Redmine</strong>を使えることです。 既存の環境を壊さない、ということは削除が楽と言うことです。 Redmine一式だけでなく、ソースコード管理システムである、<strong>Subversion</strong>、<strong>Git</strong>も組み込まれます。 ところが、Redmineのプラグイン開発者の中には、GitでもSubversionでもなく、<strong>Mercurial</strong>でソースを管理している方が大勢います。 そのため、プラグインを入手・更新するのに、ダウンロード、展開、コピーという手間をかける必要があります。 それは面倒。ということでBitNami Redmine Stack自身にMercurialを組み込みます。</p><a id="more"></a><p>一番大事なのは、Mercurialをインストールしないということです。 大まかな手順は</p><ol><li>Mercurialをポータブル化</li><li>BitNami Redmine StackのコンソールからMercurialを呼べるようにする</li></ol><p>になります。 <strong>1. Mercurialをポータブル化</strong> 基本は、<a href="http://hp.vector.co.jp/authors/VA052754/tips/mercurial_portable.html" title="Mercurial をポータブル化する方法">Mercurial をポータブル化する方法</a> を参考にしました。 <strong>TortoiseHg</strong>を展開して中のファイル群を取り出す手法です。 この手順をバッチファイルに纏めました。 [code lang=”dos”] @echo off<br>@set INSTALLER=%CD%%~1 @set HGTEMP=%CD%hgtemp @set HG=%CD%hg<br>echo ********************************************************* echo. echo インストーラを展開します。 echo. echo *********************************************************<br>@mkdir “%HGTEMP%” @msiexec.exe /a “%INSTALLER%” targetdir=”%HGTEMP%” /qn<br>echo. echo ********************************************************* echo. echo 必要なファイル群を展開します。 echo. echo ********************************************************* echo.<br>@xcopy “%HGTEMP%\PFiles\TortoiseHg” “%HG%\“ /y /s /q /d /h<br>echo. echo ********************************************************* echo. echo 不要なファイル群を削除します。 echo. echo *********************************************************<br>@rmdir “%HGTEMP%” /s /q @rmdir “%HG%\i18n” /s /q @rmdir “%HG%\locale” /s /q @rmdir “%HG%\contrib” /s /q @rmdir “%HG%\diff-scripts” /s /q @rmdir “%HG%\doc” /s /q @rmdir “%HG%\help” /s /q @rmdir “%HG%\hgrc.d” /s /q @del “%HG%\ThgShellx64.dll” @del “%HG%\TortoiseHgOverlayServer.exe” @del “%HG%\TortoisePlink.exe” @del “%HG%\COPYING.txt” @del “%HG%\docdiff.exe” @del “%HG%\extension-versions.txt” @del “%HG%\kdiff3.exe” @del “%HG%\Pageant.exe” [/code] コマンドプロンプトでこのバッチファイルにTortoiseHgのインストーラを渡すだけです。 <strong>例</strong> [code lang=”dos”] portable.bat tortoisehg-2.7.0-hg-2.4.2+-x64.msi [/code] これにより、カレントディレクトリに<strong>hg</strong>フォルダができあがり、<strong>Hg.exe</strong>が入手できます。 <strong>2. BitNami Redmine StackのコンソールからMercurialを呼べるようにする</strong> ここからが肝です。 まず、できあがったhgフォルダをBitNami Redmine Stackのインストール先にコピーします(gitフォルダがある階層です)。 このインストール先を_InstallDir_とします。 <strong>InstallDir\scripts\setenv.bat</strong>をテキストエディタで開きます。 先頭行に [code lang=”dos”] set PATH=InstallDir/git\cmd;InstallDir/DevKit\bin;InstallDir/DevKit\mingw\bin;InstallDir/sqlite;InstallDir\imagemagick;InstallDir\ruby\bin;InstallDir/subversion\bin;C:/BitNami/Redmine/php;InstallDir/mysql\bin;%PATH% [/code] のような記述があります。その直後に、 [code lang=”dos”] set PATH=InstallDir/hg;%PATH% [/code] と追加してください。 これにより <strong>スタートメニュー-&gt;BitNami Redmine Stack-&gt;Use BitNami Redmine Stack</strong> からのコマンドプロンプトでMercurialを呼び出すことができます。 <a href="../../../../public/2013/03/hg.png"><img src="../../../../public/2013/03/hg-300x265.png" alt="Mercurialの呼び出し"></a> 次に。リポジトリを閲覧するための設定を変更します。 <strong>InstallDir\apps\redmine\htdocs\config\configuration.yml</strong>をテキストエディタで開きます。 130行目あたりを [code lang=”diff”] - scm_mercurial_command: + scm_mercurial_command: InstallDir\hg\hg.exe [/code] に修正します。 その後、Redmineを再起動します。 再起動後、<strong>管理-&gt;設定-&gt;リポジトリ</strong>にて<strong>使用するバージョン管理システム</strong>を確認すると、Mercurialが使用できるようになっています。 (チェックボックスにチェックがついていないなら、チェックしてください) <a href="../../../../public/2013/03/config.png"><img src="../../../../public/2013/03/config-300x96.png" alt="使用するバージョン管理システム"></a> 以上で終了です。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack のアップデート 2.1.2-0 to 2.2.0-0</title>
      <link href="/2012/12/22/339/"/>
      <url>/2012/12/22/339/</url>
      
        <content type="html"><![CDATA[<p>2012年9月にリリースされた<strong>Redmine 2.1.0</strong>以来のメジャーバージョンアップということで、<strong>Redmine 2.2.0</strong>が2012年12月18日リリースされました。 それに追随する形で翌日、<strong>BitNami Redmine Stack 2.2.0-0</strong>もリリースされました。 Bitnami Redmine Stackの2.1系はプラグインが使えなくなっており、途中からインストールを断念したのですが(詳しくは<a href="https://taktak.jp/wordpress/?p=307" title="BitNami Redmine Stack 2.1.2-0にRedmine Backlogsをインストールする">BitNami Redmine Stack 2.1.2-0にRedmine Backlogsをインストールする</a>を参照)、<strong>Bitnami Redmine Stackの更新履歴</strong>に気になる記述があったので試してみました。</p><a id="more"></a><p>Bitnami Redmine Stackの更新履歴には、</p><blockquote><p>Version 2.2.0-0 2012-12-19 * Updated Redmine to 2.2.0 * Updated PHP to 5.4.9 * Reverted Ruby to 1.9.3-p194 only for Windows because compatibility issues with plugins. Version 2.1.5-0 2012-12-19 * Updated Redmine to 2.1.5 * Updated PHP to 5.4.9 * Downgrade the Ruby version on Windows to 1.9.3p194 to fix the issue with plugins: <a href="http://www.redmine.org/boards/4/topics/34353">http://www.redmine.org/boards/4/topics/34353</a></p></blockquote><p>と記述されており、<strong>プラグインの互換性問題</strong>によってRubyを古いバージョンに戻しているようです。 これを見てもしかしたら!!と思い更新したところ見事に復活しました。 プラグインは<a href="https://github.com/alexbevi/redmine_knowledgebase">redmine_knowledgebase</a>が必須なので、前述の問題によってプラグインが動かなかった私にとって、今回の更新はまさに救いでした。 システムのバージョンアップの際の心配事の筆頭は、これまで使っていた資産との互換性である、ということを強く認識しました。 Redmineのバージョンアップの際は、いつもプラグインの互換性が気になってしまいます。 <a href="http://www.redmine.org/projects/redmine/roadmap">Redmineのロードマップ</a>によれば、次のメジャーバージョンアップである<strong>2.3.0</strong>は<strong>2013/02/24</strong>とのこと。 それまでは、マイナーチェンジが繰り返されることでしょう。 [caption id=”attachment_342” align=”aligncenter” width=”273”]<a href="../../../../public/2012/12/Information.png"><img src="../../../../public/2012/12/Information-273x300.png" alt="2.2.0への更新結果"></a> 2.2.0への更新結果[/caption]</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VSUG DAY 2012 Winter に行ってきました。</title>
      <link href="/2012/12/16/332/"/>
      <url>/2012/12/16/332/</url>
      
        <content type="html"><![CDATA[<p><strong>VSUG DAY 2012 Winter</strong> に参加してきました。詳細は<a href="http://vsug.jp/tabid/228/EventID/22/Default.aspx">こちら</a>。 どのセッションも濃い内容で非常にためになりましたが、<strong>GrapeCity</strong>の<strong>八巻さん</strong>(<a href="http://d.hatena.ne.jp/Yamaki/" title="Yuya Yamaki&#39;s blog">Yuya Yamaki’s blog</a>)と<strong>日本マイクロソフト株式会社 SQL Server 技術顧問</strong>の<strong>熊澤氏</strong>のセッションはとても興味深かったです。 特に熊沢氏のセッションは、非常に勢いと熱がこもっていたと思います。 熊沢氏も話し中、しきりに汗を拭うなど、熱いトークだったことがよくわかります。 何かと比較される<strong>Oracle</strong>と<strong>SQL Server</strong>ですが、熊沢氏はしきりに<strong>「これができるのはSQL Serverだけ！」</strong>とか<strong>「Oracleの人が見たら腰を抜かす」</strong>などアグレッシブでした。 2回目の参加で、今回は出張を利用できたので宿泊費だけで参加できました。 次も是非参加したいです。 お土産として<strong>Visual Studioのロゴの入ったスマートフォン用タッチペン</strong>をGETしました。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> その他 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Office 2010 ダウンロード版のインストールに失敗する？</title>
      <link href="/2012/12/09/330/"/>
      <url>/2012/12/09/330/</url>
      
        <content type="html"><![CDATA[<p>今や<strong>猫も杓子もAmazon</strong>って感じですが、この度<strong>Microsoft Office XP</strong>を<strong>2010</strong>に更新しました。その際にAmzaonのダウンロード販売を利用したのですが、少しはまったので情報展開。 AmazonからダウンロードしたOfficeのインストーラを起動しても「このパッケージのインストールが失敗しました」とか出てインストールが開始できない状況になったのが発端。</p><a id="more"></a><p>最初は64bit版をダウンロードしたのですが、それがだめなの？と思い32bit版にしても同じ。 おかしい。 これは問い合わせか？と思ったが、ふと気づいた。 <strong>インストーラを展開している段階でエラー→展開できない→書き込みに失敗している？</strong> という推測からTempフォルダの容量を確認したら、ビンゴ。 容量が1GBしかないwwww というのも<strong>RAMディスク</strong>を採用しているため、高速化とセキュリティ確保のため、RAMディスクにTempフォルダを割り当てているのだが…その容量が少なめだったのだ。 これを4GBに調整して再度インストールしたら、無事終了。 最終的には<strong>3GB近く</strong>インストーラが消費していました。 RAMディスクへのTempフォルダ設定はくれぐれもご注意を。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Office </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack のチケットに添付画像のサムネイルが表示されないのを修正する</title>
      <link href="/2012/12/01/323/"/>
      <url>/2012/12/01/323/</url>
      
        <content type="html"><![CDATA[<p><strong>Redmine 2.1</strong>の新機能として添付ファイルのサムネイル画像を表示する機能がありますが、<strong>BitNami Redmine Stack</strong> では何故かこの設定が無効です。 本来なら <code>管理-&gt;表示-&gt;添付ファイルのサムネイル画像を表示</code> を有効にすることで添付画像がサムネイルで表示されるはずですが、何故かチケットを見ても番号が表示されるだけです。</p><a id="more"></a><p>これを修正するには設定ファイルを修正する必要があります。 <strong>BitNami Redmine Stack</strong> のインストールフォルダを <strong><em>InstallDir</em></strong> とします。</p><ol><li><p><strong>_InstallDir_\apps\redmine\htdocs\config\configuration.yml.example</strong> をコピーして、<strong>_InstallDir_\apps\redmine\htdocs\config\configuration.yml</strong> を作成します。</p></li><li><p><strong>default:</strong> と記述されている行の直下に下記のように記述します。InstallDir は 1. と同じですが、<strong>\</strong> を <strong>/</strong> に変更します。また、先頭は半角スペースを2文字挿入します。</p></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">imagemagick\_convert\_command:</span> <span class="string">&#x27;InstallDir/imagemagick/convert.exe&#x27;</span> </span><br></pre></td></tr></table></figure><p>つまり、インストール先が <strong>C:\BitNami\Redmine\</strong> なら </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">imagemagick\_convert\_command:</span> <span class="string">&#x27;C:/BitNami/Redmine/imagemagick/convert.exe&#x27;</span> </span><br></pre></td></tr></table></figure><p>になります。</p><ol><li><strong>BitNami Redmine Stack</strong> を再起動します。</li></ol><p>以上で終了です。これで添付ファイルが正しくサムネイルで表示されます。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack 2.1.2-0にRedmine Backlogsをインストールする</title>
      <link href="/2012/11/18/307/"/>
      <url>/2012/11/18/307/</url>
      
        <content type="html"><![CDATA[<p><strong>スクラム開発</strong>ってのが流行っている、というのでせっかくのBTS、<strong>Redmine</strong>を使って導入できないか？って調べたらプラグインがあるようなので導入してみた。 が、結構道のりは長かった。長かった。 ですので、多大な時間を労するのは、私だけで良いんです。これを見ている方々には、<strong>「ここは俺に任せてお前らは先に行け！」</strong> と言わせていただきたいwww</p><a id="more"></a><p>阿呆なコメントはさておき。 この記事の目標は簡単にスクラム環境をRedmineに導入するプラグイン<strong>Redmine Backlogs</strong>を簡単にインストールする事です。 たかがプラグインと思っていると躓きます。結構面倒です。というか、Redmineのプラグインは何かあると、<strong>すぐにRedmine本体が動かなくなります</strong>から本当に困ります。 導入対象環境は<strong>BitNami Redmine Stack 2.1.2-0</strong>です。 最新のバージョンは<strong>BitNami Redmine Stack 2.1.2-2</strong>ですが、これへの導入は失敗しました。 なんせ、既存のプラグインすら動かなくなった、どころかログインはできるが、その後の画面がすべて<strong>404</strong>とかなにそれwww なので対象環境は<strong>BitNami Redmine Stack 2.1.2-0</strong>です。間違えないように。 では早速。 まずは下準備。</p><ol><li>必要なファイルをバックアップ</li><li>既存のBitNami Redmine Stackを一度アンインストール</li><li>インストール先はファイルパスに空白が含まれないこと (ここでは<strong>C:\BitNami\Redmine</strong>として説明します)</li><li>新しいBitNami Redmine Stackをインストール</li><li>バックアップから復元 (ただし、プラグインは復元しない)</li></ol><p>という手順まで終えてください。 つまりクリーンな環境にインストールすることを前提とします。 インストール先は、<a href="https://taktak.jp/wordpress/?p=302">前回</a>と同じくファイルパスに空白が含まれない場所にします。 では早速。 (1) システムにパスを通します。<strong>システムのプロパティ-&gt;詳細設定-&gt;環境変数</strong>と進み、<strong>ユーザー環境変数</strong>に下記を追加します。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RAILS\_ENV&#x3D;production PATH&#x3D;C:\\BitNami\\Redmine\\ruby\\bin;C:\\BitNami\\Redmine\\imagemagic </span><br></pre></td></tr></table></figure><p><strong>PATH</strong>の<strong>C:\BitNami\Redmine\</strong>の部分は<strong>BitNami Redmine Stack</strong>のインストール先になりますので、適宜置き換えてください。 <strong>PATH</strong>は既存の値の後ろに追加することになります。従って、PATHの既存の値が </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\\Program Files (x86)\\Visual Studio 2005 SDK\\2007.02\\VisualStudioIntegration\\Tools\\Sandcastle\\ProductionTools\\; </span><br></pre></td></tr></table></figure><p>なら、 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\\Program Files (x86)\\Visual Studio 2005 SDK\\2007.02\\VisualStudioIntegration\\Tools\\Sandcastle\\ProductionTools\\;C:\\BitNami\\Redmine\\ruby\\bin;C:\\BitNami\\Redmine\\imagemagick </span><br></pre></td></tr></table></figure><p>になります。既存の値の末尾に <strong>;</strong> をつけてから、前述の値を追加することになります。終わったら<strong>OK-&gt;OK</strong>でプロパティを終了します。 (2) <strong>Ruby Development Kit</strong>をダウンロードします。<a href="http://rubyinstaller.org/downloads/">このページ</a>からダウンロードします。最新版は<strong>DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe</strong>になります。 (3) ダウンロードしたファイルを展開します。</p><p><a href="../../../../public/2012/11/Extract.png"><img src="../../../../public/2012/11/Extract-300x121.png" title="Extract"></a></p><p>このようなウィンドウが開くのでRuby Development Kitを展開したいフォルダパスを指定します。ここも空白が含まれるパスは避けた方が無難です。ここでは、<strong>C:\BitNami\Redmine\DevKit</strong>にインストールします。 (4) <strong>スタートメニュー-&gt;BitNami Redmine Stack-&gt;Use BitNami Redmine Stack</strong> でコマンドプロンプトを起動。以下のコマンドを順次実行。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> DevKit ruby dk.rb init </span><br></pre></td></tr></table></figure><p>すると、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Initialization complete! Please review and modify the auto-generated &#x27;config.yml&#x27; file to ensure it contains the root directories to all of the installed Rubies you want enhanced by the DevKit. </span><br></pre></td></tr></table></figure><p>と出ます。 コマンドプロンプトはそのまま開いたままで。 (5) <strong>C:\BitNami\Redmine\DevKit</strong>に<strong>config.yml</strong>が生成されたはずなのでテキストファイルで開きます。 (6) 末尾に<strong>ruby</strong>のインストール先を追記します。rubyのインストール先は<strong>BitNami Redmine Stack</strong>の直下なので、 </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">C:\\BitNami\\Redmine\\ruby</span> </span><br></pre></td></tr></table></figure><p>のように追記してください。 (7) 以下のコマンドを順次実行。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby dk.rb install </span><br></pre></td></tr></table></figure><p>すると、 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\[INFO\] Updating convenience notice gem override for &#39;C:&#x2F;BitNami&#x2F;Redmine&#x2F;ruby&#39; \[INFO\] Installing &#39;C:&#x2F;BitNami&#x2F;Redmine&#x2F;ruby&#x2F;lib&#x2F;ruby&#x2F;site\_ruby&#x2F;devkit.rb&#39;. </span><br></pre></td></tr></table></figure><p>と出ます。 コマンドプロンプトはそのまま開いたままで。 これで<strong>Ruby Development Kit</strong>のインストールは完了です。 次に<strong>Redmine Backlogs</strong>をインストールします。 (7) 以下のコマンドを順次実行。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..\\apps\\redmine\\htdocs\\plugins git clone https://github.com/backlogs/redmine\_backlogs.git </span><br></pre></td></tr></table></figure><p>(8) <strong>C:\BitNami\Redmine\apps\redmine\htdocs\plugins</strong>の直下に<strong>redmine_backlogs</strong>フォルダがあるので、その直下の<strong>Gemfile</strong>というファイルをテキストエディタで開きます。 (9) 40行目を下記のように変更します。 </p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- gem &quot;gherkin&quot;, &quot;=2.6.8&quot; + gem &quot;gherkin&quot; </span></span><br></pre></td></tr></table></figure><p>(10) 61行目を削除します。 </p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- gem &quot;spork&quot; - gem &quot;test-unit&quot;, &quot;=1.2.3&quot; if RUBY\_VERSION &gt;= &quot;1.9&quot; - gem &quot;timecop&quot;, &#x27;~&gt; 0.3.5&#x27; + gem &quot;spork&quot; + gem &quot;timecop&quot;, &#x27;~&gt; 0.3.5&#x27; </span></span><br></pre></td></tr></table></figure><p>(11) 以下のコマンドを実行。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem source --add http://production.s3.rubygems.org </span><br></pre></td></tr></table></figure><p>このコマンドは実行する必要はありませんが、この記事を書いた時点で、gemのインストールパッケージを保持しているミラーサイトが死んでいたので、日本のIPからはインストールできませんでしたのでその回避策です。<a href="http://toriniku.hatenablog.com/entry/2012/09/11/164446" title="鶏肉がいいよね。">toyko-m.rubygems.orgがエラー</a>を参考にさせて頂きました。ありがとうございます。 (12) 以下のコマンドを順次実行。<strong>gem</strong>を順次インストールします。<strong>bundle</strong>を使わないのはそれで失敗したからです。時間がかかるのでお茶でも飲んでてください。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install timecop -v <span class="number">0</span>.<span class="number">3</span>.<span class="number">5</span> gem install simplecov -v <span class="number">0</span>.<span class="number">6</span>.<span class="number">0</span> gem install icalendar gem install holidays -v <span class="number">1</span>.<span class="number">0</span>.<span class="number">3</span> gem install holidays gem install spork gem install open-uri-cached gem install prawn gem install inifile gem install spork gem install ZenTest -v <span class="number">4</span>.<span class="number">5</span>.<span class="number">0</span> gem install autotest-rails gem install capybara gem install cucumber-rails gem install culerity gem install database\_cleaner gem install hoe -v <span class="number">1</span>.<span class="number">5</span>.<span class="number">1</span> gem install poltergeist -v <span class="number">0</span>.<span class="number">6</span>.<span class="number">0</span> gem install rspec-rails -v <span class="number">2</span>.<span class="number">11</span>.<span class="number">0</span> gem install rcov -v <span class="number">0</span>.<span class="number">9</span>.<span class="number">11</span> gem install poltergeist -v <span class="number">0</span>.<span class="number">6</span>.<span class="number">0</span> gem install redgreen </span><br></pre></td></tr></table></figure><p><strong>holidays</strong>が2回あるのは意図的です。<strong>Redmine Backlogs</strong>の公式ページでの<a href="http://www.redminebacklogs.net/en/installation.html">インストール方法説明ページ</a>に </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">There is currently a known problem with the installer <span class="keyword">for</span> the holidays gem (<span class="number">1</span>.<span class="number">0</span>.<span class="number">4</span>)</span><br><span class="line">. You can work around the problem by first installing an older version and then upgrading:  </span><br><span class="line">gem install holidays --version <span class="number">1</span>.<span class="number">0</span>.<span class="number">3</span> gem install holidays </span><br></pre></td></tr></table></figure><p><strong>訳: holidays gem (1.0.4)のインストーラには既知の問題がある。まず古いバージョンをインストールし、それからアップデートすると上手く問題に対処できる。</strong> と記載してあるためです。 (13) gemのインストールが上手くいきました。以下のコマンドを順次実行。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle exec rake redmine:plugins:migrate RAILS\_ENV=production bundle exec rake tmp:cache:clear bundle exec rake tmp:sessions:clear </span><br></pre></td></tr></table></figure><p>この時点で、<strong>Could not find gem ～</strong>とか表示せず、<strong>Migrating redmine_backlogs (Redmine Backlogs)…**という表示から大量のログが出力されていたら成功です。</strong>Redmine Backlogs<strong>のインストールの</strong>下準備<strong>が。 (14) **下準備</strong>が終わりましたので、<strong>Redmine Backlogs</strong>をインストールします。以下のコマンドを実行。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle exec rake redmine:backlogs:install RAILS\_ENV=production </span><br></pre></td></tr></table></figure><p>すると、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\\<span class="title">BitNami</span>\\<span class="title">Redmine</span>\\<span class="title">apps</span>\\<span class="title">redmine</span>\\<span class="title">htdocs</span>\\<span class="title">plugins</span>&gt;<span class="title">bundle</span> <span class="title">exec</span> <span class="title">rake</span> <span class="title">redmine:backlogs</span> :<span class="title">install</span> <span class="title">RAILS</span>\<span class="title">_ENV</span>=<span class="title">production</span> (<span class="title">in</span> <span class="title">C</span>:/<span class="title">BitNami</span>/<span class="title">Redmine</span>/<span class="title">apps</span>/<span class="title">redmine</span>/<span class="title">htdocs</span>) <span class="title">You</span> <span class="title">are</span> <span class="title">running</span> <span class="title">backlogs</span> <span class="title">v0</span>.9.26, <span class="title">latest</span> <span class="title">version</span> <span class="title">is</span> 0.9.26  </span></span><br><span class="line"><span class="function">\===================================================== <span class="title">Redmine</span> <span class="title">Backlogs</span> <span class="title">Installer</span> ===================================================== <span class="title">Installing</span> <span class="title">to</span> <span class="title">the</span> <span class="title">production</span> <span class="title">environment</span>. <span class="title">Fetching</span> <span class="title">card</span> <span class="title">labels</span> <span class="title">from</span> <span class="title">http</span>://<span class="title">git.gnome.org</span>...<span class="title">done</span>! <span class="title">Configuring</span> <span class="title">story</span> <span class="title">and</span> <span class="title">task</span> <span class="title">trackers</span>... ----------------------------------------------------- <span class="title">Which</span> <span class="title">trackers</span> <span class="title">do</span> <span class="title">you</span> <span class="title">want</span> <span class="title">to</span> <span class="title">use</span> <span class="title">for</span> <span class="title">your</span> <span class="title">stories</span>? 1. 繝舌げ 2. 讖溯・ 3. 繧ｵ繝昴・繝 <span class="title">Separate</span> <span class="title">values</span> <span class="title">with</span> <span class="title">a</span> <span class="title">space</span> (<span class="title">e.g</span>. 1 3): </span></span><br></pre></td></tr></table></figure><p>のような表示が出ます。文字化けしています。実は、<strong>BitNami Redmine Stack 2.1.2-2</strong>でインストールすると文字化けしていません。というのも、<strong>BitNami Redmine Stack 2.1.2-2</strong>から<strong>Ruby Development Kit</strong>がデフォルトでインストールされるようになりました。その所為かもしれません。<strong>BitNami Redmine Stack 2.1.2-1</strong>は知りません。 (15) 文字化け部分は上から<strong>バグ、機能、サポート</strong>と表示されています。多分これは環境によって変わります。今回は新規インストールに等しいからかもしれません。これは後から変更できるので、とりあえず </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> </span><br></pre></td></tr></table></figure><p>と入力します。すると、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You selected the following trackers: 繝舌げ, 讖溯・, 繧ｵ繝昴・繝・ Is this corre ct? (y/n) </span><br></pre></td></tr></table></figure><p>と出るので、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y </span><br></pre></td></tr></table></figure><p>(16) 下記の質問が表示されます。 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------------------- Creating a new task tracker. Please <span class="built_in">type</span> the tracker&#x27;s name: </span><br></pre></td></tr></table></figure><p>とりあえず、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Task </span><br></pre></td></tr></table></figure><p>と入力します。すると、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You typed &#x27;Task&#x27;. Is this correct? (y/n) </span><br></pre></td></tr></table></figure><p>と出るので、 </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y </span><br></pre></td></tr></table></figure><p>とすると、しばらく処理待ちになりますのでココアでも飲んで待ちましょう。(途中でEnterキーを押す必要があったかも…) </p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Installation complete. Please restart Redmine. Thank you <span class="keyword">for</span> trying out Redmine Backlogs! </span><br></pre></td></tr></table></figure><p>と出たら終了です。 (17) 最後の指示通り、<strong>Redmine</strong>を再起動します。<strong>Manager tool</strong>から<strong>Restart All</strong>で<strong>ポチっ</strong>となって感じで再起動してください。 (18) Redmineにログインすると、<strong>スクラム統計</strong>ってのが見えるはずです。プラグインの設定から先ほどの文字化けしていたトラッカーの選択は変更できます。 以上で終了です。お疲れ様でした。 最新の<strong>BitNami Redmine Stack</strong>にインストールする、という目標は達成できました。 Redmineへのインストールはいろいろな方が挑戦していますが、<strong>普通のRedmine</strong>だったり、<strong>ALMinium</strong>だったり、<strong>BitNami Redmine Stack</strong>の<strong>2.0.X</strong>や<strong>1.4.0</strong>とかだったりして挑戦する勇気や生贄が不足していました。 ですが、これで<strong>BitNami Redmine Stack 2.1.2-0</strong>へのインストールは大丈夫でしょう。 願わくばこの記事がお役に立てることを。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Statck が起動しない...だと... (解決編)</title>
      <link href="/2012/10/13/302/"/>
      <url>/2012/10/13/302/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=295">前回</a>の問題に対する解決策の提示。</p><a id="more"></a><p>では早速 (1) <strong>BitNami Redmine Stack 2.1.2-0</strong>をパスに空白が含まれないディレクトリに新規インストール。 デフォルトは、<strong>C:\Program Files\BitNami Redmine Stack</strong>なので、<strong>C:\BitNami\Redmine</strong>に変更。 はい。終了です。 バックアップ、リストアの方法は今までの記事を参考にすると良いと思います。 手抜きな記事ですが、これで解決です。 ついでに、2.1.0-0から2.1.2-0へのアップデートも兼ねました。ﾌﾋﾋ、ｻｰｾﾝ。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Statck が起動しない...だと...</title>
      <link href="/2012/10/13/295/"/>
      <url>/2012/10/13/295/</url>
      
        <content type="html"><![CDATA[<p>ということで原因探し。</p><a id="more"></a><p>現象は</p><p><strong>1.  Redmineにアクセスしても、503 Service Temporarily Unavailable</strong><br><strong>2.  BitNami Redmine StackのManager toolでチェックすると、Thin_redmine、Thin_redmine2がStopped</strong></p><p>という状態。 <strong>1.</strong> の状態が原因なのは、<strong>2.</strong> が原因だというのはわかります。 が、<strong>2.</strong> に至る原因が不明です。 無駄とは知りつつも、とりあえずManager toolから全サービスを再起動するも、無駄無(ry 困ったときのGoogle先生、ということで質問すると、同じような人がいるでは無いですか。 <a href="http://www.jp-z.jp/changelog/2012-06-17-1.html">win7にBitNami Redmine Stackを入れたら503エラーで動作しない</a> <a href="http://d.hatena.ne.jp/kk_Ataka/20111129/1322569582">pikでインストールしたRubyでbundle exec rubyしたらエラーになった 解決編</a> にて原因と解決方法が判明した。 <a href="http://www.jp-z.jp/changelog/2012-06-17-1.html">win7にBitNami Redmine Stackを入れたら503エラーで動作しない</a>では、インストールしたImageMagickが原因のようでしたが、こっちの原因は別物。サイトに書いてあるコマンドを<strong>スタートメニュー-&gt;BitNami Redmine Stack-&gt;Use BitNami Redmine Stack</strong> で実行。コマンドは下記。</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> apps\\redmine\\htdocs bundle exec thin <span class="built_in">start</span> -e production -p <span class="number">3001</span> --prefix /redmine</span><br></pre></td></tr></table></figure><p>すると、</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ruby.exe: <span class="title">illegal</span> <span class="title">switch</span> <span class="title">in</span> <span class="title">RUBYOPT</span>: -<span class="title">F</span> (<span class="title">RuntimeError</span>)</span></span><br></pre></td></tr></table></figure><p>というメッセージ。日本語で(ry</p><p><a href="../../../../public/2012/10/cmd.png"><img src="../../../../public/2012/10/cmd-300x218.png" alt="コマンドプロンプトのメッセージ" title="コマンドプロンプトのメッセージ"></a></p><p>再びGoogle先生に泣きつくと、<a href="http://d.hatena.ne.jp/kk_Ataka/20111129/1322569582">pikでインストールしたRubyでbundle exec rubyしたらエラーになった 解決編</a>とストレートなタイトルで解決方法をGET!! 結論は。 <strong>Rubyのインストールパスにスペースを含めるな(ﾟДﾟ)ｺﾞﾙｧ</strong> <strong>Rubyのインストールパスにスペースを含(ry</strong> ….え？と思うじゃ無いですか。大事なことなので2回言いました。 でも、今までエラー出てなかったじゃん。 俺だってそう思いました。 <strong>ところがどっこい‥‥‥‥夢じゃありません‥‥‥‥！ 現実です‥‥‥！ これが現実‥！</strong> まぁ、諦めたら(ryというヤツですので、何とかします。 というわけで、次回に解決プランを実行します。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack 2.1.0-1 のログ出力設定変更方法</title>
      <link href="/2012/09/21/288/"/>
      <url>/2012/09/21/288/</url>
      
        <content type="html"><![CDATA[<p><strong>BitNami Redmine Stack 2.1.0-1</strong> のログ出力設定の変更方法がわかったのでメモ。 2.0系から設定方法が変わったのか、今まで動かなかったのですが、これで余計なログが出力されなくなりました。</p><a id="more"></a><p>では早速 (1) <strong>C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs\config\additional_environment.rb</strong> に下記の記述を追記し、エラー、警告のみがログに記録されるように修正。 [ruby] # ログの出力を制限 config.log_level = :warn [/ruby] また、ログのレベルは下記の内容が使用できるようです。 [table id=10 /] これで終了です。 従来は、<strong>C:\Program Files\BitNami Redmine Stack\apps\redmine\config\environments\production.rb</strong> に [ruby] # ログの出力を制限 config.logger = Logger.new(config.log_path) config.logger.level = Logger::WARN [/ruby] と記述しましたが、これをすると <strong>Thin_redmine</strong>、<strong>Thin_redmine2</strong> が停止してしまっていました。 ようやくログの制限ができるようになりました。 これで寝ることができます。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack のアップデート 2.0.3-1 to 2.1.0-0</title>
      <link href="/2012/09/21/280/"/>
      <url>/2012/09/21/280/</url>
      
        <content type="html"><![CDATA[<p>Windows 7 にインストールした <strong>BitNami Redmine Stack 2.0.3-1</strong> を <strong>2.1.0-0</strong> に更新することにしたので備忘録。 以前のエントリで2.0系へのアップデートを断念した、みたいに書いてましたが… スマヌ。あれは嘘でした。その後、空き時間にアップデートしてしまいました。ﾌﾋﾋ、ｻｰｾﾝwww</p><a id="more"></a><p><a href="https://taktak.jp/2012/05/12/bitnami-redmine-stack-%e3%81%ae%e3%82%a2%e3%83%83%e3%83%97%e3%83%87%e3%83%bc%e3%83%88-1-3-1-1-to-1-4-1-0/">前回のエントリ</a>にアップデートの手法が書かれているので基本は同じです。 今回の方法も、**</p><ol><li>必要なファイルをバックアップ</li><li>既存のBitNami Redmine Stackを一度アンインストール</li><li>新しいBitNami Redmine Stackをインストール</li><li>バックアップから復元</li></ol><p><strong>というのが基本的な流れ。 では早速。 (1) 万が一に備えて、インストールした **BitNami Redmine Stack</strong> をフォルダごとコピー。通常なら <strong>C:\Program Files\BitNami Redmine Stack</strong> のはず。 (2) <strong>Redmine</strong> のデータベース、プラグイン、テーマ、添付ファイルをバックアップ。パッチは<a href="https://taktak.jp/2012/05/12/bitnami-redmine-stack-%e3%81%ae%e3%82%a2%e3%83%83%e3%83%97%e3%83%87%e3%83%bc%e3%83%88-1-3-1-1-to-1-4-1-0/">前回のエントリ</a>を参考にしてください。 (3) コントロールパネルから <strong>BitNami Redmine Stack</strong> をアンインストール。以前とは違って <strong>Norton Internet Security Online</strong> が邪魔をしなくなりました…. (4) 新しい <strong>BitNami Redmine Stack</strong> をインストール。インストールは英語で行う。これも前回からの伝統。 (5) インストールが完了したので、一度ログインしておく(これは必須ではないかも…) (6) バックアップしたデータベースを復元。 (7) バックアップで退避した、プラグイン、テーマファイルを復元。既に入っているプラグインやテーマファイルを上書きしないように注意。 (8) データベースの更新を実行。<strong>スタートメニュー-&gt;BitNami Redmine Stack-&gt;Use BitNami Redmine Stack</strong> でコマンドプロンプトを起動。以下のコマンドを順次実行。 [code lang=”dos”] C:\Program Files\BitNami Redmine Stack&gt;cd apps\redmine\htdocs C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs&gt;rake db:migrate RAILS_ENV=”production” C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs&gt;rake redmine:plugins:migrate RAILS_ENV=production C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs&gt;rake tmp:cache:clear C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs&gt;rake tmp:sessions:clear [/code] (9) 一応、<strong>Manager tool</strong> から全てのサービスを停止して、起動。 (10) Redmineにログインし、一通り、確認してエラーがないことを確認。 <br><a href="../../../../public/2012/09/info.png"><img src="../../../../public/2012/09/info-289x300.png" alt="管理画面でのバージョン情報" title="管理画面でのバージョン情報"></a><br> 管理画面でバージョン情報を確認して、Redmine 2.1.0 stableの文字が表示されているのを確認。[/caption] (11) 終了 以上で終了です。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>あと、１ヶ月待っていればorz</title>
      <link href="/2012/06/05/271/"/>
      <url>/2012/06/05/271/</url>
      
        <content type="html"><![CDATA[<p>衝撃のメールが来ました…. JetBrains ReSharper is approaching its new major release later this summer. We’re delighted to announce a limited 2-in-1 offer: all new and upgrade ReSharper 6 licenses purchased on or after <strong>June 1, 2012</strong>, are entitled to a free upgrade for the upcoming ReSharper 7. <strong>／(^o^)＼ナンテコッタイ</strong></p>]]></content>
      
      
      <categories>
          
          <category> ソフトウェア紹介 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows Phone does not come..</title>
      <link href="/2012/05/31/269/"/>
      <url>/2012/05/31/269/</url>
      
        <content type="html"><![CDATA[<p>29日の「ソフトバンクモバイル新商品発表会 2012 Summer | ソフトバンクモバイル」に一縷の望みを託しましたが、周りの予想通り<strong>Windows Phone</strong>は発表されませんでした。 <strong>Nokia</strong>の<strong>Lumia900</strong>がソフトバンクから！！とか妄想していましたが、そんな幻想はぶち殺されました。そげぶ。 そういえば前のエントリで発表会2日前に<strong>「明日11:00から。」</strong>とかほざいてました。ﾌﾋﾋwwｻｰｾﾝww</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> Windows Phone </category>
          
          <category> 雑記 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack のアップデート 1.4.1-0 to 2.0.1-0 (断念編)</title>
      <link href="/2012/05/31/262/"/>
      <url>/2012/05/31/262/</url>
      
        <content type="html"><![CDATA[<p>Windows 7 にインストールした BitNami Redmine Stack 1.4.1.0 を 2.0.1-0 に更新することにしたので備忘録。 が、<a href="https://taktak.jp/wordpress/?p=162">前回</a>と違い、データベースの移行には成功したが、プラグインのインストールができなかった。 つまり今回は<strong>失敗談</strong>。</p><a id="more"></a><p>大まかな手順は前回を参照。 2.0.0への更新で、当然ながら幾つか変更点がある。</p><ol><li>Redmineのアプリケーションフォルダの構成が変更されている。そのため復元のバッチファイルが使えない。</li><li>ログの出力設定の方法が不明。従来の方法ではエラーが出る。</li><li>プラグインが全滅。プラグインが全滅。<strong>大事なことなので(ry</strong></li><li>httpdが変更されている</li></ol><p><strong>1. フォルダ構成の変更</strong> 従来の<strong>app,conf,config,db,doc,extra,files,lib,log,public,script,scripts,test,tmp,vendorフォルダ</strong>のあった階層が一つ下に移動。 <strong>旧</strong> [code] C:\Program Files\BitNami Redmine Stack\apps\redmine\app C:\Program Files\BitNami Redmine Stack\apps\redmine\conf . . . C:\Program Files\BitNami Redmine Stack\apps\redmine\vendor [/code] <strong>新</strong> [code] C:\Program Files\BitNami Redmine Stack\apps\redmine\conf C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs\app C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs\conf . . . C:\Program Files\BitNami Redmine Stack\apps\redmine\htdocs\vendor C:\Program Files\BitNami Redmine Stack\apps\redmine\scripts [/code] に変更されました。 また、<strong>pluginsフォルダ</strong>の場所も変更されています。 <strong>旧</strong> [code] C:\Program Files\BitNami Redmine Stack\apps\redmine\vendor\plugins [/code] <strong>新</strong> [code] C:\Program Files\BitNami Redmine Stack\apps\redmine\plugins [/code] バッチファイルはこれに併せて書き直すだけです。これは簡単です。 <strong>2. ログの出力設定の方法が不明</strong> <strong>3. プラグインが全滅</strong> <strong>4. httpdの変更</strong> <strong>Mongrel</strong>から<strong>Thin</strong>に変更されていた。 と、以上が失敗談。 時間が空いたら、1.4.2-0と2.0.1-0のデータベースの差分を取ってみて、一度データベースをきれいにしたいと思う。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
          <category> ソフトウェア工学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack 2.0.0-0 ｷﾀｰ(^ω^)</title>
      <link href="/2012/05/28/258/"/>
      <url>/2012/05/28/258/</url>
      
        <content type="html"><![CDATA[<p>ので、土日に更新しようかと。 今回は1.4.1-0からのアップデートレポートになるかな？ ダウンロードサイトは<a href="http://bitnami.org/stack/redmine">こちら</a>です。</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Visual Studio 高速化</title>
      <link href="/2012/05/28/253/"/>
      <url>/2012/05/28/253/</url>
      
        <content type="html"><![CDATA[<p><strong>Visual Studio</strong> を使っていると、まぁとにかくガリガリ音がするわけです。HDDの。 ビルドしたり、セーブしたり、インテリセンスが考えたり、<strong>Resharper</strong>が考えたり、等々のタイミングで。 特にビルド時のHDDガリガリは死活問題。HDDの健康度合いに響く。特にSSDならなおさら。</p><a id="more"></a><p>なので、幾つか対策をしてみた。</p><ol><li>ビルド時の出力先(<strong>bin</strong>、<strong>obj</strong> ディレクトリ)を<strong>RAMディスク</strong>に逃がす</li><li><strong>Resharper</strong>のCacheを<strong>RAMディスク</strong>に逃がす</li><li><strong>ReadyBoost</strong>や<strong>eBoostr</strong>によるキャッシュ利用でパフォーマンスの向上</li></ol><p>1.はビルド時にプロジェクトファイルと同一ディレクトリ(デフォルトの場合)にできる<strong>bin</strong>、<strong>obj</strong> ディレクトリをシンボリックリンクを使って、RAMディスクに逃がす。 欠点は、ソリューションのクリーンなどで、シンボリックリンクが切れてしまう場合があるが、これについては安いコストだと思って我慢する。 ツールを作って、ソリューション配下の全ての<strong>bin</strong>、<strong>obj</strong> ディレクトリに対してシンボリックリンクを張るツールを作ったのでそこまで苦にならない。 特に、HDDに対する書き込み頻度が確実に低下するので、目に見える速度の向上は無くても、HDDに優しいのは確実に断言できる、 2.はResharper使いなら当然かと。 Optionからキャッシュの出力先をソリューションファイルと同一ディレクトリからシステムの<strong>TEMP</strong>に変更。 既に開発環境のTEMPディレクトリはRAMディスクです。 3.はソフトの導入。 このために、<strong>eBoostr4</strong>を購入。それなりに効果は出ていると思います。 <strong>eBoostr4</strong>で優先的にキャッシュするアプリケーションにVisualStudioを追加したので、ほとんどHDDへのアクセスが無くなりました。 (eBoostr4はHDDへのアクセス状況を視覚的に確認できます。) 自己満足の範疇かもしれませんが、健全な開発ライフを過ごすためにも精神的な安心感は必要かと。 というわけで、<strong>eBoostr4</strong>おすすめです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Visual Studio </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ソフトバンクモバイル新商品発表会 2012 Summer | ソフトバンクモバイル</title>
      <link href="/2012/05/27/250/"/>
      <url>/2012/05/27/250/</url>
      
        <content type="html"><![CDATA[<p>明日11:00から。 望み薄だとわかってはいるけれど。 Windows Phone採用スマホカムヒアアアアアア!!!!</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> その他 </category>
          
          <category> Windows Phone </category>
          
          <category> 雑記 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで難読化を試してみる 第3回</title>
      <link href="/2012/05/24/139/"/>
      <url>/2012/05/24/139/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=119">前回</a>の続き。 今回は<strong>Eazfuscator.NET</strong> による難読化の前後でプログラムがどう変化したのか、を検証します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>前回は、AliceとBobが互いに挨拶する簡単なプログラムを難読化しました。 ソースコードは前回の記事を参照してください。 では、難読化前後での変化を検証してみます。 (1) 実行結果の検証 <strong>難読化前</strong><br><a href="../../../../public/2012/05/obfuscator32.png"><img src="../../../../public/2012/05/obfuscator32-300x218.png" title="obfuscator(3)"></a></p><p><strong>難読化後</strong><br><a href="../../../../public/2012/05/obfuscator62.png"><img src="../../../../public/2012/05/obfuscator62-300x218.png" title="obfuscator(6)"></a></p><p>実行は無事にできています。 (2) 逆コンパイラによるソースコード解析 <strong>難読化前</strong><br><a href="../../../../public/2012/05/obfuscator02.png"><img src="../../../../public/2012/05/obfuscator02-300x180.png" title="obfuscator(0)"></a></p><p><strong>難読化後</strong><br><a href="../../../../public/2012/05/obfuscator72.png"><img src="../../../../public/2012/05/obfuscator72-300x180.png" title="obfuscator(7)"></a></p><p><strong>!?</strong> 左側のツリーを見てください。AliceだBobだのという名前が一切ありません。 全部空白とか記号です。というか、<strong>クラスが増えています。</strong> また、右側はBog.Greetingメソッドの中身ですが、難読化前は　<strong>this.TeachNowTime()</strong>　という風に丸見えだったのが、<strong>this.()</strong> に変化しています。 Console.WriteLineメソッドの第1引数に渡した文字列も意味不明な記号に変化しています。 (3) プログラムのサイズ <strong>難読化前</strong><br><a href="../../../../public/2012/05/obfuscator03.png"><img src="../../../../public/2012/05/obfuscator03-271x300.png" title="obfuscator(0)"></a></p><p><strong>難読化後</strong><br><a href="../../../../public/2012/05/obfuscator12.png"><img src="../../../../public/2012/05/obfuscator12-271x300.png" title="obfuscator(1)"></a></p><p>かなりサイズが大きくなりました。プログラムが小さいうちは許容範囲ですが…</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>今回も駆け足でお伝えしましたが、どうだったでしょうか？ ここまで簡単だと拍子抜けですね。いや本当に。 こんなに簡単ですと、「とりあえず難読化しとく？」みたいな風潮になりませんかねぇ？ならないか。 恐ろしいのは、これが無料であることです。商用利用も可、とヘルプに書いてあります(執筆時時点で)。 <strong>Babel.NET</strong>も無料で高機能だったらしいのですが、残念ながら有料化してしまいました。 まぁ、素晴らしいソフトなので、有償化してもお金を出します。 事実、私は**.NET Reflector<strong>はVSPro版を購入していますし。 高度な技術の塊が低価格で手に入るのは良いのですが、競争が激しいですねぇ… 次は、更に踏み込んだ内容に入ろうと思います。 次回は、</strong>リフレクション<strong>と</strong>アゼンブリマージ**を使った場合の難読化について検証します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> 難読化 </category>
          
          <category> .NETで難読化を試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Facebookに参入</title>
      <link href="/2012/05/21/240/"/>
      <url>/2012/05/21/240/</url>
      
        <content type="html"><![CDATA[<p>しました。 Wordpressからの投稿もFacebookに反映されますので、どうぞよろしくです。 twitterとの連携は追々考えます。 Facebookページは<a href="http://www.facebook.com/pages/%E3%81%A8%E3%81%82%E3%82%8B%E6%8A%80%E8%A1%93%E8%80%85%E3%81%AE%E5%8A%A3%E7%AD%89%E6%84%9F/430185140333252">こちら</a>。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> 雑記 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで難読化を試してみる 第2回</title>
      <link href="/2012/05/20/119/"/>
      <url>/2012/05/20/119/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=113">前回</a>の続き。 今回は<strong>Eazfuscator.NET</strong>のインストールと実行に挑戦します。</p><a id="more"></a><h1 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h1><p><a href="http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx">Eazfuscator.NET</a> から、最新のインストーラをダウンロードしてください。 執筆時点の最新版は <strong>Version 3.3 released on March 5, 2012</strong> になります。 ダウンロードした <strong>Eazfuscator.NET 3.3 Setup.msi</strong>というインストーラをダブルクリックします。 インストールは下記の手順に従ってください。 (1) [Next] をクリック。<br><a href="../../../../public/2012/05/obfuscator0.png"><img src="../../../../public/2012/05/obfuscator0-300x234.png" title="obfuscator(0)"></a> (2) 使用許諾契約書に同意できたら [<strong>I accept the terms in the License Agreement</strong>] にチェックをつけて、[Next] をクリック。 <a href="../../../../public/2012/05/obfuscator1.png"><img src="../../../../public/2012/05/obfuscator1-300x234.png" title="obfuscator(1)"></a> (3) インストール先に問題がなければ、[Next] をクリック。問題があれば適宜変更してください。 <a href="../../../../public/2012/05/obfuscator2.png"><img src="../../../../public/2012/05/obfuscator2-300x234.png" title="obfuscator(2)"></a> (4) ここまでの設定で問題がなければ、[Install] をクリック。問題があれば、[Back] をクリックして修正するか、インストールを中止してください。 <a href="../../../../public/2012/05/obfuscator3.png"><img src="../../../../public/2012/05/obfuscator3-300x234.png" title="obfuscator(3)"></a> (5) インストール中です。 <a href="../../../../public/2012/05/obfuscator5.png"><img src="../../../../public/2012/05/obfuscator5-300x234.png" title="obfuscator(5)"></a> (6) [Finish] をクリックしてインストーラを終了します。インストーラの終了後にEazfuscator.NETを起動したいなら [Launch Eazfuscator.NET] にチェックをつけてください。 <a href="../../../../public/2012/05/obfuscator6.png"><img src="../../../../public/2012/05/obfuscator6-300x234.png" title="obfuscator(6)"></a> インストール終了です。 簡単ですね？ では、次に実行してみましょう。 (1) Windows 7 の画面で恐縮ですが、<strong>スタートメニュー</strong>-&gt;<strong>すべてのプログラム</strong>-&gt;<strong>Eazfuscator.NET</strong>と進んで、<strong>Eazfuscator.NET Assistant</strong> をクリックしてください。 <a href="../../../../public/2012/05/obfuscator7.png"><img src="../../../../public/2012/05/obfuscator7-275x300.png" title="obfuscator(7)"></a> (2) Eazfuscator.NETが起動しました。 <a href="../../../../public/2012/05/obfuscator8.png"><img src="../../../../public/2012/05/obfuscator8-300x183.png" title="obfuscator(8)"></a> (3) 難読化対象のプログラムです。Bobが面倒な人間っぽく見えますがご愛敬。 <script src="https://gist.github.com/takuya-takeuchi/5906935cacb4a1a9c175f1f877685a54.js"></script> (4) Eazfuscator.NETの右側の緑の領域に、作成したプログラムをドラッグアンドドロップします。 (5) 難読化が始まります。 <a href="../../../../public/2012/05/obfuscator41.png"><img src="../../../../public/2012/05/obfuscator41-300x245.png" title="obfuscator(4)"></a> (6) 難読化完了。[Done] をクリックしてダイアログを閉じます。 <a href="../../../../public/2012/05/obfuscator51.png"><img src="../../../../public/2012/05/obfuscator51-300x245.png" title="obfuscator(5)"></a><br> これで終了です。 え？これだけ？って位拍子抜けです。 あ、気になったと言えば、作成したプログラムと同一のディレクトリにあった<strong>pdbファイル</strong>が難読化後消えていました。なぜ？</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>駆け足でお伝えしましたが、今日はここまでです。 というか簡単すぎですね。 次回は、難読化前後で、プログラムがどう変化したかを検証したいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> 難読化 </category>
          
          <category> .NETで難読化を試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETで難読化を試してみる 第1回</title>
      <link href="/2012/05/17/113/"/>
      <url>/2012/05/17/113/</url>
      
        <content type="html"><![CDATA[<p>技術屋さんなので、プログラマーなのでそれらしいネタで情報提供しましょう、ってことで始めた<strong>「.NETで○○○を試してみる」シリーズ</strong>第2弾。 <a href="https://taktak.jp/2012/04/23/%E3%82%B3%E3%83%BC%E3%83%89-%E3%83%A1%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-%E7%AC%AC1%E5%9B%9E/">第1弾</a>はソフトウェア工学なんてお題目を掲げたものの、終始ソフトウェアの機能紹介と用語解説に甘んじてたようにも見える。 いや、ソースコードも書いていたし、一応<strong>C#**、</strong>.NET Framework<strong>っていう範疇ではありましたが。 今回は</strong>難読化**に挑戦します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>まずは、難読化が何か、というところから。 そもそも、.NET 用に作成されたプログラムは、CやC++で作成されたプログラムに比べてリバース エンジニアリングが極めて容易です。 なぜなら、ソースコードがコンパイルされて作成された実行ファイルやアセンブリは、その時点ではネイティブコードに変換されていないためです。 C#やVisual Basic .NETで記述されたソースコードは、コンパイルが実行されると、<strong>MSIL (Microsoft Intermediate Language)</strong> に変換されます。 このMSILはマシン語であるネイティブコードよりも高度(ここで言う高度とは機能的な意味ではなく、人間に理解しやすいかどうか)であり、マシン語固有の知識が不要であるため解析が容易です。 CやC++で記述され、コンパイルによって生成されたプログラムに比べてリバース エンジニアリングが極めて容易、と言う理由はここにあります。 そこで、ソースコードからMSILに変換する段階で、処理結果に影響を与えないようにロジックの理解度を低下させます。 たとえば、変数名、メソッド名、クラス名等人間の理解力を補佐する情報を空白や記号に置換したりする等の手法が挙げられます。 これが難読化です。あくまで、<strong>読みにくくする</strong>、というのが目標ですので、人間には解読不可能だ!!!、リバースエンジニアリング不可能にする!!、とかそういうのはお門違いです。 <strong>Microsoft</strong>は<a href="http://msdn.microsoft.com/ja-jp/library/ms227271%28v=vs.90%29.aspx">難読化が必要な理由</a>というページで下記のように述べています。</p><blockquote><p>NET 用に作成されたプログラムは、リバース エンジニアリングが簡単です。これは .NET のデザインに不備があるからではありません。最新の中間コンパイル言語が採用されているからです。.NET は表出的なファイル構文を使用して実行可能コード、すなわち MSIL (Microsoft Intermediate Language) を配信します。このような中間ファイルは、バイナリのマシン語コードよりも高度なもので、直接表示でき、最終的に理解可能な識別子やアルゴリズムを積み重ねたものです。判読性を高め、柔軟性と拡張性を持たせながら、同時に重要な部分を難読化することは、もちろん容易なことではありません。 .NET 逆コンパイラは誰でも無償で入手でき、これを使用してコードを簡単にリバース エンジニアリングできます。誰でもすぐに、ライセンス供与されたコード、コピー保護メカニズム、所有権を有するビジネス ロジックなどを、(合法的であるかどうかは別として) かなり判別しやすい状態にすることができます。どのような目的であれ、ソフトウェアの詳細を隅々まで調べることができるため、セキュリティ上の欠陥を探して利用したり、ユニークなアイデアを盗んだり、プログラムをクラックすることなども可能です。 これが必ずしもリスク、または重大な問題になるわけではありません。知的財産について懸念のある組織は、.NET プラットフォームを考える際、リバース エンジニアリングを防ぐためのソリューションが存在することを知っておく必要があります。難読化は、アセンブリ内のシンボルの名前をシームレスに変更する技法であり、その他にも逆コンパイラを妨害する対策を備えています。難読化を正しく適用すると、アプリケーションはそのままにして、さまざまな規模の逆コンパイルに対する保護を高めることができます。</p></blockquote><p>Microsoft自身はこのように警鐘を鳴らしてはいますが、Microsoftは難読化という<strong>ソリューションを提供してはいません。</strong> 個人的には、MSILに対して一番理解がある(当たり前ですが)Microsoftが難読化の機能をVisualStudioなりに備えておくのが一番だと思いますが、そうなっていないなら仕方ありません。 そういうわけですので、難読化を行うための手段は3通りです。</p><ol><li>コーディング中に変数名、クラス名、メソッド名を記号や空白に置き換える。</li><li>特許が含まれるようなロジックはアンマネージドなアセンブリに退避させ <strong>P/Invoke呼び出し</strong> で利用する。</li><li>難読化ツールを利用する。</li></ol><p><strong>1.</strong> まぁ、どう考えてもないでしょう。コーディングやコードレビューの効率が著しく低下しますが、そこに膨大な工数を費やせる予算潤沢なプロジェクトならありでしょう。まぁ保守する人間が絶叫すること間違いないでしょうが.. <strong>2.</strong> これは現実路線でしょう。というか特許云々は置いておいて、処理速度の関係からこうするソフトウェアもありますので、お馴染みの手法と言えばそうだと言えますが、既存の特許ロジックが.NETで作られている場合に、C++やCにポーティングする工数を考えるとこれは次善策でしょう。 <strong>3.</strong> 今回の本命です。というかここに来るまでが長い。変数名等の難読化やリテラル文字列の暗号化など様々な機能を提供してくれます。が、ツールのコストは無料のものから数十万円と開きがあります。予算や顧客からの要求に応じて検討しましょう。</p><h1 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h1><p>現在、難読化機能を提供しているツールは調べた限り以下になります。 *<em>無償**</em>   <a href="http://uwa.potetihouse.com/soft/nandoku.html">NanDoKu</a> -&gt; 日本製</p><ul><li><a href="http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx">Eazfuscator.NET</a></li><li><a href="http://ntcore.com/phoenix.php">Phoenix Protector</a></li><li><a href="http://code.google.com/p/obfuscar/">obfuscar</a></li><li><a href="http://sharpobfuscator.codeplex.com/">SharpObfuscator</a>*<em>有償**</em>   <a href="http://leapspec.com/exob/">Express Obfuscator</a> -&gt; 日本製</li><li><a href="http://babelfor.net/">Babel.NET</a> -&gt; I/Fが秀逸</li><li><a href="http://codefort.org/">CodeFort</a> -&gt; I/Fが秀逸</li><li><a href="http://www.preemptive.com/">Dotfuscator</a> -&gt; 無償版ありの業界標準？</li><li><a href="http://www.red-gate.com/products/dotnet-development/smartassembly/">SmartAssembly</a> -&gt; .NET Reflectorの開発元</li><li><a href="http://www.9rays.net/Category/55-spicesnet-obfuscator.aspx">Spices .Net Obfuscator</a></li><li><a href="http://www.deepseaobfuscator.com/">DeepSea Obfuscator</a></li><li><a href="http://www.secureteam.net/Obfuscator.aspx">CliSecure .NET obfuscator</a></li><li><a href="http://www.eziriz.com/dotnet_reactor.htm">.NET Reactor</a></li><li><a href="http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm">Crypto Obfuscator For .Net</a></li><li><a href="http://www.remotesoft.com/salamander/protector.html">Salamander .NET protector</a></li><li><a href="http://www.rustemsoft.com/obfuscator_net.asp">Skater .NET Obfuscator</a></li><li><a href="http://www.cantelmosoftware.com/eng/obfuscator.html">Goliath .NET Obfuscator</a></li><li><a href="http://www.wiseowl.com/products/Products.aspx">Demeanor for.NET</a></li><li><a href="http://www.lesser-software.com/en/content/products/LSW%20DotNet-Tools/LSW_DotNet_IL-Obfuscator.htm">LSW IL-Obfuscator</a>この中から、Webサイトの印象や評判やI/Fなどから選ぶと</li></ul><ol><li><a href="http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx">Eazfuscator.NET</a></li><li><a href="http://leapspec.com/exob/">Express Obfuscator</a></li><li><a href="http://uwa.potetihouse.com/soft/nandoku.html">NanDoKu</a></li><li><a href="http://babelfor.net/">Babel.NET</a></li><li><a href="http://codefort.org/">CodeFort</a></li><li><a href="http://www.9rays.net/Category/55-spicesnet-obfuscator.aspx">Spices .Net Obfuscator</a></li><li><a href="http://www.red-gate.com/products/dotnet-development/smartassembly/">SmartAssembly</a></li><li><a href="http://www.preemptive.com/">Dotfuscator</a></li></ol><p>というのが個人的な順位付けになります。予算があるなら、Dotfuscatorとか選ぶんでしょうけど…</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>というわけで、次回は<strong>個人的ランキング1位</strong>に輝いた <strong>Eazfuscator.NET</strong> を使って難読化を行っていきたいと思います。 Web上でも利用しているというか使い方を説明している方が、<a href="http://uroboros-xna.blogspot.jp/2011/10/xna.html">UROBOROS XNA様</a>くらいしかいなかったので、私が人柱有意義な情報提供を行える人物になろうと思います。 あ、他のソフトについては未定です。<strong>SmartAssembly</strong>の使用レポをしろ!等という意見は受け付けません(お財布の暖かさ的な理由で)</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> 難読化 </category>
          
          <category> .NETで難読化を試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ReSharper 6.0 C# Edition Personal License 購入したよ(^q^)</title>
      <link href="/2012/05/13/206/"/>
      <url>/2012/05/13/206/</url>
      
        <content type="html"><![CDATA[<p>149ドルだからだいたい12,000円。 体験版使っていて、それが期限切れ。 で、インストール前の状態に戻って。 何か、物足りない。って感じになってついポチッとやってしまった。 反省している。でも後悔してない。 使い倒すぜ。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> ソフトウェア紹介 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 最終回</title>
      <link href="/2012/05/12/194/"/>
      <url>/2012/05/12/194/</url>
      
        <content type="html"><![CDATA[<p>いよいよ? 長かった「.NETで○○○を試してみる」シリーズ第1弾「.NETでコード メトリックスを試してみる」も最終回。 感動の、涙なしには語れない(あまりの内容の薄さに哀れ過ぎて的な意味で)です。 <a href="taktak.jp/2012/05/12/net%E3%81%A7%E3%82%B3%E3%83%BC%E3%83%89-%E3%83%A1%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-%E7%AC%AC7%E5%9B%9E/">前回</a>は、<strong>クラス結合度</strong> について説明をしました。 今回も、個々のメトリックス値がどのように変化していくのか、をテーマに <strong>コード行</strong> について説明します。 さぁキビキビいきませう。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>最後のおさらいですが、コード行はMSDNの<a href="http://msdn.microsoft.com/ja-jp/library/bb385914.aspx">コード メトリックス値</a>というページでの説明によると、</p><blockquote><p><strong>コード行</strong> - コード内の行の概数を示します。 この数は IL コードに基づいているため、ソース コード ファイル内の正確な行数ではありません。 数が非常に大きい場合、型またはメソッドでの処理が多すぎるため、分割が必要であることを示すことがあります。 また、型やメソッドの保守が困難なことを示す場合もあります。</p></blockquote><p>と定義されています。 今までで一番難しそうです(ネタの膨らませ方な意味で) 今回も簡単にソースコードを実査に観察して、<strong>コード行</strong>が変化する様子をソースコードを用いて観察してみましょう。</p><h1 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h1><p>今回のサンプルソースは下記です。 最後くらい真面目にやります。ええ。 <script src="https://gist.github.com/takuya-takeuchi/28668c064b9903d08196555d31cd649b.js"></script> for,foreach,LINQ毎に、ShortとLongを用意しました。ShortとLongの際は、{,}で改行、空行を含むか否かです。 これを <strong>Metrics.exe</strong> で計測してみましょう。 下記はメトリックスの結果です。 [table id=8 /] 結果を見ると、配列の宣言は <strong>1 行</strong> として計算されています。 for文もforeach文も改行すれば、適切に行数をカウントしているようです。 {,},空行はカウントされていません。 おもしろいのは、<strong>LINQ</strong> です。<strong>System.Array.ForEach</strong> です。改行しようがしまいが <strong>2行</strong> としてカウントされています。 ここまで来て「おかしいのでは？」と思った方。正しいです。 そう。一部誤差はあれど、あまりにもソースコードに忠実なカウントになっています。 思い出してください。コード行の定義を。<strong>この数は IL コードに基づいているため、ソース コード ファイル内の正確な行数ではありません。</strong> というのを。</p><h1 id="The-truth"><a href="#The-truth" class="headerlink" title="The truth"></a>The truth</h1><p>単純というか、説明不足というか。いや私のせいなんですが。 実はコード メトリックスの結果はある種の補正がかかっています。 何のことはありません。<strong>Metrics.exe</strong> は解析の時に、解析対象のアセンブリと同一ディレクトリに存在している <strong>pdb (プログラムデータベースファイル)</strong> を参照していたのです。 というわけで、その補正を外して真?の結果を見せましょう。 先の解析を行った <strong>CodeMetricsTest.exe</strong> と同一のディレクトリに存在している <strong>CodeMetricsTest.pdb</strong> を削除して、再度解析します。</p><p><a href="../../../../public/2012/05/CodeMetrics.png"><img src="../../../../public/2012/05/CodeMetrics-300x218.png" title="CodeMetrics"></a></p><p><code>warning : CA0068 : Debug information could not be found for target assembly &#39;Cod eMetricsTest.exe&#39;. For best analysis results, include the .pdb file with debug i nformation for &#39;CodeMetricsTest.exe&#39; in the same directory as the target assembl y. Writing report to CodeMetricsTest.xml... Done.</code> 警告が出ています。 <strong>「解析対象のアセンブリ CodeMetricsTest.exe のデバッグ情報がないよ。最適な解析結果を出すためには、対象のアセンブリと同じディレクトリに CodeMetricsTest.exe のデバッグ情報を含む .pdb ファイルを含めててくれよ。」(意訳)</strong> でもそんなの関係ねぇ。 その結果が下記です。 [table id=9 /] クラス結合度やサイクロマティック複雑度は変化していませんが、コード行が増加したため、保守容易性指数が低下しています。 正確な情報を必要とする場合は、PDBファイルは必須と言わざるを得ません。 また、デバッグ情報がないため、ShortとLongの結果が完全に一致しています。これこそ、<strong>「この数は IL コードに基づいているため、ソース コード ファイル内の正確な行数ではありません。」</strong>の証明に他なりません。 さらには、LinqShort、LinqLongのコード行が他より良くなっています。 が、これはまやかしです。 </p><p><a href="../../../../public/2012/05/CodeMetrics2.png"><img src="../../../../public/2012/05/CodeMetrics2-300x184.png" title="CodeMetrics2"></a></p><p> 上記の画像の左側に、**<LinqLong>b__2、<LinqShort>b__0** というメソッドがコンパイラによって追加されています。 右側は <strong><LinqLong>b__2</strong> の中身です。 単純に関数化してLinqShort、LinqLongのコード行が減ったように見えているだけです。 ただ、ILを見ても、コード行数の算出方法がわかりません。 どうやっているのでしょうか？これ。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まとめると、<strong>コード行</strong> は、</p><ul><li>{,}や空行はカウントの対象外。</li><li>実行可能行のみカウントされるから、同じ内容でも、改行しないソースコードはコード行が低く見えてしまう。</li><li>正確なコード行を計算するなら pdb (プログラムデータベースファイル) は必須。でないと、コード行が大幅に増加してしまう可能性がある。でも、pdb があっても正確な数値は出ない。</li></ul><p>コード行を低下させるには、似たコードの関数化やロジックの見直しという地道な作業しか無いでしょう。 確かに改行を無くせばコード行は減りますが、それは本質では無いでしょう。 誤魔化した結果を用いたソフトウェア工学に何の意味があるのでしょう？そんなのは粉飾決算と同じです。 例の如く、最後まで、反省も無く、長くなってしまいましたが、コード行がどういうものかわかりました。 全部で8回に渡った <strong>「.NETでコード メトリックスを試してみる」</strong> でした。 難しい数式よりも実際のソースコードから結果の変化を見てもらうように努めましたがどうだったでしょうか？ もう少し突っ込んだ内容のが良かったかなぁ、と個人的に思いましたが、そこまでスキルがあるわけでは無いので涙を飲むことになりましたが… 次回は、別の題材で<strong>「.NETで○○○を試してみる」</strong>を行います。 ふふふ。実はネタはもうできているのです。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 第7回</title>
      <link href="/2012/05/12/160/"/>
      <url>/2012/05/12/160/</url>
      
        <content type="html"><![CDATA[<p>そろそろ、冒頭の挨拶がコピペっぽくなってきましたが、皆さんいかがお過ごしでしょうか？ <a href="taktak.jp/2012/05/12/net%E3%81%A7%E3%82%B3%E3%83%BC%E3%83%89-%E3%83%A1%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-%E7%AC%AC6%E5%9B%9E/">前回</a>は、<strong>継承の深さ</strong> について説明をしました。 残すところ、このシリーズも今回を含め2回。 今回も、個々のメトリックス値がどのように変化していくのか、をテーマに <strong>クラス結合度</strong> について説明します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>おさらいですが、クラス結合度はMSDNの<a href="http://msdn.microsoft.com/ja-jp/library/bb385914.aspx">コード メトリックス値</a>というページでの説明によると、</p><blockquote><p><strong>クラス結合度</strong> - パラメーター、ローカル変数、戻り値の型、メソッド呼び出し、ジェネリックまたはテンプレートのインスタンス化、基本クラス、インターフェイス実装、外部の型で定義されたフィールド、および属性による装飾を使用して、一意のクラスへの結合度を測定します。 適切なソフトウェア デザインでは、型およびメソッドの連携は高まり、結合性は低くなります。 結合性が高いということは、他の型への依存関係が多いために再利用や保守が困難なデザインであることを示します。</p></blockquote><p>と定義されています。 ちょっと今回は難しそうです(サンプルコードの準備的な意味で) 今回も簡単にソースコードを実査に観察して、<strong>クラス結合度</strong>が変化する様子をソースコードを用いて観察してみましょう。</p><h1 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h1><p>今回のサンプルソースは下記です。 <strong>今回も</strong>管理人の趣味が多分に発揮されていますが無視してください。 <script src="https://gist.github.com/takuya-takeuchi/2059d8453fd495a927d2d067be714a69.js"></script> これを <strong>Metrics.exe</strong> で計測してみましょう。 下記はメトリックスの結果のうち、<strong>Family クラス</strong>、<strong>FireVampire クラス</strong>に着目した表です。 [table id=6 /] <strong>Family クラス</strong> は、メンバに何もありません。 しかし、継承の深さが 1 なのは前回説明したとおりですが、クラス結合度は <strong>0</strong> です。 これは何を意味しているのでしょうか？ この結果についての解が<a href="http://msdn.microsoft.com/ja-jp/library/bb385914%28v=vs.90%29.aspx">こちら</a>に記述されています。</p><blockquote><p><strong>クラス結合度</strong> - パラメータ、ローカル変数、戻り値、メソッド呼び出し、ジェネリックまたはテンプレートのインスタンス化、基本クラス、インターフェイス実装、外部の型で定義されたフィールド、および属性による装飾を使用して、一意のクラスへの結合度を測定します。<strong>計算では、int32、string、object など、プリミティブ型や組み込み型は除外します。</strong>適切なソフトウェア デザインでは、型およびメソッドの連携は高まり、結合性は低くなります。結合性が高いということは、他の型への依存関係が多いために再利用や保守が困難なデザインであることを示します。</p></blockquote><p>つまり、全てのクラスの継承元である <strong>Object クラス</strong> は結合度の計算から除外するわけですね。 他にも、プリミティブ型や組み込み型が除外されるとありますが、これらは<a href="http://msdn.microsoft.com/ja-jp/library/ms228360%28v=vs.80%29.aspx">こちらのページ</a>の<strong>組み込みのデータ型</strong>の章で確認できます。 <strong>FireVampire クラス</strong> も、メンバに何もありませんが、クラス結合度が <strong>1</strong> なのは、<strong>Family クラス</strong> を継承しているから <strong>+1</strong> なのでしょう。 次は、<strong>Cthugha クラス</strong>、<strong>Nyarlathotep クラス</strong>に着目した表です。 [table id=7 /] <strong>Nyarlathotep クラス</strong> は前述の <strong>FireVampire クラス</strong> と同じです。 プロパティの String クラス、継承元の Object クラスは計算から除外されており、計算対象は継承元の <strong>GreatOldOne クラス</strong> のみが計算対象です。 問題は、<strong>Cthugha クラス</strong> です。 メンバに <strong>FireVampire クラス</strong> の配列を保持しています。 ここで1つ疑問が浮かびます。 クラス結合度の計算対象には、Object クラスを除外した継承元のクラスは計算対象になるのは前述の通りです。 では、この継承元のクラス、というのは、<strong>パラメータ、ローカル変数、戻り値、メソッド呼び出し、ジェネリックまたはテンプレートのインスタンス化、インターフェイス実装、外部の型で定義されたフィールド、および属性による装飾</strong> にも適用されるのでしょうか？ 結論から言えば答えは <strong>No</strong> です。 なぜなら、<strong>Cthugha クラス</strong> のクラス結合度は、継承元の <strong>GreatOldOne クラス</strong>、メンバに存在する配列の宣言型である <strong>FireVampire クラス</strong> の <strong>1 + 1 = 2</strong> というのがその答えです。 つまり、その継承元である <strong>Family クラス</strong> は計算に入っていないことになります。 その証拠に次の2つのソースではクラス結合度が異なります。 <script src="https://gist.github.com/takuya-takeuchi/60c56931a518feb283dcfd658b6e9cbc.js"></script> <script src="https://gist.github.com/takuya-takeuchi/ceacebc7c123658b5750020b2a2ceec4.js"></script> 表は省略しますが、<strong>Cthugha クラス</strong> のクラス結合度は<strong>前者が 1、後者は 2</strong> となります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まとめると、<strong>クラス結合度</strong> は、</p><ul><li>プリミティブ型や組み込み型である <strong>Byte,SByte,Int32,UInt32,Int16,UInt16,Int64,UInt64,Single,Double,Char,Boolean,Object,String,Decimal</strong> はクラス結合度の計算から除外される。</li><li>クラスの継承がクラス結合度の計算に影響するのは、クラスの定義の際のみ。ローカル変数やメンバ等で使用した型の継承元まではクラス結合度にカウントされない。</li><li>クラスの継承で、カウントされるのは直接の親となるクラスのみ。</li></ul><p>クラス結合度を低下させるには、ポリモーフィズムを活用して、直接依存するクラスを減らす方法が挙げられます。 また、凝集度を高めることは結合度の低下にも繋がりやすいです。 今回も長くなりましたが、クラス結合度がどういうものかわかりました。 次回は <strong>コード行</strong> について、ソースコードを交えながら説明します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BitNami Redmine Stack のアップデート 1.3.1-1 to 1.4.1.0</title>
      <link href="/2012/05/12/162/"/>
      <url>/2012/05/12/162/</url>
      
        <content type="html"><![CDATA[<p>最近、仕事が忙しくて、更新もろくにできない状態でしたが、ようやく時間がとれたので予てからの課題を解決することに。 Windows 7 にインストールした <strong>BitNami Redmine Stack 1.3.1-1</strong> を <strong>1.4.1.0</strong> に更新することにしたので備忘録。</p><a id="more"></a><p>BitNami Redmine Stackの公式サイトの<a href="http://wiki.bitnami.org/Applications/BitNami_Redmine#How_to_upgrade_Redmine.3f">こちら</a>にアップデートの手法が書かれているが、これは無視。 というのも、この手法で行っても更新がうまくできなかったので… 今回の方法としては、**</p><ol><li>必要なファイルをバックアップ</li><li>既存のBitNami Redmine Stackを一度アンインストール</li><li>新しいBitNami Redmine Stackをインストール</li><li>バックアップから復元</li></ol><p><strong>というのが大まかな流れ。 では早速。 (1) 万が一に備えて、インストールした **BitNami Redmine Stack</strong> をフォルダごとコピー。通常なら <strong>C:\Program Files\BitNami Redmine Stack</strong> のはず。 (2) <strong>Redmine</strong> のデータベース、プラグイン、テーマ、添付ファイルをバックアップ。下記はサンプルのバッチ。 [code lang=”dos”] @echo off<br>echo ********************************************************* echo. echo BitNami Redmine Stack のデータベースをバックアップします。 echo MySqlが停止状態ではないか確認してください。 echo. echo *********************************************************<br>@set BITNAMI=C:\Program Files\BitNami Redmine Stack @set BACKUPDIR=E:\Backup\Redmine @set DATETIME=%DATE:/=% @set ATTACHMENTS=%BACKUPDIR%\%DATETIME%\files @set PLUGINS=%BACKUPDIR%\%DATETIME%\plugins @set THEMES=%BACKUPDIR%\%DATETIME%\themes<br>@mkdir “%ATTACHMENTS%” @mkdir “%PLUGINS%” @mkdir “%THEMES%”<br>@”%BITNAMI%\mysql\bin\mysqldump.exe” –default-character-set=utf8 -u hoge –password=hogehoge –port=???? –database bitnami_redmine &gt; “%BACKUPDIR%\%DATETIME%\dump_utf8.sql” @xcopy “%BITNAMI%\apps\redmine\files” “%ATTACHMENTS%” /y /s /q @xcopy “%BITNAMI%\apps\redmine\vendor\plugins” “%PLUGINS%” /y /s /q @xcopy “%BITNAMI%\apps\redmine\public\themes” “%THEMES%” /y /s /q @xcopy “Redmine Restore.bat” “%BACKUPDIR%\%DATETIME%” /y /s /q<br>echo. echo 完了しました。 pause &gt; nul [/code] (3) コントロールパネルから <strong>BitNami Redmine Stack</strong> をアンインストール。何故か、<strong>Norton Internet Security Online</strong> がアンインストールの邪魔をするので、一時的に <strong>Auto Protect</strong> を無効にして沈黙させてから実行。 (4) 新しい <strong>BitNami Redmine Stack</strong> をインストール。インストールは英語で行う。というのも、日本語でインストールを行うと、下記のように一部記述が欠けており、一抹の不安を覚えてしまうので、念のため。 </p><p><a href="../../../../public/2012/05/redmine_install0.png"><img src="../../../../public/2012/05/redmine_install0-300x250.png" title="redmine_install(0)"></a> <a href="../../../../public/2012/05/redmine_install1.png"><img src="../../../../public/2012/05/redmine_install1-300x250.png" title="redmine_install(1)"></a></p><p>(5) インストールが完了したので、一度ログインしておく(これは必須ではないかも…) (6)<br> バックアップしたデータベースを復元。下記はサンプルのバッチだが、バックアップ時とはユーザ名、パスワードが異なるので、適宜確認。 [code lang=”dos”] @echo off<br>echo ********************************************************* echo. echo BitNami Redmine Stack のデータベースをリストアします。 echo MySqlが停止状態ではないか確認してください。 echo. echo *********************************************************<br>@set BITNAMI=C:\Program Files\BitNami Redmine Stack @set ATTACHMENTS=files<br>@”%BITNAMI%\mysql\bin\mysql” -u hoge –password=hoge –database bitnami_redmine &lt; dump_utf8.sql @xcopy “%ATTACHMENTS%” “%BITNAMI%\apps\redmine\files” /y /s /q<br>echo. echo 完了しました。 pause &gt; nul [/code] (6) 不足しているフィールドがデータベースにあるので、下記のsqlを発行。前項のユーザ名とパスワードでmysqlへログインできるはず。 [code lang=”sql”] alter table custom_fields add multiple tinyint(1) default ‘0’; alter table repositories add identifier varchar(255) default null; alter table repositories add is_default tinyint(1) default ‘0’; [/code] 恐らく、<strong>multple</strong> は、<strong>Redmine 1.4</strong>より対応になったリポジトリの複数管理に関するものだと思われる…他は知らない。 (7) 一度、<strong>Manager tool</strong> から全てのサービスを停止。 (8) <strong>C:\Program Files\BitNami Redmine Stack\apps\redmine\config\environments\production.rb</strong> に下記の記述を追記し、エラー、警告のみがログに記録されるように修正。 [code lang=”ruby”] # ログの出力を制限 config.logger = Logger.new(config.log_path) config.logger.level = Logger::WARN [/code] (9) <strong>C:\Program Files\BitNami Redmine Stack\apps\redmine\log</strong> 配下のファイルを削除。 (10) <strong>Manager tool</strong> から全てのサービスを開始。 (11) Redmineにログインし、一通り、確認してエラーがないことを確認。 (12) バックアップで退避した、プラグイン、テーマファイルを復元。既に入っているプラグインやテーマファイルを上書きしないように注意。 (13) 必要に応じてデータベースの再構築やサービスの再起動を実施。プラグインのインストール時に、 [code lang=”dos”] Please install RDoc 2.4.2+ to generate documentation. [/code] なるメッセージがコマンドプロンプトに表示されるが無視。どうも警告らしいが… (14) プラグインの動作を確認。 (15) 終了 以上で終了です。 <strong>BitNami Redmine Stack</strong> は環境の構築は非常に簡単なのですが、更新が面倒極まりありません。 そもそも、公式サイトで紹介されているアップデートの手段も人力。 アップデートのためのソフトウェアを提供していただきたいものです。 私のように、<strong>BitNami Redmine Stack</strong> をインストールしたけど、アップデートできないよー(&gt;&lt;)、と困っている方がいると思いますので、こうして記事にしましたが如何でしたでしょうか？</p>]]></content>
      
      
      <categories>
          
          <category> プロジェクト管理 </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> Redmine </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 第6回</title>
      <link href="/2012/05/02/152/"/>
      <url>/2012/05/02/152/</url>
      
        <content type="html"><![CDATA[<p><a href="taktak.jp/2012/05/12/net%E3%81%A7%E3%82%B3%E3%83%BC%E3%83%89-%E3%83%A1%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-%E7%AC%AC5%E5%9B%9E/">前回</a>は、<strong>サイクロマティック複雑度</strong> について説明をしました。 今回も、個々のメトリックス値がどのように変化していくのか、をテーマに <strong>継承の深さ</strong> について説明します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>おさらいですが、継承の深さはMSDNの<a href="http://msdn.microsoft.com/ja-jp/library/bb385914.aspx">コード メトリックス値</a>というページでの説明によると、</p><blockquote><p><strong>継承の深さ</strong> - クラス階層構造のルートまでのクラス定義の数を示します。 階層構造が深くなるにつれて、特定のメソッドおよびフィールドが定義または再定義されている場所を把握することがより困難になる場合があります。</p></blockquote><p>と定義されています。 では、ありきたりな展開ではありますが…. 今回も簡単にソースコードを実査に観察して、<strong>継承の深さ</strong>が変化する様子をソースコードを用いて観察してみましょう。</p><h1 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h1><p>今回のサンプルソースは下記です。 管理人の趣味が多分に発揮されていますが無視してください。 <script src="https://gist.github.com/takuya-takeuchi/321f03877da79f04919f79d58ebeade0.js"></script> 今回はいつにも増して残念極まりないソースですが、これを <strong>Metrics.exe</strong> で計測してみましょう。 下記はメトリックスの結果のうち、クラスに着目した表です。 [table id=4 /] 次は、メトリックスの結果のうち、インターフェイスに着目した表です。 [table id=5 /] そして、最後は、上記サンプルのクラスダイアグラム図になります。 図中の <strong>DI</strong> は　<strong>Depth of Inheritance (DI)</strong> の略です。<br><a href="../../../../public/2012/05/ClassDiagram.png"><img src="../../../../public/2012/05/ClassDiagram-300x180.png" title="ClassDiagram"></a><br> 前述の定義通りメトリックスの結果から、継承の深さは、クラス階層構造のルートである <strong>Object クラス</strong> までのクラスの数であることを証明してくれました。 ちなみに、Metrics.exeで <strong>mscorlib.dll</strong> を計測し、<strong>Object クラス</strong> のメトリックスを確認すると、継承の深さは <strong>0</strong> でした。 また、もうお気づきでしょうが、継承の深さの計算に、<strong>インターフェイスは含まれていません。</strong> インターフェイスはクラスに<strong>実装</strong>するものですし。継承とは言わないのでしょう。 でも、インターフェイスAを継承したインターフェイスBという実装もあるのですが、これも継承の深さにカウントされません。 前述の<strong>「クラス階層構造のルートまでのクラス定義の数」</strong>という定義をそのまま素直に受け止めればクラスではないインターフェイスは無関係なのでしょう。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まとめると、<strong>継承の深さ</strong>は、</p><ul><li>継承を一切していないクラスを定義しても、<strong>1</strong> としてカウントされる。</li><li>インターフェイスを実装しても<strong>継承の深さに影響しない。</strong></li><li>インターフェイス自身が、別のインターフェイスを継承していたとしても継承の深さは常に <strong>0</strong> である。</li></ul><p>継承の深さを低下させるには、全体的な設計の見直しが挙げられます(というかこれ以外あります？) ただ、継承の深さにそこまで過敏になる必要はないのでは？と個人的には思います。 例えば、<strong>System.Windows.Control クラス</strong> を継承してカスタムコントロールを作成した時点で、継承の深さは 4 になってしまいます。 ともすれば、既存のクラスを再利用しようとすると、継承の深さは避けては通れない問題ではないのかなぁ、と思ってしまいます。 今回も長くなりましたが、継承の深さがどういうものかわかりました。 次回は <strong>クラス結合度</strong> について、ソースコードを交えながら説明します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 第5回</title>
      <link href="/2012/04/30/93/"/>
      <url>/2012/04/30/93/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/2012/04/29/net%e3%81%a7%e3%82%b3%e3%83%bc%e3%83%89-%e3%83%a1%e3%83%88%e3%83%aa%e3%83%83%e3%82%af%e3%82%b9%e3%82%92%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b-%e7%ac%ac4%e5%9b%9e/">前回</a>は、<strong>保守容易性指数</strong> について説明をしました。 今回も、個々のメトリックス値がどのように変化していくのか、をテーマに <strong>サイクロマティック複雑度</strong> について説明します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>おさらいですが、サイクロマティック複雑度はMSDNの<a href="http://msdn.microsoft.com/ja-jp/library/bb385914.aspx">コード メトリックス値</a>というページでの説明によると、</p><blockquote><p><strong>サイクロマティック複雑度</strong> - コードの構造上の複雑さを測定します。 これは、プログラムのフローにある、異なるコード パスの数を計算することで作成されます。 複雑な制御フローが含まれるプログラムでは、十分なコード カバレッジを実現するためにより多くのテストが必要となり、保守性が低下します。</p></blockquote><p>と定義されています。 制御フローとは、<strong>if</strong>、<strong>switch</strong>、<strong>do</strong>、<strong>while</strong>、<strong>foreach</strong>、<strong>for</strong> の6つのステートメントを指します。 サイクロマティック複雑度は数値が<strong>低い</strong>程良好であることを示します。 また、サイクロマティック複雑度の増加は、保守容易性指数が低下と、テストケースの増加による作業工数の増加を招きますね。 では、サイクロマティック複雑度はどういう風に算出されているのでしょうか？ 今回も簡単ではありますが、<strong>サイクロマティック複雑度</strong>が変化する様子をソースコードを用いて観察してみましょう。</p><h1 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h1><p>今回はステートメント毎に6つのメソッドに分離しました。 <script src="https://gist.github.com/takuya-takeuchi/712fe00bdcfe758ad002e90ee4c0b08b.js"></script> <strong>(2012.05.01 23:49 上記ソースが一部文字化けしていたのを修正しました。)</strong> 今回もサンプルとしては良いかもしれませんが…的なソースですが、これを <strong>Metrics.exe</strong> で計測してみましょう。 その結果が下記になります。 [table id=3 /] 分岐ステートメントがあると <strong>サイクロマティック複雑度</strong> が1増加するのではなく、そこに含まれる条件式の個数分だけ増加するようです。 たとえば、Case6メソッドの2つめのfor文には2つの条件式があるので、最初のfor文と併せて、1+1+2=4とサイクロマティック複雑度が計算されています。 では、条件式が含まれれば、サイクロマティック複雑度が増加するかというとそうではないようです。 <script src="https://gist.github.com/takuya-takeuchi/9366e53276ef7ffd12c0f75e30bee56f.js"></script> 上記のソースコード中のCase1メソッドは、foreach以外の全ての分岐ステートメントを含んでいますが <strong>Metrics.exe</strong> で計測してみても、<strong>サイクロマティック複雑度は1のまま</strong>です。 つまり、「分岐が発生する」とサイクロマティック複雑度が1増加するため、分岐が発生し得ない、つまり必ず通る、通らないような条件式はカウントされません。 (foreach文は、要素列挙の終了条件がコレクション内部に隠蔽されているため、foraech文があるだけで+1されてしまうようです)</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まとめると、<strong>サイクロマティック複雑度</strong>は、</p><ul><li>最も良好な値(分岐がない場合)は <strong>1</strong> であり、サイクロマティック複雑度の数値に上限はない。</li><li>分岐ステートメントに含まれる条件式が1つ増える毎に <strong>+1</strong> される。逆に分岐ステートメントがあっても、<strong>条件式が存在しない、または常に条件が同じであるような場合</strong>は +1 されない。</li><li><strong>foreach文は存在するだけで常に +1 される</strong>。なぜならforeach文の内部に入るかどうかは、列挙されるコレクションの実装に依存するため、それ自体が条件式になってしまうから。</li></ul><p>サイクロマティック複雑度を低下させるには、条件式を見直したり、条件式をメソッドとして抽出して、1つのメソッドに分岐を偏らせないようにする、等の方法が考えられます。 今回も長くなりましたが、サイクロマティック複雑度がどういうものかわかりました。 というわけで次回は <strong>継承の深さ</strong> について、ソースコードを交えながら説明します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>iKnow! 進捗報告 [4/22-4/29]</title>
      <link href="/2012/04/30/91/"/>
      <url>/2012/04/30/91/</url>
      
        <content type="html"><![CDATA[<p>今週は、 目標 : 05時間00分 実績 : 01時間42分 合計 : 07時間02分</p><h1 id="反省点"><a href="#反省点" class="headerlink" title="反省点"></a>反省点</h1><p>全然できなかったorz GW中に挽回しないと。モチベーションの維持も難しい…</p>]]></content>
      
      
      <categories>
          
          <category> iKnow! </category>
          
          <category> 英語 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 第4回</title>
      <link href="/2012/04/29/79/"/>
      <url>/2012/04/29/79/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/2012/04/28/net%E3%81%A7%E3%82%B3%E3%83%BC%E3%83%89-%E3%83%A1%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-%E7%AC%AC3%E5%9B%9E/">前回</a>は、<strong>Visual Studio Code Metrics PowerTool 10.0</strong> が提供する5つのコードメトリックス値について説明をしました。 今回は、個々のメトリックス値がどのように変化していくのか、をテーマに <strong>保守容易性指数</strong> について説明します。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>おさらいですが、保守容易性指数はMSDNの<a href="http://msdn.microsoft.com/ja-jp/library/bb385914.aspx">コード メトリックス値</a>というページでの説明によると、</p><blockquote><p><strong>保守容易性指数</strong> – コードの相対的な保守容易性を表す、0 ～ 100 のインデックス値を算出します。 値が大きいほど、保守容易性が優れていることを示します。 色分けしたコード評価を使用して、コード内の問題部分をすばやく識別することができます。 緑色の評価は 20 ～ 100 の範囲にあることを示し、コードの保守容易性が良好であることを示します。 黄色の評価は 10 ～ 19 の範囲にあることを示し、コードの保守容易性が中程度であることを示します。 赤の評価は 0 ～ 9 の範囲にあることを示し、保守容易性が低いことを示します。</p></blockquote><p>と定義されています。 上述の緑、黄、赤というのは、下記の画像(<a href="http://www.microsoft.com/japan/msdn/vstudio/2010/overview/about3.aspx">http://www.microsoft.com/japan/msdn/vstudio/2010/overview/about3.aspx</a>より拝借しております。不味かったら消します。)中の <strong>保守容易性イ…</strong> という列の四角いアイコンを指します。実に直感的です。 </p><p><a href="../../../../public/2012/04/CodeMetrix.png"><img src="../../../../public/2012/04/CodeMetrix-300x234.png" title="CodeMetrix"></a></p><p>ところで、保守容易性指数はどういう風に算出されているのでしょうか？ …ありました。探せばあるものです。 <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx">Code Analysis Team Blog</a><br>にて記述されていますが、</p><blockquote><p>Maintainability Index = MAX(0,(171 - 5.2 * ln(Halstead Volume) - 0.23 * (Cyclomatic Complexity) - 16.2 * ln(Lines of Code))*100 / 171)</p></blockquote><p>という数式から算出されているそうです。 つまり、保守容易性指数は、<strong>サイクロマティック複雑度</strong>と<strong>コード行</strong>と<strong>Halstead Volume</strong>なる指標に基づいた値のようです。 しかし、ここで突然Halstead Volumeなる値が出てきましたが、これはなんでしょうか？ <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures">Wikipedia</a>で苦労して見つけましたが、</p><blockquote><p><strong>Halstead complexity measures</strong> Halstead complexity measures are software metrics introduced by Maurice Howard Halstead in 1977[1] as part of his treatise on establishing an empirical science of software development. Halstead makes the observation that metrics of the software should reflect the implementation or expression of algorithms in different languages, but be independent of their execution on a specific platform. These metrics are therefore computed statically from the code. Halstead’s goal was to identify measurable properties of software, and the relations between them. This is similar to the identification of measurable properties of matter (like the volume, mass, and pressure of a gas) and the relationships between them (such as the gas equation). Thus his metrics are actually not just complexity metrics. == Calculation == For a given problem, Let: First we need to compute the following numbers, given the program: $$\eta_1$$ = the number of distinct operators $$\eta_2$$ = the number of distinct operands $$N_1$$ = the total number of operators $$N_2$$ = the total number of operands From these numbers, several measures can be calculated: Program vocabulary: $$\eta = \eta_1 + \eta_2$$ Program length: $$N = N_1 + N_2$$ Calculated program length: $$\hat{N} = \eta_1 \log_2 \eta_1 + \eta_2 \log_2 \eta_2$$ Volume: $$V = N \times \log_2 \eta$$ Difficulty : $$D = { \eta_1 \over 2 } \times { N_2 \over \eta_2 }$$ Effort: $$E = D \times V$$</p></blockquote><p>の、<strong>Volume</strong>がそれに該当するようです(可読性向上のため、数式をLatexで変換して引用しました)。 けれど、これではまだよくわかりません。 そこで簡単ではありますが、<strong>保守容易性指数</strong>が変化する様子をソースコードを用いて観察してみましょう。</p><h1 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h1><p><a href="https://taktak.jp/wordpress/?p=42">前々回</a>で用意したサンプルのソースを下記のように改造しました。 <script src="https://gist.github.com/takuya-takeuchi/5b708f53a179db642608d20f96d6c2bc.js"></script> 現実的には、絶対にあり得ないコードですが、これを <strong>Metrics.exe</strong> で計測してみましょう。 その結果が下記になります。 [table id=2 /] <strong>サイクロマティック複雑度</strong>が変化していなくても、ただ<strong>コード行</strong>が増えるだけで、<strong>保守容易性指数</strong> が低下しているのがわかります。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>まとめると、<strong>保守容易性指数</strong>は、</p><ul><li>制御フローの数から算出されるコードの構造上の複雑さを表す<strong>サイクロマティック複雑度</strong></li><li>ILコードに基づいたコードの行数である<strong>コード行</strong></li><li>ソースコード中の演算子と非演算子の種類数、出現回数の総和から算出される<strong>Halstead Volume</strong></li></ul><p>の3つのメトリックス値に基づいていることがわかりました。 つまり、ソースコードの行数が長くなると、分岐が増えなくても、比例して演算子と非演算子の出現数が増えるから保守容易性指数も下がる(ソースコードはコンパクトに!!)という訳ですね。 長くなりましたが、コード行の長さが保守の用意さに結びついている(数値的な意味で)のがわかりました。 というわけで次回は <strong>サイクロマティック複雑度</strong> について、ソースコードを交えながら説明します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NET Reflector 7 のサポート&amp;アップグレード延長</title>
      <link href="/2012/04/28/74/"/>
      <url>/2012/04/28/74/</url>
      
        <content type="html"><![CDATA[<p>2日前だけど、こんなメールが来たんだ。</p><a id="more"></a><blockquote><p>Hi We’re getting in touch because we’re celebrating the first year of Reflector 7. To say thanks for your support, we’ve upgraded your license to include an extra year of Support and Upgrades. It’s a free upgrade, so when we release the next major version of Reflector, you’ll get that for free too. You don’t need to do anything to claim the upgrade – it’s already in effect. So if you had Support and Upgrades, you now have an additional year; if you didn’t, you’re entitled to all Reflector upgrades for free, for the next 12 months. We’re currently working on version 8 of Reflector, and version 7.5 is available now. It includes dynamic decompilation in Visual Studio, so you can go to the definition of any code (f12). For more information on the new features in version 7.5, check out our upgrade page: <a href="http://www.reflector.net/entry-upgrade/">http://www.reflector.net/entry-upgrade/</a> Or to find out about our future plans for Reflector, have a look at our Early Access Program: <a href="http://www.reflector.net/eap/">http://www.reflector.net/eap/</a> Thanks, Roger Hart The .NET Reflector Team</p></blockquote><p>要約すると <code>Reflector 7開発1周年だから連絡するよ。君たちの支援に感謝していること言うために、君たちの持つライセンス -サポートとアップグレード- を**1年間の延長**したよ。これは無料だし、だから次のメジャーバージョンアップがただで手に入るさ。 君は何もしなくていい。だって既に反映済みだ。 僕たちはバージョン8の開発に取り組んでいる、そして7.5が今は利用可能だね。Visual Studio上での動的逆コンパイルを含むし、F12でコードの定義に移動できる。 Reflectorの将来の計画について知るには　アーリーアクセスプログラムを見てくれ。</code> .NET Reflector 7のVSProを持ってるんだけど、これはすごい嬉しい。これからも.NET Reflectorを当ブログは応援していきます(^q^)</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> ソフトウェア紹介 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 第3回</title>
      <link href="/2012/04/28/57/"/>
      <url>/2012/04/28/57/</url>
      
        <content type="html"><![CDATA[<p><a href="https://taktak.jp/wordpress/?p=42">前回</a>は <strong>Metrics.exe</strong> を使って実際にメトリックスを実施してみました。 今回はメトリックスの結果についての解説です。</p><a id="more"></a><h1 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h1><p>生成されたメトリックスの結果は下記のような <strong>XMLファイル</strong> でした。 生成元のコードについては、前回の記事を参照してください。 [code lang=”xml”] <?xml version="1.0" encoding="utf-8"?> <CodeMetricsReport Version="10.0"> <Targets> <Target Name="C:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\Team Tools\\Static Analysis Tools\\FxCop\\CodeMetricsTest.exe"> <Modules> <Module Name="CodeMetricsTest.exe" AssemblyVersion="1.0.0.0" FileVersion="1.0.0.0"> <Metrics> <Metric Name="MaintainabilityIndex" Value="100" /> <Metric Name="CyclomaticComplexity" Value="2" /> <Metric Name="ClassCoupling" Value="0" /> <Metric Name="DepthOfInheritance" Value="1" /> <Metric Name="LinesOfCode" Value="1" /> </Metrics> <Namespaces> <Namespace Name="CodeMetricsTest"> <Metrics> <Metric Name="MaintainabilityIndex" Value="100" /> <Metric Name="CyclomaticComplexity" Value="2" /> <Metric Name="ClassCoupling" Value="0" /> <Metric Name="DepthOfInheritance" Value="1" /> <Metric Name="LinesOfCode" Value="1" /> </Metrics> <Types> <Type Name="Program"> <Metrics> <Metric Name="MaintainabilityIndex" Value="100" /> <Metric Name="CyclomaticComplexity" Value="2" /> <Metric Name="ClassCoupling" Value="0" /> <Metric Name="DepthOfInheritance" Value="1" /> <Metric Name="LinesOfCode" Value="1" /> </Metrics> <Members> <Member Name="Main(string\[\]) : void" File="D:\\Software\\Project\\Source Code\\Blog\\BlogSamples\\CodeMetricsTest\\Program.cs" Line="11"> <Metrics> <Metric Name="MaintainabilityIndex" Value="100" /> <Metric Name="CyclomaticComplexity" Value="1" /> <Metric Name="ClassCoupling" Value="0" /> <Metric Name="LinesOfCode" Value="0" /> </Metrics> </Member> <Member Name="Program()"> <Metrics> <Metric Name="MaintainabilityIndex" Value="100" /> <Metric Name="CyclomaticComplexity" Value="1" /> <Metric Name="ClassCoupling" Value="0" /> <Metric Name="LinesOfCode" Value="1" /> </Metrics> </Member> </Members> </Type> </Types> </Namespace> </Namespaces> </Module> </Modules> </Target> </Targets> </CodeMetricsReport> [/code] ファイルを眺めていると <strong>MaintainabilityIndex CyclomaticComplexity ClassCoupling DepthOfInheritance LinesOfCode</strong> という単語が頻出しています。 <strong>Microsoft</strong>によれば、 MaintainabilityIndex -&gt; <strong>保守容易性指数</strong> CyclomaticComplexity -&gt; <strong>サイクロマティック複雑度</strong> ClassCoupling -&gt; <strong>クラス結合度</strong> DepthOfInheritance -&gt; <strong>継承の深さ</strong> LinesOfCode -&gt; <strong>コード行</strong> であると定義しています。 また、<strong>MSDN</strong>の<a href="http://msdn.microsoft.com/ja-jp/library/bb385914.aspx">コード メトリックス値</a>というページでは、上述の語を下記のように定義しています。</p><blockquote><p><strong>保守容易性指数</strong> - コードの相対的な保守容易性を表す、0 ～ 100 のインデックス値を算出します。 値が大きいほど、保守容易性が優れていることを示します。 色分けしたコード評価を使用して、コード内の問題部分をすばやく識別することができます。 緑色の評価は 20 ～ 100 の範囲にあることを示し、コードの保守容易性が良好であることを示します。 黄色の評価は 10 ～ 19 の範囲にあることを示し、コードの保守容易性が中程度であることを示します。 赤の評価は 0 ～ 9 の範囲にあることを示し、保守容易性が低いことを示します。 <strong>サイクロマティック複雑度</strong> - コードの構造上の複雑さを測定します。 これは、プログラムのフローにある、異なるコード パスの数を計算することで作成されます。 複雑な制御フローが含まれるプログラムでは、十分なコード カバレッジを実現するためにより多くのテストが必要となり、保守性が低下します。 メモ 場合によっては、Visual Studio 2010 のメソッドのサイクロマティック複雑度の計算が旧バージョンと異なります。 詳細については、「コード メトリックに関する問題のトラブルシューティング」で Visual Studio 2010 のコードの複雑度の計算における変更点についての説明を参照してください。 <strong>継承の深さ</strong> - クラス階層構造のルートまでのクラス定義の数を示します。 階層構造が深くなるにつれて、特定のメソッドおよびフィールドが定義または再定義されている場所を把握することがより困難になる場合があります。 <strong>クラス結合度</strong> - パラメーター、ローカル変数、戻り値の型、メソッド呼び出し、ジェネリックまたはテンプレートのインスタンス化、基本クラス、インターフェイス実装、外部の型で定義されたフィールド、および属性による装飾を使用して、一意のクラスへの結合度を測定します。 適切なソフトウェア デザインでは、型およびメソッドの連携は高まり、結合性は低くなります。 結合性が高いということは、他の型への依存関係が多いために再利用や保守が困難なデザインであることを示します。 <strong>コード行</strong> - コード内の行の概数を示します。 この数は IL コードに基づいているため、ソース コード ファイル内の正確な行数ではありません。 数が非常に大きい場合、型またはメソッドでの処理が多すぎるため、分割が必要であることを示すことがあります。 また、型やメソッドの保守が困難なことを示す場合もあります。</p></blockquote><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>これらを踏まえて、サンプルである <strong>CodeMetricsTest.exe</strong> の結果を表に纏めてみました。 [table id=1 /] 極めてシンプルなコードのため結果も極めて良好です(当たり前) 結果を表に纏めるといろいろ見えてきます。</p><ul><li>メトリックスの対象は、<strong>アセンブリ</strong>、<strong>名前空間</strong>、<strong>型</strong>、<strong>型のメンバ</strong>という4つの単位で計測される</li><li>型のメンバには「継承の深さ」のメトリックスが含まれない</li><li><strong>サイクロマティック複雑度</strong>、<strong>コード行</strong>等は、上位の単位は下位単位を内包した結果になっている</li><li>コード行は<strong>IL</strong> (Intermediate Language) を元にしているからソースと一致しない (Programコンストラクタに1行追加されている)</li></ul><p>各メトリックス値を更にブレイクダウンする必要があるようです。 というわけで次回は <strong>保守容易性指数</strong> について、ソースコードを交えながら説明します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 第2回</title>
      <link href="/2012/04/26/42/"/>
      <url>/2012/04/26/42/</url>
      
        <content type="html"><![CDATA[<p>前回は<strong>Visual Studio Code Metrics PowerTool 10.0</strong>をインストールしました。 今回は実際に使ってみます。</p><a id="more"></a><h1 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h1><p>(1) コマンドプロンプトを起動します。 </p><p><a href="../../../../public/2012/04/codemetrics_2_0.png"><img src="../../../../public/2012/04/codemetrics_2_0-300x273.png" title="codemetrics_2_(0)"></a></p><p>(2) <strong>cd</strong> コマンドで、<strong>Visual Studio Code Metrics PowerTool 10.0</strong>のインストール先ディレクトリに移動します <strong>注: OSによってインストール先が異なります(恐らく)</strong> <strong>64bit OS</strong> C:\Program Files (x86)\Microsoft Visual Studio 10.0\Team Tools\Static Analysis Tools\FxCop <strong>32bit OS</strong> C:\Program Files\Microsoft Visual Studio 10.0\Team Tools\Static Analysis Tools\FxCop</p><p><a href="../../../../public/2012/04/codemetrics_2_1.png"><img src="../../../../public/2012/04/codemetrics_2_1-300x273.png" title="codemetrics_2_(1)"></a></p><p>(3) 目的のディレクトリで <strong>Metrics.exe /?</strong> と入力して、ヘルプを表示します。</p><p><a href="../../../../public/2012/04/codemetrics_2_2.png"><img src="../../../../public/2012/04/codemetrics_2_2-300x273.png" title="codemetrics_2_(2)"></a></p><p>表示されたのは、Metrics.exeのヘルプです。 下記は私が訳したヘルプの概要です。 [code] <strong>/file: [Short form: /f:] Assembly file(s)<br> to analyze.</strong> [訳:解析するアセンブリファイル]<br>**/out: [Short form: /o:] Metrics results XML output file.** [訳:メトリックスした結果のXMLの出力先ファイル]<br>**/directory: [Short form: /d:] Location to search for assembly dependencies.** [訳:解析するアセンブリが依存しているアセンブリの探索先]<br>**/searchgac [Short form: /gac] Search the Global Assembly Cache for missing references.** [訳:参照先が見当たらない場合にGACを探索します]<br>**/platform: [Short form: /plat:] Location of framework assemblies, such as mscorlib.dll.** [訳:mscorlib.dllをはじめとする.NET Framework アセンブリの探索先]<br>**/reference: [Short form: /ref:] Reference assemblies required for analysis.** [訳:解析に必要な参照アセンブリ]<br>**/ignoreinvalidtargets [Short form: /iit] Silently ignore invalid target files.** [訳:無効な解析対象を無視します]<br>**/ignoregeneratedcode [Short form: /igc] Do not calculate metrics for generated code.** [訳:生成したコードのメトリックスを計算しません]<br>**/successfile [Short form: /sf] Create .lastcodemetricsssucceeded file in output report directory if no errors occur during calculation.** [訳:計算中にエラーが発生しなかった場合、レポート出力先ディレクトリに .lastcodemetricsssucceeded ファイルを生成します]<br>**/quiet [Short form: /q] Silence all console output other than error reporting.** [訳:エラー以外コンソールへ出力しません]<br>**/help [Short form: /?] Display this help message.** [訳:ヘルプメッセージを表示します] [/code] 割と豊富なオプションですが、今回以降使うのは <strong>/file: [Short form: /f:] /out: [Short form: /o:]</strong> の2つがメインとなります。</p><h1 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h1><p>実際に使ってみます。 ここではサンプルとして</p><pre><code class="csharp">namespace CodeMetricsTest&#123;    class Program    &#123;        static void Main(string[] args)        &#123;        &#125;    &#125;&#125;</code></pre><p>のような、コンソールプログラム <strong>CodeMetricsTest.exe</strong> を用意しました。 ターゲットフレームワークのバージョンは2.0です。2.0以降でも問題ないでしょう。 CodeMetricsTest.exeとCodeMetricsTest.pdbをMetrics.exeと同じディレクトリにコピーして下記のコマンドを入力してください。 <strong>Metrics.exe /file:CodeMetricsTest.exe /out:CodeMetricsTestReport.xml</strong> </p><p><a href="../../../../public/2012/04/codemetrics_2_3.png"><img src="../../../../public/2012/04/codemetrics_2_3-300x273.png" title="codemetrics_2_(3)"></a></p><p> なにやら、英語が表示されましたが、エラーではありません。 成功していれば、同じディレクトリに <strong>CodeMetricsTestReport.xml</strong> が作成されています。 結論を言ってしまうと、このxmlファイルこそが、今回解析したアセンブリのコードメトリクス値を記したレポートになるのです。 今回はここまでです。 次回は、今回出現したxmlファイルの中身の説明とプログラムからの利用方法について説明します。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Wordpress</title>
      <link href="/2012/04/25/39/"/>
      <url>/2012/04/25/39/</url>
      
        <content type="html"><![CDATA[<p>の設定で一日が終了。昨日の記事の続きはまた次回…</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> 雑記 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>.NETでコード メトリックスを試してみる 第1回</title>
      <link href="/2012/04/24/26/"/>
      <url>/2012/04/24/26/</url>
      
        <content type="html"><![CDATA[<p>技術屋さんなので、プログラマーなのでそれらしいネタで情報提供しましょう。 最近の自分のトレンドはソフトウェア工学(っぽいこと)。 ソフトウェアの品質管理やプロジェクト管理に手を出しています。 会社でも作業工数の管理や進捗度合いの管理にRedmineを使っています(個人で)。 家でもRedmineでプロジェクト管理しています。 <strong>Viva!! Redmine</strong> …閑話休題。</p><a id="more"></a><p>コードの品質が良い、悪いって直感的です。 読みやすいソース？バグの少ないソース？保守がしやすい？機能追加しやすい？ そういうのを数字でわかりやすくしよう、ってのがソフトウェアメトリックスです。</p><blockquote><p><strong>ソフトウェア測定法</strong> ソフトウェア測定法（ソフトウェアそくていほう）またはソフトウェアメトリック（英: Software metric ）とは、ソフトウェアやその仕様の属性の尺度である。 定量的手法の威力は他の分野で証明されていたことから、計算機科学の分野でも同様の手法をソフトウェア開発に持ち込もうとする努力が続けられてきた。Tom DeMarco は DeMarco, T. (1982) Controlling Software Projects: Management, Measurement &amp; Estimation, Yourdon Press, New York, USA, p3 の中で「測定できないものは制御できない」と記している。</p><p><a href="https://ja.wikipedia.org/wiki/%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E6%B8%AC%E5%AE%9A%E6%B3%95">ウィキペディア（Wikipedia）</a></p></blockquote><p>何だか難しそうですが、触れてみるのが一番。 というわけで、.NETでコードメトリックスを試してみましょう。 <strong>Visual Studio Code Metrics PowerTool 10.0</strong>というMicrosoft社が無償で提供しているツールがあります。 ダウンロード先は<a href="http://www.microsoft.com/download/en/details.aspx?id=9422">ここ</a>から。 このツール、<strong>VisualStudio 2010</strong>の<strong>Premium</strong>と<strong>Ultimate</strong>のみで提供されているコードメトリックスと同じことをCUIで実施してくれます。 利用方法もコマンドをたたくだけのお手軽仕様。 <strong>MetricsSetup.exe</strong>というインストーラをダブルクリックしてインストールするだけです。 インストールは下記の手順に従ってください。 (1) [Next] をクリック。 <img src="../../../../public/2012/04/wordpress0.png" alt="インストール画面1"> (2) ライセンス規約に同意できたら [**I have read and accept the license terms.**] をチェックし [Install] をクリック。 <img src="../../../../public/2012/04/wordpress1.png" alt="インストール画面2"> (3) セットアップ進行中。2,3分待ってください(すぐ終わります) <img src="../../../../public/2012/04/wordpress2.png" alt="インストール画面3"> (4) セットアップ完了。[Finish] をクリックしてインストーラを終了します。 <img src="../../../../public/2012/04/wordpress3.png" alt="インストール画面4"> 以上で終了です。 今回はここまでです。 次回は実際にコード分析を行ってみたいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> Microsoft </category>
          
          <category> .NET Framework </category>
          
          <category> net-framework </category>
          
          <category> C# </category>
          
          <category> ソフトウェア紹介 </category>
          
          <category> .NETで○○○を試してみる </category>
          
          <category> ソフトウェア工学 </category>
          
          <category> netで○○○を試してみる </category>
          
          <category> .NETでコード メトリックスを試してみる </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>iKnow! 進捗報告 [4/16-4/22]</title>
      <link href="/2012/04/23/22/"/>
      <url>/2012/04/23/22/</url>
      
        <content type="html"><![CDATA[<p>今週は、 <strong>目標 : 08時間00分 実績 : 05時間20分 合計 : 05時間20分</strong> でした。 4/17から開始したので、まぁ妥当なところかと。 <strong>反省点</strong> 土日も学習しなきゃ<strong>orz</strong> ・・・どうでもいいけど、WordPressのエディタ使いにくいです。</p>]]></content>
      
      
      <categories>
          
          <category> iKnow! </category>
          
          <category> 英語 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>目標宣言</title>
      <link href="/2012/04/23/14/"/>
      <url>/2012/04/23/14/</url>
      
        <content type="html"><![CDATA[<p>どこの会社でも、そうなんでしょうが、毎年自己のスキルアップなどの目標を掲げているとは思うのですが、自分もまぁ目標を立てています。 新人の時は、資格の取得を目標にしていました。 でもさすがに、4年目だと資格だけでなく、具体的に<strong>生産性アップ</strong>だの<strong>顧客満足度向上</strong>だのお題目を掲げることになる。 なるのだが、客先と接点が薄い部署だし、担当レベルだと正直未だに利益率とか数字を意識しにくい。 いや、工数は日々入力していますが。 まぁ、そういう目標はわかりにくいし、情報発信しにくいんで、ここでは<strong>英語</strong>、具体的には<strong>TOEIC</strong>で目標点数を宣言して、自分を追い込みますorz とりあえず私のTOEIC歴(大学時代のは忘れました)</p><p>2009</p><p>1st</p><p>475</p><p>2009</p><p>2nd</p><p>425</p><p>2010</p><p>1st</p><p>忘れました</p><p>2010</p><p>2nd</p><p>忘れました</p><p>2011</p><p>1st</p><p>555</p><p>2011</p><p>2nd</p><p>565</p><p>年2回の社内受験があるのですが、現在565。入社時より90点向上しています。 これでも入社直後で昇格用件を満たしたんです。かなり少ないんですよ？ で、今年の目標は <strong>600点</strong> ・・・低いって言わないでください。 で、ストレッチ目標が<strong>650点</strong>。 まぁ、妥当なところかと。 じゃぁ実現計画は？っていうと <strong>iKnow!始めます</strong> ってことです。 とりあえず、毎週日曜日に進捗報告します。</p>]]></content>
      
      
      <categories>
          
          <category> iKnow! </category>
          
          <category> 英語 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello, world!!</title>
      <link href="/2012/04/23/7/"/>
      <url>/2012/04/23/7/</url>
      
        <content type="html"><![CDATA[<p>WordPress始めました。 ブログ自体は、何個か過去に綴ってきてはいましたが、まぁ、例によって飽き自然消滅しました。 ただ、社会人になってからは、大学時代から続いている<strong>mixi</strong>以外は、何もしていない状況でした。 そんなこんなで、2012年になり、社会人4年目。技術者としてワンランクもツーランクもレベルアップするために何かできないか？ そう思い始めたのが「情報発信」。 まずは、ネット上の誰かの役に立つ情報を提供できたら、という小さな目標から歩いて行きたいと思います。</p>]]></content>
      
      
      <categories>
          
          <category> その他 </category>
          
          <category> 雑記 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
